/**
 * convo-web-app - v2018.05.24.01 - 2018-05-24
 * https://sapp.convo.com/webapp
 *
 * Copyright (c) 2018 Junaid Khan
 * Licensed MIT <https://raw.github.com/ngbp/ngbp/master/LICENSE>
 */

!function(a,b,c){function d(b){if(!b.getBoundingClientRect)return!0;var c=b.getBoundingClientRect(),d=$(a).height(),e=c.bottom-c.top;return!(c.top>d||c.top+e<0)}function e(a){a.put("audioPlayer/cnvAudioPlayer.tpl.html",'<div class="audio-player" bindonce>\n    <div bo-if="!couldNotPlayFile" class="audio-player-wrapper-inner">\n        <span class="toggle" ng-click="onPlayPauseBtnClick()"><span class="icon"></span></span>\n        <span class="scrubber">\n            <span class="scrubber-cont" ng-click="scrubberClicked($event)">\n                <span class="scrubber-bg"></span>\n                <span class="buffer-area"></span>\n                <span class="seek"></span>\n            </span>\n            <span class="timer">00:00</span>\n        </span>\n        <span class="volume-control">\n            <span class="volume-icon" ng-click="toggleVolume()"></span>\n            <span class="vol-bar-cont">\n                <span class="vol-bar-pad" ng-mousedown="volumeBarClicked($event)">\n                    <span class="vol-bar"></span>\n                    <span class="bar"></span>\n                </span>\n            </span>\n        </span>\n        <div bo-if="showMenu" class="audio-menu">\n            <cnv-dropdowns cnv-dropdown-ctrl="dropdownCtrl"></cnv-dropdowns>\n        </div>\n    </div>\n    <div bo-if="couldNotPlayFile && notifyCouldNotPlayFile" class="audio-player-wrapper-inner could-not-play-wrapper">\n        <div class="could-not-play-cont">\n            <span>Preview not available.</span>\n            <span class="download-icon" ng-click="downloadFile()">\n                <i class="cnv-icons-16 icons2_Download-lightgray"></i>\n                <i class="cnv-icons-16 icons2_Download-white"></i>\n            </span>\n        </div>\n        <div bo-if="showMenu" class="audio-menu">\n            <cnv-dropdowns cnv-dropdown-ctrl="dropdownCtrl"></cnv-dropdowns>\n        </div>\n    </div>\n\n    <audio class="cnv-audio-player" style="height: 0;width: 0;display: none;" controls="">\n      <source bo-src="file.original_name | getOriginalImagePath : (file.noteId || file.item_id)" type="audio/ogg">\n      <source bo-src="file.original_name | getOriginalImagePath : (file.noteId || file.item_id)" type="audio/mpeg">\n    </audio>\n\n    <input type="text" spellcheck="false" class="dummy-active-elem ignore-key-down" style="width:0px; height:0px; position:absolute; opacity:0.01" />\n</div>\n'),a.put("chat/client/chatSettings/templates/cnvChatSettingsPanel.tpl.html",'<cnv-chat-settings-panel class="settingsPanel" bindonce>\n    <div class="settingsHeader">\n        <span>Settings</span>\n\n        <div class="closeSettingsButton" ng-click="closeSettingsPanel()"></div>\n    </div>\n\n    <div bo-show="!initialized" class="loading-spinner">\n        <img src="assets/img/feed/loading-spin.svg" alt="Loading icon"/>\n    </div>\n\n\n    <div bo-show="initialized">\n        <div style="margin-top: 15px;margin-left: 15px;">\n            <span>Status</span>\n\n            <div bo-bind="curStatus" style="display: inline-block;margin-left: 15px;"></div>\n            <div bo-show="curStatus == \'Available\'" class="availableBubble"></div>\n            <div bo-show="curStatus == \'Busy\'" class="busyBubble"></div>\n            <cnv-dropdowns style="float: right;margin-right: 5%;margin-top: -3px;"\n                           cnv-dropdown-ctrl="statusOptions"></cnv-dropdowns>\n            <div class="dropdown"></div>\n        </div>\n        <div class="line-separator"></div>\n        <div style="margin-bottom: 20px">\n            <div class="notifications" style="margin-left: 15px;margin-top: 10px;">\n                <span style="vertical-align: middle">Notifications</span>\n\n                <div style="float:right;margin-right: 14px;">\n                    <div class="chkNotification btn-group btn-toggle">\n                        <button class="btn btn-xs btn-primary active">ON</button>\n                        <button class="btn btn-xs btn-default-transparent-font">OFF</button>\n                    </div>\n                    <!--   <input class="" type="checkbox" checked data-toggle="toggle">-->\n                </div>\n            </div>\n            <div class="sounds" style="margin-left: 15px;margin-top: 20px;">\n                <span style="vertical-align: middle">Sounds</span>\n\n                <div style="float:right;margin-right: 14px;">\n                    <div class="chkSound btn-group btn-toggle">\n                        <button class="btn btn-xs btn-primary active">ON</button>\n                        <button class="btn btn-xs btn-default-transparent-font">OFF</button>\n\n                    </div>\n                    <!--  <input class="chkSound" type="checkbox" checked data-toggle="toggle">-->\n                </div>\n            </div>\n        </div>\n        <div class="line-separator"></div>\n        <!-- <div class="sorting" style="margin-left: 15px;margin-top: 10px;">\n            <span>Sort by:</span>\n\n            <div bo-bind="sortStatus" style="display: inline-block;margin-left: 10px;"></div>\n            <cnv-dropdowns style="float: right;margin-right: 5%;margin-top: -3px;"\n                           cnv-dropdown-ctrl="sortOptions"></cnv-dropdowns>\n            <div class="dropdown"></div>\n        </div> -->\n    </div>\n</cnv-chat-settings-panel>'),a.put("chat/client/chatUsersWindow/templates/cnvChatUsersWindow.tpl.html",'<div cnv-window-maximize-minimize-manager id="chatUserListMainWindow" class="chatUserListMainStyl" tabindex="0" bindonce >\n    <div class="content-resizer" cnv-window-resize-manager="vertical" resizer-bottom="chatUserListMainWindow"></div>\n    <div class="chatUserListHeader unfocused-state" cnv-chats-list-window-header>\n        <div class="unreadCount" bo-bind="chatsUnreadCount > 20 ? \'20+\': chatsUnreadCount" bo-if="chatsUnreadCount > 0"></div>\n        <div class="chatsIcon"></div>\n        <div class="chatHeaderText">\n            <span>Chats</span>\n            <div style="display: inline-block;margin-bottom: -2px;margin-left: 5px;">\n                <div bo-if="thisUser.presenceStatus == 1 && thisUser.getDevice() !=2"\n                class="listUserStatusOnline"></div>\n                <div bo-if="thisUser.presenceStatus == 2 && thisUser.getDevice() !=2"\n                class="listUserStatusBusy"></div>\n                <div bo-if="thisUser.presenceStatus == 3 && thisUser.getDevice() !=2"\n                class="listUserStatusIdle"></div>\n                <div bo-if="thisUser.presenceStatus == 4 && thisUser.getDevice() !=2 && !thisUser.getHasMobile()"\n                class="listUserStatusOffline"></div>\n                <div bo-if="(thisUser.getDevice() == 2) || (thisUser.presenceStatus == 4 && thisUser.getHasMobile())"\n                class="listUserStatusMobileWhite"></div>\n            </div>\n        </div>\n        <a bo-if="!isNewChat" class="btnExpand" bo-href="fullChatViewUrl" target="{{fullChatViewTarget}}" bo-show="!isInitializing && !isMinimized && !chatWindow.metaDetails.isMinimized" style="display:none;">\n            <i class="headerIcon cnv-icons-16 chat-window-expand-white" ></i>\n            <i class="headerIcon cnv-icons-16 chat-window-expand-gray-hover"></i>\n        </a>\n        <div class="create-new-feed-chat-btn" bo-show="!isInitializing && !isMinimized && !chatWindow.metaDetails.isMinimized" bo-mousedown="createNewChat()">\n            <i class="headerIcon cnv-icons-20 chat_create_new_chat_white"></i>\n            <i class="headerIcon cnv-icons-20 chat_create_new_chat"></i>\n        </div>\n        <div style="float: right;margin-top: 5px;margin-right: 10px;display: none;" class="chatSettingsOptionsBtn btnChatSettings" bo-show="!isInitializing && !isMinimized && !chatWindow.metaDetails.isMinimized">\n            <i class="headerIcon cnv-icons-20 chat_settings_white"></i>\n            <i class="headerIcon cnv-icons-20 chat_settings"></i>\n            <cnv-dropdowns cnv-dropdown-ctrl="chatSettingsOptions" ng-disabled="chatObj.isInviteChat || disabledChat && !canShareChat()" style=\'top: 1px;bottom: 0;position: absolute;\'></cnv-dropdowns>\n        </div>\n    </div>\n    <div class="chatSearchBar">\n        <div class="searchChatIcon"></div>\n        <input class="inputSearchBar" spellcheck="false" placeholder="SEARCH" bo-keydown="removeText($event)" spellcheck="false" />\n        <div class="closeTeammateIcon" bo-show="isSearchView" ng-click="closeTeammatesView($event)"></div>\n    </div>\n    <cnv-chat-user-list id="chatUserList" class="chatUserList cnvScrollContainerParent" bindonce style="display: block;position: absolute;width: 100%;top: 68px;bottom: 0px;">\n    <div id="chatsListScroller" style="height: 100%;overflow-x:hidden;overflow-y:scroll;" auto-hiding-scroll-bar>\n        <div id="chatsView" style="overflow: hidden;flex: 1;-webkit-flex:1;-ms-flex: 1; width: inherit;">\n            <cnv-new-chat-item bo-if="newChatData" class="fee-chats-list-item"\n                               bo-mousedown="openChatWindow($event, newChatData)"></cnv-new-chat-item>\n            <div bo-repeat="chat in chatList | limitTo:showingList" class="chatListItemContainer" \n                bo-class="{selected : $index == userSelectedIndex && contactSelectedIndex === -1}">\n                <div bo-show="chat.userId" class="listItem" bo-mousedown="openChatWindow($event,chat)" style="padding-top:10px">\n                    <div class="user-img-48">\n                        <cnv-user-profile-image user-id="chat.userId" width="40" height="40"\n                        profileType="chat.profileImageType"\n                        profileVersion="chat.profileImageVersion"></cnv-user-profile-image>\n                    </div>\n                    <div class="listUserName" bo-bind="chat.getDisplayName()">\n                    </div>\n                    <span bo-if="chat.isInvitedUser()" class="invited-icon cnv-icons-20 Icon1__Time-darkgray"></span>\n                    <div bo-if="!chat.isInvitedUser()" style=" position: absolute;left: 41px;margin-top: 27px;display: inline-block;">\n                        <div bo-if="chat.presenceStatus == 1  && chat.getDevice() !=2" class="listUserStatusOnline"></div>\n                        <div bo-if="chat.presenceStatus == 2  && chat.getDevice() !=2" class="listUserStatusBusy"></div>\n                        <div bo-if="chat.presenceStatus == 3  && chat.getDevice() !=2" class="listUserStatusIdle"></div>\n                        <div bo-if="chat.presenceStatus == 4  && chat.getDevice() !=2 && !chat.getHasMobile()"\n                        class="listUserStatusOffline"></div>\n                        <div bo-if="(chat.getDevice() ==2) || (chat.presenceStatus == 4 && chat.getHasMobile())" class="user-inactive-time-field">\n                            <span bo-if="chat.presenceStatus == 4" class="user-inactive-time" bo-date="chat.lastPingTime | dateAgo: null : true : true :false :true: \'shortDate\': true: true: true"></span>\n                            <div class="listUserStatusMobile chat-list"></div>\n                        </div>\n                    </div>\n                </div>\n                <div bo-if="isFilteredView && chat.showGroupChatsBanner" class="separator-title">Group Chats</div>\n                <div bo-if="!chatList[$index - 1].message_match && chat.message_match" class="separator-title">Messages</div>\n                <div bo-if=\'chat.chatId\' class="listItem" bo-mousedown="openChatWindow($event,chat)" style="padding-top:10px">\n                    <div class="user-img-48" bo-if="chat.chatType == 1">\n                        <cnv-user-profile-image user-id="chat._user.userId" width="40" height="40"\n                        profile-type="chat._user.profileImageType" full-name="chat.getOtherParticipant().name"\n                        profile-version="chat._user.profileImageVersion"></cnv-user-profile-image>\n                    </div>\n                    <div bo-if="chat._iconVersion && chat._iconVersion != \'0\'" style="margin-left: 5%;display: inline-block;width:40px; height: 40px; border-radius: 20px; overflow:hidden;">\n                        <img bo-src="getChatImageThumbnailPath(chat)" width="40px" height="40px" />    \n                    </div>\n                    <cnv-group-chat-avatar participants="chat.participants" bindonce\n                    style="width: 40px;height: 40px;margin-left: 5%;font-size: 8px; display: inline-block; "\n                    bo-if="chat.chatType == 2 && (!chat._iconVersion || chat._iconVersion == \'0\')">\n                    <div class="topList" style="display: flex;display: -webkit-flex;display: -ms-flexbox;"\n                        bo-if="!emptyChatUser && userArr.length >1">\n                        <cnv-user-profile-image user-id="userArr[0].userId" width="20" height="20"\n                        bo-class="{\'showing3GroupUsersTop\' : show3images,\'showing2GroupUsersTop\' : show2images}"\n                        profileType="userArr[0].profileImageType"\n                        profileVersion="userArr[0].profileImageVersion" full-name="userArr[0].firstName+\' \'+userArr[0].lastName"></cnv-user-profile-image>\n                        <cnv-user-profile-image user-id="userArr[3].userId" width="20" height="20"\n                        bo-show="!show2images && !show3images"\n                        profileType="userArr[3].profileImageType"\n                        profileVersion="userArr[3].profileImageVersion" full-name="userArr[3].firstName+\' \'+userArr[3].lastName"></cnv-user-profile-image>\n                    </div>\n                    <div class="botList" style="display: flex;display: -webkit-flex; display: -ms-flexbox;"\n                        bo-if="!emptyChatUser && userArr.length >1"\n                        bo-class="{\'showing3GroupUsersBot\' : show3images}">\n                        <cnv-user-profile-image user-id="userArr[2].userId" width="20" height="20"\n                        bo-show="!show2images"\n                        profileType="userArr[2].profileImageType"\n                        profileVersion="userArr[2].profileImageVersion" full-name="userArr[2].firstName+\' \'+userArr[2].lastName"></cnv-user-profile-image>\n                        <cnv-user-profile-image user-id="userArr[1].userId" width="20" height="20"\n                        bo-class="{showing2GroupUsersBot : show2images }"\n                        bo-show="userArr.length <= 4"\n                        profileType="userArr[1].profileImageType"\n                        profileVersion="userArr[1].profileImageVersion" full-name="userArr[1].firstName+\' \'+userArr[1].lastName"></cnv-user-profile-image>\n                        <div class="groupAvatarCounter" bo-show="showCounter" bo-bind="\'+\'+(userArr.length-3)"></div>\n                    </div>\n                    <div bo-if="userArr.length == 1" style="font-size: 15px">\n                        <cnv-user-profile-image user-id="userArr[0].userId" width="40" height="40"\n                        profileType="userArr[0].profileImageType"\n                        profileVersion="userArr[0].profileImageVersion" full-name="userArr[0].firstName+\' \'+userArr[0].lastName"></cnv-user-profile-image>\n                    </div>\n                    <div bo-if="emptyChatUser" style="font-size: 15px">\n                        <cnv-user-profile-image user-id="emptyChatUser.userId" width="40" height="40"\n                        profileType="emptyChatUser.profileImageType"\n                        profileVersion="emptyChatUser.profileImageVersion"></cnv-user-profile-image>\n                    </div>\n                    </cnv-group-chat-avatar>\n                    <div class="chatListInfo">\n                        <div class="chatListDate" bo-date="chat.lastMessageTimestamp | dateAgo : null : true : true"></div>\n                        <div class="chatListTitle" bo-bind="chat.getTitle()" bo-class="{\'boldChatTitle\' : chat.unreadCount && chat.unreadCount > 0}"></div>\n                        <div class="listUnreadCountCont">\n                            <i bo-show="chat.isMuted" class="cnv-icons-20 icons2_Mute-lightgray" style="top: 3px;position: relative;"></i>\n                            <div class="listUnreadCount" bo-show="chat.unreadCount && chat.unreadCount > 0"\n                            bo-bind="chat.unreadCount > 20 ? \'20+\': chat.unreadCount"></div>\n                        </div>\n                        <div bo-if="chat.participants[chat.thisUser.userId].status == \'left\' || !chat.isAnyParticipantComposing" bo-class="{\'boldText\': chat.isFetchedChat && chat.search_match}" class="chatListMsg" bo-bind="chat.getSummeryText()"></div>\n                        <div bo-if="chat.participants[chat.thisUser.userId].status != \'left\' && chat.isAnyParticipantComposing" class="composingDetails">\n                            <span bo-if="chat.chatType === 2" bo-bind="chat.composingParticipants[chat.composingParticipants.length - 1].name.split(\' \')[0]+\':\'"></span>\n                            <div class="composingMessageFromOtherUser composingMessageFromOtherUserChatList">\n                                <div class="dot1"></div>\n                                <div class="dot2"></div>\n                                <div class="dot3"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div bo-if="!chat._user.isInvitedUser()" style=" position: absolute;left: 42px;margin-top: 28px;display: inline-block;">\n                        <div bo-if="chat._user.presenceStatus == 1  && chat._user.getDevice() !=2"\n                        class="listUserStatusOnline"></div>\n                        <div bo-if="chat._user.presenceStatus == 2  && chat._user.getDevice() !=2"\n                        class="listUserStatusBusy"></div>\n                        <div bo-if="chat._user.presenceStatus == 3  && chat._user.getDevice() !=2"\n                        class="listUserStatusIdle"></div>\n                        <div bo-if="chat._user.presenceStatus == 4  && chat._user.getDevice() !=2 && !chat._user.getHasMobile()"\n                        class="listUserStatusOffline"></div>\n                        <div bo-if="(chat._user.getDevice() ==2) || (chat._user.presenceStatus == 4 && chat._user.getHasMobile())" class="user-inactive-time-field">\n                            <span bo-if="chat._user.presenceStatus == 4" class="user-inactive-time" bo-date="chat._user.lastPingTime | dateAgo: null : true : true :false :true: \'shortDate\': true: true: true"></span>\n                            <div class="listUserStatusMobile chat-list"></div>\n                        </div>\n                    </div>\n                    <div bo-if="chat.shouldShowSeenParticipantsInList && chat.unreadCount == 0" class="seen other-user-message-seen" style="margin-top:-23px; padding: 0 11px 0px 0px;">\n                        <span class="group-chat-seen-more-counter" bo-if="chat.moreParticipantsCount" cnv-popover cnv-popover-ctrl="chat.seenParticipants | chatParticipentsTooltipText: 2: true" bo-click="openSeenNotificationDialog(chat.seenParticipants);">\n                            <span class="seen-counter" bo-bind="chat.moreParticipantsCount"></span>\n                        </span>\n                        <span bo-repeat="seenParticipant in chat.seenParticipants | limitTo:(chat.moreParticipantsCount ? 2 : 3)" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                            <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" width="15" height="15">\n                            </cnv-user-profile-image>\n                        </span>\n                    </div>\n                </div>\n                <div class="listItemBorder"></div>\n            </div>\n            <div class="contact-list" bo-if="showContactsList">\n                <div class="separator-title">People you may know</div>\n                <div bo-repeat="contactInfo in contactList | limitTo:showContactListLength" bo-class="{selected : $index == contactSelectedIndex }" class="chatListItemContainer" >\n                    <div class="listItem" bo-mousedown="openChatWindow($event, contactInfo.contact, true)" style="padding-top:10px">\n                        <div class="user-img-48">\n                            <span class="invitee-img" bo-class="contactInfo.classes"></span>\n                        </div>\n                        <div class="listUserName title-margin-bottom" bo-bind="contactInfo.contact.getDisplayName()"></div>\n                        <span cnv-popover cnv-popover-ctrl="Invite" ng-mousedown="inviteContact($event, $index);" bo-class="{\'check-white check-invited-icon\': contactInfo.contact.isInvitedUser(), \'icons2_Add-blue\': !contactInfo.contact.isInvitedUser()}" class="cnv-icons-20 add-invite-invited-icon"></span>\n                    </div>\n                    <div class="listItemBorder"></div>\n                </div>\n            </div>\n        </div>\n        <div class="chat-blank-state-wrapper blank-search-view" bo-show="!chatUserListSpinner && searchKeyWord.length > 0 && usersCount === 0 && (!contactList || contactList.length === 0) ">\n            <div>\n                <i class="cnv-icons-40 icons2_Chats-lightgray"></i>\n                <!--<p>Send chats to your teammates,<br />one-on-one or in groups.<br /></p>-->\n                <p>No matches found.</p>\n            </div>\n        </div>\n        <div class="chat-blank-state-wrapper blank-view" bo-show="!newChatData && searchKeyWord.length === 0 && chatUsersManager.getUsers().length === 0 && chatUsersManager.getContacts().length === 0">\n            <cnv-home-chat-view-blank-state></cnv-home-chat-view-blank-state>\n        </div>\n        <div class="list-end-placeholder" bo-show="showInviteTeamMateLink && !isThisUserGuestUser" style="padding:10px 0px">\n            <a ng-click="openInviteTeammatesModal()">INVITE TEAMMATES</a>\n        </div>\n        <div class="spinner-container" bo-show="chatUserListSpinner && !showInviteTeamMateLink">\n            <i class="cnv-circle-spinner-small"></i>\n        </div>\n    </div>\n    </cnv-chat-user-list>\n</div>'),a.put("chat/client/chatUsersWindow/templates/cnvHomeChatViewBlankState.tpl.html",'<div bindonce>\n    <div class="empty-state-title"><b>Convo works better with your team</b></div>\n    <div class="empty-state-desc" ng-if="!shouldInviteGuestsAsFullMembers">See teammates who aren\'t on the<br><span bo-bind="primaryDomain"></span> network yet.</div>\n    <div class="empty-state-desc" ng-if="shouldInviteGuestsAsFullMembers">See teammates who aren\'t here yet.</div>\n    \n    <div class="empty-state-action-bar">\n\n        <div class="import-google-contacts" ng-if="config.IS_MAC">\n            <button ng-controller="ImportMacContactsCtrl" class="btn btn-primary" ng-click="findMacContacts()">Import Contacts from your Mac</button>\n        </div>\n\n        <div class="import-google-contacts" ng-if="!config.IS_MAC">\n            <button ng-controller=" ImportGoogleContactsCtrl" class="btn btn-primary" ng-click="findGoogleContacts()">Import Google Contacts</button>\n        </div>\n        \n        <div ng-if="!config.IS_NATIVE" ng-controller="ImportCSVContactsCtrl" class="import-csv-contacts invite-CSV-contacts">\n            <input name=\'file\' class=\'file-input\' style="display: none;" onclick="this.value=null;" onchange="angular.element(this).scope().CSVFileInputChange(this)" type=\'file\'></input>\n            <a ng-click="findCSVFileContacts($event)">Import CSV file</a>\n        </div>\n    </div>\n    <section class="invite-contacts-sticky-bottom">\n        <div class="invite-contacts-title">Or add a teammate\'s email below</div>\n        <div class="invite-contacts-to-field-wrapper">\n            <tags-input class="chat-invite-to-field"\n                        ng-model="inviteTo"\n                        placeholder="{{placeholderText}}"\n                        no-tags-indicator="false"\n                        add-on-comma="false"\n                        add-on-blur="true"\n                        add-from-autocomplete-only="true"\n                        display-property="label"\n                        replace-spaces-with-dashes="false"\n                        on-tag-added="onItemAddedInEmailField($tag)">\n                <auto-complete\n                        source="getInviteToDropdownItems($query, numSelected)"\n                        load-history-on-focus="true"\n                        auto-select-first-suggestion="true"\n                        delimiter="@"\n                        min-length="1"\n                        suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n                </auto-complete>\n            </tags-input>\n        </div>\n        <span class="invite-btn-control" ng-click="inviteUser()"><i class="add-1-lightblue cnv-icons-20"></i>\n        </span>\n    </section>\n</div>'),a.put("chat/client/chatWindow/templates/NewChatWindowUsersInput.tpl.html",'<div bindonce>\n    <tags-input class="to-field"\n                ng-model="userItems"\n                placeholder=""\n                pre-placeholder="To:"\n                no-tags-indicator="false"\n                add-on-comma="false"\n                add-on-blur="false"\n                horizontal-flow = "false"\n                add-from-autocomplete-only="true"\n                display-property="label"\n                replace-spaces-with-dashes="false"\n                allow-leftover-text="true"\n                on-esc-key-press="onEscKeyPressInToField()"\n                on-tag-added="onItemAddedInToField($tag)"\n                on-tag-removed="onItemRemovedInToField($tag)"\n                set-focus-on-load="true"\n                hide-input-on-blur="false">\n        <auto-complete\n            source="queryAutoCompleteItemsAvailableLocally($query, numSelected)"\n            source2="queryAutoCompleteItemsFromServer($query, numSelected)"\n            load-history-on-focus="false"\n            auto-select-first-suggestion="true"\n            delimiter="@"\n            min-length="1"\n            suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n        </auto-complete>\n    </tags-input>\n</div>'),a.put("chat/client/chatWindow/templates/chatActionBar.tpl.html",'<div class="chatActionBar " bindonce >\n    <div bo-show="!editChatTitle">\n        <div class="statusMessage" bo-if="chatObj.chatType == 1 && !chatService.isAdminModeONAndThisUserIsNotInChatParticipantsAndIsP2PChat(chatObj)">\n            <div bo-if="!chatObj.isInviteChat && !chatObj._user.isInvitedUser()">\n                <div bo-if="chatObj._user.presenceStatus == 1"\n                bo-bind="chatObj._user.firstName + \' is online\' "></div>\n                <div bo-if="chatObj._user.presenceStatus == 2"\n                bo-bind="chatObj._user.firstName + \' is busy\' "></div>\n                <div bo-if="chatObj._user.presenceStatus == 3"\n                bo-bind="chatObj._user.firstName + \' is idle\' "></div>\n                <div bo-if="chatObj._user.presenceStatus == 4  && chatObj._user.getDevice() !=2 && !chatObj._user.getHasMobile()"\n                bo-bind="chatObj._user.firstName + \' is offline\' "></div>\n                <div bo-if="(chatObj._user.presenceStatus == 4 && chatObj._user.getHasMobile())"\n                bo-date="\'Active \' + (chatObj._user.lastPingTime | dateAgo: null : true : true :true :true )"></div>\n            </div>\n            <div bo-if="chatObj.isInviteChat || chatObj._user.isInvitedUser()">Hasn\'t joined yet.&nbsp;<a bo-if="chatObj.isInviteChat" href="javascript:void(0);" bo-click="sendInvite();">Send invite.</a></div>\n        </div>\n        <div class="participantsList " bo-if="chatObj.chatType == 2 || chatService.isAdminModeONAndThisUserIsNotInChatParticipantsAndIsP2PChat(chatObj)">\n            <cnv-participant-list bindonce cnv-mouse-wheel-scroll class="cnvScrollContainerParent">\n                <div ng-repeat="userAvatar in usersAvatar"\n                    style=" vertical-align:middle;display:inline-block; font-size: 12px; margin-left: 2px;margin-top: 1px;">\n                    <cnv-user-profile-image cnv-popover cnv-popover-ctrl="userAvatar.displayName"\n                    user-id="userAvatar.userId" size="64" width="30" height="30"\n                    profile-type="userAvatar.profileImageType" full-name="userAvatar.displayName"\n                    profile-version="userAvatar.profileImageVersion">\n                    </cnv-user-profile-image>\n                    <div bo-if="!userAvatar.isInvitedUser()" style="display: inline-block;margin-left: -11px;margin-bottom: -14px;">\n                        <div bo-if="userAvatar.presenceStatus == 1  && userAvatar.getDevice() !=2"\n                        class="listUserStatusOnline"></div>\n                        <div bo-if="userAvatar.presenceStatus == 2  && userAvatar.getDevice() !=2"\n                        class="listUserStatusBusy"></div>\n                        <div bo-if="userAvatar.presenceStatus == 3  && userAvatar.getDevice() !=2"\n                        class="listUserStatusIdle"></div>\n                        <div bo-if="userAvatar.presenceStatus == 4  && userAvatar.getDevice() !=2 && !userAvatar.getHasMobile()"\n                        class="listUserStatusOffline"></div>\n                        <div bo-if="(userAvatar.getDevice() ==2) || (userAvatar.presenceStatus == 4 && userAvatar.getHasMobile())"\n                        class="listUserStatusMobile"></div>\n                    </div>\n                </div>\n                <a bo-if="participantsList.length > 7" cnv-popover cnv-popover-ctrl="participantsList | chatParticipentsTooltipText: 7 : !showingParticipantList" cnv-popover-html-already-escaped="true" bo-bind="\'+\'+(participantsList.length-7)"\n                    ng-click="showParticipantsList()" style="cursor: pointer;vertical-align: middle;">\n                </a>\n                <div class="participantList cnvScrollContainer" tabindex="0" bo-if="showingParticipantList" style="overflow-y: scroll">\n                    <div ng-repeat="user in participantsList">\n                        <div class="participantUserName" bo-bind="user.displayName">\n                        </div>\n                        <div bo-if="!user.isInvitedUser()" style="display: inline-block;">\n                            <div bo-if="user.presenceStatus == 1  && user.getDevice() !=2"\n                            class="listUserStatusOnline"></div>\n                            <div bo-if="user.presenceStatus == 2  && user.getDevice() !=2"\n                            class="listUserStatusBusy"></div>\n                            <div bo-if="user.presenceStatus == 3  && user.getDevice() !=2"\n                            class="listUserStatusIdle"></div>\n                            <div bo-if="user.presenceStatus == 4  && user.getDevice() !=2 && !user.getHasMobile()"\n                            class="listUserStatusOffline"></div>\n                            <div bo-if="(user.getDevice() ==2) || (user.presenceStatus == 4 && user.getHasMobile())"\n                            class="listUserStatusMobile aling-to-normal-status-bubble"></div>\n                        </div>\n                    </div>\n                </div>\n            </cnv-participant-list>\n        </div>\n    </div>\n    <div class="input-group" bo-if="editChatTitle" style="padding: 4px;">\n        <input type="text" class="form-control chat-rename-input" bo-click="onChatRenameInputClick();" bo-keyup="onChatInputKeyUp($event)"/>\n          <span class="input-group-btn">\n            <button class="btn btn-default btn-sx rename-done-btn  disabled" type="button" bo-click="onRenameInputDoneClick();">Done</button>\n          </span>\n    </div>\n\n</div>'),
a.put("chat/client/chatWindow/templates/chatSeenParticipants.tpl.html",'<div bindonce>\n    <div class="modal-header">\n        <h4 ng-bind="title"></h4>\n        <button type="button" class="close" ng-click="cancel()">\xd7</button>\n    </div>\n    <div class="modal-body" style="overflow-y: scroll; overflow-x: hidden;">\n        <div class="share-info-wrapper" ng-repeat="seenParticipant in seenParticipants track by $index" ng-if="seenParticipant.userId != thisUserId">\n            <span class="dp-wrapper">\n                <a bo-href="seenParticipant.userId | idToFilterUrl:\'USER\'" ng-click="cancel()">\n                    <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name"></cnv-user-profile-image>\n                </a>\n            </span>\n            <span class="details-wrapper">\n                <span>\n                    <a bo-href="seenParticipant.userId | idToFilterUrl:\'USER\'" ng-click="cancel()">\n                        <b bo-bind="seenParticipant.name | limitText:30"></b>\n                    </a>\n                </span>\n                <span bo-if="shareInfo.typ == \'USER\'">&nbsp;</span>\n            </span>\n            <hr/>\n        </div>\n    </div>\n    <!--<div class="modal-footer"></div>-->\n</div>'),a.put("chat/client/chatWindow/templates/chatWindow.tpl.html",'<div cnv-window-maximize-minimize-manager bo-id="chatId" tabindex="0" class="chatWindow" bo-show="!dntShow" bo-style="{right:xPosition, height: chatWindow.metaDetails.isMinimized ? \'28px\' : (verticalHeight ? verticalHeight + \'px\' : \'350px\'), width: chatWindow.metaDetails.isMinimized ? \'166px\' : \'302px\'}" bindonce>\n    <div class="content-resizer" cnv-window-resize-manager="vertical" resizer-bottom="{{chatId}}"></div>\n    <div cnv-chat-window-header-bar class="chatWindowHeader unfocused-state">\n        <div class="unreadCount" bo-bind="chatObj.unreadCount > 20 ? \'20+\': chatObj.unreadCount" bo-if="chatObj.unreadCount > 0 && isMinimized"></div> \n\n        <div class="namesPopover" cnv-popover cnv-popover-ctrl="participantsList | chatParticipentsTooltipText: 0 : chatObj.chatType == 2 && !showingParticipantList" style="cursor: pointer;vertical-align: middle; min-height: 100%" cnv-popover-html-already-escaped="true" >\n            <div bo-if="!isNewChat"  class="userProfileImg" bo-show="chatObj.chatType == 1 && !chatService.isAdminModeONAndThisUserIsNotInChatParticipantsAndIsP2PChat(chatObj)">\n                <cnv-user-profile-image user-id="chatObj._user.userId" width="28" height="28"\n                profile-type="chatObj._user.profileImageType" full-name="chatObj.getOtherParticipant().name"\n                profile-version="chatObj._user.profileImageVersion"></cnv-user-profile-image>\n            </div>\n            <div style="margin-left: 32px;margin-bottom: -7px;display: inline-block;" bo-if="!isNewChat && !chatObj._user.isInvitedUser() && chatObj.chatType == 1 && !chatService.isAdminModeONAndThisUserIsNotInChatParticipantsAndIsP2PChat(chatObj)">\n                <div bo-if="chatObj._user.presenceStatus == 1  && chatObj._user.getDevice() !=2"\n                class="listUserStatusOnline"></div>\n                <div bo-if="chatObj._user.presenceStatus == 2  && chatObj._user.getDevice() !=2"\n                class="listUserStatusBusy"></div>\n                <div bo-if="chatObj._user.presenceStatus == 3  && chatObj._user.getDevice() !=2"\n                class="listUserStatusIdle"></div>\n                <div bo-if="chatObj._user.presenceStatus == 4  && chatObj._user.getDevice() !=2 && !chatObj._user.getHasMobile()"\n                class="listUserStatusOffline"></div>\n                <div bo-if="(chatObj._user.getDevice() ==2) || (chatObj._user.presenceStatus == 4 && chatObj._user.getHasMobile())"\n                class="listUserStatusMobileWhite"></div>\n            </div>\n            <div bo-if="chatObj._iconVersion && chatObj._iconVersion != \'0\'" style="display: inline-block;width:28px; height: 28px; border-top-left-radius: 3px; overflow:hidden;">\n                    <img bo-src="getChatImageThumbnailPath(chatObj)" width="28px" height="28px" />    \n                </div>\n            <div bo-if="!chatObj._iconVersion || chatObj._iconVersion == \'0\'" class="group-title-img" bo-show="chatObj.chatType == 2"></div>\n            <span class="userProfileName" bo-class="{leftTitleForGrpChat : chatObj.chatType == 2 || chatIsWithInvitedUser || chatObj._user.isInvitedUser(), \'move-to-extreme-left\' : chatService.isAdminModeONAndThisUserIsNotInChatParticipantsAndIsP2PChat(chatObj) || isNewChat }"\n            bo-bind="chatService.isAdminModeONAndThisUserIsNotInChatParticipantsAndIsP2PChat(chatObj) ? getPrivateP2PChatTitle() : chatObj.getTitle()"\n             bo-style="{width: chatWindow.metaDetails.isMinimized ? \'54%\' : chatObj.chatType == 2 ? \'50%\' : isNewChat ? \'85%\' : \'46%\'}" ></span>\n        </div>\n        <div class="participantList cnvScrollContainer" tabindex="0" bo-if="showingParticipantList" style="overflow-y: scroll">\n            <div ng-repeat="user in participantsList">\n                <div class="participantUserName" bo-bind="user.displayName">\n                </div>\n                <div bo-if="!user.isInvitedUser()" style="display: inline-block;">\n                    <div bo-if="user.presenceStatus == 1  && user.getDevice() !=2"\n                    class="listUserStatusOnline"></div>\n                    <div bo-if="user.presenceStatus == 2  && user.getDevice() !=2"\n                    class="listUserStatusBusy"></div>\n                    <div bo-if="user.presenceStatus == 3  && user.getDevice() !=2"\n                    class="listUserStatusIdle"></div>\n                    <div bo-if="user.presenceStatus == 4  && user.getDevice() !=2 && !user.getHasMobile()"\n                    class="listUserStatusOffline"></div>\n                    <div bo-if="(user.getDevice() ==2) || (user.presenceStatus == 4 && user.getHasMobile())"\n                    class="listUserStatusMobile aling-to-normal-status-bubble"></div>\n                </div>\n            </div>\n        </div>\n        <a bo-if="!isNewChat" class="btnExpand" bo-href="fullChatViewUrl" bo-attr bo-attr-target="fullChatViewTarget" bo-mouseup="openChatInFullView()" bo-show="!isMinimized && !chatWindow.metaDetails.isMinimized">\n            <i class="headerIcon cnv-icons-16 chat-window-expand-white" ></i>\n            <i class="headerIcon cnv-icons-16 chat-window-expand-gray-hover"></i>\n        </a>\n\n        <div class="btnStartVideoCall" bo-if="!isNewChat && !chatIsWithInvitedUser" ng-mousedown="showVideoCallOptions()" bo-show="!isMinimized && !chatWindow.metaDetails.isMinimized">\n            <i class="headerIcon cnv-icons-20 chat-window-video-white"></i>\n            <i class="headerIcon cnv-icons-20 chat-window-video-gray-hover"></i>\n        </div>\n        <cnv-video-call-options-in-chat bo-if="showVidCallDropdown" class="vidCallOptionsDropdown" bo-show="!isMinimized && !chatWindow.metaDetails.isMinimized"></cnv-video-call-options-in-chat>\n\n        <div bo-if="!isNewChat" class="addToChat" ng-click="showUserList()" bo-show="!isMinimized && !chatWindow.metaDetails.isMinimized">\n            <i class="headerIcon cnv-icons-20 chat-window-plus-white"></i>\n            <i class="headerIcon cnv-icons-20 chat-window-plus-gray-hover"></i>\n        </div>\n        <cnv-add-user-in-chat bo-if="showUserListToAdd"  class="cnvScrollContainerParent addParticipantList" cnv-mouse-wheel-scroll bindonce bo-show="!isMinimized && !chatWindow.metaDetails.isMinimized">\n            <div class="userSearchBarContainer">\n                <input class="userSearchBar" ng-keydown="userSearchBarKeyDown($event)"/>\n                <div class="searchChatIcon"></div>\n            </div>\n            <div class="addUserList cnvScrollContainer" style="overflow-y: scroll;">\n                <div ng-repeat="user in users | limitTo : addListShowingUsers" ng-mousedown="inviteThisUserToChat(user)"\n                    bo-class="{selected : $index == addUserSelectedIndex }" class="addParticipantItem" ng-mouseover="mouseOnItem($index)">\n                    <div bo-if="!user.isInvitedUser()" style="display: inline-block;position: relative;top: -2px;">\n                        <div bo-if="user.presenceStatus == 1  && user.getDevice() !=2" class="listUserStatusOnline"></div>\n                        <div bo-if="user.presenceStatus == 2  && user.getDevice() !=2" class="listUserStatusBusy"></div>\n                        <div bo-if="user.presenceStatus == 3  && user.getDevice() !=2" class="listUserStatusIdle"></div>\n                        <div bo-if="user.presenceStatus == 4  && user.getDevice() !=2 && !user.getHasMobile()"\n                        class="listUserStatusOffline"></div>\n                        <div bo-if="(user.getDevice() ==2) || (user.presenceStatus == 4 && user.getHasMobile())"\n                        class="listUserStatusMobile aling-to-normal-status-bubble"></div>\n                    </div>\n                    <div class="addListUserName" bo-bind="user.getDisplayName()">\n                    </div>\n                </div>\n            </div>\n        </cnv-add-user-in-chat>\n        <div class="btnChatOptions" bo-if="!isNewChat" bo-show="!isMinimized && !chatWindow.metaDetails.isMinimized">\n            <i class="headerIcon cnv-icons-20 chat_settings_white"></i>\n            <i class="headerIcon cnv-icons-20 chat_settings"></i>\n            <cnv-dropdowns cnv-dropdown-ctrl="chatOptions" ng-disabled="disabledChat && !canShareChat()" style="top: 4px;bottom: 0;position: absolute;">\n            </cnv-dropdowns>\n        </div>    \n        \n        \n        <!-- <div class="btnMinimize" bo-show="!isMinimized && !chatWindow.metaDetails.isMinimized"></div> -->\n        <div class="btnClose" bo-mousedown="closeChatWindow($event);">\n            <i class="headerIcon cnv-icons-20 chat-window-cancel-white"></i>\n            <i class="headerIcon cnv-icons-20 chat-window-cancel-gray-hover"></i>\n        </div>\n    </div>\n    <!-- Window ActionBar -->\n    <cnv-chat-action-bar bo-if="!isNewChat && (!isSearch || !chatObj.searchInfo.isTextSearch)" bo-show="!chatWindow.metaDetails.isMinimized"></cnv-chat-action-bar>\n    <!-- Window Search Match Bar -->\n    <div class="chatActionBar" bo-if="isSearch && chatObj.searchInfo.isTextSearch">\n        <div class="searchcountandtext"\n            style="margin: 8px 0px 1px 10px;height: 30px;padding: 3px;  width: 265px;display: inline-block;">\n            <div style="display: inline-block;text-overflow: ellipsis;white-space: nowrap;width: 55%;overflow: hidden;"\n            bo-bind="chatObj.searchInfo.searchText"></div>\n            <div class="dropdownBtn" style="float: right;margin-right: 2px;margin-top: 1px;"\n            ng-click="moveToNextSearch(false)" ng-disabled="disableChatSearchControls"></div>\n            <div class="dropdownBtn"\n                style="float: right;-ms-transform: rotate(180deg);-webkit-transform: rotate(180deg);transform: rotate(180deg);margin-top: 1px;margin-right: 4px;"\n            ng-click="moveToNextSearch(true)" ng-disabled="disableChatSearchControls"></div>\n            <div style="display: inline-block;float: right;  margin-right: 10px;color: #7b8386;"\n            bo-bind="searchCountStr"></div>\n        </div>\n        <div class="closeSettingsButton" style="margin-top: 12px; margin-right: 8px;height: 13px;width: 13px;"\n        ng-click="closeSearch()" ng-disabled="disableChatSearchControls"></div>\n    </div>\n    <!-- new chat user input -->\n    <cnv-new-chat-window-users-input bo-if="isNewChat" class="new-chat-window-users-input"></cnv-new-chat-window-users-input>\n    <div bo-if="isNewChat && showCreateNewChatLink" class="create-new-chat-in-window-link" bo-click="explicitlyCreateNewChat()">Create new chat</div>\n    <!-- Message List Window -->\n    <div style="width:100%; height:100%; overflow:hidden;flex: 1;-webkit-flex: 1;position:relative"> \n        <div bo-id="msgWinId"\n            bo-show="!chatWindow.metaDetails.isMinimized"\n            class="chatMessageWindow"\n            cnv-upload-files-ui-manager\n            cnv-upload-files-ui-manager-ctrl="filesUploadManagerCtrl"\n            cnv-insert-add-item-options-ctrl="insertOptionsCtrl"\n            ng-include="\'chat/client/chatWindow/templates/messageList.tpl.html\'"\n            style="overflow-y: scroll;"\n            auto-hiding-scroll-bar>\n        </div>\n        <div class="scroll-bar-cover-bar"></div>\n    </div>\n    <cnv-dropzone bo-show="!disabledChat && !chatIsWithInvitedUser" dropzone-id="{{\'_\' + msgWinId}}"></cnv-dropzone>\n    <!--Write Message Field-->\n    <div class="messageInputContainer" bo-show="!chatWindow.metaDetails.isMinimized">\n        <div class="newMsgReceived" ng-click="showNewMessagesReceived()">\n            <span style="font-size: 14px;margin-left: 5px;color: white;position: absolute;top: 5px;left: 2px;">New Message</span>\n            <div class="newMessageIcon"></div>\n        </div> \n        <div class="messageInputBar" ng-class="(!showGiphy)?\'giphyDisabled\':\'giphyEnabled\'">\n            <div style="width: 76%; display: inline-block;  padding-top: 4px; position: relative;">\n                <cnv-editor cnv-text-editor-mode="minimal"\n                cnv-text-editor-ctrl="textEditorCtrl"\n                cnv-text-editor-on-focus-out="onFocusOut(event)"\n                cnv-at-mentions="getCommandsWithDropdownItems($query, delimiter)"\n                cnv-on-command-executed="OnCommandExecuted(item, search)"\n                cnv-at-mentions-suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html"\n                cnv-text-editor-on-esc-key-press="onEscKeyPressInTextEditor()"\n                cnv-text-editor-submit-on-enter="onTextEditorSubmitOnEnter()"\n                cnv-focus-on-load="false"\n                cnv-editor-source="Chat"\n                            cnv-text-editor-on-space-key-press="onSpaceKeyPressInTextEditor()">\n                </cnv-editor>\n                <div class="scrollHider" bo-show="!disabledChat"></div>\n            </div>\n\n            <cnv-emoji-popover cnv-editor-name="editorCtrl" cnv-emoji-fixed-on-scroll= "true" class="attachmentButton emoji"></cnv-emoji-popover>\n            <cnv-giphy-popover bo-if="showGiphy" ng-disabled="chatIsWithInvitedUser || newChatIsEmpty" cnv-chat-window-id="chatId" cnv-file-context="fileInputContext" cnv-giphy-information="giphyObject" cnv-giphy-icon-class="attachmentButton giphy" cnv-giphy-mixpanel-info="Chat" cnv-giphy-relative-to-body="true" cnv-giphy-relative-to-body-override="false"></cnv-giphy-popover>\n            <div ng-disabled="chatIsWithInvitedUser || newChatIsEmpty" class="attachmentButton photo icons2_Attach-darkgray" ng-click=\'onAttachFileBtnClick()\'></div>\n'+"            <input ng-disabled=\"chatIsWithInvitedUser || newChatIsEmpty\" name='file' id=\"chatAttachment\" class='inputHide' type='file' multiple='multiple'></input>\n        </div>\n    </div>\n</div>"),a.put("chat/client/chatWindow/templates/cnvVideoCallOptionsInChat.tpl.html",'<div class="video-call-dropdown" bindonce>\n    <span class="header">Start a video call</span>\n    \n    <div class="option" ng-click="startAppearin()">\n        <i class="appearin cnv-icons-20" style="margin-top: 2px;">\n        </i>\n        <div class="vid-call-details">\n    		<span class="header-txt">\n				Appear.in\n			</span>\n			<span class="meta-txt">\n				Supports up to 8 participants. Also available on mobile with Appear.in for iOS & Android.\n			</span>\n		</div>\n	</div>\n</div>'),a.put("chat/client/chatWindow/templates/messageList.tpl.html",'<div class="spinner-container" bo-show="messageListSpinner" style="margin-top:-10px">\n    <i class="cnv-circle-spinner-small"></i>\n</div>\n<div bo-if="chatObject.isInviteChat || chatObject._user.isInvitedUser()" class="non-network-user-chat-message">\n    <span bo-bind="inviteMessage"></span>\n</div>\n<div bo-repeat="message in getChatMessages()" class="chat-message-bubble" style="clear:both;">\n    <div bo-if="message._view.showLoadMoreMessages" class="loadMoreMessageBar"\n        bo-click="loadMoreMessages(message._view.fromSeqNo,message._view.toSeqNo)" style="clear:both">\n        <span style="color: #ffffff;margin-left: 4px;">Load more messages</span>\n        <div class="loadMoreMessageImg"></div>\n    </div>\n    <!-- Other User message Template with Profile-image -->\n    <div bo-if="message._view.otherUserWithImg == 1 && !message.fileInfo.fileId" bo-class="{\'extraBubblePadding\': message._view.addBubblePadding}" class="messageFromOtherUserWithImg">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator">\n            <span bo-bind="message._view.dateToShow"></span>\n        </div>\n        <div style="font-size: 12px;width: 100%;margin-bottom: 2px; margin-top:8px;margin-left: 49px;width: 180px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;color: #7b8386; clear:both"\n            bo-if="chatObject.chatType == 2 && message._view.showUserName == 1 "\n            bo-bind="message._view._user.displayName">\n        </div>\n        <div class="chat-other-user-image-container">\n            <cnv-user-profile-image user-id="message._view._user.userId" width="30" height="30"\n            profile-type="message._view._user.profileImageType"\n            full-name="message._view._user.displayName"\n            profile-version="message._view._user.profileImageVersion"\n            style="margin-left: 5px;margin-top: 2px;margin-right: 5px;float: left;position:absolute; bottom:0;left: 0px;">\n            </cnv-user-profile-image>\n            <div class="messageFromOtherUser" style="padding: 4px 7px;margin-left: 42px;" bo-class="{\'highlight highlightedOther\': isSearch && chatObject.searchInfo.isCurrentMatch(message), \'noBackground\': message._view.isSingleEmoji}">\n                <span bo-html="message._view.messageText" class="chat-msg-cont" style="white-space: pre-wrap;"></span>\n                <div style="font-size: 12px;color: #7b8386;font-weight: 100;" class="notSelectable"\n                    bo-bind="message._view.time">\n                </div>\n            </div>\n        </div>\n        <div bo-if="message._view.seen.seenParticipant && chatObject.chatType == 1" class="seen">\n            <cnv-user-profile-image user-id="message._view.seen.seenParticipant.userId" full-name="message._view.seen.seenParticipant.name" width="15" height="15">\n            </cnv-user-profile-image>\n        </div>\n        <div bo-if="message._view.groupSeen.seenParticipants.length > 0 && chatObject.chatType == 2" class="seen other-user-message-seen">\n            <span bo-repeat="seenParticipant in message._view.groupSeen.seenParticipants | limitTo:14" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" width="15" height="15">\n                </cnv-user-profile-image>\n            </span>\n            <span class="group-chat-seen-more-counter" bo-if="message._view.groupSeen.moreParticipantsCount" cnv-popover cnv-popover-ctrl="message._view.groupSeen.seenParticipants | chatParticipentsTooltipText: 14: true" cnv-popover-html-already-escaped="true" bo-click="openSeenNotificationDialog(message._view.groupSeen.seenParticipants);">\n                <span class="seen-counter" bo-bind="message._view.groupSeen.moreParticipantsCount"></span>\n            </span>\n        </div>\n    </div>\n    <!-- Other User message Template without Profile-image -->\n    <div bo-if="message._view.otherUserWithoutImg == 1 && !message.fileInfo.fileId" style="margin-left: 38px;" bo-class="{\'extraBubblePadding\': message._view.addBubblePadding}">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator" style="margin-left: -18px;">\n            <span bo-bind="message._view.dateToShow" style="white-space: pre-wrap;"></span>\n        </div>\n        <div style="font-size: 12px;width: 100%;margin-bottom: 2px; margin-top:8px;margin-left: 10px;width: 180px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;color: #7b8386; clear:both"\n            bo-if="chatObject.chatType == 2 && message._view.showUserName == 1"\n            bo-bind="message._view._user.displayName">\n        </div>\n        <div class="messageFromOtherUserWithoutImg" style="padding: 4px 7px;" bo-class="{\'highlight highlightedOther\': isSearch && chatObject.searchInfo.isCurrentMatch(message), \'noBackground\': message._view.isSingleEmoji}">\n            <span bo-html="message._view.messageText" class="chat-msg-cont" style="white-space: pre-wrap;"></span>\n            <div style="font-size: 12px;color: #7b8386;font-weight: 100;" class="notSelectable"\n                bo-bind="message._view.time">\n            </div>\n        </div>\n        <div bo-if="message._view.seen && message._view.seen.seenParticipant && chatObject.chatType == 1" class="seen">\n            <cnv-user-profile-image user-id="message._view.seen.seenParticipant.userId" full-name="message._view.seen.seenParticipant.name" width="15" height="15">\n            </cnv-user-profile-image>\n        </div>\n        <div bo-if="message._view.groupSeen.seenParticipants.length > 0 && chatObject.chatType == 2"  class="seen other-user-message-seen">\n            <span bo-repeat="seenParticipant in message._view.groupSeen.seenParticipants | limitTo:14" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" width="15" height="15">\n                </cnv-user-profile-image>\n            </span>\n            <span class="group-chat-seen-more-counter" bo-if="message._view.groupSeen.moreParticipantsCount" cnv-popover cnv-popover-ctrl="message._view.groupSeen.seenParticipants | chatParticipentsTooltipText: 14: true" cnv-popover-html-already-escaped="true" bo-click="openSeenNotificationDialog(message._view.groupSeen.seenParticipants);">\n                <span class="seen-counter" bo-bind="message._view.groupSeen.moreParticipantsCount"></span>\n            </span>\n        </div>\n    </div>\n    <!-- This User message Template without Profile-image -->\n    <div bo-if="message._view.thisUserWithoutImg == 1 && !message.fileInfo" bo-class="{\'extraBubblePadding\': message._view.addBubblePadding}">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator">\n            <span bo-bind="message._view.dateToShow" style="white-space: pre-wrap;"></span>\n        </div>\n        <div bo-if="!message.isFakeMessage && message._sequenceNumber == 0 && !message.isRetrying"\n            style="float: right;margin-right: 10px;color: #df0000;margin-top: 8px;">\n            <div class="glyphicon glyphicon-warning-sign"></div>\n        </div>\n        <div class="messageFromMe" bo-class="{\'highlight highlightedMe\': isSearch && chatObject.searchInfo.isCurrentMatch(message), \'messageFromMeAckn\': message.isFakeMessage || message._sequenceNumber > 0, \'noBackground\': message._view.isSingleEmoji}"\n            style="padding: 4px 7px;">\n            <span bo-html="message._view.messageText" class="chat-msg-cont" style="white-space: pre-wrap;"></span>\n            <div style="font-size: 12px;color: #ffffff;font-weight: 100;" class="notSelectable"\n                bo-bind="message._view.time">\n            </div>\n        </div>\n        <div bo-if="!message.isFakeMessage && message._sequenceNumber == 0 && !message.isRetrying"\n            style="float: left;right: 6px;font-size: 14px;color: #df0000;text-align: right;width: 97%;">\n            <div>\n                Not delivered.<a href="javascript:void(0);" style="color: #df0000;text-decoration: underline;" bo-click="resendMessage(message)">Try Again.</a>\n            </div>\n        </div>\n        <div bo-if="message._view.seen && message._view.seen.seenParticipant && chatObject.chatType == 1" class="seen">\n            <cnv-user-profile-image user-id="message._view.seen.seenParticipant.userId" full-name="message._view.seen.seenParticipant.name" width="15" height="15">\n            </cnv-user-profile-image>\n        </div>\n        <div bo-if="message._view.groupSeen.seenParticipants.length > 0 && chatObject.chatType == 2" class="seen">\n            <span bo-repeat="seenParticipant in message._view.groupSeen.seenParticipants | limitTo:14" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" width="15" height="15">\n                </cnv-user-profile-image>\n            </span>\n            <span class="group-chat-seen-more-counter" bo-if="message._view.groupSeen.moreParticipantsCount" cnv-popover cnv-popover-ctrl="message._view.groupSeen.seenParticipants | chatParticipentsTooltipText: 14: true" cnv-popover-html-already-escaped="true" bo-click="openSeenNotificationDialog(message._view.groupSeen.seenParticipants);">\n                <span class="seen-counter" bo-bind="message._view.groupSeen.moreParticipantsCount"></span>\n            </span>\n        </div>\n    </div>\n    <!-- Left Message -->\n    <div bo-if="message._view.left == 1">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator">\n            <span bo-bind="message._view.dateToShow"></span>\n        </div>\n        <div class="invite-left-msg">\n            <span bo-bind="message._view.messageToDisplay" style="white-space: pre-wrap;"></span>\n        </div>\n    </div>\n    <!-- Invite Message -->\n    <div bo-if="message._view.invite == 1">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator">\n            <span bo-bind="message._view.dateToShow"></span>\n        </div>\n        <div class="invite-left-msg">\n            <span bo-bind="message._view.messageToDisplay" style="white-space: pre-wrap;"></span>\n        </div>\n    </div>\n    <!-- Any System Message -->\n    <div bo-if="message._view.isSystemMessage == 1">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator">\n            <span bo-bind="message._view.dateToShow"></span>\n        </div>\n        <div class="system-chat-msg">\n            <span bo-html="message._view.messageToDisplay" style="white-space: pre-wrap;"></span>\n        </div>\n    </div>\n    <!-- This user File/Image Template without Profile-image (for sending file) -->\n    <div bo-if="message.fileInfo.file && message._view.thisUserWithoutImg == 1 && !message.fileInfo.fileId">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator">\n            <span bo-bind="message._view.dateToShow"></span>\n        </div>\n        <div class="messageFromMe" bo-class="{\'messageFromMeAckn\': message._sequenceNumber > 0, \'extraBubblePadding\': message._view.addBubblePadding, \'highlight highlightedThisUserFile\': isSearch && chatObject.searchInfo.isCurrentMatch(message)}" style="background:none;" >\n            <div cnv-upload-file-ui class=\'attachment-box\' cnv-popover cnv-popover-ctrl="file.name" style="border: 1px solid #eee;border-bottom: none;border-top-left-radius: 4px;border-top-right-radius: 4px;overflow: hidden;">\n                <div cnv-popover cnv-popover-ctrl="file.name" class="attachment-box-background" ></div>\n                <img ng-src="{{file.localUrl}}" ng-class="{\'file-converted\': completed()}"\n                onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"/>\n                <div class="upload-state-message failed-upload" ng-if="failed()">\n                    <div class="upload-failed-icon"></div>\n                    <div>\n                        <span class="text">Couldn\'t upload this file.</span>\n                        <span class="action" ng-if="file.retryAllowed" href ng-mousedown="retry()">Retry</span>\n                    </div>\n                </div>\n                <span ng-if="!file.noTitle && !failed()" class="fileNames" style="padding-top: 0px">{{file.name}}</span>\n                <div ng-show="isInProgress()" class=\'progress-bar\'>\n                    <div class="bar-internal"><div class="cnv-spinner" style="display:block; margin-top:12px"></div></div>\n                    <div class="progress-line" ng-style="{width: file.progress+\'%\'}"></div>\n                </div>\n                <div ng-click="remove()" class="remove-file" bo-if="!file.fileUploaded"></div>\n            </div>\n            <div style="font-size: 12px;color: #aaa;font-weight: 100;padding: 1px 5px;border: 1px solid #eee;border-top: none;border-bottom-left-radius: 4px;border-bottom-right-radius: 4px;" class="notSelectable"\n                bo-bind="message._view.time">\n            </div>\n        </div>\n        <div bo-if="message._view.seen && message._view.seen.seenParticipant && chatObject.chatType == 1" class="seen">\n            <cnv-user-profile-image user-id="message._view.seen.seenParticipant.userId" full-name="message._view.seen.seenParticipant.name" width="15" height="15">\n            </cnv-user-profile-image>\n        </div>\n    </div>\n    <!-- This user File/Image Template without Profile-image (for sent file) -->\n    <div bo-if="message._view.thisUserWithoutImg == 1 && message.fileInfo.fileId"  class="bubbleWithFile">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator">\n            <span bo-bind="message._view.dateToShow"></span>\n        </div>\n        <div class="messageFromMe" bo-class="{ \'messageFromMeAckn\': message._sequenceNumber > 0, \'extraBubblePadding\': message._view.addBubblePadding, \'highlight highlightedThisUserFile\': isSearch && chatObject.searchInfo.isCurrentMatch(message)}"  style="background:none;">\n            <span bo-class=\'{"top-72": message._view.showDate == 1}\' class="download-icon ico cnv-icons-20 icons2_Download-darkgray move-left" ng-click="downloadFile(message.fileInfo.originalName, message.fileInfo.name);" title="Download" bo-style="{\'right\':message.fileInfo.fileWidth}"></span>\n            <a bo-href="message.fileInfo.fileId |getFileResourceLinkUrl :message.fileInfo.fileFormat:\'6\':\'6\':chatObject.chatId:message.fileInfo.name:\'21\'">\n                <div bo-if="message.fileInfo.fileFormat!=\'VIDEO\' && message.fileInfo.fileFormat!=\'OTHER\' && message.fileInfo.thumbnail_name"\n                    style="vertical-align: middle;background-color: white;text-align: center;cursor: pointer; border: 1px solid #eee;border-bottom: none; border-top-left-radius: 4px;border-top-right-radius: 4px;overflow: hidden;"\n                    bo-style="{\'height\':message.fileInfo.fileHeight, \'line-height\': message.fileInfo.fileHeight, \'width\':message.fileInfo.fileWidth}">\n                    <i bo-if="message.fileInfo.type == \'GIF\'" class="gif-badge">GIF</i>\n                    <i bo-if="message.fileInfo.type == \'GIF\'" class="cnv-spinner"></i>\n                    <img bo-if="message.fileInfo.type == \'GIF\'" class="original-gif" cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                    onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                    ng-src="{{message.fileInfo.originalName | getOriginalImagePath: chatObject.chatId}}"\n                    style="display: none; vertical-align: baseline;max-width: 200px;max-height: 200px;"/>\n                    <!-- gif placeholder in case of type = gif -->\n                    <img bo-class="{\'gif-placeholder\': message.fileInfo.type == \'GIF\'}" cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                    onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                    ng-src="{{message.fileInfo | getNoteThumbnailPath: chatObject.chatId}}"\n                    style="vertical-align: baseline;max-width: 200px;max-height: 200px;"/>\n                </div>\n                <div bo-if="message.fileInfo.fileFormat==\'VIDEO\'" class=\'video{{::message.fileInfo.fileId}}\'\n                    style="vertical-align: middle;background-color: white;text-align: center;width: 155px;height: 100px;border: 1px solid #eee;margin-bottom: 0;border-bottom: 0;border-top-left-radius: 4px;border-top-right-radius: 4px;cursor: pointer;overflow: hidden;">\n                    <cnv-video-thumbnail  cnv-video-thumbnail-data-format="CHAT" cnv-video-thumbnail-lazy-load="true"  cnv-video-thumbnail-file=\'message.fileInfo\' cnv-video-thumbnail-show-preview="true" cnv-video-thumbnail-lazy-load-id="{{::message.fileInfo.fileId}}"></cnv-video-thumbnail>\n                </div>\n                <div class="file-thumb-cont" bo-class="{\'audio\': message.fileInfo.isAudio}"\n                       style="position: relative; height: 100px;  width: 180px;background-color: white;text-align: center;text-align: center;cursor: pointer; border: 1px solid #eee;border-bottom: none;border-top-left-radius: 4px;border-top-right-radius: 4px;"\n                       bo-if="message.fileInfo.fileFormat!=\'VIDEO\' &&  (message.fileInfo.fileFormat==\'OTHER\' || !message.fileInfo.thumbnail_name)">\n                    <img cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                    onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                    ng-src="{{message.fileInfo.type | getFileIconByType: 32}}"\n                    style="margin-top: 30px; width: 32px; height: 32px;"/>\n                    <br>\n                    <span bo-if="!message.fileInfo.isAudio" class="fileNames" ng-bind="message.fileInfo.getName()"></span>\n                    <div bo-if="message.fileInfo.isAudio" class="file-detail-tab">\n                        <i class="ext_holder cnv-small-file-ico" bo-class="message.fileInfo.fileExt">\n                            <span bo-bind="message.fileInfo.fileExt" class="fileExt"></span>\n                        </i>\n                        <span bo-bind="message.fileInfo.name" class="filename"></span>\n                    </div>\n                </div>\n            </a>\n            <div style="font-size: 12px;color: #aaa;font-weight: 100; padding: 1px 5px;border: 1px solid #eee;border-top: none;border-bottom-left-radius: 4px;border-bottom-right-radius: 4px;" class="notSelectable"\n                bo-bind="message._view.time">\n            </div>\n        </div>\n        <div bo-if="message._view.seen && message._view.seen.seenParticipant && chatObject.chatType == 1" class="seen">\n            <cnv-user-profile-image user-id="message._view.seen.seenParticipant.userId" full-name="message._view.seen.seenParticipant.name" width="15" height="15">\n            </cnv-user-profile-image>\n        </div>\n        <div bo-if="message._view.groupSeen.seenParticipants.length > 0 && chatObject.chatType == 2" class="seen">\n            <span bo-repeat="seenParticipant in message._view.groupSeen.seenParticipants | limitTo:14" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" width="15" height="15">\n                </cnv-user-profile-image>\n            </span>\n            <span class="group-chat-seen-more-counter" bo-if="message._view.groupSeen.moreParticipantsCount" cnv-popover cnv-popover-ctrl="message._view.groupSeen.seenParticipants | chatParticipentsTooltipText: 14: true" cnv-popover-html-already-escaped="true" bo-click="openSeenNotificationDialog(message._view.groupSeen.seenParticipants);">\n                <span class="seen-counter" bo-bind="message._view.groupSeen.moreParticipantsCount"></span>\n            </span>\n        </div>\n    </div>\n    <!-- Other user File/Image Template with Profile-image (for receiving file) -->\n    <div bo-if="message._view.otherUserWithImg == 1 && message.fileInfo.fileId"  class="bubbleWithFile messageFromOtherUserWithImg"  bo-class="{ \'extraBubblePadding\': message._view.addBubblePadding}">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator" >\n            <span bo-bind="message._view.dateToShow"></span>\n        </div>\n        <div style="font-size: 12px;width: 100%;margin-bottom: 2px; margin-top:8px;margin-left: 49px;width: 180px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;color: #7b8386;"\n            bo-if="chatObject.chatType == 2 && message._view.showUserName == 1 "\n        bo-bind="message._view._user.displayName"></div>\n        <div class="chat-other-user-image-container">\n            <cnv-user-profile-image user-id="message._view._user.userId" width="30" height="30"\n            profileType="message._view._user.profileImageType"\n            profileVersion="message._view._user.profileImageVersion"\n            style="margin-left: 5px;margin-top: 2px;margin-right: 5px;float: left;position:absolute; bottom:0;left: 0px;">\n            </cnv-user-profile-image>\n            <div style="margin-left: 42px; background:none; float:left; position:relative" bo-class="{\'highlight highlightedOtherUserFile\': isSearch && chatObject.searchInfo.isCurrentMatch(message)}">\n                <a bo-href="message.fileInfo.fileId |getFileResourceLinkUrl :message.fileInfo.fileFormat:\'6\':\'6\':chatObject.chatId:message.fileInfo.name:\'21\'">\n                    <div bo-if="message.fileInfo.fileFormat!=\'VIDEO\' && message.fileInfo.fileFormat != \'OTHER\' && message.fileInfo.thumbnail_name"\n                        style="vertical-align: middle;background-color: white;text-align: center;cursor: pointer;border: 1px solid #eee;border-bottom: none; border-top-left-radius: 4px;border-top-right-radius: 4px;overflow: hidden;" bo-style="{\'height\':message.fileInfo.fileHeight, \'line-height\': message.fileInfo.fileHeight, \'width\':message.fileInfo.fileWidth}">\n                        <i bo-if="message.fileInfo.type == \'GIF\'" class="gif-badge">GIF</i>\n                        <i bo-if="message.fileInfo.type == \'GIF\'" class="cnv-spinner"></i>\n                        <img bo-if="message.fileInfo.type == \'GIF\'" class="original-gif" cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                        onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                        ng-src="{{message.fileInfo.originalName | getOriginalImagePath: chatObject.chatId}}"\n                        style="display: none; vertical-align: baseline;max-width: 200px;max-height: 200px;"/>\n                        <!-- gif placeholder in case of type = gif -->\n                        <img bo-class="{\'gif-placeholder\': message.fileInfo.type == \'GIF\'}" cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                        onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                        ng-src="{{message.fileInfo | getNoteThumbnailPath: chatObject.chatId}}"\n                        style="vertical-align: baseline;max-width: 200px;max-height: 200px;"/>\n                    </div>\n                    <div bo-if=" message.fileInfo.fileFormat==\'VIDEO\'" class=\'video{{::message.fileInfo.fileId}}\'\n                        style="vertical-align: middle;background-color: white;text-align: center;width: 155px;height: 100px;border: 1px solid #eee;margin-bottom: 0;border-bottom: 0;border-top-left-radius: 4px;border-top-right-radius: 4px;cursor: pointer;overflow: hidden;">\n                        <cnv-video-thumbnail  cnv-video-thumbnail-data-format="CHAT" cnv-video-thumbnail-lazy-load="true"  cnv-video-thumbnail-file=\'message.fileInfo\' cnv-video-thumbnail-show-preview="true" cnv-video-thumbnail-lazy-load-id="{{::message.fileInfo.fileId}}"></cnv-video-thumbnail>\n                    </div>\n                    <div class="file-thumb-cont" bo-class="{\'audio\': message.fileInfo.isAudio}"\n                           style="position: relative; height: 100px;  width: 180px;background-color: white;text-align: center;text-align: center;cursor: pointer; border: 1px solid #eee;border-bottom: none;border-top-left-radius: 4px;border-top-right-radius: 4px;"\n                           bo-if="message.fileInfo.fileFormat!=\'VIDEO\' && (message.fileInfo.fileFormat==\'OTHER\' || !message.fileInfo.thumbnail_name)">\n                        <img cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                        onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                        ng-src="{{message.fileInfo.type | getFileIconByType: 32}}"\n                        style="margin-top: 30px; width: 32px; height: 32px;"/>\n                        <br>\n                        <span bo-if="!message.fileInfo.isAudio" class="fileNames" ng-bind="message.fileInfo.getName()"></span>\n                        <div bo-if="message.fileInfo.isAudio" class="file-detail-tab">\n                            <i class="ext_holder cnv-small-file-ico" bo-class="message.fileInfo.fileExt">\n                                <span bo-bind="message.fileInfo.fileExt" class="fileExt"></span>\n                            </i>\n                            <span bo-bind="message.fileInfo.name" class="filename"></span>\n                        </div>\n                    </div>\n                </a>\n                <div style="font-size: 12px;color: #aaa;font-weight: 100;border: 1px solid #eee;border-top: 0;padding: 1px 5px 1px;border-bottom-left-radius: 4px;border-bottom-right-radius: 4px;" class="notSelectable"\n                    bo-bind="message._view.time">\n                </div>\n                <span bo-class=\'{"top-72": message._view.showDate == 1}\' class="download-icon ico cnv-icons-20 icons2_Download-darkgray move-right" ng-click="downloadFile(message.fileInfo.originalName, message.fileInfo.name);" title="Download"  bo-style="{\'left\':message.fileInfo.fileWidth}"></span>\n            </div>\n        </div>\n        <div bo-if="message._view.seen && message._view.seen.seenParticipant && chatObject.chatType == 1" class="seen">\n            <cnv-user-profile-image user-id="message._view.seen.seenParticipant.userId" full-name="message._view.seen.seenParticipant.name" width="15" height="15">\n            </cnv-user-profile-image>\n        </div>\n        <div bo-if="message._view.groupSeen.seenParticipants.length > 0 && chatObject.chatType == 2" class="seen">\n            <span bo-repeat="seenParticipant in message._view.groupSeen.seenParticipants | limitTo:14" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" width="15" height="15">\n                </cnv-user-profile-image>\n            </span>\n            <span class="group-chat-seen-more-counter" bo-if="message._view.groupSeen.moreParticipantsCount" cnv-popover cnv-popover-ctrl="message._view.groupSeen.seenParticipants | chatParticipentsTooltipText: 14: true" cnv-popover-html-already-escaped="true" bo-click="openSeenNotificationDialog(message._view.groupSeen.seenParticipants);">\n                <span class="seen-counter" bo-bind="message._view.groupSeen.moreParticipantsCount"></span>\n            </span>\n        </div>\n    </div>\n    <!-- Other user File/Image Template without Profile-image (for receiving file) -->\n    <div bo-if="message._view.otherUserWithoutImg == 1 && message.fileInfo.fileId" style="margin-left:38px;"   class="bubbleWithFile"  bo-class="{ \'extraBubblePadding\': message._view.addBubblePadding}">\n        <div bo-if="message._view.showDate == 1" class="dateChatSeparator"  style="margin-left: -18px;">\n            <span bo-bind="message._view.dateToShow" style="white-space: pre-wrap;"></span>\n        </div>\n        <div style="font-size:12px;width: 100%;margin-bottom:2px; margin-top:8px;margin-left: 10px;width: 180px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;color: #7b8386; clear:both"\n            bo-if="chatObject.chatType == 2 && message._view.showUserName == 1"\n            bo-bind="message._view._user.displayName">\n        </div>\n        <div class="messageFromOtherUserWithoutImg" style="background:none; position:relative" bo-class="{\'highlight highlightedOtherUserFile\': isSearch && chatObject.searchInfo.isCurrentMatch(message)}">\n            <a bo-href="message.fileInfo.fileId |getFileResourceLinkUrl :message.fileInfo.fileFormat:\'6\':\'6\':chatObject.chatId:message.fileInfo.name:\'21\'">\n                <div bo-if="message.fileInfo.fileFormat!=\'VIDEO\' && message.fileInfo.fileFormat!=\'OTHER\' && message.fileInfo.thumbnail_name"\n                    style="vertical-align: middle;background-color: white;text-align: center;cursor: pointer;border: 1px solid #eee;border-bottom: none; border-top-left-radius: 4px;border-top-right-radius: 4px;overflow: hidden;" bo-style="{\'height\':message.fileInfo.fileHeight, \'line-height\': message.fileInfo.fileHeight, \'width\':message.fileInfo.fileWidth}">\n                    <i bo-if="message.fileInfo.type == \'GIF\'" class="gif-badge">GIF</i>\n                    <i bo-if="message.fileInfo.type == \'GIF\'" class="cnv-spinner"></i>\n                    <img bo-if="message.fileInfo.type == \'GIF\'" class="original-gif" cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                    onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                    ng-src="{{message.fileInfo.originalName | getOriginalImagePath: chatObject.chatId}}"\n                    style="display: none; vertical-align: baseline;max-width: 200px;max-height: 200px;"/>\n                    <!-- gif placeholder in case of type = gif -->\n                    <img bo-class="{\'gif-placeholder\': message.fileInfo.type == \'GIF\'}" cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                    onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                    ng-src="{{message.fileInfo | getNoteThumbnailPath: chatObject.chatId}}"\n                    style="vertical-align: baseline;max-width: 200px;max-height: 200px;"/>\n                </div>\n                <div bo-if="message.fileInfo.fileFormat==\'VIDEO\'" class=\'video{{::message.fileInfo.fileId}}\'\n                    style="vertical-align: middle;background-color: white;text-align: center;width: 155px;height: 100px;border: 1px solid #eee;margin-bottom: 0;border-bottom: 0;border-top-left-radius: 4px;border-top-right-radius: 4px;cursor: pointer;overflow: hidden;">\n                    <cnv-video-thumbnail  cnv-video-thumbnail-data-format="CHAT" cnv-video-thumbnail-lazy-load="true"  cnv-video-thumbnail-file=\'message.fileInfo\' cnv-video-thumbnail-show-preview="true" cnv-video-thumbnail-lazy-load-id="{{::message.fileInfo.fileId}}"></cnv-video-thumbnail>\n                </div>\n                <div class="file-thumb-cont" bo-class="{\'audio\': message.fileInfo.isAudio}"\n                       style="position: relative; height: 100px; width: 180px;background-color: white;text-align: center;text-align: center;cursor: pointer; border: 1px solid #eee;border-bottom: none;border-top-left-radius: 4px;border-top-right-radius: 4px; "\n                       bo-if="message.fileInfo.fileFormat==\'OTHER\' || !message.fileInfo.thumbnail_name">\n                    <img cnv-popover cnv-popover-ctrl="message.fileInfo.unescapedName"\n                    onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                    ng-src="{{message.fileInfo.type | getFileIconByType: 32}}" style="margin-top: 30px; width: 32px; height: 32px;"/>\n                    <br>\n                    <span bo-if="!message.fileInfo.isAudio" class="fileNames" ng-bind="message.fileInfo.getName()"></span>\n                    <div bo-if="message.fileInfo.isAudio" class="file-detail-tab">\n                        <i class="ext_holder cnv-small-file-ico" bo-class="message.fileInfo.fileExt">\n                            <span bo-bind="message.fileInfo.fileExt" class="fileExt"></span>\n                        </i>\n                        <span bo-bind="message.fileInfo.name" class="filename"></span>\n                    </div>\n                </div>\n            </a>\n            <div style="font-size: 12px;color: #aaa;font-weight: 100;border: 1px solid #eee;border-top: 0;padding: 1px 5px 1px;border-bottom-left-radius: 4px;border-bottom-right-radius: 4px;" class="notSelectable"\n                bo-bind="message._view.time">\n            </div>\n            <span bo-class=\'{"top-72": message._view.showDate == 1}\' class="download-icon ico cnv-icons-20 icons2_Download-darkgray move-right" ng-click="downloadFile(message.fileInfo.originalName, message.fileInfo.name);" title="Download"  bo-style="{\'left\':message.fileInfo.fileWidth}"></span>\n        </div>\n        <div bo-if="message._view.seen && message._view.seen.seenParticipant && chatObject.chatType == 1" class="seen">\n            <cnv-user-profile-image user-id="message._view.seen.seenParticipant.userId" full-name="message._view.seen.seenParticipant.name" width="15" height="15">\n            </cnv-user-profile-image>\n        </div>\n        <div bo-if="message._view.groupSeen.seenParticipants.length > 0 && chatObject.chatType == 2" class="seen">\n            <span bo-repeat="seenParticipant in message._view.groupSeen.seenParticipants | limitTo:14" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" width="15" height="15">\n                </cnv-user-profile-image>\n            </span>\n            <span class="group-chat-seen-more-counter" bo-if="message._view.groupSeen.moreParticipantsCount" cnv-popover cnv-popover-ctrl="message._view.groupSeen.seenParticipants | chatParticipentsTooltipText: 14: true" cnv-popover-html-already-escaped="true" bo-click="openSeenNotificationDialog(message._view.groupSeen.seenParticipants);">\n                <span class="seen-counter" bo-bind="message._view.groupSeen.moreParticipantsCount"></span>\n            </span>\n        </div>\n    </div>\n    <div bo-if="message._view.showLoadMoreMessagesBelow" class="loadMoreMessageBar below-bar"\n        bo-click="loadMoreMessages(message._view.fromSeqNoFromBelow,message._view.toSeqNoFromBelow)" style="clear:both">\n        <span style="color: #ffffff;margin-left: 4px;">Load more messages</span>\n        <div class="loadMoreMessageImg"></div>\n    </div>\n</div>\n<!-- Composing Message -->\n<div id="composingMessage" style="clear: both;" bo-if="showingcomposing">\n    <div bo-repeat="composingUser in composingUsers">\n        <div bo-if="chatObject.participants[chatObject.thisUser.userId].status != \'left\'" style="display:inline-block">\n            <div class="otherUserImg">\n                <cnv-user-profile-image user-id="composingUser.userId" width="30" height="30"\n                profileType="composingUser.profileImageType"\n                full-name="composingUser.displayName"\n                profileVersion="composingUser.profileImageVersion">\n                </cnv-user-profile-image>\n            </div>\n            <div class="composingMessageFromOtherUser">\n                <div class="dot1"></div>\n                <div class="dot2"></div>\n                <div class="dot3"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'),
a.put("chat/client/cnvChatApp.tpl.html",'<cnv-chat-manager id="ChatDiv" cnv-closer bindonce>\n    <cnv-chat-users-window></cnv-chat-users-window>\n    <div ng-repeat="chatWindow in chatWindows">\n    	<cnv-chat-window></cnv-chat-window>\n    </div>\n    <cnv-chat-head-bubble></cnv-chat-head-bubble>\n</cnv-chat-manager>'),a.put("chat/client/cnvChatHeadBubble.tpl.html",'<div bo-show="chat" class="chatHeadBubble" bo-click="openFullChat()" cnv-popover cnv-popover-ctrl="participantsList | chatParticipentsTooltipText: 0 : true" cnv-popover-html-already-escaped="true" bindonce>\n    <div class="btnClose" bo-mousedown="closeChatHead($event);"></div>\n    <div bo-if="chat.chatType == 1">\n        <cnv-user-profile-image user-id="chat._user.userId" width="44" height="44"\n        profile-type="chat._user.profileImageType" full-name="chat.getOtherParticipant().name"\n        profile-version="chat._user.profileImageVersion"></cnv-user-profile-image>\n        <div bo-if="!chat._user.isInvitedUser()" style=" position: absolute;left: 32px;margin-top: -12px;display: inline-block;bottom:0;">\n            <div bo-if="chat._user.presenceStatus == 1  && chat._user.getDevice() !=2"\n            class="listUserStatusOnline"></div>\n            <div bo-if="chat._user.presenceStatus == 2  && chat._user.getDevice() !=2"\n            class="listUserStatusBusy"></div>\n            <div bo-if="chat._user.presenceStatus == 3  && chat._user.getDevice() !=2"\n            class="listUserStatusIdle"></div>\n            <div bo-if="chat._user.presenceStatus == 4  && chat._user.getDevice() !=2 && !chat._user.getHasMobile()"\n            class="listUserStatusOffline"></div>\n            <div bo-if="(chat._user.getDevice() ==2) || (chat._user.presenceStatus == 4 && chat._user.getHasMobile())" class="user-inactive-time-field">\n                <span bo-if="chat._user.presenceStatus == 4" class="user-inactive-time" bo-date="chat._user.lastPingTime | dateAgo: null : true : true :false :true: \'shortDate\': true: true: true"></span>\n                <div class="listUserStatusMobile chat-list"></div>\n            </div>\n        </div>\n    </div>\n    <div bo-if="chat.chatType == 2 && chat._iconVersion && chat._iconVersion != \'0\'" style="border-radius: 24px;overflow: hidden;">\n        <img bo-src="getChatImageThumbnailPath(chat)" width="44px" height="44px" />\n    </div>\n    <cnv-group-chat-avatar bo-if="chat.chatType == 2 && (!chat._iconVersion || chat._iconVersion == \'0\')" participants="chat.participants" style="width: 44px;height: 44px;font-size: 8px; display: inline-block; padding:4px" bindonce>\n        <div class="topList" style="display: flex;display: -webkit-flex;display: -ms-flexbox;"\n            bo-if="!emptyChatUser && userArr.length >1">\n            <cnv-user-profile-image user-id="userArr[0].userId" width="18" height="18"\n            bo-class="{\'showing3GroupUsersTop\' : show3images,\'showing2GroupUsersTop\' : show2images}"\n            profileType="userArr[0].profileImageType"\n            profileVersion="userArr[0].profileImageVersion" full-name="userArr[0].firstName+\' \'+userArr[0].lastName"></cnv-user-profile-image>\n            <cnv-user-profile-image user-id="userArr[3].userId" width="18" height="18"\n            bo-show="!show2images && !show3images"\n            profileType="userArr[3].profileImageType"\n            profileVersion="userArr[3].profileImageVersion" full-name="userArr[3].firstName+\' \'+userArr[3].lastName"></cnv-user-profile-image>\n        </div>\n        <div class="botList" style="display: flex;display: -webkit-flex; display: -ms-flexbox;"\n            bo-if="!emptyChatUser && userArr.length >1"\n            bo-class="{\'showing3GroupUsersBot\' : show3images}">\n            <cnv-user-profile-image user-id="userArr[2].userId" width="18" height="18"\n            bo-show="!show2images"\n            profileType="userArr[2].profileImageType"\n            profileVersion="userArr[2].profileImageVersion" full-name="userArr[2].firstName+\' \'+userArr[2].lastName"></cnv-user-profile-image>\n            <cnv-user-profile-image user-id="userArr[1].userId" width="18" height="18"\n            bo-class="{showing2GroupUsersBot : show2images }"\n            bo-show="userArr.length <= 4"\n            profileType="userArr[1].profileImageType"\n            profileVersion="userArr[1].profileImageVersion" full-name="userArr[1].firstName+\' \'+userArr[1].lastName"></cnv-user-profile-image>\n            <div class="groupAvatarCounter" bo-show="showCounter" bo-bind="\'+\'+(userArr.length-3)" style="width: 18px;height: 18px;line-height: 18px;"></div>\n        </div>\n        <div bo-if="userArr.length == 1" style="font-size: 15px;margin: -4px;">\n            <cnv-user-profile-image user-id="userArr[0].userId" width="44" height="44"\n            profileType="userArr[0].profileImageType"\n            profileVersion="userArr[0].profileImageVersion" full-name="userArr[0].firstName+\' \'+userArr[0].lastName"></cnv-user-profile-image>\n        </div>\n        <div bo-if="emptyChatUser && userArr.length == 0" style="font-size: 15px;margin: -4px;">\n            <cnv-user-profile-image user-id="emptyChatUser.userId" width="44" height="44"\n            profileType="emptyChatUser.profileImageType"\n            profileVersion="emptyChatUser.profileImageVersion" full-name="emptyChatUser.firstName+\' \'+emptyChatUser.lastName"></cnv-user-profile-image>\n        </div>\n    </cnv-group-chat-avatar>\n</div>'),a.put("chat/client/dockedChatWindows/templates/cnvDockedChatWindows.tpl.html",'<div bindonce>\n    <div class="multipleDockedWind" bo-show="dockedWind.length" bo-style="{\'right\' : dockedWindowsPos}"\n         ng-click="showChatListDocked()">\n        <div class="unreadCountDocked" bo-bind="unreadCounts > 20 ? \'20+\': unreadCounts"\n             bo-show="unreadCounts > 0 && !showingChatListDocked"></div>\n        <div bo-if="dockedChatObj.chatType == 1" ng-click="showDockedChat($event,dockedChatObj.chatId)"\n             style="margin:auto;font-size: 12px; ">\n            <cnv-user-profile-image user-id="dockedChatObj._user.userId" width="28" height="28"\n                                    profile-type="dockedChatObj._user.profileImageType" full-name="dockedChatObj.getOtherParticipant().name"\n                                    profile-version="dockedChatObj._user.profileImageVersion"></cnv-user-profile-image>\n        </div>\n        <div style="width: 32px; height: 32px;padding-right: 40px;margin-left: -3px;"\n             bo-if="dockedChatObj.chatType == 2"\n             ng-click="showDockedChat($event,dockedChatObj.chatId)">\n            <div class="group-title-img" style="left:8px"></div>\n        </div>\n        <div class="dockedWindowCounter" bo-bind="\'+\'+(dockedWind.length-1)" bo-if="dockedWind.length > 1"></div>\n        <div class="chatListDocked" tabindex="0" bo-show="showingChatListDocked">\n            <div ng-repeat="dockedWindObj in dockedWind">\n                <div class="dockListContent">\n                    <div bo-if="dockedWindObj.chatObj.chatType == 1"\n                         style="display: inline-block;margin-bottom: 2px;margin-left: 5px;"\n                         ng-mousedown="showDockedChat($event,dockedWindObj.chatObj.chatId)">\n                        <div bo-if="dockedWindObj.chatObj._user.presenceStatus == 1  && dockedWindObj.chatObj._user.getDevice()  != 2"\n                             class="listUserStatusOnline"></div>\n                        <div bo-if="dockedWindObj.chatObj._user.presenceStatus == 2  && dockedWindObj.chatObj._user.getDevice()  != 2"\n                             class="listUserStatusBusy"></div>\n                        <div bo-if="dockedWindObj.chatObj._user.presenceStatus == 3  && dockedWindObj.chatObj._user.getDevice() !=2"\n                             class="listUserStatusIdle" bo-show="!isMinimizedToAvatar"></div>\n                        <div bo-if="dockedWindObj.chatObj._user.presenceStatus == 4  && dockedWindObj.chatObj._user.getDevice() !=2 && !dockedWindObj.chatObj._user.getHasMobile()"\n                             class="listUserStatusOffline"></div>\n                        <div bo-if="(dockedWindObj.chatObj._user.getDevice()  == 2) || (dockedWindObj.chatObj._user.presenceStatus == 4 && dockedWindObj.chatObj._user.getHasMobile())"\n                             class="listUserStatusMobile"></div>\n\n                    </div>\n                    <div bo-if="dockedWindObj.chatObj.chatType == 2"\n                         style="display: inline-block;margin-bottom: 2px;"\n                         ng-mousedown="showDockedChat($event,dockedWindObj.chatObj.chatId)">\n                        <i class="cnv-icons-20 icons_Group_Icon-darkgray"></i>\n                    </div>\n                    <div class="dockedChatListTitle" bo-bind="dockedWindObj.chatObj.getTitle()"\n                         ng-mousedown="showDockedChat($event,dockedWindObj.chatObj.chatId)">\n                    </div>\n                    <div class="unreadCountDockedList" bo-bind="dockedWindObj.unreadCount > 20 ? \'20+\': dockedWindObj.chatObj.unreadCount"\n                         bo-show="dockedWindObj.chatObj.unreadCount > 0"></div>\n                    <div class="closeChatFromList" ng-click="closeDockedChat($event,dockedWindObj.chatObj.chatId)">\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'),a.put("chat/fullviewclient/templates/AddPeopleInChat.tpl.html",'<div bindonce>\n    <tags-input class="to-field"\n                ng-model="userItems"\n                placeholder=""\n                pre-placeholder="To:"\n                no-tags-indicator="false"\n                add-on-comma="false"\n                add-on-blur="false"\n                add-from-autocomplete-only="true"\n                display-property="label"\n                replace-spaces-with-dashes="false"\n                allow-leftover-text="true"\n                on-esc-key-press="onEscKeyPressInToField()"\n                on-enter-press="onEnterKeyPressInToField()"\n                on-tag-added="onItemAddedInToField($tag)"\n                on-tag-removed="onItemRemovedInToField($tag)"\n                set-focus-on-load="true"\n                hide-input-on-blur="false">\n    </tags-input>\n\n    <div class="cnvScrollContainerParent" style="overflow: hidden;">\n        <div class="add-people-users-list-container cnvScrollContainer">\n            <div class="chat-member possible-chat-participant"\n                 bo-repeat="item in usersList | limitTo: usersToDisplay"\n                bo-class="{\'chat-member-selected\' : $index == selectedItemIndex, \'user-not-participant\' : !item.isParticipant }"\n                bo-click="addUserInToField(item)">\n                <div class="user-img-with-presence">\n                    <cnv-user-profile-image  user-id="item.user.userId" size="81" width="32" height="32"\n                                             profileType="item.user.profileImageType"\n                                             profileVersion="item.user.profileImageVersion" full-name="item.user.firstName+\' \'+item.user.lastName">\n                    </cnv-user-profile-image>\n                    <div class="user-presence-indicator" bo-if="!item.user.isInvitedUser()"\n'+"                         bo-class=\"{'listUserStatusOnline': item.presenceStatus =='userOnline' || item.presenceStatus == 'userOnlineOnMobile',\n                                'listUserStatusBusy' : item.presenceStatus =='userBusy',\n                                'listUserStatusIdle': item.presenceStatus =='userIdle',\n                                'listUserStatusOffline' : item.presenceStatus =='userOffline' || item.presenceStatus == 'userOfflineWithMobile'}\"\n                         class=\"listUserStatus\">\n                    </div>\n                </div>\n\n                <span class=\"chat-member-label\" bo-bind=\"item.user.getDisplayName()\"></span>\n\n                <span bo-if=\"item.isParticipant\" class=\"chat-participant\">Added</span>\n\n            </div>\n            <div class=\"scroll-bar-cover-bar\"></div>\n        </div>\n    </div>\n</div>"),a.put("chat/fullviewclient/templates/AddPeopleInChatModal.tpl.html",'<div class="invite-people-in-chat" suppress-scroll-propagation>\n\n\n    <div class="modal-header invite-people-in-chat-header" bindonce>\n        <span class="header-btn" bo-click="dismiss()">Cancel</span>\n        <h4 ng-bind="modalTitle"></h4>\n        <span class="header-btn" bo-click="invite()"\n              ng-disabled="!doneBtnEnabled">Done</span>\n    </div>\n\n\n    <div class="modal-body invite-people-in-chat-body">\n        <cnv-add-people-in-chat></cnv-add-people-in-chat>\n    </div>\n</div>'),a.put("chat/fullviewclient/templates/ChatAppHeader.tpl.html",'<section class="chat-app-header"  bindonce="">\n    <div class="chat-header-main">\n        <div class="chat-app-left chatLogoContainer" bo-class="{\'leftPanelClosed\': !showSettingsPanel}">\n            <cnv-logo-with-feed-dirty-indicator></cnv-logo-with-feed-dirty-indicator>    \n        </div> \n        <div class="header-title" bo-class="{\'leftPanelClosed\': !showSettingsPanel}">\n            <div class="title-container">\n                <div bo-if="!chatViewData.users[0].isInvitedUser() && chatViewData.type == 1" class="user-presence-container" style="    position: absolute;z-index: 1;top: 20px;left: auto;">\n                    <div bo-if="(chatViewData.presenceStatus != \'userOfflineWithMobile\' && chatViewData.presenceStatus != \'userOnlineOnMobile\')"\n                         bo-class="{\'listUserStatusOnline\': chatViewData.presenceStatus ==\'userOnline\',\n                                    \'listUserStatusBusy\' : chatViewData.presenceStatus ==\'userBusy\',\n                                    \'listUserStatusIdle\': chatViewData.presenceStatus ==\'userIdle\',\n                                    \'listUserStatusOffline\' : chatViewData.presenceStatus ==\'userOffline\'}"\n                                    class="listUserStatus">\n                    </div>\n                    <div bo-if="(chatViewData.presenceStatus == \'userOfflineWithMobile\' || chatViewData.presenceStatus == \'userOnlineOnMobile\')" class="user-inactive-time-field">\n                        <span bo-if="chatViewData.presenceStatus == \'userOfflineWithMobile\'" class="user-inactive-time" bo-date="selectedItem.users[0].lastPingTime | dateAgo: null : true : true :false :true: \'shortDate\': true: true: true"></span>\n                        <div class="listUserStatusMobile chat-list"></div>\n                    </div>\n                </div> \n                <div class="user-name" bo-class="{\'notGroupChat\': chatViewData.type == 1}" bo-bind="chatTitle && chatTitle.length > 0 ? chatTitle : \'&nbsp;\'"></div>\n            </div>\n\n            <div class="shadowLine"></div>\n        </div>\n        <div class="header-main-sub header-option-Buttons"  bo-class="{\'leftPanelClosed\': !showSettingsPanel}">\n\n            <div class="chat-admin-mode-exit-btn" ng-click="exitAdminMode()" bo-if="isAdminMode">Exit admin mode</div>\n            <div class="icon-button video-call-btn" bo-attr bo-attr-disabled="isDisabled">\n                <i class="cnv-icons-20 chat_full_view_video_call" ></i>\n                <!-- <label class="glyphicon glyphicon-facetime-video button-font-size" ></label> -->\n                <cnv-video-call-options-in-chat bo-if="showVidCallDropdown" class="vidCallOptionsDropdown"></cnv-video-call-options-in-chat>\n            </div>\n            <div class="expandSettingsBtn" bo-class="{\'icon-button\' : true, \'icon-button-selected\': showSettingsPanel}" ng-click="showHideSettingsPanel($event)" bo-attr bo-attr-disabled="isNewChat" >\n                <i class="cnv-icons-20 icon_expand_panel-darkgray" ></i>\n                <!-- <label class="glyphicon glyphicon-info-sign button-font-size"></label> -->\n            </div>\n            <div class="notification-icon inline-control">\n                <cnv-in-app-notifications-dropdown class="dark-bell-icon"></cnv-in-app-notifications-dropdown>\n            </div>\n            <div class="admin-panel-exit-btn" ng-if="isAdminMode" ng-click="exitAdminMode();">Exit admin mode</div>\n            <span class="separator"></span>\n            <div ng-click="toggleDropdown($event)" class="userSettingsControl" >\n                <cnv-user-profile-image width="\'24\'" height="\'24\'" img-url="user_info.getUserImageUrl_64x64" user-id="user_info.user_id" profile-type="user_info.profile_image_type" profile-version="user_info.profile_image_version" full-name="user_info.first_name + \' \' + user_info.last_name" class="profilePictureHeader">\n                </cnv-user-profile-image>\n                <cnv-dropdowns cnv-dropdown-ctrl="userMenuDropdownCtrl" class="user-menu-dropdown-widget">\n                <!-- WIREFRAME -->\n                <span class="dropdown cnv-custom-dropdown">\n                  <a class="dropdown-toggle">\n                    <i class="cnv-icons-16 icons_Dropdown_incircle-lightgray"></i>\n                  </a>\n                </span>\n              </cnv-dropdowns>\n            </div>\n        </div>\n        \n    </div>\n</section>'),a.put("chat/fullviewclient/templates/ChatAttachmentsView.tpl.html",'<div class="chatAttachmentsSection" bindonce> \n    <div class="items-loading-spinner" bo-if="isloading">\n            <i class="cnv-circle-spinner-small"></i>\n    </div>\n    <div class="settings-group-with-menu"  bo-show="filesLoaded">\n        <span class="settings-group-title">SHARED FILES ({{chatFiles.length}})</span>\n        <div class="attachmentsIcon dropdown-ico-wrapper">\n            <i class="cnv-icons-15 icons2_Dropdown-darkgray" data-toggle="tooltip" data-placement="bottom" title="Show shared files" bo-click="showSharedFiles()"></i>\n        </div>\n    </div>\n    <div class="attachments settings-group-grid" bo-show="showAttachments && filesLoaded && filesRendered">\n        <a class="file_container shared" bo-repeat="file in chatFiles track by file.file_id" cnv-popover cnv-popover-ctrl="file.name" bo-style="{width:thumbSize,height:thumbSize, \'line-height\':thumbSize}" bo-click="onFileClicked($event, file)"\n             bo-href="file.file_id | getFileResourceLinkUrl: file.file_format: \'6\' : \'6\' : chatId : file.name: \'21\' ">\n                <div class="file-info" bo-if="!file.thumbnail_name || file.file_format == \'DOC\' || file.status !== \'SUCCESS\' || file.file_format == \'OTHER\' || file.file_format == \'VIDEO\'" bo-style="{width:thumbSize}">\n                    <span class="ext_holder_chat_attachments cnv-small-file-ico" bo-class="file.name | getFileExtension" bo-bind="file.name | getFileExtensionForIcon"></span>\n                    <span  class="label" bo-bind="file.name" ></span>\n                </div>\n        </a>\n    </div>\n</div>'),a.put("chat/fullviewclient/templates/ChatMember.tpl.html",'<div bindonce>\n\n    <div class="user-img-with-presence">\n        <cnv-user-profile-image  user-id="item.user.userId" size="81" width="32" height="32"\n                                 profileType="item.user.profileImageType"\n                                 profileVersion="item.user.profileImageVersion" full-name="item.user.firstName+\' \'+item.user.lastName">\n        </cnv-user-profile-image>\n        <div class="user-presence-indicator" bo-if="!item.user.isInvitedUser()"\n'+"             bo-class=\"{'listUserStatusOnline': item.presenceStatus =='userOnline' || item.presenceStatus == 'userOnlineOnMobile',\n                            'listUserStatusBusy' : item.presenceStatus =='userBusy',\n                            'listUserStatusIdle': item.presenceStatus =='userIdle',\n                            'listUserStatusOffline' : item.presenceStatus =='userOffline' || item.presenceStatus == 'userOfflineWithMobile'}\"\n             class=\"listUserStatus\">\n        </div>\n    </div>\n    <span class=\"chat-member-label\" bo-bind=\"item.user.getDisplayName()\"></span>\n\n    <div class=\"chat-member-more-options\" bo-if=\"item.user.isAccessible\" >\n        <cnv-dropdowns class=\"chat-member-options-icon\" cnv-dropdown-ctrl=\"item.user.userId == selectedChat.chat.thisUser.userId ? groupChatSelfOptions : groupChatMemberOptions\" cnv-dropdown-callback-params=\"{'userId': item.user.userId, 'email': item.user.email}\"></cnv-dropdowns>\n    </div>\n\n</div>\n"),a.put("chat/fullviewclient/templates/ChatMessage.tpl.html",'<div  bindonce class="chat-message-item " bo-class="{\'other-user-message-item\': !msgItem.thisUserMsg , \'this-user-message-item\': msgItem.thisUserMsg, \'{{msgItem.customClasses}}\' : msgItem.customClasses }">\n    <div bo-if="msgItem.showLoadOldMessages" class="load-more-messages-btn" bo-click="loadMessagesBeforeMsgItem(msgItem)">\n        <span>Load more messages</span>\n        <div class="load-more-messages-img"></div>\n    </div>\n    <span bo-if="msgItem.showMessageDate" class="chat-message-date" bo-date="msgItem.message.getTimestamp() | dateSeparatorFromCurrentTime :true"></span>\n    <span bo-if="msgItem.userName != null" class="chat-message-user-name" bo-bind="msgItem.userName"></span>\n    <div bo-if="!msgItem.isSystemMessage" class="user-message-container">\n        <cnv-user-profile-image class="sender-image" bo-if="msgItem.showUserImg" user-id="msgItem.user.userId" size="64" width="30" height="30"\n            profile-type="msgItem.user.profileImageType"\n            full-name="msgItem.user.displayName"\n            profile-version="msgItem.user.profileImageVersion">\n        </cnv-user-profile-image>\n        <div bo-if="msgItem.isFailedMessage"\n             class="failed-msg-icon glyphicon glyphicon-warning-sign"></div>\n        <div bo-if="msgItem.messageText != null"\n             class="user-message-text-container"\n             bo-class="{\'other-user-msg-text-container-wo-img\': !msgItem.showUserImg && !msgItem.thisUserMsg , \'message-received-at-server\': msgItem.thisUserMsg && (msgItem.message._sequenceNumber > 0 || msgItem.message.isFakeMessage), \'single-emoji-msg\': msgItem.isSingleEmoji, \'highlight\' : msgItem.isCurrentMatch }">\n            <span class="message-text" bo-html="msgItem.messageText"></span>\n            <span bo-if="!msgItem.isSingleEmoji" class="message-time" bo-bind="msgItem.messageTime"></span>\n        </div>\n        <div  bo-if="msgItem.fileInfo" class="user-message-file-container"\n             bo-class="{\'other-user-msg-img-container-wo-img\': !msgItem.showUserImg && !msgItem.thisUserMsg, \'highlight highlight-file\' : msgItem.isCurrentMatch}">\n            <span bo-if="msgItem.fileInfo.fileId" class="message-file-download-icon ico cnv-icons-20 icons2_Download-darkgray"\n                  bo-click="downloadFile(msgItem);"\n                  title="Download">\n            </span>\n            <div class="message-file-thumbnail-container">\n                <!-- file is uploading---->\n                <div bo-if="!msgItem.fileInfo.fileId" cnv-upload-file-ui class=\'attachment-box\' cnv-popover cnv-popover-ctrl="file.name">\n                    <div cnv-popover cnv-popover-ctrl="file.name" class="attachment-box-background" ></div>\n                    <img ng-src="{{file.localUrl}}" ng-class="{\'file-converted\': completed()}"\n                         onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"/>\n                    <div class="upload-state-message failed-upload" ng-if="failed()">\n                        <div class="upload-failed-icon"></div>\n                        <div>\n                            <span class="text">Couldn\'t upload this file.</span>\n                            <span class="action" ng-if="file.retryAllowed" href ng-mousedown="retry()">Retry</span>\n                        </div>\n                    </div>\n                    <span ng-if="!file.noTitle && !failed()" class="fileNames" style="padding-top: 0px">{{file.name}}</span>\n                    <div ng-if="isInProgress()" class=\'progress-bar\'>\n                        <div class="bar-internal"><div class="cnv-spinner"></div></div>\n                        <div class="progress-line" ng-style="{width: file.progress+\'%\'}"></div>\n                    </div>\n                    <div ng-click="remove(); cancelMessageItem(msgItem)" class="remove-file" bo-if="!file.fileUploaded"></div>\n                </div>\n                <a bo-if="msgItem.fileInfo.fileId" ng-click="onFileClicked(msgItem.fileInfo)"\n                   bo-href="msgItem.message.fileInfo.fileId |getFileResourceLinkUrl :msgItem.message.fileInfo.fileFormat:\'6\':\'6\':chat.chatId:msgItem.message.fileInfo.name:\'21\'">\n                    <div bo-if="msgItem.fileInfo.fileFormat != \'VIDEO\' && msgItem.fileInfo.fileFormat != \'OTHER\' && msgItem.fileInfo.thumbnail_name"\n                         class="gif-image-thumbnail-container"\n                         bo-class="{\'isGif\' : msgItem.fileInfo.type == \'GIF\'}"\n                         index="{{$index}}"\n                         bo-style="{\'height\':msgItem.fileInfo.fileHeight, \'line-height\': msgItem.fileInfo.fileHeight, \'width\':msgItem.fileInfo.fileWidth}">\n                        <i bo-if="msgItem.fileInfo.type == \'GIF\'" class="gifIndicators gif-badge">GIF</i>\n                        <i bo-if="msgItem.fileInfo.type == \'GIF\'" class="gifIndicators cnv-spinner"></i> \n                        <!-- <img bo-if="msgItem.fileInfo.type == \'GIF\'" class="original-gif image-ctrl" cnv-popover cnv-popover-ctrl="msgItem.message.fileInfo.name"\n                             onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                             bo-src="msgItem.message.fileInfo.originalName | getOriginalImagePath: chat.chatId"/>\n                             <!--style="display: none;"-->\n                        <!-- gif placeholder in case of type = gif -->\n                        <img bo-class="{\'gif-placeholder\': msgItem.fileInfo.type == \'GIF\'}" class="image-ctrl"\n                             cnv-popover cnv-popover-ctrl="msgItem.message.fileInfo.name"\n                             onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                             bo-src="msgItem.fileInfo | getNoteThumbnailPath: chat.chatId"\n                             bo-style="{\'max-height\':(msgItem.fileInfo.fileHeight), \'max-width\':msgItem.fileInfo.fileWidth}"/>\n                    </div>\n                    <div bo-if="msgItem.fileInfo.fileFormat==\'VIDEO\'" class=\'video{{::msgItem.fileInfo.fileId}}\'\n                         style="vertical-align: middle;background-color: white;text-align: center;width: 155px;height: 100px;border: 1px solid #eee;margin-bottom: 0;border-bottom: 0;border-top-left-radius: 4px;border-top-right-radius: 4px;cursor: pointer;overflow: hidden;">\n                        <cnv-video-thumbnail  cnv-video-thumbnail-data-format="CHAT" cnv-video-thumbnail-lazy-load="true"\n                                              cnv-video-thumbnail-file=\'msgItem.message.fileInfo\'\n                                              cnv-video-thumbnail-show-preview="true"\n                                              cnv-video-thumbnail-lazy-load-id="{{::msgItem.message.fileInfo.fileId}}">\n\n                        </cnv-video-thumbnail>\n                    </div>\n                    <div style="height: 100px;  width: 180px;background-color: white;text-align: center;text-align: center;cursor: pointer; border: 1px solid #eee;border-bottom: none;border-top-left-radius: 4px;border-top-right-radius: 4px;"\n                         bo-if="msgItem.fileInfo.fileFormat!=\'VIDEO\' &&  (msgItem.fileInfo.fileFormat==\'OTHER\' || !msgItem.fileInfo.thumbnail_name)">\n                        <img cnv-popover cnv-popover-ctrl="msgItem.message.fileInfo.name"\n                             onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';"\n                             bo-src="msgItem.fileInfo.type | getFileIconByType: 32"\n                             style="margin-top: 30px; width: 32px; height: 32px;"/>\n                        <br>\n                        <span class="fileNames" bo-bind="msgItem.message.fileInfo.getName()"></span>\n                    </div>\n                </a>\n                <span class="message-time" bo-bind="msgItem.messageTime"></span>\n            </div>\n        </div>\n        <div bo-if="msgItem.isFailedMessage" class="retry-failed-msg">\n             Not delivered.&nbsp;<a href="javascript:void(0);"\n                              bo-click="resendMessage(msgItem.message)">Try Again.</a>\n        </div>\n    </div>\n    <div bo-if="msgItem.seenParticipants" class="seen">\n            <span class="seemImageIcon" bo-repeat="seenParticipant in msgItem.seenParticipants | limitTo:30" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" size="32" width="15" height="15">\n                </cnv-user-profile-image>\n            </span>\n            <span bo-if="msgItem.seenParticipants.length > 30 " class="chat-seen-counter-container"\n                  cnv-popover cnv-popover-ctrl="msgItem.seenParticipants | chatParticipentsTooltipText: 30: true"\n                  bo-click="openSeenNotificationDialog(msgItem.seenParticipants);">\n                <span class="seen-counter" bo-bind="msgItem.seenParticipants.length - 30"></span>\n            </span>\n        </div>\n    <div bo-if="msgItem.showLoadNewMessages" class="load-more-messages-btn" bo-click="loadMessagesAfterMsgItem(msgItem)">\n        <span>Load more messages</span>\n        <div class="load-more-messages-img"></div>\n    </div>\n    <div bo-if="msgItem.isSystemMessage" class="system-chat-message">\n        <span bo-html="msgItem.messageText"></span>\n    </div>\n</div>\n'),a.put("chat/fullviewclient/templates/ChatMessageInput.tpl.html",'<div class="message-input-container" bindonce>\n\n    <div bo-if="showNewMessageBtn" class="new-chat-message-btn" bo-click="newMsgButtonClickHandler();">\n        <span style="font-size: 14px;margin-left: 5px;color: white;position: absolute;top: 5px;left: 2px;">New Message</span>\n        <div class="newMessageIcon"></div>\n    </div>\n\n    <div class="message-input-box" ng-class="(!showGiphy)?\'giphyDisabledMessage\':\'giphyEnabledMessage\'" bo-class="{\'message-input-box-disable\':inputDisabled}">\n        <cnv-editor class="message-input-editor" cnv-text-editor-mode="minimal"\n                    cnv-text-editor-ctrl="textEditorCtrl"\n                    cnv-text-editor-on-focus-out="onFocusOut(event)"\n                    cnv-at-mentions="getCommandsWithDropdownItems($query, delimiter)"\n                    cnv-on-command-executed="OnCommandExecuted(item, search)"\n                    cnv-at-mentions-suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html"\n                    cnv-text-editor-on-esc-key-press="onEscKeyPressInTextEditor()"\n                    cnv-text-editor-submit-on-enter="onTextEditorSubmitOnEnter()"\n                    cnv-focus-on-load="false"\n                    cnv-editor-source="Chat"\n                    cnv-text-editor-on-space-key-press="onSpaceKeyPressInTextEditor()">\n        </cnv-editor>\n        <div class="scrollHider" bo-show="!inputDisabled"></div>\n        <cnv-emoji-popover cnv-editor-name="editorCtrl" cnv-emoji-fixed-on-scroll= "true"\n                           class="message-input-buttons emoji" bo-attr bo-attr-disabled="inputDisabled"></cnv-emoji-popover>\n        <div class="message-input-buttons photo icons2_Attach-darkgray"\n             bo-attr bo-attr-disabled="inputDisabled || !chat || chat.isInviteChat"\n             bo-click="onAttachmentButtonClick()">\n        </div>\n        <input name=\'file\' id="fvChatAttachmentInput"\n               class=\'inputHide\' type=\'file\' multiple=\'multiple\' bo-attr bo-attr-disabled="inputDisabled || !chat || chat.isInviteChat">\n        <cnv-giphy-popover bo-if="showGiphy" bo-attr cnv-chat-window-id="chatId" cnv-file-context="fileInputContext"\n                           cnv-giphy-information="giphyObject"\n                           cnv-giphy-icon-class="message-input-buttons giphy"\n                           cnv-giphy-mixpanel-info="Chat"\n                           cnv-giphy-relative-to-body="true"\n                           bo-attr-disabled="inputDisabled || !chat || chat.isInviteChat">\n\n        </cnv-giphy-popover>\n    </div>\n</div>\n'),
a.put("chat/fullviewclient/templates/ChatMessagesContainer.tpl.html",'<div class="chat-messages-container" bo-id="messagesContainerId" bindonce  bo-class="{\'leftPanelClosed\': !showSettingsPanel}">\n    <cnv-messages-search-bar bo-if="isInSearch"></cnv-messages-search-bar>\n    <div bo-if="isNewChat" class="newChatInput">\n        <div class="newChatInputWrapper">\n            <cnv-new-chat-users-input class="new-chat-users-input" bo-class="{\'make-room-for-new-chat-link\': showCreateNewChatLink}"></cnv-new-chat-users-input>\n            <div bo-if="showCreateNewChatLink" class="create-new-chat-link" bo-click="explicitlyCreateNewChat()">Create new chat</div>\n        </div>\n    </div>\n\n    <div bo-if="showCreateNewMessage" class="emptyNewChatMessage">\n        <span bo-if="selectedItem.users.length == 0">Add one or more recipients, and<br>send a message to start a chat</span>\n        <span bo-if="selectedItem.users.length > 0">Send a message to start a chat</span>\n    </div>\n    <div class="messages-list"\n        cnv-upload-files-ui-manager\n        cnv-upload-files-ui-manager-ctrl="filesUploadManagerCtrl"\n        cnv-insert-add-item-options-ctrl="insertOptionsCtrl"\n        auto-hiding-scroll-bar>\n        <div class="items-loading-spinner" bo-if="loadingOlderMessages">\n            <i class="cnv-circle-spinner-small"></i>\n        </div>\n\n        <div bo-if="selectedItem.invitedChatMessage"\n             class="non-network-user-chat-message"\n             bo-bind="selectedItem.invitedChatMessage">\n        </div>\n\n        <cnv-chat-message bo-repeat="msgItem in messageItems" cnv-repeat-done="onListRenderComplete()">\n        </cnv-chat-message>\n        <!-- Composing Message -->\n        <div bo-if="showComposing" class="composing-container">\n            <div bo-repeat="composingUser in chatViewData.composingUsers">\n                <div class="composing-message">\n                    <cnv-user-profile-image user-id="composingUser.userId" size="64" width="30" height="30"\n                    profileType="composingUser.profileImageType"\n                    full-name="composingUser.displayName"\n                    profileVersion="composingUser.profileImageVersion">\n                    </cnv-user-profile-image>\n                    <div class="composing-item">\n                        <div class="dot1"></div>\n                        <div class="dot2"></div>\n                        <div class="dot3"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <cnv-dropzone bo-show="!disableFileInput" dropzone-id="{{\'_full_view_chat\'}}"></cnv-dropzone>\n    <cnv-chat-message-input on-new-message-button-click="onNewMessageButtonClick"\n                            on-message-input-resize="onMessageInputResize"></cnv-chat-message-input>\n</div>'),a.put("chat/fullviewclient/templates/ChatProfileImage.tpl.html","<div class=\"chat-profile-image\" bo-style=\"{'width': size +'px', 'height':size + 'px'}\" bindonce>\n"+'    <cnv-user-profile-image class="chat-profile-user-image" bo-if="singleUser && !contact" user-id="user.userId" size="size" width="pictureDims" height="pictureDims"\n                            profileType="user.profileImageType"\n                            profileVersion="user.profileImageVersion" full-name="user.firstName+\' \'+user.lastName"></cnv-user-profile-image>\n    <cnv-user-profile-image class="chat-profile-user-image" bo-if="contact" user-id="contact.email" size="size" width="pictureDims" height="pictureDims"\n                            full-name="contact.getDisplayName()" profileVersion="{{\'0\'}}" profileType="{{\'0\'}}"></cnv-user-profile-image>\n\n    <div class="chat-user-images-container" bo-if="item.users.length > 1" style="width: 100%; height: 100%;"\n         bo-class="{\'two-images-container\' : item.users.length == 2, \'three-images-container\' : item.users.length == 3 && item.unDisplayedUsersCount == 0}">\n        <cnv-user-profile-image class="chat-profile-user-image" bo-repeat="user in item.users" user-id="user.userId" size="size" width="pictureDims" height="pictureDims"\n                                profileType="user.profileImageType"\n                                profileVersion="user.profileImageVersion" full-name="user.firstName+\' \'+user.lastName"></cnv-user-profile-image>\n        <div class="group-chat-users-count" bo-if="item.unDisplayedUsersCount > 0 " bo-bind="\'+\'+(item.unDisplayedUsersCount)"\n             bo-style="{\'width\': pictureDims+\'px\', \'height\': pictureDims+\'px\', \'height\': pictureDims+\'px\', \'line-height\': lineHeight+\'px\', \'font-size\': fontSize+\'px\'}"></div>\n    </div>\n</div>'),a.put("chat/fullviewclient/templates/ChatSearchControl.tpl.html",'<div class="chats-search-control" bindonce>\n    <div class="chats-search-wrapper">\n        <div class="chats-search-icon"></div>\n        <input class="chats-search-input" placeholder=" Search" bo-keydown="onSearchInputKeyDown($event)"/>\n        <div bo-if="isInSearch" class="cancel-chats-search-icon" bo-click="endSearch(true)"></div>\n    </div>\n</div>'),a.put("chat/fullviewclient/templates/ChatSettingsContainer.tpl.html",'<div class="chat-settings-panel">\n    <div class="chat-settings-container cnvScrollContainer" bindonce=""  auto-hiding-scroll-bar>\n        <div bo-if="chatsLoaded">\n            <div class="settings-group-with-menu">\n                <div class="chat-title">\n                    <div class="chat-title-label" bo-class="{canEdit : !isDisabled && isGroupChat}" bo-click="initRenameGroupChat($event)" bo-attr bo-attr-disabled="isAdminMode">\n                        <label bo-bind="chatTitle" >Loading ...</label>\n                    </div>\n                    <div style="float: right;margin-top: 3px;padding-right: 10px;display: none;position: relative;" class="btnChatSettings" bo-show="!isInitializing && !isMinimized && !chatWindow.metaDetails.isMinimized">\n                        <i class="headerIcon cnv-icons-18 chat_settings"></i>\n                        <cnv-dropdowns bo-if="!selectedChat.isNewChat" cnv-dropdown-ctrl="chatOptions" style="padding: 0px 9px;position: absolute;right: 0;" bo-attr bo-attr-disabled="disableChatOptions"></cnv-dropdowns>\n                    </div>\n                </div>\n                <div class="group-chat-rename-input">\n                    <input class="group-chat-rename-input-field" bo-keyup="onChatTitleKeyUp($event)"/>\n                    <cnv-emoji-popover cnv-editor-name="editorCtrl" cnv-emoji-fixed-on-scroll= "true"\n                    class="message-input-buttons emoji" bo-attr bo-attr-disabled="inputDisabled || isAdminMode"></cnv-emoji-popover>\n                    <div class="okay-button"><label class="glyphicon glyphicon-ok" bo-click="renameGroupChat($event)" ></label></div>\n                </div>\n            </div>\n            <div class="settings-group-plain">\n                <cnv-chat-profile-image bo-if="!isGroupChat" style="height: 92px; overflow:hidden;" size="92"></cnv-chat-profile-image>\n                <div bo-if="isGroupChat && selectedChat.thisUserLeft" class="groupImageContainer">\n                    <div bo-if="selectedChat.chatIconUrl" class="groupIconContainer">\n                        <img bo-src="selectedChat.chatIconUrl"/>\n                    </div>\n                    <div bo-if="!selectedChat.chatIconUrl" class="group-title-img-default" style="opacity:1">\n                    </div>\n                </div>\n                <div bo-if="isGroupChat && !selectedChat.thisUserLeft" class="groupImageContainer" bo-click="updateGroupPhoto()"\n                     bo-attr bo-attr-disabled="isAdminMode">\n                    <div bo-if="selectedChat.chatIconUrl" class="groupIconContainer">\n                        <img bo-src="selectedChat.chatIconUrl"/>\n                    </div>\n                    <div bo-if="!selectedChat.chatIconUrl" class="group-title-img-default">\n                    </div>\n                    <div class="groupChatPhotoEdit" bo-bind="selectedChat.chatIconUrl ? \'EDIT IMAGE\' : \'ADD IMAGE\' " bo-class="selectedChat.chatIconUrl ? \'addbackground\' : \'\'"></div>\n                </div>\n                <div class="groupChatPhotoEditSpinner" >\n                </div>\n                <input bo-if="isGroupChat" id="groupPictureInput" type="file" style="" accept=\'image/*\' bo-attr\n                       bo-attr-disabled="isAdminMode"/>\n            </div>\n        </div>\n        <div class="group-members-panel" bo-if="isGroupChat && chatsLoaded && !selectedChat.isNewChat">\n            <div class="group-members-panel-header">\n                <span class="group-chat-members-title">GROUP MEMBERS</span>\n                <div bo-if="!isDisabled" class="add-new-member" bo-click="invitePeopleInChat()"\n                     bo-attr\n                     bo-attr-disabled="isAdminMode">\n                         <i class="headerIcon cnv-icons-16 chat-window-plus-gray-hover"></i>\n                     </div>\n            </div>\n            <div class="settings-group-list" >\n                <cnv-chat-member class="chat-member" bo-repeat="item in selectedChat.chatMembers | limitTo: chatMembersDisplayCount"></cnv-chat-member>\n                <div bo-if="showAllMembersText" class="extra-members-item">\n                    <div class="circle-with-dots" bo-click="toggleAllChatMembers()">\n                        <div class="icons2-more-options-gray"></div>\n                    </div>\n                    <span class="extra-members-text" bo-bind="showAllMembersText" bo-click="toggleAllChatMembers()"></span>\n                </div>\n            </div>\n        </div>\n        <cnv-chat-attachments bo-if="selectedChat"></cnv-chat-attachments>\n    </div>\n</div>'),a.put("chat/fullviewclient/templates/ChatVideoCallOptions.tpl.html",'<div class="video-call-dropdown" bindonce>\n    <span class="header">Start a video call</span>\n\n    <div class="option" ng-click="startAppearin()">\n        <i class="appearin cnv-icons-20" style="margin-top: 2px;">\n        </i>\n        <div class="vid-call-details">\n    		<span class="header-txt">\n				Appear.in\n			</span>\n            <span class="meta-txt">\n				Supports up to 8 participants. Also available on mobile with Appear.in for iOS & Android.\n			</span>\n        </div>\n    </div>\n</div>'),a.put("chat/fullviewclient/templates/ChatsListContainer.tpl.html",'<div class="chats-list-container" bindonce>\n    <cnv-chats-list-header class="chats-list-header-common chats-list-header"></cnv-chats-list-header>\n    <cnv-chat-search-control on-search="search"\n                             on-search-canceled="searchCanceled"\n                             on-search-ended="searchEnded"\n                             on-arrow-key-up="moveToPrevSuggestion"\n                             on-arrow-key-down="moveToNextSuggestion"\n                             on-enter-key-down="selectSuggestedItem"></cnv-chat-search-control>\n\n\n\n    <div class="chats-scroll-container-parent" > <!-- to hide the scroll bar -->\n        <div class="chats-scroll-container" auto-hiding-scroll-bar>\n\n\n            <div id="new-messages-available-notif" bo-class="{\'in-view\': showNewMessagesNotification}">\n                <div class="btn-cont" bo-click="newMessagesNotificationClick()">\n                    <i class="cnv-icons-20 Icon1__UpArrow-blue"></i>\n                    <span>New Messages</span>\n                </div>\n            </div>\n\n            <cnv-new-chat-item bo-if="newChatData" class="chats-list-item"\n                               bo-mousedown="onItemSelected($event, newChatData)"\n                               bo-class="{\'chat-item-selected\' : newChatData == selectedItem}">\n            </cnv-new-chat-item>\n\n            <cnv-chats-list-item class="chats-list-item" bo-repeat="item in listItems | limitTo: displayedItemsCount"\n                                 bo-class="{\'chat-item-selected\' : item == selectedItem, \'chats-list-item-with-banner\' : item.banner }"\n                                 bo-mousedown="onItemSelected($event, item)"\n                                 cnv-repeat-done="onListRenderComplete()"></cnv-chats-list-item>\n            <div class="items-loading-spinner" bo-if="loadingItems">\n                <i class="cnv-circle-spinner-small"></i>\n            </div>\n\n            <div class="chats-list-blank-search-view" bo-if="listItems.length == 0 && !loadingItems && searchInProgress">\n                    <i class="cnv-icons-40 icons2_Chats-lightgray"></i>\n                    <p>No matches found.</p>\n            </div>\n\n            <div class="chats-list-blank-view" bo-if="listItems.length == 0 && !loadingItems && !searchInProgress">\n\n                <div class="empty-state-title"><b>Convo works better with your team</b></div>\n                <div class="empty-state-desc">See teammates who aren\'t on the<br><span bo-bind="primaryDomain"></span> network yet.</div>\n                <div class="empty-state-action-bar">\n                    <div class="import-google-contacts" ng-if="config.IS_MAC">\n                        <button ng-controller="ImportMacContactsCtrl" class="btn btn-primary" ng-click="findMacContacts()">Import Contacts from your Mac</button>\n                    </div>\n                    <div class="import-google-contacts" ng-if="!config.IS_MAC">\n                        <button ng-controller=" ImportGoogleContactsCtrl" class="btn btn-primary" ng-click="findGoogleContacts()">Import Google Contacts</button>\n                    </div>\n                </div>\n            </div>\n\n            <div class="invite-teammates-link" bo-if="showInviteTeammatesLink && !searchInProgress">\n                <a ng-click="openInviteTeammatesModal()">INVITE TEAMMATES</a>\n            </div>\n        </div>\n    </div>\n</div>\n'),a.put("chat/fullviewclient/templates/ChatsListHeader.tpl.html",'<div bindonce bo-show="thisUser">\n    <cnv-user-profile-image user-id="thisUser.userId" width="24" height="24"\n                                profileType="thisUser.profileImageType"\n                                profileVersion="thisUser.profileImageVersion" \n                                full-name="thisUser.firstName+\' \'+thisUser.lastName"\n                                style="position:absolute; left:15px;margin-top: -2px;">\n    </cnv-user-profile-image>\n    <div class="current-user-presence" bo-class="{\'listUserStatusOnline\': presenceStatus ==\'userOnline\',\n                            \'listUserStatusBusy\' : presenceStatus ==\'userBusy\',\n                            \'listUserStatusIdle\': presenceStatus ==\'userIdle\',\n                            \'listUserStatusOffline\' : presenceStatus ==\'userOffline\' || presenceStatus == \'userOfflineWithMobile\',\n                            \'listUserStatusMobile\' :  presenceStatus == \'userOnlineOnMobile\'}">\n    </div>\n\n    <div class="create-new-chat-btn" bo-click="createNewChat()"\n         bo-attr bo-attr-disabled="disableCreateNewChat">\n         <i class="headerIcon cnv-icons-20 chat_create_new_chat" ></i>\n    </div>\n    <div class="settingsIcon" style="">\n        <i class="headerIcon cnv-icons-20 chat_settings" ></i>\n        <cnv-dropdowns class="chatSettingsIconDropdown" cnv-dropdown-ctrl="userOptionsCtrl"></cnv-dropdowns>    \n    </div>\n</div>'),a.put("chat/fullviewclient/templates/ChatsListItem.tpl.html",'<div bindonce cnv-popover cnv-popover-ctrl="participantsList | chatParticipentsTooltipText: 0 : item.type == 2" cnv-popover-html-already-escaped="true" >\n\n    <div bo-if="item.banner" class="separator-title" bo-bind="item.banner"></div>\n    <div class="chat-renderer" bo-if="item.type==1 || item.type==2">\n        <cnv-user-profile-image bo-if="!item.chatIconUrl && item.users.length == 1" user-id="item.users[0].userId" size="81" width="40" height="40"\n                                profileType="item.users[0].profileImageType"\n                                profileVersion="item.users[0].profileImageVersion" full-name="item.users[0].firstName+\' \'+item.users[0].lastName">\n\n        </cnv-user-profile-image>\n\n\n        <div bo-if="!item.users[0].isInvitedUser() && item.type == 1" class="user-presence-container">\n            <div bo-if="(item.presenceStatus != \'userOfflineWithMobile\' && item.presenceStatus != \'userOnlineOnMobile\')"\n                 bo-class="{\'listUserStatusOnline\': item.presenceStatus ==\'userOnline\',\n                            \'listUserStatusBusy\' : item.presenceStatus ==\'userBusy\',\n                            \'listUserStatusIdle\': item.presenceStatus ==\'userIdle\',\n                            \'listUserStatusOffline\' : item.presenceStatus ==\'userOffline\'}"\n                            class="listUserStatus"></div>\n\n            <div bo-if="(item.presenceStatus == \'userOfflineWithMobile\' || item.presenceStatus == \'userOnlineOnMobile\')" class="user-inactive-time-field">\n                <span bo-if="item.presenceStatus == \'userOfflineWithMobile\'" class="user-inactive-time" bo-date="item.users[0].lastPingTime | dateAgo: null : true : true :false :true: \'shortDate\': true: true: true"></span>\n                <div class="listUserStatusMobile chat-list"></div>\n            </div>\n        </div>\n\n        <div bo-if="item.chatIconUrl" class="groupIconContainer">\n            <img bo-src="item.chatIconUrl"/>\n        </div>\n\n        <div class="chat-user-images-container" bo-if="!item.chatIconUrl && item.users.length > 1" bo-class="{\'two-images-container\' : item.users.length == 2, \'three-images-container\' : item.users.length == 3 && item.unDisplayedUsersCount == 0}" bindonce>\n            <cnv-user-profile-image class="chat-user-image-item" bo-repeat="user in item.users" user-id="user.userId" size="48" width="20" height="20"\n                                    profileType="user.profileImageType"\n                                    profileVersion="user.profileImageVersion" full-name="user.firstName+\' \'+user.lastName"></cnv-user-profile-image>\n            <div class="chat-users-count" bo-if="item.unDisplayedUsersCount > 0 && !item.chatIconUrl" bo-bind="\'+\'+(item.unDisplayedUsersCount)"></div>\n        </div>\n\n\n\n        <span class="chats-list-item-title" bo-bind="item.chat.getTitle()" bo-class="{\'chats-list-item-title-bold\' : item.chat.unreadCount && item.chat.unreadCount > 0}"></span>\n        <span class="chats-list-item-summary" bo-if="item.chat.participants[item.chat.thisUser.userId].status == \'left\' || !item.chat.isAnyParticipantComposing"\n              bo-bind="item.chat.getSummeryText()" bo-class="{\'boldText\': item.chat.isFetchedChat && item.chat.search_match}"></span>\n\n\n        <div bo-if="item.chat.isAnyParticipantComposing && item.chat.participants[item.chat.thisUser.userId].status != \'left\' " class="chat-list-item-composing-details">\n            <span bo-if="item.chat.chatType === 2" bo-bind="item.chat.composingParticipants[item.chat.composingParticipants.length - 1].name.split(\' \')[0]+\':\'"></span>\n                <div class="composingMessageFromOtherUser composingMessageFromOtherUserChatList">\n                <div class="dot1"></div>\n                <div class="dot2"></div>\n                <div class="dot3"></div>\n            </div>\n        </div>\n\n\n        <span class="chats-list-item-date" bo-date="item.chat.lastMessageTimestamp | dateAgo : null : true : true"></span>\n        <div class="chat-mute-unread-info-container">\n            <i bo-if="item.chat.isMuted" class="cnv-icons-20 icons2_Mute-lightgray chat-mute-icon"></i>\n            <span class="chat-unread-count" bo-if="item.chat.unreadCount && item.chat.unreadCount > 0"\n                 bo-bind="item.chat.unreadCount > 20 ? \'20+\': item.chat.unreadCount"></span>\n        </div>\n\n        <div bo-if="item.chat.shouldShowSeenParticipantsInList && item.chat.unreadCount == 0" class="chat-seen-container">\n            <span bo-if="item.chat.moreParticipantsCount"  class="chat-seen-counter-container" cnv-popover cnv-popover-ctrl="item.chat.seenParticipants | chatParticipentsTooltipText: 2: true" bo-click="openSeenNotificationDialog(item.chat.seenParticipants);">\n                <span class="seen-counter" bo-bind="item.chat.moreParticipantsCount"></span>\n            </span>\n            <span bo-repeat="seenParticipant in item.chat.seenParticipants | limitTo:(item.chat.moreParticipantsCount ? 2 : 3)" cnv-popover cnv-popover-ctrl="seenParticipant.name">\n                <cnv-user-profile-image user-id="seenParticipant.userId" full-name="seenParticipant.name" size="32" width="15" height="15">\n                </cnv-user-profile-image>\n            </span>\n        </div>\n\n    </div>\n\n    <div class="user-renderer" bo-if="item.type==3">\n        <cnv-user-profile-image  user-id="item.user.userId" size="81" width="40" height="40"\n                                profileType="item.user.profileImageType"\n                                profileVersion="item.user.profileImageVersion" full-name="item.user.firstName+\' \'+item.user.lastName">\n        </cnv-user-profile-image>\n        <span class="chat-list-item-user-name" bo-bind="item.user.getDisplayName()"></span>\n        <span bo-if="item.user.isInvitedUser()" class="chat-list-item-user-invited-icon cnv-icons-20 Icon1__Time-darkgray"></span>\n\n        <div bo-if="!item.user.isInvitedUser()" class="user-presence-container">\n            <div bo-if="(item.presenceStatus != \'userOfflineWithMobile\' && item.presenceStatus != \'userOnlineOnMobile\')"\n                bo-class="{\'listUserStatusOnline\': item.presenceStatus ==\'userOnline\',\n                            \'listUserStatusBusy\' : item.presenceStatus ==\'userBusy\',\n                            \'listUserStatusIdle\': item.presenceStatus ==\'userIdle\',\n                            \'listUserStatusOffline\' : item.presenceStatus ==\'userOffline\'}" \n                            class="listUserStatus"></div>\n\n            <div bo-if="(item.presenceStatus == \'userOfflineWithMobile\' || item.presenceStatus == \'userOnlineOnMobile\')" class="user-inactive-time-field">\n                <span bo-if="item.presenceStatus == \'userOfflineWithMobile\'" class="user-inactive-time" bo-date="item.user.lastPingTime | dateAgo: null : true : true :false :true: \'shortDate\': true: true: true"></span>\n                <div class="listUserStatusMobile chat-list"></div>\n            </div>\n        </div>\n    </div>\n\n    <div class="contact-renderer" bo-if="item.type==4">\n        <div class="chat-empty-user-img" bo-class="item.classes"></div>\n        <span class="chat-list-item-user-name" bo-bind="item.contact.getDisplayName()"></span>\n        <span cnv-popover cnv-popover-ctrl="Invite"\n              bo-mousedown="inviteContact($event, item);"\n              bo-class="{\'check-white check-invited-icon\': item.contact.isInvitedUser(), \'icons2_Add-blue\': !item.contact.isInvitedUser()}"\n              class="cnv-icons-20 add-invite-invited-icon contact-invite-icon"></span>\n    </div>\n    <div></div>\n</div>\n\n\n'),a.put("chat/fullviewclient/templates/MessagesSearchbar.tpl.html",'<div class="messages-search-bar" bindonce>\n    <div class="search-text-and-controls-container">\n        <div class="search-text" bo-bind="searchText"></div>\n        <div class="current-match-info" bo-bind="currentMatchInfo"></div>\n        <div class="match-btn next-match-btn" bo-click="loadNextMatch()"></div>\n        <div class="match-btn previous-match-btn" bo-click="loadPreviousMatch()"></div>\n    </div>\n    <div class="cancel-chats-search-icon search-close-btn" bo-click="cancelSearch()"></div>\n</div>'),a.put("chat/fullviewclient/templates/NewChatItem.tpl.html",'<div bindonce>\n\n    <div bo-if="newChatData.users.length == 0" class="chat-empty-user-img smiley-05 as-bg"></div>\n\n    <cnv-user-profile-image bo-if="newChatData.users.length == 1" class="chat-user-image"\n                            user-id="newChatData.users[0].userId" size="81" width="40" height="40"\n                            profileType="newChatData.users[0].profileImageType"\n                            profileVersion="newChatData.users[0].profileImageVersion" full-name="newChatData.users[0].firstName+\' \'+newChatData.users[0].lastName">\n\n    </cnv-user-profile-image>\n    <div class="chat-user-images-container" bo-if="newChatData.users.length > 1"\n         bo-class="{\'two-images-container\' : newChatData.users.length == 2, \'three-images-container\' : newChatData.usersToDisplay == 3 && newChatData.unDisplayedUsersCount == 0}">\n\n        <cnv-user-profile-image class="chat-user-image-item" bo-repeat="user in newChatData.users | limitTo: newChatData.usersToDisplay" user-id="user.userId" size="48" width="20" height="20"\n                                profileType="user.profileImageType"\n                                profileVersion="user.profileImageVersion" full-name="user.firstName+\' \'+user.lastName"></cnv-user-profile-image>\n        <div class="chat-users-count" bo-if="newChatData.unDisplayedUsersCount > 0 " bo-bind="\'+\'+(newChatData.unDisplayedUsersCount)"></div>\n    </div>\n    <span class="chats-list-item-title" bo-bind="newChatData.title"></span>\n    <div class="remove-new-chat-btn remove-new-chat-btn-position" bo-click="removeNewChat($event)"></div>\n</div>'),a.put("chat/fullviewclient/templates/NewChatUsersInput.tpl.html",'<div bindonce>\n    <tags-input class="to-field"\n                ng-model="userItems"\n                placeholder=""\n                pre-placeholder="To:"\n                no-tags-indicator="false"\n                add-on-comma="false"\n                add-on-blur="false"\n                horizontal-flow = "false"\n                add-from-autocomplete-only="true"\n                display-property="label"\n                replace-spaces-with-dashes="false"\n                allow-leftover-text="true"\n                on-esc-key-press="onEscKeyPressInToField()"\n                on-tag-added="onItemAddedInToField($tag)"\n                on-tag-removed="onItemRemovedInToField($tag)"\n                set-focus-on-load="true">\n        <auto-complete\n            source="queryAutoCompleteItemsAvailableLocally($query, numSelected)"\n            source2="queryAutoCompleteItemsFromServer($query, numSelected)"\n            load-history-on-focus="true"\n            auto-select-first-suggestion="true"\n            delimiter="@"\n            min-length="1"\n            suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n        </auto-complete>\n    </tags-input>\n</div>'),a.put("comments/cnvCommentLinkPreviewRenderer/cnvCommentLinkPreviewRenderer.tpl.html",'<div class="cnv-comment-link-preview" bindonce>\n    <a class="comment-link-preview-wrapper" bo-href="source" target="_blank" rel="noopener noreferrer" cnv-popover cnv-popover-ctrl="source">\n        <div bo-if="linkThumbnailUrl" class="link-thumbnail" bo-style="{\'background-image\': \'url(\' + linkThumbnailUrl + \')\'}"></div>\n\n        <div class="description" bo-class="{\'no-thumbnail\': !linkThumbnailUrl}">\n            \n            <div class="link-title">\n                <img bo-src="faviconUrl" />\n                <span class="title-inline-text" bo-bind="title"></span>\n            </div>\n            \n            <div class="preview-txt" bo-if="previewText">\n            <!-- (previewText | limitTo: 130) + (previewText.length > 130 ? \'...\' : \'\') -->\n                <span bo-html="previewText"></span>\n            </div>\n\n            <div class="domain" bo-if="domain">\n                <span bo-bind="domain"></span>\n            </div>\n\n        </div>\n    </a>\n</div>'),a.put("comments/commentEditor/cnvCommentEditor.tpl.html",'<div cnv-clicked-outside-this="cnvClickedOutsideThis(event)" bindonce>\n    <div bo-hide="checkIfCommentingClosed()" class="feed-comment-editor-cont" bo-class="{\'highlight\': active && focused, \'highlight-red\': commentsHasBeenBlocked, \'disabled\': commentEditorCtrl.permissions.disable}">\n        <input name=\'file\' class=\'comment-file-input\' type=\'file\' style="display: none;"></input>\n        <cnv-dropzone class="attachment-drop-zone" dropzone-id="{{::dropZone.id}}"></cnv-dropzone>\n        \n        <div class="dummy-text-area" bo-if="!active" ng-click="onDummyTextAreaClick()">Add a comment...</div>\n\n        <div class="feed-comment-editor-active-cont edit-mode" bo-if="active">\n            \n            <div class="dummy-sharing-overlay" ng-show="commentEditorCtrl.waiting">\n                <span class="cnv-spinner"></span>\n            </div>\n\n            <div ng-if="commentEditorCtrl.snippetData" class="note-snippet">\n                <div class="content" ng-class="commentEditorCtrl.snippetData.classes">\n                    <span ng-if="commentEditorCtrl.snippetData.fileViewerTextAnnotation" ng-bind="commentEditorCtrl.snippetData.snippetData.data.text | limitToWithEllipsis: true: 100"></span>\n                    <img ng-if="!commentEditorCtrl.snippetData.fileViewerTextAnnotation" ng-src="{{getEditCommentSnippetImage()}}"></img>\n                    <i class="cross" ng-click="removeCommentEditorSnippetData()"></i>\n                </div>\n                <div ng-if="commentEditorCtrl.snippetData.snippetData && commentEditorCtrl.snippetData.snippetData.data.forVideo" class="video-info">\n                    <i class="video-indicator"></i>\n                    <span class="video-time-info" ng-bind="commentEditorCtrl.snippetData.snippetData.data.currentTimeString"></span>\n                </div>\n            </div>\n\n            <cnv-editor cnv-text-editor-mode="basic"\n                        cnv-text-editor-ctrl="textEditorCtrl" \n                        cnv-hashtags="getHashtags($query)" \n                        cnv-text-editor-on-url-added="onUrlAddedInCommentEditor(data)"\n                        cnv-at-mentions="getShareWithDropdownItems($query, delimiter, 0)"\n                        cnv-at-mentions-suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html"\n                        cnv-text-editor-on-esc-key-press="onEscKeyPressInTextEditor()"\n                        cnv-text-editor-submit-on-enter="onTextEditorSubmitOnEnter()"\n                        cnv-on-at-mention-added="onAtMentionAdded(item)"\n                        cnv-on-command-executed="onCommandExecuted(item, search)"\n                        cnv-on-at-mention-removed="onAtMentionRemoved(item)"\n                        cnv-text-selection-removed="onSelectionRemoved($atMentionNodes)"\n                        cnv-text-editor-on-focus-out="onFocusOut()"\n                        cnv-editor-source="Comment"\n                        cnv-text-editor-on-space-key-press="spaceKeyPressedInTextEditor()"\n                        cnv-text-editor-on-tab-key-press="tabKeyPressedInTextEditor()"\n                        cnv-text-editor-on-enter-key-press="enterKeyPressedInTextEditor()"\n                        >\n            </cnv-editor>\n\n            <div ng-if="commentEditorCtrl.link.linkResolveCtrl" cnv-share-link cnv-link-resolver-ctrl="commentEditorCtrl.link.linkResolveCtrl" disable-link-editing-options="true" class=\'link-insert-container comment-share-link\'></div>\n\n            <div ng-if="commentEditorCtrl.attachments.initialized" \n                 cnv-upload-files-ui-manager \n                 cnv-upload-files-ui-manager-ctrl="commentEditorCtrl.attachments.controllers.manager_controller" \n                 cnv-insert-add-item-options-ctrl="commentEditorCtrl.attachments.controllers.file_input_controller" \n                 class="filesUploadContainer">\n            </div>\n\n            <cnv-upload-from-url\n                cnv-file-context="commentEditorCtrl.attachments.file_input_upload_context.context">\n            </cnv-upload-from-url>\n        </div>\n\n        <div class="comment-action-bar" bo-if="!onBoardingEnabled && (active || alwaysActiveActionbar)">\n            <cnv-emoji-popover cnv-emoji-fixed-on-scroll="false" cnv-editor-name="editorCtrl" class="comment-action cnv-icons-18"></cnv-emoji-popover>\n            <span ng-class="{\'disabled\': !commentEditorCtrl.allowAttachments}" class="comment-action anim file-chooser icons2_Attach-darkgray cnv-icons-18" ng-click="openFileChooser()"></span>\n            <span bo-if="showGiphy" ng-class="{\'disabled\': !commentEditorCtrl.allowAttachments}" class="comment-action anim gif-attachment cnv-icons-18">\n                <cnv-giphy-popover cnv-file-context="commentEditorCtrl.attachments.file_input_upload_context.context"\n                                   cnv-giphy-information="giphyObject" cnv-giphy-icon-class="giphy"\n                                   cnv-giphy-custom-classes="\'comment-editor\'" cnv-giphy-relative-to-body="true"\n                                   cnv-giphy-mixpanel-info="RightCommentsPanel"></cnv-giphy-popover>\n            </span>\n        </div>\n    </div>\n\n    <!-- <div class="attach-context" bo-if="commentEditorCtrl.commentEdit && commentEditorCtrl.snippetData.classes==\'detail_snippet\'">\n        <input type="checkbox" ng-click="onAttachContextChanged();" checked> <span>Attach context</span>\n    </div> -->\n\n    <div class="editor-at-mention-alert" bo-if="!commentEditorCtrl.permissions.block && commentEditorCtrl.showAtMentionAlert">\n        <i class="flag"></i>\n        <span bo-show="!commentEditorCtrl.permissions.allowLegitAtMentions" >This post will be shared with anyone tagged in your comment</span>\n        <span bo-show="commentEditorCtrl.permissions.allowLegitAtMentions" >You\'re only allowed to @mention those this post is already shared with</span>\n    </div>\n\n    <div class="meta comments-closed-alert" bo-class="{\'t-padding\': (commentsHasBeenBlocked && active)}" bo-if="commentEditorCtrl.permissions.block">\n        <i bo-if="commentsHasBeenBlocked" class="flag"></i>\n        <span bo-if="!commentsHasBeenBlocked" bo-html="commentEditorCtrl.permissions.message"></span>\n        <span bo-if="commentsHasBeenBlocked">You no longer have permissions to comment on this post</span>\n    </div>\n</div>\n'),
a.put("common/alerts/templates/alertModal.tpl.html",'<div class="modal-header">\n    <h4><span class="glyphicon glyphicon-check"></span> {{title}}</h4>\n    <button ng-if="!dontShowCloseBtn" type="button" class="close" ng-click="close()">\xd7</button>\n</div>\n<div class="modal-body">\n    <p ng-bind-html="text"></p>\n</div>\n<div class="modal-footer">\n    <button type="button" class="btn btn-primary" ng-click="ok()" autofocus>{{okBtnLabel}}</button>\n</div>\n'),a.put("common/alerts/templates/errorModal.tpl.html",'<div class="modal-header">\n    <h4><span class="glyphicon glyphicon-warning-sign"></span> {{title}}</h4>\n    <button type="button" class="close" ng-click="close()">\xd7</button>\n</div>\n<div class="modal-body">\n    <p>{{text}}</p>\n</div>\n<div class="modal-footer">\n    <button type="button" class="btn btn-primary" ng-click="ok()" autofocus>{{okBtnLabel}}</button>\n</div>'),a.put("common/alerts/templates/promptModal.tpl.html",'<div class="modal-header">\n    <h4>\n    	<span ng-if="showHeaderIcon && !customHeaderIcon" class="glyphicon glyphicon-info-sign"></span>\n    	<span ng-if="showHeaderIcon && customHeaderIcon" ng-class="customHeaderIcon"></span> \n    	{{title}}\n    </h4>\n    <button ng-if="!dontShowCloseBtn" type="button" class="close" ng-click="close()">\xd7</button>\n</div>\n<div class="modal-body" bindonce>\n    <p bo-html="text"></p>\n</div>\n<div class="modal-footer">\n    <button type="button" class="btn btn-primary" ng-click="ok()" autofocus>{{okBtnLabel}}</button>\n    <button type="button" class="btn btn-default" ng-click="cancel()">{{cancelBtnLabel}}</button>\n</div>'),a.put("common/cnvInviteTeammates/templates/cnvFindContactsPermissionDenied.tpl.html",'<div class="modal-header">\n    <h4>Convo does not have permission  to access your contacts</h4>\n    <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n</div>\n<div class="modal-body">\n	<div ng-if="VIEW === VIEWS.MAC" class="error-message">\n    	<div>Open <strong>System Preferences</strong> and select the <strong>Security & Privacy</strong> pane, then the <strong>Privacy tab</strong>.<br>Select <strong>Contacts</strong> and <strong>check Convo</strong> to allow permissions.</div>\n\n    	<div class="help-image">\n    		<img src=\'assets/img/contacts/mac-contacts-no-permission.png\'/>\n    	</div>\n    </div>\n</div>\n<div class="modal-footer">\n    <button type="button" class="btn btn-primary" ng-click="dismiss()">Got it</button>\n</div>\n'),a.put("common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",'<div class="find-teammates" suppress-scroll-propagation>\n    <section ng-if="VIEW === VIEWS.PERMISSION" 	ng-include="\'common/cnvInviteTeammates/templates/cnvFindTeammatesPermissionView.tpl.html\'"></section>\n    <section ng-if="VIEW === VIEWS.PROCESSING" 	ng-include="\'common/cnvInviteTeammates/templates/cnvFindTeammatesWaitingView.tpl.html\'"></section>\n    <section ng-if="VIEW === VIEWS.COMPLETE" 	ng-include="\'common/cnvInviteTeammates/templates/cnvInviteTeammatesResponseView.tpl.html\'"></section>\n    <section ng-if="VIEW === VIEWS.VANITY_URL" 	ng-include="\'common/cnvInviteTeammates/templates/cnvInviteTeammatesVaniyUrlView.tpl.html\'"></section>\n</div>\n'),a.put("common/cnvInviteTeammates/templates/cnvFindTeammatesPermissionView.tpl.html",'<div class="find-mac-contacts-container">\n    <div class="modal-body">\n        <div class="heading">Convo works better with your team</div>\n        <div class="description" ng-if="!accountInfo.shouldInviteGuestsAsFullMembers()" >See teammates who aren\'t on<br>the <span ng-bind="accountInfo.getPrimaryAccountDomain().user_email_domain"></span> network yet.</div>\n        <div class="description" ng-if="accountInfo.shouldInviteGuestsAsFullMembers()" >See teammates who aren\'t here yet.</div>\n        <div class="actions">\n            <div><button class="btn btn-default" ng-click="continue()">Import contacts from your Mac</button></div>\n            <div><a class="dismiss" href="javascript:void(0);" ng-click="dismiss()">Not now</a></div>\n        </div>\n    </div>\n    <div class="modal-footer">\n        Convo is committed to protecting your privacy and has world-class data protection.<br>\n        Read more about how your data is protected in our <a>Privacy</a> and <a>Security</a> Policy.\n    </div>\n</div>\n'),a.put("common/cnvInviteTeammates/templates/cnvFindTeammatesWaitingView.tpl.html",'<div class="find-mac-contacts-container">\n    <div class="modal-body" ng-class="{\'low-padding\': longProcessing}">\n        <div class="heading">Finding teammates...</div>\n        <div class="waiting" ng-class="{\'low-padding\': longProcessing}">\n            <img src="assets/img/common/preloader.gif"/>\n        </div>\n\n        <div ng-if="longProcessing" class="actions animate">\n            <div>\n                <a href="javascript:void(0);" ng-click="hide()"><strong>Hide this</strong></a>\n            </div>\n            <div class="blue dismiss-message">\n                <span><strong>This can take a few minutes if you have many contacts.<br>We\'ll let you know when we\'re done.</strong></span>\n            </div>\n        </div>\n    </div>\n    <div class="modal-footer">\n        Convo is committed to protecting your privacy and has world-class data protection.<br>\n        Read more about how your data is protected in our <a style="text-decoration: underline;">Privacy</a> and <a style="text-decoration: underline;">Security</a> Policy.\n    </div>\n</div>\n'),a.put("common/cnvInviteTeammates/templates/cnvInviteTeammates.tpl.html",'<div class="inv-teammates">\n    <input bo-if="invtTeammtCtrl.isNotShowingAutoComplete" class="email" ng-model="invtDetails.email" placeholder="{{placeholderText}}" spellcheck="false"/>\n    <div bo-if="!invtTeammtCtrl.isNotShowingAutoComplete" class="to-field-cont">\n        <tags-input ng-model="invitedTo"\n        placeholder="{{placeholderText}}"\n        add-on-comma="true"\n        add-on-blur="true"\n        horizontal-flow = "true"\n        add-from-autocomplete-only="false"\n        display-property="label"\n        replace-spaces-with-dashes="false"\n        allowed-tags-pattern="^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$"\n        on-tag-added="onItemAddedInToField($tag)"\n        on-text-pasted="onTextPasted(text)">\n        <auto-complete\n            source="getAutoCompleteUserItemsToInvite($query, numSelected)"\n            load-history-on-focus="true"\n            delimiter="@"\n            min-length="1"\n            auto-select-first-suggestion="true"\n            suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n        </auto-complete>\n        </tags-input>\n    </div>\n    \n    <button class="btn btn-primary" ng-click="inviteTeammate()">Invite</button>\n    <span ng-if="!invtTeammtCtrl.group && !shouldInviteGuestsAsFullMembers">\n        <span class="meta" style="margin: 0px 20px">or</span>\n        <button class="btn btn-default" ng-click="shareableInviteLink()">Get shareable invite link</button>\n    </span>\n    \n    <div class="inv-options">\n        <a href="javascript:void(0)" ng-click="inviteFromAddressBk()">Invite from address book</a>\n    </div>\n</div>'),a.put("common/cnvInviteTeammates/templates/cnvInviteTeammatesResponseView.tpl.html",'<div class="find-mac-contacts-container">\n    <div class="modal-body">\n        <span class="cross" ng-click="dismiss()">\xd7</span>\n        <div class="complete-status">\n            <div class="complete-status-icon"><span class="check-white"></span></div>\n            <div ng-if="inviteResult.totalInvitesSent > 1" class="message">{{inviteResult.totalInvitesSent}} invitations sent!</div>\n            <div ng-if="inviteResult.totalInvitesSent == 1" class="message">Invitation sent!</div>\n            <!-- <div class="error-message" ng-show="inviteResult.users_not_invited.length">{{inviteResult.users_not_invited.length}} invitations could<br>not be sent.\n                <span class="details" ng-click="showErrorPopup()">See Details</span>\n                <span class="message-popup" ng-show="showErrorDetails">\n                    <span class="popup-text">The following people could<br>not be invited. Please try again.<br><br>\n                        <span ng-repeat="user in inviteResult.users_not_invited">\n                            <span ng-bind="user.invitee_email"></span><br>\n                        </span>\n                    </span>\n                </span>\n            </div> -->\n        </div>\n\n        <div ng-if="!accountInfo.shouldInviteGuestsAsFullMembers()" class="actions lower-margin" ng-show="inviteResult.invitedTo == \'NETWORK\'">\n            <div class="md-action-title">Copy and share this invite link to get<br>your team in faster</div>\n            <div class="sticky-input-button">\n                <input cnv-auto-selected ng-keydown="onInputKeyDown($event)" tabindex="0" ng-model="vanityURL"/>\n                <span class="message-popup">Press {{commandSymbol}} - C to copy</span>\n            </div>\n        </div>\n    </div>\n    <div class="modal-footer"></div>\n</div>\n'),a.put("common/cnvInviteTeammates/templates/cnvInviteTeammatesVaniyUrlView.tpl.html",'<div class="find-mac-contacts-container vanity-url-wrapper">\n    <div class="modal-body">\n        <span class="cross" ng-click="dismiss()">\xd7</span>\n        <div class="item-container">\n            \n            <div class="network-heading">\n                <span>{{::accountInfo.getAccountName()}}\'s Invite Link</span>\n            </div>\n            \n            <div class="network-help-text">\n                <span>Your teammates will use this link to sign up to your company\'s network.<br />Copy the link below and send it over via text message, chat or email.</span>\n            </div>\n            \n            <div class="actions">\n                <div class="sticky-input-button">\n                    <input cnv-auto-selected onClick="this.select();" ng-keydown="onInputKeyDown($event)" tabindex="0" ng-model="vanityURL" />\n                    <span ng-if="isNative" class="message-popup native" ng-click="copyToClipboardNatively($event)">Press {{commandSymbol}} - C to copy</span>\n                    <span ng-if="!isNative" class="message-popup">Press {{commandSymbol}} - C to copy</span>\n                </div>\n            </div>\n\n            <hr />\n\n            <a ng-if="isNative" class="email-btn" href="mailto:?subject={{::inviteEmailSubject}}&body={{::inviteEmailBody}}" target="_blank" rel="noopener noreferrer">\n                <button class="btn btn-default"><i class="cnv-icons-20 icons_Email-blue"></i>Send an email with this link</button>\n            </a>\n\n            <a ng-if="!isNative" class="email-btn" href="mailto:?subject={{::inviteEmailSubject}}&body={{::inviteEmailBody}}">\n                <button class="btn btn-default"><i class="cnv-icons-20 icons_Email-blue"></i>Send an email with this link</button>\n            </a>\n\n        </div>\n\n        <!-- <div class="actions lower-margin"> -->\n            <!-- <div class="md-action-title">Copy this link and share with your team\n                <br>via chat or email\n            </div> -->\n            \n        <!-- </div> -->\n    </div>\n    <div class="modal-footer"></div>\n</div>\n'),a.put("common/dialogBox.tpl.html","<div class='dialog-title'>{{dialogTitleText}}</div>\n<div class=\"dialog-message\">{{dialogMessageText}}</div>\n<div class=\"dialog-button\">\n  <input type='button' value='OK' ng-Click='onOK();'/>\n  <input type='button' value='Cancel' ng-Click='onCancel();'/>\n</div>"),a.put("common/dialogs/templates/cnvResolveLinkModal.tpl.html",'<div class="modal-header">\n    <h4>Insert link</h4>\n    <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n</div>\n\n<form name="addPinContent" ng-submit="onSubmit()" role="form">\n\n	<div class="modal-body">\n	    <div class="form-group">\n	      <span>Link (url)</span>\n	      <input class="form-control" name="url" ng-model="data.url" ng-change="onChange()" ng-paste="onPaste()" ng-class="{\'ng-invalid-url\': !validateUrl(), \'ng-invalid-required\': !data.url }" cnv-autofocus required>\n	    </div>\n	    <div class="form-group">\n	      <span>Text to display</span>\n	      <input type="text" class="form-control" name="resource_name" ng-model="data.resource_name" maxlength="255" spellcheck="false">\n	    </div>\n\n\n	    <div  class="suggestion-link" ng-show="suggestedTitle != data.resource_name && suggestedTitle!=\'\' && !resolving">\n	    	<a href="javascript:void(0)" ng-click="setSuggestedTitle()">Display this: </a>\n	    	<span  class="suggestion-text" ng-bind="suggestedTitle"></span>\n	    </div>\n\n	    <div class="suggestion-link" ng-show="resolving">\n	    	<span ng-show="resolving" class="suggestion-text">Resolving...</span>\n	    </div>\n\n	    <a class="test-link" href="javascript:void(0);" ng-disabled="!data.url" ng-click="test()">Test Link</a>\n\n	</div>\n	\n	<div class="modal-footer">\n	    <button type="submit" class="btn btn-primary" ng-disabled="!data.url">Insert</button>\n	</div>\n\n</form>\n'),a.put("common/dialogs/templates/dialogFooter.tpl.html",'</div>\n		<div class="modal-footer">\n			\n			<button type="button" class="btn btn-warning" ng-show="cancelBtn" ng-click="cancel()">\n				<span ng-if="cancelBtnText">{{cancelBtnText}}</span>\n				<span ng-if="!cancelBtnText">Cancel</span>\n			</button>\n		    \n		    <button type="button" class="btn btn-primary" ng-show="okBtn" ng-click="ok()" autofocus>\n		    	<span ng-if="okBtnText">{{okBtnText}}</span>\n		    	<span ng-if="!okBtnText">Ok</span>\n		    </button>\n\n		    <button type="submit" class="btn btn-primary" ng-show="submitBtn">\n		    	<span ng-if="submitBtnText">{{submitBtnText}}</span>\n		    	<span ng-if="!submitBtnText">Submit</span>\n		    </button>\n		</div>\n	</form>\n</div>'),a.put("common/dialogs/templates/dialogHeader.tpl.html",'<div class="dialog-modal">\n	<div class="modal-header">\n	    <h4>{{title}}</h4>\n	    <button type="button" class="close" ng-click="cancel()">\xd7</button>\n	</div>\n	<form ng-submit="submit()">\n		<div class="modal-body">'),a.put("common/directives/cnv-add-members/cnv-add-members.tpl.html",'<div class="add-members-container">\n\n    <div class="add-members-input-container">\n        <img class="profile-img-placeholder" src="assets/img/smilies/smiley-08.svg">\n        <input \n        ng-keyup="handleKeyup($event, addMembersSearchField);"\n        class="add-members-search-field" \n        ng-model="addMembersSearchField" \n        placeholder="{{defaultPlaceholder}}" \n        type="text">\n    </div>\n\n    <!-- search members section -->\n    <div ng-show="postCreatorsSearch.length > 0" class="search-members">\n        <ul class="search-members-list-container">\n            <li ng-repeat="poster in postCreatorsSearch | limitTo: 4" \n            class="search-item"\n            ng-click="addMember(poster)">\n                <div>\n                    <img class="profile-img" ng-if="poster.profileImages[\'64x64\']" ng-src="{{poster.profileImages[\'64x64\']}}">\n                    <img class="profile-img" ng-if="!poster.profileImages[\'64x64\']" ng-src="assets/img/smilies/smiley-08.svg">\n                    <p class="user-info" ng-bind-html="getFormattedName(poster.first_name + \' \' + poster.last_name, addMembersSearchField)"></p>\n                    <span ng-if="poster.isAlreadyPostCreator" class="pull-right already-added-text">ADDED</span>\n                </div>\n            </li>\n        </ul>\n    </div>\n    <!-- search members section end -->\n\n</div>\n'),a.put("common/listItemRenderers/contactListItem.tpl.html",'<div class="img-label-list-item contact" ng-class="{\'img-label-list-item-tags\': !item.type}" ng-style="{\'line-height\': item.formatteddesclabel ? \'normal\' : \'35px\'}">\n	<cnv-user-profile-image ng-if="item.type == \'USER\'" classes="item.classes" img-url="item.imgurl" user-id="item.id" ></cnv-user-profile-image>\n	<i ng-if="item.type && item.type != \'USER\'" ng-class="item.classes"></i>\n	<!-- <img ng-if="item.type!=\'USER\'" ng-src="{{item.imgurl}}" class="usr-img-32"/> -->\n	<span ng-bind-html="item.formattedlabel"></span>\n	<span ng-show="item.formatteddesclabel" ng-bind-html="item.formatteddesclabel"></span>\n</div>\n'),a.put("common/listItemRenderers/imgLabelListItem.tpl.html","<div class=\"img-label-list-item\" ng-class=\"{'list-separator': item.type=='SEPARATOR','error-list-item': item.type=='ERROR', 'img-label-list-item-tags': !item.type, 'removed': item.removed, 'invited': item.invited}\" ng-style=\"{'line-height': item.formatteddesclabel ? 'normal' : '35px', 'padding-left': item.type == 'STAG' ? '10px' : '41px'}\">\n	<cnv-user-profile-image class=\"single-user\" ng-if=\"item.type != 'SEPARATOR' && item.type != 'STAG' && (item.type == 'USER' || item.type === 'LINK' || item.type === 'POST' || item.type === 'CHAT' || (item.type === 'recentSearches' && item.id))\" classes=\"item.classes\" img-url=\"item.imgurl\" user-id=\"item.id\" width=\"32\" height=\"32\"></cnv-user-profile-image>\n	<div ng-if=\"item.type === 'GROUP_CHAT' && item.chaticonurl\" class=\"groupIconContainer\">\n          <img ng-src=\"{{item.chaticonurl}}\"/>\n     </div>\n	<div class=\"chat-user-images-container\" ng-if=\"item.type === 'GROUP_CHAT' && !item.chaticonurl && item.type != 'STAG'\" ng-class=\"{'two-images-container': item.users.length == 2, 'three-images-container': item.users.length == 3 && item.undisplayeduserscount == 0}\">\n"+'		<cnv-user-profile-image class="chat-user-image-item" ng-repeat="user in item.users" user-id="user.userId" size="48" width="20" height="20"\n			profileType="user.profileImageType"\n			profileVersion="user.profileImageVersion" full-name="user.firstName+\' \'+user.lastName">\n		</cnv-user-profile-image>\n\n		<div class="chat-users-count" ng-if="item.undisplayeduserscount > 0 " ng-bind="\'+\'+(item.undisplayeduserscount)"></div>\n	</div>\n\n	<i ng-if="item.type != \'SEPARATOR\' && item.type != \'STAG\' && item.type != \'USER\' && (item.classes || item.secondaryIconClass)" ng-class="item.classes || item.secondaryIconClass"></i>\n	<!-- <img ng-if="item.type!=\'USER\'" ng-src="{{item.imgurl}}" class="usr-img-32"/> -->\n	<span ng-bind-html="item.formattedlabel | escapeHtmlXSS" ng-style="{\'width\': item.labelbadge ? \'80%\' : \'100%\' }" ng-class="{\'stag-color\' : item.stag}"></span>\n    \n    <span class="list-item-status light" ng-if="item.invited">Invited</span>\n    <span class="list-item-status light" ng-if="item.removed">Removed</span>\n\n	<span ng-if="!item.dontEscapeDescLabelHtmlXSS" ng-show="item.formatteddesclabel" ng-bind-html="item.formatteddesclabel | escapeHtmlXSS" class="sec-label" ng-class="{\'truncate-text\' : item.type === \'GROUP_CHAT\'}"></span>\n	<span ng-if="item.dontEscapeDescLabelHtmlXSS" ng-show="item.formatteddesclabel" ng-bind-html="item.formatteddesclabel" class="sec-label" ng-class="{\'truncate-text\' : item.type === \'GROUP_CHAT\'}"></span>\n	<span ng-if="item.desclabeltail" ng-bind="item.desclabeltail" class="sec-label"></span>\n\n	<span ng-if="item.labelbadge" ng-bind-html="item.labelbadge" class="label-badge"></span>\n	<a ng-if="item.seclink" ng-bind-html="item.seclink" href="{{item.seclinkurl}}" class="sec-link"></a>\n</div>\n'),a.put("common/templates/threeDotSpinner.tpl.html",'<div class="spinner">\n    <div class="bounce1"></div>\n    <div class="bounce2"></div>\n    <div class="bounce3"></div>\n</div>'),a.put("common/userProfileImage/cnvUserProfileImage.tpl.html",'<div class="user-profile-image img-circle" ng-bind="initials" ng-style="{ \'background-color\': colorScheme }"></div>'),a.put("common/videoPlayer/cnvVideoPlayer.tpl.html",'<div class="holderDiv" tabindex="-1" id=\'videoPlayer{{::file.id}}\'>\n		<input type="text" class="activeElem ignore-key-down" style="width:0px; height:0px; position:absolute; opacity:0.01" />\n		<video bo-show="videoURL" bindonce class="feedVideoPlayer" preload="none">\n		  <source type="video/mp4">\n		Your browser does not support the video tag.\n		</video>\n		<canvas class=\'videoPreview\'></canvas>\n		<div bo-show="videoURL" class="feedVideoPlayerControls">\n			<div class="feedVideoPlayerHeader" ng-show="playerOptions.showHeader && !isFullScreen">\n				<div class="headerNameHolder">{{::file.name}}</div>\n				<div class="headerClose">\n					<span class="cnv-icons-12 icons2_Close-white"></span>\n				</div>\n			</div>\n			\n			<div class=\'spinerHolder\'>\n				<span class="cnv-spinner light"></span>\n			</div>\n			<div class="feedVideoPlayerBody">\n				\n			</div>\n			<div class="closeFullScreen"> \n				<span class="cnv-icons-12 icons2_Close-white" ng-show="isFullScreen"></span>\n			</div>\n			<div class="feedVideoPlayerFooter">\n				<div class="pauseBtn">\n					<!-- <span class="pause_icon"></span> -->\n					<span class="pause_icon" ng-hide="videoPlayerIsPaused"></span>\n					<span class="play_icon" ng-show="videoPlayerIsPaused"></span>\n				</div>\n				<div class="seekbarHolder">\n					<div class="seekbar">\n						<div class="seekbarBufferHolder">\n							<div class="seekbarBuffer"></div>\n						</div>\n						<div class="seekbarCurrent"></div>\n					</div>	\n				</div>\n				<div class="time">\n					{{showCurrentTime}}/{{showDuration}}\n				</div>\n				<div style="position:relative;float: left;">\n					<div class="volumeBarHolder">\n						<div class="volumeBar">\n							<div class="volumeBarBase"><div class="volumeBarTop"></div></div>\n						</div>\n					</div>\n				</div>\n				<div class="volume">\n					<!-- <span class="volume_icon" ng-hide="isMuted && videoVolume > 0"></span>\n					<span class="mute_icon" ng-show="isMuted && videoVolume == 0"></span> -->\n					<span class="volume_icon" ng-show="(!isMuted && videoVolume >= 0.5) || (!videoVolume && !videoLoaded)"></span>\n					<span class="volume_mid_icon" ng-show="!isMuted && videoVolume > 0 && videoVolume < 0.5"></span>\n					<span class="mute_icon" ng-show="isMuted || videoVolume <= 0"></span>\n				</div>\n					\n				\n\n					<div class=\'hdPannel\'>\n'+"						<div class='option' ng-class=\"{'active': resolutionPlaying===1080}\" ng-click='changeQuality(1080)' ng-show='canPlayVideoType.canPlay1080'>\n							<span class='circle'></span>\n							1080p <span class='hd'>HD</span>\n						</div>\n						<div class='option' ng-class=\"{'active': resolutionPlaying===720}\" ng-click='changeQuality(720)' ng-show='canPlayVideoType.canPlay720'>\n							<span class='circle'></span>\n							720p <span class='hd'>HD</span>\n						</div>\n						<div class='option' ng-class=\"{'active': resolutionPlaying===480}\" ng-click='changeQuality(480)' ng-show='canPlayVideoType.canPlay480'>\n							<span class='circle'></span>\n							480p\n						</div>\n					</div>\n\n				<div class=\"hdplay\">\n					<span class=\"hd_icon\" ng-class=\"{'hd_on_icon':resolutionPlaying>=720,'hd_off_icon':resolutionPlaying==480, 'hd_off_icon_hover': (resolutionPlaying===480 && (canPlayVideoType.canPlay1080 || canPlayVideoType.canPlay720))}\"></span>\n				</div>\n\n				<div class=\"menuBar\" bo-if=\"playerOptions.showControlsMenu\">\n					<cnv-dropdowns bo-if=\"dropdownCtrl.options.length > 0\" cnv-dropdown-ctrl=\"dropdownCtrl\"></cnv-dropdowns>\n				</div>\n\n				<div class=\"resize\">\n					<span class=\"collapse_icon\" ng-show='isFullScreen'></span>\n					<span class=\"expand_icon\" ng-hide='isFullScreen'></span>\n				</div>\n\n			</div>\n		</div>\n\n		<div bo-hide=\"videoURL\" bindonce class=\"previewNotAvailable\">\n			<center>No preview available</center>\n		</div>\n</div>"),a.put("common/videoThumbnail/cnvVideoThumbnail.tpl.html",'<div class="videoThumbnailHolder" cnv-popover cnv-popover-ctrl="file.tooltip" popover-data-id="cnv-13" style=\'width: {{::file.thumbWidth}}px; height: {{::file.thumbHeight}}px;\'>\n    <img bo-style="file.thumbStyle" data-thumb="{{::file.thumbnail_image}}" bo-src="file.thumbnail_image">\n    <i class="cnv-icons-64 icons_Video-darkgray" bo-style=\'file.iconStyle\'></i>\n    <video style="background:#000; display:none;" width="{{::file.thumbWidth}}" height="{{::file.thumbHeight}}" preload="none">\n      <source  type="video/mp4">\n        Your browser does not support the video tag.\n    </video>\n    <div class="videoHoverIcon" style=\'display:none;\'></div>\n</div>'),a.put("components/authCodesModal/cnvAuthCodes.tpl.html",'<div suppress-scroll-propagation>\n    <div class="modal-header">\n        <h4 class="title">Print out your backup codes</h4>\n        <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n    </div>\n    <div class="modal-body">\n        <p class="backup-code-note">\n            Print out your backup codes, and store it somewhere safe. \n             If you lose access to your authentication device, \n             you can use one of these backup codes to login to your account. \n             Each code may be used only once.\n        </p>\n\n        <div class="print" style="display: none;">{{::accountName}} two-factor authentication backup codes - Convo</div>\n\n        <div class="backup-codes-wrap">\n            <span ng-if="copiedText" class="copied-text">Copied</span>\n            <ul class="backup-codes">\n                <li ng-repeat="backupCode in backupCodes">\n                    <span ng-bind="backupCode.backup_code" ng-class="{\'used\': backupCode.consumed_at}"></span>\n                </li>\n            </ul>\n\n            <div class="backup-codes-options">\n                <button class="btn" onclick="window.print()">Print Codes</button>\n                <button class="btn" ng-click="copyCodes()">Copy Codes</button>\n            </div>\n        </div>\n\n\n        <div class="modal-footer">\n            <button class="btn btn-primary" ng-click="close()">Done</button>\n        </div>\n    </div>\n</div>\n'),a.put("components/cnvBanners/cnvBanners.tpl.html",'<div bindonce class="banners-cont" bo-show="bannersStack.length > 0">\n\n    <div bo-repeat="b in bannersStack" class="banner">\n     <span style="float: right;cursor: pointer;  margin-top: -1px;" bo-if="b.showCloseBtn"\n           ng-click="onBannerCloseBtnClick(b.id)">\n     <i class="cnv-icons-8 icons2_Close-darkgray"></i>\n  </span>\n        <span bo-html="b.displayText" ng-click="onBannerTextClick($event, b.id)"></span>\n    </div>\n</div>\n'),a.put("components/cnvInputIncrementBox/cnvInputIncrementBox.tpl.html",'<input ng-model="cnvInputIncrementBox.value" class="input-field" type="number">\n<div class="caret-holder">\n	<div class="down" ng-click="increment()"><span class="caret caret-reversed"></span></div>\n	<div ng-class="{\'disabled\':cnvInputIncrementBox.disabled}" class="up" ng-click="decrement()"><span class="caret"></span></div>\n</div>'),a.put("components/cnvLogoWithFeedDirtyIndicator/cnvLogoWithFeedDirtyIndicator.tpl.html",'<a href="#/feed" ng-click="$emit(\'networkLogoClicked\', $event)" class="inline-control company-logo">\n			<span class="logo-bound">\n				<img class="logo" bo-src="networkLogo" />\n				<span ng-class="{\'red-dot\': feedDirty}"></span>\n			</span>\n</a>\n<a href="#/feed" ng-show="isFullChatView" ng-click="$emit(\'networkLogoClicked\', $event)" bo-bind="accountInfo.getAccountName() | limitTo: 20"\n class="header-company-name" style="color: #333;font-size: 18px;line-height: 55px;margin: 20px; "></a>'),a.put("components/cnvNetworkAlert/cnvNetworkAlert.tpl.html",'<div bo-if="doShow" class="network-alert-cont" bo-class="bgClass">\n    <div style="margin: 0 auto">\n        <i class="pilot-icon Convo_pilot-01"></i>\n        <p class="text-cont" bo-html="contentHtml"></p>\n    </div>\n    <i bo-if="showCloseBtn" class="close-btn cnv-icons-10 icons2_Close-white" bo-click="dismissAlert()" title="Dismiss"></i>\n</div>'),a.put("components/combinedSetProfilePictureModal/combinedSetProfilePictureModal.tpl.html",'<section bindonce cnv-combined-set-profile-picture-modal>\n	<input id="combinedProfileUploadInput" type="file" name="headerDpUploadInput" style="width: 1px; height: 1px; display: block; position: absolute; z-index: 19999; top: -1000px; left: -1000px;" />\n	<div class="modal-header">\n		<h4>Add your photo</h4>\n		<button type="button" class="close" ng-click="dismiss()"><i class="cnv-icons-15 icons2_Close-white"></i></button>\n	</div>\n	<div class="modal-body">\n		<div class="row">\n			<div class="col-xs-10">\n				<div class="blue-circle uploadButton" bo-if="thisUser.profile_image_type == 0">\n					<i class="cnv-icons-110 icon2__Following-lightblue"></i>\n					<i class="cnv-icons-30 icons_Camera-white"></i>\n					<i class="plus">+</i>\n					<i class="small-blue-bg"></i>\n				</div>\n				<div class="" bo-if="thisUser.profile_image_type != 0">\n					<cnv-user-profile-image width="\'184\'" height="\'184\'" user-id="thisUser.user_id" profile-type="thisUser.profile_image_type" profile-version="thisUser.profile_image_version" full-name="thisUser.first_name + \' \' + thisUser.last_name"></cnv-user-profile-image>\n				</div>\n			</div>\n			<div class="col-xs-11 col-xs-offset-3">\n				<button class="btn btn-default btn-block uploadButton">Upload Picture</button>\n				<button ng-if="!utils.isIE() && !utils.isSafari() && !config.IS_NATIVE" class="btn btn-default btn-block" ng-click="setProfilePictureViaWebcam()">Take a Photo</button>\n				<span class="help-txt">You can also upload from your social network profiles.</span>\n				<div class="social-btns linkedin" ng-click="uploadViaLinkedIn()">\n					<div class="left"><i class="cnv-icons-25 linkedin-white"></i></div>\n					<div class="right">Upload</div>\n				</div>\n				<div class="social-btns facebook" ng-click="uploadViaFb()">\n					<div class="left"><i class="cnv-icons-25 Icon1_facebook-white"></i></div>\n					<div class="right">Upload</div>\n				</div>\n				<div class="social-btns twitter" ng-click="uploadViaTwitter()">\n					<div class="left"><i class="cnv-icons-25 twitter-white"></i></div>\n					<div class="right">Upload</div>\n				</div>\n			</div>\n		</div>\n		<div class="row" ng-show="alerts">\n	      <div class="alert alert-success" ng-show="alerts.success" ng-bind="alerts.success" role="alert"></div>\n	      <div class="alert alert-danger" ng-show="alerts.error" ng-bind="alerts.error" role="alert"></div>\n	    </div>\n	</div>\n</section>'),a.put("components/dialog/cnvInFeedModal.tpl.html",'<div class="modal-header">\n    <h4> {{title}}</h4>\n    <button type="button" class="close" ng-click="close()">\xd7</button>\n</div>\n<div class="modal-body">\n    <label style="font-weight:bold" >{{text}}</label>\n    <div cnv-tag-input action=\'{{title}}\' data = \'{{data}}\'id="taginput" style="width:95%;"  ></div>\n</div>\n<div class="modal-footer">\n    <button type="button" class="btn btn-primary" ng-click="ok()" >{{okBtnLabel}}</button>\n    <button type="button" class="btn btn-default" ng-click="cancel()">{{cancelBtnLabel}}</button>\n</div>'),a.put("components/dropdown/cnvDropdown.tpl.html",'<span class="dropdown cnv-custom-dropdown" dropdown on-toggle="toggled(open)" is-open="isopen" bindonce>\n    <a href class="dropdown-toggle" bo-class="containerClass" dropdown-toggle aria-haspopup="true" aria-expanded="false">\n'+"        <i bo-if=\"ddType != 'noIcon'\" bo-class=\"{'cnv-icons-16 icons_Dropdown_incircle-lightgray': !ddType, 'cnv-icons-16 icons2_Dropdown-c2c2c2-png': ddType && ddType === 'c2c2c2-png', 'settingsChatWindowIcon': ddType && ddType == 'chat', 'cnv-icons-12 icons2_Dropdown-darkgray': ddType && ddType == 'circleLessChevron', 'cnv-icons-16 icons_Dropdown_incircle-cccecf' : ddType && ddType == 'note_editor_file', 'cnv-icons-20  icons_Dropdown_incircle-cccecf': ddType && ddType == 'header-network-menu', 'videoPlayer_menu_icon': ddType && ddType == 'video_player', 'videoPlayer_menu_icon invert': ddType && ddType == 'video_player_inverted_colors','cnv-icons-12 icons2_Dropdown-lightgray': ddType && ddType == 'inline_insert_permissions', 'cnv-icons-10 icons2_Dropdown-white': ddType && ddType == 'header-network-menu-slim', 'cnv-icons-16 icons2_Gear-gray' : ddType == 'gear', 'cnv-icons-16 icons2-more-options-gray': ddType == 'more-options'}\"></i>\n    </a>\n    <ul class=\"dropdown-menu dropdown-main-menu\" bo-class=\"{'dropdown-menu-right'  : ddAlign =='right'}\">\n\n    </ul>\n</span>"),
a.put("components/dropdown/cnvFeedItemDropdown.tpl.html",'<span class="dropdown">\n    <img class="dropdown-toggle" style="margin-top: -10px;"/>\n    <ul class="dropdown-menu">\n        <li><a ng-click="editProfile()">Edit</a></li>\n        <li><a ng-click="manageGroups()">Mute post</a></li>\n        <li><a ng-click="notificationPrefs()">Pin post to group -- only when on a group filter</a></li>\n        <li><a ng-click="settings()">Add tags</a></li>\n        <li><a ng-click="settings()">Star this post</a></li>\n        <li><a ng-click="settings()">Share with others</a></li>\n        <li><a ng-click="settings()">Copy post link</a></li>\n        <li><a ng-click="settings()">Move to Trash -- only on your own posts</a></li>\n    </ul>\n</span>'),a.put("components/dropdown/cnvJoinedGroupDropdown.tpl.html",'<span class="dropdown" on-toggle="toggled(open)">\n    <img class="dropdown-toggle" style="margin-top: -10px;"/>\n    <ul class="dropdown-menu">\n        <li><a ng-click="manageGroupSettings()">Manage group settings</a></li>\n        <li><a ng-click="notificationPreferences()">Notification preferences</a></li>\n        <li><a ng-click="inviteUsers()" bo-if="ctrl.membersCanInvite">Invite users to group</a></li>\n        <li><a ng-click="viewMembers()" bo-if="!ctrl.membersCanInvite">View members</a></li>\n        <li><a ng-click="addIntegration()">Add an integration [only those with permission]</a></li>\n        <li><a ng-click="addPostsOrLinks()">Add important posts or links</a></li>\n        <li><a ng-click="togglePostsInFeed()">Show posts in my feed / Hide posts from my feed</a></li>\n        <li><a ng-click="leaveGroup()">Leave group</a></li>\n    </ul>\n</span>\n'),a.put("components/dropdown/cnvNetworkDropdown.tpl.html",'<span class="dropdown">\n    <img class="dropdown-toggle"/>\n    <ul class="dropdown-menu">\n        <li><a ng-click="toggleFollow()">Network settings</a></li>\n        <li><a ng-click="call()">Manage integrations </a></li>\n        <li><a ng-click="inviteToGroups()">Manage users</a></li>\n        <li><a ng-click="share()">Change your network logo [admin only]</a></li>\n        <li><a ng-click="startChat">Get apps</a></li>\n        <li><a ng-click="startChat">Support & feedback</a></li>\n        \n        <li><a ng-click="startChat">Switch network list</a></li>\n        \n        <li><a ng-click="startChat">Sign out</a></li>\n    </ul>\n</span>\n'),a.put("components/dropdown/cnvOtherProfileDropdown.tpl.html",'<span class="dropdown" on-toggle="toggled(open)">\n    <img class="dropdown-toggle" style="margin-top: -10px;"/>\n    <ul class="dropdown-menu">\n        <li><a ng-click="toggleFollow()" bo-bind="getFollowStatus()"></a></li>\n        <li><a ng-click="call()">Call [first name] [only if phone number exists]</a></li>\n        <li><a ng-click="inviteToGroups()">Invite [first name] to groups</a></li>\n        <li><a ng-click="share()">Share a post with [first name]</a></li>\n        <li><a ng-click="startChat">Start a chat with [first name]</a></li>\n    </ul>\n</span>\n'),a.put("components/dropdown/cnvPublicGroupTypeDropdown.tpl.html",'<span class="dropdown">\n    <span class="dropdown-toggle text-placeholder" ng-bind="selected.label"></span>\n    <ul class="dropdown-menu">\n        <li ng-repeat="option in options" ng-click="clicked(option)"><a ng-bind="option.label"></a></li>\n    </ul>\n</span>\n'),a.put("components/dropdown/cnvSelfProfileDropdown.tpl.html",'<span class="dropdown">\n    <img class="dropdown-toggle" style="margin-top: -10px;"/>\n    <ul class="dropdown-menu">\n        <li><a ng-click="editProfile()">Edit profile</a></li>\n        <li><a ng-click="manageGroups()">Manage groups</a></li>\n        <li><a ng-click="notificationPrefs()">Notification preferences</a></li>\n        <li><a ng-click="settings()">Settings</a></li>\n        <li><a ng-click="settings()" bo-bind="ctrl.name"></a></li>\n    </ul>\n</span>'),a.put("components/dropdown/cnvUnjoinedGroupDropdown.tpl.html",'<span class="dropdown" on-toggle="toggled(open)">\n    <img class="dropdown-toggle" style="margin-top: -10px;"/>\n    <ul class="dropdown-menu">\n        <li><a ng-click="joinGroup()">Join group / Request access</a></li>\n        <li><a ng-click="viewGroupSettings()">View group settings</a></li>\n        <li><a ng-click="viewMembers()">View members</a></li>\n    </ul>\n</span>\n'),a.put("components/dropdown/labelListItem.tpl.html","<div>{{ item.label }}</div>"),a.put("components/dropdown/separatorListItem.tpl.html",'<hr class="separator full_width">'),a.put("components/groupInvtStatusDialog/templates/groupInvtStatusDialog.tpl.html",'<div class="invt-status-modal">\n    <div class="modal-body">\n        <b>Invitation to your teammates</b>\n        <br/>\n        <br/>\n\n        <p ng-if="inviteSuccessEmails.length==1">Your invitation has been sent to <b>{{inviteSuccessEmails[0].invitee_global_profile.email}}</b>.</p>\n        <p ng-if="inviteSuccessEmails.length==2">Your invitation has been sent to <b>{{inviteSuccessEmails[0].invitee_global_profile.email}}</b>, <b>{{inviteSuccessEmails[1].invitee_global_profile.email}}</b>.</p>\n        <p ng-if="inviteSuccessEmails.length>2">Your invitation has been sent to <b>{{inviteSuccessEmails[0].invitee_global_profile.email}}</b>, <b>{{inviteSuccessEmails[1].invitee_global_profile.email}}</b> and <a href="javascript:void(0)" cnv-popover cnv-popover-ctrl="successEmailsTooltip.text">{{inviteSuccessEmails.length-2}}</a> <b><span ng-if="inviteSuccessEmails.length>3">others</span><span ng-if="inviteSuccessEmails.length==3">other</span></b>.</p>\n\n        <br/>\n\n        <p ng-if="inviteFailEmails[0].error_message && inviteFailEmails.length==1" ng-bind-html="inviteFailEmails[0].error_message"></p>\n        <p ng-if="!inviteFailEmails[0].error_message && inviteFailEmails.length==1"><b>{{inviteFailEmails[0].invitee_email}}</b> couldn\'t be invited.</p>\n        <p ng-if="inviteFailEmails.length==2"><b>{{inviteFailEmails[0].invitee_email}}</b>, <b>{{inviteFailEmails[1].invitee_email}}</b> couldn\'t be invited.</p>\n        <p ng-if="inviteFailEmails.length>2"><b>{{inviteFailEmails[0].invitee_email}}</b>, <b>{{inviteFailEmails[1].invitee_email}}</b> and <a href="javascript:void(0)" cnv-popover cnv-popover-ctrl="FailEmailsTooltip.text">{{inviteFailEmails.length-2}}</a> <b><span ng-if="inviteFailEmails.length>3">others</span><span ng-if="inviteFailEmails.length==3">other</span></b> couldn\'t be invited.</p>\n        <div>\n            <button type="button" class="btn btn-primary" ng-click="ok()" autofocus>{{okBtnLabel}}</button>\n        </div>\n    </div>\n</div>'),a.put("feed/components/cnvFeedInviteWidget/cnvFeedInviteWidget.tpl.html",'<div class="row no-margin feed-invite-widget" ng-if="!isGuest">\n	<!-- <span ng-controller="ImportMacContactsCtrl"><span> -->\n\n	<button class="btn btn-primary" ng-click="inviteContacts()">Invite your teammates</button>\n	\n	<div ng-if="!shouldInviteGuestsAsFullMembers" class="separator">or</div>\n\n	<div ng-if="!shouldInviteGuestsAsFullMembers" class="vanity-help-txt">\n		<span>Get your company\'s exclusive invite link. Your teammates can use this link to sign up to Convo.</span>\n	</div>\n\n	<button ng-if="!shouldInviteGuestsAsFullMembers" class="btn btn-default" ng-click="onShareableLinkClick()">Invite via email or chat</button>\n	\n	<!-- <span class="heading">Find your teammates</span>\n	<span>See teammates who aren\'t on the<br><span ng-bind="networkPrimaryDomain"></span> network yet. Or <a href="javascript:void(0);">invite by email</a> instead.</span>\n\n	<div class="widget-body-wrapper">\n		<span ng-controller="ImportMacContactsCtrl" ng-if="config.IS_NATIVE">\n			<span class="cont" ng-click="findMacContacts()">\n				<i class="img mac-contacts"></i>\n				<div>MAC</div>\n			</span>\n		</span>\n		<span ng-controller=" ImportGoogleContactsCtrl">\n			<span class="cont" ng-click="findGoogleContacts()">\n				<i class="img google-contacts"></i>\n				<div>GOOGLE</div>\n			</span>\n		</span>\n		<span ng-controller="ImportCSVContactsCtrl" class="invite-CSV-contacts">\n			<input name=\'file\' class=\'file-input\' style="display: none;" onclick="this.value=null;" onchange="angular.element(this).scope().CSVFileInputChange(this)" type=\'file\'></input>\n			<span class="cont" ng-click="findCSVFileContacts($event)">\n				<i class="img csv-contacts"></i>\n				<div>CSV FILE</div>\n			</span>\n		</span>\n	</div>\n\n	<div class="widget-footer-wrapper">\n		<span>\n			Generate a special invite link for<br><span ng-bind="networkPrimaryDomain"></span>. <a href="javascript:void(0);">Get link</a>.\n		</span>\n	</div> -->\n</div>\n'),a.put("feed/components/cnvNoteSnippetPlaybackBanner/cnvNoteSnippetPlaybackBanner.tpl.html",'<div class="note-snippet-playback-banner-wrapper" bindonce>\n	<div class="banner-container" bo-if="bannerVisible">\n		<i class="cnv-icons-10 icons2_Close-darkgray" ng-click="dismissBanner()"></i>\n		<div class="dp-cont" bo-if="commentData">\n			<a bo-href="commentData.from_user | idToFilterUrl: \'USER\'">\n				<cnv-user-profile-image user-id="commentData.from_user" source="\'Feed\'"></cnv-user-profile-image>\n			</a>\n		</div>\n		<div class="comment-body" bo-show="commentData"></div>\n	</div>\n</div>'),a.put("feed/renderers/cnvFeedItem.tpl.html",'<div bo-if="itemData.app_instance_id == 6 || itemData.app_instance_id == 4" class="feed-item-container row">\n    \n    <cnv-note-snippet-playback-banner></cnv-note-snippet-playback-banner>\n    \n    <div class="dp-container" bo-class="{edited: itemData.created_by !== itemData.updated_by, normal: itemData.created_by == itemData.updated_by, \'dim-feed-item\': itemData.action == \'DOUBLE_DELETED\' || itemData.deleted == \'2\'}">\n        <a class="dp-wrapper created-by" bo-href="itemData.viewData.createdByFilterUrl" cnv-popover cnv-popover-ctrl="itemData.created_by | idToName" cnv-popover-display-as-text="true">\n            <cnv-user-profile-image user-id="itemData.created_by" width="\'60\'" height="\'60\'" source="\'Feed\'"></cnv-user-profile-image>\n        </a>\n        <a class="dp-wrapper edited-by" bo-if="itemData.created_by !== itemData.updated_by" bo-href="itemData.updated_by | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="itemData.updated_by | idToName" cnv-popover-display-as-text="true">\n            <cnv-user-profile-image user-id="itemData.updated_by" width="\'32\'" height="\'32\'" source="\'Feed\'"></cnv-user-profile-image>\n        </a>\n    </div>\n    <div class="feed-item-content-right">\n        <div class="action-items-wrapper">\n            <i bo-if="itemData.starred == 1" class="cnv-icons-20 icons_Star-blue" bo-class="itemData.viewData.feed_item_state_class"></i>\n            <i bo-if="itemData.muted == 1" class="cnv-icons-20 icons2_Mute-lightgray" bo-class="itemData.viewData.feed_item_state_class"></i>\n            <cnv-dropdowns class="feed-item-options-menu-container" bo-if="feedItemOptionsMenu" cnv-dropdown-ctrl="dropdownCtrl" condition=\'permissionsDropdownIconConditions\'></cnv-dropdowns>\n        </div>\n\n        <div class="shared-with-container" bo-class="itemData.viewData.feed_item_state_class">\n            <a bo-href="itemData.viewData.createdByFilterUrl" bo-class="itemData.viewData.createdByClass" bo-bind="itemData.viewData.createdByName"></a><br>\n            <snap class="grey-txt">To</snap>\n            <span bo-repeat="info in itemData.viewData.sharingInfo" bo-repeat-render-id="feedItemSharingInfo">\n                <a bo-href="info.href" bo-class="info.class" bo-bind="info.bind"></a>\n                <span bo-if="!$last" style="color: #959595">,</span>\n            </span>\n            <span bo-if="itemData.sharing_info.length > 2" class="more-sharing-info"><span style="color: #959595">&nbsp;, </span>\n                <a href="javascript:void(0)"\n                   cnv-popover cnv-popover-ctrl="itemData.sharing_info | sharingInfoTooltipText:2" cnv-popover-html-already-escaped="true"\n                   bo-bind="\'+\' + (itemData.sharing_info.length - 2) + \' more\'" ng-click="openSharedInfoModal()"></a>\n            </span>\n            <span class="dot">&nbsp;&nbsp;&#8226;&nbsp;&nbsp;</span>\n            <ul bo-class="{\'highlight\': itemData._actions.updatedByOtherUser}">\n                <li class="nobullet" bo-if="itemData.created_date != itemData.last_modified_date">\n                    <a class="meta" bo-href="itemData.viewData.resourceLinkUrl"><span class="meta" bo-bind="\' edited&nbsp;\'" style="margin-left: 0px !important"></span></a>\n                </li>\n                <li>\n                    <a class="meta open-in-detail-view" cnv-popover cnv-popover-ctrl="itemData.last_modified_date | localize" bo-date="itemData.last_modified_date | dateAgo:server_now_timestamp : true" bo-href="itemData.viewData.resourceLinkUrl"></a>\n                </li>\n            </ul>\n        </div>\n\n        <div cnv-feed-item-appid6-restype6 bindonce \n            bo-if="itemData.app_instance_id == 6" \n            class="note"\n            bo-class="{\'dim-feed-item\': itemData.action == \'DOUBLE_DELETED\' || itemData.deleted == \'2\'}">\n            <div class="title-text" bo-if="(itemData.data.show_title === undefined && itemData.data.note_type.indexOf(\'IMAGES\') !== -1) || itemData.data.show_title == 1">\n              <a bo-href="itemData.app_instance_id | getResourceLinkUrl: [{type: itemData.resource_type, uid: itemData.resource_id, title: itemData.hierarchy[0].title}]: null: itemData.hierarchy[0].title" bo-html="itemData.hierarchy[0].searched_title" class="open-in-detail-view"></a>\n            </div>\n\n            <div class="note-details">\n                <span bo-if="viewState === VIEW_STATES.SUMMARY" \n                    bo-html="(feed_data.isTextSearch && itemData.search_fragment) || itemData.details"></span>\n                <span id="note-complete-details" bo-if="viewState === VIEW_STATES.COMPLETE" bo-html="details_complete_content"></span>\n                <span class=\'note-details-toggle ellipsis\' \n                    bo-if="viewState == VIEW_STATES.SUMMARY && itemData.data.is_text_broken">\n                    <a href="javascript:void(0);" ng-click="onDetailsContentToggle(VIEW_STATES.COMPLETE)"><b>more</b></a>\n                </span>\n                <span class=\'note-details-toggle\' bo-if="viewState == VIEW_STATES.COMPLETE">\n                    <a href="javascript:void(0);" ng-click="onDetailsContentToggle(VIEW_STATES.SUMMARY)"><b>less</b></a>\n                    <br />\n                    <a bo-href="itemData.app_instance_id | getResourceLinkUrl:[{type: itemData.resource_type, uid: itemData.resource_id, title: itemData.hierarchy[0].title}]: null: itemData.hierarchy[0].title"><b>Open post</b></a>\n                </span>\n            </div>\n\n            <div id="notegallery" bo-if="itemData.data.files.length > 0" class="images" bo-style="{\'min-height\': itemData.viewData.note_gallery_height}">\n              <cnv-note-gallery id="note-gallery-directive" files-list="itemData.data.files" note-id="itemData.resource_id" resource-type="itemData.resource_type" app-id="itemData.app_instance_id">\n                  <div class="cnv-note-gallery-container">\n                        <div class="overlay"></div>\n                        <div class="feedGalleryContainer scrollable">\n                            <ul class="mainUl">\n                                \n                            </ul>\n                        </div>\n                    </div>\n              </cnv-note-gallery>\n            </div>\n\n            <span bo-if="itemData.viewData.numMatchingPostFiles" bo-bind="\'Contains \' + (itemData.viewData.numMatchingPostFiles | subject:\'file\') + \' matching your search\'" class="text-highlight" style="margin-right: 4px"></span>\n            <a bo-if="itemData.viewData.numMatchingPostFiles && isStarterNetwork" bo-href="upgradeAppUrl">Pro: Search inside file</a>\n        </div>\n        \n        <div bo-if="itemData.app_instance_id == 4" cnv-feed-item-appid4-restype4>\n            <div class="title">\n              <img class="title-icon" bo-click="onItemClicked()" width="16" height="16" bo-src="itemData.data | getFaviconIconPath">\n              <div class="title-text"><a bo-href="itemData.data.source" bo-html="itemData.hierarchy[0].searched_title" target="_blank" rel="noopener noreferrer"></a></div>\n            </div>\n            <div class="link-feed-thumbnail-wrapper" bo-if="linkThumbnailUrl">\n              <div class="link-feed-thumbnail" bo-click="onItemClicked()" bo-style="{\'background-image\': \'url(\' + linkThumbnailUrl + \')\' }"></div>\n              <div class="videoHoverIcon" bo-click="onItemClicked()" bo-show="isYTURL || isVimeoURL"></div>\n            </div>\n            <div class="link-feed-description" bo-style="{\'width\': linkThumbnailUrl ? \'290px\' : \'100%\' }" bo-html="(itemData.details | limitHtmlText:250) + (itemData.details ? \'<br />\' : \'\') + \'<span class=\\\'domain\\\'>\' + (itemData.data.source | getDomainNameFormUrl) + \'</span>\'" ></div>\n            <div style="display:none;" class="feedExternalVideoHolder">\n                <!-- <iframe bo-show="isYTURL" class="youtubeIframe" width="495" height="278" bo-src="YTLink" frameborder="0" allowfullscreen></iframe> -->\n                <div bo-show="isYTURL" class="youtubeIframe"></div>\n              <iframe bo-show="isVimeoURL" class="viemoIframe" bo-src="vimeoLink" width="495" height="278" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="background: #000"></iframe>   \n              <div class="link-feed-description player" style="width: 100%" bo-html="(itemData.details | limitHtmlText:250) + (itemData.details ? \'<br />\' : \'\') + \'<span class=\\\'domain\\\'>\' + (itemData.data.source | getDomainNameFormUrl) + \'</span>\'"></div>\n            </div>\n        </div>\n        \n        <!-- add location data here -->\n        <div ng-show="itemData.data.location.lat" class="geo-location-container">\n            <p class="geo-location"><span class="geo-location-at-label">at</span> <span class="geo-location-text" ng-click="initRemoveMap(itemData.resource_id, itemData.data.location);">{{itemData.data.location.title.length > 0 ? itemData.data.location.title: (itemData.data.location.lat +\', \' + itemData.data.location.lng)}}</span></p>\n            <i id="pin-{{itemData.resource_id}}" class="pull-right pin-icon cnv-icons-17 add-location-blue" ng-click="initRemoveMap(itemData.resource_id, itemData.data.location);"></i>\n        </div>\n\n        <div ng-show="itemData.data.location" class="map-container hide" id="map-{{itemData.resource_id}}"></div>\n\n        <div class="feed-info-container" bo-class="itemData.viewData.feed_item_state_class">\n            <ul>\n                <li>\n                    <a href="javascript:void(0);" bo-class="{\'disabled meta\': (!relatedPermissions.canComment && (itemData.conversations_count > 0 || (itemData.like_info.likes_count + itemData.like_info.sub_res_like_count > 0)))}" ng-click="onCommentButtonClick()">Comment</a>\n                    <!-- <span class="badge" bo-if="itemData.conversations_count > 0" bo-bind="itemData.conversations_count"></span> -->\n                </li>\n                <span class="dot">&nbsp;&nbsp;&#8226;&nbsp;&nbsp;</span>\n                <li class="nobullet">\n                    <!-- <span><font color="#959595">&nbsp;&middot;&nbsp;</font></span> -->\n                    <span cnv-like-button like-info="itemData.like_info" like-handler="onLikeClick(action)"></span>\n                </li>\n\n                <li class="pull-right tags nobullet dropdown" bo-if="itemData.viewData.hasTags" dropdown>\n                    <a bo-href="itemData.viewData.firstTagFilterUrl" bo-bind="itemData.viewData.firstTagLabel" bo-class="{\'add-comma\': itemData.viewData.numTags > 1}"></a>\n                    <a class="dropdown-toggle" is-open="isopen" dropdown-toggle bo-if="itemData.viewData.numTags > 1" bo-bind="\'+\' + (itemData.viewData.numTags - 1) + \' more\'"></a>\n                    <ul class="dropdown-menu">\n                        <a bo-repeat="tag in itemData.viewData.tagsTail" bo-href="tag | hashtagToFilterLink">\n                            <li class="nobullet" bo-bind="tag | labelToHashtag"></li>\n                        </a>\n                    </ul>\n                </li>\n            </ul>\n        </div>\n\n        <!-- COMMENTS-PANEL-START -->\n        <div class="comments-panel-wrapper l-pad" bo-show="itemData.conversations_count > 0 || (itemData.like_info.likes_count + itemData.like_info.sub_res_like_count > 0) || showCommentsPanel" bo-class="itemData.viewData.feed_item_state_class">\n            <div class="likes-count-container" bo-if="itemData.like_info.likes_count + itemData.like_info.sub_res_like_count > 0">\n                <i class="cnv-icons-20 icons2_Like-darkgray" style="opacity: 0.5"></i>\n                <a bo-href="itemData.like_info.liked_by | idToFilterUrl:\'USER\'" bo-bind="itemData.like_info.liked_by | idToName"></a>\n                <span bo-if="itemData.like_info.likes_count + itemData.like_info.sub_res_like_count > 1">, </span>\n                <a href="javascript:void(0)" bo-if="itemData.like_info.likes_count + itemData.like_info.sub_res_like_count > 1" bo-bind="\'+\' + (itemData.like_info.likes_count + itemData.like_info.sub_res_like_count - 1) + \' more\'" ng-click="openLikeInfoModal()"\n                   cnv-popover cnv-popover-ctrl="likeInfoTooltipText" cnv-popover-html-already-escaped="true"></a>\n            </div>\n            <cnv-comments-panel>\n                <div class="collapse-badge" bo-if="itemData.comments_data.total_comments > LATEST_COMMENTS_ONLY_COUNT && loadedCommentsCount > LATEST_COMMENTS_ONLY_COUNT" ng-click="showLatestCommentsOnly()">\n                    <i class="cnv-icons-12 icons2_Dropdown-darkgray" style="opacity: 0.6"></i>\n                </div>\n\n                <div class="bar comments_info" bo-class="{\'b-pad\': comments_expanded}" bo-if="itemData.comments_data.total_comments > LATEST_COMMENTS_ONLY_COUNT || itemData.comments_data.comments.length < itemData.comments_data.total_comments">\n                    <i class="cnv-icons-20 icons_Comments-darkgray" style="opacity: 0.5"></i>\n                    <a ng-click="loadAllComments(); trackExpandComments();" bo-show="loadedCommentsCount <= LATEST_COMMENTS_ONLY_COUNT" href="javascript:void(0)" bo-bind="itemData.comments_data.total_comments + \' \' + \' comments\'"></a>\n                    <a ng-click="showLatestCommentsOnly(); trackCollapseComments();" bo-show="loadedCommentsCount > LATEST_COMMENTS_ONLY_COUNT" href="javascript:void(0)">Hide comments</a>\n                </div>\n\n                <div class="comments-collection comments-scrollable-panel" bo-class="{ \'expanded\': comments_expanded }">\n                    <div cnv-comment bo-repeat="commentData in itemData.comments_data.comments | limitTo:-loadedCommentsCount" bo-id="commentData.uid" class="comment-cont" bo-repeat-render-id="commentItems"></div>\n                    \n                </div>\n\n                <div class=\'feed-comment-editor l-pad r-pad\' bo-class="{\'closed-top-border\': (commentEditorCtrl.permissions.block && itemData.conversations_count)}">\n                    <div class="new-comments-badge" ng-click="scrollToBottom(true)"><span>New Comments</span></div>\n                    <cnv-comment-editor tabindex="1" enable-emoji="true"></cnv-comment-editor>\n                </div>\n            </cnv-comments-panel>\n        </div>\n        <!-- COMMENTS-PANEL-END -->\n    </div>\n</div>\n\n<div bo-if="itemData.app_instance_id == 21 || itemData.app_instance_id == 18 || itemData.app_instance_id == 9" class="feed-item-container row" bo-class="itemData.viewData.feed_item_state_class">\n\n    <div bo-if="itemData.app_instance_id == 21 && itemData.data.chatType != \'chat\' && itemData.data.chatType != \'groupchat\'" class="dp-container edited">\n        <a class="dp-wrapper created-by" bo-href="itemData.sharing_info[0].published_to | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="itemData.sharing_info[0].published_to | idToName" cnv-popover-display-as-text="true">\n            <cnv-user-profile-image user-id="itemData.sharing_info[0].published_to" width="\'60\'" height="\'60\'"  source="\'Feed\'"></cnv-user-profile-image>\n        </a>\n\n        <a class="dp-wrapper edited-by" bo-href="itemData.sharing_info[1].published_to | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="itemData.sharing_info[1].published_to | idToName" cnv-popover-display-as-text="true">\n            <cnv-user-profile-image user-id="itemData.sharing_info[1].published_to" width="\'32\'" height="\'32\'"  source="\'Feed\'"></cnv-user-profile-image>\n        </a>\n    </div>\n\n    <div bo-if="itemData.app_instance_id == 21 && itemData.data.chatType == \'chat\'" class="dp-container">\n        <a class="dp-wrapper created-by" bo-href="itemData.sharing_info[1].published_to | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="itemData.sharing_info[1].published_to | idToName" cnv-popover-display-as-text="true">\n            <cnv-user-profile-image user-id="itemData.sharing_info[1].published_to" width="\'60\'" height="\'60\'"    source="\'Feed\'"></cnv-user-profile-image>\n        </a>\n    </div>\n\n    <div bo-if="itemData.app_instance_id == 21 && itemData.data.chatType == \'groupchat\'" class="dp-container chat">\n        <cnv-group-chat-avatar participants="itemData.sharing_info" source="\'Feed\'" bindonce style="width: 60px;height: 60px;margin-left: 5%;font-size: 9px; display: inline-block; ">\n            <div class="topList" style="display: flex;" bo-if="!emptyChatUser && userArr.length > 1" bo-style="{\'padding-left\': userArr.length == 3 ? \'5px\' : 0}">\n                <a class="dp-wrapper" bo-href="userArr[0].userId | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="userArr[0].userId | idToName" cnv-popover-display-as-text="true">\n                    <cnv-user-profile-image user-id="userArr[0].userId" width="20" height="20" bo-class="{\'showing3GroupUsersTop\' : show3images,\'showing2GroupUsersTop\' : show2images}" profileType="userArr[0].profileImageType" profileVersion="userArr[0].profileImageVersion"></cnv-user-profile-image>\n                </a>\n\n                <a class="dp-wrapper" bo-href="userArr[3].userId | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="userArr[3].userId | idToName" cnv-popover-display-as-text="true">\n                    <cnv-user-profile-image user-id="userArr[3].userId" width="20" height="20" bo-show="!show2images && !show3images" profileType="userArr[3].profileImageType" profileVersion="userArr[3].profileImageVersion"></cnv-user-profile-image>\n                </a>\n\n            </div>\n            <div class="botList" style="display: flex" bo-if="!emptyChatUser && userArr.length >1" bo-class="{\'showing3GroupUsersBot\' : show3images}">\n                <a class="dp-wrapper" bo-href="userArr[2].userId | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="userArr[2].userId | idToName" cnv-popover-display-as-text="true">\n                    <cnv-user-profile-image user-id="userArr[2].userId" width="20" height="20" bo-show="!show2images" profileType="userArr[2].profileImageType" profileVersion="userArr[2].profileImageVersion"></cnv-user-profile-image>\n                </a>\n\n                <a class="dp-wrapper" bo-href="userArr[1].userId | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="userArr[1].userId | idToName" cnv-popover-display-as-text="true">\n                    <cnv-user-profile-image user-id="userArr[1].userId" width="20" height="20" bo-class="{showing2GroupUsersBot : show2images }" bo-show="userArr.length <= 4" profileType="userArr[1].profileImageType" profileVersion="userArr[1].profileImageVersion"></cnv-user-profile-image>\n                </a>\n                <div class="groupAvatarCounter" bo-show="showCounter" bo-bind="\'+\'+(userArr.length-3)"></div>\n            </div>\n            <div bo-if="userArr.length == 1" style="font-size: 15px">\n                <a class="dp-wrapper" bo-href="userArr[0].userId | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="userArr[0].userId | idToName" cnv-popover-display-as-text="true">\n                    <cnv-user-profile-image user-id="userArr[0].userId" width="40" height="40" profileType="userArr[0].profileImageType" profileVersion="userArr[0].profileImageVersion"></cnv-user-profile-image>\n                </a>\n            </div>\n            <div bo-if="emptyChatUser" style="font-size: 15px">\n                <a class="dp-wrapper" bo-href="emptyChatUser.userId | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="emptyChatUser.userId | idToName" cnv-popover-display-as-text="true">\n                    <cnv-user-profile-image user-id="emptyChatUser.userId" width="40" height="40" profileType="emptyChatUser.profileImageType" profileVersion="emptyChatUser.profileImageVersion"></cnv-user-profile-image>\n                </a>\n            </div>\n        </cnv-group-chat-avatar>\n    </div>\n\n    <div bo-if="itemData.app_instance_id == 18 || itemData.app_instance_id == 9" class="dp-container">\n        <a class="dp-wrapper" bo-href="itemData.viewData.createdByFilterUrl" cnv-popover cnv-popover-ctrl="itemData.created_by | idToName" cnv-popover-display-as-text="true">\n            <cnv-user-profile-image user-id="itemData.created_by" width="\'60\'" height="\'60\'" source="\'Feed\'"></cnv-user-profile-image>\n        </a>\n    </div>\n\n    <div class="feed-item-content-right">\n        <div class="shared-with-container">\n            <a bo-href="itemData.viewData.createdByFilterUrl"\n                  bo-bind="itemData.viewData.createdByName"\n                  bo-class="{\'in-accessible-user\': isUserOrGroupNotAccessible({type: \'USER\', published_to: itemData.created_by})}"></a>\n            <br>\n            <snap class="grey-txt">To</snap>\n            <span bo-repeat="shareInfo in itemData.sharing_info | limitTo:2" bo-repeat-render-id="feedItemSharingInfo">\n                <a bo-if="shareInfo.published_to != user_info.user_id"\n                      bo-href="(shareInfo.type === \'GROUP\' && isUserOrGroupNotAccessible(shareInfo)) ? \'javascript:void\' : (shareInfo.published_to | idToFilterUrl:shareInfo.type) "\n                      bo-class="{\'in-accessible\': (shareInfo.type === \'GROUP\' && isUserOrGroupNotAccessible(shareInfo)), \'in-accessible-user\': (shareInfo.type === \'USER\' && isUserOrGroupNotAccessible(shareInfo))}"\n                      bo-bind="(shareInfo.published_to | idToName | limitText:80)"></a>\n                <a bo-if="shareInfo.published_to == user_info.user_id" bo-href="shareInfo.published_to | idToFilterUrl:shareInfo.type">Me</a>\n                <span bo-if="!$last" style="color: #959595">,</span>\n            </span>\n            <span bo-if="itemData.sharing_info.length > 2" class="more-sharing-info"><span style="color: #959595">&nbsp;, </span>\n            <a bo-href cnv-popover cnv-popover-ctrl="itemData.sharing_info | sharingInfoTooltipText:2" cnv-popover-html-already-escaped="true"\n               bo-bind="\'+\' + (itemData.sharing_info.length - 2)"></a>\n            </span>\n        </div>\n\n        <div bo-if="itemData.app_instance_id == 21">\n            <a href="javascript:void(0)" ng-click="openChatDetails()"><span bo-if="itemData.data.chatType == \'groupchat\'">Group </span>Chat view details</a>\n        </div>\n\n        <div class="note desc" bo-html="itemData.app_instance_id == 18 || itemData.app_instance_id == 9 ? (feed_data.isTextSearch ? itemData.search_fragment : itemData.details) : (itemData.app_instance_id == 21 && feed_data.isTextSearch ? itemData.search_fragment : \'\')"></div>\n\n        <span class="meta" cnv-popover cnv-popover-ctrl="itemData.last_modified_date | localize" bo-date="itemData.last_modified_date | dateAgo:server_now_timestamp"></span>\n    </div>\n</div>\n \n<hr class="feed-divider" bo-hide="hideFeedEndPlaceholder && $last" />\n'),
a.put("feed/renderers/comment/cnvComment.tpl.html",'<div class="comment" bo-class="commentData.uid" hasFiles="{{::commentData.hasFiles}}">\n    <span class="pic_container">\n        <a bo-href="commentData.from_user | idToFilterUrl:\'USER\'">\n            <cnv-user-profile-image user-id="commentData.from_user" source="\'Feed\'" width="40" height="40"></cnv-user-profile-image>\n        </a>\n    </span>\n\n    <cnv-dropdowns class="comment-drop-down" ng-click="initializeCmntDropDownOptions()" bo-if="!commentData.is_posting && !commentData.posting_failed && !editCommentEditorCtrl && !commentEditingPending" cnv-dropdown-ctrl="cmmtDropdownCtrl"></cnv-dropdowns>\n\n    <div class="comment_body" bo-if="!editCommentEditorCtrl">\n        <div bo-if="commentData.resource_link.resource_path.hierarchy.length > 1" class="img-snippet">\n            <i bo-if="commentData.resource_link.resource_path.hierarchy[1].title" class="ext_holder cnv-small-file-ico" bo-class="commentData.resource_link.resource_path.hierarchy[1].title | getFileExtension" bo-bind="commentData.resource_link.resource_path.hierarchy[1].title | getFileExtension"></i>\n            <a class="snippet-file-name" bo-href="commentData | getCommentUrl" bo-bind="commentData.resource_link.resource_path.hierarchy[1].title | limitTo: 72"></a></div>\n\n        <div class="comment_txt">\n            <span bo-if="commentData.resource_link.collaboration_info.replied_to_user_id" class="reply-arrow"></span>\n            <div bo-show="!showMore" class="comment-inner comment-inner-less less" class="text"></div>\n            <div bo-show="showMore" class="comment-inner comment-inner-full full" class="text"></div>\n        </div>\n\n        <a class="comment-snippet-attachment" bo-if="commentData.resource_link.collaboration_info.snippet_data.data.text && !commentData.resource_link.collaboration_info.snippet_data.data.source && commentData.resource_link.resource_path.hierarchy.length < 2 && appInstanceId != 4"\n           bo-href="commentData | getCommentUrl" ng-click="selectText(commentData)">\n            <div class="snippet-wrapper note-file-snippet">\n                <div class="textSnippet">\n                    <span bo-bind="commentData.resource_link.collaboration_info.snippet_data.data.text | limitToWithEllipsis: true : 100"></span>\n                </div>\n            </div>\n        </a>\n\n        <a bo-if="commentData.resource_link.collaboration_info.snippet_data.data.text && !commentData.resource_link.collaboration_info.snippet_data.data.source && (commentData.resource_link.resource_path.hierarchy.length > 1 || appInstanceId == 4)"\n           bo-href="commentData | getCommentUrl" bo-href="commentData | getCommentUrl"\n           ng-click="selectText(commentData)">\n            <div class="snippet-wrapper note-file-snippet">\n                <div class="textSnippet">\n                    <span bo-bind="commentData.resource_link.collaboration_info.snippet_data.data.text | limitToWithEllipsis: true : 100"></span>\n                </div>\n            </div>\n        </a>\n\n        <a bo-if="commentData.resource_link.collaboration_info.snippet_data.data.text && commentData.resource_link.collaboration_info.snippet_data.data.source == \'comment\'"\n           ng-click="commentReplyPlayback()">\n            <div class="snippet-wrapper comment-snippet">\n                <div class="textSnippet">\n                    <span bo-bind="commentData.resource_link.collaboration_info.snippet_data.data.text | limitToWithEllipsis: true : 100"></span>\n                </div>\n            </div>\n        </a>\n\n        <div bo-if="commentData.resource_link.collaboration_info.snippet_data.data.fileName" class="img-snippet-wrapper">\n            <a bo-if="commentData.resource_link.collaboration_info.snippet_data.data.fileName" bo-href="commentData | getCommentUrl" ng-click="$emit(\'drawSnippetOnCanvas\', commentData.resource_link.collaboration_info.snippet_data.data, commentData.uid)">\n                <img bo-src="loadAndDisplayImage()" bo-style="{height: commentData.resource_link.collaboration_info.snippet_data.data.height}"><!--\n                --><div ng-if="commentData.resource_link.collaboration_info.snippet_data.data.forVideo" class="video-info">\n                    <i class="video-indicator"></i>\n                    <span class="video-time-info" ng-bind="commentData.resource_link.collaboration_info.snippet_data.data.currentTimeString"></span>\n                </div>\n            </a>\n            <!--<span bo-if="commentData.resource_link.collaboration_info.snippet_data.data.forVideo">12:12</span>-->\n        </div>\n\n        <div bo-if="commentData.is_posting && commentData.resource_link.collaboration_info.snippet_data.fileViewerTextAnnotation" class="snippet-wrapper note-file-snippet" bo-style="{\'max-width\': commentData.from_user == thisUserInfo.user_id ? \'375px\' : \'auto\'}">\n            <div class="textSnippet">\n                <a bo-bind="commentData.resource_link.collaboration_info.snippet_data.snippetData.data.text | limitToWithEllipsis: true : 100"></a>\n            </div>\n        </div>\n\n        <div bo-if="commentData.files && commentData.files.length" bo-class="{\'ng-hide\': hideAttachments}" class="comment-attachments" cnv-popover cnv-popover-ctrl="commentData.files[0].name" bindonce>\n            <a bo-href="commentData | getCommentAttachmentUrl:commentData.files[0].file_id:commentData.files[0].file_format.toLowerCase() : commentData.files[0].name" class="comment-attachment-navigate">\n                <span class="attachment-cont">\n\n                    <img id="commentImage" style="height: 90px" bo-style="attachmentStyles"/>\n\n                    <i bo-if="fileSearchMatchesText" bo-bind="fileSearchMatchesText" class="search-matches-badge"></i>\n\n                    <span class="icon-cont" bo-if="!commentData.files[0].thumbnail_name || commentData.files[0].isDefaultThumbnail">\n                        <span bo-if="!isAudio" class="cnv-icons-36 fileplainlarge-darkgray file-icon"></span>\n                        <span bo-if="isAudio" class="cnv-icons-36 icons_Audio-darkgray file-icon"></span>\n                    </span>\n\n                    <div class=\'attachment-play-overlay videoHoverIcon\' bo-if="commentData.files[0].file_format==\'VIDEO\' && commentData.files[0].thumbnail_name"></div>\n\n                    <span class="file-info" bo-if="commentData.files[0].file_format == \'DOC\' || commentData.files[0].file_format == \'OTHER\' || commentData.files[0].file_format == \'VIDEO\'">\n                        <i class="ext_holder cnv-small-file-ico" ng-class="commentData.files[0].name | getFileExtension">\n                            <span ng-bind="commentData.files[0].name | getFileExtension"></span>\n                        </i>\n                        <span class="attachment-title" bo-html="fileSearchHighlightedName || fileNameEscaped"></span>\n                    </span>\n                </span>\n            </a>\n            <span class="download-icon ico cnv-icons-20 icons2_Download-darkgray" ng-click="downloadFile(commentData.files[0].original_name, commentData.files[0].name);" title="Download"></span>\n        </div>\n\n        <cnv-comment-link-preview-renderer bo-if="commentData.links && commentData.links.length > 0"></cnv-comment-link-preview-renderer>\n\n        <div class="action_line" bo-show="!commentData.posting_failed">\n            <span class="meta comment_info">\n                <a class="meta" bo-href="commentData.from_user | idToFilterUrl:\'USER\'" bo-bind="commentData.from_user | getUserName | limitText:80"></a>\n                <span bo-if="!commentData.is_posting"><font color="#959595">&nbsp;&nbsp;&#8226;&nbsp;&nbsp;</font>\n\n                    <span bo-if="commentData.update_kind == 2">deleted&nbsp;&nbsp;&#8226;</span>\n\n                    <a class="meta" bo-if="commentData.update_kind != 2 && !commentData.resource_link.collaboration_info.snippet_data.data.fileName && !commentData.resource_link.collaboration_info.snippet_data.data.text && commentData.resource_link.resource_path.hierarchy.length < 2" bo-href="appInstanceId | getCommentResourceLinkUrl: [{ type: resourceType, uid: resourceId, title: postTitle}]: commentData"><span bo-bind="commentData.update_timestamp > commentData.creation_timestamp | iif: \'edited\'"></span></a>\n\n                    <a class="meta" bo-if="commentData.update_kind != 2 && commentData.resource_link.collaboration_info.snippet_data.data.fileName || commentData.resource_link.collaboration_info.snippet_data.data.text || commentData.resource_link.resource_path.hierarchy.length > 1" bo-href="commentData | getCommentUrl"><span bo-bind="commentData.update_timestamp > commentData.creation_timestamp | iif: \'edited\'"></span></a>\n\n                    <span bo-bind="commentData.update_kind === 3 && commentData.update_timestamp === commentData.creation_timestamp | iif: \'replied\'"></span>\n\n                    <a class="time hover_underline meta" bo-if="!commentData.resource_link.collaboration_info.snippet_data.data.fileName && !commentData.resource_link.collaboration_info.snippet_data.data.text && commentData.resource_link.resource_path.hierarchy.length < 2" cnv-popover cnv-popover-ctrl="commentData.update_timestamp | localize" bo-date="commentData.update_timestamp | dateAgo:server_now_timestamp : true : true" bo-href="appInstanceId | getCommentResourceLinkUrl: [{ type: resourceType, uid: resourceId, title: postTitle}]: commentData"></a>\n\n                    <a class="time hover_underline meta" bo-if="commentData.resource_link.collaboration_info.snippet_data.data.fileName || commentData.resource_link.collaboration_info.snippet_data.data.text || commentData.resource_link.resource_path.hierarchy.length > 1" cnv-popover cnv-popover-ctrl="commentData.update_timestamp | localize" bo-date="commentData.update_timestamp | dateAgo:server_now_timestamp : true : true" bo-href="commentData | getCommentUrl"></a>\n                </span>\n            </span>\n            <span bo-if="relatedPermissions.canComment && commentData.update_kind != 2">\n                <span><font color="#959595">&nbsp;&nbsp;&#8226;&nbsp;&nbsp;</font></span>\n                <span>\n                    <a href="javascript:void(0)" ng-click="$emit(\'commentReplyButtonClick\', {event: $event, from: commentData.from_user, commentId: commentData.uid})" class="reply-btn hover_underline">Reply</a>\n                </span>\n            </span>\n            <span bo-if="!commentData.is_posting && commentData.update_kind != 2">\n                <font color="#959595">&nbsp;&nbsp;&#8226;&nbsp;&nbsp;</font>\n                <span cnv-like-button like-info="commentData.like_info" like-handler="onLikeClick(action)" bo-if="commentData.update_kind != 2"></span>\n                <span class="likes" bo-if="commentData.like_info.likes_count > 0">\n                    <span><font color="#959595">&nbsp;&nbsp;&#8226;&nbsp;&nbsp;</font></span>\n                    <span class="likes_count" ng-click="openLikeInfoModal()"\n                          cnv-popover cnv-popover-ctrl="likeInfoTooltipText" cnv-popover-html-already-escaped="true">\n                        <i class="cnv-icons-15 icons2_Like-darkgray" style="opacity: 0.5"></i>&nbsp;\n                        <span class="count" bo-bind="commentData.like_info.likes_count"></span>\n                    </span>\n                </span>\n            </span>\n            <span bo-if="commentData.resource_link.collaboration_info.replied_to_user_id && !currentlyPlayingCommentSnippet" ng-click="commentReplyPlayback()">\n                <font color="#959595">&nbsp;&nbsp;&#8226;&nbsp;&nbsp;</font>\n                <span class="reply-btn hover_underline thread-control">View thread</span>\n            </span>\n            <span bo-if="commentData.resource_link.collaboration_info.replied_to_user_id && currentlyPlayingCommentSnippet" ng-click="$emit(\'Comments:unHideAll\', commentData.uid)">\n                <font color="#959595">&nbsp;&nbsp;&#8226;&nbsp;&nbsp;</font>\n                <span class="reply-btn hover_underline thread-control">Hide thread</span>\n            </span>\n        </div>\n        <div class="action_line" bo-if="commentData.posting_failed">\n            <span class="warning-icon-red"></span> Unable to post comment. &nbsp;<a href="javascript:void(0)" ng-click="retryFailedPostComment()">Retry</a>&nbsp;&nbsp;&#8226;&nbsp;&nbsp;<a href="javascript:void(0)" ng-click="discardFailedPostComment()">Delete</a>\n        </div>\n    </div>\n\n    <div bo-if="editCommentEditorCtrl" style="margin-left: 60px;">\n        <cnv-comment-editor tabindex="1" enable-emoji="true"></cnv-comment-editor>\n    </div>\n</div>\n'),a.put("feed/renderers/gallery/cnvFeedVideoPlayerWrapper.tpl.html",'<cnv-video-player \ncnv-video-player-on-file-deleted="onFileDeleted()" \ncnv-video-player-options="playerOptions" \ncnv-video-player-file=\'file\' \n></cnv-video-player>'),a.put("fileUpload/cnvUploadFilesUiManager.tpl.html","<ng-include ng-if=\"type == 'inlineinsert'\" src=\"'fileUpload/templates/cnvInlineInsertUploadFiles.tpl.html'\"></ng-include>\n<ng-include ng-if=\"type == 'notes'\" src=\"'fileUpload/templates/cnvNotesAppUploadFiles.tpl.html'\"></ng-include>\n<ng-include ng-if=\"type == 'comment-attachment'\" src=\"'fileUpload/templates/cnvCommentsUploadFiles.tpl.html'\"></ng-include>"),a.put("fileUpload/templates/cnvCommentsUploadFiles.tpl.html",'<ul class="upload-files-reel">\n    <li cnv-upload-file-ui ng-repeat=\'file in files\' ng-class="{\'no-animation\': file.inEdit}" class=\'attachment-box\' cnv-popover cnv-popover-ctrl="file.name">\n        <div class="attachment-box-background"></div>\n        <img ng-src="{{file.localUrl}}" ng-class="{\'file-converted\': completed()}"/>\n\n        <div ng-if="failed()" class="failed-upload">\n            <div class="upload-failed-icon"></div>\n            <div>Couldn\'t upload this file.<a ng-if="file.retryAllowed" href="javascript:void(0);" ng-click="retry()">Retry</a></div>\n        </div>\n\n        <span ng-if="!file.noTitle && !failed()" class="fileNames">{{file.name}}</span>\n\n        <div ng-show="isInProgress()" class=\'progress-bar\'>\n            <div class="bar-internal"><div class="cnv-spinner" style="margin-top:31px"></div></div>\n            <div class="progress-line" ng-style="{width: file.progress+\'%\'}"></div>\n        </div>\n    </li>\n\n    <div ng-click="ctrl.removeAllFiles()" class="remove-attachment">\n        <span class="icons2_Close-white cnv-icons-18"></span>\n    </div>\n</ul>\n'),a.put("fileUpload/templates/cnvInlineInsertUploadFiles.tpl.html",'<ul class="upload-files-reel upload-files-scroll-cont" ng-if="files.length > 0" style="overflow-x: auto; overflow-y: hidden; padding: 5px 5px 0 5px; border-top: 1px solid #e0e0e0">\n	<li cnv-upload-file-ui="" ng-repeat=\'file in files\' class=\'attachment-box\' cnv-popover cnv-popover-ctrl="file.name">\n		<div class="attachment-box-background"></div>\n		<img ng-src="{{file.localUrl}}" ng-class="{\'file-converted\': conversionCompleted()}"/>\n		<!-- <div ng-if="!file.localUrl" id="preview-img-canvas" style="display: inline-block;"></div> -->\n		<div ng-if="failed()" class="failed-upload">\n			<div class="upload-failed-icon"></div>\n			<div>Couldn\'t upload this file.<a ng-if="file.retryAllowed" href="javascript:void(0);" ng-click="retry()">Retry</a></div>\n		</div>\n		<span ng-if="!file.noTitle && !failed()" class="fileNames">{{file.name}}</span>\n		<div ng-show="isInProgress()" class=\'progress-bar\'>\n			<div class="bar-internal"><div class="cnv-spinner"></div></div>\n			<div class="progress-line" ng-style="{width: file.progress+\'%\'}"></div>\n		</div>\n		<div ng-click="remove()" class="remove-file"></div>\n	</li>\n	<li class="attachment-box chooser no-animate">\n		<div class="plus-icon" cnv-popover cnv-popover-ctrl="\'Attach more files\'" ng-click="openFileChooser()"></div>\n		<!-- <img src="assets/img/inlineInsert/add-more.jpg" cnv-popover cnv-popover-ctrl="\'Attach more files\'" ng-click="openFileChooser()"/> -->\n	</li>\n</ul>\n<img src="assets/img/common/webapp_upload_error.png" class="ng-hide" /> <!--- To preload the icon in case of network'),a.put("fileUpload/templates/cnvNotesAppUploadFiles.tpl.html",'<div cnv-upload-file-ui class="file upload-box attachment-box" ng-repeat="file in files">\n    <div class="file_holder" cnv-popover cnv-popover-ctrl="file.name">\n\n        <img ng-src="{{file.localUrl}}" ng-class="{\'file-converted\': completed()}" oncontextmenu="return false" onselectstart="return false" ondragstart="return false"/>\n\n        <div ng-if="failed()" class="failed-upload">\n			<div class="upload-failed-icon"></div>\n			<div class="file_failed_text">Couldn\'t upload this file.<a ng-if="file.retryAllowed" href="javascript:void(0);" ng-click="retry()">Retry</a></div>\n		</div>\n\n		<span ng-if="!file.noTitle && !failed()" class="fileNames">{{file.name}}</span>\n\n		<div ng-show="isInProgress()" class=\'progress-bar\'>\n	    	<div class="bar-internal"><div class="cnv-spinner" style="margin-top: 69px"></div></div>\n			<div class="progress-line" ng-style="{width: file.progress+\'%\'}"></div>\n	    </div>\n\n        <div ng-click="remove()" class="remove-file"></div>\n    </div>\n</div>\n\n<div class=\'file upload-box attachment-box file chooser no-animate\'>\n	<div class="file_holder" ng-click="openFileChooser()" style="cursor: pointer;">\n		<img src="assets/img/inlineInsert/add-more.jpg" cnv-popover cnv-popover-ctrl="(ctrl.getSharedFilesLength() + files.length) && \'Attach more files\' || \'Attach files\'"/>\n    </div>\n</div>'),a.put("groups/cnvPostCreators/templates/cnvPostCreators.tpl.html",'<div class="post-creators-container">\n    <div class="post-creators-inner-wrapper">\n            <div class="post-creators-header">\n                <p ng-if="!showPostFilterField" class="header-text">Post Creators</p>\n                <input ng-show="showPostFilterField" class="posters-filter-field" ng-keyup="handleFilterKeyup($event)"\n                ng-model="postersFilterField"\n                type="text">\n                <i ng-show="showPostFilterField" class="cnv-icons-10 icons2_Close-darkgray clear-filter" ng-click="initPostersFilter()"></i>\n\n                <span><i class="search-icon cnv-icons-14 find-darkgray" ng-click="togglePostersFilter()"></i></span>\n                <span class="pull-right"><i class="add-icon cnv-icons-16 icons2_Add-darkgray" ng-click="toggleInput()"></i></span>\n            </div>\n\n            <div class="posters-list-container">\n                <!-- search members section -->\n                <cnv-add-members \n                ng-if="showInputArea"\n                data="postCreatorsObj"\n                prop-name="email"\n                callback="cnvAddMemberCallback(key, value)"\n                items-to-exclude="itemsToExclude"\n                ></cnv-add-members>\n\n                <!-- posters list -->\n                <ul class="posters-list">\n                    <li ng-if="postCreators.length > 0" ng-repeat="poster in postCreators | filter: postersFilter" class="posters-list-item">\n                        <div class="posters-list-item-content">\n                            <img class="profile-img" ng-if="poster.profileImages[\'64x64\']" ng-src="{{poster.profileImages[\'64x64\']}}">\n                            <img class="profile-img" ng-if="!poster.profileImages[\'64x64\']" ng-src="assets/img/smilies/smiley-08.svg">\n                            <p class="user-info">{{poster.first_name ? (poster.first_name + \' \' + poster.last_name) : poster.email}}</p>\n                            <span><i class="remove-icon pull-right cnv-icons-16 remove" ng-click="removePostCreator(poster)"></i></span>                            \n                        </div>\n                    </li>\n                </ul>\n\n            </div>\n            <!-- posters-list-container end -->\n    </div>\n</div>'),a.put("groups/groupActionBtns/templates/cnvJoinedBtn.tpl.html",'<div bindonce>\n    <button class="btn btn-default" bo-show="showBtn == \'leave\'" ng-click="leaveGroup()">\n        <i class="cnv-icons-20 icons_Minimize-blue"></i> Leave\n    </button>\n    <button class="btn btn-default" bo-show="showBtn == \'joined\'">\n        <i class="cnv-icons-20 check-blue"></i> Joined\n    </button>\n</div>'),a.put("home/components/cnvAddTagsWidget/cnvAddTagsWidget.tpl.html",'<div class="modal-header">\n    <h4>Tag this post</h4>\n    <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n</div>\n\n<form name="shareWithOthers" ng-submit="onSubmit()" role="form">\n\n	<div class="modal-body sharepost">\n		<p>Add tags to make your post easier to find.</p><br />\n    <tags-input class="to-field"\n          ng-model="tags"\n          placeholder="+Add more"\n          no-tags-indicator="false" \n          add-on-comma="true"\n          add-on-blur="true"\n          set-focus-on-load="true"\n          horizontal-flow = "false"\n          add-from-autocomplete-only="false"\n          display-property="label"\n          replace-spaces-with-dashes="true"\n          prefix-delimiter="#"\n          allowed-tags-pattern="^#[0-9a-zA-Z_-]+.*$" \n          on-esc-key-press="onEscKeyPressInToField()"\n          on-tag-added="onItemAddedInToField($tag)">\n      <auto-complete\n          source="getHashtags($query)"\n          load-history-on-focus="false"\n          auto-select-first-suggestion="false" \n          delimiter="#"\n          min-length="1"\n          suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n      </auto-complete>\n    </tags-input>\n    <br />\n    <p>Separate tags with commas</p>\n\n	    <!-- <div class="form-group">\n	      <span>Link to</span>\n	      <input type="url" class="form-control" name="url" ng-model="data.url" ng-change="onChange()" ng-paste="onPaste()" maxlength="255" required>\n	    </div>\n	    <div class="form-group">\n	      <span ng-class="{\'resolving\': resolving}">Text to display</span>\n	      <input type="text" class="form-control" name="resource_name" ng-model="data.resource_name" maxlength="255">\n	    </div>\n\n	    <a class="test-link" href="javascript:void(0);" ng-disabled="!data.url" >Test Link</a> -->\n\n	</div>\n	\n	<div class="modal-footer">\n	    <button type="submit" class="btn btn-primary">Done</button>\n	</div>\n\n</form>'),a.put("home/components/cnvFeedLinkThis/cnvFeedLinkThis.tpl.html",'<div class="modal-header">\n    <h4 style="width: 95%">More-Like<div class="fetchHeading"><strong>Top Search Terms:</strong> [<span ng-bind-html="top_terms_sec"></span>]</div></h4>\n\n    <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n\n    <button type="button" class="close" ng-click="showBody = !showBody" style="margin: 0px 5px;">-</button>\n</div>\n\n<div class="modal-body sharepost" style="max-height: 500px; overflow-y: auto" ng-show="showBody">\n\n    <div ng-show="processing" class="feed-item-container row align-center">\n        Please wait! Getting data for you...\n    </div>\n\n    <div ng-show="!processing && feedLikeThisData.errorMsg==null" >\n        <!--<input type="text" class="form-control" ng-model="keywords">-->\n        <div class="restTermsDiv"><strong>Other Search Terms:</strong> [<span ng-bind-html="rest_terms_sec"></span>]</div>\n\n\n        <tags-input class="to-field"\n                    ng-model="keywords"\n                    placeholder="+Add keyword"\n                    no-tags-indicator="true"\n                    add-on-comma="true"\n                    add-on-blur="true"\n                    horizontal-flow = "false"\n                    add-from-autocomplete-only="false"\n                    display-property="label"\n                    replace-spaces-with-dashes="true"\n                    on-esc-key-press="onEscKeyPressInToField()"\n                    on-tag-added="onItemAddedInToField($tag)"\n                    on-tag-removed="onItemRemovedInToField($tag)"\n                    on-ctrl-cmd-enter="onCtrlOrCmdEnterPressInTextEditor()">\n            <auto-complete\n                    source="getShareWithDropdownItems($query)"\n                    load-history-on-focus="false"\n                    auto-select-first-suggestion="false"\n                    delimiter="@"\n                    min-length="1"\n                    suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n            </auto-complete>\n        </tags-input>\n        <input type="button" class="btn btn-info btn-block" value="Resend Fetch Call" ng-click="loadData(keywords, feed, true, true)" />\n\n    </div>\n\n    <div class="feed-item-container row" ng-repeat="feedData in feedLikeThisSuggestions" ng-show="!processing && feedLikeThisData.errorMsg==null">\n        <div class="shared-with-container">\n            <a ng-href="{{feedData.created_by | idToFilterUrl:\'USER\'}}" ng-bind="feedData.created_by | idToName | limitText:80"></a>\n            <br>\n            <snap class="grey-txt">To</snap>\n\n            <span ng-repeat="shareInfo in feedData.published_to | sharedToOrderByCurrentUser | limitTo:2" class="ng-scope">\n                <a ng-if="shareInfo.published_to != user_info.user_id" ng-href="{{shareInfo.published_to | idToFilterUrl:shareInfo.type}}" ng-bind="(shareInfo.published_to | idToName | limitText:80)" ></a>\n                <span ng-if="(!$last | iif:\', \')" style="color: #959595" class="ng-scope">,</span>\n            </span>\n\n            <span ng-if="feedData.published_to.length > 2" class="more-sharing-info ng-scope"><span style="color: #959595">&nbsp;, </span>\n            <a href="javascript:void(0)"\n               cnv-popover="" cnv-popover-ctrl="feedData.published_to | sharingInfoTooltipText:2" cnv-popover-html-already-escaped="true"\n               ng-bind="\'+\' + ({{feedData.published_to.length - 2}})" ng-click="openSharedInfoModal()" popover-data-id="cnv-1">+2</a>\n            </span>\n        </div>\n        <div class="fetchMore title-text" highlight-text="search_words">\n            <a href="#{{feedData.resource_link}}">{{feedData.resource_name}}</a>\n            <br />\n            <strong>Score:</strong> {{feedData.score}}\n        </div>\n        <div class="note-details fetchMoreBody" >\n            <div class="fetchMore" highlight-text="search_words">\n                {{feedData.body }}\n            </div>\n        </div>\n        <div>\n            <strong>Dated:</strong> {{feedData.time_stamp | date:\'medium\'}}\n        </div>\n\n\n    </div>\n    <div ng-show="!processing && feedLikeThisData.errorMsg==null">\n        <center><a href="void:javascript()" ng-click="loadData(currentKeywords, feed, false, false)" ng-class="{\'disabled\':loadMore==\'Please Wait\'}">{{loadMore}}</a></center>\n    </div>\n    <div class="feed-item-container row" ng-show="!processing && feedLikeThisData.errorMsg!=null">\n        {{feedLikeThisData.errorMsg}}\n    </div>\n</div>\n\n<div class="modal-footer" ng-show="showBody">\n    <button type="button" class="close" ng-click="dismiss()">Close</button>\n</div>'),a.put("home/components/cnvGroupsFilterList/cnvGroupsFilterExpandList.tpl.html",'<table>\n  <tr><td><input width="60%" ng-model="searchGroupText" type="text" ng-keyup="highlightItemOnKeyup($event);" ng-keypress="highlightItemOnKeypress($event);" ng-keydown="highlightItemOnKeydown($event);" ng-trim="false" spellcheck="false"></input></td></tr>\n  <tr ng-repeat="group in groups | searchGroupUser:searchGroupText:true"><td><a ng-Click="applyFilter($event,this);" ng-href="{{group.id | idToFilterUrl:\'GROUP\'}}" ng-class="{list_item_selected: (group.id == filtered_group_id)}">{{group.title}}</a></td></tr>\n</table>'),a.put("home/components/cnvGroupsFilterList/cnvGroupsFilterList.tpl.html",'<!-- <div> -->\n<div style="display:inline;margin-right:10px;"><a href="#/feed">All</a></div>\n\n<div style="display:inline; margin-right:17px;" ng-repeat="group in groups | limitTo:3" ng-Click="applyFilterToTop3($event,this);"><a href="{{group.id | idToFilterUrl:\'GROUP\'}}" ng-class="{list_item_selected: (group.id == filtered_group_id)}">{{group.title | limitText:18}}</a></div>\n<div class="expand" style="display:inline;margin-right:10px;">\n  <span class="glyphicon glyphicon-chevron-down" ng-click="expandGroupList();"></span>\n</div>\n<!-- </div> -->\n'),a.put("home/components/cnvHomeCenterPanelFeedPinnedPostWidget/cnvHomeCenterPanelFeedPinnedPostWidget.tpl.html",'<div ng-cloak class="feed-post-pinning-widget" bindonce ng-if="pinnedFeedItems.length > 0 && !userInfo.isGuestUser()">\n	<ul>\n		<li ng-repeat="pin in pinnedFeedItems | limitTo:MAXIMUM_PINS_TO_SHOW track by pin.id" class="pin">\n			<a bo-href="pin.user_id | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="pin.user_id | idToName" cnv-popover-display-as-text="true" style="color: #fff">\n				<cnv-user-profile-image user-id="pin.user_id" width="20" height="20" source="\'Feed\'" style="margin-right: 6px;position: relative;top: -2px;" ></cnv-user-profile-image>\n				<i class="pin-icon"></i>\n			</a>\n			<a bo-href="pin.url" target="{{pin.type == \'WEB\' ? \'_blank\' : \'_self\'}}" rel="{{pin.type == \'WEB\' ? \'noopener noreferrer\' : \'\'}}"\n			   bo-bind="pin.resource_name" style="color: #aaa; margin-left: 6px"></a>\n		</li>\n		<li bo-if="pinnedFeedItems.length > MINIMUM_PINS_TO_SHOW && showAll" class="action-btn" style="position: absolute; bottom:0px;" bo-style="{right:isAdmin ? \'52px\' :  \'18px\'}">\n			<span ng-click="showAllPins()">{{\'+\' + (pinnedFeedItems.length - MINIMUM_PINS_TO_SHOW) + \' more\'}}</span>\n		</li>\n		<li bo-if="!showAll" class="action-btn"  style="position: absolute; bottom:0px;" bo-style="{right:isAdmin ? \'52px\' :  \'18px\'}">\n			<span ng-click="showFewerPins()">Less</span>\n		</li>\n		<li bo-if="isAdmin" style="position: absolute; right:18px; bottom:0px;color: #aaa;">\n			<span bo-if="pinnedFeedItems.length > 3">\u2022</span>\n			<a href="{{feedPinsSettingsUrl}}" style="color: #aaa;">Edit</a>\n		</li>\n	</ul>\n	<hr />\n</div>'),a.put("home/components/cnvHomeLeftPanel/cnvHomeLeftPanel.tpl.html",'<div class="wrapper-parent" cnv-home-left-panel-scroll-handler bindonce> \n    <div class="hidden-xs hidden-sm left-panel-wrapper-full cnv-onboarding-overlay" auto-hiding-scroll-bar>\n        <!-- left menu items code -->\n        <div class="row no-margin menu-items-container">\n            <ul>\n                <li>\n                    <i class="cnv-icons-20 icons_Home-darkgray"></i>\n                    <span class="unread-bubble" bo-if="showFeedDirtyDot">&middot;</span>\n                    <a bo-href="newsFeedFilter.url" ng-class="{active: (activeFilter == newsFeedFilter)}" ng-mousedown="trackClick(\'My Feed\'); scrollTop(); onNewsFeedFilterMouseDown()">My feed</a>\n                </li>\n                <li class="clearfix mentions">\n                    <i class="cnv-icons-20 icons2_mention-darkgray pull-left"></i>\n                    <span class="directs-unread-bubble unread-bubble" style="display:none">&middot;</span>\n                    <a bo-href="mentionsFilter.url" ng-click="resetDirectsCount(); trackClick(\'@Mentions\')" class="pull-left" ng-class="{active: (activeFilter == mentionsFilter)}">Mentions </a>\n                </li>\n                <li>\n                    <i class="cnv-icons-20 icons_Star-darkgray"></i>\n                    <a bo-href="starredFilter.url" ng-class="{active: (activeFilter == starredFilter)}" ng-click="trackClick(\'Starred\')">Starred</a>\n                </li>\n                <li>\n                    <i class="cnv-icons-20 icons_Drafts-darkgray"></i>\n                    <a bo-href="draftsFilter.url" class="draft-label" ng-class="{active: (activeFilter == draftsFilter)}" ng-click="trackClick(\'Drafts\')">Drafts</a>\n                </li>\n                <li>\n                    <i class="cnv-icons-20 icons_Integrations_Left"></i>\n                    <a href="javascript:void(0)" ng-click="openIntegrationsPage(); trackClick(\'Integrations\')" class="draft-label">Integrations</a>\n                </li>\n                <li >\n                    <i class="cnv-icons-20 icons2_Trash-darkgray"></i>\n                    <a bo-href="trashFilter.url" class="trash-label" ng-class="{active: (activeFilter == trashFilter)}" ng-click="trackClick(\'Trash\')">Trash</a>\n                </li>\n                <!--\n                <li class="action-link" ng-show="!expandMenu" ng-click="expandMenu = !expandMenu">\n                    <a href="javascript:void(0)">See more...</a>\n                </li>\n                <li class="action-link ng-hide" ng-show="expandMenu" ng-click="expandMenu = false">\n                    <a href="javascript:void(0)">Less</a>\n                </li>\n                -->\n            </ul>\n        </div>\n\n        <div class="row no-margin whatsnew menu-items-container">\n            <ul>\n                <li ng-if="!whatsNewData" style="position: relative;">\n                    <label class=\'cnv-spinner spinner-bar\' style=\'position: relative; top: 3px; left: 40%;\'></label>\n                </li>\n                \n                <li ng-if="!!whatsNewData">\n                    <i class="cnv-icons-20 whatsNewIcon-gray"></i>\n                    <span class="unread-bubble" ng-if="showUnreadAnouncementsIndicator">&middot;</span>\n                    <a href ng-click="showWhatsNewDialog()">What\'s New</a>\n                </li>\n            </ul>\n        </div>\n\n        <div class="row no-margin groupsItemsContainer">\n            <div class="heading">\n                <span>Groups</span>\n                <i ng-if="!isGuestUser && canCreateGroup" class="cnv-icons-20 icons2_Add-lightgray onboarding-add-group-tooltip" ng-click="createGroup(); trackClick(\'New Group\')"></i>\n                <!-- <span class="new-label" ng-click="createGroup()">New</span> -->\n            </div>\n            \n            <!-- CNV-LEFT-PANEL-GROUPS-LIST -->\n            <ul cnv-left-panel-groups-list bindonce class="on-boarding-public-private-group-placeholder-in-panel">\n                <li bo-if="!groupsArray" style="position: relative;">\n                    <label class=\'cnv-spinner spinner-bar\' style=\'position: absolute;top: 8px;left: 50%\'></label>\n                </li>\n\n                <!-- PRIVATE GROUPS -->\n                <li class="section-heading" bo-click="togglePrivateGroupsView()"><span class="onboarding-private-grp-tooltip">PRIVATE</span></li>\n                <li ng-show="privateGroupsArray && privateGroupsArray.models.length < 1 && canCreateGroup" class="group-intro-item">\n                    <i style="display:none;" class="cnv-icons-40 privateGroup_icon-darkgray on-boarding-private-group-placeholder-in-panel"></i>\n                    <span ng-if="!isGuestUser && canCreateGroup" ng-click="createGroup(true)">+ Create a private group</span>\n                    <span ng-if="userInfo.isGuestUser()">No private groups available</span>\n                    <!-- <span>Private groups are for stuff that is need-to-know only</span> -->\n                </li>\n                <li bo-repeat="group in privateGroupsArray.models | limitTo: MAX_PRIVATE_GROUPS_TO_DISPLAY track by group.id" bo-repeat-render-id="leftPanelGroupsList" class="clearfix parent on-boarding-private-group">\n                    <div class="pull-left">\n                        <i class="cnv-icons-20" bo-class="{\'privateGroup_icon-darkgray\': group.get(\'access\') == \'PRIVATE\' || group.get(\'access\') == \'SECRET\', \'Icon1_PublicChannel-01-darkgray\': group.get(\'access\') == \'PUBLIC\'}"></i>\n                        <span class="unread-bubble" bo-if="group.get(\'unreadCount\') > 0 && group.get(\'id\') != filteredGroupId">&middot;</span>\n                        <a bo-href="group.get(\'id\') | idToFilterUrlForApp:\'GROUP\'" bo-class="{active: group.get(\'id\') == filteredGroupId}" bo-click="resetUnreadCount(group.get(\'id\')); trackClick(\'Any Group\')" bo-bind="group.get(\'title\')">\n                        </a>\n                    </div>\n                    <div class="pull-right">\n                        <div class="wrapper">\n                            <cnv-dropdowns cnv-dropdown-ctrl="menuOptions[group.get(\'id\')]"></cnv-dropdowns>\n                        </div>\n                    </div>\n                </li>\n                <li bo-show="privateGroupsCollapsed && privateGroupsArray && privateGroupsArray.models.length > 5"><a href="javascript:void(0)" class="moreButton" bo-click="togglePrivateGroupsView(); trackClick(\'See More Groups\')">See more...</a></li>\n                <li bo-show="!privateGroupsCollapsed && privateGroupsArray && privateGroupsArray.models.length > 5"><a href="javascript:void(0)" class="moreButton" bo-click="togglePrivateGroupsView(); trackClick(\'Less\')">Less</a></li>\n                <li bo-if="privateGroupsArray.models.length === 0"><span class="no-group-available">No private groups available</span></li>\n\n                <!-- PUBLIC GROUPS -->\n                <li class="section-heading" bo-click="togglePublicGroupsView()"><span class="onboarding-public-grp-tooltip">PUBLIC</span></li>\n                <li bo-show="publicGroupsArray && publicGroupsArray.models.length < 1  && canCreateGroup" class="group-intro-item">\n                    <i style="display:none;" class="cnv-icons-40 Icon1_PublicChannel-01-darkgray on-boarding-public-group-placeholder-in-panel"></i>\n                    <!-- <span>Public groups are for company wide discussions</span> -->\n                    <span bo-if="!userInfo.isGuestUser()" ng-click="createGroup(false, true)">+ Create a public group</span>\n                    <span bo-if="userInfo.isGuestUser()">No public groups available</span>\n                </li>\n                <li bo-repeat="group in publicGroupsArray.models | limitTo: MAX_PUBLIC_GROUPS_TO_DISPLAY track by group.id" bo-repeat-render-id="leftPanelGroupsList" class="clearfix parent on-boarding-public-group">\n                    <div class="pull-left">\n                        <i class="cnv-icons-20" bo-class="{\'privateGroup_icon-darkgray\': group.get(\'access\') == \'PRIVATE\' || group.get(\'access\') == \'SECRET\', \'Icon1_PublicChannel-01-darkgray\': group.get(\'access\') == \'PUBLIC\'}"></i>\n                        <span class="unread-bubble" bo-if="group.get(\'unreadCount\') > 0 && group.get(\'id\') != filteredGroupId">&middot;</span>\n                        <a bo-href="group.get(\'id\') | idToFilterUrlForApp:\'GROUP\'" bo-class="{active: group.get(\'id\') == filteredGroupId}" bo-click="resetUnreadCount(group.get(\'id\')); trackClick(\'Any Group\')" bo-bind="group.get(\'title\')">\n                        </a>\n                    </div>\n                    <div class="pull-right">\n                        <div class="wrapper">\n                            <cnv-dropdowns cnv-dropdown-ctrl="menuOptions[group.get(\'id\')]"></cnv-dropdowns>\n                        </div>\n                    </div>\n                </li>\n                <li bo-show="publicGroupsCollapsed && publicGroupsArray && publicGroupsArray.models.length > 5"><a href="javascript:void(0)" class="moreButton" bo-click="togglePublicGroupsView(); trackClick(\'See More Groups\')">See more...</a></li>\n                <li bo-show="!publicGroupsCollapsed && publicGroupsArray && publicGroupsArray.models.length > 5"><a href="javascript:void(0)" class="moreButton" bo-click="togglePublicGroupsView(); trackClick(\'Less\')">Less</a></li>\n\n                <!-- LABELS -->\n                <!--Need to hide labels in case there is not labels data-->\n                <li class="section-heading" ng-if="sTags && sTags.length"><span>LABELS</span></li>\n                <!--<li ng-if="!sTags || !sTags.length"><p class="no-items" >Nothing is added in list</p></li>-->\n                <li ng-if="sTags && sTags.length" class="labels-regions-list-item" ng-repeat="region in sTags | limitTo: sTagsRegionsLimit">\n                    <i class="cnv-icons-20 plus label-icon pointer-label" \n                    ng-if="!sTagsExpandedRegions[region.stag_id] && region.children && region.children.length"\n                    ng-click="expandSTagRegion($event, region.stag_id)"\n                    ></i>\n                    <i class="cnv-icons-20 icons_Minimize-darkgray label-icon pointer-label" \n                    ng-if="sTagsExpandedRegions[region.stag_id]"\n                    ng-click="collapseSTagRegion($event, region.stag_id)"\n                    ></i>\n                    <i class="cnv-icons-20 hashtag label-icon"></i>\n                    <a bo-href="region.tag | stagNameToFilterUrlForApp" class="label-text label-text-highlighted">{{region.name}}</a>\n\n                    <ul class="districts-list" ng-if="sTagsExpandedRegions[region.stag_id]">\n                        <li class="district-list-item" ng-repeat="district in region.children | limitTo: sTagsDistrictsLimit">\n                            <i class="cnv-icons-20 plus label-icon pointer-label" \n                            ng-if="!sTagExpandedDistricts[district.stag_id] && district.children && district.children.length"\n                            ng-click="expandSTagDistrict($event, district.stag_id)"></i>\n                            <i class="cnv-icons-20 icons_Minimize-darkgray label-icon pointer-label"\n                            ng-if="sTagExpandedDistricts[district.stag_id]"\n                            ng-click="collapseSTagDistrict($event, district.stag_id)"></i>\n                            <i class="cnv-icons-20 hashtag label-icon"></i>\n                            <a bo-href="district.tag | stagNameToFilterUrlForApp" class="label-text label-text-highlighted">{{district.name}}</a>\n\n                            <ul class="stores-list" ng-if="sTagExpandedDistricts[district.stag_id]">\n                                <li class="store-list-item" ng-repeat="store in district.children | limitTo: sTagsStoresLimit">\n                                    <i class="cnv-icons-20 hashtag label-icon"></i>\n                                    <a bo-href="store.tag | stagNameToFilterUrlForApp" class="label-text label-text-highlighted">{{store.name}}</a>\n                                </li>\n\n                                <!-- <p class="no-items padding-top-10" ng-if="!district.children || !district.children.length">Nothing is added in list</p> -->\n\n                                <li ng-if="sTagsStoresLimit && district.children.length > sTagsStoresLimit"><a href="javascript:void(0)" ng-click="showMoreStores()" class="moreButton labels-more-button">See more...</a></li>\n                                <li ng-if="!sTagsStoresLimit"><a href="javascript:void(0)" ng-click="showLessStores()" class="moreButton labels-more-button">Less</a></li>\n                            </ul>\n\n                        </li>\n                        <!-- <p class="no-items" ng-if="!region.children || !region.children.length">Nothing is added in list</p> -->\n\n                        <li ng-if="sTagsDistrictsLimit && region.children.length > sTagsDistrictsLimit"><a href="javascript:void(0)" ng-click="showMoreDistricts()" class="moreButton labels-more-button">See more...</a></li>\n                        <li ng-if="!sTagsDistrictsLimit"><a href="javascript:void(0)" ng-click="showLessDistricts()" class="moreButton labels-more-button">Less</a></li>\n                    </ul>\n\n                </li>                \n                <li ng-if="sTagsRegionsLimit && sTags.length > sTagsRegionsLimit"><a href="javascript:void(0)" ng-click="showMoreRegions()" class="moreButton labels-more-button">See more...</a></li>\n                <li ng-if="!sTagsRegionsLimit"><a href="javascript:void(0)" ng-click="showLessRegions()" class="moreButton labels-more-button">Less</a></li>\n\n            </ul>\n        </div>\n\n        <div bo-if="!isGuestUser" class="row no-margin groupsControlsContainer">\n            <span><a bo-href=\'22 | getResourceLinkUrl : [{uid: "1", type: "26"}, {uid: "2", type: "AllGroups"}] : false : "Groups Directory (All Groups)"\' ng-click="trackClick(\'Browse Group Directory\')">Groups Directory</a></span>\n            <a bo-href=\'22 | getResourceLinkUrl : [{uid: "1", type: "26"}, {uid: "2", type: "AllGroups"}] : false : "Groups Directory (All Groups)"\' ng-click="trackClick(\'Browse Group Directory\')" class="directory-icon"><i class="cnv-icons-25 icon1_directory"></i></a>\n            <a bo-href=\'22 | getResourceLinkUrl : [{uid: "1", type: "26"}, {uid: "2", type: "AllGroups"}] : false : "Groups Directory (All Groups)"\' ng-click="trackClick(\'Browse Group Directory\')" class="help-text">Find groups in your company to join</a>\n            <!-- <span><a href="javascript:void(0)" ng-click="createGroup()">Create a group</a></span> -->\n\n            <!-- <div class="createGroupWidgetContainer" ng-controller="CreateGroupWidgetCtrl">\n                <h4><span class="glyphicon glyphicon-group"></span> Create private groups</h4>\n                <span>Create a public or private group to communicate about shared interests, topics, projects or teams.</span>\n                <button class="btn btn-default btn-block" >New Group</button> -->\n        </div>\n\n        <!--\n            This is a hack to fix overflow hidden issues on the menus.\n            By increasing the width and adding padding we\'re allowing\n            space for news to be visible\n\n            However we cannot limit background with background-size property (incase\n            of solid color) so this div will act as a dummy bg div\n        -->\n        <div class="background-div"></div>\n    </div>\n    <div class="visible-xs visible-sm left-panel-wrapper-slim cnv-onboarding-overlay">\n        <ul>\n            <a bo-href="newsFeedFilter.url">\n                <li>\n                    <i class="cnv-icons-20 icons_Home-darkgray" ng-mousedown="trackClick(\'My Feed\'); scrollTop(); onNewsFeedFilterMouseDown()"><span class="unread-bubble" bo-if="showFeedDirtyDot">&middot;</span></i>\n                    <div class="tooltip right" role="tooltip">\n                      <div class="tooltip-arrow"></div>\n                      <div class="tooltip-inner">\n                        My Feed\n                      </div>\n                    </div>\n                </li>\n            </a>\n            <a bo-href="mentionsFilter.url">\n                <li>\n                    <i class="cnv-icons-20 icons2_mention-darkgray" ng-click="resetDirectsCount(); trackClick(\'@Mentions\')"><span class="directs-unread-bubble unread-bubble" style="display:none">&middot;</span></i>\n                    <div class="tooltip right" role="tooltip">\n                      <div class="tooltip-arrow"></div>\n                      <div class="tooltip-inner">\n                        Mentions\n                      </div>\n                    </div>\n                </li>\n            </a>\n            <a bo-href="starredFilter.url">\n                <li>\n                    <i class="cnv-icons-20 icons_Star-darkgray" ng-click="trackClick(\'Starred\')"></i>\n                    <div class="tooltip right" role="tooltip">\n                      <div class="tooltip-arrow"></div>\n                      <div class="tooltip-inner">\n                        Starred\n                      </div>\n                    </div>\n                </li>\n            </a>\n            <a bo-href="draftsFilter.url">\n                <li>\n                    <i class="cnv-icons-20 icons_Drafts-darkgray" ng-click="trackClick(\'Drafts\')"></i>\n                    <div class="tooltip right" role="tooltip">\n                      <div class="tooltip-arrow"></div>\n                      <div class="tooltip-inner">\n                        Drafts\n                      </div>\n                    </div>\n                </li>\n            </a>\n            <li ng-click="openIntegrationsPage(); trackClick(\'Integrations\')">\n                <i class="cnv-icons-20 Icon1_Integrations-01-darkgray"></i>\n                <div class="tooltip right" role="tooltip">\n                  <div class="tooltip-arrow"></div>\n                  <div class="tooltip-inner">\n                    Integrations\n                  </div>\n                </div>\n            </li>\n            <a bo-href="trashFilter.url">\n                <li>\n                    <i class="cnv-icons-20 icons2_Trash-darkgray" ng-click="trackClick(\'Trash\')"></i>\n                    <div class="tooltip right" role="tooltip">\n                      <div class="tooltip-arrow"></div>\n                      <div class="tooltip-inner">\n                        Trash\n                      </div>\n                    </div>\n                </li>\n            </a>\n        </ul>\n        <hr />\n        <ul>\n            <li tabindex="1">\n                <i class="cnv-icons-20 privateGroup_icon-darkgray onboarding-private-grp-tooltip-slim"></i>\n                <ul class="group-popover-menus private-grps-list">\n                    <li bo-class="{\'ie-shorten\': privateGroupsArray.models.length > 5 }">Private Groups</li>\n                    <ul>\n                        <li bo-show="privateGroupsArray && privateGroupsArray.models.length < 1">\n                            <span bo-if="!userInfo.isGuestUser()" ng-click="createGroup(true)">+ Create a private group</span>\n                            <span bo-if="userInfo.isGuestUser()">No private groups available</span>\n                        </li>\n                        <a bo-href="group.get(\'id\') | idToFilterUrlForApp:\'GROUP\'" bo-click="resetUnreadCount(group.get(\'id\')); trackClick(\'Any Group\')" bo-bind="group.get(\'title\')" bo-repeat="group in privateGroupsArray.models track by group.id" bo-repeat-render-id="leftPanelGroupsList">\n                        </a>\n                    </ul>\n                </ul>\n                <!-- <div class="tooltip right" role="tooltip">\n                  <div class="tooltip-arrow"></div>\n                  <div class="tooltip-inner">\n                    Private Groups\n                  </div>\n                </div> -->\n            </li>\n            <li>\n                <i class="cnv-icons-20 Icon1_PublicChannel-01-darkgray onboarding-public-grp-tooltip-slim"></i>\n                <ul class="group-popover-menus public-grps-list">\n                    <li bo-class="{\'ie-shorten\': publicGroupsArray.models.length > 5 }">Public Groups</li>\n                    <ul>\n                        <li bo-show="publicGroupsArray && publicGroupsArray.models.length < 1">\n                            <span bo-if="!userInfo.isGuestUser()" ng-click="createGroup(false, true)">+ Create a public group</span>\n                            <span bo-if="userInfo.isGuestUser()">No public groups available</span>\n                        </li>\n                         <a bo-href="group.get(\'id\') | idToFilterUrlForApp:\'GROUP\'" bo-click="resetUnreadCount(group.get(\'id\')); trackClick(\'Any Group\');" bo-bind="group.get(\'title\')" bo-repeat="group in publicGroupsArray.models track by group.id" bo-repeat-render-id="leftPanelGroupsList">\n                        </a>\n                    </ul>\n                </ul>\n                <!-- <div class="tooltip right" role="tooltip">\n                  <div class="tooltip-arrow"></div>\n                  <div class="tooltip-inner">\n                    Public Groups\n                  </div>\n                </div> -->\n            </li>\n            <!-- TODO: need to enable this once mocks are available or definition is available\n            <li ng-if="sTags && sTags.length">\n                <i class="cnv-icons-20 hashtag labels-view-slim"></i>\n                <ul class="group-popover-menus labels-list">\n                    <li>LABELS</li>\n                    <ul>\n                        <li bo-show="sTags && sTags.length < 1">\n                            <span>Nothing is added in list</span>\n                        </li>\n                        <li ng-if="sTags && sTags.length" class="labels-regions-list-item" ng-repeat="region in sTags | limitTo: sTagsRegionsLimit">\n                            <i class="cnv-icons-20 plus label-icon pointer-label"\n                               ng-if="!sTagsExpandedRegions[region.stag_id]"\n                               ng-click="expandSTagRegion($event, region.stag_id)"\n                            ></i>\n                            <i class="cnv-icons-20 icons_Minimize-darkgray label-icon pointer-label"\n                               ng-if="sTagsExpandedRegions[region.stag_id]"\n                               ng-click="collapseSTagRegion($event, region.stag_id)"\n                            ></i>\n                            <i class="cnv-icons-20 hashtag label-icon"></i>\n                            <a bo-href="region.tag | stagNameToFilterUrlForApp" class="label-text label-text-highlighted">{{region.name}}</a>\n\n                            <ul class="districts-list" ng-if="sTagsExpandedRegions[region.stag_id]">\n                                <li class="district-list-item" ng-repeat="district in region.children | limitTo: sTagsDistrictsLimit">\n                                    <i class="cnv-icons-20 plus label-icon pointer-label"\n                                       ng-if="!sTagExpandedDistricts[district.stag_id]"\n                                       ng-click="expandSTagDistrict($event, district.stag_id)"></i>\n                                    <i class="cnv-icons-20 icons_Minimize-darkgray label-icon pointer-label"\n                                       ng-if="sTagExpandedDistricts[district.stag_id]"\n                                       ng-click="collapseSTagDistrict($event, district.stag_id)"></i>\n                                    <i class="cnv-icons-20 hashtag label-icon"></i>\n                                    <a bo-href="district.tag | stagNameToFilterUrlForApp" class="label-text label-text-highlighted">{{district.name}}</a>\n\n                                    <ul class="stores-list" ng-if="sTagExpandedDistricts[district.stag_id]">\n                                        <li class="store-list-item" ng-repeat="store in district.children | limitTo: sTagsStoresLimit">\n                                            <i class="cnv-icons-20 hashtag label-icon"></i>\n                                            <a bo-href="store.tag | stagNameToFilterUrlForApp" class="label-text label-text-highlighted">{{store.name}}</a>\n                                        </li>\n\n                                        <p class="no-items padding-top-10" ng-if="!district.children || !district.children.length">Nothing is added in list</p>\n\n                                        <li ng-if="sTagsStoresLimit && district.children.length > sTagsStoresLimit"><a href="javascript:void(0)" ng-click="showMoreStores()" class="moreButton labels-more-button">See more...</a></li>\n                                        <li ng-if="!sTagsStoresLimit"><a href="javascript:void(0)" ng-click="showLessStores()" class="moreButton labels-more-button">Less</a></li>\n                                    </ul>\n\n                                </li>\n                                <p class="no-items" ng-if="!region.children || !region.children.length">Nothing is added in list</p>\n\n                                <li ng-if="sTagsDistrictsLimit && region.children.length > sTagsDistrictsLimit"><a href="javascript:void(0)" ng-click="showMoreDistricts()" class="moreButton labels-more-button">See more...</a></li>\n                                <li ng-if="!sTagsDistrictsLimit"><a href="javascript:void(0)" ng-click="showLessDistricts()" class="moreButton labels-more-button">Less</a></li>\n                            </ul>\n\n                        </li>\n                    </ul>\n                </ul>\n            </li> -->\n            <a  bo-if="!isGuestUser" bo-href=\'22 | getResourceLinkUrl : [{uid: "1", type: "26"}, {uid: "2", type: "AllGroups"}] : false : "Groups Directory (All Groups)"\' ng-click="trackClick(\'Browse Group Directory\')">\n                <li>\n                    <i class="cnv-icons-20 icon1_directory"></i>\n                    <div class="tooltip right" role="tooltip">\n                      <div class="tooltip-arrow"></div>\n                      <div class="tooltip-inner">\n                        Groups Directory\n                      </div>\n                    </div>\n                </li>\n            </a>\n            <li bo-if="!isGuestUser && canCreateGroup" ng-click="createGroup(); trackClick(\'New Group\')">\n                <i class="cnv-icons-20 icons2_Add-white onboarding-add-group-tooltip-slim"></i>\n                <div class="tooltip right" role="tooltip">\n                  <div class="tooltip-arrow"></div>\n                  <div class="tooltip-inner">\n                    Create a new group\n                  </div>\n                </div>\n            </li>\n        </ul>\n    </div>\n<div>\n'),
a.put("home/components/cnvInFeedFilterWidget/cnvInFeedFilterWidget.tpl.html",'<div ng-if="active" class="filter-bar-wrapper">\n	<div class="dummy-btn"></div><a ng-href="{{filterLinkWithAll}}" ng-class="{active: activeFilter === FILTER_TYPE_ALL}">Posts</a><div class="dummy-btn"></div><a ng-href="{{filterLinkWithFiles}}" ng-class="{active: activeFilter === FILTER_TYPE_FILES}" role="button">Files</a><div class="dummy-btn"></div><a ng-href="{{filterLinkWithImages}}" ng-class="{active: activeFilter === FILTER_TYPE_IMAGES}">Images</a><div class="dummy-btn"></div>\n</div>\n'),a.put("home/components/cnvInviteTeammatesWidget/templates/cnvInviteTeammatesModal.tpl.html",'<div bindonce>\n    <div class="modal-header">\n        <h4 ng-bind="title"></h4>\n        <button type="button" class="close" ng-click="cancel()">\xd7</button>\n    </div>\n    <div class="modal-body">\n        <div>\n            <span bo-bind="autoCompleteFieldLabelText"></span>\n        </div>\n        <div class="to-field-cont">\n            <tags-input ng-model="inviteTo"\n                        placeholder="Invite teammates by adding their comma separated emails"\n                        add-on-comma="true"\n                        add-on-blur="true"\n                        horizontal-flow = "false"\n                        add-from-autocomplete-only="false"\n                        display-property="label"\n                        replace-spaces-with-dashes="false"\n                        allowed-tags-pattern="^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$"\n                        on-esc-key-press="onEscKeyPressInToField()"\n                        on-tag-added="onItemAddedInToField($tag)">\n                <auto-complete\n                        source="getAutoCompleteUserItems($query, numSelected)"\n                        load-history-on-focus="true"\n                        auto-select-first-suggestion="true"\n                        delimiter="@"\n                        min-length="1"\n                        max-results-to-show="4"\n                        suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n                </auto-complete>\n            </tags-input>\n        </div>\n        <div class="add-msg-txt">\n            <span>Add a message</span>\n        </div>\n        <textarea ng-model="messageTxt"/>\n        <div class="footer-content">\n            <button class="btn btn-primary" ng-disabled="inviteTo.length==0" ng-click="inviteTeammates()">Invite</button>\n            <a href="javascript:void(0)" ng-click="cancel()">Cancel</a>\n        </div>\n    </div>\n</div>'),a.put("home/components/cnvSharePostWidget/cnvSharePostWidget.tpl.html",'<div class="modal-header">\n    <h4>Share with others</h4>\n    <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n</div>\n\n<form name="shareWithOthers" ng-submit="onSubmit()" role="form">\n\n	<div class="modal-body sharepost">\n		<p>Enter names of people or groups that you want to share this post with.</p><br />\n		<p><b>People and Groups</b></p>\n	    <tags-input class="to-field"\n            ng-model="sharingInfo"\n            placeholder="+Add more"\n            no-tags-indicator="false" \n            add-on-comma="false"\n            add-on-blur="false"\n            set-focus-on-load="true"\n            horizontal-flow = "false"\n            add-from-autocomplete-only="true"\n            display-property="label"\n            replace-spaces-with-dashes="false"\n            on-esc-key-press="onEscKeyPressInToField()"\n            on-tag-added="onItemAddedInToField($tag)"\n            on-tag-removed="onItemRemovedInToField($tag)"\n            on-ctrl-cmd-enter="onCtrlOrCmdEnterPressInTextEditor()">\n          <auto-complete\n              source="getShareWithDropdownItems($query)"\n              load-history-on-focus="true"\n              auto-select-first-suggestion="true" \n              delimiter="@"\n              min-length="1"\n              suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n          </auto-complete>\n        </tags-input>\n\n	    <!-- <div class="form-group">\n	      <span>Link to</span>\n	      <input type="url" class="form-control" name="url" ng-model="data.url" ng-change="onChange()" ng-paste="onPaste()" maxlength="255" required>\n	    </div>\n	    <div class="form-group">\n	      <span ng-class="{\'resolving\': resolving}">Text to display</span>\n	      <input type="text" class="form-control" name="resource_name" ng-model="data.resource_name" maxlength="255">\n	    </div>\n\n	    <a class="test-link" href="javascript:void(0);" ng-disabled="!data.url" >Test Link</a> -->\n\n	</div>\n	\n	<div class="modal-footer">\n	    <button type="submit" ng-disabled="(!submitAnyway && !dirty) || (submitAnyway && sharingInfo.length==0)" class="btn btn-primary">Publish</button>\n	</div>\n\n</form>'),a.put("home/components/cnvWhatsNewDialog/whatsNew.tpl.html",'<div class="modal-content" bindonce>\n	<div class="modal-header">\n		<h4 ng-bind="title"></h4>\n		<button type="button" class="close" ng-click="cancel()">\xd7</button>\n	</div>\n	<div class="modal-body">\n		<div class="spinner-container" bo-if="modalDetails.state == \'wait\'">\n			<i class="cnv-circle-spinner-small"></i> Loading\n		</div>\n		<div class="sub-header">\n			<div style="display: inline;">\n                <input type="checkbox" \n                	   class="cnv-checkbox" \n                	   id="notifyUpdates"\n                	   ng-checked="whatsNewData.notifyAboutNewFeatures" \n                       bo-click="toggleNotifyMeAboutUpdates($event)"/>\n                <label for="notifyUpdates"></label>\n            </div>\n			<span style="margin-left:3px;">Notify me about updates</span>\n			<!--\n			<a href="https://www.convo.com/whatsnew.pdf" target="_blank" style="float: right;">View Release notes</a>\n			-->\n		</div>\n		<div id="whatsNewTextCont" class="content-frame"></div>\n	</div>\n</div>'),a.put("home/components/createGroupWidget/createGroupModal.tpl.html",'<div bindonce>\n	<div class="modal-header">\n		<!--<i></i>-->\n		<h4 bo-bind="title"></h4>\n		<button type="button" class="close" ng-click="cancel()">\xd7</button>\n	</div>\n\n	<div class="modal-body">\n\n		<div bo-if="STATE==CREATE_GROUP_STEP1" style="padding: 15px 30px;">\n			<div ng-include="\'home/components/createGroupWidget/templates/createGroupType.tpl.html\'"></div>\n		</div>\n\n		<div bo-if="STATE==CREATE_GROUP_STEP2" style="padding: 15px 30px;">\n			<div ng-include="\'home/components/createGroupWidget/templates/createGroupDetails.tpl.html\'"></div>\n		</div>\n\n		<div bo-if="STATE==CREATE_GROUP_STEP3" style="padding: 0px;">\n			<div ng-include="\'home/components/createGroupWidget/templates/createGroupInviteMembers2.tpl.html\'"></div>\n		</div>\n\n		<div bo-if="STATE==CREATE_GROUP_STEP4" style="padding: 0px;">\n			<div ng-include="\'home/components/createGroupWidget/templates/createGroupPostCreators.tpl.html\'"></div>\n		</div>\n\n	</div>\n</div>\n'),a.put("home/components/createGroupWidget/templates/body.tpl.html",'<!-- code for create a group forms -->\n<h6>Group Name</h6>\n<input type="text" class="form-control" spellcheck="false" ng-model="createGroupData.name" required />\n<h6>Description</h6>\n<textarea class="form-control" ng-model="createGroupData.description" required></textarea>\n\n<div class="radio">\n  <label>\n    <input type="radio" name="groupOptions" value="1" checked>\n    Public - all network members\n  </label>\n</div>\n\n<div class="radio">\n	<label>\n		<input type="radio" name="groupOptions" value="2">\n		Private - only invited members\n	</label>\n</div>'),a.put("home/components/createGroupWidget/templates/createGroupDetails.tpl.html",'<div class="group-create-details">\n\n	<cnv-create-group-dom-manpltr></cnv-create-group-dom-manpltr>\n\n	<div class="">\n		<div class="form-group">\n			<span>Name</span>\n			<input class="group-name" maxlength="255" placeholder="e.g Marketing" ng-model="groupValidator.groupName" autofocus>\n\n			<div class="group-alert-banner group-alert-slideDown" bo-if="showGrpAlreadyExistsAlert && existedGroupDetails.groupAccess==\'PUBLIC\'">\n				<span bo-if="existedGroupDetails.is_Member">\n					You\'re already a member of that group. <a href="javascript:void(0)" ng-click="resetGroupName()">Try another name</a> to continue or <a bo-href="existedGroupDetails.groupId | idToFilterUrl:\'GROUP\'" ng-click="cancel()">go to group.</a>\n				</span>\n				<span bo-if="!existedGroupDetails.is_Member">\n					A group with that name already exists. <a href="javascript:void(0)" ng-click="resetGroupName()">Try another name</a> to continue or <a href="javascript:void(0)" ng-click="joinGroup(existedGroupDetails.groupId)">join group.</a>\n				</span>\n			</div>\n			<div class="group-alert-banner group-alert-slideDown" bo-if="showGrpAlreadyExistsAlert && (existedGroupDetails.groupAccess==\'PRIVATE\' || existedGroupDetails.groupAccess==\'SECRET\')">\n				<span bo-if="existedGroupDetails.is_Member">\n					You\'re already a member of that group. <a href="javascript:void(0)" ng-click="resetGroupName()">Try another name</a> to continue or <a bo-href="existedGroupDetails.groupId | idToFilterUrl:\'GROUP\'" ng-click="cancel()">go to group.</a>\n				</span>\n				<span bo-if="!existedGroupDetails.is_Member && existedGroupDetails.groupAccess==\'PRIVATE\'">\n					A group with that name already exists. <a href="javascript:void(0)" ng-click="resetGroupName()">Try another name</a> to continue or <a bo-href="existedGroupDetails.groupId | idToFilterUrl:\'GROUP\'" ng-click="cancel()">request to join group.</a>\n				</span>\n				<span bo-if="!existedGroupDetails.is_Member && existedGroupDetails.groupAccess==\'SECRET\'">\n					A group with that name already exists. <a href="javascript:void(0)" ng-click="resetGroupName()">Try another name</a> to continue.\n				</span>\n			</div>\n			<div class="clear-fix"></div>\n		</div>\n\n		<div class="form-group">\n			<span class="optional-placeholder">Description</span>\n			<textarea cnv-handle-placeholder class="group-desc" rows="3" maxlength="250" placeholder="Add some more information about your group. This description will help others when they search for the group or need more detail about what it contains."></textarea>\n			<div class="clear-fix"></div>\n		</div>\n	</div>\n\n	<hr>\n\n	<div class="form-group" bo-if="GROUP_TYPE==GROUP_TYPE_PRIVATE">\n		<span class="checkBoxLabel">List in group directory</span>\n		<input id="CrtGrp1" class="group-vis cnv-checkbox" type="checkbox" value="" ng-click="toggleGroupVisibility()"><label for="CrtGrp1"></label>\n		<div>\n			<span class="meta-info">This lets others in your company request access</span>\n		</div>\n		<div class="clear-fix"></div>\n	</div>\n\n	<div class="form-group" bo-if="GROUP_TYPE==GROUP_TYPE_PUBLIC">\n		<span class="checkBoxLabel">Add everyone in your company automatically</span>\n		<input id="CrtGrp2" class="group-auto-follow cnv-checkbox" type="checkbox" value="" ng-click="toggleAutoFollowEnabled()"><label for="CrtGrp2"></label>\n		<div>\n			<span class="meta-info">Good for company-wide news or discussions</span>\n		</div>\n		<div class="clear-fix"></div>\n	</div>\n\n	<div class="form-group">\n		<span class="checkBoxLabel">Allow group members to add and remove users</span>\n		<input id="CrtGrp3" class="group-edit-settings cnv-checkbox" type="checkbox" value="" ng-click="toggleEditGroupSettings()"><label for="CrtGrp3"></label>\n		<div class="clear-fix"></div>\n	</div>\n\n	<div class="form-group">\n		<span class="checkBoxLabel">Allow members to leave this group</span>\n		<input id="CrtGrp4" class="group-leave-member-settings cnv-checkbox" type="checkbox" value="" checked="true" ng-model="GROUP_EXTENDED_PROPERTIES.CAN_LEAVE_GROUP"><label for="CrtGrp4"></label>\n		<div class="clear-fix"></div>\n	</div>\n\n	<div class="form-group">\n		<span class="checkBoxLabel">Allow only specific members to create posts</span>\n		<input id="CrtGrp5" class="group-post-member-settings cnv-checkbox" type="checkbox" ng-model="GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST"><label for="CrtGrp5"></label>\n		<div class="clear-fix"></div>\n	</div>\n\n</div>\n\n<section class="submit">\n	<span bo-if="GROUP_TYPE==GROUP_TYPE_PUBLIC" class="info-label">\n		To restrict access to group content, <a href="javascript:void(0);" ng-click="switchViewTo(GROUP_TYPE_PRIVATE)">create a private group</a> instead.\n	</span>\n	<span bo-if="GROUP_TYPE==GROUP_TYPE_PRIVATE" class="info-label">\n		If you want to share with a wider audience, <a href="javascript:void(0);" ng-click="switchViewTo(GROUP_TYPE_PUBLIC)">create a public group</a> instead.\n	</span>\n\n	<button \n		ng-if="GROUP_TYPE==GROUP_TYPE_PUBLIC && GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED==true && groupValidator.groupName.length>0 && GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST == false"\n		class="btn btn-primary" ng-click="showAlertIfGroupExists(true)" ng-disabled="isGrpNameEmptyAndGrpNameExists() || isCreateGroupAlreadyInProgress">Create group</button>\n\n	<button id="crtGrpNxtBtn"\n		ng-if="GROUP_TYPE==GROUP_TYPE_PUBLIC && GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED==true && groupValidator.groupName.length>0 && GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST == true"\n		class="btn btn-primary" \n		ng-click="updateCreateGroupState(CREATE_GROUP_STEP4, true)"\n		ng-disabled="isGrpNameEmptyAndGrpNameExists()">Next</button>\n\n	<button id="crtGrpNxtBtn"\n		ng-if="!(GROUP_TYPE==GROUP_TYPE_PUBLIC && GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED==true && groupValidator.groupName.length>0) && GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST == false" \n		class="btn btn-primary" \n		ng-click="updateCreateGroupState(CREATE_GROUP_STEP3, true)"\n		ng-disabled="isGrpNameEmptyAndGrpNameExists()">Next</button>\n\n	<button id="crtGrpNxtBtn"\n		ng-if="!(GROUP_TYPE==GROUP_TYPE_PUBLIC && GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED==true && groupValidator.groupName.length>0) && GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST == true" \n		class="btn btn-primary" \n		ng-click="updateCreateGroupState(CREATE_GROUP_STEP4, true)"\n		ng-disabled="isGrpNameEmptyAndGrpNameExists()">Next</button>\n\n	<div class="clear-fix"></div>\n</section>\n'),a.put("home/components/createGroupWidget/templates/createGroupInviteMembers.tpl.html",'<div class="invite-members">\n    <div class="suggestions-list">\n        <span class="multi-line">Invite members<br>or <a href="javascript:void(0)" bo-click="importFromAdrsbk()">import from<br>address book</a></span>\n\n        <div class="to-field-cont" ng-class="{\'no-placeholder\': inviteTo.length>0}">\n            <tags-input class="to-field"\n                        ng-model="inviteTo"\n                        placeholder="Add members by name or comma separated emails"\n                        add-on-comma="true"\n                        add-on-blur="true"\n                        horizontal-flow = "false"\n                        add-from-autocomplete-only="false"\n                        display-property="label"\n                        replace-spaces-with-dashes="false"\n                        allowed-tags-pattern="^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$"\n                        on-esc-key-press="onEscKeyPressInToField()"\n                        on-tag-added="onItemAddedInToField($tag)">\n                <auto-complete\n                        source="getInviteToDropdownItems($query, numSelected)"\n                        load-history-on-focus="true"\n                        auto-select-first-suggestion="true"\n                        delimiter="@"\n                        min-length="1"\n                        max-results-to-show="4"\n                        suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n                </auto-complete>\n            </tags-input>\n        </div>\n\n        <div class="clear-fix"></div>\n    </div>\n\n    <section class="submit">\n        <button class="btn btn-primary" ng-disabled="isCreateGroupAlreadyInProgress" ng-click="submit()">Create group</button>\n        <a href="javascript:void(0)" ng-click="updateCreateGroupState(CREATE_GROUP_STEP2, true)">Back</a>\n    </section>\n\n</div>'),a.put("home/components/createGroupWidget/templates/createGroupInviteMembers2.tpl.html",'<cnv-invites></cnv-invites>\n\n<section class="footer submit">\n    <button class="btn btn-primary" ng-disabled="isCreateGroupAlreadyInProgress" ng-click="submit()">Create group</button>\n    <a href="javascript:void(0)" style="float: right;" \n    ng-if="!GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST"\n    ng-click="updateCreateGroupState(CREATE_GROUP_STEP2, true)">Back</a>\n\n    <a href="javascript:void(0)" style="float: right;" \n    ng-if="GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST"\n    ng-click="updateCreateGroupState(CREATE_GROUP_STEP4, true)">Back</a>\n\n    <a class="import-widgets-reveal-action" ng-if="!isGuest && !invitesCtrl.widgets.isEnable && invitesCtrl.masterList.length" ng-click="invitesCtrl.widgets.enable()">Import</a>\n    <ng-include ng-if="!isGuest && invitesCtrl.masterList.length" src="\'invites/templates/cnvInvitesInlineWidgets.tpl.html\'"></ng-include>\n    <div class="clear"></div>\n</section>\n'),a.put("home/components/createGroupWidget/templates/createGroupPostCreators.tpl.html",'<cnv-invites></cnv-invites>\n\n<section class="footer submit">\n\n    <button ng-if="GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED"\n        class="btn btn-primary" ng-click="showAlertIfGroupExists(true)" ng-disabled="isGrpNameEmptyAndGrpNameExists() || isCreateGroupAlreadyInProgress">Create group</button>\n        \n    <button ng-if="!GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED"\n     class="btn btn-primary" ng-disabled="isCreateGroupAlreadyInProgress" ng-click="updateCreateGroupState(CREATE_GROUP_STEP3, true)">Next</button>\n\n    <a href="javascript:void(0)" style="float: right;" ng-click="updateCreateGroupState(CREATE_GROUP_STEP2, true)">Back</a>\n    <div class="clear"></div>\n</section>\n'),a.put("home/components/createGroupWidget/templates/createGroupType.tpl.html",'<div class="group-create-type">\n	<div>\n		<div bo-class="{selected: GROUP_TYPE==GROUP_TYPE_PUBLIC}" ng-click="toggleGroupType(GROUP_TYPE_PUBLIC)">\n			<div><i class="cnv-icons-20 Icon1_PublicChannel-01-darkgray" style="margin-right: 14px;"></i>Public</div>\n			<span class="meta">Anyone in your network can access. You like transparency and open discussions.</span>\n		</div>\n	</div>\n\n	<div>\n		<div bo-class="{selected: GROUP_TYPE==GROUP_TYPE_PRIVATE}" ng-click="toggleGroupType(GROUP_TYPE_PRIVATE)">\n			<div><i class="cnv-icons-20 privateGroup_icon-darkgray" style="margin-right: 14px;"></i>Private</div>\n			<span class="meta">You control who has access. This stuff is need-to-know only.</span>\n		</div>\n	</div>\n</div>\n\n<section class="submit">\n	<button class="btn btn-primary" ng-click="updateCreateGroupState(CREATE_GROUP_STEP2)">Next</button>\n	<div class="clear-fix"></div>\n</section>'),a.put("home/components/createGroupWidget/templates/dialog.tpl.html",'<div cnv-load-template template1="{{headerTemplate}}" template2="{{bodyTemplate}}" template3="{{footerTemplate}}"></div>'),a.put("home/components/downloadAppsModal/downloadAppsModal.tpl.html",'<div class="modal-body">\n    <i class="cnv-icons-10 icons2_Close-white" ng-click="dismissModal()"></i>\n    <div class="before-mobile-apps-download" ng-if="!MobileDownloadFlag">\n        <div class="upper-blue-half-modal">\n            <div ng-show="!isNative" class="btn-group">\n                <label class="btn btn-primary download-apps-widget-toggle-btn" ng-click="desktopTabClicked($event)" ng-model="models.radioModel" btn-radio="\'Desktop\'">Desktop</label>\n                <label class="btn btn-primary download-apps-widget-toggle-btn" ng-click="mobileTabClicked($event)" ng-model="models.radioModel" btn-radio="\'Mobile\'" >Mobile</label>\n            </div>\n\n            <!-- use ng-show for this div. because in IE and Safari images get requests got failed due to convo-app downlaod url is in process. -->\n            <div class="Desktop-upper-half" ng-show="models.radioModel === MODES.DESKTOP">\n                <div class="convo-app-icon desktop" ></div>\n                <p class="install-text">Install the desktop app</p>\n            </div>\n            <!-- use ng-show for this div. because in IE and Safari images get requests got failed due to convo-app downlaod url is in process. -->\n            <div class="Mobile-upper-half" ng-show="models.radioModel === MODES.MOBILE">\n                <p class="text-after-desktop-download" ng-if="DesktopDownloadFlag">Great! Downloading now...</p>\n                <div class="convo-app-icon mobile" ng-style="{\'margin-top\': DesktopDownloadFlag ? 27 : 100 }"></div>\n                <p class="install-text" ng-bind-html="mobileInstallText" ></p>\n            </div>\n        </div>\n\n        <div class="lower-white-half-modal">\n                <a class="download-apps-widget-btn-wrapper" href="{{::HTML_APP_DOWNLOAD_URL}}" target="_blank" rel="noopener noreferrer" ng-click="downloadNativeApp($event)" ng-if="models.radioModel === MODES.DESKTOP && userPlatform === \'Mac\'">\n                    <button class="btn btn-lg btn-inline btn-primary download-apps-widget-btn">Download Now</button>\n                </a>\n                <a class="download-apps-widget-btn-wrapper" href="{{::HTML_APP_DOWNLOAD_URL}}" ng-click="downloadNativeApp($event)" ng-if="models.radioModel === MODES.DESKTOP && userPlatform === \'Windows\'">\n                    <button class="btn btn-lg btn-inline btn-primary download-apps-widget-btn">Download Now</button>\n                </a>\n                <!-- use ng-show for this div. because in IE and Safari images get requests got failed due to convo-app downlaod url is in process. -->\n                <div class="btn-downlpad-mobile-apps" ng-show="models.radioModel === MODES.MOBILE">\n                    <div class="download-app-store" ng-click="sendInvitation(\'ios\')" > </div>\n                    <div class="download-play-store" ng-click="sendInvitation(\'android\')"></div>\n                </div>\n        </div>\n        <!-- use ng-show for this div. because in IE and Safari images get requests got failed due to convo-app downlaod url is in process. -->\n        <div class="overlay-icon-downlod laptop" ng-show="models.radioModel === MODES.DESKTOP"></div>\n        <!-- use ng-show for this div. because in IE and Safari images get requests got failed due to convo-app downlaod url is in process. -->\n        <div class="overlay-icon-downlod mobile" ng-show="models.radioModel === MODES.MOBILE"></div>\n    </div>\n    <div class="after-mobile-apps-download" ng-if="MobileDownloadFlag">\n        <div class="upper-blue-half-modal">\n             <i class="cnv-icons-10 icons2_Close-white" ng-click="dismissModal()"></i>\n             <div class="mobile-apps-download-content" ng-style="{\'padding\': DesktopDownloadFlag || isNative ? \'145px 0px\' : \'55px 0px\' }">\n                <div class="email-icon"></div>\n                <p class="mobile-apps-download-semibold-text">Please check your email <br />from your mobile device.</p>\n                <p class="mobile-apps-download-regular-text">We\'ve sent a download link to: <br /> {{::userInfo.getEmail()}}</p>\n             </div>\n        </div>\n        <div class="lower-white-half-modal" ng-if="!DesktopDownloadFlag && !isNative">\n            <p class="mobile-apps-download-desktop-text">Don\'t forget to install <br /> the desktop app.</p>\n            <a class="download-apps-widget-btn-wrapper in-mob-wrap" ng-if="userPlatform === \'Mac\'" href="{{::HTML_APP_DOWNLOAD_URL}}" target="_blank" rel="noopener noreferrer" ng-click="downloadNativeApp($event)">\n                <button class="btn btn-md btn-inline btn-primary download-apps-widget-btn in-mobile">Download Now</button>\n            </a>\n            <a class="download-apps-widget-btn-wrapper in-mob-wrap" ng-if="userPlatform === \'Windows\'" href="{{::HTML_APP_DOWNLOAD_URL}}" ng-click="downloadNativeApp($event)">\n                <button class="btn btn-md btn-inline btn-primary download-apps-widget-btn in-mobile">Download Now</button>\n            </a>\n            <div class="overlay-icon-downlod laptop in-mobile"></div>\n        </div>\n    </div>\n</div>'),a.put("home/components/groupNotificationsWidget/templates/groupNotificationsModal.tpl.html",'<div bindonce>\n    <div class="modal-header">\n        <h4 ng-bind="title"></h4>\n        <button type="button" class="close" ng-click="cancel()">\xd7</button>\n    </div>\n    <div class="modal-body">\n        <div bo-if="!initialized" class="loading-spinner">\n            <img src="assets/img/feed/loading-spin.svg" alt="Loading icon" />\n        </div>\n        <div bo-if="initialized">\n            <span>These are your notification settings for the <b bo-bind="group.get(\'title\')"></b> group. To change your default notification settings, go to <a bo-href="12 | getResourceLinkUrl:[{uid: 0, type: \'9\'}, {uid: \'0\', type: \'notificationsSettings\'}]:null:\'Notification Settings\'" ng-click="cancel()">Notifications</a>.</span>\n            <div class="notif-controls">\n                <div>\n                    <span>Desktop</span><input id="GrpNtf1" ng-true-value="1" ng-false-value="0" ng-model="groupNotifications.desktop" ng-click="onEnableDisableNotification()" ng-disabled="isUpdatingSettings" class="cnv-checkbox" type="checkbox"/><label for="GrpNtf1"></label>\n                </div>\n                <div>\n                    <span>Notification center</span><input id="GrpNtf2" ng-true-value="1" ng-false-value="0" ng-model="groupNotifications.in_app" ng-click="onEnableDisableNotification()" ng-disabled="isUpdatingSettings" class="cnv-checkbox" type="checkbox"/><label for="GrpNtf2"></label>\n                </div>\n                <div>\n                    <span>Mobile</span><input id="GrpNtf3" ng-true-value="1" ng-false-value="0" ng-model="groupNotifications.mobile" ng-click="onEnableDisableNotification()" ng-disabled="isUpdatingSettings" class="cnv-checkbox" type="checkbox"/><label for="GrpNtf3"></label>\n                </div>\n                <div>\n                    <span>Email</span><input id="GrpNtf4" ng-true-value="1" ng-false-value="0" ng-model="groupNotifications.email" ng-click="onEnableDisableNotification()" ng-disabled="isUpdatingSettings" class="cnv-checkbox" type="checkbox"/><label for="GrpNtf4"></label>\n                </div>\n            </div>\n            <div class="footer-content">\n                <button class="btn btn-primary" bo-click="saveNotificationSettings()" ng-disabled="!isAnySettingUpdated()">Save Changes</button>\n                <a href="javascript:void(0)" ng-click="cancel()">Cancel</a>\n            </div>\n        </div>\n    </div>\n</div>'),a.put("home/components/resourceLikeInfoWidget/templates/multipleResourceLikeInfoModal.tpl.html",'<div ng-repeat="rsc in likeDetails.resources track by $index">\n        <div class="modal-header sub-header attch like-modal-sub-heading" bo-if="$index == 1"><b>People who like attachments</b></div>\n        <div class="modal-header sub-header sbrsc like-modal-sub-heading" bo-if="$index >= 1">\n            <a bo-href="rsc.rscLink" bo-bind="rsc.rscName | limitText:30" ng-click="cancel()"></a>\n        </div>\n        <div class="like-info-wrapper" ng-repeat="likedByUser in rsc.users track by $index">\n            <div class="dp-wrapper">\n                <a bo-href="likedByUser.id | idToFilterUrl:\'USER\'" ng-click="cancel()">\n                    <cnv-user-profile-image user-id="likedByUser.id" fullName="likedByUser.name" profileType="likedByUser.profile_image_type" profileVersion="likedByUser.profile_image_version"></cnv-user-profile-image>\n                </a>\n            </div>\n            <div class="details-wrapper">\n                <span>\n                    <a bo-href="likedByUser.id | idToFilterUrl:\'USER\'" ng-click="cancel()">\n                        <b bo-bind="likedByUser.name | limitText:30"></b>\n                    </a>\n                </span>\n                <span class="secondary-text" bo-bind="likedByUser.email"></span>\n            </div>\n            <hr/>\n        </div>\n    </div>\n'),a.put("home/components/resourceLikeInfoWidget/templates/resourceLikeInfoModal.tpl.html",'<div bindonce>\n    <div class="modal-header">\n        <h4 ng-bind="title"></h4>\n        <button type="button" class="close" ng-click="cancel()">\xd7</button>\n    </div>\n    <div class="modal-body cnvScrollContainer" style="overflow-y: scroll;">\n        <div class="spinner-container" bo-if="modalDetails.state == \'wait\'">\n            <i class="cnv-circle-spinner-small"></i> Loading\n        </div>\n        <div bo-if="modalDetails.state == \'active\'">\n            <div bo-if="modalDetails.modalId == \'pstMd\'">\n                <div ng-include="\'home/components/resourceLikeInfoWidget/templates/multipleResourceLikeInfoModal.tpl.html\'" ></div>\n            </div>\n            <div bo-if="modalDetails.modalId == \'cmmMd\' || modalDetails.modalId == \'pstSbRscMd\'">\n                <div ng-include="\'home/components/resourceLikeInfoWidget/templates/singleResourceLikeInfoModal.tpl.html\'"></div>\n            </div>\n        </div>\n    </div>\n    <!--<div class="modal-footer">-->\n    <!--</div>-->\n</div>'),a.put("home/components/resourceLikeInfoWidget/templates/singleResourceLikeInfoModal.tpl.html",'<div class="like-info-wrapper" ng-repeat="likedByUser in likeDetails.users track by $index">\n    <div class="dp-wrapper">\n        <a bo-href="likedByUser.id | idToFilterUrl:\'USER\'" ng-click="cancel()">\n            <cnv-user-profile-image user-id="likedByUser.id" fullName="likedByUser.name" profileType="likedByUser.profile_image_type" profileVersion="likedByUser.profile_image_version"></cnv-user-profile-image>\n        </a>\n    </div>\n    <div class="details-wrapper">\n        <span>\n            <a bo-href="likedByUser.id | idToFilterUrl:\'USER\'" ng-click="cancel()">\n                <b bo-bind="likedByUser.name | limitText:30"></b>\n            </a>\n        </span>\n        <span class="secondary-text"  bo-bind="likedByUser.email"></span>\n    </div>\n    <hr/>\n</div>'),a.put("home/components/selectFolderWidget/templates/selectFolderModal.tpl.html",'<div bindonce>\n    <div class="modal-header">\n        <h4 ng-bind="title"></h4>\n        <button type="button" class="close" ng-click="cancel()">\xd7</button>\n    </div>\n    <div class="modal-body" >\n        <span ng-show="isDirectoryEmpty">This folder does not have any folders</span>\n        <ul ng-show="!fetchingDirectory" class="folder-list">\n            <li ng-repeat="directory in directoryList" value="{{directory.path}}" >\n                <a ng-click="getChildren(directory.name, directory.path);" href="javascript:void(0);">{{directory.name}}</a>\n            </li>\n        </ul>\n        \n    </div>\n    <div class="modal-footer">\n        <button class="integration-action-finish btn btn-primary" type=\'button\' ng-click="selectFolder();" ng-bind-html="selectButtonText" ng-disabled="fetchingDirectory"></button>\n        <button class="integration-action-finish btn btn-primary" type=\'button\' ng-click="getParent();" ng-bind-html="backButtonText" ng-show="canGoBack" ng-disabled="fetchingDirectory"></button>\n    </div>\n</div>'),a.put("home/components/sharedInfoWidget/templates/sharedInfoModal.tpl.html",'<div bindonce>\n    <div class="modal-header">\n        <h4 ng-bind="title"></h4>\n        <button type="button" class="close" ng-click="cancel()">\xd7</button>\n    </div>\n    <div class="modal-body cnvScrollContainer" style="overflow-y: scroll;">\n        <div class="share-info-wrapper" ng-repeat="shareInfo in sharedInfo track by $index">\n            <span class="dp-wrapper">\n                <a bo-if="shareInfo.typ == \'USER\'" bo-href="shareInfo.id | idToFilterUrl:\'USER\'" ng-click="cancel()">\n                    <cnv-user-profile-image user-id="shareInfo.id" source="\'Feed\'"></cnv-user-profile-image>\n                </a>\n                <a bo-if="shareInfo.typ == \'GROUP\'" bo-href="shareInfo.id | idToFilterUrl:\'GROUP\'" ng-click="cancel()">\n                    <span bo-if="shareInfo.access == \'PUBLIC\'" class="Icon1_PublicChannel-01-lightgray"></span>\n                    <span bo-if="shareInfo.access == \'PRIVATE\' || shareInfo.access == \'SECRET\'" class="privateGroup_icon-lightgray"></span>\n                </a>\n            </span>\n            <span class="details-wrapper">\n                <span>\n                    <a bo-if="shareInfo.typ == \'USER\'" bo-href="shareInfo.id | idToFilterUrl:\'USER\'" ng-click="cancel()">\n                        <b bo-bind="shareInfo.name | limitText:30"></b>\n                    </a>\n                    <a bo-if="shareInfo.typ == \'GROUP\'" bo-href="shareInfo.id | idToFilterUrl:\'GROUP\'" ng-click="cancel()">\n                        <b bo-bind="shareInfo.name | limitText:30"></b>\n                    </a>\n                </span>\n                <span bo-if="shareInfo.typ == \'USER\'">&nbsp;</span>\n            </span>\n            <hr/>\n        </div>\n        \n    </div>\n    <!--<div class="modal-footer"></div>-->\n</div>'),
a.put("home/components/usagePolicyModal/usagePolicyModal.tpl.html",'<div ng-class="{\'flex-center\':processingRequest}" class="modal-body" bindonce>\n	<div class="processing" bo-if="processingRequest">\n		<div class="cnv-spinner basic_spinner"></div>\n	</div>\n	<div bo-if="!processingRequest">\n		<div class="title">\n			<i class="cnv-icons-10 icons2_Close-white" ng-click="dismissModal()"></i>\n			<span bo-html="title"></span>\n		</div>\n		<div class="policy-text" bo-html="policyText">\n		</div>\n	</div>\n</div>'),a.put("home/groupView/centerPanelWidgets/cnvHomeCenterPanelGroupPinnedPostWidget/cnvHomeCenterPanelGroupPinnedPostWidget.tpl.html",'<ul class="pinned-post-center-widget-wrapper" style="list-style: none; text-align: left; position:relative" bo-show="pinnedContents.length > 0"  bindonce>\n	<li ng-repeat="pin in pinnedContents | limitTo: MAXIMUM_PINS_TO_SHOW">\n		<a bo-href="pin.user_id | idToFilterUrl:\'USER\'" cnv-popover cnv-popover-ctrl="pin.user_id | idToName" cnv-popover-display-as-text="true"  style="color: #fff">\n			<cnv-user-profile-image user-id="pin.user_id" width="20" height="20" source="\'Feed\'" style="margin-right: 6px;position: relative;top: -2px;" ></cnv-user-profile-image>\n			<i class="pin-icon"></i>\n		</a>\n		<a bo-if="pin.type == \'WEB\'" bo-href="pin.url" target="_blank" rel="noopener noreferrer" bo-bind="pin.resource_name" style="color: #aaa; margin-left: 6px"></a>\n		<a bo-if="pin.type == \'SCRYBE\'" bo-href="pin.app_instance_id | getResourceLinkUrl: [{ type: pin.resource_type,uid:pin.resource_id,title:pin.resource_name}]:\'\':pin.resource_name"\n		   bo-bind="pin.resource_name"  style="color: #aaa; margin-left: 6px"></a>\n		<!-- <span class="dim-text" bo-if="pin.user_id" bo-bind="pin.user_id | idToName"></span> -->\n	</li>\n	<li bo-if="pinnedContents.length > 3 && !expand" style="padding-left: 20px; position: absolute; bottom:15px;"  bo-style="{right:canEditPins ? \'52px\' :  \'18px\'}">\n		<a href="javascript:void(0)" bo-bind="(\'+\') + (pinnedContents.length - 3) + \' more\'" ng-click="showAll()" style="color: #aaa;"></a>\n	</li>\n	<li bo-if="expand" style="padding-left: 20px; position: absolute; bottom:15px;" bo-style="{right:canEditPins ? \'52px\' :  \'18px\'}">\n		<a href="javascript:void(0)" ng-click="showLess()" style="color: #aaa;">Less</a>\n	</li>\n	<li bo-if="canEditPins" style="position: absolute; right:18px; bottom:15px;color: #aaa;">\n		<span bo-if="pinnedContents.length > 3">\u2022</span>\n		<a href="{{groupSettingsUrl}}" style="color: #aaa;">Edit</a>\n	</li>\n</ul>\n\n'),a.put("home/groupView/cnvHomeCenterPanelGroupHeader.tpl.html",'<div class="floated-left">\n	<span id="feed_title">\n		<strong><span ng-bind="feed_title"></span></strong>\n        <cnv-dropdowns ng-if="showGroupDropdown && (isAdminMode || (!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup()))" cnv-dropdown-ctrl="groupDropdownCtrl" style="position: absolute;right: 0;top: -5px;"></cnv-dropdowns>\n    </span>\n</div>\n\n<div class="clear-fix"></div>\n\n<div class="feed-filter-description" ng-if="isAdminMode || (!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup())">\n\n	<!-- <div bo-if="model.state == STATE_WAITING">\n		...\n	</div> -->\n\n	<div bo-if="model.state == STATE_NORMAL">\n		<span class="description-text" bo-if="item.description">\n			<span bo-if="model.truncated" bo-text="item.description | limitText:150"></span>\n			<span bo-if="!model.truncated" bo-text="item.description"></span>\n			<a bo-if="model.truncated && item.description.length > 150" href="javascript:void(0);" ng-click="toggle()">See More</a>\n			<a bo-if="!model.truncated" href="javascript:void(0);" ng-click="toggle()">Less</a>\n			<!-- <span class="edit-placeholder" bo-show="isGroupAdminOrNetworkAdminMode()" ng-click="enableEdit()"></span> -->\n			<i class="description-edit-pencil" bo-show="!isAccountAnnouncementsGroup() && isGroupAdminOrNetworkAdminMode()" ng-click="enableEdit()"></i>\n			<span bo-if="model.error" class="glyphicon glyphicon-warning-sign error" cnv-popover cnv-popover-ctrl="\'There seems to be some problem reaching server, Try again.\'"></span>\n		</span>\n\n		<span class="add-description" bo-show="isGroupAdminOrNetworkAdminMode() && !item.description" ng-click="enableEdit()">Add a description</span>\n	</div>\n\n	<div bo-if="model.state == STATE_ERROR">\n		<span bo-if="model.error" class="glyphicon glyphicon-warning-sign error" cnv-popover cnv-popover-ctrl="\'There seems to be some problem reaching server, Try again.\'"></span>\n	</div>\n\n	\n	<div bo-if="model.state == STATE_EDIT">\n		<textarea rows="2" ng-model="item.description" maxlength="250" ng-disabled="model.saving" ng-blur="initSubmit()" ng-keydown="onKeydown($event)" onfocus="this.value = this.value;" autofocus></textarea>\n	</div>\n</div>\n'),a.put("home/groupView/groupsRightPanel.tpl.html",'<div class="group-right-panel-wrapper" ng-controller="GroupsRightPanelCtrl" bindonce>\n	\n	<cnv-group-members-list-widget bo-if="group"></cnv-group-members-list-widget>\n\n'+"	<hr ng-if=\"group.get('group_status') != 'DELETED' && (isAdminMode || (!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup() && (isGroupAdminOrNetworkAdminMode() || group.get('membersCanInvite'))))\" />\n\n	<cnv-group-invite-widget ng-if=\"group.get('group_status') != 'DELETED' && (isAdminMode || (!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup() && (isGroupAdminOrNetworkAdminMode() || group.get('membersCanInvite'))))\"></cnv-group-invite-widget>\n\n	<!-- <hr bo-if=\"isGroupAdminOrNetworkAdminMode() || group.get('membersCanSetupIntegrations')\"/> -->\n\n	<!-- <cnv-group-integrations-widget bo-if=\"isGroupAdminOrNetworkAdminMode() || group.get('membersCanSetupIntegrations')\"></cnv-group-integrations-widget> -->\n\n	<!-- <hr bo-if=\"isGroupAdminOrNetworkAdminMode() || group.get('membersCanPinContent')\"/> -->\n\n	<!-- <cnv-group-pinned-posts-widget bo-if=\"isGroupAdminOrNetworkAdminMode() || group.get('membersCanPinContent')\"></cnv-group-pinned-posts-widget> -->\n\n	<hr ng-if=\"isAdminMode || (!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup())\"/>\n	\n	<cnv-group-email-sharing-widget ng-if=\"group && group.get('groupEmail') && (isAdminMode || (!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup()))\"></cnv-group-email-sharing-widget>\n	\n</div>"),a.put("home/groupView/rightPanelWidgets/cnvAddPinContentModal.tpl.html",'<div class="modal-header">\n    <h4 ng-bind="(title ? title : \'Add pinned content to this group\')"></h4>\n    <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n</div>\n\n<form name="addPinContent" ng-submit="onSubmit()" role="form">\n\n	<div class="modal-body">\n\n		<div ng-if="!providedDesc">\n			<p><b>Not sure what to put in this box?</b></p>\n			<p>Pin a post or website that your team needs to reference frequently and find it easily<br>on the right of your group. These can be specs, resources or a how-to doc.</p>\n		</div>\n\n		<div ng-if="providedDesc">\n			<span>{{::providedDesc}}</span>\n		</div>\n\n	    <div class="form-group">\n	      <span>Link to</span>\n	      <input class="form-control" name="url" ng-model="data.url" ng-change="onChange()" ng-paste="onPaste()" ng-class="{\'ng-invalid-url\': !validateUrl() && hasUserTyped, \'ng-invalid-required\': !data.url && hasUserTyped}" cnv-autofocus=".modal-dialog">\n	    </div>\n	    <div class="form-group">\n	      <span ng-class="{\'resolving\': resolving}">Text to display</span>\n	      <input type="text" class="form-control" name="resource_name" ng-model="data.resource_name" maxlength="255">\n	    </div>\n\n	    <a class="test-link" href="javascript:void(0);" ng-disabled="!validateUrl()" ng-click="test()">Test Link</a>\n\n	</div>\n	\n	<div class="modal-footer">\n	    <button type="submit" class="btn btn-primary" ng-disabled="!validateUrl()" ng-bind="(btnTitle ? btnTitle : \'Pin to group\')"></button>\n	</div>\n\n</form>\n'),a.put("home/groupView/rightPanelWidgets/cnvGroupEmailSharingWidget.tpl.html",'<div class="group-email-sharing-widget" ng-show="group && group.get(\'memberCanPostInThisGroup\')">\n	<span class="heading">Group email</span>\n	<a bo-href="\'mailto:\' + group.get(\'groupEmail\')" bo-bind="group.get(\'groupEmail\')"></a>\n	<!-- <span bo-bind="group.get(\'groupEmail\')"></span>"</span> -->\n	<button class="btn btn-default btn-block" ng-click="copyEmailPopup()">Copy Email Address</button>\n	<span class="dim-text">Forward emails to this address to share them with this group.</span>\n</div>'),a.put("home/groupView/rightPanelWidgets/cnvGroupIntegrationsWidget.tpl.html",'<div class="group-integrations-widget">\n	<span>Add an integration</span>\n</div>'),a.put("home/groupView/rightPanelWidgets/cnvGroupInviteWidget.tpl.html",'<div class="group-invite-widget" bindonce>\n	<span>Invite teammates to group</span>\n	<form name="inviteUserToGroup" ng-submit="inviteUser()">\n		<!-- <input class="form-control" type="email" placeholder="{{placeholderText}}"/> -->\n        <div class="to-field-cont" ng-class="{\'hide-placeholder\': invitedTo.length >= 1}">\n            <tags-input ng-model="invitedTo"\n                        placeholder="{{placeholderText}}"\n                        add-on-comma="true"\n                        add-on-blur="true"\n                        horizontal-flow = "false"\n                        on-tag-added="onItemAddedInToField($tag)"\n                        on-tag-removed="onItemRemovedInToField($tag)"\n                        on-text-pasted="onTextPastedInToField(text)"\n                        add-from-autocomplete-only="false"\n                        display-property="label"\n                        allowed-tags-pattern="^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$"\n                        replace-spaces-with-dashes="false">\n                <auto-complete\n                        source="getAutoCompleteUserItemsToInvite($query, numSelected)"\n                        load-history-on-focus="true"\n                        delimiter="@"\n                        min-length="1"\n                        auto-select-first-suggestion="true"\n                        suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n                </auto-complete>\n            </tags-input>\n        </div>\n        <button bo-if="!inviting" class="btn btn-primary btn-block" ng-click="inviteUser()">Invite</button>\n        <button bo-if="inviting" class="btn btn-disabled btn-block">Invite</button>\n		<span class="dim-text">People outside your network can be invited as guests.</span>\n	</form>\n</div>'),a.put("home/groupView/rightPanelWidgets/cnvGroupMembersListWidget.tpl.html",'<div class="group-members-widget-wrapper" bindonce>\n\n	<div class="row no-margin btn-wrapper">\n\n		<button ng-if="!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup()" class="btn btn-warning btn-block btn-leave" bo-show="showBtn == \'leave\' && group.get(\'thisUserCanLeave\')" ng-mouseleave="showHideBtn(\'joined\')" \n		ng-click="leaveGroup()"\n		>\n			<i class="cnv-icons-20 icon1-remove-red hover"></i> Leave\n		</button>\n\n		<button ng-if="!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup()" \n		ng-disabled="!group.get(\'membersCanLeave\')"		\n		class="btn btn-default btn-block btn-joined" bo-show="showBtn == \'joined\' || !group.get(\'thisUserCanLeave\')" ng-mouseenter="showHideBtn(\'leave\')">\n			<i class="cnv-icons-20 check-blue"></i>Joined\n		</button>\n\n		<button ng-if="group.isNonMemberPrivateGroup() && !reqToJoinGroupSuccessful && group.get(\'_hint_this_user_action\') == \'request_to_join\'" class="btn btn-default btn-block btn-joined" ng-click="reqToJoinGroup()">\n			<i class="cnv-icons-20 icons_Email-lightblue"></i>Request to join\n		</button>\n\n		<button ng-if="group.isNonMemberPrivateGroup() && !group.get(\'isMember\') && group.get(\'access\') === \'SECRET\'" class="btn btn-block btn-disabled">Private group</button>\n\n		<!-- <button ng-if="group.isNonMemberPrivateGroup() && group.get(\'_hint_this_user_action\') == \'request_to_join\' && reqToJoinGroupSuccessful" class="btn btn-disabled btn-block">\n				<i class="cnv-icons-20 icons_Email-darkgray"></i>Request sent\n		</button> -->\n\n		<button ng-if="group.isNonMemberPrivateGroup() && (group.get(\'_hint_this_user_action\') == \'pending\' || reqToJoinGroupSuccessful)" class="btn btn-disabled btn-block">\n			<i class="cnv-icons-20 Icon1__Time-darkgray"></i>Pending\n		</button>\n\n		<button ng-if="group.isNonMemberPublicGroup()" class="btn btn-default btn-block btn-joined" ng-click="reqToJoinGroup()">\n			<i class="cnv-icons-20 add-1-lightblue"></i>Join\n		</button>\n\n	</div>\n	<div class="row no-margin">\n		<span>\n			<i bo-if="group.get(\'access\') == \'PUBLIC\'" class="cnv-icons-20 Icon1_PublicChannel-01-darkgray"></i>\n			<i bo-if="group.get(\'access\') == \'PRIVATE\' || group.get(\'access\') == \'SECRET\'" class="cnv-icons-20 privateGroup_icon-darkgray"></i>\n			<a ng-if="userInfo.isAdminMode() || (!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup())" bo-href="groupMembersViewUrl"><span ng-bind="groupMembers.length"></span> Members</a>\n			<span ng-if="!userInfo.isAdminMode() && (group.isNonMemberPrivateGroup() || group.isNonMemberPublicGroup())"><span ng-bind="groupMembers.length"></span> Members</span>\n		</span>\n		<span class="dot">&nbsp;&#8226;&nbsp;</span>\n		<span bo-if="group.get(\'access\') == \'PUBLIC\'">Public Group</span>\n		<span bo-if="group.get(\'access\') == \'PRIVATE\'">Private Group</span>\n		<span bo-if="group.get(\'access\') == \'SECRET\'">Private Group</span>\n	</div>\n	<div class="row no-margin">\n		<ul>\n			<li ng-repeat="user in groupMembers | limitTo: MAXIMUM_USERS_IN_LIST track by user.user_id" cnv-popover cnv-popover-ctrl="user.first_name && user.last_name ? user.first_name + \' \' + user.last_name : user.user_email_id" cnv-popover-display-as-text="true">\n					<a bo-href="user.user_id | idToFilterUrl:\'USER\'">\n						<cnv-user-profile-image user-id="user.user_id" width="48" height="48" profile-type="user.profile_image_type" profile-version="user.profile_image_version" full-name="user.first_name && user.last_name ? user.first_name + \' \' + user.last_name : user.user_email_id"></cnv-user-profile-image>\n					</a>\n				<!-- <img bo-src="user.user_id | userImgUrl: user.profile_image_type : user.profile_image_version" /> -->\n			</li>\n			<li bo-if="additionalGroupMembers > 0" class="count-thumb-container">\n				<a ng-if="!group.isNonMemberPrivateGroup() && !group.isNonMemberPublicGroup()" href="javascript:void(0)" bo-href="groupMembersViewUrl">\n					<span class="count-thumbnail">+<span bo-bind="additionalGroupMembers"></span>\n					</span>\n				</a>\n				<span ng-if="group.isNonMemberPrivateGroup() || group.isNonMemberPublicGroup()" class="count-thumbnail plain-text">+<span bo-bind="additionalGroupMembers"></span>\n				</span>\n			</li>\n		</ul>\n	</div>\n	<div class="row no-margin" bo-if="group.get(\'pendingInviteCount\') != \'0\'">\n		<span class="meta pending-invites" bo-bind="\'Pending Invites \' + group.get(\'pendingInviteCount\')"></span>\n	</div>\n\n</div>\n'),a.put("home/groupView/rightPanelWidgets/cnvGroupPinnedPostsWidget.tpl.html",'<div class="group-post-pinning-widget" bindonce>\n	<span>Pinned Content</span>\n	<ul>\n		<li ng-repeat="pin in pinnedContents | limitTo: MAXIMUM_PINS_TO_SHOW" ng-mouseover="removeBtn = true; reRender();" ng-mouseout="removeBtn = false; reRender();" class="pin">\n			<a bo-if="pin.type == \'WEB\'" bo-href="pin.url" target="_blank" rel="noopener noreferrer" bo-bind="pin.resource_name"></a>\n			<a bo-if="pin.type == \'SCRYBE\'" bo-href="pin.app_instance_id | getResourceLinkUrl: [{ type: pin.resource_type, uid: pin.resource_id, title: pin.resource_name }]" bo-bind="pin.resource_name"></a>\n			<i bo-if="pin.is_posting" class="posting"></i>\n			<i bo-if="pin.error" class="glyphicon glyphicon-warning-sign error" cnv-popover cnv-popover-ctrl="\'Error while saving content, Try again.\'"></i>\n			<i bo-show="removeBtn" ng-click="removePin(pin.id)" class="glyphicon glyphicon-remove"></i>\n			<br />\n			<span class="dim-text" bo-if="pin.user_id" bo-bind="pin.user_id | idToName"></span>\n			<span bo-if="pin.user_id && pin.time_stamp">,&nbsp</span>\n			<span class="dim-text" bo-if="pin.time_stamp" cnv-popover cnv-popover-ctrl="pin.time_stamp | localize" bo-date="pin.time_stamp | dateAgo: server_now_timestamp : true"></span>\n			\n		</li>\n		<!-- <li>\n			<span>iconset: ios-7-icons</span>\n			<span>iconfinder.com<br />Sabika N, Apr 2, 2013\n			</span>\n		</li> -->\n		<li bo-if="pinnedContents.length > MINIMUM_PINS_TO_SHOW && showAll" class="action-btn">\n			<span ng-click="showAllPins()">More</span>\n		</li>\n		<li bo-if="showLess" class="action-btn">\n			<span ng-click="showFewerPins()">Less</span>\n		</li>\n	</ul>\n	<a href="javascript:void(0);" ng-click="addPinnedContent()">Add important posts or links</a>\n</div>'),a.put("home/tagsView/cnvHomeCenterPanelSTagsHeader.tpl.html",'<div class="floated-left tags-view-header">\n	<span id="feed_title">\n        <strong><span class="tags-view-header-text"><i class="cnv-icons-20 hashtag-black label-icon"></i>{{feed_title}}</span></strong>\n    </span>\n\n    <i \n    ng-if="coords.lat && coords.lng"\n    class="location-icon cnv-icons-20"\n    ng-class="{\'add-location-2\': !isShowMapContainer, \'add-location-blue\': isShowMapContainer}"\n    ng-click="toggleMapContainer()"\n    ></i>\n\n    <div ng-show="isShowMapContainer" \n    cnv-clicked-outside-this="cnvClickedOutsideThis(target)"\n    cnv-exception-selector-class="location-icon"\n    class="map-container hide" id="map-container-tags-view"></div>\n</div>\n\n<div class="clear-fix"></div>\n'),a.put("home/templates/cnvHomeCenterPanel.tpl.html",'<div id="home-center-panel">\n  <div class="feed-head" cnv-home-center-panel-header-manager style="position: relative;">\n    <section ng-if="STATE==\'DEFAULT\'"\n      ng-include="\'home/templates/cnvHomeCenterPanelDefaultHeader.tpl.html\'">\n    </section>\n\n    <cnv-home-center-panel-group-header ng-if="STATE==\'GROUP\' && !is_search" bindonce></cnv-home-center-panel-group-header>\n    <cnv-home-center-panel-user-header ng-if="STATE==\'USER\' && !is_search" bindonce></cnv-home-center-panel-user-header>\n    <cnv-home-center-panel-s-tags-header ng-if="isStagFilterApplied"></cnv-home-center-panel-s-tags-header>\n  </div>\n\n  <div ng-if="isNonMemberPrivateGroupFilterAppliedAndNotAdminMode()" class="group-join-request-block">\n    <span>You don\'t have access to this group.</span>\n    <button ng-click="reqToJoinGroup()" ng-if="!reqJoinGrpSuccess && group.get(\'_hint_this_user_action\') == \'request_to_join\'" class="btn">\n      <i class="cnv-icons-15 icons_Email-lightblue"></i>Request to join\n    </button>\n    <button ng-if="group.get(\'_hint_this_user_action\') == \'pending\' || reqJoinGrpSuccess" class="btn btn-disabled" style="background: #ebebeb !important;">\n      <i class="cnv-icons-15 Icon1__Time-darkgray"></i>Pending\n    </button>\n  </div>\n\n  <!-- RELATED SEARCH IMPLEMENTATION -->\n  <div class="related-searches-wrapper" ng-if="feedRelatedSuggestions.length > 0">\n    <div class="heading">Search instead for:</div>\n    <div class="tags">\n      <ul>\n        <li ng-repeat="search in feedRelatedSuggestions | limitTo: MAX_RELATED_TAGS">\n          <a href="javascript:void(0)" ng-click="openUrl(search.url)">{{::search.title}}</a></li>\n      </ul>\n    </div>\n  </div>\n\n  <!-- RELATED TAGS IMPLEMENTATION -->\n  <div class="related-tags-wrapper" ng-if="relatedTags.length > 0">\n    <div class="heading">Related tags:</div>\n    <div class="tags">\n      <ul>\n        <li ng-repeat="tag in relatedTags | limitTo: MAX_RELATED_TAGS">\n          <a href="{{::tag.name | hashtagToFilterLink}}">#{{::tag.name}}</a></li>\n      </ul>\n    </div>\n  </div>\n\n  <div ng-if="!isNonMemberPrivateGroupFilterAppliedAndNotAdminMode() && !isNonMemberPublicGroupFilterAppliedAndNotAdminMode() && activeFilter !== postFilter" ng-hide="is_search" class="inline-insert-wrapper">\n    <cnv-inline-insert></cnv-inline-insert>\n  </div>\n\n  <div ng-if="activeFilter === postFilter" class="back-to-feed-top-cont">\n    <a href="#/feed">Back to News Feed</a>\n  </div>\n\n  <hr ng-if="relatedTags.length > 0 || feedRelatedSuggestions.length > 0" style="margin: 13px 0 0 0" />\n\n  <div ng-if="STATE==\'GROUP\' && !isNonMemberPrivateGroupFilterAppliedAndNotAdminMode() && !isNonMemberPublicGroupFilterAppliedAndNotAdminMode() && !is_search">\n    <cnv-home-center-panel-group-pinned-post-widget></cnv-home-center-panel-group-pinned-post-widget>\n  </div>\n\n  <div ng-if="STATE === \'DEFAULT\' && !is_search">\n    <cnv-home-center-panel-feed-pinned-post-widget></cnv-home-center-panel-feed-pinned-post-widget>\n  </div>\n\n  <div>\n    <cnv-feed-toggle-search></cnv-feed-toggle-search>\n  </div>\n\n  <cnv-feed ng-show="!isNonMemberPrivateGroupFilterAppliedAndNotAdminMode()" class="feed">\n    <div id="feed-updates-available-notif" ng-class="{\'in-view\': feed_data.feedItemsUpdatesAvailable}">\n      <div class="btn-cont" ng-click="onFeedItemsUpdatesAvailableNotifClick()">\n        <i class="cnv-icons-20 Icon1__UpArrow-blue"></i>\n        <span ng-bind="feed_data.feedItemsUpdatesAvailableNotifText"></span>\n      </div>\n    </div>\n    <div class="feed-cont">\n      <cnv-feed-item class="feed-item-wrapper" bo-repeat="itemData in getFeed() track by itemData.feed_id" bo-repeat-render-id="feedItems" ng-if="!itemData._hide && itemData.app_instance_id != 3 && itemData.app_instance_id != 14" id="{{::itemData.feed_id}}" hasFiles="{{::itemData.hasFiles}}" bindonce></cnv-feed-item>\n    </div>\n    <!-- <div ng-if="!isMyFeed()" class="filtered-feed-cont"> -->\n      <!-- <cnv-feed-item class="feed-item-wrapper" bo-repeat="itemData in feed_data.feed_items" bo-repeat-render-id="feedItems" ng-if="!itemData._hide && itemData.app_instance_id != 3 && itemData.app_instance_id != 14" id="{{::itemData.feed_id}}" hasFiles="{{::itemData.hasFiles}}" bindonce></cnv-feed-item> -->\n    <!-- </div> -->\n    \n    <div class="feed_load_status" ng-show="!feed_data.fetching && !feed_data.initiating && feed_data.feed_items.length == 0 && activeFilter != starredFilter && activeFilter != draftsFilter && activeFilter != trashFilter && !hideFeedEndPlaceholder">There is no feed to display.</div>\n \n    <div class="blank-state-placeholder" ng-show="!feed_data.fetching && !feed_data.initiating &&feed_data.feed_items.length == 0 && activeFilter == starredFilter">\n      <i class="cnv-icons-64 icons_Star-lightgray"></i>\n      <p>Add a star to important posts and they\'ll appear here.<br />A VIP list, if you will.</p>\n    </div>\n\n    <div class="blank-state-placeholder" ng-show="!feed_data.fetching && !feed_data.initiating&& feed_data.feed_items.length == 0 && activeFilter == draftsFilter">\n      <i class="cnv-icons-64 icons_Drafts-lightgray"></i>\n      <p>Your unshared masterpieces will appear here, awaiting your final touches.</p>\n    </div>\n    <div class="blank-state-placeholder" ng-show="!feed_data.fetching && !feed_data.initiating && feed_data.feed_items.length == 0 && activeFilter == trashFilter">\n      <i class="cnv-icons-64 icons2_Trash-lightgray"></i>\n      <p>Deleted posts will appear here.<br />You can delete them for good, or restore them to glorious new life.</p>\n    </div>\n\n    <div class="feed_load_status" ng-show="!hideFeedEndPlaceholder && !feed_data.all_fetched">\n      <div class="cnv-spinner light" ng-class="{\'no-anim\': !showLoadingSpinner}"></div>\n    </div>\n\n    <div ng-show="feed_data.all_fetched && activeFilter !== postFilter" class="feed-end-placeholder"></div>\n    <!-- <div ng-show="!feed_data.fetching && activeFilter != starredFilter && activeFilter != draftsFilter && activeFilter != trashFilter && activeFilter !== postFilter && !hideFeedEndPlaceholder" class="feed-end-placeholder"></div> -->\n\n    <div ng-if="activeFilter === postFilter" class="back-to-feed-bottom-cont">\n      <p>\n        <span class="meta">Nothing more to see here. Want to view more posts?</span><br>\n        <a href="#/feed">Back to News Feed</a>\n      </p>\n    </div>\n  </cnv-feed>\n</div>\n'),a.put("home/templates/cnvHomeCenterPanelDefaultHeader.tpl.html",'<!-- <div class="floated-left">\n	<span id="feed_title" ng-if="feed_title != \'My Feed\'">\n		{{ feed_title }}\n	</span>\n</div>\n\n<div class="clear-fix"></div>\n -->'),a.put("home/templates/homeRightPanel.tpl.html",'<div ng-if="viewState == \'DEFAULT\'">\n	<div ng-include="\'home/templates/rightPanels/feedRightPanel.tpl.html\'"></div>\n</div>\n\n<div ng-include="\'home/groupView/groupsRightPanel.tpl.html\'" ng-if="viewState == \'GROUP\' && !is_search"></div>\n\n<div ng-include="\'home/userView/usersRightPanel.tpl.html\'" ng-if="viewState == \'USER\' && !is_search" ng-controller="UsersRightPanelCtrl"></div>'),a.put("home/templates/rightPanels/feedRightPanel.tpl.html",'<div class="feed-right-panel-wrapper" ng-controller="FeedRightPanelCtrl">\n	\n\n	<div ng-if="onboardingStateActive" class="onboarding-right-panel">\n		<cnv-onboarding-checklist></cnv-onboarding-checklist>\n	</div>\n\n	<div ng-if="!onboardingStateActive">\n		<!-- Invite teammates -->\n		<cnv-feed-invite-widget bo-if="!userInfo.isGuestUser()"></cnv-feed-invite-widget>\n		<hr bo-if="!userInfo.isGuestUser()" />\n		\n		<!-- Set up integrations -->\n		<div class="row no-margin">\n			<span class="heading">Integrate with other apps</span>\n			<span>Use other apps? Get real time updates sent to Convo.</span>\n			<div class="icons-wrapper">\n				<a bo-href="twitterIntegrationsLink" bo-click=\'browseIntegrationApp("Twitter");\'><i class="cnv-icons-25 twitter_2"></i></a>\n                                <a bo-href="gmailIntegrationsLink" bo-click=\'browseIntegrationApp("Gmail");\'><i class="cnv-icons-25 gmail"></i></a>\n				<a bo-href="dropboxIntegrationsLink" bo-click=\'browseIntegrationApp("Dropbox");\'><i class="cnv-icons-25 dropbox"></i></a>\n				<a bo-href="salesForceIntegrationsLink" target="_blank" rel="noopener noreferrer" bo-click=\'browseIntegrationApp("Salesforce");\'><i class="cnv-icons-25 salesforce"></i></a>\n                                <a bo-href="boxIntegrationsLink" bo-click=\'browseIntegrationApp("Box");\'><i class="cnv-icons-25 box"></i></a>\n				<a bo-href="gDriveIntegrationsLink" bo-click=\'browseIntegrationApp("Google Drive");\'><i class="cnv-icons-25 gdrive"></i></a>\n			</div>\n			<button class="btn btn-block btn-default" ng-click="openIntegrationsPage()">Add an integration</button>\n		</div>\n\n		<hr />\n\n		<!-- Download apps -->\n		<div class="row no-margin downloadDesktopApp">\n			<span class="heading">Take Convo everywhere</span>\n			<span>Install Convo to stay connected on the go. Get notifications, review documents, and send messages.</span>\n			<div class="small-app-btns">\n				<i class="cnv-icons-20 Icon1_apple-01"></i>\n				<i class="cnv-icons-20 google_play"></i>\n				<i class="cnv-icons-20 Icon1_Desktop-01"></i>\n			</div>\n			<button class="btn btn-block btn-default" ng-click="openDownloadAppsModal()">Get apps</button>\n		</div>\n\n		<!-- <div class="row no-margin admin-banner-wrapper" ng-if="userInfo.isAdmin()">\n			All new admin tools are coming soon. In the meantime, <a href="{{::adminSettingsFlexURL}}" target="_blank">click here to manage your network</a> in the previous version of the app.\n		</div> -->\n	</div>\n\n	<!-- Show usage policy -->\n\n	<div style="display: inline-block;">\n		<hr bo-if="displayUsagePolicyInRightPanel" />\n		<div class="usagePolicy" bo-if="displayUsagePolicyInRightPanel">\n			This <a href="javascript:void(0)" ng-click="openUsagePolicyModal()">Usage Policy</a> governs your access and use of Convo.\n		</div>\n	</div>\n</div>\n\n<!-- <cnv-onboarding-checklist></cnv-onboarding-checklist> -->'),a.put("home/userView/centerPanelWidgets/profilePictureModal.tpl.html",'<section cnv-profile-picture-widget bindonce>\n  <!-- <div class="modal-header">\n      <h4 bo-show="currentStep == \'profilePic:enableCamera\' || currentStep == \'profilePic:showVideoFeed\'">Smile!</h4>\n      <h4 bo-show="currentStep == \'profilePic:adjustImage\'">Position & size your photo</h4>\n      <h4 bo-show="currentStep == \'profilePic:stepsComplete\'">You\'re done.</h4>\n      <h4 bo-show="currentStep == \'profilePic:selectFile\'">Select image</h4>\n      <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n  </div>\n -->\n  <div class="modal-body">\n    <div class="row" style="text-align: center;">\n      <h3 bo-show="currentStep == \'profilePic:showVideoFeed\'"><strong>Smile!</strong></h3>\n      <h3 bo-show="currentStep == \'profilePic:adjustImage\'"><strong>Looks great! Any adjustments?</strong></h3>\n      <h3 bo-show="currentStep == \'profilePic:stepsComplete\'"><strong>You\'re done.</strong></h3>\n      <h3 bo-show="currentStep == \'profilePic:selectFile\'"><strong>Select image</strong></h3>\n      <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n    </div>\n   \n    <div class="step0" bo-show="currentStep == \'profilePic:enableCamera\'">\n      <h3><strong>Starting webcam...</strong></h3>\n      <p>Choose "allow" or "accept" in your browser to continue\n      taking a photo for your Convo profile.</p>\n      <i class="cnv-icons-60 Icon1_arrow-01"></i>\n    </div>\n\n    <div class="step0" bo-show="currentStep == \'profilePic:selectFile\'">\n      <input type="file" id="profileImageUpload" name="profileImageUpload" style="display: inline-block;" />\n    </div>\n\n    <div class="error" ng-show="currentStep == \'profilePic:errorCamera\'">\n      <p>Error accessing camera. <a href="javascript:void(0)" ng-click="initializeCam()">Try again.</a></p>\n    </div>\n    \n    <div class="step1" bo-show="currentStep == \'profilePic:showVideoFeed\'">\n      <video autoplay="true" style="background-color: #666; display: block; margin: 0 auto;"></video>\n      <div class="video-overlay"></div>\n    </div>\n    \n    <div class="step2" bo-show="currentStep == \'profilePic:adjustImage\' || currentStep == \'profilePic:stepsComplete\'" bo-class="{\'uploading\': isUploading}">\n      \n      <!-- <div class="overlay"> \n        <div class="topMask"></div>\n        \n        <div class="mask"></div>\n        \n        <div class="selectionRect">\n        </div>\n        \n        <div class="mask"></div>\n        \n        <div class="bottomMask"></div>\n      </div> -->\n\n      <i class="cnv-circle-spinner-small" bo-show="isUploading"></i>\n\n      <!-- <canvas id="webcamCanvas" bo-if="startWebcam" style="display: block; margin: 0 auto;"></canvas> -->\n      \n      <img id="nativeUserUploadPhoto" style="position: absolute;" src="" />\n\n    </div>\n\n    <div class="row" bo-show="alerts">\n      <div class="alert alert-success" bo-show="alerts.success" bo-bind="alerts.success" role="alert"></div>\n      <div class="alert alert-danger" bo-show="alerts.error" bo-bind="alerts.error" role="alert"></div>\n    </div>\n\n    <input bo-show="currentStep == \'profilePic:adjustImage\'" type="range" min="1" max="5" value="1" id="profileZoomSlider" step="0.25" />\n\n    <div class="row" style="margin-top: 20px;">\n      <!-- <button bo-show="currentStep == \'profilePic:showVideoFeed\' || currentStep == \'" class="btn btn-default pull-left" ng-click="cancelPicture()">Cancel</button> -->\n      <button bo-show="currentStep == \'profilePic:adjustImage\' && startWebcam" class="btn btn-default pull-left" ng-click="initializeCam()">Retake</button>\n      <button bo-show="currentStep == \'profilePic:showVideoFeed\'" type="submit" class="btn btn-primary take-photo" ng-click="takePicture()">Take Photo</button>\n      <button bo-show="currentStep == \'profilePic:adjustImage\'" type="submit" class="btn btn-primary pull-right" ng-click="submitPhoto()">Apply Photo</button>\n    </div>\n    \n  </div>\n\n  <!-- <div class="modal-footer">\n      <a href="javascript:void(0)" ng-click="cancelPicture()">Cancel</a>\n      <button bo-show="currentStep == \'profilePic:showVideoFeed\'" type="submit" class="btn btn-primary" ng-click="takePicture()">Take Photo</button>\n      <button bo-show="currentStep == \'profilePic:adjustImage\'" type="submit" class="btn btn-primary" ng-click="submitPhoto()">Apply Photo</button>\n  </div> -->\n</section>\n'),
a.put("home/userView/cnvHomeCenterPanelUserHeader.tpl.html",'<span style="float: left; margin-right: 8px;" class="userview-dp-overlay">\n    <i bo-show="item.thisUser" class="camera-icon cnv-icons-17 icons_Camera-white"></i>\n    <div bo-show="item.thisUser" class="txt-btn" ng-click="openProfilePictureModal()"><i class="cnv-icons-15 icons_Camera-white"></i>&nbsp;Update</div>\n    <a bo-if="profileImageLink" bo-href="profileImageLink">\n        <cnv-user-profile-image user-id="user_id" width="84" height="84" bo-if="!item.contact" profile=true></cnv-user-profile-image>\n    </a>\n    <cnv-user-profile-image bo-if="!profileImageLink && !item.contact" user-id="user_id" width="84" height="84" profile=true></cnv-user-profile-image>\n    <img bo-if="item.contact" src="assets/img/smilies/smiley-01.svg" style="width: 84px; height: 84px; display: inline-block;"/>\n    \n\n    <!-- <div bo-show="item.thisUser" class="dropdown">\n        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">\n            <li role="presentation" bo-if="!utils.isIE() && !utils.isSafari() && !IS_NATIVE"><a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-click="setProfilePictureViaWebcam()">Set profile picture</a></li>\n            <li role="presentation"><a role="menuitem" tabindex="-1" ng-click="openFilePicker();">Upload profile picture</a></li>\n        </ul>\n    </div> -->\n</span>\n<!-- <div class="user-profile-image" bo-bind="item.initials" bo-style="{ \'background-color\': item.colorScheme }"></div> -->\n<div style="display: inline-block; max-width: 470px;" class="userview-header-content-wrapper">\n    <span id="feed_title">\n        <strong><span bo-bind="item.feedTitle" class="truncate"></span></strong>\n    <input type="file" id="userProfileImage" name="userProfileImage" style="width: 1px; height: 1px; display: block; position: absolute; z-index: 19999; top: -1000px; left: -1000px;" />\n    <cnv-dropdowns bo-if="showUserDropdown" style="display: inline-block; vertical-align: top;" cnv-dropdown-ctrl="dropdownCtrl"></cnv-dropdowns>\n    <input type="file" id="profileImageUpload" name="profileImageUpload" style="width: 1px; height: 1px; display: block; position: absolute; z-index: 19999; top: -1000px; left: -1000px;" />\n    </span>\n    <div ng-if="item.user_id || item.contact">\n        <div bo-if="item.designation || item.thisUser">\n            <span bo-bind="item.formattedDesignation" class="truncate"></span>\n            <a href="javascript:void(0);" bo-if="item.thisUser && !item.designation" ng-click="openEditProfileWidget(true, \'designation\')" class="truncate">Add</a>\n        </div>\n        <div>\n            <span bo-bind="item.formattedAboutMe | limitText:150" bo-if="!about_me_model.expand"></span>\n            <span bo-bind="item.formattedAboutMe" bo-if="about_me_model.expand"></span>\n            <a bo-if="item.about_me && item.about_me.length > 150 && !about_me_model.expand" href="javascript:void(0);" ng-click="toggle()">See More</a>\n            <a bo-if="item.about_me && item.about_me.length > 150 && about_me_model.expand" href="javascript:void(0);" ng-click="toggle()">Less</a>\n            <a bo-if="item.thisUser && !item.about_me" href="javascript:void(0);" ng-click="openEditProfileWidget(true, \'bio\')">Fix it</a>\n\n        </div>\n    </div>\n    <div ng-if="!item.user_id && !item.contact">...</div>\n</div>\n<div class="clear-fix"></div>\n<cnv-user-profile-edit-widget bo-if="showEditProfileModal"></cnv-user-profile-edit-widget>\n'),a.put("home/userView/rightPanelWidgets/cnvUserProfileDetailsWidget.tpl.html",'<div class="profile-details-wrapper">\n	<button class="btn btn-default btn-block top-btn-margin" ng-if="thisUser" ng-click="openEditProfileWidget()">Edit Profile</button>\n\n	<!-- follow/unfollow buttons -->\n	<!-- <button ng-if="!thisUser && user.logged_in_user_follows && user.user_role != \'GUEST\'" class="btn btn-default btn-block" ng-mouseenter="showUnfollowBtn(true)" bo-show="!unfollowBtn">\n		<i class="cnv-icons-20 check-blue" bo-show="!showSpinner"></i>\n		<i class="cnv-circle-spinner-small" bo-show="showSpinner"></i>\n		Following\n	</button>\n	<button ng-if="!thisUser && user.logged_in_user_follows  && user.user_role != \'GUEST\'" bo-show="unfollowBtn" class="btn btn-warning btn-block" ng-mouseleave="showUnfollowBtn(false)" ng-click="unfollowUser()">\n		<i class="cnv-icons-20 icon1-remove-red hover" bo-show="!showSpinner"></i>\n		<i class="cnv-circle-spinner-small" bo-show="showSpinner"></i>\n		Unfollow\n	</button>\n	<button ng-if="user && !thisUser && !user.logged_in_user_follows && user.user_role != \'GUEST\' && user.user_status != \'REMOVED\' && user.user_type != \'SYSTEM\' && user.user_status != \'INVITED\' && !user.contact" class="btn btn-default btn-block" ng-click="followUser()"><i class="cnv-circle-spinner-small" bo-show="showSpinner"></i>Follow\n	</button> -->\n\n	<button ng-if="user.contact" class="btn btn-primary btn-block" bo-class="{\'disabled\': (user.status == \'INVITED\' || showSpinner) }" ng-click="inviteUser()"><i class="cnv-circle-spinner-small" bo-show="showSpinner"></i>Invite\n	</button>\n\n	<button ng-if="user.user_status == \'INVITED\' &&  !user.can_send_reminder" class="btn btn-primary btn-block disabled">Invite</button>\n\n	<button ng-if="user.user_status == \'INVITED\' && user.can_send_reminder" class="btn btn-default btn-block" ng-click="remindInvitationToUser()">\n		<i class="cnv-circle-spinner-small" bo-show="showSpinner"></i>\n		<i class="cnv-icons-16 icons2_Add-blue"></i>Send Reminder\n	</button>\n	\n	<!-- end - follow/unfollow buttons -->\n\n	<div class="profile-details-inner-wrapper">\n		<div class="profile-details">\n			<h5 class="profile-details-heading">Profile Details</h5>\n\n			<span class="detail-item" ng-if="user.user_account_email">\n				<i class="cnv-icons-20 email-lightgray-new email-icon"></i>\n				<!-- <a bo-href="\'mailto:\' + user.user_account_email" bo-bind=""></a> -->\n				<span class="detail-content">{{user.user_account_email}}</span>\n			</span>\n			<span class="detail-item" ng-if="userProfileDetails.phone.field_value && !thisUser || thisUser">\n\n				<span class="detail-content line-clamp" ng-if="userProfileDetails.phone.field_value">\n					<i class="cnv-icons-20 phone-lightgray"></i>\n					{{userProfileDetails.phone.field_value}}\n				</span>\n				<i class="cnv-icons-20 phone" ng-if="!userProfileDetails.phone.field_value && thisUser"></i>\n				<span ng-if="!userProfileDetails.phone.field_value && thisUser" class="text-link" ng-click="openEditProfileWidget(\'phone\')">Add Phone Number</span>\n			</span>\n			<span class="detail-item" ng-if="userProfileDetails.location.field_value && !thisUser || thisUser">\n				<span class="detail-content line-clamp" ng-if="userProfileDetails.location.field_value">\n					<i class="cnv-icons-20 location"></i>\n					{{userProfileDetails.location.field_value}}\n				</span>\n				<i class="cnv-icons-20 location" ng-if="!userProfileDetails.location.field_value && thisUser"></i>\n				<span ng-if="!userProfileDetails.location.field_value && thisUser" class="text-link" ng-click="openEditProfileWidget(\'location\')"> Add Location</span>\n			</span>\n\n			<span class="detail-item" ng-if="userProfileDetails.linkedin.field_value">\n				<a target="_blank" bo-href="userProfileDetails.linkedin.field_value">\n					<span class="detail-content line-clamp">\n						<i class="cnv-icons-20 linkedin-darkgray opacity-40"></i>\n							{{userProfileDetails.first_name.field_value}}`s LinkedIn\n					</span>\n				</a>\n			</span>\n\n			<span class="detail-item" ng-if="userProfileDetails.twitter.field_value">\n				<a target="_blank" bo-href="userProfileDetails.twitter.field_value">\n					<span class="detail-content line-clamp">\n						<i class="cnv-icons-20 twitter-darkgray opacity-40"></i>\n						{{userProfileDetails.twitter.field_value}}\n					</span>\n				</a>\n			</span>\n		</div>\n\n		<div class="additional-info" ng-show="userProfileCustomFields.length > 0 && hasAddionalFieldsValues">\n			<h5 class="additional-info-heading">Additional Info</h5>\n\n			<span ng-show="userProfile" class="detail-item"\n			ng-repeat="custom in userProfileCustomFields | limitTo: limitAdditionalFields">\n				<!-- <span class="detail-name">{{custom.field_name}}</span> -->\n				<span ng-if="custom.field_value.length > 0" class="detail-content line-clamp"><span class="detail-name">{{custom.field_name}}</span>{{custom.field_value}}</span>\n			</span>\n\n			<span class="showMoreLess" ng-show="limitAdditionalFields && userProfileCustomFields.length > 5 && hasAddionalValuesCount > 5" ng-click="increasseAdditionalFieldsLimit()">See more...</span>\n			<span class="showMoreLess" ng-show="!limitAdditionalFields && userProfileCustomFields.length > 5 && hasAddionalValuesCount > 5" ng-click="increasseAdditionalFieldsLimit()">See less...</span>\n		</div>\n	</div>\n\n\n	<!-- <span class="text-center">\n\n		<a ng-if="user.email" bo-href="\'mailto:\' + user.email">\n			<i class="feed-sprite sprite-email"></i>\n		</a>\n		<a ng-if="!user.email" href="javascript:void(0)" class="default-cursor">\n			<i class="feed-sprite sprite-email-dim"></i>\n		</a>\n		\n		<a ng-if="user.linked_in_link" target="_blank" bo-href="user.linked_in_link">\n			<i class="feed-sprite sprite-linkedin"></i>\n		</a>\n		<a ng-if="!user.linked_in_link" href="javascript:void(0)" class="default-cursor">\n			<i class="feed-sprite sprite-linkedin-dim"></i>\n		</a>\n		\n		<a ng-if="user.twitter_link" target="_blank" bo-href="user.twitter_link">\n			<i class="feed-sprite sprite-twitter"></i>\n		</a>\n		<a ng-if="!user.twitter_link" href="javascript:void(0)" class="default-cursor">\n			<i class="feed-sprite sprite-twitter-dim"></i>\n		</a>\n\n	</span> -->\n	\n</div>'),a.put("home/userView/rightPanelWidgets/cnvUserProfileDiscussionsWidget.tpl.html",'<div class="my-discussions-wrapper">\n	<a href="#">My discussions with Professor Dr. Eric</a>\n</div>'),a.put("home/userView/rightPanelWidgets/cnvUserProfileEditWidget.tpl.html",'<div class="users-profile-edit-overlay" bindonce>\n	<div class="container">\n		<div class="row no-margin">\n			<div class="pull-left profile-img-basic-info">\n					<div class="pull left dp-container">\n						<cnv-user-profile-image user-id="item.user_id"\n						profile-type="userProfile.user_profile_image_info.user_profile_image.user_profile_image_type"\n						profile-version="userProfile.user_profile_image_info.user_profile_image.user_profile_image_version"\n						width="\'237\'"\n						height="\'244\'"\n						class="img-rounded"\n						></cnv-user-profile-image>\n						<!-- <div class="add-photo-overlay">\n							<span>+ Photo</span>\n						</div> -->\n						<!-- <i class="camera-icon cnv-icons-17 icons_Camera-white"></i> -->\n						<div class="txt-btn" ng-click="openProfilePictureModal()">Upload</div>\n						<!-- <div class="dropdown">\n							<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">\n								<li role="presentation" bo-if="!utils.isIE() && !utils.isSafari() && !IS_NATIVE"><a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-click="setDpFromEditProfileWidget()">Set profile picture</a></li>\n								<li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-click="uploadDpFromEditProfileWidget()">Upload profile picture</a></li>\n							</ul>\n						</div> -->\n					</div>\n					<div class="left-panel-fixed-fields-container">\n						<div cnv-editable-text-field class="first-last-name-text" type="inputTextTwo" ng-model="dataMap.leftSection.first_name" model-two="dataMap.leftSection.last_name"></div>						\n						<div cnv-editable-text-field class="designation-text" type="inputText" ng-model="dataMap.leftSection.designation"></div>\n					</div>\n			</div>\n			<div class="pull-left form-container">\n				<form name="updateDetails" ng-submit="submitUserDetails()" role="form">\n					<h2 class="about-me-label">About Me</h2>\n					<div class="bio-text" cnv-editable-text-field type="inputTextArea" ng-model="dataMap.topSection.bio"></div>					\n					<div class="profile-info-tabs-container">\n						<ul class="profile-info-tabs" ng-init="isContactInfoTab = true;">\n							<li ng-class="{active: isContactInfoTab}" ng-click="changeTab(true);">Contact Info</li>\n							<li ng-if="dataMap.bottomSection.custom.length > 0" ng-class="{active: !isContactInfoTab}" ng-click="changeTab(false);">Additional Info</li>\n						</ul>\n\n						<div class="contact-info-tab animate-if" ng-if="isContactInfoTab">\n				\n									<!-- <div class="row textbox" bo-class="{\'has-error\': updateDetails.bio.$error.maxlength}">\n										<span class="help-block" bo-if="updateDetails.bio.$error.maxlength">Max limit is 255 characters.</span>\n										<textarea id="bio" name="bio" type="text" class="form-control" placeholder="Enter a short bio" ng-maxlength="255" ng-model="user.about_me"></textarea>\n									</div> -->\n\n									<div class="info-label-editable">\n										<!-- <img class="action_icon" src="assets/cnv-icons/source-icons/email-darkgray.svg" /> -->\n										<span><i class=" action_icon cnv-icons-20 icons_Email-darkgray"></i></span>\n										<p style="display: inline;">\n										<strong>{{dataMap.bottomSection.fixed.email.field_name}}: </strong><span class="email-hover-wrapper">{{dataMap.bottomSection.fixed.email.field_value}}</span><span ng-click="navigateToUserSettings()" class="pull-right action-text hide">change</span>\n										</p>\n									</div>\n\n									<div ng-if="!!dataMap.bottomSection.fixed.phone.field_name"\n									cnv-editable-text-field type="inputTextLabelIcon"\n									img-src="cnv-icons-20 icons_Phone-darkgray"\n									ng-model="dataMap.bottomSection.fixed.phone"\n									model-two="dataMap.bottomSection.fixed.phone"\n									></div>\n\n									<div ng-if="!!dataMap.bottomSection.fixed.location.field_name"\n									cnv-editable-text-field type="inputTextLabelIcon"\n									img-src="cnv-icons-20 icons_Location-darkgray"\n									ng-model="dataMap.bottomSection.fixed.location"\n									model-two="dataMap.bottomSection.fixed.location"\n									></div>\n									\n									<div ng-if="!!dataMap.bottomSection.fixed.linkedin.field_name"\n									cnv-editable-text-field type="inputTextLabelIcon"\n									img-src="cnv-icons-20 linkedin-darkgray"									\n									ng-model="dataMap.bottomSection.fixed.linkedin"\n									model-two="dataMap.bottomSection.fixed.linkedin"\n									></div>\n									\n									<div ng-if="!!dataMap.bottomSection.fixed.twitter.field_name"\n									cnv-editable-text-field type="inputTextLabelIcon"\n									img-src="cnv-icons-20 twitter-darkgray"									\n									ng-model="dataMap.bottomSection.fixed.twitter"\n									model-two="dataMap.bottomSection.fixed.twitter"\n									></div>\n				\n									<!-- <div class="row" bo-class="{\'has-error\': updateDetails.location.$error.maxlength}">\n										<span class="help-block" bo-if="updateDetails.location.$error.maxlength">Max limit is 255 characters.</span>\n										<i class="cnv-icons-20 icons_Location-lightgray"></i>\n										<div class="input">\n											<input id="location" name="location" type="text" class="form-control" placeholder="Enter your location" ng-maxlength="255" ng-model="user.location" />\n										</div>\n									</div>\n				\n									<div class="row" bo-class="{\'has-error\': updateDetails.phone.$error.maxlength}">\n										<span class="help-block" bo-if="updateDetails.phone.$error.maxlength">Max limit is 255 characters.</span>\n										<i class="cnv-icons-20  icons_Phone-lightgray"></i>\n										<div class="input">\n											<input id="phone" type="text" name="phone" class="form-control ng-pristine ng-valid ng-valid-parse ng-valid-maxlength ng-touched" placeholder="Enter your phone number" ng-maxlength="255" ng-model="user.phone_no" spellcheck="false">\n										</div>\n									</div>\n				\n									<div class="row" bo-class="{\'has-error\': updateDetails.linkedin.$error.maxlength || updateDetails.linkedin.$error.pattern}">\n										<i class="cnv-icons-20 linkedin-lightgray"></i>\n										<span class="help-block" bo-if="updateDetails.linkedin.$error.maxlength">Max limit is 255 characters.</span>\n										<span class="help-block" bo-if="updateDetails.linkedin.$error.pattern">This is not a valid link</span>\n										<div class="input">\n											<input id="linkedin" height="39" type="text" name="linkedin" class="form-control" placeholder="linkedin.com/pub/user" ng-pattern="/linkedin\\.com\\/[a-zA-Z0-9_]+/" ng-maxlength="255" ng-model="user.linked_in_link" />\n										</div>\n									</div>\n				\n									<div class="row" bo-class="{\'has-error\': updateDetails.twitter.$error.maxlength || updateDetails.twitter.$error.pattern}">\n										<i class="cnv-icons-20 twitter-lightgray"></i>\n										<span class="help-block" bo-if="updateDetails.twitter.$error.maxlength">Max limit is 255 characters.</span>\n										<span class="help-block" bo-if="updateDetails.twitter.$error.pattern">This is not a valid link</span>\n										<div class="input">\n											<input id="twitter" height="39" type="text" name="twitter" class="form-control" placeholder="twitter.com/user" ng-pattern="/twitter\\.com\\/(#!\\/)?[a-zA-Z0-9_]+/" ng-maxlength="255" ng-model="user.twitter_link"  onfocus="this.value = this.value;" />\n										</div>\n									</div> -->\n						</div>\n\n						<div class="additional-info-tab animate-if" ng-if="!isContactInfoTab && dataMap.bottomSection.custom.length > 0">\n\n							<div ng-if="dataMap.bottomSection.custom.length > 0" ng-repeat="customField in dataMap.bottomSection.custom"\n							cnv-editable-text-field\n							type="inputTextWithLabel"\n							ng-model="dataMap.bottomSection.custom[$index]"\n							model-two="dataMap.bottomSection.custom[$index]"\n							></div>\n\n							<p ng-if="dataMap.bottomSection.custom.length == 0" class="no-custom-fields">No custom fields available.</p>							\n						</div>\n					</div>\n\n					<div class="row pull-right action-buttons">\n						<button type="button" class="btn btn-default" ng-click="openEditProfileWidget(false)">Cancel</button> \n						<button type="submit" class="btn btn-primary pull-right btn-submit" tabindex="-1">Save</button>\n					</div>\n\n				</form>\n			</div>\n		</div>\n	</div>\n</div>\n\n'),a.put("home/userView/rightPanelWidgets/cnvUserProfileTopGroupsWidget.tpl.html",'<div class="user-top-groups-wrapper" bo-show="topGroups" bindonce>\n	<span bo-show="user">{{user.first_name}}\'s top groups</span>\n	<ul>\n		<li ng-repeat="group in topGroups" bo-href="group.group_id | idToFilterUrlForApp:\'Group\'">\n'+"			<i class=\"cnv-icons-20\" bo-class=\"{'privateGroup_icon-darkgray': group.access == 'PRIVATE' || group.access == 'SECRET', 'Icon1_PublicChannel-01-darkgray': group.access == 'PUBLIC'}\"></i>\n			<a bo-href=\"group.group_id | idToFilterUrlForApp:'Group'\" bo-bind=\"group.title\"></a>\n		</li>\n	</ul>\n</div>"),a.put("home/userView/usersRightPanel.tpl.html",'<div class="user-right-panel-wrapper" bindonce>\n	\n	<!-- User\'s profile details widget -->\n	<cnv-user-profile-details-widget></cnv-user-profile-details-widget>\n\n	<hr bo-if="user.user_role != \'GUEST\'" />\n\n	<!-- My Discussions widget -->\n	<!-- <cnv-user-profile-discussions-widget></cnv-user-profile-discussions-widget> -->\n\n	<!-- <hr /> -->\n\n	<!-- User\'s Top Groups widget -->\n	<cnv-user-profile-top-groups-widget></cnv-user-profile-top-groups-widget>\n\n	<!--<hr bo-if="thisUser" />-->\n\n	<!--<div class="user-emails" bo-if="thisUser">-->\n		<!--<span>Forward emails to:</span>-->\n		<!--<ul>-->\n'+"			<!--<a bo-href=\"'mailto:myfollowers@' + accountInfo.getPrimaryAccountDomain().account_domain + '.convo.com'\"><li bo-bind=\"'myfollowers@' + accountInfo.getPrimaryAccountDomain().account_domain + '.convo.com'\"></li></a>-->\n			<!--<a bo-href=\"'mailto:me@' + accountInfo.getPrimaryAccountDomain().account_domain + '.convo.com'\"><li bo-bind=\"'me@' + accountInfo.getPrimaryAccountDomain().account_domain + '.convo.com'\"></li></a>-->\n		<!--</ul>-->\n	<!--</div>-->\n\n	<div bo-if=\"user.contact || user.user_status === 'INVITED'\" class=\"meta\">\n		<span bo-bind=\"user.contact ? user.contact_email : user.user_account_email\"></span><span> hasn't joined yet, but you can still share posts, groups and start chats.</span>\n		<br>\n		<br>\n		<span>Your messages will be delivered via email.</span>\n	</div>\n\n	\n</div>"),a.put("inlineInsert/cnvInlineInsert.tpl.html",'<div id="inline-insert-files-paste-target" class="inline-insert-cont cnv-onboarding-overlay" ng-class="{active: active}">\n  <cnv-dropzone dropzone-id="\'inline-insert-files-drop-target\'"></cnv-dropzone>\n  \n  <div class="dummy-text-area" ng-show="!active" ng-click="onDummyTextAreaClick($event)">\n    <div class="dummy-area-cont">\n      <cnv-user-profile-image width="\'32\'" height="\'32\'"\n                              img-url="user_info.getUserImageUrl_64x64" user-id="user_info.user_id"\n                              profile-type="user_info.profile_image_type" profile-version="user_info.profile_image_version"\n                              full-name="user_info.first_name + \' \' + user_info.last_name"\n                              style="margin: 0px 4px; position: relative; top: 1px;">\n      </cnv-user-profile-image>\n      <span id="inlineInsertPlaceholderText">{{inlineInsertPlaceholderText}}</span>\n      <div class="icons2_Attach-darkgray attachIconInlineInsert inlineInsertAttachmentIconWhenClosed" ng-click="onDummyTextAreaUploadIconClick()">\n      </div>\n    </div>\n  </div>\n  \n  <div class="sharing-state-overlay" ng-show="sharing">\n    <div class="cnv-spinner inline-insert-spinner"></div>\n  </div>\n  <div class="inline-insert-active-cont-wrapper" cnv-clicked-outside-this="cnvClickedOutsideThis(target)">\n    <div class="inline-insert-active-cont" ng-if="active">\n      <div class="to-field-cont" ng-class="{\'valid\': validSharingInfo, \'invalid\': !validSharingInfo}">\n        <tags-input class="to-field"\n        ng-model="shareWith"\n        placeholder="+Add user, group or email"\n        pre-placeholder="To:"\n        no-tags-indicator="true"\n        add-on-comma="false"\n        add-on-blur="false"\n        horizontal-flow = "false"\n        add-from-autocomplete-only="true"\n        display-property="label"\n        replace-spaces-with-dashes="false"\n        on-esc-key-press="onEscKeyPressInToField()"\n        on-tag-added="onItemAddedInToField($tag)"\n        on-tag-removed="onItemRemovedInToField($tag)"\n        on-ctrl-cmd-enter="onCtrlOrCmdEnterPressInTextEditor()"\n        on-ctrl-cmd-save="onCtrlOrCmdSavePressInTextEditor()">\n        <auto-complete\n          source="getShareWithDropdownItemsWithoutCommands($query, numSelected)"\n          load-history-on-focus="true"\n          auto-select-first-suggestion="true"\n          delimiter="@"\n          min-length="1"\n          suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n        </auto-complete>\n        </tags-input>\n        <div class="post-permission-options" ng-hide="starter_network && isGuest">\n          <cnv-dropdowns cnv-dropdown-ctrl="dropdownCtrl" condition=\'iconCondtions\'></cnv-dropdowns>\n        </div>\n      </div>\n      <div class="rich-note-insert edit-mode no-padding" ng-if="mode == RICH_NOTE_MODE">\n        <input id="noteTitleField" class="note-title-field" ng-model="model.noteTitleText" placeholder="Title" type="text" maxlength="1000" ng-keydown="onTitleKeydown($event)"/>\n        <div class="req-full-screen" ng-click="openWithDetailsView($event)" ng-hide="IS_NATIVE_MENULET" tabindex="-1" cnv-popover cnv-popover-ctrl="\'Expand to the full screen editor\'">\n          <a href="javascript:void(0);" class="maximize-lightgray" target="{{::maximizeButtonTarget}}" tabindex="-1"></a>\n          <a href="javascript:void(0);" class="maximize-darkgray" target="{{::maximizeButtonTarget}}" tabindex="-1"></a>\n        </div>\n        <cnv-editor cnv-text-editor-mode="full"\n          cnv-text-editor-ctrl="noteEditorCtrl"\n          cnv-at-mentions="getShareWithDropdownItems($query, delimiter, 0)"\n          cnv-hashtags="getHashtagDropdownItems($query)"\n          cnv-placeholder="{{cnv_mainPlaceholder}}"\n          toolbar-id="inline-insert-toolbar"\n          cnv-at-mentions-suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html"\n          cnv-text-editor-on-url-added="onUrlAddedInNoteEditor(data)"\n          cnv-on-at-mention-added="onAtMentionAdded(item)"\n          cnv-on-command-executed="OnCommandExecuted(item, search)"\n          cnv-on-hash-tag-added="onHashTagAdded(item)"\n          cnv-on-at-mention-removed="onAtMentionRemoved(item)"\n          cnv-text-selection-removed="onTextSelectionRemoved($atMentionNodes)"\n          cnv-text-editor-on-esc-key-press="onEscKeyPressInTextEditor()"\n          cnv-text-editor-on-ctrl-or-cmd-enter-press="onCtrlOrCmdEnterPressInTextEditor()"\n          cnv-text-editor-on-ctrl-or-cmd-save-press="onCtrlOrCmdSavePressInTextEditor()"\n          cnv-text-editor-on-shift-tab-press="onShiftTabPressInTextEditor()"\n          cnv-editor-source="Compose"\n                    cnv-text-editor-on-space-key-press="onSpaceKeyPressInTextEditor()"\n                    cnv-text-editor-on-enter-key-press="onEnterKeyPressInTextEditor()"\n                    cnv-text-editor-on-tab-key-press="onTabKeyPressInTextEditor()">\n        </cnv-editor>\n        \n        <div class="inlineInsertEmojiHolder"><cnv-emoji-popover cnv-emoji-fixed-on-scroll= "false" cnv-editor-ctrl="noteEditorCtrl" class="emojiInlineInsert"></cnv-emoji-popover></div>\n        <!-- Add location -->\n        <div ng-if="!model.location && showSpinner" class="cnv-spinner cnv-spinner-inline-insert"></div>\n        <div ng-if="model.location" class="location-container">\n          <div class="close-btn">\n            <i class=" close-btn-icon pull-right cnv-icons-17 icons2_Close-darkgray" ng-click="onRemoveLocation()"></i>\n          </div>\n          <p class="geo-location">at <span class="geo-location-text">{{model.location.title.length > 0 ? model.location.title : (model.location.lat + \', \' + model.location.lng)}}</span></p>\n        </div>\n        <div cnv-upload-files-ui-manager\n          cnv-upload-files-ui-manager-ctrl="filesUploadManagerCtrl"\n          cnv-insert-add-item-options-ctrl="insertOptionsCtrl"\n          class="filesUploadContainer"\n          cnv-mouse-wheel-scroll>\n        </div>\n\n      </div>\n      <div class="link-insert edit-mode" ng-if="mode == LINK_MODE">\n        <cnv-editor cnv-text-editor-mode="basic"\n        cnv-text-editor-ctrl="linkCommentEditorCtrl"\n        cnv-at-mentions="getShareWithDropdownItems($query, delimiter ,0)"\n        cnv-hashtags="getHashtagDropdownItems($query)"\n        cnv-at-mentions-suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html"\n        cnv-on-command-executed="OnCommandExecuted(item, search)"\n        cnv-on-at-mention-added="onAtMentionAdded(item)"\n        cnv-on-at-mention-removed="onAtMentionRemoved(item)"\n        cnv-on-hash-tag-added="onHashTagAdded(item)"\n        cnv-text-selection-removed="onTextSelectionRemoved($atMentionNodes)"\n        cnv-text-editor-on-esc-key-press="onEscKeyPressInTextEditor()"\n        cnv-placeholder="Add a comment..."\n        cnv-text-editor-on-ctrl-or-cmd-enter-press="onCtrlOrCmdEnterPressInTextEditor()"\n        cnv-editor-source="Compose"\n                    cnv-text-editor-on-space-key-press="onSpaceKeyPressInTextEditor()"\n                    cnv-text-editor-on-focus-out="onFocusOut()"\n                    cnv-text-editor-on-enter-key-press="onEnterKeyPressInTextEditor()"\n                    cnv-text-editor-on-tab-key-press="onTabKeyPressInTextEditor()">\n        </cnv-editor>\n        <div cnv-share-link cnv-link-resolver-ctrl="linkResolveCtrl" class=\'link-insert-container\'></div>\n      </div>\n      \n      <div ng-if="tagField" class="tags-field-cont">\n        <tags-input\n        ng-model="tagList"\n        pre-placeholder="Add tags: "\n        placeholder="start typing..."\n        no-tags-indicator="false"\n        add-on-comma="true"\n        add-on-blur="true"\n        add-from-autocomplete-only="false"\n        display-property="label"\n        replace-spaces-with-dashes="true"\n        prefix-delimiter="#"\n        on-esc-key-press="onEscKeyPressInToField()"\n        allowed-tags-pattern="^#[0-9a-zA-Z_-]+.*$"\n        on-tag-added="onItemAddedInTagField($tag)"\n        on-tag-removed="onItemRemovedInTagField($tag)"\n        on-ctrl-cmd-enter="onCtrlOrCmdEnterPressInTextEditor()">\n        <auto-complete\n          source="getHashtagDropdownItems($query)"\n          load-history-on-focus="false"\n          auto-select-first-suggestion="false"\n          delimiter="#"\n          min-length="1"\n          suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n        </auto-complete>\n        </tags-input>\n      </div>\n    </div>\n    \n    <div id="inline-insert-toolbar" ng-if="active" ng-show="toolbarActive" class="inline-insert-toolbar-placeholder">\n      <span class="ql-format-group">\n        <span class="ql-format-button ql-bold icons3_Bold-{{::nativeIconColor}}"></span>\n        <span class="ql-format-button ql-italic italic-{{::nativeIconColor}}"></span>\n        <span class="ql-format-button ql-underline underline-{{::nativeIconColor}}"></span>\n        <span class="ql-format-button ql-strike strikethrough-{{::nativeIconColor}}"></span>\n        <select title="Text Color" class="ql-color">\n          <option value="#000000" selected></option><option value="#444444"></option>\n          <option value="#666666"></option><option value="#999999"></option>\n          <option value="#cccccc"></option><option value="#eeeeee"></option>\n          <option value="#f3f3f3"></option><option value="#fcfcfc"></option>\n          <option value="#ed462e"></option><option value="#f39e30"></option>\n          <option value="#fef936"></option><option value="#75f012"></option>\n          <option value="#6cf9fb"></option><option value="#0049fb"></option>\n          <option value="#8553fb"></option><option value="#e865fe"></option>\n          <option value="#eed0cd"></option><option value="#f9e7ce"></option>\n          <option value="#fcf1ce"></option><option value="#dce8d3"></option>\n          <option value="#d2e0e3"></option><option value="#d0e4f2"></option>\n          <option value="#d7d4e8"></option><option value="#e6d4db"></option>\n          <option value="#dfa29b"></option><option value="#f4cc9f"></option>\n          <option value="#fde49d"></option><option value="#bed3a9"></option>\n          <option value="#a8c4c8"></option><option value="#a2c7e5"></option>\n          <option value="#b0add5"></option><option value="#ceacbd"></option>\n          <option value="#d3746d"></option><option value="#edb573"></option>\n          <option value="#fad66e"></option><option value="#9dbe7e"></option>\n          <option value="#7fa5ad"></option><option value="#78abdb"></option>\n          <option value="#8984c1"></option><option value="#b884a1"></option>\n          <option value="#bc3723"></option><option value="#de9647"></option>\n          <option value="#ebc144"></option><option value="#78a150"></option>\n          <option value="#51818b"></option><option value="#4887c3"></option>\n          <option value="#5f5ba5"></option><option value="#9b5b79"></option>\n          <option value="#8e2819"></option><option value="#ab6520"></option>\n          <option value="#bb9223"></option><option value="#487120"></option>\n          <option value="#214f5a"></option><option value="#185891"></option>\n          <option value="#2e2b73"></option><option value="#6a2d49"></option>\n          <option value="#5e170c"></option><option value="#704314"></option>\n          <option value="#7c6014"></option><option value="#304a15"></option>\n          <option value="#16343d"></option><option value="#103b61"></option>\n          <option value="#1b1c4b"></option><option value="#461b2f"></option>\n        </select>\n      </span>\n      <span class="ql-format-separator"></span>\n      <span class="ql-format-group">\n        <span class="ql-format-button ql-list numberedlist-{{::nativeIconColor}}"></span>\n        <span class="ql-format-button ql-bullet orderedlist-{{::nativeIconColor}}"></span>\n      </span>\n      <span class="ql-format-separator" ng-hide="IS_NATIVE_MENULET"></span>\n      <span class="ql-format-group" ng-hide="IS_NATIVE_MENULET">\n        <span class="ql-inline-link ql-format-button ql-link icons_Links-{{::nativeIconColor}}"></span>\n      </span>\n    </div>\n\n    \n    <div class="bottom-bar-cont" ng-show="active">\n      <cnv-insert-add-item-options ng-if="mode != LINK_MODE" cnv-insert-add-item-options-ctrl="insertOptionsCtrl" class=\'add-controls pull-left\'></cnv-insert-add-item-options>\n      <button  ng-if="active" class="btn btn-primary" type="button" ng-click="onShareBtnClick()" style="-webkit-font-smoothing: subpixel-antialiased;" cnv-popover="" cnv-popover-ctrl="isBlankPostTooltip()">Share</button>\n      <label ng-hide="IS_NATIVE_MENULET">{{noteSaveText}}</label>\n      <div class="clear"></div>\n    </div>\n  </div>\n</div>'),
a.put("inlineInsert/cnvInsertAddItemOptions.tpl.html",'<div prevent-event-mousedown class="editor-toolbar texttoolbar-{{::nativeIconColor}}" ng-class="{\'pressed\': textToolbar.active}" ng-click="textToolbar.toggle($event)"></div>\n\n<label class="separator"></label>\n\n<div class="icons2_Attach-{{::nativeIconColor}} attachIconInlineInsert" ><!--ng-hide="IS_NATIVE_MENULET"-->\n	<input name=\'file\' id="sharing" class=\'file-input\' type=\'file\' multiple=\'multiple\'></input>\n</div>\n<div class="icons3_Dropbox-{{::nativeIconColor}}" cnv-drop-box-files-integrator cnv-file-input-service-context="fileInputContext"></div>\n<div class="Icon2__Box-15-{{::nativeIconColor}}" cnv-box-files-integrator cnv-file-input-service-context="fileInputContext"></div>\n<div class="icons3_Google_Drive-{{::nativeIconColor}}" cnv-google-drive-files-integrator cnv-file-input-service-context="fileInputContext" ng-hide="IS_NATIVE_MENULET"></div>\n <cnv-giphy-popover bo-if="showGiphy" cnv-file-context="fileInputContext" cnv-giphy-information="giphyObject" cnv-giphy-icon-class="giphy" cnv-giphy-mixpanel-info="Compose"></cnv-giphy-popover>\n <cnv-upload-from-url cnv-file-context="fileInputContext"></cnv-upload-from-url>\n<label class="separator"></label>\n\n<div class="icon_tag-01-01-darkgray" ng-click="toggleTagsField()"></div>\n<div ng-if="mode != LINK_MODE && !model.location && !isNative" id="location-icon" class="icons_Location-darkgray" ng-click="onLocationPinClick();"></div>\n<div ng-if="mode != LINK_MODE && !!model.location && !isNative" id="location-icon" class="icons_Location-blue" ng-click="onLocationPinClick();"></div>\n'),a.put("inlineInsert/dropzone/cnvDropzone.tpl.html",'<div class="dropzone" ng-show="activated" ng-class="{\'dropzone-expand\': expand, \'dropzone-collapse\': !expand}">\n	<div>\n		<div class="dropzone-target" ng-class="messageClass" ng-bind="dropzoneMessage"></div>\n	</div>\n</div>\n'),a.put("inlineInsert/shareLink/cnvShareLink.tpl.html",'<span ng-if="!hideProcessingState" class=\'close-share-link\' ng-Click=\'remove();\'>\n	<span class="icons2_Close-white cnv-icons-18"></span>\n</span>\n\n<div ng-if="state === LINK_STATE_PROCESSING && !hideProcessingState" class="spinner">\n    <!-- <div class="bounce1"></div>\n    <div class="bounce2"></div>\n    <div class="bounce3"></div> -->\n    <div class="cnv-spinner light"></div>\n</div>\n\n<div class="link-container-wrapper" ng-if="state === LINK_RESOLVE_STATE_SUCCESS || state === LINK_RESOLVE_STATE_FAILED">\n	<div ng-if=\'state === LINK_RESOLVE_STATE_SUCCESS\'>\n		<div ng-if="thumbnails" class="link-share-thumbnail" style="background-image: url(\'{{ relativeToAbsolute( thumbnails[data.selectedIndex] ) }}\');">\n			<div ng-if=\'navigation == true\' class="navigation">\n				<div ng-class="{\'navigation-disable\': prevNavigation == false}" class=\'navigation-prev\'><i class="glyphicon glyphicon-chevron-left" ng-Click=\'showPrevIcon()\'></i></div>\n				<div ng-class="{\'navigation-disable\': nextNavigation == false}" class=\'navigation-next\'><i class="glyphicon glyphicon-chevron-right" ng-Click=\'showNextIcon()\'></i></div>\n			</div>\n		</div>\n	</div>\n\n	<div class="link-info" ng-if=\'state === LINK_RESOLVE_STATE_SUCCESS\' ng-class="{\'auto-width\': !thumbnails}">\n		<div ng-if="!editTitleMode" class="title-text">\n			<img ng-if="data.favicon_url_encoded" ng-src="{{data.favicon_url_encoded}}" style="float: left;margin-right: 3px;margin-top: 2px; width: 16px; height: 16px;"/>\n			<span ng-click="editTitle($event)" ng-bind-html="data.title | limitTo:45"></span>\n		</div>\n		<textarea ng-blur="onBlur($event)" ng-if="editTitleMode" ng-model="data.title" class="title"></textarea>\n\n		<div class="link-share-description" ng-hide="!shareLinktextEditorCtrl.initialHtmlText && disableLinkEditingOptions==\'true\'" ng-click="editDesc($event)">\n			<cnv-editor \n				cnv-text-editor-mode="minimal"\n				cnv-read-only="true"\n	            cnv-text-editor-ctrl="shareLinktextEditorCtrl"\n	            cnv-placeholder="{{::descPlaceholder}}"\n	            cnv-focus-on-load="false"\n	            cnv-editor-source="share-link">\n	        </cnv-editor>\n		</div>\n		<div class="link-share-address">{{data.domain | uppercase}}</div>\n	</div>\n\n	<a ng-if=\'state === LINK_RESOLVE_STATE_FAILED\' class="title-text" href={{::url}}>{{::url}}</a>\n	<div class="clear"></div>\n</div>'),a.put("integrations/emoji/cnvEmoji.tpl.html",'<div class="cnv-emoji-popout-inner">\n	<div class="emojiSearchBar">\n            <div class="searchEmojiIcon" style="height:16px; width:16px"></div>\n            <input class="cnv-emoji-search-field" type="text" placeholder="Search" ng-model="emojiSearchText" ng-change="searchChanged()" />\n            <a ng-click="clearSearch()" ng-show="clearSearchButton"class="clear-search-button icons2_Close-lightgray"></a>\n    </div>\n	<!-- <div id = "current-category-label"></div> -->\n	<div class="cnv-emoji-container">\n		<!-- <h4>Emoji popup</h4> -->\n		<ul class="emoji-categories-list"></ul>\n	</div>\n	<div class="categories-icon-list-container">\n		<ul class="categorires-icon-list"></ul>\n	</div>\n</div>'),a.put("integrations/emoji/cnvEmojiPopover.tpl.html",'<cnv-emoji cnv-chat-window-id-for-emoji="{{mixpanelSource}}"></cnv-emoji>'),a.put("integrations/giphy/templates/cnv-giphy.tpl.html",'<div class="cnv-giphy-container">\n\n        <div class="chatSearchBar">\n                <div class="searchChatIcon"></div>\n                <input class="cnv-giphy-search-field" type="text" placeholder="Find the right GIF for any situation" ng-change="searchChanged()" ng-model="giphySearchText" ng-model-options="{ debounce: 500 }" spellcheck="false"/>\n        </div>\n        <div class="cnv-giphy-gallary">\n                <ul ng-if="!searchingGifs">\n                        <li ng-repeat=\'img in images\' style="display:inline">\n                                <img class="lazy" data-original="{{img.src}}" data-thumbnail="{{img.thumbnail}}" ng-if="images.length > 0"  bo-click="gifSelected(img)" />\n                        </li>\n\n                        <li class="not-found" ng-if="images.length === 0"></li>\n                </ul>\n                <div class="cnv-spinner light" style="display: none;position: absolute;top: 50%;left: 50%;margin: 0;margin-left: -12px;margin-top: -12px;"></div>\n        </div>\n        <div class="cnv-giphy-branding"></div>\n</div>\n'),a.put("integrations/giphy/templates/cnvGiphyPopover.tpl.html",'<div class="giphy-action-container" bindonce>\n    <div id="iShowGiphyPopup"\n        popover-template="\'integrations/giphy/templates/giphyDirective.tpl.html\'"\n        popover-placement="{{options.placement}}"\n        class="custom-giphy-popover"\n        ng-click="onPopoverClick()"\n        bo-class="[options.icon_class, cnvChatWindowId, cnvCustomClasses]">\n    </div>\n</div>\n'),a.put("integrations/giphy/templates/giphyDirective.tpl.html",'<cnv-giphy cnv-chat-window-id-for-giphy="cnvChatWindowId" cnv-file-context-of-parent-scope="cnvFileContext" cnv-giphy-rating="\'pg\'" cnv-giphy-search-text="cnvGiphyInformation.searchText" cnv-giphy-action-type="cnvGiphyInformation.actionType" cnv-update-parent-scope="getGiphySearchText(cnvGiphyInformation.searchText)" mixpanel-info="mixpanelInfo"></cnv-giphy>'),a.put("integrations/integrationsIntroDialog/templates/integrationsIntroDialog.tpl.html",'<div class="integrations-intro-dialog">\n	<div class="modal-header">\n	    <h4 ng-bind="dialogTitle"></h4>\n	    <button type="button" class="close" ng-click="closeDialog();">\xd7</button>\n\n	    <span class="navigation-links">\n	    	<span ng-click="browseIntegrations();">Browse</span><span class="dot">&nbsp;&nbsp;\u2022&nbsp;&nbsp;</span><span ng-click="manageIntegrations();">Manage</span>\n		</span>\n	</div>\n	<div class="modal-body">\n		<cnv-integrations-intro-screen></cnv-integrations-intro-screen>\n	</div>\n</div>'),a.put("integrations/integrationsIntroDialog/templates/integrationsIntroScreen.tpl.html","<div class='integrations-intro-screen-container' bindonce>\n	<div class='header-section'>\n		<span class='header-text' bo-bind='headerText'></span>\n		<span class='detail-text' bo-bind='detailText'></span>\n\n		<div class='form-group search-apps-bar-container'>\n			<div class='input-group'>\n				<input type='text' placeholder='Find a new app, or a service you already use' ng-model='searchInfo.searchText' ng-keyup='onSearch();' spellcheck=\"false\"/>\n				<div class='input-group-addon'>\n					<i class='glyphicon glyphicon-search' bo-if='!isSearching'></i>\n					<img class='search-loading' src=\"assets/img/feed/loading-spin.svg\" alt=\"Loading icon\" bo-if='isSearching'/>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<div class='detail-section'>\n		<div class='showcased-apps-label-cont'>\n			<span bo-html='showcasedIntegrationAppsLabel'></span>\n		</div>\n\n		<div bo-if='CURRENT_VIEW === SHOWCASED_INTEGRATION_APPS' class='showcased-apps'>\n			<div class='app' ng-repeat='showcaseApp in showcasedApps | limitTo:showAppLimit track by showcaseApp.title' >\n				<div class='app-details'>\n					<span class='app-icon icon-pulse' bo-click='onIntegrationAppBrowse(showcaseApp);'>\n						<img bo-src=\"showcaseApp.image | getIntegrationAppIcon\">\n					</span>\n					<span class='app-desc'>\n						<span class='app-title' bo-click='onIntegrationAppBrowse(showcaseApp);'>\n							<a href='javascript:void(0);' bo-bind='showcaseApp.title'></a>\n						</span>\n						<span class='app-detailed-text' bo-bind='showcaseApp.description'></span>\n					</span>\n				</div>\n			</div>\n		</div>\n\n		<div bo-if='CURRENT_VIEW === FILTERED_INTEGRATION_APPS' class='showcased-apps'>\n			<div class='app' ng-repeat='filteredApp in filteredApps | limitTo:showAppLimit track by filteredApp.title'>\n				<div class='app-details'>\n					<span class='app-icon icon-pulse' bo-click='onIntegrationAppBrowse(filteredApp);'>\n						<img bo-src=\"filteredApp.image | getIntegrationAppIcon\">\n					</span>\n					<span class='app-desc'>\n						<span class='app-title' bo-click='onIntegrationAppBrowse(filteredApp);'>\n							<a href='javascript:void(0);' bo-bind='filteredApp.title'></a>\n						</span>\n						<span class='app-detailed-text' bo-bind='filteredApp.description'></span>\n					</span>\n				</div>\n			</div>\n		</div>\n\n		<div bo-if='CURRENT_VIEW === DEFAULT_INTEGRATION_APPS' class='showcased-apps'>\n			<div class='app' ng-repeat='defaultApp in defaultApps | limitTo:showAppLimit track by defaultApp.title'>\n				<div class='app-details'>\n					<span class='app-icon icon-pulse' bo-click='onIntegrationAppBrowse(defaultApp);'>\n						<img bo-src=\"defaultApp.image | getIntegrationAppIcon\">\n					</span>\n					<span class='app-desc'>\n						<span class='app-title' bo-click='onIntegrationAppBrowse(defaultApp);'>\n							<a href='javascript:void(0);' bo-bind='defaultApp.title'></a>\n						</span>\n						<span class='app-detailed-text' bo-bind='defaultApp.description'></span>\n					</span>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<div class='footer-section'>\n		<button class=\"btn btn-block btn-default\" bo-click='onBrowseMoreIntegrationApps();' bo-bind='otherAppsNavText'></button>\n	</div>\n</div>"),a.put("invites/cnvSelectedUsersBox/cnvSelectedUsersBox.tpl.html",'<div class="selected-users-box-area">\n	<div class="addedUsers" suppress-scroll-propagation on-scrolled-bottom="onScrolledBottom(e)" trigger-before="30">\n	    <ul class="added-users-list">\n	        <li class="added-users-list-item" ng-class="{\'highlight\': tag.highlight}" ng-repeat="tag in cnvAddedUsers | limitTo:addedUsersDisplayLimit track by tag.id">\n	        	<cnv-user-profile-image ng-if="tag.type == \'USER\'" classes="tag.classes" user-id="tag.id" width="60"  height="60" full-name="tag.label"></cnv-user-profile-image>\n	        	<span style="width: 18px; height: 18px; vertical-align: middle;" ng-if="tag.type != \'USER\'" ng-class="tag.classes"></span>\n	    		<span class=\'selcted-text\'> {{tag.label}}</span>\n				<a ng-if="!userCanPost(tag)" ng-click="delete(tag.id)" class="remove-selected-user-button icons2_Close-darkgray"></a>\n				<span ng-if="cnvModalType != cnvModalType_post_creators && userCanPost(tag)" class="pull-right can-post-text">CAN POST</span>\n	        </li>\n	    </ul>\n	</div>\n</div>\n\n'),a.put("invites/templates/cnvBasicInviteModal.tpl.html",'<div class="invite-people" suppress-scroll-propagation>\n	<div class="modal-header">\n	    <h4 ng-bind="modalTitle"></h4>\n	    <button type="button" class="close" ng-click="dismiss()">\xd7</button>\n	</div>\n	<div class="modal-body">\n		<cnv-invites></cnv-invites>\n	</div>\n\n	<div class="modal-footer">\n\n		<a href="javascript:void(0);" class="import-widgets-reveal-action" ng-if="!isGuest && !invitesCtrl.widgets.isEnable && invitesCtrl.masterList.length" ng-click="invitesCtrl.widgets.enable()">Import</a>\n		<ng-include ng-if="!isGuest && invitesCtrl.masterList.length" src="\'invites/templates/cnvInvitesInlineWidgets.tpl.html\'"></ng-include>\n\n\n\n		<span ng-if="!shouldInviteGuestsAsFullMembers" style="float: left;margin: 8px 0px;">&nbsp;&nbsp;&nbsp;\u2022&nbsp;&nbsp;&nbsp;</span>\n\n		<a ng-if="isNative && !isGuest && !shouldInviteGuestsAsFullMembers" href="mailto:?subject={{::inviteEmailSubject}}&body={{::inviteEmailBody}}" target="_blank" rel="noopener noreferrer">Send email with invite link</a>\n        <a ng-if="!isNative && !isGuest && !shouldInviteGuestsAsFullMembers" href="mailto:?subject={{::inviteEmailSubject}}&body={{::inviteEmailBody}}">Send email with invite link</a>\n\n\n	    <button type="submit" class="btn btn-primary" ng-click="invite()" ng-disabled="!invitesCtrl.addedList.length">Invite</button>\n	</div>\n</div>\n'),a.put("invites/templates/cnvInvites.tpl.html",'<form class="invite-people-form" name="invitePeople" ng-submit="onSubmit()" role="form" >\n	<div class="inline-layout wide">\n		<div class="l-padding r-padding" ng-if="STATE != CREATE_GROUP_STEP4 && cnvModalType == cnvModalType_post_creators"><strong ng-bind="emailInputTitle"></strong></div>\n		<div class="l-padding r-padding">\n			<tags-input class="email-to-field"\n			            ng-model="inviteTo"\n			            placeholder="{{placeholderText}}"\n			            no-tags-indicator="false"\n			            add-on-comma="false"\n			            add-on-blur="false"\n			            add-from-autocomplete-only="true"\n			            display-property="label"\n			            replace-spaces-with-dashes="false"\n			            on-esc-key-press="onEscKeyPressInEmailField()"\n			            on-tag-added="onItemAddedInEmailField($tag)"\n			            on-tag-removed="onItemRemovedInEmailField($tag)"\n			            on-ctrl-cmd-enter="onCtrlOrCmdEnterPressInEmailField()"\n			            on-ctrl-cmd-save="onCtrlOrCmdSavePressInEmailField()"\n			            on-enter-press="onEnterPressInEmailField(text)">\n				<auto-complete\n			            source="getInviteToDropdownItems($query, numSelected)"\n			            load-history-on-focus="true"\n			            auto-select-first-suggestion="true"\n			            delimiter="@"\n			            min-length="1"\n			            suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n			    </auto-complete>\n			</tags-input>\n		</div>\n\n\n		<i class="cnv-spinner" ng-if="waiting"></i>\n\n\n		<div class="user-master-list-cont" ng-if="contacts.length" suppress-scroll-propagation>\n		\n			<div ng-if="noRecentContactFound" ng-click="dismissNoRecentContactFound()" class="no-contacts-found recent l-padding r-padding">\n				<div>\n					<strong>We didn\'t find new teammates in your contacts.</strong>\n					<span class="cross">\xd7</span>\n				</div>\n				<div>\n					<span class="meta">You still have some great options!<br>Add a teammate\'s email above.<br>Or import contacts from another source below.</span>\n				</div>\n			</div>\n\n			<div class="l-padding r-padding"><strong>Teammates</strong>\n				<a class="list-actions" href="javascript:void(0);" ng-click="selectAllItems()" ng-if="addedList && addedList.length != (contacts.length - separatorsCount.value)">\n					<span>Add all</span>&nbsp;<span ng-bind="contacts.length - separatorsCount.value"></span>\n				</a>\n				<a class="list-actions" href="javascript:void(0);" ng-click="deSelectAllItems()" ng-if="addedList && addedList.length == (contacts.length - separatorsCount.value)">\n					<span>Clear all</span>&nbsp;<span ng-bind="contacts.length - separatorsCount.value"></span>\n				</a>\n			</div>\n\n			<div class="user-master-list" on-scrolled-bottom="onScrolledBottom(e)" trigger-before="50">\n				<ul>\n					<li class="img-label-contact-list-item l-padding r-padding" ng-repeat="item in contacts | limitTo: contactsDisplayLimit track by item.id" ng-click="toggleItemSelection($event, item)" \n					ng-class="{ \'selected\': isSelected(item), \'separator\': item.separator, \'disable-mouse-events\': cnvModalType != cnvModalType_post_creators && userCanPost(item) }">\n						<div ng-if="!item.separator">\n							<span class="img">\n								<cnv-user-profile-image ng-if="item.type == \'USER\'" classes="item.classes" user-id="item.id" size="64" width="32" height="32" full-name="item.label"></cnv-user-profile-image>\n								<i ng-if="item.type != \'USER\'" ng-class="item.classes"></i>\n							</span>\n							<span class="c-label" ng-bind="item.label"></span>\n							<span ng-if="cnvModalType == cnvModalType_post_creators || !userCanPost(item)" class="actions" ng-class="{\'check-white\': isSelected(item), \'icons2_Add-blue\': !isSelected(item)}"></span>\n							<span ng-if="cnvModalType != cnvModalType_post_creators && userCanPost(item)" class="actions check-white bg-gray"></span>							\n						</div>\n						<div ng-if="item.separator" class="separator" ng-bind="item.text"></div>\n					</li>\n				</ul>\n			</div>\n		</div>\n\n\n		<div ng-if="noContactFound" class="no-contacts-found l-padding r-padding">\n			<div>\n				<strong>We didn\'t find new teammates in your contacts.</strong>\n			</div>\n			<div>\n				<span class="meta">You still have some great options!<br>Add a teammate\'s email above.<br>Or import contacts from another source below.</span>\n			</div>\n		</div>\n\n		<div class="body-invite-widgets l-padding r-padding" ng-if="!isGuest && !contacts.length && cnvModalType != cnvModalType_post_creators">\n			<div class="heading"><strong>Import your contacts</strong></div>\n			<ng-include src="\'invites/templates/cnvInvitesInlineWidgets.tpl.html\'"></ng-include>\n		</div>\n\n	</div><!--\n	Removing this comment will disturb the layout. its basically removing the bogus-space between two inline-block tags.\n	--><div class="inline-layout narrow" ng-class="{\'slide-out\': !addedList.length}">\n		<div class="added-teammates-cont">\n			<div><strong>Selected ({{addedList.length}})</strong></div>\n			<div class="added-teammates" ng-class="{\'highlight\': itemAddedIndicator}">\n				<cnv-selected-users-box> </cnv-selected-users-box>\n			</div>\n		</div>\n\n		<div class="message-box-cont">\n			<div><strong>Your message</strong></div>\n			<div class="message-box">\n				<textarea class="text-box" ng-model="inputObj.inviteMessage" suppress-scroll-propagation></textarea>\n			</div>\n		</div>\n	</div>\n</form>\n'),a.put("invites/templates/cnvInvitesInlineWidgets.tpl.html",'<div class="pull-left import-widgets-wrapper" ng-class="{\'widgets-empty-space\': !invitesCtrl.widgets.isEnable}">\n	<div class="widgets-cont" ng-class="{\'in-view\': invitesCtrl.widgets.isEnable}">\n		<span class="widget-cont" ng-click="invitesCtrl.find_googleContacts()">\n			<i class="img google-contacts"></i>\n			<div class="widget-name"><a href="javascript:void(0);">Google</a></div>\n		</span>\n\n		<span class="widget-cont" ng-click="invitesCtrl.find_macContacts()" ng-if="isMac">\n			<i class="img mac-contacts"></i>\n			<div class="widget-name"><a href="javascript:void(0);">Mac</a></div>\n		</span>\n\n		<span class="widget-cont" style=\'position:relative;cursor: pointer;\'>\n			<i class="img csv-contacts" style="cursor: pointer;"></i>\n			<div class="widget-name"><a href="javascript:void(0);">CSV File</a></div>\n			<input name=\'file\' class=\'file-input\' style="position: absolute;top: 0px;left: 0px;width: 40px;height: 42px;opacity: 0;cursor: pointer;" ng-model="fileinputmodel" type=\'file\'></input>\n		</span>\n		\n	</div>\n</div>\n'),a.put("main/components/cnvInAppNotificationsDropdown/cnvInAppNotificationsDropdown.tpl.html",'<div class="cnv-notif-container" bindonce>\n	<div class="bell-wrapper">\n		<span class="bell-hit-area" ng-click="showHideDropdown()">\n			<i class="cnv-icons-16 icons_Notifications-c2c2c2"></i>\n			<i class="cnv-icons-16 icons_Notifications-lightgray"></i>\n			<i class="cnv-icons-16 icons_Notifications-darkgray"></i>\n		</span>\n		<span class="badge ng-hide" ng-show="sharedNotificationsContext.unreadNotificationsCount > 0 && sharedNotificationsContext.unreadNotificationsCount <= 20" ng-bind="sharedNotificationsContext.unreadNotificationsCount" ng-click="showHideDropdown()"></span>\n		<span class="badge ng-hide" ng-show="sharedNotificationsContext.unreadNotificationsCount > 20" ng-click="showHideDropdown()">20+</span>\n	</div>\n	<div class="cnv-notif-dropdown" ng-if="showNotificationDropdown" cnv-mouse-wheel-scroll>\n		<div class="top">\n			<div class="top-arrow"></div>\n			<div class="pull-left">Notifications</div>\n			<div class="pull-right" bo-show="showMarkAllAsReadLink"><a href="javascript:void(0)" ng-click="markAllAsRead()">Mark all as read</a></div>\n		</div>\n		<div style="position: relative; overflow: hidden;">\n			<div class="docked-date-separator" bo-bind="notifications[0].template.timeSeparator"></div>\n			<div class="cnvScrollContainer scrollable" style="overflow-y: scroll;">\n				<div class="notifications-container" ng-repeat="notification in notifications track by notification.uniqueId" ng-class="{\'unread\': notification.original.isRead == 0}">\n					<div bo-if="$index > 0 && notification.template.timeSeparator != notifications[$index-1].template.timeSeparator" class="date-separator" bo-bind="notification.template.timeSeparator"></div>\n					<div class="notification">\n						<a bo-href="notification.template.link" ng-click="markAsRead(notification.original.notificationId)" class="open-in-compact-view">\n							<div class="pull-left dp-wrapper">\n								<cnv-user-profile-image width="48" height="48" user-id="notification.original.actionBy[0]" full-name="notification.template.latestActionByUser.name" profile-type="notification.template.latestActionByUser.profile_image_type" profile-version="notification.template.latestActionByUser.profile_image_version" profile=true></cnv-user-profile-image>\n							</div>\n							<div class="details-wrapper">\n								<div class="pull-right user-like-image-wrapper" bo-if="notification.template.pImageLikeData || notification.template.imageLikeData || notification.template.commentImageData">\n									<img bo-if="notification.template.pImageLikeData" bo-src="notification.original.forUser | userImgUrl:notification.template.pImageLikeData.type:notification.template.pImageLikeData.version" />\n									<img class="note-like-image" bo-if="notification.template.imageLikeData" bo-src="notification.template.imageLikeData.preview_name | getPreviewImageThumbnailPath:notification.template.imageLikeData.noteId"/>\n									<img class="note-like-image" bo-if="notification.template.commentImageData" bo-src="notification.template.commentImageData.preview_name | getCommentAttachmentThumbnailPathDefaultSize:notification.original.appInstanceId:notification.template.commentImageData.itemId:0"/>\n								</div>\n								<span class="heading" bo-html="notification.template.text"></span>\n								<span class="meta">\n									<i bo-class="notification.template.actionRelationship | inAppNotificationsActionIconClassFilter"></i>\n									<span bo-date="notification.original.timestamp | dateAgo:server_now_timestamp"></span>\n								</span>\n							</div>\n						</a>\n					</div>\n				</div>\n				<div class="spinner-container" bo-show="showSpinner">\n					<i class="cnv-circle-spinner-small"></i> Loading\n				</div>\n			</div>\n		</div>\n	</div>\n</div>'),a.put("main/components/premiumUpgradeBtn/cnvPremiumUpgradeBtn.tpl.html",'<div bindonce ng-if="cnvPremiumUpgradeBtn.loadDirective" class="cnv-premium-upgrade-btn">\n	<span class="onboarding-upgrade-to-premium-tooltip" ng-click="openToolTipOrGoToPremiumUpgrade();">\n		<img src="assets/img/pricing/crown@2x.png" alt="Close">\n		<span class="premium-upgrade-title" bo-bind="cnvPremiumUpgradeBtn.label"></span>\n	</span>\n</div>'),a.put("main/templates/header/mainHeaderPanel.tpl.html",'<div class="row no-margin header-bar-container" cnv-onboarding-main-header>\n  <div class="header-content-wrapper cnv-onboarding-overlay">\n    <!-- Network logo + network menu options dropdown -->\n    <div class="col-xs-2 col-sm-1 col-md-5 col-lg-5 no-padding">\n      <div class="network-logo-wrapper">\n        <cnv-network-logo-and-name>\n          <div class="network-logo-container" bindonce>\n            <a href="#/feed" ng-click="$emit(\'networkLogoClicked\', $event)">\n              <img class="logo" bo-src="networkLogo" />\n            </a>\n            <a href="#/feed" ng-click="$emit(\'networkLogoClicked\', $event)" bo-bind="accountInfo.getAccountName() | limitTo: 20" class="name"></a>\n          </div> \n        </cnv-network-logo-and-name>\n        <div ng-if="showUnreadAnouncementsIndicator" class="anouncements-indicator"></div>  \n        <cnv-dropdowns class="hidden-xs header-dropdown" cnv-dropdown-ctrl="dropdownCtrl" condition="isLoggedIntoAccountCondition">\n          <!-- WIREFRAME -->\n          <span class="dropdown cnv-custom-dropdown">\n            <a class="dropdown-toggle">\n              <i class="cnv-icons-20 icons_Dropdown_incircle-cccecf"></i>\n            </a>\n          </span>\n        </cnv-dropdowns>\n        <cnv-dropdowns class="slim-header-dropdown" cnv-dropdown-ctrl="dropdownCtrlSlim" condition="isLoggedIntoAccountCondition" ng-show="showSlimNetworkMenuDropdown()"></cnv-dropdowns>\n      </div>\n    </div>\n    <!-- search bar -->\n    <div class="col-xs-22 col-sm-23 col-md-19 col-lg-14 no-padding" style="position: static;">\n      <div class="top-search-wrapper">\n        <div id="feed_search_bar" cnv-feed-search-bar ng-class="{\'feed_search_bar_override_upgrade_premium_enterprise\':addEnterpriseClass,\'feed_search_bar_override_upgrade_premium_upgrade\':addUpgradeClass, \'admin-mode-search-width\': addAdminModeClass}">\n          <form ng-submit="onFeedSearchFormSubmit()">\n            <input id="feed_search_input" type="text" ng-model="feed_search_text"\n                    spellcheck="false"\n                    ng-change="onFeedSearchInputChange()"\n                    placeholder="Search"\n                    popover="{{searchQueryInvalid}}"\n                    popover-enable="searchQueryInvalid"\n                    popover-placement="bottom"\n                    popover-trigger="showTooltip"\n                    ng-trim="false"\n                    autocomplete="off" />\n            <div class="dropdown-ico-wrapper">\n              <i class="cnv-icons-15 icons2_Dropdown-lightgray" data-toggle="tooltip" data-placement="bottom" title="Show search options" ng-click="toggleAdvancedSearch()"></i>\n              <i class="cnv-icons-15 icons2_Dropdown-darkgray" data-toggle="tooltip" data-placement="bottom" title="Show search options" ng-click="toggleAdvancedSearch()"></i>\n            </div>\n            <div class="search-icon" ng-click="onFeedSearchFormSubmit()">\n              <i class="cnv-icons-15 find-lightgray"></i>\n              <i class="cnv-icons-15 find-darkgray"></i>\n            </div>\n          </form>\n          <div ng-if="state.show_feed_search_dropdown && showSearchSuggestionsHeader" class="search-suggestions-header">\n            <i class="icons_File_Plain-darkgray"></i>\n            <span>Search the contents of your file too.</span> <a href="{{::upgradeAppUrl}}">Upgrade to pro.</a>\n          </div>\n          <cnv-dropdown\n              ng-if="state.show_feed_search_dropdown"\n              items="feed_search_dropdown_items"\n              show="state.show_feed_search_dropdown"\n              watch-on-length-only="true"\n              item-select-callback="onFeedSearchDropdownItemSelected(item, withTabKey)"\n              nav-source-elem-id="feed_search_input"\n              item-template="common/listItemRenderers/imgLabelListItem.tpl.html"\n              dropdown-class="feed_search_dropdown">\n          </cnv-dropdown>\n          <div class="recent-search-header" ng-if="state.show_recent_search_dropdown">\n            <span>Recent Searches</span>\n            <span class="clear-btn" ng-mousedown="clearRecentSearches($event)">Clear</span>\n          </div>\n          <cnv-dropdown\n              ng-if="state.show_recent_search_dropdown"\n              items="recent_search_dropdown_items"\n              show="state.show_recent_search_dropdown"\n              item-select-callback="onFeedRecentSearchDropdownItemSelected(item, withTabKey)"\n              nav-source-elem-id="feed_search_input"\n              item-template="common/listItemRenderers/imgLabelListItem.tpl.html"\n              dropdown-class="feed_search_dropdown"\n              class="recent-search-dropdown">\n          </cnv-dropdown>\n\n          <div class="trending-tags-section" ng-if="state.showTrendingTag && state.trendingTagItems">\n            <div class="trending-tags-header">\n              <p class="header-text">TRENDING:</p>\n              <div class="trending-filter-container" ng-click="toggleTrendingFilter()">\n                <div class="trending-filter-text">{{state.trendingFilterOption == state.trendingFiltersList.today ? \'Today\' : \'This \' + state.trendingFilterOption}}</div>\n                <i class="cnv-icons-15 icons2_Dropdown-lightgray drop-down-icon"></i>\n                <i  class="cnv-icons-15 icons2_Dropdown-darkgray drop-down-icon"></i>\n                <ul class="trending-filter-lists" ng-if="state.showTrendingFilter">\n                  <li class="trending-filter-item" ng-click="changeTrendingFilterOption($event,state.trendingFiltersList.today)">Today</li>\n                  <li class="trending-filter-item" ng-click="changeTrendingFilterOption($event,state.trendingFiltersList.week)">This week</li>\n                  <li class="trending-filter-item" ng-click="changeTrendingFilterOption($event,state.trendingFiltersList.month)">This month</li>\n                </ul>\n              </div>\n            </div>\n            <div class="trending-tags-items-list-container">\n              <ul class="trending-tags-items-list">\n                <li class="trending-tags-item" \n                  ng-repeat="item in state.trendingTagItems" \n                  ng-click="onFeedSearchDropdownItemSelected(item)"\n                  ng-show="state.trendingTagItems.length">\n                  <i class="cnv-icons-20 icon_tag-01-01-darkgray tag-icon"></i>\n                  <div class="tag-info">\n                    <p class="tag-name">{{\'#\' + item.name}}</p>\n                    <br>\n                    <P class="tag-posts-number">{{item.tf + \' posts\'}}</P>\n                  </div>\n                </li>\n                <li class="trending-tags-item" ng-show="!state.trendingTagItems.length && !state.showTrendingSpinner">No trends to show</li>\n              </ul>\n            </div>\n            <div class="spinner-container" ng-if="state.showTrendingSpinner">\n              <i class="cnv-circle-spinner-small"></i>\n            </div>\n          </div>\n\n          <div class="onboardingToolTips bottom">\n              <div class=" blue-content"><i class="cnv-icons-10 icons2_Close-lightgray" ng-mousedown="closeRecentSearchTooltip($event);"></i>Narrow your search with these handy operators:\n                  <br><span class="tag-badge">has:</span> Search for attachments, e.g has:pdf\n                  <br><span class="tag-badge">tag:</span> Discover posts by tag, e.g tag:launch\n                  <br><span class="tag-badge">is:</span> View specific post types, e.g is:link\n                  <br>Or click <i class="cnv-icons-15 icons2_Dropdown-lightgray"></i> for advanced search options.</div>\n              <div class="paddingTop20 center"><a class="btn btn-primary width190" ng-mousedown="closeRecentSearchTooltip($event);">Got it</a></div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Right User Panel -->\n      <div class="right-column">\n        <cnv-premium-upgrade-btn></cnv-premium-upgrade-btn>\n        \n        <div class="admin-panel-exit-btn" ng-if="isAdminMode" ng-click="exitAdminMode();">Exit admin mode</div>\n        <!--\n        <span class="separator visible-lg-inline-block"></span>\n        <span class="separator hidden-lg" style="right: 86px;"></span>\n        -->\n        <cnv-in-app-notifications-dropdown class="dark-bell-icon">\n          <!-- WIREFRAME\n               Added so that the bell icon appears immediately (to improve app loading experience).\n               Will be replaced with actual template when the directive is compiled. -->\n          <div class="cnv-notif-container">\n            <div class="bell-wrapper">\n              <span class="bell-hit-area">\n                <i class="cnv-icons-16 icons_Notifications-lightgray"></i>\n              </span>\n            </div>\n          </div>\n        </cnv-in-app-notifications-dropdown>\n        <span class="separator"></span>\n        <div ng-click="toggleDropdown($event)" style="    position: relative; display: inline-block; padding-right: 10px; cursor: pointer; padding-top: 18px; margin-left: 16px;">\n          <cnv-user-profile-image width="\'24\'" height="\'24\'" img-url="user_info.getUserImageUrl_64x64" user-id="user_info.user_id" profile-type="user_info.profile_image_type" profile-version="user_info.profile_image_version" full-name="user_info.first_name + \' \' + user_info.last_name" class="profilePictureHeader" style="margin-right: 5px;">\n          </cnv-user-profile-image>\n          <cnv-dropdowns cnv-dropdown-ctrl="userMenuDropdownCtrl" class="user-menu-dropdown-widget">\n            <!-- WIREFRAME -->\n            <span class="dropdown cnv-custom-dropdown">\n              <a class="dropdown-toggle">\n                <i class="cnv-icons-16 icons_Dropdown_incircle-lightgray"></i>\n              </a>\n            </span>\n          </cnv-dropdowns>\n        </div>\n\n        <div class="menu-icon hidden-lg">\n          <i class="cnv-icons-25 icons_Menu-darkgray onboarding_menu" ng-click="toggleFloatingColumn()"></i>\n        </div>\n\n        <div class="floating-panel-wrapper hidden-lg" ng-if="showFloatingColumn">\n          <div class="wrapper">\n            <div ng-include="\'home/templates/rightPanels/feedRightPanel.tpl.html\'"></div>\n          </div>\n        </div>\n        \n        \n        <input id="headerDpUploadInput" type="file" name="headerDpUploadInput" style="width: 1px; height: 1px; display: block; position: absolute; z-index: 19999; top: -1000px; left: -1000px;" />\n      </div>\n    </div>\n\n    <!-- notifications + dp + options dropdown -->\n    <div class="visible-lg col-lg-5"></div>\n  </div>\n</div>'),
a.put("mfa/templates/cnvAddAuthenticatorApp.tpl.html",'<div class="mfa-title meta"><b>CONFIGURE BACKUP TWO-FACTOR AUTHENTICATION APP</b></div>\n<hr/>\n<p class="meta" style="max-width: 600px;">Once configured, you\'ll be able to enter a code created by an authenticator app, such as <a href="https://support.google.com/accounts/answer/1066447?hl=en" target="_blank" rel="noopener noreferrer">Google&nbsp;Authenticator</a>,&nbsp;<a href="https://duo.com/solutions/features/two-factor-authentication-methods/duo-mobile" target="_blank" rel="noopener noreferrer">Duo&nbsp;Mobile</a>,&nbsp;<a href="https://www.authy.com/" target="_blank" rel="noopener noreferrer">Authy</a>&nbsp;in order to sign in your Convo network.\n</p>\n<br>\n<div class="authenticator-bar-code-comp" ng-show="view_enabled">\n    <div class="meta">\n        Open the authenticator app on your phone or tablet and <b>scan the barcode</b> below.\n    </div>\n    \n    <div class="bar-code">\n        <img src="{{secretAndQRCode.qr_code}}"/>\n        <span class="bar-code-info">\n            <a href="javascript:void(0);" ng-click="showBarCodeDetails()">Can\'t scan this barcode?</a>\n            <div class="bar-code-meta meta" ng-if="bcDetailsEnabled">\n                <div>Use your authentication app\'s "Manual entry"<br>or equivalent option and provide the following<br>time-based key.(Lower-case works too.)</div>\n                <div class="auth-code" ng-bind="secretAndQRCode.secret"></div>\n                <div>Add the 6-digit verification code that your app.</div>\n            </div>\n        </span>\n    </div>\n    <br>\n    <div class="meta bar-code-submit">\n        <div>Now, <b>enter the 6 digit verification code</b> generated by the app below.\n        </div>\n        <div class="bar-code-input-comp">\n            <form ng-submit="submit()" ng-disabled="verification_code_processing">\n                <input id="qr-verification-input" ng-model="model.verification_code_input" placeholder="Verification code" autofocus/>\n                <button class="btn btn-primary">Verify code and enable</button>\n                <div ng-if="verification_code_error" ng-bind="verification_code_error" class="auth-error-message"></div>\n            </form>\n        </div>\n    </div>\n</div>\n<div ng-if="!view_enabled" class="cnv-spinner" style="width: 20px;height: 20px; margin-left: 200px;"></div>\n'),a.put("mfa/templates/cnvAddSmsAuth.tpl.html",'<div class="mfa-title meta"><b>ADD SMS AUTHENTICATION</b></div>\n<hr/>\n\n\n\n<div ng-if="CURRENT_STEP===STEPS.STEP_CONTACT" class="mfa-add-contact-input-comp">\n\n    <p class="meta">We\'ll send a time-sensitive authentication code to your mobile phone via text message when you\'re signing in.</p>\n\n    <div class="add-contact">\n        <form ng-submit="submitContact()" ng-disabled="contact_processing">\n\n            <span class="input-wrap">\n                <input id="phone-input" type="tel" autofocus/>\n            </span>\n\n            <button class="btn btn-primary">Add phone number</button>\n            <div ng-if="error" class="auth-error-message" ng-bind="error"></div>\n        </form>\n        <div class="add-contact-note">\n            <span class="meta-light">Standard SMS fees may apply.</span>\n        </div>\n    </div>\n</div>\n    \n\n<div ng-if="CURRENT_STEP===STEPS.STEP_CONTACT_VERIFICATION" class="mfa-verify-sms-comp">\n    <p class="meta">We\'ve sent a 6-digit verification to <b ng-bind="contact"></b></p>\n\n    <div class="bar-code-input-comp">\n        <form ng-submit="submit()" ng-disabled="verification_code_processing">\n            <input id="sms-verification-input" ng-model="model.sms_bar_code" placeholder="Verification code" autofocus/>\n            <button class="btn btn-primary">Verify code and enable</button>\n            <div class="auth-error-message" ng-if="verification_code_error" ng-bind="verification_code_error"></div>\n        </form>\n        \n    </div>\n\n    <div>\n        <span class="meta-light">Didn\'t receive your code?</span>&nbsp;\n        <a href="javascript:void(0);" ng-click="reSubmitContact()">Resend code</a><span class="meta">, or</span>&nbsp;\n        <a href="javascript:void(0);" ng-click="backToSubmitContact()">send to different phone number</a><span class="meta">.</span>\n    </div>\n</div>\n'),a.put("mfa/templates/cnvMultiFactorAuthManager.tpl.html",'<div class="mfa-panel-wrapper">\n\n    <cnv-multi-factor-auth-options \n        ng-if="currentlySelected === VIEWS.VIEW_TYPE_AVAILABLE_OPTIONS && (user_mfa_settings.user_is_fully_authenticated || !user_mfa_settings.mfa_enabled)">\n    </cnv-multi-factor-auth-options>\n\n    <cnv-add-sms-auth \n        ng-if="currentlySelected === VIEWS.VIEW_TYPE_AUTH_WITH_PHONE">\n    </cnv-add-sms-auth>\n\n\n    <cnv-add-authenticator-app \n        ng-if="currentlySelected === VIEWS.VIEW_TYPE_AUTH_WITH_AUTHENTICATOR_APP">\n    </cnv-add-authenticator-app>\n\n    <cnv-multi-factor-auth-success \n        ng-if="currentlySelected === VIEWS.VIEW_TYPE_AUTH_SUCCESS">\n    </cnv-multi-factor-auth-success>\n\n    <a ng-if="currentlySelected !== VIEWS.VIEW_TYPE_AUTH_SUCCESS" href="javascript:void(0);" onclick="window.history.back()" style="margin-top: 10px; display: block;">back</a>\n\n</div>\n\n\n'),a.put("mfa/templates/cnvMultiFactorAuthOptions.tpl.html",'<div class="mfa-title meta"><b>HOW WOULD YOU LIKE TO RECEIVE YOUR AUTHENTICATION CODES?</b></div>\n<hr/>\n<p class="meta">You will be asked for an authentication code when you sign in to your account.</p>\n\n<div>\n    <ng-include src="\'mfa/templates/cnvMultiFactor_SMSComp.tpl.html\'"></ng-include>\n    <ng-include src="\'mfa/templates/cnvMultiFactor_AuthenticatorAppComp.tpl.html\'"></ng-include>\n</div>'),a.put("mfa/templates/cnvMultiFactorAuthSuccess.tpl.html",'<div class="mfa-title meta"><b>SUCCESS!</b></div>\n\n<div>\n    <hr/>\n    <p ng-if="!auth_path_complete_statue.SMS || !auth_path_complete_statue.AUTH_APP" class="meta">We strongly recommend that you set up an additional back up option.</p>\n\n    <div class="mfa-success-wrap">\n        <ng-include ng-if="!auth_path_complete_statue.SMS" src="\'mfa/templates/cnvMultiFactor_SMSComp.tpl.html\'"></ng-include>\n        <ng-include ng-if="!auth_path_complete_statue.AUTH_APP" src="\'mfa/templates/cnvMultiFactor_AuthenticatorAppComp.tpl.html\'"></ng-include>\n\n        <div>\n            <a href="javascript:void(0);" ng-click="skip()">Skip</a>\n        </div>\n    </div>\n\n</div>\n'),a.put("mfa/templates/cnvMultiFactor_AuthenticatorAppComp.tpl.html",'<div class="mfa-option">\n    <button class="btn btn-primary" ng-click="authUsingAuthenticatorApp()">Use an authenticator app</button>\n    &nbsp;&nbsp;&nbsp;&nbsp;\n    <span class="meta-light">Retrieve codes from an authenticator app on your device.</span>\n</div>\n'),a.put("mfa/templates/cnvMultiFactor_SMSComp.tpl.html",'<div class="mfa-option">\n    <button class="btn btn-primary" ng-click="authUsingSMSTextMessage()">SMS text message</button>\n    &nbsp;&nbsp;&nbsp;&nbsp;\n    <span class="meta-light">Receive a text message to your mobile device when signing in.</span>\n</div>\n'),a.put("onboarding/cnvOnboardingDownloadAppsAdvert/cnvOnboardingDownloadAppsAdvert.tpl.html",'<div class="cnv-onboarding-download-apps-advert">\n	<div class="cross" ng-click="dismissAdvert();logDismissInMixpanel()"><i class="cnv-icons-10 icons2_Close-white"></i></div>\n	<div class="container-fluid">\n		<div class="row">\n			<div class="col-xs-24">\n				<div class="wrapper">\n					<div class="left">\n						<h3>Get the app</h3>\n						<span>Install the desktop app to get the most out of Convo.</span>\n						<span ng-if="platform == \'mac\'">Get instant notifications, \n						share faster with Quick Posts, and stay connected.</span>\n						<span ng-if="platform == \'win\'">Keep an eye on what\'s happening and get notifications on your desktop.</span>\n\n						<a class="dummy-click" target="{{:: platform == \'mac\' ? \'_blank\' : \'\'}}" href="{{::config.HTML_APP_DOWNLOAD_URL}}" ng-click="dismissAdvertWithDelay();markDownloadApp();logDownloadInMixpanel();">\n							<div class="download-desktop"></div>\n						</a>\n						<span class="dark" ng-click="dismissAdvert();logDismissInMixpanel();">Or continue in your browser instead</span>\n					</div>\n					<div class="right">\n						<a class="dummy-click" target="{{:: platform == \'mac\' ? \'_blank\' : \'\'}}" href="{{::config.HTML_APP_DOWNLOAD_URL}}" ng-click="dismissAdvertWithDelay();markDownloadApp();logDownloadInMixpanel();">\n							<div class="mac">\n							</div>\n						</a>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'),a.put("onboarding/cnvOnboardingHomeRight/cnvOnboardingChecklist.tpl.html",'<div class="cnv-onboarding-checklist-container cnv-onboarding-overlay" bindonce>\n    <!-- <button bo-if="!userInfo.isGuestUser()" class="btn btn-primary btn-block" \n    ng-click="openInviteTeammatesModal()">Invite your teammates</button> -->\n    <button class="btn btn-primary btn-block" bo-if="!userInfo.isGuestUser()" ng-click="inviteContacts()">Invite your teammates</button>\n\n    <div class="separator" bo-if="!userInfo.isGuestUser() && !shouldInviteGuestsAsFullMembers">or</div>\n    \n    <div class="vanity-help-txt" style="margin: -5px 0 10px 0;" bo-if="!userInfo.isGuestUser() && !shouldInviteGuestsAsFullMembers">\n        <span>Get your company\'s exclusive invite link. Your teammates can use this link to sign up to Convo.</span>\n    </div>\n    <button class="btn btn-default btn-block" bo-if="!userInfo.isGuestUser() && !shouldInviteGuestsAsFullMembers" ng-click="onShareableLinkClick()" style="margin-bottom: 10px;">Invite via email or chat</button>\n    \n    <a href="{{::config.APP_DOMAIN + \'/app/signup\'}}" bo-if="userInfo.isGuestUser()" class="link-btn" target="_blank" rel="noopener noreferrer">\n        <button class="btn btn-primary btn-block">Create your own network</button>\n    </a>\n\n    <div class="checklist-wrapper">\n        <!-- headings -->\n        <span class="heading">Explore Convo</span>\n        <span class="heading-sub">Follow these tips to get started.</span>\n        <!-- progress bar -->\n        <div class="cnv-progress-bar">\n            <div class="green" ng-style="{\'width\': checklistProgress + \'%\'}"></div>\n            <span class="count" ng-if="checklistProgress !== 100">{{checklistProgress + \'%\'}}</span>\n        </div>\n        <hr />\n        <!-- onboarding checklist -->\n        <ul class="onboarding-checklist" bo-if="userInfo.isGuestUser()">\n            <li>\n            	<a href="javascript:void(0)" ng-click="$emit(\'cnvOnboarding:startFeedOnboarding\'); $emit(\'showHideHeaderFloatingColumn\', false)" ng-class="{\'strike-through\': checklist.learn_my_feed_done == 1}"><i class="glyphicon glyphicon-ok" ng-if="checklist.learn_my_feed_done == 1"></i>1. Learn about feed</a>\n        	</li>\n            <li class="onboarding-share-post-tooltip">\n            	<a href="javascript:void(0)" ng-click="$emit(\'cnvOnboarding:startSharePostOnboarding\')" ng-class="{\'strike-through\': checklist.share_a_post_done == 1}"><i class="glyphicon glyphicon-ok" ng-if="checklist.share_a_post_done == 1"></i>2. Share a post</a>\n        	</li>\n            <li class="onboarding-download-apps-tooltip" ng-class="{\'strike-through\': checklist.downloaded_apps == 1}">\n            	<a href="javascript:void(0)" ng-click="$emit(\'cnvOnboarding:startDownloadAppsOnboarding\')"><i class="glyphicon glyphicon-ok" ng-if="checklist.downloaded_apps == 1"></i>3. Download apps</a>\n        	</li>\n        </ul>\n        <ul class="onboarding-checklist" bo-if="!userInfo.isGuestUser()">\n            <li>\n                <a href="javascript:void(0)" ng-click="$emit(\'cnvOnboarding:startFeedOnboarding\'); $emit(\'showHideHeaderFloatingColumn\', false)" ng-class="{\'strike-through\': checklist.learn_my_feed_done == 1}">\n                    <i class="glyphicon glyphicon-ok" ng-if="checklist.learn_my_feed_done == 1"></i>1. Learn about feed\n                </a>\n            </li>\n            <li ng-if="showCreateAGroupInChecklist" class="onboarding-create-group-tooltip-1">\n            	<a href="javascript:void(0)" ng-click="$emit(\'cnvOnboarding:startCreateGroupOnboarding\')" ng-class="{\'strike-through\': checklist.create_a_group_done == 1}"><i class="glyphicon glyphicon-ok" ng-if="checklist.create_a_group_done == 1"></i>2. Create a group</a>\n        	</li>\n            <li class="onboarding-share-post-tooltip">\n            	<a href="javascript:void(0)" ng-click="$emit(\'cnvOnboarding:startSharePostOnboarding\')" ng-class="{\'strike-through\': checklist.share_a_post_done == 1}">\n            		<i class="glyphicon glyphicon-ok" ng-if="checklist.share_a_post_done == 1"></i>{{showCreateAGroupInChecklist ? 3 : 2}}. Share a post</a>\n        	</li>\n            <li class="onboarding-integrations-tooltip">\n                <a href="javascript:void(0)" ng-click="$emit(\'cnvOnboarding:startIntegrationsOnboarding\')" ng-class="{\'strike-through\': checklist.connect_to_other_tools_done == 1}"><i class="glyphicon glyphicon-ok" ng-if="checklist.connect_to_other_tools_done == 1"></i>{{showCreateAGroupInChecklist ? 4 : 3}}. Connect to other tools</a>\n            </li>\n            <li class="onboarding-download-apps-tooltip">\n            	<a href="javascript:void(0)" ng-click="$emit(\'cnvOnboarding:startDownloadAppsOnboarding\')" ng-class="{\'strike-through\': checklist.downloaded_apps == 1}">\n            		<i class="glyphicon glyphicon-ok" ng-if="checklist.downloaded_apps == 1"></i>{{showCreateAGroupInChecklist ? 5 : 4}}. Download apps</a>\n        	</li>\n        </ul>\n    </div>\n</div>\n'),a.put("onboarding/cnvOnboardingPilotIntro/cnvOnboardingPilotIntro.tpl.html",'<div class="cnv-pilot-intro-wrapper">\n	<div class="pilot-logo">\n		<i class="cnv-icons-100 Convo_pilot-01"></i>\n\n	</div>\n	<div class="welcome-text">\n		<span>Welcome to Convo!</span>\n		<span>I have a few helpful tips to get you started.</span>\n	</div>\n	<div class="bottom-text">\n		<span>Starting in {{::countdownTimerStart}} seconds...</span>\n		<span><a href="javascript:void(0)" ng-click="completeIntroStep(true)">Skip</a> if you have already used Convo before.</span>\n	</div>\n</div>'),a.put("onboarding/templates/cnvDemoPost.tpl.html",'<div class="demoPost" bindonce>\n    <div class="demopost-overlay">\n        <!-- <div class="overlay"></div> -->\n\n        <!-- <div class="box-help" ng-show="showTooltip">\n        	<div class="right-aero"></div>\n        	By default, all your teammates will follow you.<br />\n        	Teammates can customize who they follow in the team directory.\n        </div> -->\n        <div class="box">\n        	<div class="heading">Share this example post with your team <button type="button" class="close pull-right" ng-click="close()">\xd7</button></div>\n            <div class="subHeading">Just for fun, we\'ve attached a random GIF</div>\n        	<!-- <span class="grey">To</span> <span class="sharingOptions" ng-mouseover=\'enableTooltip()\' ng-mouseleave="disableTooltip()">My Followers</span> -->\n\n        	<div class="content" >\n             \n                <div class="left">\n                    <cnv-user-profile-image user-id="user.user_id" width="40" height="40"\n                                    profileType="user.profile_image_type"\n                                    profileVersion="user.profile_image_version"></cnv-user-profile-image>\n                </div>\n                <div class="right">\n                    <div>\n                        <a>{{::user.name}}</a>\n                    </div>\n                    <!-- <div ng-bind-html="postBody"></div>   -->\n                    <cnv-comment-editor></cnv-comment-editor>\n                    <div class="gifHolder">\n                        <!-- <button class="btn btn-primary btn-gif-selector" ng-hide="showGifContainer" ng-click="whichGifBtnClicked()">Which gif will you get?</button> -->\n                        <!-- <div ng-show="showGifContainer" class="showGifContainer"> -->\n                        <div class="showGifContainer">\n                            <div class="gifsContainer">\n                                <div class="gifsReal">\n                                    <div data-ng-repeat="gif in gifs" style="float: left"><div class="gifHolder" id="gifHolder{{::gif.id}}"><img  ng-src="{{::gif.url}}" id="{{::gif.id}}" bo-if="gif.bareId == selectedGif || gif.bareId == selectedGif+1"/></div>\n                                    <div class="gifHolder fakeGifHolder_blue"></div>\n                                    <div class="gifHolder fakeGifHolder_pink"></div>\n                                    <div class="gifHolder fakeGifHolder_orange"></div>\n                                    <div class="gifHolder fakeGifHolder_green"></div>\n                                    <div class="gifHolder fakeGifHolder_yellow"></div>\n                                    <div class="clear"></div>\n                                    </div>\n                                    <div class="clear"></div>\n                                </div>\n                            </div>\n                            <div class="textContainer" >\n                                <div style="display: table-cell; vertical-align: middle;">\n                                    <div ng-show="selectingGif" class="generating">Generating...</div>\n                                    <div ng-show="!selectingGif" class="dontlike">\n                                    <!-- <div ng-show="defaultSelectedGif">We\'ve chosen a random GIF for your welcome post.</div> -->\n                                    Don\'t like this?<br />\n                                    <a ng-click="selectRandomGif()" class="tryagain">Try another!</a>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="clear"></div>\n                        </div>\n                    </div>  \n                </div>\n\n                <div class="clear"></div>\n                   \n            </div>\n\n        	<button class="btn pull-right btn-primary btn-share width190" ng-class="{\'disabled\':allowSharing==false}" ng-click="share()">{{shareBtnText}}</button>\n        </div>\n\n    </div>\n    <div class="ng-hide" >\n        <input name=\'file\' id="onboarding_sharing" type=\'file\'></input>\n    </div>\n</div>'),a.put("onboarding/templates/cnvHomeOnboarding.tpl.html",'<div class="home-onboarding">\n	<div class="home-dim-overlay">\n		<div class="primary-message">\n			<div class="title">Welcome to Convo! <br /> A few tips to get you started.</div>\n			<div class="action"><button class="btn btn-primary width225" ng-click="continue()">Ok! What\'s next?</button></div>\n		</div>\n	</div>\n</div>\n'),a.put("onboarding/templates/cnvOnBoardingManager.tpl.html",'<div>\n	<div id="cnvOnBoardingClonedDocument"></div>\n	<div id="cnvOnBoardingManager"></div>\n	<img ng-src="{{firstGifURL}}" class="ng-hide" />\n</div>'),a.put("onboarding/templates/cnvOnboardingAddCommentTooltip.tpl.html",'<div class="cnv-onboarding-add-comment-tooltip">\n	<span>Type something here</span>\n	<div class="right-arrow"></div>\n</div>'),a.put("onboarding/templates/cnvOnboardingAnnotationAddCommentTooltip.tpl.html",'<div class="cnv-onboarding-add-comment-tooltip annotation">\n	<span>Type "got it" to finish your reply</span>\n	<div class="right-arrow"></div>\n</div>'),a.put("onboarding/templates/cnvOnboardingDismissBanner.tpl.html",'<div class="onboarding-dismiss-banner">\n	Want to take the tour later? <a href="javascript:void(0)" ng-click="onDismissOnboardingClick()">Click here</a> to return to your feed.\n</div>'),a.put("onboarding/templates/cnvOnboardingInviteContactsTooltip.tpl.html",'<div class="onboardingToolTips invite-contacts-tooltip bottom animate-bottom-up" style="position: absolute;top: 50px;right: 90px;">\n    <div class="blue-content">\n        <b>Teammates not here yet?</b>\n    </div>\n    \n    <div class="meta">\n        <i class="cnv-icons-16 icons2_Like-lightgray"></i>\n        <span>Add an @asklfjslfjs email address to get started.</span>\n    </div>\n\n    <br>\n    \n    <div class="blue-content">\n        <b>What else can i do with the "To" box?</b>\n    </div>\n\n    <div>\n        <div><i class="cnv-icons-12 Icon1_checkplain-darkgray v-align-m"></i>&nbsp;&nbsp;<b>Followers</b>&nbsp;<span>- Everyone in your company sees your post.</span></div>\n        <div><i class="cnv-icons-12 Icon1_checkplain-darkgray v-align-m"></i>&nbsp;&nbsp;<b>Group</b>&nbsp;<span>- Group members see your post.</span></div>\n        <div><i class="cnv-icons-12 Icon1_checkplain-darkgray v-align-m"></i>&nbsp;&nbsp;<b>Teammate</b>&nbsp;<span>- Your post is shared privately wiht one person.</span></div>\n    </div>\n\n    <div class="paddingTop20 center">\n        <span class="btn btn-primary width190" ng-click="dismissInviteContactsTooltip()">Got it!</span>\n    </div>\n</div>\n'),a.put("onboarding/templates/cnvOnboardingPermissionsTooltip.tpl.html",'<div class="onboardingToolTips post-permissions-tooltip left-top animate-left-right" style="position: absolute;top: -26px;right: 32px;">\n    <div class="blue-content">\n        <b>Introducing Post Permissions!</b>\n        <br>\n        Set up permissions for your posts to restrict\n        <br>\n        people from editing or commenting.\n    </div>\n\n    <div class="paddingTop20 center">\n        <span class="btn btn-primary width190" ng-click="dismissPermissionsTooltip()">Got it!</span>\n    </div>\n</div>\n'),a.put("onboarding/templates/cnvOnboardingTooltips.tpl.html",'<div>\n	<input type="file" id="profileImageUpload_onboarding" name="profileImageUpload" style="width: 1px; height: 1px; display: block; position: absolute; z-index: 19999; top: -1000px; left: -1000px;" />\n	\n</div>'),a.put("onboarding/templates/cnvUpdateAppTooltip.tpl.html",'<div class="cnv-get-update-tooltip">\n	<i class="cnv-icons-20 whatsNewIcon-orange whatsNewIcon-orange-style" style="top: -5px;"></i>\n	<div style="display: inline-block;margin-left: 4px;">An update is available.<br><a href="javascript:void(0);" ng-click="reloadAppForUpdate()">Reload</a> to get it now.</div>\n	<div class="cross"  ng-click="closeGetUpdateTooltip()">\u2715</div>\n</div>'),a.put("onboarding/templates/cnvWhatsNewTooltip.tpl.html",'<div class="cnv-whats-new-tooltip" ng-click="showWhatsNewDialog()">\n	<span>See what\'s new</span>\n	<div class="top-arrow"></div>\n</div>'),a.put("search/cnvAdvancedSearch/cnvAdvancedSearch.tpl.html",'<div class="row cnv-advanced-search" bindonce>\n	<!-- to float over feed the div below will be fixed -->\n	<div class="bar-wrapper-fixed">\n		<div class="bar-wrapper">\n			<i class="cnv-icons-10 icons2_Close-lightgray bar-close-ico" ng-click="toggleBar()"></i>\n			<div class="col-xs-4 col-xs-offset-2 from" ng-click="openFilterDropdown($event, \'from\')">\n				<span ng-bind="\'From: \' + getFullName(filters.from[0].value)" class="col-heading"></span>\n				<i class="cnv-icons-15 icons2_Dropdown-lightgray normal"></i>\n				<i class="cnv-icons-15 icons2_Dropdown-darkgray hover"></i>\n				<div class="from-filter-dropdown filter-dropdown" bo-show="activeFilterDropdown === \'from\'">\n					<i class="cnv-icons-10 icons2_Close-lightgray" ng-click="closeFilterDropdown($event)"></i>\n					<div>Include:</div>\n					<div class="to-field-cont" ng-class="{\'hide-placeholder\': fromUsers.length > 0}">\n			            <tags-input ng-model="fromUsers"\n			                        add-on-comma="false"\n			                        add-on-blur="true"\n			                        horizontal-flow = "false"\n			                        placeholder = "Search for people"\n			                        on-tag-added="onItemAddedInFromField($tag)"\n			                        on-tag-removed="onItemRemovedFromField($tag)"\n			                        add-from-autocomplete-only="true"\n			                        display-property="label"\n			                        allowed-tags-pattern="^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$"\n			                        replace-spaces-with-dashes="false">\n			                <auto-complete\n			                        source="getAutoCompleteUserItemsForFrom($query, numSelected)"\n			                        load-history-on-focus="true"\n			                        delimiter="@"\n			                        min-length="1"\n			                        auto-select-first-suggestion="true"\n			                        suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n			                </auto-complete>\n			            </tags-input>\n			        </div>\n				</div>\n			</div>\n			<div class="col-xs-4 to" ng-click="openFilterDropdown($event, \'to\')">\n				<span ng-bind="\'To: \' + getFullName(filters.to[0].value)" ng-blur="openFilterDropdown(null, null);" class="col-heading"></span>\n				<i class="cnv-icons-15 icons2_Dropdown-lightgray normal"></i>\n				<i class="cnv-icons-15 icons2_Dropdown-darkgray hover"></i>\n				<div class="to-filter-dropdown filter-dropdown" bo-show="activeFilterDropdown === \'to\'">\n					<i class="cnv-icons-10 icons2_Close-lightgray" ng-click="closeFilterDropdown($event)"></i>\n					<div>Include:</div>\n					<div class="to-field-cont" ng-class="{\'hide-placeholder\': t.length > 0}">\n			            <tags-input ng-model="toUsers"\n			                        add-on-comma="false"\n			                        add-on-blur="true"\n			                        horizontal-flow = "false"\n			                        placeholder = "Search for people & groups"\n			                        on-tag-added="onItemAddedInToField($tag)"\n			                        on-tag-removed="onItemRemovedToField($tag)"\n			                        add-from-autocomplete-only="true"\n			                        display-property="label"\n			                        allowed-tags-pattern="^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$"\n			                        replace-spaces-with-dashes="false">\n			                <auto-complete\n			                        source="getAutoCompleteUserItemsForTo($query, numSelected)"\n			                        load-history-on-focus="true"\n			                        delimiter="@"\n			                        min-length="1"\n			                        auto-select-first-suggestion="true"\n			                        suggestion-item-template="common/listItemRenderers/imgLabelListItem.tpl.html">\n			                </auto-complete>\n			            </tags-input>\n			        </div>\n				</div>\n			</div>\n			<div class="col-xs-4 posts" ng-click="openFilterDropdown($event, \'posts_type\')">\n				<span bo-bind="getPostFilterTitle()" class="col-heading"></span>\n				<i class="cnv-icons-15 icons2_Dropdown-lightgray normal"></i>\n				<i class="cnv-icons-15 icons2_Dropdown-darkgray hover"></i>\n				<div class="post-filter-dropdown filter-dropdown" bo-show="activeFilterDropdown === \'posts_type\'">\n					<i class="cnv-icons-10 icons2_Close-lightgray" ng-click="closeFilterDropdown($event)"></i>\n					<ul>\n						<li ng-click="applyPostFilter($event, \'all_posts\')"><i class="cnv-icons-check-blue" bo-if="filters.has.length === 0 && filters.is.length === 0 && filters.discussions.length === 0"></i>All posts</li>\n						<li ng-click="applyPostFilter($event, \'link\')"><i class="cnv-icons-check-blue" bo-if="filters.is[0].description === \'link\'"></i>Links</li>\n						<li ng-click="applyPostFilter($event, \'comments\')"><i class="cnv-icons-check-blue" bo-if="filters.discussions.length > 0"></i>Comments</li>\n						<li ng-click="applyPostFilter($event, \'chat\')" bo-if="isChatEnabled"><i class="cnv-icons-check-blue" bo-if="filters.is[0].description === \'chat\'"></i>Chats</li>\n						<hr />\n						<li ng-click="applyPostFilter($event, \'Files\')"><i class="cnv-icons-check-blue" bo-if="filters.has[0].description === \'Files\'"></i>Has attachments</li>\n						<li ng-click="applyPostFilter($event, \'Images\')"><i class="cnv-icons-check-blue" bo-if="filters.has[0].description === \'Images\'"></i>Images</li>\n						<li ng-click="applyPostFilter($event, \'Videos\')"><i class="cnv-icons-check-blue" bo-if="filters.has[0].description === \'Videos\'"></i>Videos</li>\n						<li ng-click="applyPostFilter($event, \'Audio\')"><i class="cnv-icons-check-blue" bo-if="filters.has[0].description === \'Audio\'"></i>Audio</li>\n						<li ng-click="applyPostFilter($event, \'pdf\')"><i class="cnv-icons-check-blue" bo-if="filters.has[0].description === \'pdf\'"></i>PDFs</li>\n						<li ng-click="applyPostFilter($event, \'docx,doc\')"><i class="cnv-icons-check-blue" bo-if="filters.has[0].description === \'docx,doc\'"></i>Documents</li>\n						<li ng-click="applyPostFilter($event, \'pptx,ppt\')"><i class="cnv-icons-check-blue" bo-if="filters.has[0].description === \'pptx,ppt\'"></i>Presentations</li>\n						<li ng-click="applyPostFilter($event, \'xlsx,xls\')"><i class="cnv-icons-check-blue" bo-if="filters.has[0].description === \'xlsx,xls\'"></i>Spreadsheets</li>\n					</ul>\n				</div>\n			</div>\n			<div class="col-xs-4 date" datepicker-popup="{{dateOptions.formats[0]}}" ng-model="dateOptions.model" is-open="opened" datepicker-options="dateOptions" show-button-bar="false" show-weeks="false" close-text="Close" datepicker-popup-template-url="search/cnvAdvancedSearch/datepickerPopup.tpl.html" ng-click="open($event);">\n				<span bo-bind="dateOptions.model ? (\'On or Before: \' + (dateOptions.model | date : \'MM/dd/yyyy\' | limitTo: 30)) : \'Any Time\'" class="col-heading"></span>\n				<i class="cnv-icons-15 icons2_Dropdown-lightgray normal"></i>\n				<i class="cnv-icons-15 icons2_Dropdown-darkgray hover"></i>\n			</div>\n			<div class="col-xs-4 more-options" ng-click="openFilterDropdown($event, \'more_options\')" bo-if="isChatEnabled">\n				<span class="col-heading">More options</span>\n				<i class="cnv-icons-15 icons2_Dropdown-lightgray normal"></i>\n				<i class="cnv-icons-15 icons2_Dropdown-darkgray hover"></i>\n				<div class="more-options-dropdown filter-dropdown" bo-show="activeFilterDropdown === \'more_options\'">\n					<i class="cnv-icons-10 icons2_Close-lightgray" ng-click="closeFilterDropdown($event)"></i>\n					<ul>\n						<li id="includeChatsCbox" bo-click="applyMoreOptions($event, \'includeChats\', false)" ng-class="{\'bold\': moreOptions.includeChats}">\n							<input type="checkbox" class="cnv-checkbox" id="moreChats" ng-model="moreOptions.includeChats" />\n							<label id="includeChatsCbox" for="moreChats"></label>Include chats</li>\n						<!-- <li ng-click="applyMoreOptions($event, \'includeDrafts\')" bo-class="{\'bold\': moreOptions.includeDrafts}"><input type="checkbox" ng-model="moreOptions.includeDrafts" />Posts in Drafts</li> -->\n					</ul>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>'),a.put("search/cnvAdvancedSearch/datepickerPopup.tpl.html",'<ul class="dropdown-menu custom" ng-if="isOpen" style="display: block" ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" ng-keydown="keydown($event)" ng-click="$event.stopPropagation()">\n	<i class="cnv-icons-10 icons2_Close-lightgray" ng-click="close()"></i>\n	<li ng-transclude></li>\n	<li ng-if="showButtonBar" style="padding:10px 9px 2px">\n		<span class="btn-group pull-left">\n		<button type="button" class="btn btn-sm btn-info" ng-click="select(\'today\')">{{ getText(\'current\') }}</button>\n		<button type="button" class="btn btn-sm btn-danger" ng-click="select(null)">{{ getText(\'clear\') }}</button>\n		</span>\n		<button type="button" class="btn btn-sm btn-success pull-right" ng-click="close()">{{ getText(\'close\') }}</button>\n	</li>\n</ul>'),a.put("search/cnvFeedSearchBar/cnvFeedSearchBar.tpl.html",""),a.put("search/cnvFeedToggleBar/cnvFeedToggleSearch.tpl.html",'<div class="row cnv-feed-toggle-search" bindonce ng-if="false">\n	<div class="col-heading" ng-click="openFilterDropdown($event, \'posts_type\')">\n		<span bo-bind="getPostFilterTitle()"></span>\n		<i class="cnv-icons-15 icons2_Dropdown-lightgray normal"></i>\n		<i class="cnv-icons-15 icons2_Dropdown-darkgray hover"></i>\n		<div class="post-filter-dropdown filter-dropdown" bo-show="activeFilterDropdown === \'posts_type\'">\n			<ul>\n				<li ng-click="applyPostFilter($event, \'latestPost\',\'Latest post\')" bo-show="showPostDisplayOptionText()">Latest post</li>\n				<li ng-click="applyPostFilter($event, \'latestActivity\', \'Latest activity\')" bo-show="!showPostDisplayOptionText()">Latest activity</li>\n			</ul>\n		</div>\n	</div>\n	<hr/>\n</div>'),
a.put("search/textSearch/cnvTextSearchControl/cnvTextSearchControl.tpl.html",'<div class="text-search-control-cont">\n  <div class="input-field-cont">\n    <input type="search" placeholder="Find" ng-disabled="disabled">\n    <span ng-show="currentMatchDisplayText" ng-bind="currentMatchDisplayText" class="current-match-display"></span>\n  </div>\n  <div data-search="next" class="search-btn search-next-btn" ng-disabled="disabled || numMatches === 0">\n    <i class="cnv-icons-15 icons2_Dropdown-darkgray"></i>\n  </div>\n  <div data-search="prev" class="search-btn search-prev-btn" ng-disabled="disabled || numMatches === 0">\n    <i class="cnv-icons-15 icons2_Dropdown-darkgray flip"></i>\n  </div>\n  <div data-search="close" class="search-btn search-close-btn">\n    <i>\u2715</i>\n  </div>\n</div>')}function f(a){}!function(){var a=b.module("convoApp",["ngSanitize","ui.bootstrap","pasvaz.bindonce","ngTagsInput"]);a.config(["$controllerProvider","$compileProvider","$filterProvider","$provide","$tooltipProvider",function(b,c,d,e,f){c.debugInfoEnabled(!1),a.controller=function(a,c){return b.register(a,c),this},a.service=function(a,b){return e.service(a,b),this},a.factory=function(a,b){return e.factory(a,b),this},a.value=function(a,b){return e.value(a,b),this},a.directive=function(a,b){return c.directive(a,b),this},f.setTriggers({showTooltip:"hideTooltip",showEmojiPopover:"hideEmojiPopover",showGiphyPopover:"hideGiphyPopover"})}]),a.controller("AppCtrl",["$scope","$rootScope","config","$location","Groups","Users","accountInfo","userInfo","AppLinks","datetimeService","serverPingService","awsService","chatAppContext","chatUsersManager","InAppNotifications","appStateInfo","rtcNotificationManager","appTitleManager","connectivity","ServerComm","utils","accountDataService","settingsService","Feed","appTabs","localStore","Filters","$q","crossBrowserCompatibility","appsInfo","logger","importMacContacts","emojiDataService","preloadService","filterInfo","loginResponseData","FilterTypes","linksClickHistory","$timeout","resourcesTabsManager","premiumUpgradeBannerService","appWebWorkerManager","integrationsIntroService","perf","usagePolicyService","passwordPolicyService","onboardingService","pushNotificationsService","ContactsWrapper","$window","usersGroupsListProvider","loader","appLoadSequenceManager","Comments","bannerService","alertsService","appFeedViewAbsentOperationsManager","networkSettingService",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea){function fa(){var a=!1,b=A.readData(pa,A.KEY_TYPE_APP);b&&b.data===d.CLIENT_APP_VERSION||(a=!0,A.writeData(pa,d.CLIENT_APP_VERSION,c,A.KEY_TYPE_APP)),Y.com_convo.perf.boomerangBeaconObject?S.init(Y.com_convo.perf,a):BOOMR.subscribe("before_beacon",function(b){Y.com_convo.perf.boomerangBeaconObject=b,S.init(Y.com_convo.perf,a)})}function ga(b){S.recordMeasure("location change start");var c=e.path(),d=e.search(),f=e.hash();ea.isAccountBlocked()&&-1===c.indexOf("apps/19/17/0")&&-1===f.indexOf("title=Upgrade")&&b.preventDefault();var g;qa&&(g=ia()),na=j.urlToLink(c,d,f,g),a.locationAppLink=na;var i=na;if(!i)return b.preventDefault(),void N(function(){e.url("/feed")},0);var k=!0;if(i.type==j.RESOURCE_LINK&&i.accountId!==h.getAccountId()){var l=h.getUserAccount(i.accountId);if(l){var m=e.absUrl();ca.promptModal("Switch network","You need to switch to the "+l.accountName+" network to access this resource.",function(){a.$broadcast("AppCtrl.switchNetwork",l.accountId,m)},function(){N(function(){e.url("/feed")},0)},"Switch network"),b.preventDefault(),k=!1}}if(k&&!qa&&q.isAppInCompactView()&&i.type==j.RESOURCE_LINK&&(4==i.resourcePath.appInstance.uid||6==i.resourcePath.appInstance.uid)){var n=M.pop();if(n&&-1!==n.classList.indexOf("open-in-compact-view")){b.preventDefault();var o=i.resourcePath.hierarchy[0],p=j.linkToUrl(j.newFilterLink(B.newANDFiltersChain([B.newFilter(L.POST,JSON.stringify({rid:o.uid,rt:o.type}))]),i.title),!0);N(function(){e.url(p.slice(1))},0)}}}function ha(a){var c=na,h=null;if(c.type==j.ACTION_LINK||c.type==j.ACTION_LINK_FLEX_FORMAT)qa&&(ja(),("show_feed"===c.action||"show_login_view"===c.action)&&S.setInitialNavTo(S.INITIAL_NAV_TO_FEED),qa=!1),"show_feed"===c.action?(h=oa,b.filterInfo.filterApplied=!1,b.filterInfo.filterLink=null,b.$broadcast("filterChange")):"show_logout_view"===c.action||("editNotificationsSettings"===c.action?e.url(E.getNotificationsSettingsViewUrl().slice(1)):"editAccountSettings"===c.action?e.url(E.getAccountSettingsViewUrl().slice(1)):"upgradeNetwork"===c.action&&e.url(E.getPremiumUpgradeAppUrl().slice(1)));else if(c.type==j.FILTER_LINK){h=oa,qa&&S.setInitialNavTo(S.INITIAL_NAV_TO_FEED);var i=!1,k=!1;if(c.filter){var l=B.hasAnyFromOrToFilters(c.filter.filters);l&&(i=!0,l.toFilters.length>0&&(k=!0))}if(i||k){b.filterInfo.waitingForServerDataBeforeEvaluatingTheFilter=!0;var m;m=i&&k?C.all([g.getUsers(),f.getGroups()]):i?g.getUsers():f.getGroups(),m["finally"](function(){b.filterInfo.waitingForServerDataBeforeEvaluatingTheFilter=!1;var a;if(qa&&(a=ia()),c=j.urlToLink(e.path(),e.search(),e.hash(),a),c&&c.type==j.FILTER_LINK){var d=!0;if(c.filter&&1===c.filter.filters.length&&B.isGroupFilter(c.filter.filters[0])){var h=c.filter.filters[0].value,i=f.getGroup(h);if(i){if("PROFILE"===i.get("type")){var k=g.getUser(i.get("created_by"));k&&(c=j.newFilterLink(B.newANDFiltersChain([B.newFromFilter(k.id,k.email),c.filter.filters[0]]),g.getUserFullName(k)))}}else b.filterInfo.waitingForServerDataBeforeEvaluatingTheFilter=!0,d=!1,f.getGroupFromServerIfNotAvailableLocally(h)["finally"](function(){b.filterInfo.waitingForServerDataBeforeEvaluatingTheFilter=!1;var a;qa&&(a=ia(),ja(),qa=!1),c=j.urlToLink(e.path(),e.search(),e.hash(),a),c&&c.type==j.FILTER_LINK&&(b.filterInfo.filterApplied=!0,b.filterInfo.filterLink=c,b.$broadcast("filterChange"),c.title&&s.setAppTitle(c.title))})}else if(c.filter){var l=B.hasAnyUserFilter(c.filter.filters);if(l){b.filterInfo.waitingForServerDataBeforeEvaluatingTheFilter=!0,d=!1;for(var m=[],n=0;n<l.length;n++)m.push(g.getUserFromServerIfNotAvailableLocally(l[n].value));C.all(m)["finally"](function(){b.filterInfo.waitingForServerDataBeforeEvaluatingTheFilter=!1;var a;qa&&(a=ia(),ja(),qa=!1),c=j.urlToLink(e.path(),e.search(),e.hash(),a),c&&c.type==j.FILTER_LINK&&(b.filterInfo.filterApplied=!0,b.filterInfo.filterLink=c,b.$broadcast("filterChange"),c.title&&s.setAppTitle(c.title))})}}d&&(b.filterInfo.filterApplied=!0,b.filterInfo.filterLink=c,b.$broadcast("filterChange"),c.title&&s.setAppTitle(c.title),qa&&(ja(),qa=!1))}else qa&&(ja(),qa=!1)})}else qa&&(ja(),qa=!1),b.filterInfo.filterApplied=!0,b.filterInfo.filterLink=c,b.$broadcast("filterChange")}else c.type==j.RESOURCE_LINK&&(qa&&(ja(),qa=!1),h=oa,b.$broadcast("resourceLinkChange",c));if(c.title&&s.setAppTitle(c.title),ka(h),d.IS_NATIVE){var n={};n.title=decodeURIComponent(c.title)||"",n.url=e.absUrl(),nativeCommBridge.locationChanged(JSON.stringify(n))}}function ia(){var a=null;if(v.isIE()){var b=A.readDataGlobal("restricted_location_hash");b&&(a=b.data)}return a}function ja(){A.clearDataGlobal("restricted_location_hash")}function ka(b){a.current_view=b}function la(c){function q(){Z.init(),g.getUsers().then(function(a){l.init(),p.initialize()}),f.initRTC(),x.initialize(i.getUserId()),x.getGeneralSettings().then(function(a){d.IS_NATIVE&&nativeCommBridge.setGeneralSettings(JSON.stringify(a))});var a=10,e=1,h=A.readData("bosh_server_sub_domain_index");if(h&&h.data){var j=h.data;"number"==typeof j&&j>=1&&a>=j&&(e=j)}A.writeData("bosh_server_sub_domain_index",e+1);var k=d.XMPP_SERVER,j=k.indexOf("."),k=k.substring(0,j)+e+k.slice(j);n.connectConnectionManager(c.account_id,c.user,b.login_data.xmpp_session_token,d.XMPP_DOMAIN,k,d.SECURE_COMM,t,d.IS_NATIVE,d.CLIENT_APP_VERSION),n.connect(c.account_id,c.user,b.login_data.xmpp_session_token,null,null,d.SECURE_COMM,t),n.setServices(z,F,i,g),o.setAppUsersAndContactsService(g,X),r.connect(),setTimeout(function(){H.loadAssets(),I.loadFonts(),I.loadImages()},5e3)}K.set(c),b.login_data=c;for(var s,u=c.user_accounts,v=c.account_id,B=0;B<u.length;B++)if(u[B].account_id===v){s=u[B];break}w.initialize(),h.initAccountInfo(s,u),i.initUserInfo(c.user,s,b.login_data.is_administration_mode),m.setAwsData(c.aws_data),R.initialize(),W.initialize(),X.initialize(s),k.init(parseInt(c.time.timestamp)),z.initializeThisTab(ra),b.login_data.web_worker_enabled?Q.initialize():Q.stopPushServiceWebWorkerIfAlreadyRunning_Globally(),G.setProperties({display_import_users_nag:c.display_import_users_nag,display_import_users_nag_count:c.display_import_users_nag_count});var C={};if(C[c.user.user_id]={accessible:!0,name:c.user.first_name+" "+c.user.last_name,email:c.user.email,profile_image_type:c.user.profile_image_type+"",profile_image_version:c.user.profile_image_version+""},y.setUsers(C),aa.updateUsersAndGroups(C),b.pdfWorker=null,Y.com_convo.homeAppLoadedInitially?a.$on("cnvFeed::firstFeedRenderStart",q):setTimeout(function(){q()},0),d.IS_NATIVE&&nativeCommBridge.signIn(JSON.stringify(c)),c.usage_policy_info&&null!=c.usage_policy_info.display_policy_banner){var D="1"==c.usage_policy_info.display_policy_banner;T.setDisplayUsagePolicyInRightPanel(D)}var E=V.isOnboardingStepsCompleted()||"1"==c.onboarding_state.onboarding_checklist.onboarding_dismissed;if(c.onboarding_state.pwd_exp_tooltip1&&"1"==c.onboarding_state.pwd_exp_tooltip1.show&&E&&U.showPasswordExpiryToolTip1(c.onboarding_state.pwd_exp_tooltip1),c.onboarding_state.pwd_exp_tooltip2&&"1"==c.onboarding_state.pwd_exp_tooltip2.show&&E&&U.showPasswordExpiryToolTip2(c.onboarding_state.pwd_exp_tooltip2),null!=c.show_upgrade_success_tooltip){var J=e.path(),L=e.search(),M=e.hash(),N=j.urlToLink(J,L,M," ");if(N.type==j.RESOURCE_LINK&&19==N.resourcePath.appInstance.uid){var S=function(){O.off("homeTabSelected",S),P.showUpgradeSuccessTooltip()};O.on("homeTabSelected",S),e.path("/feed").search({}).hash("")}}try{var $=localStorage.getItem("app_startup_banner");$&&(ba.showBanner($),localStorage.removeItem("app_startup_banner"))}catch(_){}}function ma(c){Y.com_convo.sessionData.signInResponseData=c,K.set(c,!0),b.login_data=c;for(var e,j=c.user_accounts,k=c.account_id,o=0;o<j.length;o++)if(j[o].account_id===k){e=j[o];break}h.initAccountInfo(e,j,!0);var p=b.login_data.is_administration_mode,q=!p&&i.isAdminMode();i.initUserInfo(c.user,e,p,!0),m.setAwsData(c.aws_data);var r={};r[c.user.user_id]={accessible:!0,name:c.user.first_name+" "+c.user.last_name,email:c.user.email,profile_image_type:c.user.profile_image_type+"",profile_image_version:c.user.profile_image_version+""},y.setUsers(r),aa.updateUsersAndGroups(r),q&&(g.getUsersFromServer(),f.getGroupsFromServer());var s,t=O.getSelectedTab(),u=t&&"6"==t.appInstanceId;if(u&&(s=aa.getCommentsDataFromStore(t.resourceId,"6")),aa.clearCommentsStore(),s)var v=a.$on("cnvAppCont.commentsDataConsumed",function(){v(),a.$broadcast("reFetchFeedOnSessionRefresh"),da.reFetchFeedOnSessionRefresh()});else a.$broadcast("reFetchFeedOnSessionRefresh"),da.reFetchFeedOnSessionRefresh();a.$broadcast("reRenderUserView"),x.getGeneralSettings(!0).then(function(a){d.IS_NATIVE&&nativeCommBridge.setGeneralSettings(JSON.stringify(a))}),n.updateXmppAuthToken(K.getXmppSessionToken()),d.IS_NATIVE&&nativeCommBridge.signIn(JSON.stringify(c)),l.getUpdatesFromServer(),a.$broadcast("cnvSessionRefreshed",s),a.$broadcast("render")}S.recordDomComplete(),S.recordMeasure("AppCtrl begin");var na,oa="main_view",pa="prevLoadedClientVer",qa=!0;a.current_view=null,b.filterInfo=J;var ra=v.generateUniqueId();b.clientInstanceId=ra,u.setClientInstanceId(ra),F.setClientInstanceId(ra),Y.com_convo.config.sendAllLogsToServer&&F.sendAllLogsToServer(),nativeCommBridge.initializeApp(),t.initialize(),q.initialize(),s.initialize(),_.init(Y.com_convo.initialLink.type),Y.com_convo.perf.windowLoaded?fa():Y.addEventListener("load",function(){fa()}),$.init(Y.com_convo.scriptsMap,Y.com_convo.stylesMap,Y.com_convo.scriptsToPreload,Y.com_convo.stylesToPreload);for(var sa=Y.com_convo.appsPendingRegistration,ta=0;ta<sa.length;ta++)sa[ta]();if(Y.com_convo.appsPendingRegistration=[],Y.com_convo.homeAppLoadedInitially&&Y.com_convo.expectFeedDataAtStartup){var ua=C.defer();y.setCachedFeedDataPromise(ua.promise),Y.com_convo.startupFeedDataReceived?ua.resolve(Y.com_convo.startupFeedData):Y.document.body.addEventListener("startupFeedDataReceived",function(){ua.resolve(Y.com_convo.startupFeedData)})}Y.com_convo.sessionData&&Y.com_convo.sessionData.signInResponseData?la(Y.com_convo.sessionData.signInResponseData):Y.document.body.addEventListener("loginDataRecieved",function(){la(Y.com_convo.sessionData.signInResponseData)}),b.notificationDropdownScrollPos=0,a.$on("$locationChangeStart",ga),a.$on("$locationChangeSuccess",ha),b.$on("upgrade-to-permium",function(a){a.stopPropagation(),e.url(j.linkToUrl(j.newResourceLink("19",[{type:"17",uid:0}],null,"Upgrade"),!0).slice(1))}),a.destroyAppView=function(){ka(null),a.$$phase||a.$digest()},a.$on("MainCtrl.handleRefreshSessionResponseData",function(a,b){ma(b)}),Y.handleRefreshSessionResponseData=function(){ma(Y.com_convo.sessionData.signInResponseData)},Y.onYoutubePlayerStateChange=function(a){Y.document.dispatchEvent(new CustomEvent("onYoutubePlayerStateChange",{detail:a}))}}])}(),a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.EventDispatcher=function(){this._callbacks={},this._callsList=[]},g.chatsdk.EventDispatcher.prototype.dispatch=function(a,b){this._callbacks[a]&&(b&&"object"==typeof b?b.target=this:b||(b={target:this}),this._callbacks[a].fire(b))},g.chatsdk.EventDispatcher.prototype.addListener=function(a,b){function c(a){d._callbacks[a]||(d._callbacks[a]=$.Callbacks());var c=b,e=function(a){var b=a;try{c.call(this,b)}catch(d){console.error(d.stack)}};d._callsList.push({call:c,closure:e}),d._callbacks[a].add(e)}var d=this;if("[object Array]"===Object.prototype.toString.call(a))for(var e=a.length,f=0;e>f;f++)c(a[f]);else c(a)},g.chatsdk.EventDispatcher.prototype.removeListener=function(a,b){function c(a){if(d._callbacks[a]){var c=d._callsList.map(function(a){return a.call}),e=c.indexOf(b);e>-1&&(d._callbacks[a].remove(d._callsList[e].closure),d._callsList.splice(e,1))}}var d=this;if("[object Array]"===Object.prototype.toString.call(a))for(var e=a.length,f=0;e>f;f++)c(a[f]);else c(a)},b.module("convoApp").factory("accountDataService",["AccountDataChangeNotification","AccountDataChangeNotificationType","RTCNotification","$injector",function(a,b,c,d){function e(){i=d.get("rtcNotificationManager"),i.addListener(g.rtc.PubsubEvents.NOTIFICATION_RECEIVE,function(a){if(a.notification.type==c.ACCOUNT_DATA_CHANGED_WEB){var d=a.notification.data;d.type==b.GROUP_MODIFIED?h.trigger("groupModifiedByRemoteUser",d.data):d.type==b.GROUP_DELETED?h.trigger("groupDeletedByRemoteUser",d.data):d.type==b.USERS_INVITED_TO_GROUP?h.trigger("usersInvitedToGroupByRemoteUser",d.data):d.type==b.USER_REMOVED_FROM_GROUP?h.trigger("userRemovedFromGroupByRemoteUser",d.data):d.type==b.GROUP_JOIN_REQ_STATUS_UPDATED?h.trigger("groupJoinReqStatusUpdatedByRemoteUser",d.data):d.type==b.GROUP_JOIN_REQ_SENT?h.trigger("groupJoinReqSentByRemoteUser",d.data):d.type==b.USER_REMOVED_FROM_ACCOUNT&&h.trigger("userRemovedFromNetworkByRemoteUser",d.data)}})}function f(b,d){var e=new c;e.type=c.ACCOUNT_DATA_CHANGED_WEB,e.data=new a(b,d),i.send(e)}var h={};_.extend(h,Backbone.Events);var i;return h.initialize=e,h.sendAccountDataChangeNotification=f,h}]),b.module("convoApp").factory("accountInfo",["config","ServerComm","awsService","logger",function(b,d,e,f){function g(a,b,c){U=a,h(b),M=U.account_id,N=U.account_name,O=U.image_type,P=U.image_version,W=U.account_level,X=U.creation_date,T=U.invite_guests_as_full_members,Q=U.domain_pairs,R={};for(var d=0;d<Q.length;d++)Q[d].type===ca&&i(Q[d]),R[Q[d].user_email_domain]=1;J(y()),c?(w(),clearTimeout($),Y=Date.now(),aa||v(),j(U.revision),K.trigger("accountImageVersionUpdated")):L=U.revision}function h(a){V=a,K.trigger("accountInfo.updated.allUserAccounts",a)}function i(a){S=a,K.trigger("accountInfo.updated.primaryAccountDomain",a)}function j(a){L!=a&&(L=a,K.trigger("accountDataRevisionNoChanged"))}function k(a){var b=d.putx("accounts/info",{account_id:M,account_name:a});return b.then(function(){N=a,K.trigger("accountNameUpdated")}),b}function l(){return L}function m(){return M}function n(){return W}function o(){return W===da}function p(){return W===ea}function q(){return X}function r(a){O=a}function s(a){P=a,K.trigger("accountImageVersionUpdated")}function t(){return aa?ba:(ba=d.getx("accountdata?q=policy"),aa=!0,ba.then(function(a){aa=!1,200==a.status&&a.data&&1==a.data.type?(e.setAwsData(a.data.data),Y=Date.now(),v()):(f.logToServer("accountInfo.getAwsData: invalid success response: "+JSON.stringify(a)),$=setTimeout(t,1e3))},function(a){aa=!1,f.logToServer("accountInfo.getAwsData: error response: "+JSON.stringify(a)),$=setTimeout(t,1e3)}),ba)}function u(){return w(),clearTimeout($),t()}function v(){Z=setInterval(x,6e4)}function w(){clearInterval(Z)}function x(){Date.now()-Y>=ha&&(w(),t())}function y(){return 0!=D()?b.AWS_FILE_DIR_BASE+M+"/account-images/thumbnails/"+M+"-thumbnail-"+P+".jpg":"assets/img/common/convo+icon.jpg"}function z(){return N}function A(){return Q}function B(a){return R[a]!==c}function C(){return S}function D(){return O}function E(){return 1===T}function F(){for(var a=[{accountId:M,accountName:N,isLoggedIntoAccount:!0,isCompanyAccount:U.is_company_account}],b=0;b<V.length;b++){var c=V[b];c.account_id!==M&&"ACTIVE"===c.account_status&&a.push({accountId:c.account_id,accountName:c.account_name,isLoggedIntoAccount:!1,isCompanyAccount:c.is_company_account})}return a=_.sortBy(a,"accountName")}function G(a){for(var b,c=0;c<V.length;c++){var d=V[c];if(d.account_id===a){b={accountId:d.account_id,accountName:d.account_name};break}}return b}function H(){return a.enableFeedPollLoggingOnAllAccounts||M===ga}function I(){return M===fa}function J(a){if(a){var b=new Image;b.src=a}}var K={};_.extend(K,Backbone.Events);var L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,aa,ba,ca="PRI",da="STARTER",ea="PREMIUM",fa="w_88bac084-aee8-102b-bfae-a1ae858f3e89",ga="acc-28db3576-55a0-11e0-87d6-123138005841",ha=858e5;return Y=Date.now(),v(),a.enableFeedPollLoggingOnAllAccounts=!1,K.ACCOUNT_LEVELS={PREMIUM:"PREMIUM",STARTER:"STARTER"},K.initAccountInfo=g,K.setAccountDataRevisionNo=j,K.getAccountDataRevisionNo=l,K.shouldInviteGuestsAsFullMembers=E,K.updateAccountName=k,K.getAccountId=m,K.getAccountImageUrl=y,K.getAccountName=z,K.getAccountCreationDate=q,K.getAccountLevel=n,K.isStarterNetwork=o,K.isPremiumNetwork=p,K.getAccountDomains=A,K.isAccountDomain=B,K.getPrimaryAccountDomain=C,K.getAccountImageType=D,K.getUserAccountsListForNetworkSwitchingMenu=F,K.getUserAccount=G,K.updateNetworkImageType=r,K.updateNetworkImageVersion=s,K.isTNWAccount=H,K.isConvoAccount=I,K.getAwsDataNow=u,K}]),b.module("convoApp").factory("AccountDataChangeNotification",[function(){return function(a,b,c,d){this.type=a,this.data=b,this.revisionNo=c,this.revisionIncrement=d}}]),b.module("convoApp").constant("AccountDataChangeNotificationType",{USER_REMOVED_FROM_ACCOUNT:13,USERS_INVITED_TO_GROUP:2,USER_REMOVED_FROM_GROUP:9,GROUP_MODIFIED:7,GROUP_DELETED:8,GROUP_JOIN_REQ_STATUS_UPDATED:100,GROUP_JOIN_REQ_SENT:101}),b.module("convoApp").factory("AppLinks",["config","accountInfo","FiltersQueryTransformer","Filters","utils",function(a,b,d,e,f){function g(a){var b="/apps",c=[],d=[];b+="/"+a.resourcePath.appInstance.uid;for(var e=a.resourcePath.hierarchy,f=0;f<e.length;f++){var g,h=e[f];g="6"===h.type?"messages":"4"===h.type?"links":"IMAGE"===h.type?"images":"DOC"===h.type?"files":"9"===h.type?"settings":"22"===h.type?"groups":"11"===h.type?"users":"100"===h.type?"integrations":"26"===h.type?"groupsDirectory":"101"===h.type?"chats":h.type,b+="/"+g+"/"+h.uid}return a.collaborationInfo&&a.collaborationInfo.commentId&&c.push(["comment",a.collaborationInfo.commentId]),a.commentFileId&&c.push(["file",a.commentFileId]),a.commentFileFormat&&c.push(["file_format",a.commentFileFormat]),a.data&&a.data.resource_type&&c.push(["resource_type",a.data.resource_type]),{url_path:b,url_search:c,url_hash:d}}function h(a){var b="/feed",c=[],e=[];return a.filter&&c.push(["q",d.filtersToQuery(a.filter.filters)]),{url_path:b,url_search:c,url_hash:e}}function i(a){var b="/home",c=[["act",a.action]],d=[];return{url_path:b,url_search:c,url_hash:d}}function j(a,b,c,d,e){if(d.length<7||0==d[4].length||0==d[5].length||0==d[6].length)return null;var f,g,h,i,j,k,l,m=[],o=!1;f=d[4],"5"==f&&(o=!0,f="6");var p=n(c);k=p.title||e||"",l=p.view||"";for(var r=d.slice(5),s=Math.floor(r.length/2),t=0;s>t;t++){var u=2*t,v=r[u],w=r[u+1];"notes"==v?v="messages":"note"==v&&(v="message");var x;x="message"==v||"messages"==v?"6":"link"==v||"links"==v?"4":"image"==v||"images"==v?"images":"file"===v||"files"===v?"files":"settings"==v?"9":"groups"==v?"22":"users"==v?"11":"integrations"==v?"100":"groupsDirectory"==v?"26":"chats"==v?"101":v,o&&"messages"==v&&(w="MSG_"+w),null!=x&&null!=w&&m.push({uid:w,type:x})}return b&&(b.comment&&(h=b.comment),b.file&&(i=b.file),b.file_format&&(j=b.file_format),b.resource_type&&(g=b.resource_type)),q.newResourceLink(f,m,h,k,g,l,i,j)}function k(a,b,c,f){var g,h,i=!0,j=n(c);if(j.title?g=j.title:f&&(g=f),b&&b.q){var k=b.q,l=d.queryToFilters(k);l.length>0&&(j.filter_value&&(l[0].value=j.filter_value),h=e.newANDFiltersChain(l,g),g||(g=k),i=!1)}return i&&(h=null,g||(g="News feed")),q.newFilterLink(h,g)}function l(a,b,c,d){var e,f;b&&(e=b.act);var g=n(c);return g.title?f=g.title:d&&(f=d),q.newActionLink_flexFormat(e,f)}function m(a){for(var b="",c=0;c<a.length;c++)b+="&"+a[c][0],"boolean"!=typeof a[c][1]&&(b+="="+encodeURIComponent(a[c][1]));return b&&(b=b.slice(1)),b}function n(a){for(var b={},c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e.length>=2)try{b[e[0]]=decodeURIComponent(e.slice(1).join("="))}catch(f){b[e[0]]=e.slice(1).join("=")}else b[e[0]]=!0}return b}function o(a){var b=a.replace(new RegExp("^convo:","i"),""),c="",d={},e="",f=b.indexOf("?"),g=b.indexOf("#");if(c=b.substring(0,b.indexOf("?"))||b.substring(0,b.indexOf("#"))||b,-1!=f){var h=decodeURIComponent(b.substring(f+1,-1!=g?g:b.length));d=n(h)}return-1!=g&&(e=b.substring(g+1)),{urlPath:c,queryParams:d,hash:e}}var p="v1",q={RESOURCE_LINK:"resourceLink",FILTER_LINK:"filterLink",ACTION_LINK:"actionLink",ACTION_LINK_FLEX_FORMAT:"actionLink_flexFormat",resolveUrlParts:o,urlParamsStrToObj:n,newResourceLink:function(a,b,d,e,f,g,h,i){var j={type:q.RESOURCE_LINK,title:e,view:g};return j.resourcePath={},j.resourcePath.hierarchy=b,j.resourcePath.appInstance={uid:a,type:"APPINSTANCE"},e&&(j.resourcePath.appInstance.title=e),d&&(j.collaborationInfo={commentId:d}),h&&(j.commentFileId=h),i&&(j.commentFileFormat=i),f!==c&&(j.data={resource_type:f}),j},newFilterLink:function(a,b){var c={type:q.FILTER_LINK,filter:a,title:b};return c},newActionLink:function(a,b){var c={type:q.ACTION_LINK,action:a,title:b};return c},newActionLink_flexFormat:function(a,b){var c={type:q.ACTION_LINK_FLEX_FORMAT,action:a,title:b};return c},areEqual_filterLink:function(a,b){return a||b?a&&b||a==b?void 0:!1:!0},parseUrl:function(a){var b=!0,c=f.getAppUrlRegex1(),d=a.replace(c,"#");if(d==a){var e=f.getAppUrlRegex2();-1==a.search(e)&&(b=!1)}if(!b)return null;var g=d.indexOf("#");if(-1==g)return null;var h=o(d.substr(g+1));return this.urlToLink(h.urlPath||"",h.queryParams||{},h.hash||"")},linkToUrl:function(a,c){if(a.type==q.ACTION_LINK)return"#/"+a.action;var d="#/"+p+"/"+b.getAccountId(),e=null;a.type==q.RESOURCE_LINK?e=g(a):a.type==q.FILTER_LINK?e=h(a):a.type==q.ACTION_LINK_FLEX_FORMAT&&(e=i(a));var f="#";if(e&&(e.url_path&&(d+=e.url_path),e.url_search.length>0&&(d+="?"+m(e.url_search)),e.url_hash.length>0&&(d+="#"+m(e.url_hash),f="&")),c&&a.title){var j;try{j=encodeURIComponent(a.title)}catch(k){}j&&(d+=f+"title="+encodeURIComponent(a.title),f="&")}return a.view&&(d+=f+"view="+encodeURIComponent(a.view),f="&"),d},linkToConvoColonUrl:function(a,b){return"convo:"+q.linkToUrl(a,b).slice(1)},urlToLink:function(a,b,c,d){var e=null,f=a.split("/");return f.length>=2&&f.length<=3?"feed"==f[1]?e=q.newActionLink("show_feed","My Feed"):"login"==f[1]?e=q.newActionLink("show_login_view"):"logout"==f[1]?e=q.newActionLink("show_logout_view"):"editNotificationsSettings"==f[1]?e=q.newActionLink("editNotificationsSettings"):"editAccountSettings"==f[1]?e=q.newActionLink("editAccountSettings"):"upgradeNetwork"==f[1]&&(e=q.newActionLink("upgradeNetwork")):f.length>=4&&"v1"==f[1]&&("feed"==f[3]?e=k(a,b,c,d):"apps"==f[3]?(e=j(a,b,c,f,d),e.accountId=f[2]):"home"==f[3]&&(e=l(a,b,c,d))),e},getFilterUrlForFilterStr:function(a){return"/"+p+"/"+b.getAccountId()+"/feed?q="+encodeURIComponent(a)},readResourceId:function(a){for(var b,c=/([^\/])+/g,d={},e=[];null!=(b=c.exec(a));)b.index==c.lastIndex&&c.lastIndex++,e.push(b[0]);return d.accountId=e[1],d.noteId=e[5],d.itemId=e[7],d}};return q}]),b.module("convoApp").directive("cnvHandleConvoColonLinks",["$location","nativeCommBridge","config","utils","mixpanelService","AppLinks","linksClickHistory","$window","loader","$rootScope","resourcesTabsManager","ChatsViewDataManager",function(a,b,c,d,e,f,g,h,i,j,k,l){return{restrict:"A",priority:0,compile:function(m,n,o){return function(m,n,o,p){function q(a){return a&&0!==a.indexOf("javascript:")&&"#"!=a?!0:!1}function r(a){function d(b,c){var d=f.parseUrl(b);if(!d||d.type!==f.RESOURCE_LINK||"4"!=d.resourcePath.appInstance.uid&&"6"!=d.resourcePath.appInstance.uid)d||c&&$(c).attr({target:"_blank"});else{var g=f.parseUrl(location.href),h=!1;if(g.resourcePath&&g.resourcePath.hierarchy[0]&&d.resourcePath&&d.resourcePath.hierarchy[0]&&g.resourcePath.hierarchy[0].uid===d.resourcePath.hierarchy[0].uid&&(h=!0),!h){var i={};"_blank"===m||a.ctrlKey===!0||a.metaKey===!0?i.In="New Tab":i.In="Existing Tab",$(a.target).closest(".title-text").length?i.From="Newsfeed":$(a.target).closest(".cnv-notif-dropdown").length?i.From="Notification Center":i.From="Post Reference",e.trackEvent(e.OPENED_POST,i)}}}var g,i=a.currentTarget.href,m=a.currentTarget.getAttribute("target")||"",n=$(a.currentTarget).closest("*[contentEditable=true]").length,o=!1,p=q(i);return i&&0!==i.indexOf("javascript:")&&"_blank"!==m?n?(o=!0,!p||a.ctrlKey!==!0&&a.metaKey!==!0||(g=i.replace(x,"#"),m="_blank",c.IS_NATIVE||(h.open(g,m),$(".ql-link-tooltip").css("left","-10000px")))):(g=i.replace(x,"#"),g===i&&0!==i.search(y)?($(a.currentTarget).attr({target:"_blank",rel:"noopener noreferrer"}),m="_blank"):g!==i?(k.isFullViewChatOpen()&&(j.fullViewChatItem=l.getSelectedItem()),k.isFullViewChatOpen()&&!c.IS_NATIVE?(m="_blank",h.open(g,m),o=!0):($(a.currentTarget).attr("href",g).addClass("convo-to-webapp-url"),d(i))):d(i,a.currentTarget)):(o=!1,g=i),p&&($(a.currentTarget).parents(".system-chat-msg").length||$(a.currentTarget).parents(".system-chat-message").length)&&(0===i.search(x)||0===i.search(y)?e.trackEvent(e.OPEN_CONVO_LINK_IN_CHAT):e.trackEvent(e.OPEN_EXTERNAL_LINK_IN_CHAT),-1!==i.indexOf(c.APPEARIN_VIDEO_CALL_DIRECT_LINK_PREFIX)&&e.trackEvent(e.CLICKED_VIDEO_CALL,{Participants:a.currentTarget.getAttribute("data-participants-count")})),c.IS_NATIVE&&a.metaKey===!0&&p&&(b.openInDefaultBrowser(g),o=!0),o?(a.preventDefault(),a.stopPropagation(),!1):!0}function s(a){var c=a.target;"A"===c.nodeName&&c.parentElement&&c.parentElement.parentElement&&$(c.parentElement.parentElement).hasClass("intercom-comment-body")&&(a.preventDefault&&a.preventDefault(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),b.openInDefaultBrowser(c.href))}function t(a){v(a)}function u(b){d.isIE()&&v(b);var c=$(b.currentTarget),e=c.attr("href");g.push(e,c.attr("class"));var f=a.url();e&&f&&(0===e.indexOf("#")?e=e.slice(1):0===e.indexOf("convo:")&&(e=e.slice(6)),decodeURIComponent(e)===decodeURIComponent(f)&&j.$broadcast("sameLinkClickedAgain"))}function v(a){var b=a.currentTarget.href,c=b.replace(x,"#");return c!==b&&$(a.currentTarget).attr("href",c).addClass("convo-to-webapp-url"),!0}function w(a){a.altKey&&a.ctrlKey&&a.shiftKey&&80===a.which?i.loadPlugin("perfBar"):(a.metaKey||a.ctrlKey)&&(191===a.which?j.$broadcast("keyboardShortcut.cmdOrCtrlQuestionMark"):70===a.which&&j.$broadcast("keyboardShortcut.cmdOrCtrlF",a))}var x=d.getAppUrlRegex1(),y=d.getAppUrlRegex2();$(n).on("click","a",r),$(n).on("contextmenu","a",t),$(n).on("mousedown","a",u),$(h).on("keydown",w),c.IS_NATIVE&&h.document.body.addEventListener("click",s,!0),m.$on("$destroy",function(){$(n).off("click","a",r),$(n).off("contextmenu","a",t),$(n).off("mousedown","a",u),c.IS_NATIVE&&h.document.body.removeEventListener("click",s,!0)})}}}}]),b.module("convoApp").directive("cnvOpenNotesInFlexApp",["config",function(b){return{restrict:"A",priority:1,compile:function(c,d,e){return function(c,d,e,f){function g(c){var d=c.currentTarget.href,e=d.search(/#\/v1\/.+\/apps\/6\//i);if(-1==e)return!0;var f=b.FLEX_APP_URL+d.slice(e);return a.open(f),c.preventDefault(),c.stopPropagation(),!1}$(d).on("click","a",g),c.$on("$destroy",function(){$(d).off("click","a",g)})}}}}]),b.module("convoApp").factory("appsInfo",["AppLinks","accountInfo","userInfo","$injector",function(a,b,d,e){var f={};_.extend(f,Backbone.Events),f.NOTES_APP="NOTES_APP";var g={},h={home:{title:"Home",directiveName:"cnv-home",supportsComments:!1,getItemDataFromServer:!1,isResourceAccessible:function(a){return!0}},4:{title:"Web Link",directiveName:"cnv-links-app",supportsComments:!0,getItemDataFromServer:!0,getItemDataServerCall:function(){return e.get("Link").getLinkDetails},isResourceAccessible:function(a){return!0}},12:{title:"Settings",directiveName:"cnv-settings",supportsComments:!1,getItemDataFromServer:!1,isResourceAccessible:function(a){var c=!0;return a.resourcePath.hierarchy[1]&&"networkInformation"==a.resourcePath.hierarchy[1].type&&(d.isAdmin()||"PREMIUM"!=b.getAccountLevel()||(c=!1)),c}},9:{title:"Manage Group",directiveName:"cnv-group-settings",supportsComments:!1,getItemDataFromServer:!1,isResourceAccessible:function(a){return!0}},13:{title:"Manage Users",directiveName:"cnv-users-directory",supportsComments:!1,getItemDataFromServer:!1,isResourceAccessible:function(a){return!0}},100:{title:"Integrations",directiveName:"cnv-integrations-directory",supportsComments:!1,getItemDataFromServer:!1,isResourceAccessible:function(a){return!0}},22:{title:"Groups Directory",directiveName:"cnv-groups-directory",supportsComments:!1,getItemDataFromServer:!1,isResourceAccessible:function(a){return!0}},19:{title:"Premium Upgrade",directiveName:"cnv-premium-upgrade",supportsComments:!1,getItemDataFromServer:!1,isResourceAccessible:function(a){return!0}},101:{title:"Chat",directiveName:"cnv-full-view-chat-app",supportsComments:!1,getItemDataFromServer:!1,isResourceAccessible:function(a){return!0}}};return f.getAppInfoByName=function(a){return g[a]},f.getAppInfoByAppInstanceId=function(a){return h[a]},f.getAppMainService=function(a){return e.get(g[a].services.main)},f.registerApp=function(a){g[a.appName]=a,h[a.appInstanceId]=a,f.trigger(a.appName+"Registered")},f.isAppRegistered=function(a){return g.hasOwnProperty(a)},f.getNotificationsSettingsViewUrl=function(){var b=a.newResourceLink("12",[{type:"9",uid:0},{type:"notificationsSettings",uid:0}],null,"Notification Settings");return a.linkToUrl(b,!0)},f.getAccountSettingsViewUrl=function(){var b=a.newResourceLink("12",[{type:"9",uid:0},{type:"myAccountSettings",uid:0}],null,"My account settings");return a.linkToUrl(b,!0)},f.getPremiumUpgradeAppUrl=function(){return a.linkToUrl(a.newResourceLink("19",[{type:"17",uid:0}],null,"Upgrade"),!0)},f.getFullViewChatAppUrl=function(b,d,e){var f=b?b:"all";return e||("all"==f?e="All chats":"new"==f?e="New chat":"contact"==d&&(e=b)),a.linkToUrl(a.newResourceLink("101",[{type:"101",uid:f}],c,e,c,d),!0)},f.isChatView=function(a){if(-1!==a.indexOf("/apps/")){var b=a.split("/apps/")[1],c=b.split("/")[0];if(c&&"Chat"===h[c].title)return!0}return!1},f}]),b.module("convoApp").directive("cnvAppCont",["$compile","appsInfo","rtcNotificationManager","RTCNotification","$q","loader","config","logger",function(a,b,d,e,f,h,i,j){
return{restrict:"AE",priority:0,scope:!0,compile:function(c,d,e){return function(c,d,e,f){function g(){function e(){}var f,g=b.getAppInfoByAppInstanceId(c.tab.appInstanceId),h=null!=g;6==c.tab.appInstanceId&&(c.cnvAppContScope=new e),f=h?"<"+g.directiveName+"></"+g.directiveName+">":"<div></div>",f+="<ng-include ng-if='view === 2 || view === 3 || view === 7' src=\"'apps/templates/resourceNotAvailable.tpl.html'\"></ng-include>",d.append(a(f)(c))}c.tab.appTemplateAppended||(c.appScriptLoaded?g():c.$on("appScriptLoaded",g)),c.$on("$destroy",function(){d.empty(),c.tab.appContCtrl=null,c.tab=null})}},controller:["$scope","itemService","ItemsConstants","ServerErrorCodes","alertsService","bannerService","Likes","nativeCommBridge","$rootScope","userInfo","Comments","$location",function(a,d,e,k,l,m,n,o,p,q,r,s){function t(){function c(){h.isScriptLoaded(h.SCRIPTS.APP_COMPLETE)?(j.log("loader: APP_COMPLETE script already loaded"),u()):h.isScriptLoaded(h.SCRIPTS.APP_APPS)?(j.log("loader: APP_APPS script already loaded"),u()):(j.log("loader: loading APP_APPS script"),h.loadScript(h.SCRIPTS.APP_APPS).then(function(){u()}))}function d(){h.isStyleLoaded(h.STYLES.APP_COMPLETE)?(j.log("loader: APP_COMPLETE style already loaded"),c()):h.isStyleLoaded(h.STYLES.APP_APPS)?(j.log("loader: APP_APPS style already loaded"),c()):(j.log("loader: loading APP_APPS style"),h.loadStyle(h.STYLES.APP_APPS).then(function(){c()}))}j.log("loader: loading app: "+a.tab.appInstanceId),!a.$parent.showCompactChat&&b.isChatView(s.$$url)&&s.url("/feed"),"home"===a.tab.appInstanceId||i.IS_DEV?u():d()}function u(){v(),a.appScriptLoaded=!0,a.$emit("appScriptLoaded")}function v(){return Y=b.getAppInfoByAppInstanceId(ba.appInstanceId),(Z=null!=Y)?Y.isResourceAccessible(a.tab.resourceLink)?(a.view=da.DEFAULT,Y.getItemDataFromServer&&O(),a.galleryCtrl=new ea.initialize,void(ba.resourceLink&&ba.resourceLink.resourcePath&&ba.resourceLink.resourcePath.hierarchy&&(2==ba.resourceLink.resourcePath.hierarchy.length&&"versions"!==ba.resourceLink.resourcePath.hierarchy[1].type||1==ba.resourceLink.resourcePath.hierarchy.length&&ba.resourceLink.commentFileId)&&(a.galleryCtrl.active=!0))):void V(!1):void l.alertModal("App Not Supported","The app that opens this type of post is currently not supported.","Go Back",function(){U()},!0,!0)}function w(b){if(!Y.isResourceAccessible(a.tab.resourceLink))return void V(!1);if(ja.initialized&&ja.navigate&&ja.navigate(b),2==ba.resourceLink.resourcePath.hierarchy.length&&"versions"!==ba.resourceLink.resourcePath.hierarchy[1].type||1==ba.resourceLink.resourcePath.hierarchy.length&&ba.resourceLink.commentFileId)a.galleryCtrl.active=!0,a.galleryCtrl.initialized&&a.galleryCtrl.initialize();else if(a.galleryCtrl.active&&a.tab.resourceLink.collaborationInfo&&6==a.tab.appInstanceId)var c=a.$on("deactivate_gallery",function(a){a.stopPropagation(),c(),ea.destroy()});else ea.destroy();Y.getItemDataFromServer&&K()}function x(b){a.$broadcast("activated",b),ja.initialized&&ja.activated&&ja.activated(b)}function y(){a.$broadcast("deactivated"),ja.initialized&&ja.deactivated&&ja.deactivated()}function z(a){return Z&&ja.initialized&&ja.okToClose?ja.okToClose(a):!0}function A(){Z&&(ja.initialized&&ja.closing&&ja.closing(),Y.getItemDataFromServer&&P())}function B(a){ja.itemDataReceivedFromServer&&(ja.itemDataReceivedFromServer(a),i.IS_NATIVE&&o.noteAppActivated(a.item.title))}function C(a){ja.itemDataPolledFromServer&&ja.itemDataPolledFromServer(a)}function D(){if(la)return ha;if(la=!0,a.tab.hasOwnProperty("localDetailsObject")&&null!==a.tab.localDetailsObject){var b=f.defer();ha=b.promise,setTimeout(function(){b.resolve(a.tab.localDetailsObject),la=!1},0)}else ha=Y.getItemDataServerCall()(ba.resourceId,Y.sendTimestampInServerCall?aa:null).then(function(a){return a.data.data&&!a.data.data.no_update&&(aa=a.data.data.timestamp),a})["finally"](function(){la=!1});return ha}function E(){F()}function F(){ia=setTimeout(function(){D().then(function(a){!ca&&T(a.data,!0)&&(a.data.data.no_update||C(a.data.data),F())},function(a){!ca&&T(a,!0,!0)&&F()})},ka)}function G(a,b){var c=D();return c.then(function(b){!ca&&T(b.data,!0)&&(b.data.data.no_update||C(b.data.data),a&&a(b))},function(a){!ca&&T(a,!0,!0)&&b&&b(a)}),c}function H(){clearTimeout(ia),ia=c}function I(){var b=[a.tab.resourceLink.resourcePath.hierarchy[0].uid];2==a.tab.resourceLink.resourcePath.hierarchy.length&&b.push(a.tab.resourceLink.resourcePath.hierarchy[1].uid);var c=n.getLikeInfo(null,b.join(","),ba.resourceId,ba.appInstanceId,0);c.then(function(a,b){!ca&&ja.initialized&&ja.setItemLikesInfo&&ja.setItemLikesInfo(a),ca||J()})}function J(){ga&&clearTimeout(ga),ga=setTimeout(function(){var b=[a.tab.resourceLink.resourcePath.hierarchy[0].uid];2==a.tab.resourceLink.resourcePath.hierarchy.length&&b.push(a.tab.resourceLink.resourcePath.hierarchy[1].uid),n.getLikeInfo(null,b.join(","),ba.resourceId,ba.appInstanceId,0).then(function(a,b){!ca&&ja.initialized&&ja.setItemLikesInfo&&ja.setItemLikesInfo(a),ca||J()})},ka)}function K(){var b=[a.tab.resourceLink.resourcePath.hierarchy[0].uid];2==a.tab.resourceLink.resourcePath.hierarchy.length&&b.push(a.tab.resourceLink.resourcePath.hierarchy[1].uid);var c=n.getLikeInfo(null,b.join(","),ba.resourceId,ba.appInstanceId,0);c.then(function(a,b){!ca&&ja.initialized&&ja.setItemLikesInfo&&ja.setItemLikesInfo(a)})}function L(){ga&&clearTimeout(ga),ga=c}function M(){$=g.rtc.RTCFactory.getRTCManager(ba.appInstanceId+"_"+ba.resourceId),$.addListener(g.rtc.PubsubEvents.CHANGE_RECEIVED,S),$.connect()}function N(){$&&($.removeListener(g.rtc.PubsubEvents.CHANGE_RECEIVED,S),g.rtc.RTCFactory.releaseRTCManager(ba.appInstanceId+"_"+ba.resourceId),$=null)}function O(){var a=D().then(function(a){return!ca&&T(a.data,!1)&&(B(a.data.data),E()),a},function(a){ca||T(a,!1,!0)});fa.getItemDataFromServerPromise=a,M(),I(),fa.rtcManager=$}function P(){H(),L(),N(),ca=!0}function Q(){var a=d.moveToTrash(ba.appInstanceId,ba.resourceId);return m.showBanner_promise(a,"Moving to trash...","Moved to trash","Error... click here to try again",!1,!1,a),a}function R(){var b=d.deletePermanently(ba.appInstanceId,ba.resourceId);return m.showBanner_promise(b,"Deleting permanently...","Deleted","Error... click here to try again",!1,!1,b),b.then(function(){a.$emit("closeTab",ba)}),b}function S(a){var b=a.data;b.type===e.ITEM_DELETED_PERMANENTLY?W():b.type===e.ITEM_MOVED_TO_TRASH?ja.initialized&&ja.onItemMovedToTrashByRemoteUser&&ja.onItemMovedToTrashByRemoteUser():b.type===e.ITEM_RESTORED?ja.initialized&&ja.onItemRestoredByRemoteUser&&ja.onItemRestoredByRemoteUser():b.type===e.ITEM_SHARING_INFO_UPDATED?ja.initialized&&ja.onItemSharingInfoUpdatedByRemoteUser&&ja.onItemSharingInfoUpdatedByRemoteUser(b.data):b.type===e.ITEM_TAGS_UPDATED?ja.initialized&&ja.onItemTagsUpdatedByRemoteUser&&ja.onItemTagsUpdatedByRemoteUser(b.data):b.type===e.ITEM_UPDATED_2?ja.initialized&&ja.onItemUpdatedByRemoteUser&&ja.onItemUpdatedByRemoteUser(b.data):b.type===e.ITEM_PERMISSION_CHANGED&&G().then(function(){ja.initialized&&ja.onItemPermissionsUpdatedByRemoteUser&&ja.onItemPermissionsUpdatedByRemoteUser(b.data)})}function T(a,b,c){var d=!0;return c?404===a.status&&(d=!1,V(b)):0===a.type&&(d=!1,a.errorCode===k.RESOURCE_NOT_ACCESSIBLE&&V(b)),d}function U(b){a.$emit("closeTab",ba)}function V(b){X()?a.view=7:a.view=da.INACCESSIBLE}function W(){q.isAdminMode()?G():(P(),X()?a.view=7:a.view=da.DELETED_PERMANENTLY)}function X(){var b=a.tab.resourceLink;return b&&b.resourcePath&&b.resourcePath.hierarchy&&2==b.resourcePath.hierarchy.length&&"versions"===b.resourcePath.hierarchy[1].type}a.tab=a.tabs[a.tabs.length-1],a.tab.scope=a,a.tab.scope.tab=a.tab;var Y,Z,$,aa,ba=a.tab,ca=!1,da={DEFAULT:1,INACCESSIBLE:2,DELETED_PERMANENTLY:3,APP_NOT_SUPPORTED:4},ea={initialize:function(){var a={};return a.active=!1,a.initialized=!1,_.extend(a,Backbone.Events),a},destroy:function(){a.galleryCtrl.initialized&&(a.galleryCtrl.active=!1,a.galleryCtrl.off(),a.galleryCtrl=new ea.initialize,p.$emit("SnippetArrow:destroyAll"))}},fa=ba.appContCtrl;fa.navigate=w,fa.activated=x,fa.deactivated=y,fa.okToClose=z,fa.closing=A,fa.appCtrl={initialized:!1},fa.initialized=!0;var ga,ha,ia,ja=fa.appCtrl,ka=3e4,la=!1;fa.immediatePollForItemData=G,fa.immediatePollForItemLikesInfo=K,fa.moveItemToTrash=Q,fa.deleteItemPermanently=R,a.$on("cnvSessionRefreshed",function(b,c){Y.getItemDataFromServer&&(G(function(b){b.data.data.no_update&&c?r.setCommentsData(c,ba.appInstanceId,ba.resourceId):a.$broadcast("resetCommentsOnSessionRefresh")},function(){a.$broadcast("resetCommentsOnSessionRefresh")})["finally"](function(){a.$emit("cnvAppCont.commentsDataConsumed")}),K()),r.flushCommentsStatus()}),a.$on("$destroy",function(){setTimeout(function(){ea.destroy(),a.galleryCtrl=null},0),ba=null}),t()}]}}]),b.module("convoApp").directive("cnvIntercomIoCont",["loader","config","userInfo","datetimeService","onboardingService","$rootScope",function(b,c,d,e,f,g){return{restrict:"AE",priority:0,scope:!1,link:function(f,h,i){function j(){k=setInterval(function(){if(0!==$("#intercom-io-btn").length){clearInterval(k),k=null,a.Intercom("boot",{app_id:c.INTERCOM_IO_APP_ID,email:d.getEmail(),user_id:d.getUserId(),created_at:Math.floor(e.normalizeAndGetUnixTimestamp(d.signUpCompletionDate)/1e3),custom_launcher_selector:"#intercom-io-btn"}),a.Intercom("onUnreadCountChange",function(a){l||(setTimeout(function(){$("head").append('<style type="text/css"> #intercom-container .intercom-notifications-frame { bottom: 88px !important; right: 12px !important; } </style>')},200),l=!0);var b=$("#intercom-io-unread-badge");a?b.text(a).show():b.hide()}),a.Intercom("onShow",function(){m||($("head").append('<style type="text/css"> #intercom-container .intercom-messenger-frame { bottom: 33px !important; right: 13px !important; height: calc(100% - 33px - 20px) !important; } </style>'),m=!0)});var b=setInterval(function(){0!==$("body > #intercom-container").length&&(clearInterval(b),b=null,g.$emit("intercomIO:loaded"))},1e3)}},5e3)}f.intercomIOBtnHref="mailto:"+c.INTERCOM_IO_APP_ID+"@incoming.intercom.io";var k,l=!1,m=!1;b.loadExternalScript(b.EXTERNAL_SCRIPTS.INTERCOM_IO_API).then(j)},controller:["$scope","loader",function(a,b){}]}}]),b.module("convoApp").directive("cnvAudioPlayer",["videoPlayerSettings","$filter","$location","config","utils","accountInfo","audioService",function(b,d,e,f,g,h,i){return{restrict:"E",priority:0,scope:!1,templateUrl:"audioPlayer/cnvAudioPlayer.tpl.html",link:function(c,d,e){function h(){Q.couldNotPlayFile||(ea=!0,U.addClass("playing"),ha=!0,ga&&(ha=!1,j()))}function j(){T.play(),Q.playedOnce=!0,i.trigger("pause-other-audio",{fileId:P}),i.on("pause-other-audio",r),c.$emit("VideoPlayback:Playing",{id:P})}function k(){ea=!1,U.removeClass("playing"),ha=!1,l()}function l(){T.pause(),i.off("pause-other-audio",r),fa=!0,setTimeout(function(){fa=!1},50)}function m(a,b){o(a),ja=a,ka=!0,ga&&(ka=!1,p(ja)),b||(ia=!0,ga&&(ia=!1,n(a)))}function n(a){T.currentTime=R*a/100}function o(a){R===1/0&&(a=0),W.style.right=100-a+"%"}function p(a){R===1/0?_.innerHTML=L(T.currentTime):_.innerHTML=L(R*a/100)}function q(){ga&&T.currentTime>0&&R!==1/0&&b.updateSeekPosition(P,T.currentTime,R,Q)}function r(a){a.fileId!==P&&k()}function s(a,b){if(ga){var c=W.getBoundingClientRect(),d=100*(a.clientX-c.left)/V.offsetWidth;0>d?d=0:d>100&&(d=100),m(d,b)}}function t(a){aa.on("mousemove",u),aa.on("mouseup",v)}function u(a){S=!0,s(a,!0)}function v(a){aa.off("mousemove",u),aa.off("mouseup",v),S=!1,s(a),C()}function w(a){var c=X.getBoundingClientRect(),d=100*(c.bottom-a.clientY)/c.height;0>d?d=0:d>100&&(d=100),Y.style.bottom=d+"%",T.volume=d/100,b.setCurrentVolume(T.volume),T.volume>0&&(T.muted=!1,b.setMuteState(!1)),A()}function x(a){aa.on("mousemove",y),aa.on("mouseup",z)}function y(a){w(a)}function z(a){aa.off("mousemove",y),aa.off("mouseup",z)}function A(){Z.removeClass("full mid mute"),0==T.volume||T.muted?Z.addClass("mute"):T.volume<=.5?Z.addClass("mid"):Z.addClass("full")}function B(a){a.playerRef!==Q&&a.fileId==P&&m(a.currentTime/a.duration*100)}function C(){da.focus()}function D(a){var b=a.which||a.keyCode;32===b&&Q.onPlayPauseBtnClick()}function E(a){R=T.duration}function F(a){ga=!0,p(100),ia&&n(ja),ha&&j(),ka&&p(ja)}function G(a){}function H(a){}function I(a){if(!S&&ea){var b=T.currentTime/R*100;o(b),p(b),R!==1/0&&T.currentTime>=R&&k()}}function J(a){!fa&&ea&&h()}function K(a){f.IS_MAC||la||(k(),Q.couldNotPlayFile=!0,M(),Q.$emit("cnvAudioPlayer.couldNotPlayFile"),Q.showMenu||d.find(".audio-player-wrapper-inner").addClass("no-menu"))}function L(a){var b=a;if(a>=3600){var c=Math.floor(a/3600),d=Math.floor((a-3600*c)/60);return b=Math.floor(a-3600*c-60*d),(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)+":"+(10>b?"0"+b:b)}var d=Math.floor(a/60);return b=Math.floor(a-60*d),(10>d?"0"+d:d)+":"+(10>b?"0"+b:b)}function M(){Q.$broadcast("render")}function N(){var a=b.getSeekPosition(P,!0);a&&m(a.currentTime/a.duration*100)}var O,P,Q=c,R=0,S=!1,T=d.find("audio")[0],U=d.find(".toggle .icon"),V=d.find(".scrubber .scrubber-cont")[0],W=d.find(".scrubber .seek")[0],X=d.find(".vol-bar-pad")[0],Y=d.find(".vol-bar-cont .bar")[0],Z=d.find(".volume-icon"),_=d.find(".timer")[0],aa=$(a),ba=$(V),ca=$(Y),da=d.find(".dummy-active-elem");Q.showMenu||d.find(".audio-player-wrapper-inner").addClass("no-menu");var ea=!1,fa=!1,ga=!1,ha=!1,ia=!1,ja=0,ka=!1,la=g.isSafari();Q.pause=k,Q.onPlayPauseBtnClick=function(){ea?k():h(),C()},c.$on("VideoPlayback:stopBuffering",function(a,b){b.id!==P&&k()}),Q.scrubberClicked=s,ba.on("mousedown",t),Q.volumeBarClicked=w,ca.on("mousedown",x),Q.toggleVolume=function(){T.muted?(T.muted=!1,T.volume=b.getCurrentVolume()||1,Y.style.bottom=100*T.volume+"%",b.setMuteState(!1)):(T.muted=!0,Y.style.bottom="0%",b.setMuteState(!0)),A()},T.addEventListener("loadedmetadata",E),T.addEventListener("loadeddata",F),T.addEventListener("canplay",G),T.addEventListener("canplaythrough",H),T.addEventListener("timeupdate",I),T.addEventListener("pause",J),T.addEventListener("error",K,!0),da[0].addEventListener("keyup",D,!1),c.$on("cnvFeed.pauseAudioPlaybackOnHomeTabUnselected",function(){q(),k()}),c.$on("cnvAudioViewer.focusDummyActiveElem",C),b.on("videoPlayerSettings.seekPosUpdated",B),c.$on("cnvAudioViewer.setAudioFile",function(a,b){var c=b.id||b.file_id;O&&c==P?h():(Q.file=b,O=Q.file,P=c,g.canPlayAudioType(O.type)?(M(),N(),h()):(Q.couldNotPlayFile=!0,M(),Q.$emit("cnvAudioPlayer.couldNotPlayFile")))}),Q.file&&(O=Q.file,P=O.id||O.file_id,g.canPlayAudioType(O.type)?(N(),Q.autoPlayAudio&&h()):(Q.couldNotPlayFile=!0,M(),Q.$emit("cnvAudioPlayer.couldNotPlayFile"))),T.volume=b.getCurrentVolume(),Y.style.bottom=100*T.volume+"%",T.muted=b.getMuteState(),A(),c.$on("$destroy",function(){q(),i.off("pause-other-audio",r),T.removeEventListener("loadedmetadata",E),T.removeEventListener("loadeddata",F),T.removeEventListener("canplay",G),T.removeEventListener("canplaythrough",H),T.removeEventListener("timeupdate",I),T.removeEventListener("pause",J),T.removeEventListener("error",K,!0),da[0].removeEventListener("keyup",D,!1),b.off("videoPlayerSettings.seekPosUpdated",B),ca.off("mousedown",x),aa.off("mousemove",y),aa.off("mouseup",z),ba.off("mousedown",t),aa.off("mousemove",u),aa.off("mouseup",v),O=null,T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,_=null,aa=null,ba=null,ca=null,da=null})},controller:["$scope","$attrs",function(a,b){function d(){a.dropdownCtrl.options=[];var b;b=j.name.length>30?j.name.substr(0,30)+"...":j.name,a.dropdownCtrl.options.push({label:b,isNotHoverable:!0}),a.dropdownCtrl.options.push({label:g.formatBytes(j.size),"class":"subtext",isNotHoverable:!0}),a.dropdownCtrl.options.push({isDivider:!0}),a.dropdownCtrl.options.push({label:"Open in gallery",icon:"cnv-icons-20 Icon1_expand-01-white",callback:function(){e.url(a.resourceLinkUrl.slice(1))}}),a.dropdownCtrl.options.push({label:"Copy link",icon:"cnv-icons-20 linkhorizontal-white",callback:function(){g.copyToClipboard(f.CONVO_LINKS_BASE_URL+a.resourceLinkUrl.slice(1))}}),a.dropdownCtrl.options.push({label:"Download",icon:"cnv-icons-20 Icon1__Download-white",callback:function(){i()}}),j.canDeleteFile&&(a.dropdownCtrl.options.push({isDivider:!0}),a.dropdownCtrl.options.push({label:"Delete",icon:"cnv-icons-20 icons2_Trash-white",callback:function(){a.pause(),a.$emit("cnvAudioPlayer.deleteFile",j)}}))}function i(){g.download([{path:h.getAccountId()+"/note"+(j.noteId||j.item_id)+"/"+j.original_name.toString(),name:j.name}])}a.playedOnce=!1,a.showMenu=b.showMenu!==c,a.notifyCouldNotPlayFile=!0,b.dontNotifyCouldNotPlayFile&&(a.notifyCouldNotPlayFile=!1),a.couldNotPlayFile=!1;var j;a.dropdownCtrl={fixedPosition:!0},a.dropdownCtrl.alwaysUpwordsDirection=!0,a.dropdownCtrl.type="video_player_inverted_colors",a.file&&(j=a.file,d()),a.$on("cnvAudioViewer.setAudioFile",function(a,b){j=b,d()}),a.$on("cnvNoteGallery.postPermissionsChanged",function(a,b){j.canDeleteFile=b,d()}),a.$on("$destroy",function(){j=null}),a.downloadFile=i}]}}]),b.module("convoApp").factory("chatAdvancedSearchManager",["ServerComm","$q","chatManager","filteredChatInfo","userInfo","loginResponseData","accountInfo",function(a,b,c,d,e,f,g){function h(c,h,i,j,k){k||(k=10);var l=h?h.trim():null,m=!1;l&&l.length&&(m=!0),c&&c.length&&(m=!0);var n=b.defer();if(m){var o={authToken:f.getXmppSessionToken(),userID:e.user_id,accountID:g.getAccountId(),search_term:l,participants:c,possible_participants:i,request_id:j,count:k};a.post("chat/fetchSuggestions",o).then(function(a,b){200===a.status&&n.resolve({suggestions:d.getSuggestedChats(a.data.suggested),requestId:a.data.request_id})},function(a){n.reject(a)})}else n.resolve({suggestions:[],match:null});return n.promise}function i(c,h){if(c&&c.length){var i=b.defer(),j={authToken:f.getXmppSessionToken(),userID:e.user_id,accountID:g.getAccountId(),participants:c,request_id:h};return a.post("chat/fetchForParticipants",j).then(function(a,b){200===a.status&&i.resolve({match:d.getSuggestedChat(a.data.matched),requestId:a.data.request_id})},function(a){i.reject(a)}),i.promise}}function j(c,h,i){var j=h===p,k=[];if(j){if(l==i)return m.resolve(o),m.promise;n&&(k=n)}if(l=i,p=h,c){for(var r=0;r<c.length;r++)k.push(c[r].userId);n=k}var s={authToken:f.getXmppSessionToken(),userID:e.user_id,accountID:g.getAccountId(),searchTerm:h,participants:k,from:i,count:20};return m=b.defer(),a.post("chat/fetchChatByKeyword",s).then(function(a,b){200===a.status&&a.config.data.searchTerm===p&&(q.canFetchMoreChats=a.data.can_fetch_further,m.resolve({chats:d.getFilteredChats(p,a.data.chat_messages),searchTerm:a.config.data.searchTerm}))}),m.promise}function k(){p="",l=-1,n=null,m&&m.reject()}var l,m=b.defer(),n=[],o=[],p="",q={};return q.fetchChats=j,q.clearData=k,q.fetchChatSuggestions=h,q.fetchMatchingChat=i,q}]),b.module("convoApp").factory("chatService",["userInfo",function(a){function b(a,b,c,d,e,f,g){o=a,p=b,q=c,r=d,s=e,t=f,u=g}function c(){o=null,p=null,q=null,r=null,s=null,t=null,u=null}function d(a,b){o(a,b)}function e(a,b){p(a,b)}function f(a,b){q(a,b)}function h(a,b,c,d,e){r(a,b,c,d,e)}function i(a,b,c,d,e,f){s(a,b,c,d,e,f)}function j(a){t(a)}function k(b){return a.isAdminMode()&&!b.isThisUserIsInParticipants()}function l(b){return a.isAdminMode()&&!b.isThisUserIsInParticipants()&&b.chatType==g.chatsdk.ChatType.P2P}function m(){return a.isAdminMode()}function n(a,b){u(a,b)}var o,p,q,r,s,t,u;return{init:b,destroy:c,openChatWithUser:d,focusChatOnMessageReceivedClicked:e,openChatWithUserId:f,openChatFromId:h,openSearchedChat:i,searchResults:j,isAdminModeONAndThisUserIsNotInChatParticipants:k,isAdminModeON:m,isAdminModeONAndThisUserIsNotInChatParticipantsAndIsP2PChat:l,openChatWithEmail:n}}]),b.module("convoApp").directive("cnvChatSettingsPanel",["settingsService","chatManager","chatUsersManager","ServerComm","$q",function(a,c,d,e,f){return{link:function(b,c,d){var e;$(".chkNotification").click(function(){$(this).find(".btn").toggleClass("active"),$(this).find(".btn-primary").size()>0&&$(this).find(".btn").toggleClass("btn-primary"),$(this).find(".btn").toggleClass("btn-default-transparent-font"),0==b.curNoti?(b.curNoti=1,e=a.bitON(b.notify_incoming_chats,a.DESKTOP),a.saveSettingByName(a.GENERAL_SETTING___NOTIFY_INCOMING_CHATS,e),b.notify_incoming_chats=e):1==b.curNoti&&(b.curNoti=0,e=a.bitOFF(b.notify_incoming_chats,a.DESKTOP),a.saveSettingByName(a.GENERAL_SETTING___NOTIFY_INCOMING_CHATS,e),b.notify_incoming_chats=e)}),$(".chkSound").click(function(){$(this).find(".btn").toggleClass("active"),$(this).find(".btn-primary").size()>0&&$(this).find(".btn").toggleClass("btn-primary"),$(this).find(".btn").toggleClass("btn-default-transparent-font"),0==b.curSound?(b.curSound=1,a.saveSettingByName(a.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND,28)):1==b.curSound&&(b.curSound=0,a.saveSettingByName(a.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND,0))})},controller:["$scope","$element",function(c,f){function h(a){return e.post("user",a).then(function(c){return m?b.extend(m,a):m=c.data,m})}function i(){var a={};return a[l.METHOD]="getUserStatus",h(a)}c.curStatus="Available",c.sortStatus="Recent Activity";var j=!1,k=!1;c.initialized=!1;var l={};l.METHOD="method",l.NEW_STATUS="user_status";var m;i().then(function(a){1==a.data.data?(d.setThisUserCustomStatus(g.chatsdk.UserStatus.AVAILABLE),c.curStatus="Available",c.statusInt=1,c.$emit("presenceChanged")):2==a.data.data&&(d.setThisUserCustomStatus(g.chatsdk.UserStatus.BUSY),c.curStatus="Busy",c.statusInt=2,c.$emit("presenceChanged")),j=!0,j&&k&&(c.initialized=!0),c.runRenderOnScope(c)}),c.$on("updateSettingsStatus",function(a,b){1==b?(d.setThisUserCustomStatus(g.chatsdk.UserStatus.AVAILABLE),c.curStatus="Available",c.statusInt=1):2==b&&(d.setThisUserCustomStatus(g.chatsdk.UserStatus.BUSY),c.curStatus="Busy",c.statusInt=2),c.runRenderOnScope(c)}),a.getChatSettings(!0).then(function(b){b.notify_incoming_chats&&(a.isBitONOFF(parseInt(b.notify_incoming_chats),a.DESKTOP)?c.curNoti=1:($(".chkNotification").trigger("click"),c.curNoti=0),c.notify_incoming_chats=parseInt(b.notify_incoming_chats)),b.play_sound_on_notification&&(a.isBitONOFF(parseInt(b.play_sound_on_notification),a.DESKTOP)?c.curSound=1:($(".chkSound").trigger("click"),c.curSound=0),c.play_sound_on_notification=parseInt(b.play_sound_on_notification)),"RECENT_ACTIVITY"==b.sort_chat_list_by?(c.sortStatus="Recent Activity",c.$emit("chatSortStatus",c.sortStatus)):(c.sortStatus="Availability",c.$emit("chatSortStatus",c.sortStatus)),k=!0,j&&k&&(c.initialized=!0),c.runRenderOnScope(c)}),c.runRenderOnScope(c)}]}}]),b.module("convoApp").directive("cnvChatUserList",["chatUsersManager","chatManager","settingsService","ServerComm","alertsService","Users","bannerService","$compile","userInfo","mixpanelService","Contacts","utils","Users","chatAdvancedSearchManager","chatService","Feed","appsInfo",function(d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u){return{link:function(f,i,j){function l(a){f.$broadcast("render")}function o(a){f.$broadcast("render")}function v(a){f.$broadcast("render")}function w(a){f.$broadcast("render")}function x(a){f.$broadcast("render_date")}function y(a){i.find("#chatsListScroller").scrollTop(0)}function z(a){return h.post("user",a).then(function(c){return M?b.extend(M,a):M=c.data,M})}function A(){var a={};return a[L.METHOD]="getUserStatus",z(a)}function B(a){f.shouldShowSpinner(!1),K&&clearTimeout(K),K=setTimeout(function(){f.showInviteTeamMateLink=!1,O(a);var b=i.find("#chatsListScroller");b.scrollTop(0)},100)}function C(){""==$(this).val()?f.isFilteredView&&(G(),f.populateChatList(),f.populateUserList(),f.populateContactsList(),f.showContactListIfChatsLessThanShowLimit(!0),f.runDigestOnScope(!0,f),i.find("#chatsListScroller").scrollTop(0)):i.find("#chatsListScroller").scrollTop(0),f.usersAlreadyLoadedInRecentView=!1,f.runDigestOnScope(!0,f)}function D(){}function E(a){for(var b=0;a&&b<a.length;b++){var c=a[b];if(c.chatType!==g.chatsdk.ChatType.GROUP||c.message_match)c.message_match&&I.push(c);else{for(var d=!1,h=0;h<H.length;h++)if(H[h].showGroupChatsBanner=!1,c.chatId==H[h].chatId){d=!0;break}if(!d){var i=e.getChat(c.chatId);i?H.push(i):H.push(c)}}}H.length&&(H.sort(function(a,b){return a.lastMessageTimestamp<b.lastMessageTimestamp?1:a.lastMessageTimestamp>b.lastMessageTimestamp?-1:0}),H[0].showGroupChatsBanner=!0),f.chatList=f.users.concat(H).concat(I)}function F(a,b,c,e){N&&clearTimeout(N),N=setTimeout(function(){r.fetchChats(f.users,b,c,e).then(function(a){if(f.shouldShowSpinner(!1),f.searchKeyWord&&0!==f.searchKeyWord.length&&f.searchKeyWord==a.searchTerm){if(a.chats&&(J+=a.chats.length,E(a.chats),f.usersCount=f.chatList.length,f.showingList=f.usersCount,f.isFilteredView=!0),!r.canFetchMoreChats){var b=d.getFilteredContactList(f.searchKeyWord);b&&(f.populateContactsList(b),f.showContactListIfChatsLessThanShowLimit(!0))}f.runDigestOnScope(!0,f)}})},300)}function G(){K&&(clearTimeout(K),K=null),H=[],I=[],J=0,f.userSelectedIndex=-1,f.contactSelectedIndex=-1,f.isFilteredView=!1}f.showInviteTeamMateLink=!1,f.showingList=20,f.showContactListLength=0,f.showContactsList=!1,f.usersAlreadyLoadedInRecentView=!1,f.isFilteredContacts=!1,f.isFilteredView=!1;var H,I,J,K=null;e.addListener(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,v),e.addListener(g.chatsdk.ChatEvents.COMPOSING_STARTED,l),e.addListener(g.chatsdk.ChatEvents.COMPOSING_ENDED,o),e.addListener(g.chatsdk.ChatEvents.CHAT_CLOSED,w),d.addListener(g.chatsdk.ChatEvents.LAST_ACTIVE_TIME_UPDATED,x),f.containerScrolled=function(a,b){if(b){var c=!0;if(f.isFilteredView&&r.canFetchMoreChats)c=!1,f.showingList<f.users.length?(f.showingList+=20,f.runRenderOnScope(f)):(f.shouldShowSpinner(!0),F(null,f.searchKeyWord,J,!0));else if(!f.isFilteredView||r.canFetchMoreChats||f.isFilteredContacts){if(!f.isFilteredView&&!f.showContactsList)if(c=!1,f.showingList==f.chatList.length)e.loadOlderChats()?f.shouldShowSpinner(!0):f.usersAlreadyLoadedInRecentView?c=!0:e.canLoadOlderChats()||(f.shouldShowSpinner(!0),f.usersAlreadyLoadedInRecentView=!0,f.populateUserList(),c=!0),f.scrollPos=a;else{var d=0;d=f.chatList.length,d>f.showingList+20?(f.showingList+=20,f.showInviteTeamMateLink=!1):(f.showingList=d,f.showInviteTeamMateLink=!0,c=f.isFilteredView)}}else c=!1;c&&(!f.showContactsList&&f.contactList.length>0&&(f.showContactsList=!0,f.showContactListLength=0),f.showContactsList&&(f.showContactListLength+20<f.contactList.length?(f.showContactListLength+=20,f.showInviteTeamMateLink=!1,f.shouldShowSpinner(!0)):(f.showContactListLength=f.contactList.length,f.showInviteTeamMateLink=!0,f.shouldShowSpinner(!1)))),f.runDigestOnScope(!0,f)}else if(0==a){if(f.isFilteredView)return;f.chatList.length>60&&(f.showingList=60,f.showInviteTeamMateLink=!1,f.showContactsList=!1,f.showContactListLength=0,f.runRenderOnScope(f)),f.scrollPos=0}},m.on("userInfo.adminModeChanged",y);var L={};L.METHOD="method",L.NEW_STATUS="user_status";var M;A().then(function(a){1==a.data.data?d.setThisUserCustomStatus(g.chatsdk.UserStatus.AVAILABLE):2==a.data.data&&d.setThisUserCustomStatus(g.chatsdk.UserStatus.BUSY)}),f.openChatWindow=function(b,c,d){if(b.metaKey||b.ctrlKey){var g=u.getFullViewChatAppUrl(c.chatId);return void a.open(g,"_blank")}if(!d||!c.isInvitedUser()){f.searchKeyWord="",f.isSearchView&&n.trackEvent(n.SEARCH_FOR_CHATS,{From:"Chats List"}),n.trackEvent(n.TAP_ON_CHAT);var h;c.chatId?h=c:(h=d?e.startChatWithUser(c,!0):e.startChatWithUser(c),h._user=c);var j=$(".inputSearchBar");if(""!=j.val()){j.val(""),j.blur();var k=i.find("#chatsListScroller");k.scrollTop(0)}h.isFetchedChat?h.message_match?(t.fetchChat(h.chatId,h.searchText).then(function(a){s.searchResults(a.data)}),s.openSearchedChat(h.chatId,h.chatType,h.searchText,{seq_no:h.sequenceNumber,msg_id:h.messageId},[],!0)):s.openChatFromId(h.chatId,h.chatType,null,[],!0):f.$emit("openChatWindow",h,{isOpenedOnUserAction:!0}),b.stopImmediatePropagation(),b.preventDefault()}},f.shouldShowSpinner=function(a,b){a?(f.chatUserListSpinner=!0,f.showInviteTeamMateLink=!1,b||setTimeout(function(){var a=i.find("#chatsListScroller");a.scrollTop(a.scrollTop()+30)},1)):f.chatUserListSpinner=!1},f.$on("openNewChatWindow",function(){f.searchKeyWord="";var a;f.userSelectedIndex>=0&&f.chatList[f.userSelectedIndex]&&f.chatList[f.userSelectedIndex].chatId?a=f.chatList[f.userSelectedIndex]:f.userSelectedIndex>=0&&f.chatList[f.userSelectedIndex]?(a=e.startChatWithUser(f.chatList[f.userSelectedIndex]),a._user=f.chatList[f.userSelectedIndex]):f.contactSelectedIndex>=0&&f.contactList[f.contactSelectedIndex]&&(a=e.startChatWithUser(f.contactList[f.contactSelectedIndex].contact,!0),a._user=f.contactList[f.contactSelectedIndex].contact);var b=$(".inputSearchBar");""!=b.val()&&(b.val(""),b.blur(),i.find("#chatsListScroller").scrollTop(0)),a&&a.isFetchedChat?a.message_match?(t.fetchChat(a.chatId,a.searchText).then(function(a){s.searchResults(a.data)}),s.openSearchedChat(a.chatId,a.chatType,a.searchText,{seq_no:a.sequenceNumber,msg_id:a.messageId},[],!0)):s.openChatFromId(a.chatId,a.chatType,null,[],!0):a&&f.$emit("openChatWindow",a,{isOpenedOnUserAction:!0})}),f.mouseOnItem=function(a){f.isFilteredView&&(f.userSelectedIndex=$(a).index(),f.runRenderOnScope(f))},f.mouseOnContactItem=function(a){f.isFilteredView&&(f.contactSelectedIndex=$(a).index()-1,f.runRenderOnScope(f))},$(".inputSearchBar").on("input",B).on("blur",C).on("focus",D);var N,O=function(a){f.usersAlreadyLoadedInRecentView=!1,f.contactSelectedIndex=-1,f.userSelectedIndex=-1;var b=$(a.target).val();0===b.indexOf("@")&&(b=b.slice(1)),f.searchKeyWord=b,b.length>0?(f.chatList=[],f.isFilteredView=!0,J=0,f.runRenderOnScope(f),H=[],I=[],r.canFetchMoreChats=!0,f.users=d.getFilteredUserList(b,!1,30,!0),f.usersCount=f.users.length,f.chatList=f.users,f.showContactsList=!1,f.showContactListLength=0,f.chatList.length>20?(f.showingList=20,r.clearData()):(F(f.users,b,0),H=e.getChatsSearch(b)||[],H.length&&(H[0].showGroupChatsBanner=!0),f.chatList=f.users.concat(H),f.showingList=f.chatList.length,f.usersCount<6&&f.shouldShowSpinner(!0,!0)),f.userSelectedIndex=0,f.runDigestOnScope(!0,f),i.find("#chatsListScroller").scrollTop(0)):(G(),f.showingList=0,f.scrollPos=0,f.populateChatList(),f.populateUserList(),f.populateContactsList(),f.contactList.length>0&&0===f.chatList.length&&(f.contactSelectedIndex=0),f.showContactListIfChatsLessThanShowLimit(!0),f.runDigestOnScope(!0,f))};f.inviteContact=function(a,b){f.contactList[b].contact.isInvitedUser()||(a.preventDefault(),a.stopPropagation(),f.contactList[b].contact.updateContactStatusAsInvited(),f.runRenderOnScope(f),q.inviteUsersToNetwork([f.contactList[b].contact.email],c,c,c,"Chat").then(function(a){a.data.type&&a.data.data.users_not_invited.length>0&&(k.showBanner(a.data.data.users_not_invited[0].error_message,!1,!1),f.contactList[b].contact.updateContactStatusAsNotInvited(),f.runRenderOnScope(f))}))},f.onChatUserListScopeDestroy=function(){m.off("userInfo.adminModeChanged",y),$(".inputSearchBar").off("input",B).off("blur",C).off("focus",D),e.removeListener(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,v),e.removeListener(g.chatsdk.ChatEvents.COMPOSING_STARTED,l),e.removeListener(g.chatsdk.ChatEvents.COMPOSING_ENDED,o),e.removeListener(g.chatsdk.ChatEvents.CHAT_CLOSED,w),d.removeListener(g.chatsdk.ChatEvents.LAST_ACTIVE_TIME_UPDATED,x)},setTimeout(function(){var b=p.isChrome()||p.isSafari();if(!b){var c=a.outerWidth,d=a.innerWidth,e=c-d;e&&$("#chatsView").css({"margin-right":-e+"px"})}},1)},controller:["$scope","$element",function(a,b){function c(){a.isThisUserGuestUser=m.isGuestUser()}function f(b){if(a.users=b.users,q=!0,a.isUserManagerConnected=!0,e.isConnected()||e.getChats().length){var c=!1;a.chatList&&a.chatList.length>0&&a.showingList===a.chatList.length&&(c=!0),console.log(">>>feed_chat:userManagerConnected: updating chats<<<"),a.populateChatList(),a.populateUserList(c),a.showContactListIfChatsLessThanShowLimit(),a.runDigestOnScope(!0,a),a.openedCachedChats||(a.$emit("openCachedChats"),a.openedCachedChats=!0)}else e.isConnected()||console.log(">>>feed_chat:userManagerConnected: chat manager is not connected<<<");
a.$emit("userManagerConnected")}function h(b){a.populateContactsList(),a.isUserManagerConnected&&(a.isChatManagerConnected||e.getChats().length)&&a.showContactListIfChatsLessThanShowLimit(),a.runDigestOnScope(!0,a)}function i(b){a.isChatManagerConnected=!0,console.log(">>>feed_chat:chatsRefreshed"),q?(console.log(">>>feed_chat:chatsRefreshed:populating chats<<<"),a.populateChatList(),a.populateUserList(),a.showContactListIfChatsLessThanShowLimit(),a.runDigestOnScope(!0,a),a.openedCachedChats||(a.$emit("openCachedChats"),a.openedCachedChats=!0)):console.log(">>>feed_chat:chatsRefreshed:can't populate chats, userManager is not connected<<<")}function j(b){a.isChatManagerConnected=!0,console.log(">>>feed_chat:chatsCacheRefreshed"),q&&!a.chatList.length?(console.log(">>>feed_chat:chatsCacheRefreshed:populating chats<<<"),a.populateChatList(),a.populateUserList(),a.showContactListIfChatsLessThanShowLimit(),a.runDigestOnScope(!0,a),a.openedCachedChats||(a.$emit("openCachedChats"),a.openedCachedChats=!0)):q||console.log(">>>feed_chat:chatsRefreshed:can't populate chats, userManager is not connected<<<")}function k(b){q&&(a.populateChatList(),a.populateUserList()),a.$broadcast("render_date"),a.runDigestOnScope(!0,a)}function l(b){a.users=d.getUsers(),a.runRenderOnScope(a),a.$emit("presenceChanged",b.users,b.status)}function n(b){0!=a.scrollPos&&(a.populateChatList(),1!==b.chats.length&&b.chats.length||a.populateUserList(),a.runDigestOnScope(!0,a))}a.contactList=[],a.isSafariBrowser=p.isSafari();var q;a.isThisUserGuestUser=m.isGuestUser(),a.chatUsersManager=d,a.isUserManagerConnected=!1,a.isChatManagerConnected=!1,m.on("userInfo.userRoleUpdated",c),a.showContactListIfUsersLessThanShowLimit=function(b){b&&(a.showContactListLength=0,a.showContactsList=!1),(!a.users||a.users.length<20)&&a.contactList&&a.contactList.length>0?(a.showContactsList=!0,a.showContactListLength<20&&a.contactList.length>20?a.showContactListLength=20:a.contactList.length<=20&&(a.showContactListLength=a.contactList.length)):0===a.contactList.length&&(a.showContactListLength=0,a.showContactsList=!1),a.runDigestOnScope(!0,a)},a.showContactListIfChatsLessThanShowLimit=function(b){b&&(a.showContactListLength=0,a.showContactsList=!1),(!a.chatList||a.chatList.length<20)&&a.contactList&&a.contactList.length>0?(a.showContactsList=!0,a.showContactListLength<20&&a.contactList.length>20?a.showContactListLength=20:a.contactList.length<=20&&(a.showContactListLength=a.contactList.length)):0===a.contactList.length&&(a.showContactListLength=0,a.showContactsList=!1)},a.populateChatList=function(){if(!a.isFilteredView&&q&&(e.isConnected()||e.getChats().length)){for(var b,c=e.getChats(),f=0;f<c.length;f++)b=c[f],b.chatType!=g.chatsdk.ChatType.P2P||c[f]._user?b.chatType==g.chatsdk.ChatType.GROUP:b._user=d.getUser(b.getOtherParticipant(b.thisUser.userId).userId);a.chatList=c,a.usersCount=a.chatList.length,a.showingList?a.chatList.length>a.showingList+20?a.showingList+=20:a.showingList=a.chatList.length:a.chatList.length>20?a.showingList=20:a.showingList=a.chatList.length,a.shouldShowSpinner&&a.shouldShowSpinner(!1)}},a.populateUserList=function(b){if(q&&(e.isConnected()||e.getChats().length)&&!e.canLoadOlderChats()){a.users=d.getUsers();var c=e.chatsForFilteredUsers(a.users);a.chatList=c.chats.concat(c.users),a.usersCount=a.chatList.length,a.chatList?b?a.showingList=c.chats.length+c.users.length:a.showingList?a.showingList+20<a.chatList.length?(a.showingList+=20,a.showInviteTeamMateLink=!1):(a.showingList=a.chatList.length,a.showInviteTeamMateLink=!0):(a.chatList.length>a.showingList+20?(a.showingList+=20,a.showInviteTeamMateLink=!1):a.showingList=a.chatList.length,a.showingList>0&&(a.showInviteTeamMateLink=!0)):a.showInviteTeamMateLink=!0,a.shouldShowSpinner&&a.shouldShowSpinner(!1)}},a.populateContactsList=function(b){var c;b?(a.isFilteredContacts=!0,c=b):(a.isFilteredContacts=!1,c=d.getContacts()),a.contactList=[];for(var e=0;e<c.length;e++)a.contactList.push({contact:c[e],classes:"user contact-as-user "+p.getRandomSmiley()+" as-bg "})},a.getIdForTrackBy=function(a){return a.chatId?a.chatId:a.userId},a.openInviteTeammatesModal=function(){o.initContactsInviteModal({include_off_domain:!1,origin:"Chat_List",invite_via:"Invite_Dialog"})};var r=function(b){a.runRenderOnScope(a),a.$broadcast("chatUpdated",b.chat.chatId)};e.addListener(g.chatsdk.ChatEvents.CHATS_REFRESHED,i),e.addListener(g.chatsdk.ChatEvents.CHATS_CACHE_REFRESHED,j),e.addListener([g.chatsdk.ChatEvents.CHAT_ADDED,g.chatsdk.ChatEvents.CHAT_MOVED],k),d.addListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,l),e.addListener(g.chatsdk.ChatEvents.CHATS_ADDED,n),e.addListener(g.chatsdk.ChatEvents.CHAT_UPDATED,r),d.isConnected()&&setTimeout(function(){f({users:d.getUsers()}),h()},1),d.addListener(g.chatsdk.ChatEvents.CONNECTED,f),d.addListener(g.chatsdk.ChatEvents.CONTACTS_CONNECTED,h),a.$on("$destroy",function(){d.removeListener(g.chatsdk.ChatEvents.CONNECTED,f),d.removeListener(g.chatsdk.ChatEvents.CONTACTS_CONNECTED,h),e.removeListener(g.chatsdk.ChatEvents.CHATS_REFRESHED,i),e.removeListener(g.chatsdk.ChatEvents.CHATS_CACHE_REFRESHED,j),e.removeListener([g.chatsdk.ChatEvents.CHAT_ADDED,g.chatsdk.ChatEvents.CHAT_MOVED],k),d.removeListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,l),e.removeListener(g.chatsdk.ChatEvents.CHATS_ADDED,n),e.removeListener(g.chatsdk.ChatEvents.CHAT_UPDATED,r),m.off("userInfo.userRoleUpdated",c),a.onChatUserListScopeDestroy()})}]}}]),b.module("convoApp").directive("cnvChatUsersWindow",["settingsService","mixpanelService","userInfo","loader","onboardingService","config","chatManager","loginResponseData","datetimeService","$rootScope","$filter","NewChatWindowDataManager","appsInfo",function(b,c,d,e,f,h,i,j,k,l,m,n,o){return{restrict:"E",scope:!0,templateUrl:"chat/client/chatUsersWindow/templates/cnvChatUsersWindow.tpl.html",link:function(a,b,e){function f(){}function j(){}function k(c){if(p||(p=b.find(".chatUserListHeader")),a.listWindInFocus&&!a.isMinimized){if(v)return void a.blink(0);p.removeClass("unfocused-state"),p.removeClass("unread-state");var d=i.getChats()[0];d&&(t=d.chatId,s=d.unreadCount),u=a.chatsUnreadCount}else if(a.chatsUnreadCount>0){c&&(w="",a.blink(7,800));var d=i.getChats()[0];u<a.chatsUnreadCount||d&&d.chatId!=t||d&&s<d.unreadCount?(p.addClass("unread-state"),p.removeClass("unfocused-state")):(p.removeClass("unread-state"),p.addClass("unfocused-state"))}else{if(v)return void a.blink(0);a.userSelectedIndex=-1,u=0,p.removeClass("unread-state"),p.addClass("unfocused-state")}}function l(b){k(a.chatsUnreadCount>x),x=a.chatsUnreadCount,a.runRenderOnScope(a)}function o(a){var b=h.IS_NATIVE?"Desktop":"Web",d=b+" Small Chat";c.trackEvent(a,{Via:d})}var p=b.find(".chatUserListHeader"),q="#025b7e",r="#389dcc";a.user_window_leak_finder=new f,b[0].user_window_elememt_leak_finder=new j,a.setWindFocus=function(b){a.listWindInFocus=b,k()};var s,t,u,v,w;a.blink=function(b,c){v&&(clearTimeout(v),v=null),b>0?(w=w!=r?r:q,p.css("background-color",w),p.css("color","#fff"),v=setTimeout(function(){a.blink(--b,c)},c)):(w="",p.css("background-color",w),p.css("color",w),k())},k(!0);var x=0;a.removeText=function(b){if(27==b.which)a.userSelectedIndex=-1,a.contactSelectedIndex=-1,y.val("").blur();else if(38==b.which){var d=-1;if(b.preventDefault(),a.contactSelectedIndex>=0?(a.contactSelectedIndex--,d=a.userSelectedIndex>0?a.userSelectedIndex+a.contactSelectedIndex+1:a.contactSelectedIndex):(a.contactSelectedIndex=-1,a.userSelectedIndex>0?(a.userSelectedIndex--,d=a.userSelectedIndex):a.userSelectedIndex=0),d>=0){d=61*d;var e=$("#chatUserList").find("#chatsListScroller"),f=e.scrollTop(),g=e.height();if(f>d)e.scrollTop(d);else if(d>f+(g-61)){var h=d-(g-61);e.scrollTop(h)}}a.runRenderOnScope(a)}else if(40==b.which){b.preventDefault();var d=-1;if(a.usersCount>0&&a.usersCount-1>a.userSelectedIndex?(a.userSelectedIndex++,d=a.userSelectedIndex):(0===a.usersCount||a.usersCount-1===a.userSelectedIndex)&&a.contactList.length-1>a.contactSelectedIndex&&(a.contactSelectedIndex++,d=a.userSelectedIndex+a.contactSelectedIndex+1),d>=0){d=61*d;var e=$("#chatUserList").find("#chatsListScroller"),f=e.scrollTop(),g=e.height();if(f>d)e.scrollTop(d);else if(d>f+(g-61)){var h=d-(g-61);e.scrollTop(h)}}a.runRenderOnScope(a)}else 13==b.which&&(a.$broadcast("openNewChatWindow"),a.userSelectedIndex=-1,a.contactSelectedIndex=-1,b.stopImmediatePropagation(),b.preventDefault(),c.trackEvent(c.SEARCH_FOR_CHATS,{From:"Chats List"}),c.trackEvent(c.TAP_ON_CHAT))};var y=$(".inputSearchBar"),z=function(b){""==y.val()?a.isSearchView=!1:a.isSearchView=!0},A=function(){setTimeout(function(){y&&""==y.val()&&(a.isSearchView=!1,a.runRenderOnScope(a)),a.setWindFocus(!1)},100)},B=function(b){a.setWindFocus(!0)};a.getChatImageThumbnailPath=function(a){return m("getChatImageThumbnailPath")(a.chatId,"",a.getIconVersion())},a.createNewChat=function(){d.isAdminMode()||(n.createNewChat(),o(c.CLICK_GROUP_CHAT_BUTTON))},y.on("input",z),y.on("blur",A),y.on("focus",B),i.addListener(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,l),a.$on("$destroy",function(){y.off("input",z),y.off("focus",B),y.off("blur",A),a.chatsUnreadCount=null,y=null,p=null,i.removeListener(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,l)}),a.isInitializing=!1},controller:["$scope","$element",function(c,d){function e(){f.on("cnvOnboarding:feedOnboardingStateChange",k),m()}function k(){m()}function m(){0!==$("body > #intercom-container").length&&(f.getFeedOnboardingState()?($("#intercom-io-btn").css("visibility","hidden"),$("body > #intercom-container").hide()):($("#intercom-io-btn").css("visibility","visible"),$("body > #intercom-container").show()),p())}function p(){c.mainChatsListProperties&&(c.mainChatsListProperties.listWinHeight=c.verticalHeight,c.isMinimized?($("#intercom-io-btn").css({bottom:"38px",transition:"bottom 0.25s"}),$(".chatHeadBubble").css({bottom:"38px",transition:"bottom 0.25s"})):($("#intercom-io-btn").css({bottom:c.verticalHeight+10+"px",transition:"bottom 0.25s"}),$(".chatHeadBubble").css({bottom:c.verticalHeight+10+"px",transition:"bottom 0.25s"})))}function q(a){a="RECENT_ACTIVITY"===a?"Recent Activity":"Availability",c.$broadcast("listStatus",a)}function r(a){c.chatsUnreadCount=a.unreadCount,c.runRenderOnScope(c)}function s(a){if(!c.isChatListAlreadyOpenedOnFirstSignup&&c.isAlreadyPassedThroughOnBoardingEvents){var b=i.getChats()[0];!f.getFeedOnboardingState()&&j.get().onboarding_state.first_login&&b&&b.unreadCount>0&&(c.$broadcast("maxChatList",0),c.isChatListAlreadyOpenedOnFirstSignup=!0)}}function t(){if(!c.isChatListAlreadyOpenedOnFirstSignup){c.isAlreadyPassedThroughOnBoardingEvents=!0;var a=i.getChats()[0];!f.getFeedOnboardingState()&&j.get().onboarding_state.first_login&&a&&a.unreadCount>0&&(c.$broadcast("maxChatList",0),c.isChatListAlreadyOpenedOnFirstSignup=!0)}}function u(){if(!c.isChatListAlreadyOpenedOnFirstSignup){c.isAlreadyPassedThroughOnBoardingEvents=!0;var a=i.getChats()[0];j.get().onboarding_state.first_login&&a&&a.unreadCount>0&&(c.$broadcast("maxChatList",0),c.isChatListAlreadyOpenedOnFirstSignup=!0)}}function v(){c.newChatData=n.getNewChatData(),c.runRenderOnScope(c)}function w(){c.newChatData=null,c.runRenderOnScope(c)}c.userSelectedIndex=-1,c.contactSelectedIndex=-1,c.intercomIOBtnHref="mailto:"+h.INTERCOM_IO_APP_ID+"@incoming.intercom.io",c.chatsUnreadCount=i.getUnreadChatsCount(),c.searchKeyWord="",c.isChatListAlreadyOpenedOnFirstSignup=!1,c.isAlreadyPassedThroughOnBoardingEvents=!1,c.fromChatWhichComponent="cnvChatUsersWindow",c.isNewChatCounter=!1,c.isInitializing=!0,c.newChatData=n.getNewChatData(),c.fullChatViewUrl=o.getFullViewChatAppUrl(),c.fullChatViewTarget=h.IS_NATIVE?"":"_blank";c.removeNewChat=function(a){a.stopPropagation(),a.stopImmediatePropagation(),n.removeNewChat()},m();var x=l.$on("intercomIO:loaded",e);c.$on("chatWindowResize",p),c.$on("adjustWindPosOnMin",function(a,b){p(),c.runRenderOnScope(c)}),c.closeTeammatesView=function(a){c.userSelectedIndex=-1,c.contactSelectedIndex=-1,c.searchKeyWord="",$(".inputSearchBar").val("").blur(),c.runRenderOnScope(c)},c.$on("chatSortStatus",function(a,b){}),c.runRenderOnScope(c),b.on("sortChatListBySettingUpdatedByRemoteUser",q),i.addListener(g.chatsdk.ChatEvents.CHATS_UNREAD_COUNT_CHANGED,r),i.addListener(g.chatsdk.ChatEvents.CHATS_REFRESHED,s),f.on("cnvOnboarding:feedOnboardingStateChange",t),f.on("cnvOnboarding:cnvPilotIntroDismissed",u),a.addEventListener("resize",p,!1),n.on("newChatCreated",v),n.on("newChatRemoved",w),c.$on("$destroy",function(){b.off("sortChatListBySettingUpdatedByRemoteUser",q),i.removeListener(g.chatsdk.ChatEvents.CHATS_UNREAD_COUNT_CHANGED,r),i.removeListener(g.chatsdk.ChatEvents.CHATS_REFRESHED,s),f.off("cnvOnboarding:feedOnboardingStateChange",t),f.off("cnvOnboarding:cnvPilotIntroDismissed",u),f.off("cnvOnboarding:feedOnboardingStateChange",k),a.removeEventListener("resize",p,!1),x(),n.off("newChatCreated",v),n.off("newChatRemoved",w)})}]}}]),b.module("convoApp").directive("cnvChatsListWindowHeader",["settingsService","chatManager","chatUsersManager","ServerComm","$q","userInfo",function(a,c,d,e,f,h){return{link:function(a,b,c){},controller:["$scope","$element",function(c,f){function i(){c.curNoti==u?(c.curNoti=v,w=a.bitOFF(c.notify_incoming_chats,a.DESKTOP),a.saveSettingByName(a.GENERAL_SETTING___NOTIFY_INCOMING_CHATS,w),c.notify_incoming_chats=w):c.curNoti==v&&(c.curNoti=u,w=a.bitON(c.notify_incoming_chats,a.DESKTOP),a.saveSettingByName(a.GENERAL_SETTING___NOTIFY_INCOMING_CHATS,w),c.notify_incoming_chats=w),c.resetDropdownOptions()}function j(){c.curSound==u?(c.curSound=v,a.saveSettingByName(a.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND,0)):c.curSound==v&&(c.curSound=u,a.saveSettingByName(a.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND,28)),c.resetDropdownOptions()}function k(){"Busy"==c.curStatus&&(d.setThisUserCustomStatus(g.chatsdk.UserStatus.AVAILABLE),c.curStatus="Available",c.statusInt=1,p(c.statusInt),c.$emit("presenceChanged")),c.resetDropdownOptions(),c.runRenderOnScope(c)}function l(){"Available"==c.curStatus&&(d.setThisUserCustomStatus(g.chatsdk.UserStatus.BUSY),c.curStatus="Busy",c.statusInt=2,p(c.statusInt),c.$emit("presenceChanged")),c.resetDropdownOptions(),c.runRenderOnScope(c)}function m(a){return e.post("user",a).then(function(c){return c=c.data,A?b.extend(A,a):A=c,A})}function n(){var a={};return a[z.METHOD]="getUserStatus",m(a)}function o(a){return e.post("user",a).success(function(c,d){return b.extend(A,a),A})}function p(a){var b={};return b[z.METHOD]="updateUserStatus",b[z.NEW_STATUS]=a,o(b)}function q(){var a=d.getThisUser();a&&(a.presenceStatus==g.chatsdk.UserStatus.AVAILABLE&&1!=c.statusInt?(c.curStatus="Available",c.statusInt=1,c.$emit("presenceChanged"),c.resetDropdownOptions(),c.runRenderOnScope(c)):a.presenceStatus==g.chatsdk.UserStatus.BUSY&&2!=c.statusInt&&(c.curStatus="Busy",c.statusInt=2,c.$emit("presenceChanged"),c.resetDropdownOptions(),c.runRenderOnScope(c)))}function r(a){var b=a.users;if(b)for(var c=d.getThisUser(),e=b.length,f=0;e>f;++f)if(c==b[f]){q();break}}function s(){q()}function t(){a.getChatSettings(!0).then(function(b){c.chatSettingsOptions&&(b.notify_incoming_chats&&(a.isBitONOFF(parseInt(b.notify_incoming_chats),a.DESKTOP)?c.curNoti=u:($(".chkNotification").trigger("click"),c.curNoti=v),c.notify_incoming_chats=parseInt(b.notify_incoming_chats)),b.play_sound_on_notification&&(a.isBitONOFF(parseInt(b.play_sound_on_notification),a.DESKTOP)?c.curSound=u:($(".chkSound").trigger("click"),c.curSound=v),c.play_sound_on_notification=parseInt(b.play_sound_on_notification)),"RECENT_ACTIVITY"==b.sort_chat_list_by?(c.sortStatus="Recent Activity",c.$emit("chatSortStatus",c.sortStatus)):(c.sortStatus="Availability",c.$emit("chatSortStatus",c.sortStatus)),y=!0,x&&y&&(c.initialized=!0),c.resetDropdownOptions(),c.runRenderOnScope(c))})}var u=1,v=0;c.curStatus="Available",c.chatSettingsOptions={},c.chatSettingsOptions.type="noIcon",c.chatSettingsOptions.align="right",c.chatSettingsOptions.containerClass="dropdownLinkContainer",c.chatSettingsOptions.options=[{label:"Available",callback:k},{label:"Busy",callback:l},{isDivider:!0},{label:".",callback:i},{label:".",callback:j}],c.resetDropdownOptions=function(){"Available"==c.curStatus?(c.chatSettingsOptions.options[0].icon="cnv-icons-20 check-lightgray",c.chatSettingsOptions.options[1].icon=null):(c.curStatus="Busy",c.chatSettingsOptions.options[0].icon=null,c.chatSettingsOptions.options[1].icon="cnv-icons-20 check-lightgray"),c.curNoti==v?c.chatSettingsOptions.options[3].label="Turn on notifications":c.chatSettingsOptions.options[3].label="Turn off notifications",c.curSound==v?c.chatSettingsOptions.options[4].label="Turn on sounds":c.chatSettingsOptions.options[4].label="Turn off sounds"};var w,x=!1,y=!1;c.initialized=!1;var z={};z.METHOD="method",z.NEW_STATUS="user_status";var A;n().then(function(a){c.chatSettingsOptions&&(1==a.data.data?(d.setThisUserCustomStatus(g.chatsdk.UserStatus.AVAILABLE),c.curStatus="Available",c.statusInt=1,c.$emit("presenceChanged")):2==a.data.data&&(d.setThisUserCustomStatus(g.chatsdk.UserStatus.BUSY),c.curStatus="Busy",c.statusInt=2,c.$emit("presenceChanged")),x=!0,x&&y&&(c.initialized=!0),c.resetDropdownOptions(),c.runRenderOnScope(c))}),c.$on("updateSettingsStatus",function(a,b){1==b?(d.setThisUserCustomStatus(g.chatsdk.UserStatus.AVAILABLE),c.curStatus="Available",c.statusInt=1):2==b&&(d.setThisUserCustomStatus(g.chatsdk.UserStatus.BUSY),c.curStatus="Busy",c.statusInt=2),c.resetDropdownOptions(),c.runRenderOnScope(c)}),t(),h.on("userDataRevisionNoChanged",t),d.addListener(g.chatsdk.ChatEvents.CONNECTED,s),d.addListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,r),d.isConnected()&&s({users:[d.thisUser]}),c.$on("$destroy",function(){c.chatSettingsOptions&&(c.chatSettingsOptions=null),h.off("userDataRevisionNoChanged",t),d.removeListener(g.chatsdk.ChatEvents.CONNECTED,s),d.removeListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,r)}),c.resetDropdownOptions()}]}}]),b.module("convoApp").directive("cnvGroupChatAvatar",["chatUsersManager","chatManager","userIdToImgUrlFilter","userImgUrlFilter","utils",function(a,b,c,d,e){return{link:function(b,c,d){b.populateChatAvatar=function(){var c=b.$eval(d.participants),e=b.$eval(d.source);if(b.userArr=[],c)for(var f in c)if("Feed"==e){var h=a.getUserById(c[f].published_to);h&&b.userArr.push(h)}else if(c[f].status==g.chatsdk.ParticipantStatus.JOINED||"ACTIVE"==c[f].status){var h=a.getUserById(f);h||(h=a.getInaccessibleUserById(f)),h&&b.userArr.push(h)}b.emptyChatUser=null,b.show2images=!1,b.show3images=!1,b.showCounter=!1,0==b.userArr.length&&(b.emptyChatUser=a.getThisUser()),2==b.userArr.length&&(b.show2images=!0),3==b.userArr.length&&(b.show3images=!0),b.userArr.length>4&&(b.showCounter=!0),setTimeout(function(){b.$broadcast("refreshImage"),b.$broadcast("render")},0),b.$on("$destroy",function(){b.userArr=null,c=null,e=null})},b.populateChatAvatar()},controller:["$scope","$element","$attrs",function(a,b,c){a.$on("chatUpdated",function(b,c){a.chat.chatId==c&&a.populateChatAvatar()})}]}}]),b.module("convoApp").directive("cnvHomeChatViewBlankState",["utils","config",function(a,b){return{restrict:"E",scope:!0,templateUrl:"chat/client/chatUsersWindow/templates/cnvHomeChatViewBlankState.tpl.html",link:function(a,b,c){a.removeTextFromInviteBox=function(){b.find(".invite-contacts-to-field-wrapper tags-input input").trigger("hard-reset")}},controller:["$scope","accountInfo","Contacts","$q","Users","bannerService",function(a,d,e,f,g,h){function i(a){var b=g.inviteUsersToNetwork([a],c,c,c,"Chat");h.showBanner_promise(b,"Inviting...","Invited successfully","Error... could not send invite",!1,!1),j.removeTextFromInviteBox()}var j=a;j.config=b,j.shouldInviteGuestsAsFullMembers=d.shouldInviteGuestsAsFullMembers(),j.inviteTo=[];var k="";j.primaryDomain=d.getPrimaryAccountDomain().user_email_domain,j.shouldInviteGuestsAsFullMembers?j.placeholderText="teammate@domain.com":j.placeholderText="teammate@"+d.getPrimaryAccountDomain().user_email_domain,j.onItemAddedInEmailField=function(a){var b=a.email;j.inviteTo.splice(0,1),i(b)},j.getInviteToDropdownItems=function(a){k=a;var b=f.defer(),c=!j.shouldInviteGuestsAsFullMembers,d=e.query(a,[],5,c,!0,!0);return b.resolve(d),b.promise},j.inviteUser=function(){if(k){var a=e.getSuggestedContactBasedOnQuery(k,!0);a.available&&a.label&&i(a.label)}}}]}}]),b.module("convoApp").controller("chatSeenParticipantsCtrl",["$scope","$modalInstance","seenParticipants","thisUserId",function(a,b,c,d){a.title="Seen by",a.seenParticipants=c,a.thisUserId=d,a.cancel=function(){b.dismiss()}}]),b.module("convoApp").directive("cnvChatWindow",["$compile","$templateCache","chatManager","msgListRenderer","chatUsersManager","utils","UploadService","$filter","appStateInfo","appTabs","mixpanelService","$q","atMentionsListProvider","localStore","$rootScope","Users","chatService","logger","appsInfo","$location","cnvChatsFilesUploadManager","config","ChatConstants","NewChatWindowDataManager","BlackListWordsService",function(b,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){return{restrict:"E",templateUrl:"chat/client/chatWindow/templates/chatWindow.tpl.html",link:function(b,d,o){function p(){}function q(){}function r(a){a&&!Oa?(Oa=!0,Ia.attr("disabled",!0),Ia.css("background","#EBEBE4"),Ia.css("opacity","1"),Ka.attr("disabled",!0),b.setWindFocus(!1),b.textEditorCtrl.disable()):!a&&Oa&&(Oa=!1,Ia.attr("disabled",!1),Ia.css("background","#FFFFFF"),Ka.attr("disabled",!1),b.textEditorCtrl.enable(),setTimeout(function(){b.textEditorCtrl.blur()},0))}function s(){r(b.disabledChat?!0:!1),Ha(!0),b.$broadcast("userInvitedOrLeft")}function t(a){if(Wa||(Wa=d.find(".chatWindowHeader")),b.isChatWindowFocused&&!b.isMinimized){if(Va||(document.removeEventListener("mousedown",u),document.addEventListener("mousedown",u),Va=!0),Xa)return void b.blink(0);Wa.removeClass("unfocused-state"),Wa.removeClass("unread-state")}else if(Va&&(Va=!1,document.removeEventListener("mousedown",u)),b.chatObj.unreadCount>0||b.hasUnread)a&&!b.chatObj.isMuted&&(Ya="",b.blink(7,800)),Wa.removeClass("unfocused-state"),Wa.addClass("unread-state");else{if(Xa)return void b.blink(0);Wa.removeClass("unread-state"),Wa.addClass("unfocused-state")}}function u(a){var c=$(a.target),d=c.closest(".chatWindow").attr("id");d!=b.chatId&&b.setWindFocus(!1)}function w(a){b.chatObj.isNewChat||(a&&!b.isMinimized&&b.chatObj.composingParticipants.length?Y():b.showingcomposing&&Z())}function B(){b.chatMessageListContainer=$(".chatMessageWindow",d),Ia=$(".messageInputBar",d),Ja=$(".chatWindowHeader",d),Ka=$(".attachmentButton",d),setTimeout(function(){var c=i.isChrome()||i.isSafari();if(!c){var d=a.outerWidth,e=a.innerWidth,f=d-e;if(f){var g=30+f-5,h="calc(100% + "+g+"px)";b.chatMessageListContainer.css({width:h})}}},1)}function C(c){var e=$(c.target);e.length>0&&(e[0]===$("div.btnClose",d)[0]||e[0]===$("#iShowGiphyPopup",d)[0])||e[0]===$(".emoji-popup-btn",d)[0]||e.hasClass("headerIcon")||e.hasClass("dropdownLinkContainer")||e.closest(".btnChatOptions").length>0||e.closest(".participantList").length>0||e.closest(".userSearchBar").length>0||(_a&&clearTimeout(_a),_a=setTimeout(function(){!b.textEditorCtrl||e.closest(".participantsList ").length||""!=$.trim(a.getSelection().toString())||b.editChatTitle||($(c.target).closest(b.textEditorCtrl.getContainerElement()).length?b.setWindFocus(!0,null,!0):b.setWindFocus(!0)),b.$emit("videoCallDropdownBlur")},100),t())}function D(a){b.setWindFocus(!0)}function E(){b.fromMin||b.chatMessageListContainer.scrollTop(b.chatMessageListContainer[0].scrollHeight)}function F(){d.on("mouseup",C),d.find(".emoji-popup-btn").on("setFocusOnHideEmojiPopover",D),setTimeout(function(){Ia.on("resize",E)},10)}function G(){return b.chatObj.isNewChat?b.chatObj.chat:b.chatObj}function H(){if(b.disabledChat=!1,b.disableChatSearchControls=!1,b.chatService.isAdminModeON())b.disabledChat=!0,b.$broadcast("changeChatOptions");else{var a=G();a&&(a.participants[a.thisUser.userId].status==g.chatsdk.ParticipantStatus.LEFT&&(b.disabledChat=!0,b.$broadcast("changeChatOptions")),h.getUserById(a.getOtherParticipant().userId)||a.chatType!=g.chatsdk.ChatType.P2P||(b.disabledChat=!0,b.$broadcast("changeChatOptions")))}b.initChatState();var a=G();if(a&&!a._user&&a.chatType==g.chatsdk.ChatType.P2P)for(var c in b.chatObj.participants)a.thisUser.userId!=c&&(a._user=h.getUserById(c));b.$broadcast("refreshImage"),b.$broadcast("userInvitedOrLeft"),b.$broadcast("changeChatOptions"),Ha(!0,!0)}function I(a){Ea();var c=G();if(c&&(c.messages=f.updateChatMessagesOnMessageSentComplete(c,a.message)),a.message.type==g.chatsdk.MessageType.MESSAGE&&a.message.fileInfo&&b.checkIfThereAnyChatGifMsgBubbleInViewAndPlay(),c&&c.chatType===g.chatsdk.ChatType.GROUP&&(a.message.type==g.chatsdk.MessageType.LEFT||a.message.type==g.chatsdk.MessageType.INVITE)){var d=ca();c.messages=f.renderGroupSeen(c,c.messages,c.thisUser.userId,d)}Ha(!0)}function J(a){var c=G();if(c&&0!==_.keys(c.participants).length){Ea();var h=!1,i=b.isChatMessageListScrolledToBottom(),j=c.messages.length,k=a.message;j>0&&!c.messages[0]._view||j>2&&!c.messages[j-2]._view?c.messages=f.renderLast20(c,c.thisUser.userId,c.getOtherParticipant().lastSeenMessageSequenceNumber,!0):c.messages.length>0&&(c.messages=f.msgReceiveOnly(c,c.thisUser.userId)),b.showNewMessageBar=!1,b.chatObj.isNewChat?i&&(b.scrollChatMessageListContainerToBottom(),setTimeout(function(){b.scrollChatMessageListContainerToBottom()},1)):(!b.isMinimized&&b.isChatWindowFocused&&b.appInFoucs?e.messageRead(k,c):!a.message.skipNotification&&c.unreadCount>0&&a.message.type==g.chatsdk.MessageType.MESSAGE&&a.message.senderId!=c.thisUser.userId&&(b.hasUnread=!0),a.message.senderId===c.thisUser.userId&&e.chatRead(c),(a.message.type==g.chatsdk.MessageType.LEFT||a.message.type==g.chatsdk.MessageType.INVITE)&&(b.chatService.isAdminModeON()||a.message.type!=g.chatsdk.MessageType.LEFT||a.message.senderId!=c.thisUser.userId?b.chatService.isAdminModeON()||a.message.type!=g.chatsdk.MessageType.INVITE||c.participants[c.thisUser.userId].status!=g.chatsdk.ParticipantStatus.JOINED||(b.disabledChat=!1,h=!0,b.$broadcast("changeChatOptions")):(b.disabledChat=!0,h=!0,b.$broadcast("changeChatOptions")),b.updateParticipantsList(),Ha(!0),b.$broadcast("userInvitedOrLeft")),a.message.type!=g.chatsdk.MessageType.LEFT&&a.message.senderId!=c.thisUser.userId&&(b.isMinimized?b.showNewMessageBar=!b.scrollToBot:(!i||b.isSearch)&&(b.showNewMessageBar=!0)),a.message.type!=g.chatsdk.MessageType.MESSAGE&&s(),i&&!b.showNewMessageBar?(b.scrollChatMessageListContainerToBottom(),setTimeout(function(){b.scrollChatMessageListContainerToBottom()},1)):b.showNewMessageBar&&a.message.senderId!=b.chatObj.thisUser.userId&&setTimeout(function(){d.find(".newMsgReceived").show()},0),0==h&&1===b.chatObj.messages.length&&b.chatObj.chatType===g.chatsdk.ChatType.GROUP&&b.$broadcast("changeChatOptions"),t(!0)),Ha(!0)}}function K(){var a=G();if(a&&0!==_.keys(a.participants).length){Ea(),!b.chatObj.isNewChat&&Ra&&(b.appInFoucs&&b.isChatWindowFocused||0===a.unreadCount)&&a.messages.length&&e.messageRead(a.messages[a.messages.length-1],a),Ra=!1,b.messageListSpinner=!1;var c=b.chatMessageListContainer,d=0,h=0;if(c&&c.length>0&&(d=c[0].scrollHeight,h=c.scrollTop()),a.messages=f.renderLast20(a,a.thisUser.userId,a.getOtherParticipant().lastSeenMessageSequenceNumber),Ha(!0),c&&c.length>0){var i=c[0].scrollHeight,j=h+(i-d);c.scrollTop(j),setTimeout(function(){var a=c[0].scrollHeight;j=a-d+h,b.chatMessageListContainer.scrollTop(j)},1)}a.chatType===g.chatsdk.ChatType.GROUP&&a.hasMessages()&&b.$broadcast("changeChatOptions")}}function L(a){var c=G();if(c){if(1===c.chatType){c.getOtherParticipant().lastSeenMessageSequenceNumber;c.messages=f.renderP2PSeen(c,c.messages,c.thisUser.userId)}Ha(!0),t();var d=b.chatMessageListContainer;d.scrollTop()+d[0].clientHeight>=d[0].scrollHeight&&b.scrollChatMessageListContainerToBottom()}}function M(a){var b=G();if(b&&0!==_.keys(b.participants).length){if(1===b.type){b.getOtherParticipant().lastSeenMessageSequenceNumber;b.messages=f.renderP2PSeen(b,b.messages,b.thisUser.userId)}else{var c=ca();b.messages=f.renderGroupSeen(b,b.messages,b.thisUser.userId,c)}Ea(),Ha(!0),t()}}function N(){if(!b.chatObj.isNewChat){var a=G();a&&(0==a.unreadCount&&(b.hasUnread=!1,t()),Ha(!0),b.$emit("unReadCountChanged"))}}function O(a){var c=G();if(c&&0!==_.keys(c.participants).length){var h=c.messages;if(!b.isNewChat&&Sa&&(b.appInFoucs&&b.isChatWindowFocused||0===c.unreadCount)&&h.length&&e.messageRead(h[h.length-1],c),Sa=!1,b.messageListSpinner=!1,c.messages=f.renderLast20(c,c.thisUser.userId,c.getOtherParticipant().lastSeenMessageSequenceNumber,!0),d.find(".newMsgReceived").hide(),a.messages[a.messages.length-1].type==g.chatsdk.MessageType.INVITE&&(b.chatService.isAdminModeON()||c.participants[c.thisUser.userId].status!=g.chatsdk.ParticipantStatus.JOINED||(b.disabledChat=!1,optionsUpdated=!0,b.$broadcast("changeChatOptions"),b.$broadcast("userInvitedOrLeft"),s())),Ha(!0),b.winHeight){var i=b.chatMessageListContainer[0].scrollHeight-b.winHeight;b.scrollChatMessageListContainerToBottom(i)}else b.scrollChatMessageListContainerToBottom()}}function P(){var a=b.chatMessageListContainer;b.scrollChatMessageListContainerToBottom(a[0].scrollHeight-(138+a[0].clientHeight)),Ha(!0)}function Q(a){var c=new Image,d=G();d&&a.message.fileInfo.thumbnailName&&(c.src=k("getNoteThumbnailPath")(a.message.fileInfo,d.chatId),c.onload=function(){a.message.fileInfo.file.localUrl=c.src;for(var d=0;d<b.files.length;d++)b.files[d].fileId==a.message.fileInfo.file.fileId&&(b.files[d].localUrl=c.src);Ha(!0,!0),setTimeout(function(){b.howManyInView()},0)})}function R(a){Ha(!0)}function S(){b.$broadcast("changeChatOptions"),m.dispatchTabsEvent2("muteStatusChanged",{tabId:b.tabId,chatId:b.chatId,muted:b.chatObj.isMuted},!0),b.$emit("chatMuteStatusChanged")}function T(a){var c=G();c&&(b.isSearch=!0,b.isSearch&&(c.searchInfo.messages=f.renderLast20(c,c.thisUser.userId,c.getOtherParticipant().lastSeenMessageSequenceNumber,!0,!0)),Ha(!0))}function U(a){var c=G();c&&0!==_.keys(b.chatObj.participants).length&&b.isSearch&&(c.searchInfo.messages=f.renderLast20(c,c.thisUser.userId,c.getOtherParticipant().lastSeenMessageSequenceNumber,!0,!0),b.searchCountStr=c.searchInfo.getCurrentMatchIndex()+1+" of "+c.searchInfo.getMatchCount(),Ha(!0),setTimeout(function(){b.scrollHighlightedSearch()},100))}function V(a){var c=G();c&&0!==_.keys(b.chatObj.participants).length&&b.isSearch&&(c.searchInfo.messages=f.renderLast20(c,c.thisUser.userId,c.getOtherParticipant().lastSeenMessageSequenceNumber,!0,!0),b.searchCountStr=c.searchInfo.getCurrentMatchIndex()+1+" of "+c.searchInfo.getMatchCount(),Ha(!0),setTimeout(function(){b.scrollHighlightedSearch()},100))}function W(a){var c=G();c&&b.isSearch&&(c.searchInfo.messages=f.renderLast20(c,c.thisUser.userId,c.getOtherParticipant().lastSeenMessageSequenceNumber,!0,!0),Ha(!0))}function X(a){b.closeSearch()}function Y(){var a=G();if(a&&a.composingParticipants.length){b.composingUsers=[],b.showingcomposing=!0;for(var c=a.composingParticipants.length>3?3:a.composingParticipants.length,d=a.composingParticipants.length-c,e=d+c,f=d;e>f;f++)h.getUserById(a.composingParticipants[f].userId)?b.composingUsers.push(h.getUserById(a.composingParticipants[f].userId)):h.getInaccessibleUserById(a.composingParticipants[f].userId)&&b.composingUsers.push(h.getInaccessibleUserById(a.composingParticipants[f].userId));var g=b.chatMessageListContainer;Math.ceil(g.scrollTop())+g[0].clientHeight>=g[0].scrollHeight?b.isComposingScroll=!0:b.isComposingScroll=!1,Ha(!0),b.isComposingScroll&&b.scrollChatMessageListContainerToBottom()}}function Z(){var a=G();if(a){if(!b.isMinimized&&m.isThisTabLastActiveTab()){b.composingUsers=[];var c=b.chatMessageListContainer,e=Math.ceil(c.scrollTop()),f=c[0].clientHeight,i=c[0].scrollHeight;if(a.composingParticipants.length){for(var j=a.composingParticipants.length>3?3:a.composingParticipants.length,k=a.composingParticipants.length-j,l=k+j,n=k;l>n;n++)h.getUserById(a.composingParticipants[n].userId)?b.composingUsers.push(h.getUserById(a.composingParticipants[n].userId)):h.getInaccessibleUserById(a.composingParticipants[n].userId)&&b.composingUsers.push(h.getInaccessibleUserById(a.composingParticipants[n].userId));
e+f>=i&&(b.scrollChatMessageListContainerToBottom(i-(46*b.composingUsers.length+f)),b.scrollChatMessageListContainerToBottom())}else e+f>=i&&(b.scrollChatMessageListContainerToBottom(i-(d.find("#composingMessage").height()+f)),b.scrollChatMessageListContainerToBottom()),b.showingcomposing=!1;a.participants[a.thisUser.userId].status!=g.chatsdk.ParticipantStatus.LEFT&&Ha(!0)}if(b.isMinimized&&(b.composingUsers=[],a.composingParticipants.length))for(var j=a.composingParticipants.length>3?3:a.composingParticipants.length,k=a.composingParticipants.length-j,l=k+j,n=k;l>n;n++)h.getUserById(a.composingParticipants[n].userId)?b.composingUsers.push(h.getUserById(a.composingParticipants[n].userId)):h.getInaccessibleUserById(a.composingParticipants[n].userId)&&b.composingUsers.push(h.getInaccessibleUserById(a.composingParticipants[n].userId))}}function aa(a){var c=G();if(c){if(c.chatId==a.chat.chatId){var d=!1;c=b.chatObj=a.chat;var e=c.messages=f.msgSentOnly(a.chat,c.thisUser.userId),h=0;e&&(h=e.length),Ha(!0),e&&a.message.fileInfo&&(e[h-1].fileInfo.file=b.files[b.files.length-1]),(a.message.type==g.chatsdk.MessageType.LEFT||a.message.type==g.chatsdk.MessageType.INVITE)&&(a.message.type==g.chatsdk.MessageType.LEFT&&a.message.senderId==c.thisUser.userId?(b.disabledChat=!0,d=!0,b.$broadcast("changeChatOptions")):b.disabledChat&&(b.disabledChat=!0),s()),0==d&&e&&1===h&&c.chatType===g.chatsdk.ChatType.GROUP&&b.$broadcast("changeChatOptions"),b.isNewChat&&setTimeout(function(){b.scrollChatMessageListContainerToBottom()},1)}Ha(!0)}}function ba(){fa()}function ca(a){var b,c,d=[],e=0,f=G();if(!f)return d;for(var h=f.messages.length-1;h>-1;h--)if(f.messages[h].type===g.chatsdk.MessageType.MESSAGE){e=f.messages[h].getSequenceNumber();break}a=a||f.participants;for(var i in a){var j={userId:a[i].userId,lastSeenMessageSequenceNumber:a[i].lastSeenMessageSequenceNumber};if(b=f.messageForSequenceNumber(a[i].lastSeenMessageSequenceNumber),c=b?b.type:"",a[i].status===g.chatsdk.ParticipantStatus.LEFT||c===g.chatsdk.MessageType.LEFT||c===g.chatsdk.MessageType.INVITE)for(;b&&(j.lastSeenMessageSequenceNumber--,b=f.messageForSequenceNumber(j.lastSeenMessageSequenceNumber),c=b?b.type:"",c!==g.chatsdk.MessageType.MESSAGE););else j.lastSeenMessageSequenceNumber>e&&(j.lastSeenMessageSequenceNumber=e);d.push(j)}return d}function da(a){var c=G();if(c){var d=ca(a.participants);c.messages=f.renderGroupSeen(c,c.messages,c.thisUser.userId,d);var e=b.isChatMessageListScrolledToBottom();Ha(!0),e&&setTimeout(function(){b.scrollChatMessageListContainerToBottom()},1)}}function ea(){Ga()}function fa(){var a=G();if(a){if(a.chatType===g.chatsdk.ChatType.P2P){var c=h.getUserById(a._user.userId);c&&a.getTitle()!==c.getDisplayName()&&(a._user=c,a.setComputedTitle(c.getDisplayName()),Ha(!0))}_.keys(a.participants).length>0&&!b.chatService.isAdminModeON()&&a.chatType===g.chatsdk.ChatType.P2P&&h.getUserById(a.getOtherParticipant().userId)?(b.disabledChat=!1,r(!1),b.$broadcast("changeChatOptions"),Ha(!0,!0)):_.keys(a.participants).length>0&&!b.chatService.isAdminModeON()&&a.chatType===g.chatsdk.ChatType.P2P&&!h.getUserById(a.getOtherParticipant().userId)&&(b.disabledChat=!1,r(!1),b.$broadcast("changeChatOptions"),Ha(!0,!0))}}function ga(a){var c=a.oldChat;c&&ma(c);var d=Ma.chat;if(d){la(d),d.messages=f.renderLast20(d,d.thisUser.userId,d.getOtherParticipant().lastSeenMessageSequenceNumber),b.showCreateNewChatLink=Ma.matchFound&&d.chatType==g.chatsdk.ChatType.GROUP,b.newChatIsEmpty=!1,Ba();var e=!1;_.keys(d.participants).length>0&&d.participants[d.thisUser.userId].status==g.chatsdk.ParticipantStatus.LEFT&&(e=!0),b.disabledChat!=e&&(b.disabledChat=e,r(e),b.$broadcast("changeChatOptions"))}else 0!=b.disabledChat&&(b.disabledChat=!1,r(!1),b.$broadcast("changeChatOptions")),b.showCreateNewChatLink=!1,b.newChatIsEmpty=!0;b.chatObject=d,Ha(!0,!0),setTimeout(function(){b.scrollChatMessageListContainerToBottom()},1)}function ha(){Ha(!0,!0)}function ia(){Ma&&(Ma.addListener("CHAT_CHANGED",ga),Ma.addListener("UPDATE",ha),Ma.addListener("CONVERT_TO_ORDINARY_CHAT",ka))}function ja(){Ma&&(Ma.removeListener("CHAT_CHANGED",ga),Ma.removeListener("UPDATE",ha),Ma.removeListener("CONVERT_TO_ORDINARY_CHAT",ka))}function ka(a){if(b.isNewChat){var c=a.oldChat;c&&ma(c);var d=Ma.chat;d&&(la(d),d.messages=f.renderLast20(d,d.thisUser.userId,d.getOtherParticipant().lastSeenMessageSequenceNumber)),b.chatObject=d,b.convertNewChatToOrdinaryChat(),Ha(!0,!0),setTimeout(function(){b.scrollChatMessageListContainerToBottom()},1)}}function la(a){a.addListener(g.chatsdk.ChatEvents.CHAT_INFO_RECV,H),a.addListener(g.chatsdk.ChatEvents.SENT_MSG_RECEIVED_AT_SERVER,I),a.addListener(g.chatsdk.ChatEvents.MESSAGE_RECEIVED,J),a.addListener(g.chatsdk.ChatEvents.HISTORY_LOADED,K),a.addListener(g.chatsdk.ChatEvents.MESSAGE_READ,L),a.addListener(g.chatsdk.ChatEvents.CHAT_UPDATED,M),a.addListener([g.chatsdk.ChatEvents.UNREAD_COUNT_CHANGED,g.chatsdk.ChatEvents.CHAT_READ],N),a.addListener(g.chatsdk.ChatEvents.NEWER_MESSAGES_LOADED,O),a.addListener(g.chatsdk.ChatEvents.MESSAGE_REMOVED,P),a.addListener(g.chatsdk.ChatEvents.FILE_UPLOADED,Q),a.addListener(g.chatsdk.ChatEvents.SENT_MSG_FAILED,R),a.addListener(g.chatsdk.ChatEvents.MUTE_STATUS_CHANGED,S),a.addListener(g.chatsdk.ChatEvents.SEARCH_STARTED,T),a.addListener(g.chatsdk.ChatEvents.MATCH_FETCH_COMPLETE,U),a.addListener(g.chatsdk.ChatEvents.SEARCH_MATCHES_RECEIVED,V),a.addListener(g.chatsdk.ChatEvents.LOADED_MORE_MSGS,W),a.addListener(g.chatsdk.ChatEvents.SEARCH_ENDED,X),a.addListener(g.chatsdk.ChatEvents.COMPOSING_STARTED,Y),a.addListener(g.chatsdk.ChatEvents.COMPOSING_ENDED,Z),a.addListener(g.chatsdk.ChatEvents.GROUP_CHAT_ACKS_RECEIVED,da)}function ma(a){b.chatObj.removeListener(g.chatsdk.ChatEvents.CHAT_INFO_RECV,H),b.chatObj.removeListener(g.chatsdk.ChatEvents.SENT_MSG_RECEIVED_AT_SERVER,I),b.chatObj.removeListener(g.chatsdk.ChatEvents.MESSAGE_RECEIVED,J),b.chatObj.removeListener(g.chatsdk.ChatEvents.HISTORY_LOADED,K),b.chatObj.removeListener(g.chatsdk.ChatEvents.MESSAGE_READ,L),b.chatObj.removeListener(g.chatsdk.ChatEvents.CHAT_UPDATED,M),b.chatObj.removeListener([g.chatsdk.ChatEvents.UNREAD_COUNT_CHANGED,g.chatsdk.ChatEvents.CHAT_READ],N),b.chatObj.removeListener(g.chatsdk.ChatEvents.NEWER_MESSAGES_LOADED,O),b.chatObj.removeListener(g.chatsdk.ChatEvents.MESSAGE_REMOVED,P),b.chatObj.removeListener(g.chatsdk.ChatEvents.FILE_UPLOADED,Q),b.chatObj.removeListener(g.chatsdk.ChatEvents.SENT_MSG_FAILED,R),b.chatObj.removeListener(g.chatsdk.ChatEvents.MUTE_STATUS_CHANGED,S),b.chatObj.removeListener(g.chatsdk.ChatEvents.SEARCH_STARTED,T),b.chatObj.removeListener(g.chatsdk.ChatEvents.MATCH_FETCH_COMPLETE,U),b.chatObj.removeListener(g.chatsdk.ChatEvents.SEARCH_MATCHES_RECEIVED,V),b.chatObj.removeListener(g.chatsdk.ChatEvents.LOADED_MORE_MSGS,W),b.chatObj.removeListener(g.chatsdk.ChatEvents.SEARCH_ENDED,X),b.chatObj.removeListener(g.chatsdk.ChatEvents.COMPOSING_STARTED,Y),b.chatObj.removeListener(g.chatsdk.ChatEvents.COMPOSING_ENDED,Z),b.chatObj.removeListener(g.chatsdk.ChatEvents.GROUP_CHAT_ACKS_RECEIVED,da)}function na(){e.addListener(g.chatsdk.ChatEvents.MESSAGE_SENT_IN_CHAT,aa),h.addListener(g.chatsdk.ChatEvents.CONNECTED,ba),h.addListener(g.chatsdk.ChatEvents.LAST_ACTIVE_TIME_UPDATED,ea)}function oa(){e.removeListener(g.chatsdk.ChatEvents.MESSAGE_SENT_IN_CHAT,aa),h.removeListener(g.chatsdk.ChatEvents.CONNECTED,ba),h.removeListener(g.chatsdk.ChatEvents.LAST_ACTIVE_TIME_UPDATED,ea)}function pa(a,c){b.chatObj.chatId==c&&"none"!==$(d).css("display")&&b.setWindFocus(!0)}function qa(a,c,e,f,g){b.chatObj.chatId==c&&"none"!==$(d).css("display")&&b.setWindFocus(!1,e,f,g)}function ra(a,c){e.cancelMessageInChat(c,b.chatObj)}function sa(a){var c=i.createEvent("recalculateAutocompletePosition");document.dispatchEvent(c),t(),b.howManyInView()}function ta(){b.xPosition=b.chatWindow.metaDetails.xPosition,d.find(".chatWindow").css({right:b.xPosition})}function ua(a,c){c.chatId==b.chatObj.chatId&&(b.chatId="c"+b.chatObj.chatId,b.msgWinId="m"+b.chatObj.chatId,Ha(!0))}function va(a,c){c===b.chatObj.chatId&&b.closeSearch()}function wa(){b.$on("setWindInFocus",pa),b.$on("setWindOutOfFocus",qa),b.$on("fileRemovedClicked",ra),b.$on("adjustWindPosOnMin",sa),b.$on("renderOnPositionUpdated",ta),b.$on("updateChatDetailsOnInvitationSuccess",ua),b.$on("closeChatSearchMode",va)}function xa(a,c){c&&c.event&&(c.event==j.EVENT_FILE_SELECTED?b.insertOptionsCtrl.onFileSelected(c.file):b.insertOptionsCtrl.onChange(c))}function ya(a,c){c.resourceId===b.chatId&&xa(null,c)}function za(){b.files=[],b.insertOptionsCtrl={onFileSelected:Ca},b.filesUploadManagerCtrl={initialized:!1,templateType:"chat",filesArrayObj:b.files,dontClearPendingFileUploadsOnDestroy:!0}}function Aa(){Ba(),j.on("cnvchange",ya),x.init()}function Ba(){La&&(La.destroyViewRelatedData(),La=null);var a=i.generateUniqueCharId();d.find("div input[type=file]").attr("id",a);var c={id:"#"+a,resourceId:b.chatId,uploadFrom:"chat-window",dropZoneId:"#_"+b.msgWinId,pasteZoneId:"#"+b.chatId};La=j.init(c),b.fileInputContext=La.context}function Ca(a){var c=G();if(c){b.isSearch&&(b.isSearch=!1),a=[a];for(var d in a)a[d].noteId=c.chatId;b.$broadcast("enqueueFile",a),e.sendFilesInChat(c,a[0]),Ha(!0,!0),b.scrollChatMessageListContainerToBottom(),b.isNewChat&&b.convertNewChatToOrdinaryChat()}}function Da(){b.chatWindow.metaDetails.isMinimized?b.$broadcast("miniChatWin",b.chatId):Fa()}function Ea(){if(b.isNewChat)b.fullChatViewUrl=v.getFullViewChatAppUrl("new");else{var a=G();if(a)if(a.lastMessageSequenceNumber>0||a.searchInfo){var d=a.getTitle();b.fullChatViewUrl=v.getFullViewChatAppUrl(a.chatId,c,d)}else if(a._user&&a.chatType==g.chatsdk.ChatType.P2P)if(a.isInviteChat)b.fullChatViewUrl=v.getFullViewChatAppUrl(a._user.email,z.VIEW_CONTACT_CHAT);else{var d=a._user.getDisplayName();b.fullChatViewUrl=v.getFullViewChatAppUrl(a._user.userId,z.VIEW_USER_CHAT,d)}else a.chatType==g.chatsdk.ChatType.GROUP&&(b.fullChatViewUrl=v.getFullViewChatAppUrl("new"))}}function Fa(){bb||(bb=!0,b.appInFoucs=l.appHasFocus(),Ha(!0),b.scrollChatMessageListContainerToBottom(),Ta=setTimeout(function(){b.fullChatViewTarget=y.IS_NATIVE?"":"_blank",B(),F(),b.isNewChat&&(Ma&&ja(),Ma=b.chatObj,ia());var a=G();if(a){if(la(a),!a._user&&a.chatType==g.chatsdk.ChatType.P2P&&a.thisUser){var c=a.getOtherParticipant(a.thisUser.userId);c&&(a._user=h.getUser(c.userId))}Ea()}na(),b.initChatState(),Aa(),t(!0),Da(),Ha(!0),b.scrollChatMessageListContainerToBottom(),b.$broadcast("changeChatOptions"),setTimeout(function(){b.scrollChatMessageListContainerToBottom()},1),Ta=null},0),za(),wa(),b.isNewChat&&setTimeout(function(){Ua=d.find(".to-field input")},100))}function Ga(){b.$broadcast("render_date")}function Ha(a,c){var d=b.isChatMessageListScrolledToBottom();c?b.runDigestOnScope(!0,b):b.runRenderOnScope(a?b:null),d&&(b.scrollChatMessageListContainerToBottom(),setTimeout(function(){b.scrollChatMessageListContainerToBottom()},1))}b.chatMessageListContainer=null,b.fromChatWhichComponent="cnvChatWindow",b.leak_finder=new p,d[0].leakFinder=new q;var Ia,Ja,Ka,La,Ma,Na=[],Oa=!1,Pa="#025b7e",Qa="#389dcc",Ra=!0,Sa=!0,Ta=null,Ua=(i.isFirefox()||i.isIE()||!i.isOsX(),null);b.initChatState=function(){b.disabledChat?(b.disabledChat=!0,r(!0),b.$broadcast("changeChatOptions")):(r(!1),Y(),b.getUnsentChatMessageOnceOnInitialize()),b.chatObj.unreadCount>0&&(b.hasUnread=!0)},b.isChatWindowScrolledToBottom=!0,b.scrollChatMessageListContainerToBottom=function(a){var c=b.chatMessageListContainer;c&&c.length>0&&(c[0].scrollHeight>c[0].clientHeight?a>=0?(d.find(".newMsgReceived").hide(),c.scrollTop(a)):c.scrollTop(c[0].scrollHeight):b.checkIfThereAnyChatGifMsgBubbleInViewAndPlay())},b.isChatMessageListScrolledToBottom=function(){var a=b.chatMessageListContainer;if(a&&a.length>0){var c=Math.ceil(a.scrollTop()),e=a[0].clientHeight,f=a[0].scrollHeight;return c+e+10>=f?(d.find(".newMsgReceived").hide(),!0):!1}return!0},b.blurTextEditor=function(){b.textEditorCtrl.blur()},b.setWindFocus=function(a,c,d,f){if(b.textEditorCtrl){if(!a||b.disabledChat||b.isMinimized||b.chatWindow.metaDetails.isMinimized)b.isChatWindowFocused=!1,b.chatObj.isNewChat||e.chatLostFocus(b.chatObj),f||b.chatObj.chatId!==b.currentFocusedChatWindow.chatId||(b.currentFocusedChatWindow.chatId=null),!b.textEditorCtrl||m.isThisTabLastActiveTab()&&!b.isMinimized||b.textEditorCtrl.blur(),c||m.dispatchTabsEvent2("setWindFocusOut",{tabId:b.tabId,chatId:b.chatId,isFocus:a,dntClearCurrentFocusedChatWind:f},!0);else{b.isNewChat?b.isChatWindowFocused||(b.textEditorCtrl.hasFocus()?d||b.textEditorCtrl.focus():Ua&&Ua.length&&Ua.focus()):d||b.textEditorCtrl.focus(),setTimeout(function(){b.isChatWindowFocused=!0},0),b.isChatWindowFocused=!0,b.hasUnread=!1,b.isNewChat||e.chatGainedFocus(b.chatObj),b.currentFocusedChatWindow.chatId=b.chatObj.chatId,b.chatObj.unreadCount>0&&e.chatRead(b.chatObj);var g={tabId:b.tabId,chatId:b.chatId,isFocus:a};c||m.dispatchTabsEvent2("setWindFocus",g,!0)}t(),b.howManyInView(),Ha(!0)}};var Va,Wa,Xa,Ya;b.blink=function(a,c){Xa&&clearTimeout(Xa),a>0?(Ya=Ya!=Qa?Qa:Pa,Wa.css("background-color",Ya),Xa=setTimeout(function(){b.blink(--a,c)},c)):(Ya="",Wa.css("background-color",Ya),Xa=null,t())},b.isSearch&&(b.searchCountStr=b.chatObj.searchInfo.getCurrentMatchIndex()+1+" of "+b.chatObj.searchInfo.getMatchCount()),b.giphyObject={searchText:"",actionType:""},b.onAttachFileBtnClick=function(){i.fireEvent($(".messageInputBar .inputHide",d)[0],"click")},b.showNewMessagesReceived=function(){$(".newMsgReceived",d).hide(),b.isSearch&&(b.isSearch=!1),Ha(!0),b.scrollChatMessageListContainerToBottom(),b.setWindFocus(!0)},b.openGiphyPopUp=function(){d.find("#iShowGiphyPopup").trigger("showGiphyPopover")},b.howManyInView=function(){setTimeout(function(){var a=b.chatMessageListContainer;if(!b.isMinimized&&a&&0!==a.length){var c,e,f,g,h,i,j={},k=0,l=[];b.chatObj.isNewChat?b.chatObj.chat&&(l=b.chatObj.chat.messages):l=b.chatObj.messages.length;for(var m=l.length;m>k;k++)if(f=l[k],f.fileInfo){if(g=d.find(".video"+f.fileInfo.fileId),d.find(".progress-bar").length){j[f.fileInfo.fileId]=!0;continue}if(0==g.length)continue;c&&e||(c=e+a[0].clientHeight,e=a.offset().top),h=g.offset().top,i=g.height(),h+i>=e&&c>=h&&(j[f.fileInfo.fileId]=!0)}j!=Na&&(Na=j,b.$broadcast("cnvNoteGallery:reloadThumbnailsHorizontal",j),b.$broadcast("cnvNoteGallery:reloadThumbnails",j))}},0)},b.resendMessage=function(a){e.reSendMessageInChat(a,b.chatObj),Ha(!0),n.trackEvent(n.RETRY_A_FAILED_CHAT)};var Za;m.on("thisTabLastActiveChanged",w),b.isChatWindowScrolledToBottom=!0,b.containerScrolled=function(a,c){var f=G();f&&(0==a?(b.winHeight=b.chatMessageListContainer[0].scrollHeight,b.messageListSpinner||b.isMinimized||b.isSearch||!e.loadOlderMessagesInChat(f)||(b.messageListSpinner=!0,Ha(!0))):c&&(b.isChatWindowScrolledToBottom=!0,d.find(".newMsgReceived").hide()),b.checkIfThereAnyChatGifMsgBubbleInViewAndPlay(),b.howManyInView(),c&&b.chatObj&&!b.isSearch&&!b.chatObj.isNewChat&&e.discardOldMessagesFromChatIfRequired(b.chatObj,60)&&Ha(!0))};var $a=30;b.checkIfThereAnyChatGifMsgBubbleInViewAndPlay=function(){for(var a=$("img.gif-placeholder",d),c=b.chatMessageListContainer,e=c.offset().top,f=c.offset().top+c[0].clientHeight,g=0;g<a.length;g++){var h=$(a[g]).parents(".chat-message-bubble"),i=h.offset().top;i+$a>=e&&f>=i+$a&&ab(h,$(a[g]))}};var _a,ab=function(a,b){a.find(".cnv-spinner").show();var c=a.find(".original-gif");c[0].complete?(c.show(),b.remove(),a.find(".cnv-spinner").remove(),a.find(".gif-badge").remove()):c.load(function(){c.show().off("load"),b.remove(),a.find(".cnv-spinner").remove(),a.find(".gif-badge").remove()})};b.moveToNextSearch=function(a){b.isNewChat||(a?b.chatObj.searchInfo.moveToNextMatch():b.chatObj.searchInfo.moveToPreviousMatch(),b.searchCountStr=b.chatObj.searchInfo.getCurrentMatchIndex()+1+" of "+b.chatObj.searchInfo.getMatchCount(),Ha(!0),b.scrollHighlightedSearch())},b.scrollHighlightedSearch=function(){var a=d.find(".chat-message-bubble").find(".highlight");if(a.length){var c=a.closest(".chat-message-bubble").position().top,e=b.chatMessageListContainer,f=e[0].clientHeight/2,g=e.scrollTop(),h=g+c-f+a.height()/2;0>h&&(h=0),b.scrollChatMessageListContainerToBottom(h)}},b.loadMoreMessages=function(a,b){var c=G();c&&c.searchInfo.loadMoreMessages(a,b)},b.closeSearch=function(){b.isSearch=!1,b.chatWindow.metaDetails.isSearchMode=!1,Ha(!0),setTimeout(function(){b.scrollChatMessageListContainerToBottom(1),b.scrollChatMessageListContainerToBottom()},0)},b.onRenderAtScope=function(){b.updateParticipantsList(),Ha(!0),b.$broadcast("userInvitedOrLeft")},b.updateParticipantsList=function(){b.chatObj.isNewChat||(b.participantsList=b.chatObj.getParticipantsAsArray())},b.chatClosing=!1,b.closeChatWindow=function(a){a.preventDefault(),a.stopPropagation(),b.$emit("closeChatWindow",b.chatObj.chatId)};var bb=!1;b.isMinimized||Fa(),b.onFocusOut=function(a){!b.isMinimized&&b.isChatWindowFocused&&$(document.activeElement).closest("cnv-chat-window")[0]!=d[0]&&b.setWindFocus(!1)},b.onFocus=function(){b.isMinimized||b.setWindFocus(!0)},b.openChatInFullView=function(a){b.disableButtons||(b.$broadcast("miniChatWin",b.chatId),b.isNewChat||m.dispatchTabsEvent2("chatMin",{tabId:b.tabId,chatWindId:b.chatId},!0))},b.getChatImageThumbnailPath=function(a){return k("getChatImageThumbnailPath")(a.chatId,"48x48",a.getIconVersion())},b.convertNewChatToOrdinaryChat=function(){if(b.isNewChat){var a=G();if(!a)return;if(b.isNewChat=!1,ja(),b.chatObj=a,b.chatId="c"+a.chatId,b.msgWinId="m"+a.chatId,b.showCreateNewChatLink=!1,b.chatObject=a,b.initializeChatSpecificState(),b.updateParticipantsList(),Ba(),a.chatType==g.chatsdk.ChatType.P2P){var c=a.getOtherParticipant(a.thisUser.userId);c&&(a._user=h.getUser(c.userId))}r(b.disabledChat),b.$emit("convertNewChatToOrdinaryChat",{chat:a}),Ea(),b.$broadcast("changeChatOptions"),Ha(!0,!0)}},b.explicitlyCreateNewChat=function(){b.isNewChat&&A.explicitlyCreateNewChat()},b.startChatTitleEdit=function(){b.editChatTitle=!0,b.setWindFocus(!1),Ha(!0);var a=d.find(".chat-rename-input");if(a.length){var c=G(),e=c.getTitle();a.val(e);var f=a[0],g=e.length;if(a.focus(),f.createTextRange){var h=f.createTextRange();h.move("character",g),h.select()}else f.focus(),(f.selectionStart||0===f.selectionStart)&&f.setSelectionRange(g,g)}},b.endChatTitleEdit=function(){b.editChatTitle=!1,setTimeout(function(){b.setWindFocus(!0),Ha(!0)},0)},b.onScopeDestroy=function(){document.removeEventListener("mousedown",u);var a=G();a&&ma(a),oa(),ja(),b.isNewChat||a&&e.chatClosed(a),m.off("thisTabLastActiveChanged",w),$(".messageInputBar",d).off("resize",E),Ia.off("resize",E),d.off("mouseup",C),d.find(".emoji-popup-btn").off("setFocusOnHideEmojiPopover",D),La&&(La.destroyViewRelatedData(),La=null,j.off("cnvchange",ya)),b.filesUploadManagerCtrl=null,b.insertOptionsCtrl=null,Ta&&(clearTimeout(Ta),Ta=null),b.chatMessageListContainer=null,Ia=null,chatHeaderView=null,Ja=null,Ka=null,Na=null,b.chatService=null,Ua=null,Za&&(clearTimeout(Za),Za=null),_a&&(clearTimeout(_a),_a=null),Wa=null}},controller:["$scope","$element","appearinVideoCallService","alertsService",function(a,b,c,d){function j(){return a.chatObj.isNewChat?a.chatObj.chat:a.chatObj}function q(){if(!a.isNewChat){var b=a.textEditorCtrl.getEditorText();b=b.trim(),O&&(clearTimeout(O),O=null),b.length>0?(a.chatWindow.metaDetails.inputText=a.textEditorCtrl.getEditorHtmlText(),a.chatWindow.metaDetails.rangeSelection=a.textEditorCtrl.getSelection(),N(a.textEditorCtrl.getEditorHtmlText()),M=(Date.now()-L)/1e3,O=setTimeout(function(){1==a.composing&&(e.composingPaused(a.chatObj),a.composing=!1),P&&(clearTimeout(P),P=null)},J),a.composing||P?a.composing&&M>=10&&(e.composingStarted(a.chatObj),L=Date.now()):P=setTimeout(function(){e.composingStarted(a.chatObj),a.composing=!0,L=Date.now()},I)):(a.chatWindow.metaDetails.inputText="",a.chatWindow.metaDetails.rangeSelection=null,N(""),P&&(clearTimeout(P),P=null),a.composing=!1,e.composingPaused(a.chatObj)),a.isChatWindowScrolledToBottom&&a.scrollChatMessageListContainerToBottom()}}function r(){setTimeout(function(){a.isOpenedOnUserAction?a.setWindFocus(!0,a.fromOtherTab):a.setWindFocus(!1)},0),a.textEditorCtrl.captureEvents.on("text-change",q),a.chatWindow.metaDetails.inputText.length>0&&(a.textEditorCtrl.setContent(a.chatWindow.metaDetails.inputText),a.textEditorCtrl.setSelection(a.chatWindow.metaDetails.rangeSelection,"user"))}function s(a,b,c,d,e){return b?"\n":c?"":d?"":e?"\n":void 0}function u(){a.appInFoucs=!0,a.isNewChat||a.isChatWindowFocused&&(a.chatObj.unreadCount&&e.chatRead(a.chatObj),e.chatGainedFocus(a.chatObj))}function v(){a.appInFoucs=!1}function w(b){b.tabId==a.tabId||m.isThisTabLastActiveTab()||b.chatId==a.chatId&&a.setWindFocus(b.isFocus,!0)}function x(b){m.isThisTabLastActiveTab()||b.chatId==a.chatId&&a.setWindFocus(b.isFocus,!0,!0,b.dntClearCurrentFocusedChatWind)}function A(b){a.isNewChat||b.tabId!==a.tabId&&b.chatId===a.chatId&&(b.muted?e.muteChat(a.chatObj,!1):e.unMuteChat(a.chatObj,!1),a.$broadcast("changeChatOptions"),a.$emit("chatMuteStatusChanged"))}function C(b){b.tabId!==a.tabId&&b.chatId===a.chatId&&(a.chatWindow.metaDetails.inputText=b.unsentMessageText,a.textEditorCtrl.setContent(b.unsentMessageText),a.textEditorCtrl.setSelection(b.rangeSelection,"user"))}function D(b){if(b.tabId!==a.tabId&&b.chatId===a.chatId){var c=a.textEditorCtrl.getEditorHtmlText();c&&c.length&&m.dispatchTabsEvent2("displayUnsentChatMessageOnceOnInitialize",{tabId:a.tabId,chatId:a.chatId,unsentMessageText:a.textEditorCtrl.getEditorHtmlText(),rangeSelection:a.textEditorCtrl.getSelection()})}}function E(b){if(b.tabId!==a.tabId&&b.chatId===a.chatId){var c=a.textEditorCtrl.getEditorText().trim();c&&c.length||(a.textEditorCtrl.setContent(b.unsentMessageText),a.textEditorCtrl.setSelection(b.rangeSelection,"user")),F()}}function F(){m.removeTabsEventListener2("displayUnsentChatMessageOnceOnInitialize",E)}a.chatObject=null,a.chatService=t;var G=a.chatWindow.metaDetails;a.isSearch=G.isSearchMode,a.scrollToBot=G.scrollToBot,a.xPosition=G.xPosition,a.isOpenedOnUserAction=G.isOpenedOnUserAction,a.isOpenedFromLS=G.isOpenedFromLS,a.chatObj=a.chatWindow.chatObj,a.newChatIsEmpty=!1,a.initializeChatSpecificState=function(){a.isNewChat=a.chatObj.isNewChat,a.isNewChat?(a.showCreateNewChatLink=a.chatObj.matchFound&&a.chatObj.chat&&a.chatObj.chat.chatType==g.chatsdk.ChatType.GROUP,a.newChatIsEmpty=!a.chatObj.chat):(a.participantsList=a.chatObj.getParticipantsAsArray(),a.showCreateNewChatLink=!1),a.disabledChat=!1;var b=j();if(a.chatObject=b,b){if(_.keys(b.participants).length>0){var c=b.getOtherParticipant(),d=b.thisUser.userId;b.messages.length>0&&(b.messages=f.renderLast20(b,d,c.lastSeenMessageSequenceNumber,!0)),a.isSearch&&(b.searchInfo.messages=f.renderLast20(b,d,c.lastSeenMessageSequenceNumber,!0,!0)),!t.isAdminModeON()&&b.participants[d].status!=g.chatsdk.ParticipantStatus.LEFT&&(b.isInviteChat||c&&h.getUserById(c.userId)||b.chatType!=g.chatsdk.ChatType.P2P)||(a.disabledChat=!0)}var e=b.isInviteChat||b._user&&b._user.isInvitedUser();e&&(a.inviteMessage=b._user.email+" hasn't joined yet, but you can still start a chat. Your messages will be delivered via email.")}},a.initializeChatSpecificState(),a.chatOptions={},a.chatOptions.type="c2c2c2-png",a.chatOptions.align="right",a.getChatMessages=function(){var b=j();return b?a.isSearch?b.searchInfo.messages:b.messages:[]};var H=a.getVisibleBrowserHeight();G.height>H&&(G.height=H),G.height<350&&(G.height=350),a.verticalHeight=G.height,a.chatId=G.eChatId,a.msgWinId=G.eMsgWinId;var I=2e3,J=15e3,K=null;a.getUnsentChatMessageOnceOnInitialize=function(){0==a.chatWindow.metaDetails.inputText.length?m.dispatchTabsEvent2("getUnsentChatMessageOnceOnInitialize",{tabId:a.tabId,chatId:a.chatId}):F()};var L,M,N=function(b){m.isThisTabLastActiveTab()&&m.dispatchTabsEvent2("displayUnsentChatMessage",{tabId:a.tabId,chatId:a.chatId,unsentMessageText:b,rangeSelection:a.textEditorCtrl.getSelection()})},O=null,P=null,Q={min:25,max:120},R={};a.textEditorCtrl={},a.textEditorCtrl.initialized=!1,a.textEditorCtrl.initialHtmlText="",a.textEditorCtrl.height=Q,a.textEditorCtrl.captureEvents=R,a.textEditorCtrl.editorInitialized=r;var S=/(<\/div><div>)|(<div>)|(<\/div>)|(<br>)/gi;a.sendVideoCallLink=function(b,c,d){a.onTextEditorSubmitOnEnter(b,c,d)},a.GetViaPropsForMixpanel=function(){var a=y.IS_NATIVE?"Desktop":"Web";return{Via:a+" Small Chat"}},a.onTextEditorSubmitOnEnter=function(b,c,d){var f=j();if(f)if(a.chatWindow.metaDetails.inputText="",a.isSearch&&(a.isSearch=!1),b)f.isInviteChat?e.sendFakeMessage(b,f):c?e.sendMessage(b,f,null,null,c,d):e.sendMessage(b,f),n.trackEvent(n.CHATS_SEND_MESSAGE,a.GetViaPropsForMixpanel()),P&&(clearTimeout(P),P=null),setTimeout(function(){a.chatMessageListContainer.scrollTop(a.chatMessageListContainer[0].scrollHeight)},30),a.isNewChat&&a.convertNewChatToOrdinaryChat();else{N("");var g=a.textEditorCtrl.getEditorText();g=g.trim(),""!=g&&(g=a.textEditorCtrl.getEditorHtmlText().replace(/<p><\/p>/gi,"<div></div>").replace(S,s).replace(/<p>\s*<\/p>/gi,"").replace(/(?!<\s*[a-z][a-z0-9]*.*\s)(class\s*=\s*"[a-z0-9-\s*]*\")(?=[^<>]*>)/gi,"").replace(/&nbsp;/g," ").trim()),""==g||/^\s*$/.test(g)||(g=B.cleanFromHTMLText(g),f.isInviteChat?(e.sendFakeMessage(g,f),a.$emit("sendChatInvite",{chat:f,message:g})):e.sendMessage(g,f),P&&(clearTimeout(P),P=null),clearTimeout(O),a.composing=!1,setTimeout(function(){a.textEditorCtrl.clearContent(),a.chatMessageListContainer.scrollTop(a.chatMessageListContainer[0].scrollHeight)},30),n.trackEvent(n.CHATS_SEND_MESSAGE,a.GetViaPropsForMixpanel()),a.isNewChat&&a.convertNewChatToOrdinaryChat())}},a.onSpaceKeyPressInTextEditor=function(){var b=j();b&&a.textEditorCtrl.cleanBlackListedWords()},a.onEscKeyPressInTextEditor=function(){a.isNewChat||(a.textEditorCtrl.getEditorText()&&(N(""),a.textEditorCtrl.clearContent()),a.composing===!0&&(P&&(clearTimeout(P),P=null),e.composingPaused(a.chatObj),a.composing=!1))},a.getCommandsWithDropdownItems=function(a,b){var c=j();if(c&&!c.isInviteChat){var d=o.defer(),e=[];return"@"==b?e=p.queryAvailableCommands(a,5,p.sources.CHAT):":"==b&&(e=p.queryEmojiData(a,5)),d.resolve(e),d.promise}},a.OnCommandExecuted=function(b,d){var e=j();e&&("Giphy"===b.label?setTimeout(function(){K=a.textEditorCtrl.getSelection(),a.giphyObject={searchText:d,actionType:"command"},a.openGiphyPopUp()},0):"Appear.in"===b.label&&c.generateAppearinVideoCallLink().then(function(b){var c=b.directLink,d="You started an appear.in video call.\n\ud83c\udfa5 <a href='"+c+"'>Join now: "+b.roomName+"</a>";a.sendVideoCallLink(d,z.VIDEO_MSG_APPEAR_IN,c),n.trackEvent(n.SENT_VIDEO_CALL,{Type:"Appear",Participants:_.keys(e.participants).length})}))},a.getPrivateP2PChatTitle=function(){return"Private chat"},a.downloadFile=function(a,b){var c=j();if(c){var d=k("getPartialOriginalImagePath")(a,c.chatId);i.download([{path:d,name:b}])}},a.sendInvite=function(){var b=j();b&&a.$emit("sendChatInvite",{chat:b,withoutChatContent:!0})},a.openSeenNotificationDialog=function(b){if(!a.isNewChat){var c="chat/client/chatWindow/templates/chatSeenParticipants.tpl.html",e="chatSeenParticipantsCtrl",f="cnv-shared-info-modal",g={seenParticipants:function(){return b},thisUserId:function(){return a.chatObj.thisUser.userId}};d.customModal(c,e,g,f,!0)}},l.on("appFocus",u),l.on("appBlur",v),m.addTabsEventListener2("setWindFocus",w),m.addTabsEventListener2("setWindFocusOut",x),m.addTabsEventListener2("muteStatusChanged",A),m.addTabsEventListener2("displayUnsentChatMessage",C),m.addTabsEventListener2("getUnsentChatMessageOnceOnInitialize",D),m.addTabsEventListener2("displayUnsentChatMessageOnceOnInitialize",E),a.$on("$destroy",function(){l.off("appFocus",u),l.off("appBlur",v),m.removeTabsEventListener2("setWindFocus",w),m.removeTabsEventListener2("setWindFocusOut",x),m.removeTabsEventListener2("muteStatusChanged",A),m.removeTabsEventListener2("displayUnsentChatMessage",C),m.removeTabsEventListener2("getUnsentChatMessageOnceOnInitialize",D),m.removeTabsEventListener2("displayUnsentChatMessageOnceOnInitialize",E),a.textEditorCtrl=null,a.onScopeDestroy()})}]}}]),b.module("convoApp").directive("cnvAddUserInChat",["chatManager","chatUsersManager","appTabs","alertsService","utils",function(a,b,c,d,e){return{link:function(e,f,h){function i(){var a=r.scrollTop();a>=r[0].scrollHeight-r.height()?(e.addListShowingUsers+20<e.users.length?e.addListShowingUsers+=20:e.addListShowingUsers=e.users.length,e.runDigestOnScope(!1,e)):0==a&&(e.addListShowingUsers=20,e.runDigestOnScope(!1,e))}function j(a){var c=$(a.target).val();if(0===c.indexOf("@")&&(c=c.slice(1)),c.length>0){e.addUserSelectedIndex=0,e.users=b.getFilteredUserList(c);for(var d=[],f=0;f<e.users.length;f++)e.users[f].userId in e.chatObj.participants?e.chatObj.participants[e.users[f].userId].status!=g.chatsdk.ParticipantStatus.JOINED&&d.push(e.users[f]):d.push(e.users[f]);e.users=d,e.addListShowingUsers=e.users.length,e.runDigestOnScope(!0,e)}else{e.users=b.getUsers();for(var d=[],f=0;f<e.users.length;f++)e.users[f].userId in e.chatObj.participants||d.push(e.users[f]);e.users=d,e.addListShowingUsers=20,e.runDigestOnScope(!0,e)}r.scrollTop(0)}function k(a){e.addUserSelectedIndex=-1,$(a.target).val(""),e.users=b.getUsers(),e.$emit("addUserBlur")}var l,m,n="Add teammate to chat?",o="Are you sure you want to add [username] to this chat? People you add can see all previous messages in this group chat.",p="Add",q="Cancel",r=f.find(".addUserList");r.on("scroll",i),f.find(".userSearchBar").on("input",j),e.inviteThisUserToChat=function(h,i){function j(b){var d=[];d.push(b),a.inviteUsersInChat(d,e.chatObj),i||0!==e.chatObj.lastMessageSequenceNumber||c.dispatchTabsEvent2("addUserToGroupChat",{chatId:e.chatObj.chatId,userId:b.userId}),e.onRenderAtScope(),e.isSearch?e.closeSearch():m=setTimeout(function(){e.scrollChatMessageListContainerToBottom(),clearTimeout(l),clearTimeout(m)},0),e.$emit("saveHistoryLS"),f.find(".userSearchBar").blur()}if(e.chatObj.chatType==g.chatsdk.ChatType.P2P){var k=[];k.push(h),b.getUserById(e.chatObj.getOtherParticipant().userId)&&k.push(b.getUserById(e.chatObj.getOtherParticipant().userId));var r=a.startChatWithUsers(k);e.$emit("openChatWindow",r,{isOpenedOnUserAction:!0})}else if(e.chatObj.chatType==g.chatsdk.ChatType.GROUP)if(e.chatObj.messages.length>0){if(!c.isThisTabLastActiveTab())return;l=setTimeout(function(){d.promptModal(n,o.replace("[username]",h.firstName),function(){var a=e.chatObj.participantForId(h.userId);a&&a.status==g.chatsdk.ParticipantStatus.JOINED||(j(h),e.setWindFocus(!0))},function(){e.setWindFocus(!0)},p,q,null,!0,!1,!0,"cnv-icons-20 add-user-in-chat-alert-icon-class Icon1__AddPerson-white")},1)}else j(h)},e.userSearchBarKeyDown=function(a){if(27==a.which)f.find(".userSearchBar").blur(),e.runRenderOnScope(e);else if(38==a.which){var b=r.scrollTop();a.preventDefault(),e.addUserSelectedIndex>0&&e.addUserSelectedIndex--;var c=24*e.addUserSelectedIndex;b>0&&(c>b&&c<b+r.height()||r.scrollTop(b-24)),e.runRenderOnScope(e)}else if(40==a.which){var b=r.scrollTop();a.preventDefault(),e.addListShowingUsers-1>e.addUserSelectedIndex&&e.addUserSelectedIndex++;var c=24*e.addUserSelectedIndex+64;c>b&&c<b+r.height()||r.scrollTop(b+24),e.runRenderOnScope(e)}else 13==a.which&&e.users.length&&e.inviteThisUserToChat(e.users[e.addUserSelectedIndex])},e.mouseOnItem=function(a){e.addUserSelectedIndex=a,e.runRenderOnScope(e)},f.find(".userSearchBar").on("blur",k),e.onScopeDestroyChatActionBar=function(){r.off("scroll",i),f.find(".userSearchBar").off("blur",k),f.find(".userSearchBar").off("input",j),r=null}},controller:["$scope","$element",function(a,d){function e(c){c.chatId===a.chatObj.chatId&&a.inviteThisUserToChat(b.getUserById(c.userId),!0)}c.addTabsEventListener2("addUserToGroupChat",e),a.$on("$destroy",function(){c.removeTabsEventListener2("addUserToGroupChat",e),a.onScopeDestroyChatActionBar()})}]}}]),b.module("convoApp").directive("cnvChatActionBar",["chatUsersManager","chatManager","AppLinks","FiltersQueryTransformer","$location","resourcesTabsManager","mixpanelService","config",function(a,b,c,d,e,f,g,h){
return{restrict:"E",scope:!1,templateUrl:"chat/client/chatWindow/templates/chatActionBar.tpl.html",link:function(a,c,d){function e(a,b){if(null!==a){if(a.createTextRange){var c=a.createTextRange();return c.move("character",b),c.select(),!0}return a.selectionStart||0===a.selectionStart?(a.focus(),a.setSelectionRange(b,b),!0):(a.focus(),!1)}}function f(c,d){b.updateChatTitle(c,d),setTimeout(function(){a.scrollChatMessageListContainerToBottom()},0),i(g.UPDATE_GROUP_CHAT_NAME)}function i(a){var b=h.IS_NATIVE?"Desktop":"Web",c=b+" Small Chat";g.trackEvent(a,{Via:c})}a.onRenameInputDoneClick=function(){var b=c.find(".chat-rename-input").val().trim();b&&b.length&&a.chatObj.getOriginalTitle(!0)!=b&&(f(a.chatObj,b),a.endChatTitleEdit())},a.onChatRenameInputClick=function(){a.setWindFocus(!1),a.runRenderOnScope(a);var b=c.find(".chat-rename-input");b.focus(),b.focus()},a.onChatInputKeyUp=function(b){if(a.editChatTitle){var d=c.find(".chat-rename-input").val().trim(),e=a.chatObj.getOriginalTitle(!0),g=e!=d&&d.length;g?c.find(".rename-done-btn").removeClass("disabled"):c.find(".rename-done-btn").addClass("disabled"),27==b.which?a.endChatTitleEdit():13==b.which&&d&&g&&(f(a.chatObj,d),a.endChatTitleEdit())}};var j=a.chatObj.getOriginalTitle(!0);null==j&&(j="");var k=c.find(".chat-rename-input");k.length&&(k.val(j),e(k[0],j.length))}}}]),b.module("convoApp").directive("cnvChatWindowHeaderBar",["chatUsersManager","chatManager","AppLinks","FiltersQueryTransformer","$location","resourcesTabsManager","popoverUtils","alertsService",function(a,b,c,d,e,f,h,i){return{link:function(j,k,l){function m(){document.removeEventListener("mouseup",m),setTimeout(function(){document.addEventListener("click",n)},1)}function n(a){var b=$(a.target).closest(".vidCallOptionsDropdown");b&&0!=b.length||j.closeVideoCallDropdown()}function o(){j.showingParticipantList?(j.showingParticipantList=!1,j.runRenderOnScope(j)):p(),h.hide()}function p(){j.showingParticipantList=!0,j.updateParticipantsList(),j.setWindFocus(!1),j.runRenderOnScope(j),j.closeVideoCallDropdown(),setTimeout(function(){$patricipantList=k.find(".participantList"),$patricipantList.scrollTop(0),$patricipantList.on("focus",q),$patricipantList.on("blur",r),$patricipantList.focus()},10)}function q(){j.showingParticipantList=!0,j.updateParticipantsList(),j.runRenderOnScope(j)}function r(){j.showingParticipantList=!1,j.runRenderOnScope(j)}j.showUserListToAdd=!1,j.showUserList=function(){if(j.closeVideoCallDropdown(),j.showUserListToAdd||j.chatObj.isInviteChat)j.showUserListToAdd=!1,j.runRenderOnScope(j);else if(!j.disabledChat){j.showUserListToAdd=!0,j.addListShowingUsers=20,j.addUserSelectedIndex=-1;var b=[];j.users=a.getUsers();for(var c=0;c<j.users.length;c++)j.users[c].userId in j.chatObj.participants?j.chatObj.participants[j.users[c].userId].status!=g.chatsdk.ParticipantStatus.JOINED&&b.push(j.users[c]):b.push(j.users[c]);j.users=b,j.setWindFocus(!1),j.runRenderOnScope(j),k.find(".addUserList").scrollTop(0),k.find(".userSearchBar").focus(),k.find(".userSearchBar").focus()}},j.$on("addUserBlur",function(){j.showUserListToAdd=!1,j.runRenderOnScope(j)}),j.$on("videoCallDropdownBlur",function(){j.closeVideoCallDropdown()}),j.closeVideoCallDropdown=function(){j.showVidCallDropdown=!1,document.removeEventListener("click",n),s=!1,$(".vidCallOptionsDropdown",k).length&&j.runRenderOnScope(j)};var s;j.showVideoCallOptions=function(){j.disabledChat||(s||(s=!0,document.addEventListener("mouseup",m)),j.showVidCallDropdown=!0,j.runRenderOnScope(j),j.blurTextEditor())},j.canShareChat=function(){return _.keys(j.chatObj.participants).length>0},j.$on("changeChatOptions",function(h){if(j.MuteUnMuteStr="",j.chatObj.isMuted?j.MuteUnMuteStr="Unmute chat":j.MuteUnMuteStr="Mute chat",j.chatObj.chatType==g.chatsdk.ChatType.GROUP)if(j.disabledChat){var k=function(){f.switchToHomeTab(l)};j.chatOptions.options=[{label:"Share this chat",callback:k}];var l=function(){for(var a,b,c=j.chatObj.messages,d="Chat with "+j.chatObj.getTitle(),e="",f=0;f<c.length;f++)c[f].type==g.chatsdk.MessageType.MESSAGE&&(a="<b>"+j.chatObj.participants[c[f].senderId].name+"</b>",b="<p>"+c[f].messageText+"</p> <br/>",e+=a+b);console.log(e),$(".dummy-text-area").trigger("onCustomClick",[e,d])}}else{var k=function(){f.switchToHomeTab(l)},l=function(){for(var a,b,c=j.chatObj.messages,d="Chat with "+j.chatObj.getTitle(),e="",f=0;f<c.length;f++)c[f].type==g.chatsdk.MessageType.MESSAGE&&(a="<b>"+j.chatObj.participants[c[f].senderId].name+"</b>",b="<p>"+c[f].messageText+"</p> <br/>",e+=a+b);console.log(e),$(".dummy-text-area").trigger("onCustomClick",[e,d])},m=function(){i.promptModal("Leave chat?","You won't recieve any new messages in this chat group. Are you sure you want to leave?",function(){b.leaveChat(j.chatObj),setTimeout(function(){j.scrollChatMessageListContainerToBottom()},0),j.chatOptions.options=[{label:"Share this chat",callback:k}]},function(){},"Yes","Cancel",null,!0,!1,!1,"")},n=function(){j.startChatTitleEdit()},p=function(){j.chatObj.isMuted?b.unMuteChat(j.chatObj,!0):b.muteChat(j.chatObj,!0)};j.chatOptions.options=[{label:"Share this chat",callback:k}],j.chatObj.hasMessages()&&j.chatOptions.options.push({label:"Rename group",callback:n}),j.chatOptions.options.push({label:j.MuteUnMuteStr,callback:p}),j.chatOptions.options.push({label:"Leave chat",callback:m}),j.chatOptions.options.push({label:"Participants",callback:o})}else if(j.chatObj.chatType==g.chatsdk.ChatType.P2P){var k=function(){f.switchToHomeTab(l)},l=function(){for(var a,b,c=j.chatObj.messages,d="Chat with "+j.chatObj.getTitle(),e="",f=0;f<c.length;f++)c[f].type==g.chatsdk.MessageType.MESSAGE&&(a="<b>"+j.chatObj.participants[c[f].senderId].name+"</b>",b="<p>"+c[f].messageText+"</p> <br/>",e+=a+b);console.log(e),$(".dummy-text-area").trigger("onCustomClick",[e,d])},q=function(){var b=null,f=a.getUserById(j.chatObj.getOtherParticipant().userId),g=f.email,h="from:'"+g+"'";try{b=d.queryToFilters(h)}catch(i){b=null}if(b&&0!=b.length){var k=d.filtersToQuery(b);e.url(c.getFilterUrlForFilterStr(k))}else e.url("/feed")},p=function(){j.chatObj.isMuted?b.unMuteChat(j.chatObj,!0):b.muteChat(j.chatObj,!0)};j.chatService.isAdminModeON()?j.chatOptions.options=[{label:"Share this chat",callback:k}]:j.chatOptions.options=[{label:"Share this chat",callback:k},{label:"View profile",callback:q},{label:j.MuteUnMuteStr,callback:p}]}j.runRenderOnScope(j)})},controller:["$scope","$element",function(a,b){a.chatOptions={},a.chatOptions.type="noIcon",a.chatOptions.align="right",a.chatOptions.containerClass="dropdownLinkContainer",a.$on("$destroy",function(){a.chatOptions&&(a.chatOptions=null)})}]}}]),b.module("convoApp").directive("cnvNewChatWindowUsersInput",["NewChatWindowDataManager","$q","atMentionsListProvider","$filter","datetimeService","utils","NewChatDataManager","userInfo",function(a,b,c,d,e,f,g,h){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/client/chatWindow/templates/NewChatWindowUsersInput.tpl.html",link:function(b,c,d){function e(){}b.onItemAddedInToField=function(c){"ERROR"===c.type?b.userItems.pop():"GROUP_CHAT"==c.type?(b.userItems.pop(),setTimeout(function(){a.openChatFromServerSuggestion(c.data)},0)):a.addUserByUserIdInNewChat(c.id)},b.onItemRemovedInToField=function(b){a.removeUserByUserIdFromNewChat(b.id)},b.$on("$destroy",function(){}),e()},controller:["$scope",function(d){var e=3,f=2,i=0;d.userItems=[];var j=a.getNewChatData();if(j){var k=j.users.map(function(a){return a.userId});d.userItems=c.getPublishableUsersListItemsFromUserIds(k)}d.queryAutoCompleteItemsAvailableLocally=function(a,d){var f=b.defer(),g=[];g=c.queryPublishableUsers(a,d+e);for(var j=g.length,k=0;j>k;++k)if(g[k].id==h.getUserId()){g.splice(k,1);break}return i=g.length,f.resolve(g),f.promise},d.queryAutoCompleteItemsFromServer=function(a,c){var h=d.userItems.map(function(a){return a.id}),j=b.defer();return g.fetchChatSuggestions(h,a).then(function(a){var b=f+1;if(a.length>b){var c=Math.max(e-i,0),d=Math.min(a.length,c+b);d<a.length&&a.splice(d)}j.resolve(a)}),j.promise}}]}}]),b.module("convoApp").directive("cnvParticipantList",["chatUsersManager","popoverUtils",function(a,b){return{link:function(a,c,d){function e(){a.showingParticipantList=!0,a.setWindFocus(!1),a.runRenderOnScope(a),setTimeout(function(){i=c.find(".participantList"),i.scrollTop(0),i.on("focus",g),i.on("blur",h),i.focus()},10)}function f(){i&&(i.off("focus",g),i.off("blur",h)),i=null,a.showingParticipantList=!1}function g(){a.showingParticipantList=!0,a.runRenderOnScope(a)}function h(){a.showingParticipantList=!1,a.runRenderOnScope(a)}a.$broadcast("userInvitedOrLeft"),a.showParticipantsList=function(){a.showingParticipantList?(a.showingParticipantList=!1,a.runRenderOnScope(a)):e(),b.hide()};var i;a.$on("$destroy",function(){f()})},controller:["$scope","$element",function(b,c){b.$on("userInvitedOrLeft",function(){if(0!==_.keys(b.chatObj.participants).length){b.showingParticipantList=!1,b.usersAvatar=[],b.participantsList=[];var c,d,e,f=7,h=b.chatObj.thisUser.userId,i=[];for(d in b.chatObj.participants)e=b.chatObj.participants[d],d!=h&&e.status==g.chatsdk.ParticipantStatus.JOINED&&(c=a.getUserById(d),c?(c.displayName=c.getDisplayName(),b.usersAvatar.length<f&&b.usersAvatar.push(c),b.participantsList.push(c)):i.push(d));for(var j=0;j<i.length;j++)c=a.getInaccessibleUserById(i[j]),c&&(c.displayName=c.getDisplayName(),b.participantsList.push(c),b.usersAvatar.length<f&&b.usersAvatar.push(c));b.runRenderOnScope(b)}})}]}}]),b.module("convoApp").directive("cnvVideoCallOptionsInChat",["userInfo","ChatConstants",function(a,b){return{restrict:"E",scope:!0,templateUrl:"chat/client/chatWindow/templates/cnvVideoCallOptionsInChat.tpl.html",link:function(a,b,c){function d(b){27==b.keyCode&&a.closeVideoCallDropdown()}$(document).on("keydown",d),a.$on("$destroy",function(){$(document).off("keydown",d)})},controller:["$scope","appearinVideoCallService","mixpanelService",function(a,c,d){function e(){var b;return a.chatObj?b=a.chatObj:"function"==typeof a.getChatObj&&(b=a.getChatObj()),b}a.startAppearin=function(){var f=e();f&&c.generateAppearinVideoCallLink().then(function(c){var e=c.directLink,g="You started an appear.in video call.\n\ud83c\udfa5 <a href='"+e+"'>Join now: "+c.roomName+"</a>";a.sendVideoCallLink(g,b.VIDEO_MSG_APPEAR_IN,e),d.trackEvent(d.SENT_VIDEO_CALL,{Type:"Appear",Participants:_.keys(f.participants).length})})}}]}}]),b.module("convoApp").factory("msgListRenderer",["datetimeService","chatUsersManager","utils",function(a,b,c){function d(a,b,c){var d=[],e=b.getSequenceNumber();if(0!=e){for(var f,g,h,i=0,l=0;l<c.length;l++)c[l].lastSeenMessageSequenceNumber===e&&d.push(a.participantForId(c[l].userId));if(b._view.groupSeen){for(var l=0;l<d.length;l++)-1===_.indexOf(b._view.groupSeen.seenParticipants,d[l])&&b._view.groupSeen.seenParticipants.push(d[l]);for(var l=0;l<c.length;l++)f=_.findWhere(b._view.groupSeen.rawParticipants,{userId:c[l].userId}),f?f.lastSeenMessageSequenceNumber=c[l].lastSeenMessageSequenceNumber:b._view.groupSeen.rawParticipants.push(c[l]);for(var l=0;l<b._view.groupSeen.rawParticipants.length;l++)b._view.groupSeen.rawParticipants[l].lastSeenMessageSequenceNumber!==e&&(g=_.findWhere(b._view.groupSeen.seenParticipants,{userId:b._view.groupSeen.rawParticipants[l].userId}),g&&b._view.groupSeen.seenParticipants.splice(_.indexOf(b._view.groupSeen.seenParticipants,g),1))}else b._view.groupSeen={},b._view.groupSeen.seenParticipants=d,b._view.groupSeen.rawParticipants=c;h=_.findWhere(b._view.groupSeen.seenParticipants,{userId:a.thisUser.userId}),h&&b._view.groupSeen.seenParticipants.splice(_.indexOf(b._view.groupSeen.seenParticipants,h),1),b._view.groupSeen.seenParticipants.sort(function(a,b){return a.userId<b.userId?-1:1}),i=b._view.groupSeen.seenParticipants.length,b._view.groupSeen&&i>j?(b._view.groupSeen.moreParticipantsCount=i-j,b._view.groupSeen.moreParticipantsCount>k&&(b._view.groupSeen.moreParticipantsCount=k)):b._view.groupSeen&&(b._view.groupSeen.moreParticipantsCount="")}}function e(a){for(var b,c,d=[],e=0,f=0,h=a.messages.length-1;h>-1;h--)if(a.messages[h].type===g.chatsdk.MessageType.MESSAGE){e=a.messages[h].getSequenceNumber(),f=h;break}for(var i in a.participants){var j={userId:a.participants[i].userId,lastSeenMessageSequenceNumber:a.participants[i].lastSeenMessageSequenceNumber};if(b=a.messageForSequenceNumber(a.participants[i].lastSeenMessageSequenceNumber),c=b?b.type:"",a.participants[i].status===g.chatsdk.ParticipantStatus.LEFT||c===g.chatsdk.MessageType.LEFT||c===g.chatsdk.MessageType.INVITE)for(;b&&(j.lastSeenMessageSequenceNumber--,b=a.messageForSequenceNumber(j.lastSeenMessageSequenceNumber),c=b?b.type:"",c!==g.chatsdk.MessageType.MESSAGE););else j.lastSeenMessageSequenceNumber>e&&(j.lastSeenMessageSequenceNumber=e);d.push(j)}return d}function f(a,b){var c=a.getOtherParticipant();b.getSequenceNumber()==c.lastSeenMessageSequenceNumber?(b._view.seen={},b._view.seen.seenParticipant=c):b._view.seen&&b.getSequenceNumber()!==c.lastSeenMessageSequenceNumber&&(b._view.seen.seenParticipant=null)}function h(b,c){var d=!1,e=b.getTimestamp();if(c){var f=c.getTimestamp();a.isDayDiff(e,f)?d=!0:e-f>3e5&&(e-f>36e5?d=!0:b._view.addBubblePadding=1),c.senderId!=b.senderId&&(b._view.addBubblePadding=1)}else d=!0;return d?(b._view.showDate=!0,b._view.dateToShow=a.dateSeparatorFromCurrentTime(e,!0)):this.showMessageDate&&(b._view.showDate=!1),d}var i={102:"<user-name> started an Appear.in video call.<br/>\ud83c\udfa5 "},j=14,k=9;return{msgSentOnly:function(d,e,f){var j=d.messages,k=f||j.length-1,l=j[k];if(j[k].type!=g.chatsdk.MessageType.MESSAGE||l.isSystemMessage){if(j[k].type==g.chatsdk.MessageType.INVITE){var m=j[k].invitees[j[k].messageText];j[k]._view={invite:1,messageToDisplay:"You have invited "+m},h(j[k],j[k-1])}else if(j[k].type==g.chatsdk.MessageType.LEFT){if(j[k].senderId==e){var m=j[k].invitees[j[k].messageText];j[k]._view={invite:1,messageToDisplay:"You have left this chat. "}}h(j[k],j[k-1])}else if(l.type==g.chatsdk.MessageType.CHAT_TITLE_UPDATE)l.senderId==e&&(l._view={isSystemMessage:1,messageToDisplay:"You named this group chat "+l.messageText}),h(j[k],j[k-1]);else if(l.type==g.chatsdk.MessageType.CHAT_IMAGE_UPDATE)l.senderId==e&&(l._view={isSystemMessage:1,messageToDisplay:"You changed the group photo."}),h(j[k],j[k-1]);else if(l.isSystemMessage){var n,o=l.senderId===e?"You":b.getUser(l.senderId).firstName;if("101"==l.isSystemMessage||"102"==l.isSystemMessage||"103"==l.isSystemMessage)try{n=i[l.isSystemMessage],n=n.replace("<user-name>",o);var p=$("<div>").append(l.messageText).find("a"),q=p.attr("href"),r=p.text();n=n+'<a href="'+q+'" data-participants-count="'+_.keys(d.participants).length+'">"'+r+'"</a>'}catch(s){n=l.messageText}else n=l.messageText;l._view={isSystemMessage:1,messageToDisplay:n},h(j[k],j[k-1])}}else{if(j[k]._view||(j[k]._view={otherUserWithImg:0,otherUserWithoutImg:0,thisUserWithImg:0,thisUserWithoutImg:0,_user:null,showUserName:0,time:0,showDate:0,dateToShow:null,seen:0,left:0,invite:0,messageToDisplay:null,messageText:null}),j[k]._view.messageText=j[k].messageText.replace(/\n/gi,"<br>"),j[k]._view.isSingleEmoji=c.isTextSingleEmoji(j[k].messageText),j[k].fileInfo&&j[k].fileInfo.fileId){j[k].fileInfo.ver=3;var t=+j[k].fileInfo.width,u=+j[k].fileInfo.height;j[k].fileInfo.thumbnailName?(t>u&&t>200&&(u*=200/t,t=200),u>200&&(t*=200/u,u=200),50>t&&(t=0==t?180:50),50>u&&(u=50)):(t=180,u=100),j[k].fileInfo.fileHeight=u+"px",j[k].fileInfo.fileWidth=t+"px",j[k].fileInfo.type=j[k].fileInfo.type.toUpperCase(),j[k].fileInfo.thumbnail_name=j[k].fileInfo.thumbnailName}j[k].senderId==e&&(j[k]._view.thisUserWithoutImg=1),j[k]._view.time=a.getTimeFormatHmma(j[k].getTimestamp());var v=h(j[k],j[k-1]);if(j[k-1]&&v)for(var w=0,x=k-1;x>=0;x--){if(2==w){w=0;break}j[x]&&j[x]._view&&1==j[x]._view.showDate&&(j[x]._view.dateToShow=a.dateSeparatorFromCurrentTime(j[x].getTimestamp(),!0),w++)}}return j},msgReceiveOnly:function(j,k){var l=j.messages,m=l.length-1,n=l[m];if(n.type!=g.chatsdk.MessageType.MESSAGE||n.isSystemMessage){if(n.type==g.chatsdk.MessageType.LEFT){if(n.senderId==k)n._view={left:1,messageToDisplay:"You have left this chat. "};else{var o=" ",p=b.getUser(n.senderId);o=p?p.getDisplayName():j.participants[n.senderId].name,n._view={left:1,messageToDisplay:o+" has left this chat."}}h(n,l[m-1])}else if(n.type==g.chatsdk.MessageType.INVITE)if(n.senderId==k){var q=n.messageText.split(","),r="";r+=n.invitees[q[0]],q[0]==k&&(r="You"),q.length>1&&(r+=" and "+(q.length-1)+" others"),n._view={invite:1,messageToDisplay:"You have invited "+r}}else{var s=" ",p=b.getUser(n.senderId);s=p?p.getDisplayName():j.participants[n.senderId].name;var q=n.messageText.split(","),r="";r+=q[0]==k?"You":n.invitees[q[0]],q.length>1&&(r+=" and "+(q.length-1)+" others"),n._view={invite:1,messageToDisplay:s+" has invited "+r}}else if(n.type==g.chatsdk.MessageType.CHAT_TITLE_UPDATE){if(n._view={isSystemMessage:1,messageToDisplay:"named this group chat "+n.messageText},n.senderId==k)n._view.messageToDisplay="You "+n._view.messageToDisplay;else{var t="",p=b.getUser(n.senderId);t=p?p.getDisplayName():j.participants[n.senderId].name,n._view.messageToDisplay=t+" "+n._view.messageToDisplay}h(n,l[m-1])}else if(n.type==g.chatsdk.MessageType.CHAT_IMAGE_UPDATE){if(n._view={isSystemMessage:1},n.senderId==k)n._view.messageToDisplay="You changed the group photo.";else{var t,p=b.getUser(n.senderId);t=p?p.getDisplayName():chat.participants[n.senderId].name,n._view.messageToDisplay=t+" changed the group photo."}h(n,l[m-1])}else if(n.isSystemMessage){var u,t=n.senderId===k?"You":b.getUser(n.senderId).firstName;if("101"==n.isSystemMessage||"102"==n.isSystemMessage||"103"==n.isSystemMessage)try{u=i[n.isSystemMessage],u=u.replace("<user-name>",t);var v=$("<div>").append(n.messageText).find("a"),w=v.attr("href"),x=v.text();u=u+'<a href="'+w+'" data-participants-count="'+_.keys(j.participants).length+'">"'+x+'"</a>'}catch(y){u=n.messageText}else u=n.messageText;n._view={isSystemMessage:1,messageToDisplay:u},h(n,l[m-1])}}else{if(!n._view){if(n._view={otherUserWithImg:0,otherUserWithoutImg:0,thisUserWithImg:0,thisUserWithoutImg:0,_user:null,showUserName:0,time:0,showDate:0,dateToShow:null,seen:0,left:0,invite:0,messageToDisplay:null,messageText:null},l[m]=n,n._view.messageText=n.messageText.replace(/\n/gi,"<br>"),n._view.isSingleEmoji=c.isTextSingleEmoji(n.messageText),n.fileInfo&&n.fileInfo.fileId){n.fileInfo.ver=3;var z=+n.fileInfo.width,A=+n.fileInfo.height;n.fileInfo.thumbnailName?(z>A&&z>200&&(A*=200/z,z=200),A>200&&(z*=200/A,A=200),50>z&&(z=0==z?180:50),50>A&&(A=50)):(z=180,A=100),n.fileInfo.fileHeight=A+"px",n.fileInfo.fileWidth=z+"px",n.fileInfo.type=n.fileInfo.type.toUpperCase(),n.fileInfo.thumbnail_name=n.fileInfo.thumbnailName}if(n.senderId!=k){n._view.showUserName=1,n._view.otherUserWithImg=1;var p=b.getUser(n.senderId);p?n._view._user=p:(n._view._user=j.participants[n.senderId],n._view._user.displayName=n._view._user.name)}else n.senderId==k&&(n._view.otherUserWithImg=0,n._view.thisUserWithoutImg=1);if(n._view.time=a.getTimeFormatHmma(n.getTimestamp()),n.senderId!=k&&(n._view.otherUserWithImg=1,n._view.otherUserWithoutImg=0),l[m-1]){n.senderId!=l[m-1].senderId?(n._view.showUserName=1,n._view.addBubblePadding=1):(n._view.showUserName=0,n._view.addBubblePadding=0),l[m-1].senderId==n.senderId&&n.senderId!=k&&1==l[m-1]._view.otherUserWithImg&&(l[m-1]._view.otherUserWithImg=0,l[m-1]._view.otherUserWithoutImg=1);var B=h(l[m],l[m-1]);if(B)for(var C=0,D=m-1;D>-1;D--){if(2==C){C=0;break}1==l[D]._view.showDate&&(l[D]._view.dateToShow=a.dateSeparatorFromCurrentTime(l[D].getTimestamp(),!0),C++)}}else n._view.showDate=1,n._view.dateToShow=a.dateSeparatorFromCurrentTime(n.getTimestamp(),!0)}if(1==j.chatType)for(var D=l.length-1;D>-1;D--)l[D]._view&&f(j,l[D])}if(2==j.chatType)for(var E=e(j),D=l.length-1;D>-1;D--)l[D]._view&&d(j,l[D],E);return l},updateChatMessagesOnMessageSentComplete:function(a,b){for(var c=a.messages,d=a.thisUser.userId,e=c.length-1;e>-1;e--)if(b.messageId==c[e].messageId){c=e-1>=0&&!c[e-1]._view?this.renderLast20(a,d,a.getOtherParticipant().lastSeenMessageSequenceNumber,!0):this.msgSentOnly(a,d,e);break}return c},renderLast20:function(j,k,l,m,n){var o;o=n?j.searchInfo.messages:j.messages;var p=o.length,q=p;p>20&&(q=p-20),m&&(q=p);for(var r=q-1;r>=0;r--)o[r]._view={otherUserWithImg:0,otherUserWithoutImg:0,thisUserWithImg:0,thisUserWithoutImg:0,_user:null,showUserName:0,time:0,showDate:0,dateToShow:null,seen:0,left:0,invite:0,messageToDisplay:null,messageText:null};for(var s=e(j),r=q-1;r>=0;r--){var t=o[r],u=t._view,v=o[r-1],w=o[r+1];if(n&&(r===o.length-1||0===r)&&(o.length>1?0===r&&1!=t.getSequenceNumber()?(u.showLoadMoreMessages=!0,u.fromSeqNo=t.getSequenceNumber()-20,u.toSeqNo=t.getSequenceNumber()-1):0!=r&&t.getSequenceNumber()!=j.lastMessageSequenceNumber&&(u.showLoadMoreMessagesBelow=!0,u.fromSeqNoFromBelow=t.getSequenceNumber()+1,u.toSeqNoFromBelow=t.getSequenceNumber()+20):(1!=t.getSequenceNumber()&&(u.showLoadMoreMessages=!0,u.fromSeqNo=t.getSequenceNumber()-20,u.toSeqNo=t.getSequenceNumber()-1),t.getSequenceNumber()!=j.lastMessageSequenceNumber&&(u.showLoadMoreMessagesBelow=!0,u.fromSeqNoFromBelow=t.getSequenceNumber()+1,u.toSeqNoFromBelow=t.getSequenceNumber()+20))),t.type!=g.chatsdk.MessageType.MESSAGE||t.isSystemMessage){if(t.type==g.chatsdk.MessageType.INVITE)if(t.senderId==k){var x=t.messageText.split(","),y="";y+=t.invitees[x[0]],x[0]==k&&(y="You"),x.length>1&&(y+=" and "+(x.length-1)+" others"),u.invite=1,u.messageToDisplay="You have invited "+y}else{var z=" ",A=b.getUser(t.senderId);z=A?A.getDisplayName():j.participants[t.senderId].name;var x=t.messageText.split(","),y="";y+=x[0]==k?"You":t.invitees[x[0]],x.length>1&&(y+=" and "+(x.length-1)+" others"),u.invite=1,u.messageToDisplay=z+" has invited "+y}else if(t.type==g.chatsdk.MessageType.LEFT){var B=" ";if(k==t.senderId)B="You",u.left=1,u.messageToDisplay=B+" have left this chat.";else{var A=b.getUser(t.senderId);B=A?A.getDisplayName():j.participants[t.senderId].name,u.left=1,u.messageToDisplay=B+" has left this chat."}}else if(t.type==g.chatsdk.MessageType.CHAT_TITLE_UPDATE){var C=" ";if(u.isSystemMessage=1,u.messageToDisplay="named this group chat "+t.messageText,k==t.senderId)u.messageToDisplay="You "+u.messageToDisplay;else{var A=b.getUser(t.senderId);C=A?A.getDisplayName():j.participants[t.senderId].name,u.messageToDisplay=C+" "+u.messageToDisplay}}else if(t.type==g.chatsdk.MessageType.CHAT_IMAGE_UPDATE){if(u.isSystemMessage=1,t.senderId==k)u.messageToDisplay="You changed the group photo.";else{var C,A=b.getUser(t.senderId);C=A?A.getDisplayName():chat.participants[t.senderId].name,u.messageToDisplay=C+" changed the group photo."}h(t,o[r-1])}else if(t.isSystemMessage){var D,C=t.senderId===k?"You":b.getUser(t.senderId).firstName;if("101"==t.isSystemMessage||"102"==t.isSystemMessage||"103"==t.isSystemMessage)try{D=i[t.isSystemMessage],D=D.replace("<user-name>",C);var E=$("<div>").append(t.messageText).find("a"),F=E.attr("href"),G=E.text();D=D+'<a href="'+F+'" data-participants-count="'+_.keys(j.participants).length+'">"'+G+'"</a>'}catch(H){D=t.messageText}else D=t.messageText;u.isSystemMessage=1,u.messageToDisplay=D}}else{if(u.messageText=t.messageText.replace(/\n/gi,"<br>"),u.isSingleEmoji=c.isTextSingleEmoji(t.messageText),t.fileInfo&&t.fileInfo.fileId){t.fileInfo.ver=3;var I=+t.fileInfo.width,J=+t.fileInfo.height;o[r].fileInfo.thumbnailName?(I>J&&I>200&&(J*=200/I,I=200),J>200&&(I*=200/J,J=200),50>I&&(I=0==I?180:50),50>J&&(J=50)):(I=180,J=100),t.fileInfo.fileHeight=J+"px",t.fileInfo.fileWidth=I+"px",t.fileInfo.type=t.fileInfo.type.toUpperCase(),t.fileInfo.thumbnail_name=t.fileInfo.thumbnailName}if(t.senderId==k)u.thisUserWithoutImg=1;else{w&&w.senderId==t.senderId&&w.type==g.chatsdk.MessageType.MESSAGE?(u.otherUserWithImg=0,u.otherUserWithoutImg=1):(u.otherUserWithImg=1,u.otherUserWithoutImg=0);var K=b.getUser(t.senderId);K?(u._user=K,K.displayName=K.getDisplayName()):(u._user=j.participants[t.senderId],u._user.displayName=u._user.name),v&&(1==v._view.otherUserWithImg&&v.senderId==t.senderId&&(v._view.otherUserWithImg=0,v._view.otherUserWithoutImg=1),v.senderId!=t.senderId&&(u.showUserName=1))}u.time=a.getTimeFormatHmma(t.getTimestamp()),1==j.chatType?f(j,t):d(j,t,s),v?n&&t.getSequenceNumber()-v.getSequenceNumber()>1&&(u.showLoadMoreMessages=!0,u.fromSeqNo=v.getSequenceNumber()+1,u.toSeqNo=t.getSequenceNumber()-1):(u.showDate=1,u.dateToShow=a.dateSeparatorFromCurrentTime(t.getTimestamp(),!0))}h(o[r],o[r-1]),t._view=u,o[r]=t}return o},renderP2PSeen:function(a,b,c){for(var d=b.length-1;d>-1;d--)b[d]._view&&f(a,b[d]);return b},renderGroupSeen:function(a,b,c,e){for(var f=b.length-1;f>-1;f--)b[f]._view&&d(a,b[f],e);return b}}}]),b.module("convoApp").directive("cnvChatApp",["$compile","$templateCache","appLoadSequenceManager",function(a,b,c){return{restrict:"E",scope:!0,link:function(d,e,f){function g(){function c(){}function f(){}var g="chat/client/cnvChatApp.tpl.html",h=a(b.get(g))(d);e.empty().append(h),d.chat_app_leak_finder=new c,e[0].chat_app_elment_leak_finder=new f}c.okToLoad(c.comps.CHAT_APP)?g():c.once("okToLoad"+c.comps.CHAT_APP,function(){g()})}}}]),b.module("convoApp").directive("cnvChatHeadBubble",["chatManager","appTabs","$filter","appsInfo","AppLinks","$location","$rootScope","config","chatUsersManager",function(b,d,e,f,h,i,j,k,l){return{restrict:"E",scope:!0,templateUrl:"chat/client/cnvChatHeadBubble.tpl.html",link:function(d,m,n){function o(a,c){chat=b.getChat(c),chat&&setTimeout(function(){q(chat)},1e3)}function p(){return x||(x=$(".chatHeadBubble")),x}function q(a){if(!w){if(x=p(),d.chat&&(a=null),!a&&d.currentFocusedChatWindow){var c=d.currentFocusedChatWindow.chatId;!c||d.chat&&d.chat.chatId==c||(a=b.getChat(c))}a&&(z=!0,$("#intercom-io-btn").css({"z-index":"99"}),x.css({"z-index":"100",right:"40px"}),setTimeout(function(){x.css({transform:"scale(1.15)",transition:"transform 0.2s","z-index":"100",right:"40px"}),setTimeout(function(){x.css({transform:"scale(1)",transition:"transform 0.2s"})},200)},50),d.participantsList=a.getParticipantsAsArray(),d.participantsList&&0!=d.participantsList.length||(d.participantsList=[l.getThisUser()]),d.chat=a,d.$broadcast("chatUpdated",a.chatId),d.$broadcast("refreshImage"),d.$broadcast("render"))}}function r(){if(!z){var a=p();a.css({right:"55px",transition:"right 0.2s"}),y&&clearTimeout(y),y=setTimeout(function(){$("#intercom-io-btn").css({"z-index":"99"}),a.css({"z-index":"100",right:"40px"})},200),z=!0}}function s(){if(z){var a=p();a.css({right:"55px",transition:"right 0.2s"}),y&&clearTimeout(y),y=setTimeout(function(){$("#intercom-io-btn").css({"z-index":"101"}),a.css({"z-index":"99",right:"40px"})},200),z=!1}}function t(){}function u(){b.removeListener(g.chatsdk.ChatEvents.CONNECTED,u),setTimeout(function(){v()},100)}function v(){var a=i.path(),c=i.search(),d=i.hash(),e=h.urlToLink(a,c,d);if(e.data&&"21"==e.data.resource_type){var f=e.resourcePath,k=f.hierarchy[0].uid;chat=b.getChat(k),chat?setTimeout(function(){q(chat)},1e3):b.isConnected()||b.addListener(g.chatsdk.ChatEvents.CONNECTED,u)}else j.fullViewChatItem&&setTimeout(function(){q(j.fullViewChatItem.chat),j.fullViewChatItem=null},1e3)}var w=!1;d.$on("resourceOpenedFromChat",o);var x;d.closeChatHead=function(){return d.chat=null,d.$broadcast("render"),!1},d.getChatImageThumbnailPath=function(a){return e("getChatImageThumbnailPath")(a.chatId,"96x96",a.getIconVersion())},d.openFullChat=function(){if(d.chat){w=!0;var b=d.chat.getTitle(),e=f.getFullViewChatAppUrl(d.chat.chatId,c,b);d.closeChatHead(),p().trigger("mouseout");var g=j.showingLargeChatGallery||k.IS_NATIVE?"_self":"_blank";a.open(e,g)}},m.hover(r,t);var y,z=!0;$("#intercom-io-btn").hover(s,t),v(),d.$on("$destroy",function(){m.off("mouseenter mouseleave"),$("#intercom-io-btn").off("mouseenter mouseleave")})}}}]),b.module("convoApp").directive("cnvChatManager",["$compile","utils","chatManager","UserProfileImage","chatUsersManager","msgListRenderer","desktopNotificationsService","chatService","localStore","appStateInfo","appTitleManager","userInfo","appTabs","settingsService","mixpanelService","config","logger","userImgUrlFilter","UserPresenceManager","NewChatWindowDataManager","$rootScope",function(b,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){return{link:function(b,c,f){function i(){}function r(){}function t(){if(!b.localStoreLoaded){oa&&oa.version==ma-1&&l.writeData(la,[],ma-1),oa&&oa.version==ma?(b.chatHistory=oa.data,b.chatHistory=_.sortBy(b.chatHistory,"order")):b.chatHistory=[];for(var a=0;a<b.chatHistory.length;a++)if(b.chatHistory[a].chatId||"chatList"!=b.chatHistory[a].name){var c=e.getChat(b.chatHistory[a].chatId);c?(c.chatType==g.chatsdk.ChatType.P2P&&(h.getUserById(c.getOtherParticipant(c.thisUser.userId).userId)?c._user=h.getUserById(c.getOtherParticipant(c.thisUser.userId).userId):h.getInaccessibleUserById(c.getOtherParticipant(c.thisUser.userId).userId)&&(c._user=h.getInaccessibleUserById(c.getOtherParticipant(c.thisUser.userId).userId))),F(null,c,{isMinimized:b.chatHistory[a].isMinimized,height:b.chatHistory[a].height,isOpenedFromLS:!0})):e.openChatFromId(b.chatHistory[a].chatId,b.chatHistory[a].chatType,null,b.chatHistory[a].chatParticipants,{fromLocalStore:!0,isMinimized:b.chatHistory[a].isMinimized,height:b.chatHistory[a].height})}else b.chatHistory[a].isMinimized?(b.mainChatsListProperties.isMinimized=!0,b.$broadcast("minChatList",b.chatHistory[a].height)):(b.mainChatsListProperties.isMinimized=!1,b.$broadcast("maxChatList",b.chatHistory[a].height));b.localStoreLoaded=!0,oa=null,b.$broadcast("cachedChatsLoaded"),b.okToDigest||setTimeout(function(){b.okToDigest=!0,b.runDigestOnScope(!0)},1)}}function u(){for(var a=(b.mainChatsListProperties.isMinimized?b.WINDOW_MINIMIZED_WIDTH:b.CHAT_LIST_MAXIMIZED_WIDTH)+b.SPACE_BETWEEN_CHAT_LIST_AND_CHAT_WINDOWS-2,c=0;c<b.chatWindows.length;c++)c>0&&(a+=(b.chatWindows[c-1].metaDetails.isMinimized?b.WINDOW_MINIMIZED_WIDTH:b.CHAT_WINDOW_MAXIMIZED_WIDTH)+b.SPACE_BETWEEN_WINDOWS),b.chatWindows[c].metaDetails.xPosition=a+"px";if(b.dockedWind.length>0&&b.chatWindows.length>0){var d=a+(b.chatWindows[b.chatWindows.length-1].metaDetails.isMinimized?b.WINDOW_MINIMIZED_WIDTH:b.CHAT_WINDOW_MAXIMIZED_WIDTH)+b.SPACE_BETWEEN_WINDOWS;b.$broadcast("renderOnDockedWindowsPositionUpdated",d)}b.$broadcast("renderOnPositionUpdated")}function v(a){if(b.chatWindows.length>0){for(var c=(b.mainChatsListProperties.isMinimized?b.WINDOW_MINIMIZED_WIDTH:b.CHAT_LIST_MAXIMIZED_WIDTH)+b.SPACE_BETWEEN_CHAT_LIST_AND_CHAT_WINDOWS-2,d=0;d<b.chatWindows.length;d++)c+=(b.chatWindows[d].metaDetails.isMinimized?b.WINDOW_MINIMIZED_WIDTH:b.CHAT_WINDOW_MAXIMIZED_WIDTH)+b.SPACE_BETWEEN_WINDOWS;return!b.isDockingNeededToOpenChatWindow(c,a)}return!0}function y(){return pa()}function z(a,c,d){var e;b.dockedWind.length>0&&(e=b.dockedWind[b.dockedWind.length-1]);var f=d||c||e&&e.metaDetails.isMinimized;return b.dockedWind.length&&v(f)?(a&&(e.metaDetails.isDocked=!1),F(null,e.chatObj,e.metaDetails,a,c,d),void z(a,c,d)):void(b.$$phase||b.$digest())}function A(a,c,d,e){if(b.chatWindows.length<=1||!y())return void I();var f=b.chatWindows[b.chatWindows.length-1];(c||d)&&f.chatObj.chatId===e&&b.chatWindows.length-2>=0?(f=b.chatWindows[b.chatWindows.length-2],b.chatWindows.splice(b.chatWindows.length-2,1)):b.chatWindows.splice(b.chatWindows.length-1,1),f.metaDetails.isDocked=!0,b.dockedWind.push(f),b.$broadcast("renderOnDockedWindowsUpdated"),u(),b.runDigestOnScope(!1),A(a,c,d,e)}function B(a,c,e){for(var f,g=0;g<b.chatWindows.length;g++)if(b.chatWindows[g].chatObj.chatId===c){f=b.chatWindows[g];break}e||p.dispatchTabsEvent2("closeChatWindow",{tabId:b.tabId,chatId:c});var h=_.indexOf(b.chatWindows,f);b.chatWindows.splice(h,1),u(),z(!1,!0),b.chatWindows[h-1]&&0==b.chatWindows[h-1].chatObj.unreadCount&&b.focusedChatWindow(b.chatWindows[h-1].chatObj.chatId),setTimeout(function(){d.fireEvent(document.body,"mouseup")},0);var a=d.createEvent("recalculateAutocompletePosition");
document.dispatchEvent(a);var i=w.getNewChatData();i&&i.chatId==c&&w.removeNewChat(),e||I()}function C(){if(-1==qa){var a=1;0!==ja&&(a=ja/ia),qa=Math.max(ia-$("body").width(),0)*a}return qa}function D(a){a.chat.searchInfo&&a.meta?F(null,a.chat,{isSearchMode:!0,isOpenedOnUserAction:a.meta.isOpenedOnUserAction}):a.meta?F(null,a.chat,{isOpenedFromLS:a.meta.fromLocalStore,isMinimized:a.meta.isMinimized,isDocked:a.meta.isDocked,height:a.meta.height,fromOtherTab:a.meta.fromOtherTab,isOpenedOnUserAction:a.meta.isOpenedOnUserAction}):F(null,a.chat)}function E(a){var c=a.chat,d=a.message;if(d.type!=g.chatsdk.MessageType.LEFT&&d.type!=g.chatsdk.MessageType.PARTICIPANT_REMOVED){for(var e,f=!1,h=0;h<b.chatWindows.length;h++)if(c.chatId==b.chatWindows[h].chatObj.chatId){f=!0,e=b.chatWindows[h];break}for(var h=0;h<b.dockedWind.length;h++)if(c.chatId==b.dockedWind[h].chatObj.chatId){f=!0,e=b.dockedWind[h];break}var i=d.senderId,k=c.participants[i],l=c.thisUser.userId,r=c.participants[l];if(i===b.thisUser.userId||f||d.skipNotification||c.isMuted?f&&e.metaDetails.isSearchMode&&i===b.thisUser.userId&&b.$broadcast("closeChatSearchMode",c.chatId):F(null,c,{isOpenedOnUserAction:!1}),!c.isMuted&&r.lastSeenMessageSequenceNumber<a.message._sequenceNumber&&j.showChatNotification(c),q.getChatSettings().then(function(b){b.play_sound_on_notification&&q.isBitONOFF(parseInt(b.play_sound_on_notification),q.DESKTOP)&&i!=o.user_id&&!c.isMuted&&p.isThisTabLastActiveTab()&&!a.message.skipNotification&&a.message.type==g.chatsdk.MessageType.MESSAGE&&na&&na.play()}),d.type===g.chatsdk.MessageType.MESSAGE&&i!=o.user_id&&!c.isMuted&&r.lastSeenMessageSequenceNumber<a.message._sequenceNumber){var s=k.name.split(" ")[0]+" says...";if(!m.appHasFocus()||!m.isAppActivated()||m.isAppInShortIdleState())if(_.findWhere(b.chatsToBlinkInTab,{chatObj:c})){var t=_.indexOf(b.chatsToBlinkInTab,_.findWhere(b.chatsToBlinkInTab,{chatObj:c}));_.contains(b.chatsToBlinkInTab[t].titles,s)||b.chatsToBlinkInTab[t].titles.push(s)}else b.chatsToBlinkInTab.push({chatObj:c,titles:[s]});n.toggleAppTitleWith(s)}b.$broadcast("render_date")}}function F(a,c,d,f,i,j){var k,l,m=!1;if(!c._user&&c.chatType==g.chatsdk.ChatType.P2P)for(var n in c.participants)c.thisUser.userId!=n&&(c._user=h.getUserById(n));if(d&&!d.isOpenedFromLS&&!d.fromOtherTab&&d.isOpenedOnUserAction&&!f&&!i&&!j){var o={};c.isInviteChat&&(k=c._user,o.isInviteChat=!0),c.chatId!==w.getNewChatId()&&(o.tabId=b.tabId,o.chatId=c.chatId,o.chatType=c.chatType,o.users=c.participants,o.isOpenedOnUserAction=d.isOpenedOnUserAction,o.user=k,p.dispatchTabsEvent2("openChatWindow",o))}for(var q=0;q<b.chatWindows.length;q++)if(c.chatId==b.chatWindows[q].chatObj.chatId){l=!0;break}for(var q=0;q<b.dockedWind.length;q++)if(c.chatId==b.dockedWind[q].chatObj.chatId){l=!0;break}if(l){for(var r,q=0;q<b.chatWindows.length;q++)if(c.chatId===b.chatWindows[q].chatObj.chatId){m=!1,r=b.chatWindows[q];break}for(var q=0;q<b.dockedWind.length;q++)if(c.chatId===b.dockedWind[q].chatObj.chatId){m=!0,r=b.dockedWind[q];break}if(m){var s=i||j||r.metaDetails.isMinimized;if(b.chatManagerConnected&&(c.isNewChat?c.chat&&e.chatOpened(c.chat):e.chatOpened(c)),v(s))b.dockedWind.splice(_.indexOf(b.dockedWind,r),1);else{var t=b.chatWindows[b.chatWindows.length-1];b.chatWindows.splice(b.chatWindows.length-1,1),b.dockedWind.splice(_.indexOf(b.dockedWind,r),1),t.metaDetails.isDocked=!0,b.dockedWind.push(t)}H(c,d,r.metaDetails),b.$broadcast("renderOnDockedWindowsUpdated")}else b.$broadcast("maxChatWin",r.metaDetails.eChatId,!0)}else if(b.chatManagerConnected&&(c.isNewChat?c.chat&&e.chatOpened(c.chat):e.chatOpened(c)),v())p.isThisTabLastActiveTab()||(d?d.isMinimized=!0:d={isMinimized:!0}),H(c,d);else{if(d.isOpenedOnUserAction){var t=b.chatWindows[b.chatWindows.length-1];t.metaDetails.isDocked=!0,b.dockedWind.push(t),H(c,d),b.chatWindows.splice(b.chatWindows.length-2,1),b.$broadcast("renderOnDockedWindowsUpdated")}b.localStoreLoaded||G(c)}u(),A(!1,!1,!0,c.chatId),d&&d.isOpenedFromLS&&!d.fromOtherTab||(b.runDigestOnScope(!1),d&&(d.isOpenedFromLS=!1)),d&&d.fromOtherTab||I()}function G(a){var c={};c.chatObj=a,c.metaDetails={},c.metaDetails.isDocked=!0,b.dockedWind.push(c)}function H(a,c,d){var e={};e.chatObj=a,e.metaDetails={},e.metaDetails.isSearchMode=c?c.isSearchMode:!1,e.metaDetails.isMinimized=c?c.isMinimized:!1,e.metaDetails.isOpenedFromLS=c?c.isOpenedFromLS:!1,e.metaDetails.height=c?c.height:0,e.metaDetails.scrollToBot=!0,e.metaDetails.eChatId="c"+a.chatId,e.metaDetails.eMsgWinId="m"+a.chatId,e.metaDetails.inputText="",e.metaDetails.rangeSelection=null,d&&(e.metaDetails.isSearchMode=d.isSearchMode,e.metaDetails.inputText=d.inputText||"",e.metaDetails.rangeSelection=d.rangeSelection),a.isInviteChat&&(b.inviteChatsMapper[a.chatId]=a),c&&c.isOpenedOnUserAction&&(e.metaDetails.isOpenedOnUserAction=!0),c&&c.isDocked&&(e.metaDetails.isDocked=!1,e.metaDetails.isMinimized=!0),b.chatWindows.push(e)}function I(){if(b.localStoreLoaded){if(p.isThisTabLastActiveTab()){b.chatHistory=[];var a={};if(a.name="chatList",b.mainChatsListProperties&&b.mainChatsListProperties.listWinHeight)a.height=b.mainChatsListProperties.listWinHeight;else{var d=$("#chatUserListMainWindow",c);d&&d.length>0?a.height=Math.ceil($("#chatUserListMainWindow",c).height())+1:a.height=26}b.mainChatsListProperties.isMinimized?a.isMinimized=!0:a.isMinimized=!1,b.chatHistory.push(a);for(var e=0;e<b.chatWindows.length;e++)if(!(k.isAdminModeON()||b.chatWindows[e].chatObj.isInviteChat||b.chatWindows[e].chatObj.isNewChat)){var f={};f.chatId=b.chatWindows[e].chatObj.chatId,f.isMinimized=b.chatWindows[e].metaDetails.isMinimized,f.name=b.chatWindows[e].chatObj.getTitle(),f.chatType=b.chatWindows[e].chatObj.chatType,f.chatParticipants=_.values(b.chatWindows[e].chatObj.participants),f.height=b.chatWindows[e].metaDetails.height,b.chatHistory.push(f)}for(var e=0;e<b.dockedWind.length;e++){var g=b.dockedWind[e].chatObj;if(!(k.isAdminModeON()||g.isInviteChat||g.isNewChat)){var f={};f.chatId=g.chatId,f.isMinimized=!1,f.name=g.getTitle(),f.chatType=g.chatType,f.chatParticipants=_.values(g.participants),f.height=b.dockedWind[e].metaDetails.height,b.chatHistory.push(f)}}l.writeData(la,b.chatHistory,ma)}}}function J(a){for(var c=0;c<b.chatsToBlinkInTab.length;c++)if(0==b.chatsToBlinkInTab[c].chatObj.unreadCount){n.clearToggleTitle(b.chatsToBlinkInTab[c].titles),b.chatsToBlinkInTab.splice(c,1);for(var c=0;c<b.chatsToBlinkInTab.length;c++)b.chatsToBlinkInTab[c].chatObj.unreadCount>0&&n.toggleAppTitleWithTitles(b.chatsToBlinkInTab[c].titles);break}}function K(){P()}function L(){P()}function M(a){if(a.tabId!=b.tabId&&b.localStoreLoaded){var c=e.getChat(a.chatId);if(c)F(null,c,{fromOtherTab:!0,isOpenedOnUserAction:a.isOpenedOnUserAction});else if(a.isInviteChat){var d=new g.chatsdk.Contact;d.setContactInfoFromModel(a.user);var f=e.startChatWithUser(d,!0);f._user=d,F(null,f,{fromOtherTab:!0,isOpenedOnUserAction:a.isOpenedOnUserAction})}else{var i=[];for(var j in a.users)a.users.hasOwnProperty(j)&&(h.getUserById(j)?i.push(h.getUserById(j)):h.getInaccessibleUserById(j)&&i.push(h.getInaccessibleUserById(j)));e.openChatFromId(a.chatId,a.chatType,null,i,{fromOtherTab:!0,isOpenedOnUserAction:a.isOpenedOnUserAction})}}}function N(a){a.tabId!=b.tabId&&b.localStoreLoaded&&B(null,a.chatId,{fromOtherTab:!0})}function O(a){a.tabId!=b.tabId&&P(null,!0)}function P(d,e){var f=a.innerWidth,g=a.document.body.clientHeight-60;if(x.networkAlertDisplayed&&(g-=30),qa=-1,windowHeight=g,ia!=f&&(ia>f?A(!0):z(!0),ia=f,!e)){var h={};h.tabId=b.tabId,p.dispatchTabsEvent2("onWindowResize",h)}if(ka!=g){if(ka>g){for(var i=0;i<b.chatWindows.length;i++)b.chatWindows[i].metaDetails.height>g&&b.$broadcast("setChatWindowHeight",b.chatWindows[i].metaDetails.eChatId,g);$("#chatUserListMainWindow",c).height()>g&&b.$broadcast("setChatListHeight",g),I()}ka=g}ja=a.outerWidth,ia=f,C()}function Q(a){b.chatWindows=[],b.dockedWind=[],a&&(I(),w.removeNewChat()),b.runRenderOnScope()}function R(){S()}function S(){a.Audio&&!na&&(na=new Audio("assets/sounds/chat_audio."+(s.IS_NATIVE?"wav":"mp3")))}function T(a){a&&F(null,a,{isClickOnDesktopNotif:!0,isOpenedOnUserAction:!0}),b.$emit("videoPlayback:MinimizeVideo")}function U(a){if(a){var c=e.startChatWithUser(a);c._user=a,F(null,c,{isClickOnDesktopNotif:!0,isOpenedOnUserAction:!0})}b.$emit("videoPlayback:MinimizeVideo")}function V(){b.$broadcast("render_date")}function W(){var a=w.getNewChatData();F(null,a,{isOpenedOnUserAction:!0})}function X(){var a=w.getNewChatId();Y(a)&&B(null,a)}function Y(a){for(var c=0;c<b.chatWindows.length;c++)if(b.chatWindows[c].chatObj.chatId==a)return b.chatWindows[c];return null}function Z(a,c){var d=c.chat,e=w.getNewChatData();if(d){Y(d.chatId)&&B(null,d.chatId);var f=Y(e.chatId);f.chatObj=d,f.metaDetails.eChatId="c"+d.chatId,f.metaDetails.eMsgWinId="m"+d.chatId,F(null,d,{isOpenedOnUserAction:!0}),b.currentFocusedChatWindow.chatId==e.chatId&&(b.currentFocusedChatWindow.chatId=d.chatId),w.removeNewChat(!0)}}function aa(){e.addListener(g.chatsdk.ChatEvents.CHAT_STARTED,D),e.addListener(g.chatsdk.ChatEvents.MESSAGE_RECEIVED,E)}function ba(){b.$on("openChatWindow",F),b.$on("closeChatWindow",B),b.$on("saveHistoryLS",I),b.$on("openCachedChats",t),b.$on("unReadCountChanged",J),b.$on("MainCtrl::appSwitchedToCompactSize",K),b.$on("MainCtrl::appSwitchedToDefaultSize",L),b.$on("convertNewChatToOrdinaryChat",Z)}function ca(){p.addTabsEventListener2("openChatWindow",M),p.addTabsEventListener2("closeChatWindow",N),p.addTabsEventListener2("onWindowResize",O)}function da(){o.on("userInfo.adminModeChanged",Q),s.on("clientTypeUpdated",R)}function ea(){j.on("CHAT_NOTIFICATION_CLICKED",T),j.on("USER_STATUS_NOTIFICATION_CLICKED",U)}function fa(){j.off("CHAT_NOTIFICATION_CLICKED",T),j.off("USER_STATUS_NOTIFICATION_CLICKED",U)}function ga(){aa(),ba(),ca(),da(),S(),ea(),setTimeout(function(){setTimeout(function(){C()},1)},1)}b.chat_manager_leak_finder=new i,c[0].chat_manager_leak_finder=new r,b.chatWindows=[],b.mainChatsListProperties={},b.mainChatsListProperties.isMinimized=!1,b.dockedWind=[],b.inviteChatsMapper={},b.chatsToBlinkInTab=[],b.tabId=d.generateUniqueId(),b.appInFoucs=!0,b.CHAT_WINDOW_MAXIMIZED_WIDTH=302,b.WINDOW_MINIMIZED_WIDTH=166,b.CHAT_LIST_MAXIMIZED_WIDTH=260,b.SPACE_BETWEEN_WINDOWS=4,b.SPACE_BETWEEN_CHAT_LIST_AND_CHAT_WINDOWS=16;var ha=4e4,ia=a.innerWidth,ja=a.outerWidth,ka=b.getVisibleBrowserHeight(),la="chatsHistory",ma=4;b.chatHistory=[],b.localStoreLoaded=!1;var na;b.currentFocusedChatWindow={chatId:null},k.init(function(a,b){if(a){var c=e.startChatWithUser(a);c._user=a,F(null,c,{isClickOnDesktopNotif:b,isOpenedOnUserAction:!0})}},function(a,c){a&&F(null,a,{isClickOnDesktopNotif:c,isOpenedOnUserAction:!0}),c&&b.$emit("videoPlayback:MinimizeVideo")},function(a,b){if(a){var c=h.getUserById(a),d=e.startChatWithUser(c);d._user=c,F(null,d,{isOpenedOnUserAction:b})}},function(a,b,c,d,f){e.openChatFromId(a,b,c,d,{isOpenedOnUserAction:f})},function(a,c,d,f,g,h){e.openChatInSearch(a,c,d,null,f,g,{isOpenedOnUserAction:h}),b.searchMatcingInfo=f},function(a){e.chatSearchResultsReceived(a)},function(a,b){if(a){var c=h.getUserByEmail(a),d=e.startChatWithUser(c,!0);d._user=c,F(null,d,{isOpenedOnUserAction:b})}});var oa=l.readData(la);b.$on("userManagerConnected",function(){b.runRenderOnScope(),b.$broadcast("refreshImage")}),b.thisUser=h.getThisUser(),b.focusedChatWindow=function(a){a&&b.$broadcast("setWindInFocus",a)},b.focusedOutChatWindow=function(a,c,d,e){a&&b.$broadcast("setWindOutOfFocus",a,c,d,e)},b.$on("presenceChanged",function(a,c,d){if(b.runRenderOnScope(),c)for(var e=0;e<c.length;e++)c[e].userId==b.thisUser.userId&&(b.thisUserStatus=c[e].presenceStatus,b.$broadcast("updateSettingsStatus",c[e].presenceStatus));("UPDATED"===d||"CONNECTED"===d)&&j.showUserStatusNotifications(c)}),b.$on("adjustWindPosOnMin",function(a,b,c,d){u(),b&&c?z(!1,!1,!0):!b&&c&&A(!1,!0,!1,d)}),b.isDockingNeededToOpenChatWindow=function(a,c){var d=10,e=ia-C()-d;return e-=c?b.WINDOW_MINIMIZED_WIDTH+b.SPACE_BETWEEN_WINDOWS:b.CHAT_WINDOW_MAXIMIZED_WIDTH+b.SPACE_BETWEEN_WINDOWS,e-=d,b.dockedWind.length>0&&(e-=80),a>=e?!0:!1};var pa=function(){var a,c;a=b.chatWindows[b.chatWindows.length-1],c=a.metaDetails.xPosition,c=parseInt(c.substring(0,c.length-2)),c+=a.metaDetails.isMinimized?b.WINDOW_MINIMIZED_WIDTH:b.CHAT_WINDOW_MAXIMIZED_WIDTH;var d=10,e=ia-C()-d;return c>e?!0:!1},qa=-1;V(),setInterval(V,ha),ga(),w.on("newChatCreated",W),w.on("newChatRemoved",X),$(a).on("resize",P),b.onCnvChatManagerDestroy=function(){k.destroy(),e.removeListener(g.chatsdk.ChatEvents.CHAT_STARTED,D),e.removeListener(g.chatsdk.ChatEvents.MESSAGE_RECEIVED,E),o.off("userInfo.adminModeChanged",Q),s.off("clientTypeUpdated",R),p.removeTabsEventListener2("openChatWindow",M),p.removeTabsEventListener2("closeChatWindow",N),p.removeTabsEventListener2("onWindowResize",O),$(a).off("resize",P),fa(),w.off("newChatCreated",W),w.off("newChatRemoved",X),na&&(na.src="",na=null),b.chatWindows=null,b.mainChatsListProperties=null,b.dockedWind=null,b.inviteChatsMapper=null,b.chatsToBlinkInTab=null}},controller:["$scope","$element","Users","bannerService",function(b,d,f,h){function i(){b.userIdle=!0}function j(){e.removeListener(g.chatsdk.ChatEvents.CONNECTED,y),e.removeListener(g.chatsdk.ChatEvents.DISCONNECTED,z),p.removeTabsEventListener2("sendinviteChat2",u),m.off("appFocus",k),m.off("appBlur",l),m.off("appLongIdle",i),m.off("appLongIdleHeartbeat",n),m.off("appShortIdle",o),m.off("appActivate",q),m.off("appDeactivate",r),m.off("appActive",s),b.onCnvChatManagerDestroy(),w.removeNewChat()}function k(){b.appInFoucs=!0,b.chatsToBlinkInTab=[],b.currentFocusedChatWindow.chatId&&b.focusedChatWindow(b.currentFocusedChatWindow.chatId)}function l(){b.appInFoucs=!1}function n(){}function o(){p.isThisTabLastActiveTab()&&b.currentFocusedChatWindow.chatId&&b.focusedOutChatWindow(b.currentFocusedChatWindow.chatId,!1,!1,!0)}function q(){b.currentFocusedChatWindow.chatId&&b.focusedChatWindow(b.currentFocusedChatWindow.chatId)}function r(){b.currentFocusedChatWindow.chatId&&b.focusedOutChatWindow(b.currentFocusedChatWindow.chatId,!1,!1,!0)}function s(){b.userIdle=!1,b.currentFocusedChatWindow.chatId&&b.focusedChatWindow(b.currentFocusedChatWindow.chatId)}function t(a,d){if(!v){v=!0;var i,j=d.chat,k=d.chat.chatId;i=d.withoutChatContent?f.inviteUsersToNetwork([j._user.email],d.message,!1,c,"Chat"):f.inviteUsersToNetwork([j._user.email],d.message,!1,!0,"Chat"),i.then(function(a){a.data.type&&a.data.data.users_invited.length>0&&j.isInviteChat?(p.dispatchTabsEvent2("sendinviteChat2",{tabId:b.tabId,chatId:k,invitedUsers:a.data.data.users_invited}),e.updateInviteChatParticipants(j,a.data.data.users_invited),j.chatType===g.chatsdk.ChatType.P2P&&e.updateInviteP2PChatIdAndStatus(j),e.updateInviteChatFakeMessagesAsOriginal(j),e.addChatInCollection(j),e.sendInviteChatMessages(j),j._user.updateUserId(a.data.data.users_invited[0].invitee_global_profile.user_id),j._user.updateContactStatusAsInvited(),b.$broadcast("updateChatDetailsOnInvitationSuccess",{chatId:j.chatId})):a.data.type&&a.data.data.users_not_invited.length>0&&h.showBanner(a.data.data.users_not_invited[0].error_message,!1,!1),b.inviteChatsMapper[k]&&(b.inviteChatsMapper[k]=c,delete b.inviteChatsMapper[k]),v=!1},function(){v=!1})["catch"](function(){v=!1})}}function u(a){if(a.tabId!==b.tabId){var d=b.inviteChatsMapper[a.chatId];if(!d||!d.isInviteChat)return void(d&&!d.isInviteChat&&(b.inviteChatsMapper[a.chatId]=c,delete b.inviteChatsMapper[a.chatId]));e.updateInviteChatParticipants(d,a.invitedUsers),d.chatType===g.chatsdk.ChatType.P2P&&e.updateInviteP2PChatIdAndStatus(d),e.addChatInCollection(d),d._user.updateUserId(a.invitedUsers[0].invitee_global_profile.user_id),d._user.updateContactStatusAsInvited(),b.$broadcast("updateChatDetailsOnInvitationSuccess",{chatId:chat.chatId}),b.inviteChatsMapper[a.chatId]&&(b.inviteChatsMapper[a.chatId]=c,delete b.inviteChatsMapper[a.chatId])}}var v=!1;m.isAppInLongIdleState()&&i();var y=function(a){if(b.chatManagerConnected=!0,b.chatWindows)for(var c=0;c<b.chatWindows.length;c++)b.chatWindows[c].chatObj.isNewChat?b.chatWindows[c].chatObj.chat&&e.chatOpened(b.chatWindows[c].chatObj.chat):e.chatOpened(b.chatWindows[c].chatObj)},z=function(a){b.chatManagerConnected=!1};b.okToDigest=!1,b.runDigestOnScope=function(a,c){c=c||b,!c.$$phase&&b.okToDigest&&c.$digest(),a&&b.runRenderOnScope(c)},b.runRenderOnScope=function(a){a=a||b;a.fromChatWhichComponent;b.okToDigest&&a.$broadcast("render")},b.$on("chatMuteStatusChanged",function(){b.runRenderOnScope()}),e.addListener(g.chatsdk.ChatEvents.CONNECTED,y),e.addListener(g.chatsdk.ChatEvents.DISCONNECTED,z),e.isConnected()&&y(),b.$on("$destroy",j),m.on("appFocus",k),m.on("appBlur",l),m.on("appLongIdle",i),m.on("appLongIdleHeartbeat",n),m.on("appShortIdle",o),m.on("appActivate",q),m.on("appDeactivate",r),m.on("appActive",s);var A=0;b.getVisibleBrowserHeight=function(){return A=a.document.body.clientHeight-60,x.networkAlertDisplayed&&(A-=30),A},b.$on("sendChatInvite",t),p.addTabsEventListener2("sendinviteChat2",u)}]}}]),b.module("convoApp").directive("cnvWindowMaximizeMinimizeManager",["appTabs","chatUsersManager","mixpanelService",function(a,b,c){return{link:function(d,e,f){function g(b,c,f){d.isMinimized=!0,w?(d.chatWindow.metaDetails.isMinimized=!0,y&&0!=y.length||(y=e.find(".chatMessageWindow")),d.scrollPos=Math.ceil(y.scrollTop()),d.scrollPos+y[0].clientHeight>=y[0].scrollHeight-10?d.scrollToBot=!0:d.scrollToBot=!1):d.mainChatsListProperties.isMinimized=!0,d.setWindFocus(!1),e.css({height:"28px",width:v+"px"}),w?d.$emit("adjustWindPosOnMin",!0,f,d.chatObj.chatId):d.$emit("adjustWindPosOnMin",!0,f),setTimeout(function(){x.siblings().hide(),d.$emit("saveHistoryLS")},200),b||a.dispatchTabsEvent2("chatMin",{tabId:d.tabId,chatWindId:d.chatId},!0)}function h(b,f,g){if(x.siblings().not(".messageInputContainer").show(),x.find(".btnMinimize").show(),d.isMinimized=!1,d.disableButtons=!0,f||(f=d.verticalHeight),!f||s>f)f=s;else{var h=d.getVisibleBrowserHeight();w||(h-=59),f>h&&(f=h)}s>f&&(f=s),d.verticalHeight=f;var i;w?(d.chatWindow.metaDetails.isMinimized=!1,i=t,d.chatObj.unreadCount>0&&!d.scrollToBot&&e.find(".newMsgReceived").show(),d.$emit("adjustWindPosOnMin",!1,g,d.chatObj.chatId)):(d.mainChatsListProperties.isMinimized=!1,i=u,d.$emit("adjustWindPosOnMin",!1,g)),e.css({height:f+"px",width:i+"px"}),setTimeout(function(){if(w){if(y&&0!=y.length||(y=e.find(".chatMessageWindow")),d.scrollPos&&!d.scrollToBot)y.scrollTop(d.scrollPos);else{var a=y[0];a&&y.scrollTop(a.scrollHeight)}d.setWindFocus(!0,!0)}else e.find(".inputSearchBar").focus(),c.trackEvent(c.OPEN_CHATS_LIST);setTimeout(function(){d.disableButtons=!1,e.find(".messageInputContainer").show(),d.$emit("saveHistoryLS")},200)},1),b||a.dispatchTabsEvent2("chatMax",{tabId:d.tabId,chatWindId:d.chatId},!0)}function i(a){var b=$(a.target);return b.hasClass("headerIcon")||b.hasClass("dropdownLinkContainer")||b.closest(".btnChatOptions").length>0||b.closest(".addUserList").length>0||b.closest(".vidCallOptionsDropdown").length>0||b.closest(".addParticipantList").length>0||b.closest(".chatSettingsOptionsBtn").length>0?!0:(a.preventDefault(),a.stopPropagation(),d.isMinimized?h(!1,null,!0):g(!1,null,!0),d.fromMin=!0,setTimeout(function(){d.fromMin=!1},500),void d.runRenderOnScope(d))}function j(a,b,c){b!==d.chatId||d.isMinimized||g(!0,0,c)}function k(a,b,c){b===d.chatId?(d.dntShow=!1,h(!0,0,c),d.fromMin=!0,setTimeout(function(){d.fromMin=!1},500),d.runRenderOnScope(d)):d.isNewChat&&c&&d.setWindFocus(!1)}function l(a,b,c){w&&b==d.chatId&&!d.isMinimized&&(s>c?(e.css("height",s),d.verticalHeight=s):(e.css("height",c),d.verticalHeight=c),d.chatWindow.metaDetails.height=d.verticalHeight)}function m(a,b){w||(s>b?(e.css("height",s),d.verticalHeight=s):(e.css("height",b),d.verticalHeight=b))}function n(a,b){w||h(!0,b)}function o(){w||d.isMinimized||g(!0)}function p(b){x.off("mousedown",i),a.removeTabsEventListener2("chatMin",q),a.removeTabsEventListener2("chatMax",r)}function q(a){a.tabId!=d.tabId&&b.getUsers().length&&(a.chatWindId!==d.chatId||d.isMinimized||g(!0,0,!0))}function r(a){a.tabId!=d.tabId&&b.getUsers().length&&a.chatWindId===d.chatId&&d.isMinimized&&h(!0,0,!0)}var s=350,t=302,u=260,v=166,w=e.hasClass("chatWindow");d.isMinimized=!1;var x,y;x=w?e.find(".chatWindowHeader"):e.find(".chatUserListHeader"),x.on("mousedown",i),d.$on("miniChatWin",j),d.$on("maxChatWin",k),d.$on("setChatWindowHeight",l),d.$on("setChatListHeight",m),d.$on("maxChatList",n),d.$on("minChatList",o),d.$on("$destroy",p),a.addTabsEventListener2("chatMin",q),a.addTabsEventListener2("chatMax",r),w||(x.siblings().hide(),d.verticalHeight=e.height(),e.css({height:x.height()+"px",width:v+"px"}),x.addClass("unfocused-state"),d.isMinimized=!0,d.mainChatsListProperties.isMinimized=!0),setTimeout(function(){x.css({transition:"background-color 0.2s, width 0.25s"}),w?x.closest(".chatWindow").css({transition:"width 0.25s, height 0.25s, left 0.25s, right 0.25s"}):x.closest(".chatUserListMainStyl").css({transition:"width 0.25s, height 0.25s, left 0.25s, right 0.25s"})},1)}}}]),b.module("convoApp").directive("cnvWindowResizeManager",["appTabs",function(b){return function(c,d,e){function f(a){if("vertical"===e.cnvWindowResizeManager){var b=a.clientY,d=r-b;p&&p>d&&d>=s?$resizerBtn.css({height:d+"px"}):d>p?$resizerBtn.css({height:p+"px"}):s>d&&$resizerBtn.css({height:s+"px"}),c.verticalHeight=$resizerBtn.height()+1,c.$emit("chatWindowResize")}}function g(){c.chatId==e.resizerBottom?(c.verticalHeight=$resizerBtn.height()+1,b.dispatchTabsEvent2("chatWindowResize",{chatId:c.chatId,height:c.verticalHeight},!0),c.chatWindow.metaDetails.height=c.verticalHeight):"chatUserListMainWindow"==e.resizerBottom&&b.dispatchTabsEvent2("chatListResize",{height:$resizerBtn.height()},!0),c.$emit("saveHistoryLS"),$resizerBtn.css({transition:q}),$resizerBtn=null,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g)}function h(a){if(c.localStoreLoaded){var b=c.getVisibleBrowserHeight();t&&a.chatId===c.chatId&&(a.height>b?c.$broadcast("setChatWindowHeight",a.chatId,b):c.$broadcast("setChatWindowHeight",a.chatId,a.height))}}function i(a){if(c.localStoreLoaded){var b=c.getVisibleBrowserHeight();t||(a.height>b?c.$broadcast("setChatListHeight",b):c.$broadcast("setChatListHeight",a.height))}}function j(b){b.preventDefault(),$resizerBtn=$("#"+e.resizerBottom),q=$resizerBtn.css("transition"),r=a.innerHeight,$resizerBtn.css({transition:"none"}),p=c.getVisibleBrowserHeight(),t||(p-=59),document.addEventListener("mousemove",f),document.addEventListener("mouseup",g)}function k(){d.on("mousedown",j)}function l(a){d.off("mousedown",j),b.removeTabsEventListener2("chatWindowResize",h),b.removeTabsEventListener2("chatListResize",i),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g)}function m(){c.$on("$destroy",l)}function n(){b.addTabsEventListener2("chatWindowResize",h),b.addTabsEventListener2("chatListResize",i)}function o(){k(),m(),n()}var p,q,r,s=350,t=c.chatId?!0:!1;o()}}]),b.module("convoApp").directive("cnvDockedChatWindows",["appTabs","chatManager",function(a,b){return{restrict:"E",scope:!0,templateUrl:"chat/client/dockedChatWindows/templates/cnvDockedChatWindows.tpl.html",link:function(c,d,e){function f(){n()}function h(){for(var a=0;a<c.dockedWind.length;a++)c.dockedWind[a].chatObj.addListener(g.chatsdk.ChatEvents.UNREAD_COUNT_CHANGED,f)}function i(a){a&&a.removeListener(g.chatsdk.ChatEvents.UNREAD_COUNT_CHANGED,f)}function j(a,b,c){(b>0||0>b)&&("rgb(2, 91, 126)"==a.css("background-color")?a.css("background","#389dcc"):a.css("background","#025b7e")),l&&clearTimeout(l),(b>0||0>b)&&(l=setTimeout(function(){j(a,b,c)},c),b-=1)}var k=function(){this.isExists="verify"};c.docked_chat_leaks_finder=new k;var l,m;c.showDockedChat=function(a,b,d){var e;c.showingChatListDocked=!1;for(var f=0;f<c.chatWindows.length;f++)c.chatWindows[f].chatObj.chatId==b&&(e=!0);if(c.chatWindows.length&&!e){for(var f=0;f<c.dockedWind.length;f++)if(c.dockedWind[f].chatObj.chatId===b){i(c.dockedWind[f].chatObj),c.$emit("openChatWindow",c.dockedWind[f].chatObj,{isOpenedOnUserAction:!0});break}n(),c.runRenderOnScope(c),d||c.$emit("saveHistoryLS")}s(),a&&(a.stopImmediatePropagation(),a.preventDefault())},c.closeDockedChat=function(b,d,e){e||a.dispatchTabsEvent2("closeDockedWin",{tabId:c.tabId,chatId:d},!0);for(var f,g=0;g<c.dockedWind.length;g++)if(c.dockedWind[g].chatObj.chatId===d){f=c.dockedWind[g];break}f&&i(f.chatObj);var h=_.indexOf(c.dockedWind,f);c.dockedWind.splice(h,1),n(),c.runRenderOnScope(c),e||c.$emit("saveHistoryLS"),s(),b.stopPropagation()};var n=function(){for(var a=0,b=!1,e=0;e<c.dockedWind.length;e++)a+=c.dockedWind[e].chatObj.unreadCount,!c.dockedWind[e].chatObj.isMuted&&c.dockedWind[e].chatObj.unreadCount>0&&(b=!0);a>0&&b?j(d.find(".multipleDockedWind"),7,800):0===a&&(j(d.find(".multipleDockedWind"),0,0),d.find(".multipleDockedWind").css("background","#2b2b2b")),c.unreadCounts=a,c.runRenderOnScope(c),c.$emit("unReadCountChanged"),console.log("Ahsan: unread count :"+c.unreadCounts)};c.showChatListDocked=function(){c.showingChatListDocked=!0,c.runRenderOnScope(c);var a=$(".chatListDocked",d);c.unreadCounts>0&&a.scrollTop()!=a[0].scrollHeight&&a.scrollTop(a[0].scrollHeight),a.focus()};var o=function(a){a.preventDefault(),a.stopPropagation()},p=function(){c.showingChatListDocked=!0,c.runRenderOnScope(c)},q=function(){c.showingChatListDocked=!1,c.runRenderOnScope(c)},r=function(a){if(a.tabId!=c.tabId&&c.localStoreLoaded)for(var b=0;b<c.dockedWind.length;b++)if(c.dockedWind[b].chatObj.chatId==a.chatId){c.closeDockedChat(null,a.chatId,!0);break}},s=function(a){return 0===c.dockedWind.length?void c.runRenderOnScope(c):(c.dockedChatObj=c.dockedWind[c.dockedWind.length-1].chatObj,c.dockedChatObj.chatType==g.chatsdk.ChatType.P2P&&c.$broadcast("refreshImage"),h(),n(),void c.runRenderOnScope(c))},t=function(a,b){c.dockedWindowsPos=b+"px",c.runRenderOnScope(c)},u=function(a){m=setTimeout(function(){n()},5e3)};$(".multipleDockedWind").on("mousewheel",o),d.find(".chatListDocked").on("focus",p),d.find(".chatListDocked").on("blur",q),a.addTabsEventListener2("closeDockedWin",r),c.$on("renderOnDockedWindowsUpdated",s),c.$on("renderOnDockedWindowsPositionUpdated",t),c.$on("cachedChatsLoaded",u),b.addListener(g.chatsdk.ChatEvents.CHATS_REFRESHED,n),c.$on("$destroy",function(){$(".multipleDockedWind").off("mousewheel",o),d.find(".chatListDocked").off("focus",p),d.find(".chatListDocked").off("blur",q),a.removeTabsEventListener2("closeDockedWin",r),b.removeListener(g.chatsdk.ChatEvents.CHATS_REFRESHED,n),l&&(clearTimeout(l),l=null),m&&(clearTimeout(m),m=null)})}}}]),b.module("convoApp").factory("NewChatWindowDataManager",["chatUsersManager","chatManager","NewChatDataManager","chatAdvancedSearchManager",function(a,b,c,d){function e(a){g.chatsdk.EventDispatcher.call(this),this.isNewChat=!0,this.title="New Chat",this.users=a?a:[],this.chat=null,this.usersHash=null,this.isGroupChat=!1,this.explicitlyCreatedLocalChat=!1,this.matchFound=!1,this.chatId="new",a&&this.recompute()}function f(a,c){c||(c=!1);var d=p.chat;p.chat!=a&&(p.chat=a,p.matchFound=c,p.dispatchChatChangeEvent(d),a&&b.chatOpened(a))}function h(){if(p&&1==p.explicitlyCreatedLocalChat){var a=p.chat;a&&a.chatType==g.chatsdk.ChatType.GROUP&&(q[a.chatId]&&(delete q[a.chatId],b.removeLocallyCreatedChat(a.chatId)),p.explicitlyCreatedLocalChat=!1)}}function i(){var a=p.users;if(!a||0==a.length)return void f(null);if(1==a.length)return void m();var b=l(a),c=b.chat,e=b.matchFound;if(c)f(c,e);else{var g=a.map(function(a){return a.userId});d.fetchMatchingChat(g,p.usersHash).then(function(a){p&&(a.match?a.requestId==p.usersHash?(j(a.match,a.requestId),f(k(a.match),!0)):j(a.match,a.requestId):m())},function(a){p&&m()})}}function j(a,b){a&&b&&(r[b]=a)}function k(a){var c=[],d=b.getChat(a.chatId);if(!d){for(var e in a.participants)c.push(a.participants[e]);var f=a.getOriginalTitle();d=b.openChatFromId(a.chatId,a.chatType,null,c,null,!0,!1,f)}return d}function l(a){var c,d=p.users.map(function(a){return a.userId}),e=g.chatsdk.ChatUtils.generateUniqueKeyFromIds(d),f=r[e],h=!1;return f?(c=k(f),h=!0):(c=b.getLocalChatWithUsers(p.users),h=c&&c.lastMessageSequenceNumber>0),{chat:c,matchFound:h}}function m(){var a=b.startChatWithUsers(p.users,!0);0==a.lastMessageSequenceNumber&&a.chatType==g.chatsdk.ChatType.GROUP&&(q[a.chatId]=1),f(a)}function n(a){return new e(a)}e.prototype=new g.chatsdk.EventDispatcher,e.prototype.constructor=e,e.prototype.recompute=function(){this.unDisplayedUsersCount=0,this.usersToDisplay=0,this.users.length>4?(this.unDisplayedUsersCount=this.users.length-3,this.usersToDisplay=3):this.usersToDisplay=this.users.length;var a="Chat",b=this.users.length;if(b){var c=this.users.map(function(a){return a.getDisplayName()});a+=" with "+c.join(", ")}else a="New Chat";this.title=a},e.prototype.getTitle=function(){return this.chat?this.chat.getTitle():this.title},e.prototype.addUser=function(a){var b=this.users.indexOf(a);if(-1==b){this.users.push(a);var c=this.users.map(function(a){return a.userId});return this.usersHash=g.chatsdk.ChatUtils.generateUniqueKeyFromIds(c),this.recompute(),this.isGroupChat=this.users.length>1,!0}return!1},e.prototype.removeUser=function(a){var b=this.users.indexOf(a);if(-1!=b){this.users.splice(b,1);var c=this.users.map(function(a){return a.userId});return this.usersHash=g.chatsdk.ChatUtils.generateUniqueKeyFromIds(c),this.recompute(),!0}return!1},e.prototype.dispatchUpdateEvent=function(){this.dispatch("UPDATE",{})},e.prototype.dispatchChatChangeEvent=function(a){this.dispatch("CHAT_CHANGED",{oldChat:a})},e.prototype.dispatchConvertToOrdinaryChat=function(a){this.dispatch("CONVERT_TO_ORDINARY_CHAT",{oldChat:a})};var o={};_.extend(o,Backbone.Events);var p,q={},r={};return o.createNewChat=function(a){p?a&&(p=n(a)):p=n(a),r={},a&&a.length&&i(),o.trigger("newChatCreated",p)},o.removeNewChat=function(a){if(p){a&&p.chat&&delete q[p.chat.chatId];for(var c in q)b.removeLocallyCreatedChat(c);p=null,r={},q={},o.trigger("newChatRemoved")}},o.getNewChatData=function(){return p},o.addUserByUserIdInNewChat=function(b){var c=a.getUserById(b);if(c){var d=p.addUser(c);d&&(h(),i(),p.dispatchUpdateEvent())}},o.removeUserByUserIdFromNewChat=function(b){var c=a.getUserById(b);if(c){var d=p.removeUser(c);d&&(h(),i(),p.dispatchUpdateEvent())}},o.openChatFromServerSuggestion=function(a){var c=k(a);if(p&&c){var d=p.chat;p.chat=c,p.dispatchConvertToOrdinaryChat(d),b.chatOpened(c)}},o.explicitlyCreateNewChat=function(){p&&0==p.explicitlyCreatedLocalChat&&(m(),p.explicitlyCreatedLocalChat=!0)},o.getNewChatId=function(){return"new"},o}]),b.module("convoApp").factory("filteredChatInfo",["chatUsersManager","userInfo","$filter",function(a,b,c){function d(a){var b={};return b.chatId=a.chat_id,b.chatType="chat"===a.chat_type?g.chatsdk.ChatType.P2P:g.chatsdk.ChatType.GROUP,b.fileName=a.fileName,b.fileThumbnailName=a.fileThumbnailName,b.lastMessageTimestamp=a.timestamp,b.lastMessage=a.chat_last_message,b.chatTitle=a.chat_title,b._iconVersion=-1!=a.chat_icon_version?a.chat_icon_version:"0",a.published_to?b.participants=h.call(b,a.published_to):b.participants={},b.getSummeryText=function(){return b.lastMessage},b.getTitle=function(){return b.chatTitle?b.chatTitle:j.call(b)},b.getOriginalTitle=function(){return b.chatTitle},b.getOtherParticipant=function(a){for(var b in this.participants)if(b!=a)return this.participants[b];return this.participants[a]},b.getIconVersion=function(){return this._iconVersion},b}function e(a){return a&&a.length?a.map(d):[]}function f(a,b){var c={};return c.searchText=a,c.chatId=b.chat_id,c.messageId=b.msg_id,c.sequenceNumber=b.seq_no,c.chatType="chat"===b.chat_type?g.chatsdk.ChatType.P2P:g.chatsdk.ChatType.GROUP,c.fileName=b.fileName,c.fileThumbnailName=b.fileThumbnailName,c.lastMessageTimestamp=b.timestamp,c.lastMessage=b.chat_last_message,c.message_match=b.message_match,c.chatTitle=b.chat_title,c._iconVersion=-1!=b.chat_icon_version?b.chat_icon_version:"0",
b.published_to?c.participants=h.call(c,b.published_to):c.participants={},c.isFetchedChat=!0,c.getSummeryText=function(){return c.lastMessage},c.getTitle=function(){return c.chatTitle?c.chatTitle:j.call(c)},c.getOriginalTitle=function(){return c.chatTitle},c.getOtherParticipant=function(a){for(var b in this.participants)if(b!=a)return this.participants[b];return this.participants[a]},c.getIconVersion=function(){return this._iconVersion},c}function h(c){for(var d,e={},f=0;f<c.length;f++)d=a.getUserById(c[f].published_to),d||(d=a.getInaccessibleUserById(c[f].published_to)),d&&(e[d.userId]=d),d&&this.chatType===g.chatsdk.ChatType.P2P&&b.user_id!=d.userId&&(this._user=d),d&&b.user_id==d.userId&&(this.thisUser=d);return e}function i(a,b){var c=[];if(b)for(var d=0;d<b.length;d++)c.push(f(a,b[d]));return c}function j(){var a=!1,c=0,d="";for(var e in this.participants){var f=this.participants[e];f&&(f.userId===b.user_id?a=!0:(c++,3>c&&(d&&(d+=", "),this.chatType===g.chatsdk.ChatType.GROUP?d+=f.firstName?f.firstName:f.name?f.name.split(" ")[0]:f.getDisplayName():(d=f.getDisplayName(),d||(d=f.name)))))}return c-=2,c>0&&(d+=" +"+c),d||(d=a&&c>0?"Group Chat":"Empty Room"),d}var k={};return k.getFilteredChats=i,k.getSuggestedChats=e,k.getSuggestedChat=function(a){return a?d(a):null},k}]),b.module("convoApp").factory("UserPresenceManager",["chatUsersManager","chatManager","appStateInfo","logger","$rootScope","userInfo",function(a,b,c,d,e,f){function h(){b.appFocusGained()}function i(){b.appFocusLost()}function j(){d.logLocally_errorOnServer("userId: "+f.user_id+" tabId: "+e.clientInstanceId+" cnvChatManager.appLongIdle"),a.onUserIdle()}function k(){b.appFocusLost()}function l(){b.appFocusGained()}function m(){b.appFocusLost()}function n(){a.onUserNonIdle(),b.appFocusGained()}function o(){c.on("appFocus",h),c.on("appBlur",i),c.on("appLongIdle",j),c.on("appShortIdle",k),c.on("appActivate",l),c.on("appDeactivate",m),c.on("appActive",n)}function p(a){q()}function q(){c.appHasFocus()?b.appFocusGained():b.appFocusLost(),c.isAppInLongIdleState()&&j()}function r(){o(),b.isConnected()?q():b.addListener(g.chatsdk.ChatEvents.CONNECTED,p)}var s={};return r(),s}]),b.module("convoApp").directive("autoHidingScrollBar",function(){return{link:function(b,c,d){function e(a){v||(w&&clearTimeout(w),v=setTimeout(function(){var a=c.scrollTop();if(i(a),b.containerScrolled){var d=a+z,e=y-10;H||(G=d>=e),b.containerScrolled(a,G)}v=null},50))}function f(){B=!0,E.css({opacity:1}),h()}function g(){B=!1,h()}function h(){w&&(clearTimeout(w),w=null),I||(w=setTimeout(function(){E.css({opacity:0})},1e3))}function i(a){y=F.scrollHeight,z=c.outerHeight();var b=a/(y-z);E.css({top:b*z-b*A+"px",opacity:1}),h()}function j(){H=!0,k()}function k(){C&&clearTimeout(C),C=setTimeout(l,200)}function l(){if(F){x=c.position().top,y=F.scrollHeight,z=c.outerHeight(),z>=y?D.css({display:"none"}):D.css({display:"block",top:x,height:z});var a=z/y;A=a*z,20>A&&(A=20);var b={height:A+"px"};H&&G&&c.scrollTop(y);var d=c.scrollTop();if(d){var f=d/(y-z);b.top=f*z-f*A+"px"}C=null,E.css(b),H&&(H=!1,e())}}function m(){I=!0,w&&clearTimeout(w),D.css("background-color","rgba(150,150,150,0.3)"),E.css({opacity:1})}function n(a){var b=a.toElement||a.relatedTarget;J||b&&(b.parentNode==this||b==this)||o()}function o(){I=!1,D.css("background-color","rgba(0,0,0,0.0)"),h()}function p(a){var b=a.pageY-D.offset().top-A/2,d=b/z,e=y*d;0>e&&(e=0),c.animate({scrollTop:e},200)}function q(b){var d=b||a.event,e=0;if("detail"in d&&(e=-1*d.detail),"wheelDelta"in d&&(e=d.wheelDelta),"wheelDeltaY"in d&&(e=d.wheelDeltaY),"deltaY"in d&&(e=-1*d.deltaY),0!==e){var f=c.scrollTop()-e;c.scrollTop(f),b.preventDefault(),b.stopPropagation()}}function r(){return $(document).on("mousemove",t).on("mouseup",s),J=!0,!1}function s(){return $(document).off("mousemove",t).off("mouseup",s),J=!1,B||o(),!1}function t(a){var b=a.pageY-(D.offset().top+A/2),d=b/z;c.scrollTop(y*d)}var u=c.parent();u.append("<div class='scroll-track'><div class='scroll-bar'></div></div>");var v,w,x,y,z,A,B,C,D=u.find(".scroll-track"),E=u.find(".scroll-bar"),F=c[0],G=!1;b.$on("render",k),b.$on("chatWindowResize",k);var H=!1;a.addEventListener("resize",j),k();var I;D.on("mouseover",m),D.on("mouseout",n),D.on("click",p),D[0].addEventListener("DOMMouseScroll",q),D[0].addEventListener("mousewheel",q);var J;E.on("mousedown",r),u.hover(f,g),c.on("scroll",e),b.$on("$destroy",function(){u.off("mouseenter mouseleave"),c.off("scroll"),$(document).off("mousemove",t),$(document).off("mouseup",s),D.off("mouseover",m),D.off("mouseout",n),D.off("click",p),D[0].removeEventListener("DOMMouseScroll",q),D[0].removeEventListener("mousewheel",q),E.off("mousedown",r),a.removeEventListener("resize",j),C&&(clearTimeout(C),C=null),v&&(clearTimeout(v),v=null),w&&(clearTimeout(w),w=null),u=null,D=null,E=null,F=null})},controller:["$scope",function(a){}]}}),b.module("convoApp").directive("cnvAddPeopleInChat",["ChatsViewDataManager","chatUsersManager","ChatsUtils","usersGroupsListProvider",function(a,b,c,d){return{restrict:"E",priority:0,replace:!0,templateUrl:"chat/fullviewclient/templates/AddPeopleInChat.tpl.html",link:function(e,f,g){function h(){e.$broadcast("render"),e.$$phase||e.$digest()}function i(){e.$broadcast("render")}function j(){e.$broadcast("resetInput")}function k(){return e.selectedItemIndex>=0&&e.selectedItemIndex<e.usersList.length}function l(){k()||(e.selectedItemIndex<0?e.selectedItemIndex=0:e.selectedItemIndex>=e.usersList.length&&(e.selectedItemIndex=e.usersList.length-1))}function m(a){var b=a.user;if(y[b.userId]||a.isParticipant)v&&v.focus();else{var c=d.getUserListItem(a.user.userId);c.data=a.user,e.userItems.push(c),y[b.userId]=1;e.usersList.indexOf(a);j(),p(""),e.userItems.length&&e.enableDoneBtn()}}function n(a){var b=$(a.target).val();0===b.indexOf("@")&&(b=b.slice(1)),p(b)}function o(a){38==a.which?(a.preventDefault(),a.stopImmediatePropagation(),B()):40==a.which&&(a.preventDefault(),a.stopImmediatePropagation(),C())}function p(a){var c=[];c=a&&a.length>0?b.getFilteredUserList(a):b.getUsers(),q(c),w&&w.scrollTop(0),e.selectedItemIndex=0,h()}function q(a){e.usersList.length=0;for(var b=a.length,d=0;b>d;++d){var f=a[d];if(!y[f.userId]){var g=A[f.userId];g?(g.isParticipant=c.isUserParticipantOfChat(f.userId,x.chat),g.presenceStatus=c.getPresenceValue(f)):(g={user:f,presenceStatus:c.getPresenceValue(f),isParticipant:c.isUserParticipantOfChat(f.userId,x.chat)},A[f.userId]=g),e.usersList.push(g)}}}function r(){var a=w.scrollTop(),b=e.usersToDisplay;a>=w[0].scrollHeight-w.height()-20?b=Math.min(e.usersToDisplay+z,e.usersList.length):0==a&&(b=z),b!=e.usersToDisplay&&(e.usersToDisplay=b,i())}function s(){setTimeout(function(){var a=w.find(".chat-member-selected");a.length&&t(a)},1)}function t(a){if(a&&a.length){var b=a[0],c=w[0],d=c.scrollTop,e=d+c.clientHeight,f=b.offsetTop-c.offsetTop,g=0;if(d>f?g=f-d:f+a.height()>e&&(g=f+a.height()-e+50),0!=g){var h=c.scrollTop+g;w.animate({scrollTop:h},{duration:10})}}}function u(){setTimeout(function(){v=f.find("input"),v.on("input",n),v.on("keydown",o)},1e3),x=a.getSelectedItem(),setTimeout(function(){p()},100),w.on("scroll",r)}var v,w,x;w=f.find(".add-people-users-list-container"),e.selectedItemIndex=0,e.usersList=[];var y={},z=20;e.usersToDisplay=z;var A={};e.onEnterKeyPressInToField=function(){if(k()){var a=e.usersList[e.selectedItemIndex];m(a),l(),h()}},e.addUserInToField=function(a){m(a),l(),h()},e.onEscKeyPressInToField=function(){},e.onItemAddedInToField=function(a){},e.onItemRemovedInToField=function(a){delete y[a.id],p(""),0==e.userItems.length&&e.disableDoneBtn()};var B=_.throttle(function(){e.selectedItemIndex>0&&(--e.selectedItemIndex,h(),s())},100),C=_.throttle(function(){e.selectedItemIndex<Math.min(e.usersList.length-1,e.usersToDisplay)&&(++e.selectedItemIndex,h(),s())},100);e.$on("$destroy",function(){v&&(v.off("input",n),v.off("keydown",o)),w.off("scroll",r)}),u()},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvChatAppHeader",["ChatsViewDataManager","ChatConstants","appTitleManager","Filters","FilterTypes","chatUsersManager","userImgUrlFilter","$rootScope","userInfo","bannerService","$location","AppLinks","alertsService",function(a,b,c,d,e,f,h,i,j,k,l,m,n){return{restrict:"AE",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatAppHeader.tpl.html",link:function(d,e,h){function i(){}function j(){}function k(a,b){$(b).closest(".video-call-btn").length?d.showVidCallDropdown?d.closeVideoCallDropdown():d.showVideoCallOptions():d.closeVideoCallDropdown()}function l(){a.on("SelectedItemChange",m),a.on(b.ADMIN_MODE_CHANGE,x);var d=a.getSelectedItem();d&&m({item:d}),c.setAppFavicon("assets/img/chat/chat_favicon.ico")}function m(b){d.selectedItem!=b.item&&(p(),d.selectedItem=b.item,d.isNewChat=a.isNewChatData(b.item),d.chatViewData=n(),o(),d.showCreateNewChatLink=!1,d.chatViewData&&c.setAppTitle(d.chatViewData.biggerChatTitle),t())}function n(){return d.isNewChat?d.selectedItem.chatViewData:d.selectedItem}function o(){d.chatViewData&&(d.chatViewData.addListener("UPDATE",t),d.chatViewData.addListener("UPDATE_TIME",s)),d.isNewChat&&q(d.selectedItem)}function p(){d.chatViewData&&(d.chatViewData.removeListener("UPDATE",t),d.chatViewData.removeListener("UPDATE_TIME",s)),d.selectedItem!=d.chatViewData&&r(d.selectedItem)}function q(a){a.addListener("UPDATE",t),a.addListener("CHAT_CHANGED",u)}function r(a){a.removeListener("UPDATE",t),a.removeListener("CHAT_CHANGED",u)}function s(){d.$broadcast("render_date")}function t(){d.chatViewData&&(d.chatViewData.chat&&(d.isMuted=d.chatViewData.chat.isMuted,d.isDisabled=d.chatViewData.disabled||d.chatViewData.thisUserLeft||d.chatViewData.chat&&d.chatViewData.chat.isInviteChat||a.isAdminMode()),d.isGroupChat=d.chatViewData.isGroupChat),v(),y()}function u(){var a=d.selectedItem.chatViewData;a!=d.chatViewData&&(d.chatViewData&&d.chatViewData.removeListener("UPDATE",t),d.chatViewData=a,d.chatViewData&&(d.chatViewData.addListener("UPDATE",t),d.isNewChat&&(d.showCreateNewChatLink=d.selectedItem.matchFound&&a&&a.type==b.GROUP_CHAT)),t())}function v(a){w(d.chatViewData?d.chatViewData.type==b.P2P_CHAT?d.chatViewData.chat.getTitle():d.chatViewData.biggerChatTitle:"New Chat"),y(),d.$broadcast("refreshImage")}function w(a){a.length>55&&(a=a.slice(0,40)+"..."),d.chatTitle=a}function x(){d.isAdminMode=a.isAdminMode(),t()}function y(){d.$broadcast("render"),d.$broadcast("render_date")}e[0].cnvFullViewChatAppHeader=new i,d.cnvFullViewChatAppHeaderElement=new j,d.chatViewData=null,d.isGroupChat=!1,d.showVidCallDropdown=!1,d.isDisabled=!1,d.isMuted=!1,d.isNewChat=!1,d.getChatObj=function(){return d.chatViewData?d.chatViewData.chat:null},d.muteChat=function(b,c,e){b&&b.stopPropagation(),a.muteChat(d.chatViewData.chat,!d.isMuted)},d.showVideoCallOptions=function(){d.isDisabled||setTimeout(function(){d.showVidCallDropdown=!0,y()},0)},d.closeVideoCallDropdown=function(){$(".vidCallOptionsDropdown",e).length&&(d.showVidCallDropdown=!1,y())},d.$on("cnvEventBinding::click",function(a,b){k(a,b)}),d.sendVideoCallLink=function(b,c,e){a.sendVideoMessageInChatItem(b,d.chatViewData,c,e)},d.$on("$destroy",function(){a.off("SelectedItemChange",m),a.off(b.ADMIN_MODE_CHANGE,x),f.removeListener(g.chatsdk.ChatEvents.CONNECTED,v),p()}),f.addListener(g.chatsdk.ChatEvents.CONNECTED,v),d.toggleDropdown=function(a){var b=$(a.target).closest(".user-menu-dropdown-widget");b&&0!=b.length||setTimeout(function(){e.find(".user-menu-dropdown-widget .dropdown-toggle").trigger("click")},0)},l()},controller:["$scope",function(b){function c(){h=[],h.push({label:b.user_info.first_name+" "+b.user_info.last_name,subtext:b.user_info.email,callback:b.openUserProfile,escapeAngularBindings:!0},{label:"Edit profile",callback:b.editUserProfile},{isDivider:!0},{label:"Change your photo",callback:b.openCombinedSetProfilePictureModal},{label:"Notification preferences",callback:function(){var a=m.newResourceLink("12",[{type:"9",uid:0},{type:"notificationsSettings",uid:0}],null,"Notification Settings"),b=m.linkToUrl(a,!0);l.url(b.slice(1))}},{isDivider:!0}),h.push({label:"Settings",callback:function(){var a=m.newResourceLink("12",[{type:"9",uid:0},{type:"myAccountSettings",uid:0}],null,"My account settings"),b=m.linkToUrl(a,!0);l.url(b.slice(1))}}),j.isAdmin()&&j.isAdminMode()?h.push({label:"Exit admin mode",callback:b.exitAdminMode}):j.isAdmin()&&h.push({label:"Enter admin mode",callback:b.enterAdminMode}),h.push({label:"Sign Out",callback:b.logoutUser}),b.userMenuDropdownCtrl.options=h}function f(){event.preventDefault(),c()}function g(){b.isAdminMode=j.isAdminMode(),c()}b.showUsersInput=!1,b.isAdminMode=a.isAdminMode(),b.userMenuDropdownCtrl={type:"c2c2c2-png"},b.userMenuDropdownCtrl.options=[];var h=b.userMenuDropdownCtrl.options;b.openUserProfile=function(a){var b={url:m.linkToUrl(m.newFilterLink(d.newANDFiltersChain([d.newFilter(e.FROM,"me","me")]),"User Profile"),!0)};l.url(decodeURIComponent(b.url.slice(1)))},b.editUserProfile=function(){var a={url:m.linkToUrl(m.newFilterLink(d.newANDFiltersChain([d.newFilter(e.FROM,"me","me")]),"User Profile"),!0)};l.url(decodeURIComponent(a.url.slice(1))).search("action","editProfile"),i.$broadcast("openEditProfileWidget")},b.openCombinedSetProfilePictureModal=function(){var a="components/combinedSetProfilePictureModal/combinedSetProfilePictureModal.tpl.html",c="CombinedSetProfilePictureModalCtrl",d=n.customModal(a,c,null,"combined-set-pic-modal");d.result.then(function(){b.$emit("userProfilePictureUpdated")})},b.enterAdminMode=function(){var a=adminService.switchToAdminMode();k.showBanner_promise(a,"Switching to Admin Mode","Switched to Admin Mode","Error Switching to Admin Mode. Please try again.",!1,!1),a.then(function(a){l.url("/feed"),b.$emit("refetchFeed")})},b.exitAdminMode=function(){var a=adminService.exitAdminMode();k.showBanner_promise(a,"Exiting Admin Mode",null,"Error exiting admin mode. Please try again.",!1,!1),a.then(function(a){l.url("/feed"),b.$emit("refetchFeed")})},b.logoutUser=function(){b.$emit("userSignOutClick")},b.user_info.on("userAccountEmailUpdated",c);var o=i.$on("root_scope:reRenderUserView",f);b.$on("reRenderUserView",function(a){c(),b.$broadcast("refreshImage")}),j.on("userInfo.adminModeChanged",g),c(),b.$on("$destroy",function(){o(),j.off("userInfo.adminModeChanged",g),b.user_info.off("userAccountEmailUpdated",c),b.userMenuDropdownCtrl=null,h=null})}]}}]),b.module("convoApp").directive("cnvChatAttachments",["ChatsViewDataManager","$filter","$rootScope","utils","ChatViewsManager","ChatConstants",function(b,d,e,f,g,h){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatAttachmentsView.tpl.html",link:function(i,j,k){function l(){}function m(){}function n(){i.isloading=!0,i.filesRendered=!1,B&&B.removeListener("CHAT_FILES_UPDATE",p),I&&(clearTimeout(I),I=null),B=b.getSelectedItem(),i.chatId=null,B&&(i.chatId=B.chat?B.chat.chatId:null,p(),B.addListener("CHAT_FILES_UPDATE",p))}function o(){C={},H=null,i.chatFiles=null,i.filesLoaded=!1,A=0}function p(){o(),(B.type==h.USER||B.type==h.CONTACT)&&(i.isloading=!1,q());var a=b.getItemFiles(B);a===c?(i.isloading=!1,q()):a&&a.length&&(i.isloading=!1,i.chatFiles=a.slice().reverse(),i.filesLoaded=!0,A=a.length,i.showAttachments?setTimeout(function(){i.showSharedFiles(!0);var a=g.getSettingsPanelScrollPosition(!0);a?setTimeout(function(){x.scrollTop(a)},1):setTimeout(t,1)},1):q())}function q(){i.$$phase||i.$digest(),i.$broadcast("render")}function r(){E&&clearTimeout(E),E=setTimeout(function(){if(i.showAttachments&&i.filesLoaded){s();var a=0;if(D)var a=D-F;else D=F;(a>6||-6>a)&&(C={},D=F),q(),t()}},50)}function s(){K=a.innerHeight;var b=x.width()-10;G=b>260?3:b>170?2:1,F=b/G-4,i.thumbSize=F+"px",F+=4}function t(){if(A){if(I)return;I=setTimeout(function(){H||(H=j.find(".file_container"));var a,b,c,d,e=0,f=y.offset().top,g=0,h=0;0>f&&(h=Math.floor(-1*f/F),f=0);var k=h*G,l=Math.ceil((K-f)/F),m=h+l;for(g=(m+1)*G-1,g>A-1&&(g=A-1);A>e;e++)d=i.chatFiles[e],e>=k&&g>=e?(a="gif"==d.type.toLowerCase(),C[d.file_id]||u(d,$(H[e]),a),c=C[d.file_id],c.isShowing||(b=c.imageElement[0],b&&(b.src!=c.imgSrc&&(b.src=c.imgSrc),c.isShowing=!0))):d.thumbnail_name&&C[d.file_id]&&(c=C[d.file_id],b=c.imageElement[0],b&&(c.isShowing=!1,b.onload=null,b.src=J));I=null},100)}}function u(a,b,c){var e,f,g=a.ver>=5?"490x250":"566x600",h=B.itemId,j=!1;if(a.thumbnail_name&&(e=b.find("img"),f=d("getNoteThumbnailPath")(a,h,null,null,g)),"VIDEO"==a.file_format){var k=b.find(".videoHoverIcon");0==k.length&&b.prepend('<div class="videoHoverIcon" popover-data-id="cnv-8"></div>')}if(i.isAudioFileType(a.type)||"SUCCESS"!==a.status||!a.thumbnail_name){var l=b.find(".fileplainlarge-darkgray");0==l.length&&b.prepend('<span class="cnv-icons-64 fileplainlarge-darkgray file_span"></span>'),j=!0}else e&&0!=e.length||(c&&(b.prepend('<div class="atta_gif_Icon" popover-data-id="cnv-8">GIF</div>'),b.hover(v,w)),b.prepend('<img class="thumbnail-file-preview" file-id="'+a.file_id+'" src="'+f+'"/>'),e=b.find(".thumbnail-file-preview"));if(a.shouldShowName=!a.thumbnail_name||"DOC"==a.file_format||"SUCCESS"!==a.status||"OTHER"==a.file_format||"VIDEO"==a.file_format,a.thumbnail_image=f,C[a.file_id]={isShowing:j,gifSource:c?d("getOriginalImagePath")(a.original_name,h):"",imgSrc:f,imageElement:e},e){var m=+a.width,n=+a.height,o=F-6;if(m>n){var p,q,r=0;o>n?(p=n,q=m,r=-(p-o)/2):(p=o,q=m*p/n);var s=-(q-o)/2;o>=q&&(s=0),s-=1,e.css({height:p+"px",width:"auto","margin-top":"-4px","margin-left":s+"px"})}else{var t,q;o>m?(t=m,heightVal=n):(t=o,heightVal=n*t/m);var r=-(heightVal-o)/2;heightVal<=o&&(r=-2),r-=2,e.css({width:t+"px",height:"auto","margin-left":"-1px","margin-top":r+"px"})}}}function v(){var a=$(this),b=a.find(".thumbnail-file-preview"),c=a.find(".atta_gif_Icon");c.css({"border-top":"2px solid #999","-webkit-animation":"rotate 1s linear infinite",animation:"rotate 1s linear infinite",display:"block"}).text("");var d=C[b.attr("file-id")];b[0].onload=function(){this.onload=null,c.hide()},b.attr("src",d.gifSource)}function w(){var a=$(this),b=a.find(".thumbnail-file-preview"),c=C[b.attr("file-id")];b[0].onload=null,b.attr("src",c.imgSrc),a.find(".atta_gif_Icon").css({"border-top":"","-webkit-animation":"none",animation:"none",display:"block"}).text("GIF")}i.showAttachments=!0,j[0].cnvFullViewChatAttachementsElement=new m,i.cnvFullViewChatAttachments=new l;var x=j.closest(".chat-settings-container"),y=j.find(".attachmentsIcon"),z=$(this).find(".cnv-icons-15");y.hover(function(){z.addClass("icons2_Dropdown-darkgray"),z.removeClass("icons2_Dropdown-lightgray")},function(){z.addClass("icons2_Dropdown-lightgray"),z.removeClass("icons2_Dropdown-darkgray")});var A,B,C={};i.isloading=!0,b.on("SelectedItemChange",n),i.showSharedFiles=function(a){if(i.showAttachments=!i.showAttachments||a,i.showAttachments&&i.filesLoaded){y.closest(".chatAttachmentsSection");y.css({transform:"translateY(-1px) rotate(180deg)"}),z.attr("title","Hide shared files"),C={},s(),x.on("scroll",t),setTimeout(t,1),i.filesRendered=!0}else y.css({transform:"translateY(5px) rotate(0deg)"}),z.attr("title","Show shared files"),x.off("scroll",t);q()},n();var D,E;a.addEventListener("resize",r,!1);var F,G,H,I=null,J="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",K=a.innerHeight;i.isAudioFileType=function(a){return"Audio"===f.getFileFormat(a)},i.onFileClicked=function(b,c){e.showingLargeChatGallery=!0,$(b.currentTarget).trigger("mouseout"),i.$emit("cacheScrollPositions"),a.location.href=d("getFileResourceLinkUrl")(c.file_id,c.file_format,6,"6",B.itemId,c.name,"21")},i.$on("$destroy",function(){b.off("SelectedItemChange",n),B&&B.removeListener("CHAT_FILES_UPDATE",p),a.removeEventListener("resize",r,!1),x&&x.off("scroll",t),y.off("mouseenter mouseleave");for(var c,d=j.find(".file_container").off("mouseenter mouseleave"),e=0;e<d.length;e++)c=$(d[e]).find("img"),c&&c.length>0&&(c.onload=null)})},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvChatMember",["ChatsViewDataManager",function(a){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatMember.tpl.html",link:function(a,b,c){function d(){a.$broadcast("render"),a.$broadcast("render_date")}function e(){a.$broadcast("render_date")}a.item.addListener("UPDATE",d),a.item.addListener("UPDATE_TIME",e),a.$on("$destroy",function(){a.item.removeListener("UPDATE",d),a.item.removeListener("UPDATE_TIME",e)})},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvChatMessage",["ChatsViewDataManager","$rootScope","utils",function(b,c,d){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatMessage.tpl.html",link:function(b,d,e){function f(){b.msgItem.fileInfo&&b.calculateImageDimentions(d.width()),b.$broadcast("render"),b.$broadcast("render_date")}function g(){b.$broadcast("render_date")}function h(){j||(j=setTimeout(function(){f(),j=null},100))}var i=$(a);b.msgItem.addListener("UPDATE",f),b.msgItem.addListener("UPDATE_TIME",g),b.onFileClicked=function(d){c.showingLargeChatGallery=!0,b.$emit("cacheScrollPositions"),a.location.href=d.fileResourceLinkURL},b.msgItem.fileInfo&&i.on("resize",h);var j;b.$on("$destroy",function(){b.msgItem.removeListener("UPDATE",f),b.msgItem.removeListener("UPDATE_TIME",g),i.off("resize",h)})},controller:["$scope",function(a){a.calculateImageDimentions=function(b){b=b||$(".messages-list").width()-10;var c,e,f=a.msgItem.message,g=f.fileInfo,h=Math.min(.6*b,420);if(g.thumbnailName){var e=+g.width,c=+g.height;d.isRetina()&&(e/=2,c/=2),e>c&&e>h&&(c*=h/e,e=h),c>h&&(e*=h/c,c=h),50>e&&(e=0==e?180:50),50>c&&(c=50)}else e=180,c=100,g.thumbnail_name=null;a.msgItem.fileInfo.fileHeight=c+"px",a.msgItem.fileInfo.fileWidth=e+"px"},a.msgItem.fileInfo&&a.calculateImageDimentions()}]}}]),b.module("convoApp").directive("cnvChatMessageInput",["ChatsViewDataManager","ChatMessagesUtils","utils","atMentionsListProvider","mixpanelService","$q","ChatConstants","config","BlackListWordsService",function(b,c,d,e,f,g,h,i,j){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatMessageInput.tpl.html",link:function(e,g,k){function l(){}function m(){}function n(){e.$broadcast("render")}function o(a){b.isNewChatData(a)?a.addListener("CHAT_CHANGED",q):a.addListener("UPDATE",u)}function p(a){b.isNewChatData(a)?a.removeListener("CHAT_CHANGED",q):a.removeListener("UPDATE",u)}function q(){var a=r();e.chat=a?a.chat:null,v(),n()}function r(){return b.isNewChatData(e.currentItem)?e.currentItem.chatViewData:e.currentItem}function s(a){if(e.currentItem!=a.item){e.currentItem&&(p(e.currentItem),e.cancelComposing(!0),e.clearMessageInput()),e.currentItem=a.item,e.currentItem&&o(e.currentItem);var b=r();e.chat=b?b.chat:null,e.currentItem&&v(),n()}}function t(){v()}function u(a){b.isAdminMode()?x():e.currentItem&&(e.currentItem.thisUserLeft||e.currentItem.disabled?(e.cancelComposing(!0),e.clearMessageInput(),e.inputDisabled||x()):e.inputDisabled&&y())}function v(){b.isAdminMode()?x():e.currentItem&&(e.currentItem.thisUserLeft||e.currentItem.disabled?x():y())}function w(){var a=i.IS_NATIVE?"Desktop":"Web",b={Via:a+" Big Chat"};f.trackEvent(f.CHATS_SEND_MESSAGE,b)}function x(){e.textEditorCtrl&&e.textEditorCtrl.initialized&&(e.textEditorCtrl.disable(),e.inputDisabled||(e.inputDisabled=!0,n()))}function y(){e.textEditorCtrl&&e.textEditorCtrl.initialized&&(e.textEditorCtrl.enable(),e.inputDisabled&&(e.inputDisabled=!1,n()),b.isNewChatData(e.currentItem)?e.currentItem.inputMessageText&&e.currentItem.inputMessageText.length&&e.textEditorCtrl.setContent(e.currentItem.inputMessageText):setTimeout(function(){D||(e.currentItem.inputMessageText&&e.currentItem.inputMessageText.length?e.textEditorCtrl.setContent(e.currentItem.inputMessageText,!0):e.textEditorCtrl.focus())},1))}function z(){messageInputResizeHandler&&messageInputResizeHandler()}function A(){b.on("SelectedItemChange",s),b.on(h.ADMIN_MODE_CHANGE,t);var a=b.getSelectedItem();a&&s({item:a}),g.closest("#fullViewChatAppCont").on("mouseup",B),setTimeout(function(){e.elementHeight=g.outerHeight()},0)}function B(b){var c=!0,d=(b.target,b.target.classList),c=d.contains("emptyNewChatMessage")||d.contains("user-name")||d.contains("chatLogoContainer")||d.contains("chats-content-container")||d.contains("messages-list");if(!c){var f=$(b.target),g=f.closest(".message-input-container");g&&0!=g.length||(g=f.closest(".emptyNewChatMessage")),g&&0!=g.length||(g=f.closest(".header-title")),g&&0!=g.length||(g=f.closest(".messages-list")),c=g&&g.length>0}!e.textEditorCtrl.hasFocus()&&c&&""==$.trim(a.getSelection().toString())&&e.textEditorCtrl.initialized&&e.textEditorCtrl.focus()}g[0].cnvFullViewChatMessageInputElement=new m,e.cnvFullViewChatMessageInput=new l,e.inputDisabled=!0,e.showNewMessageBtn=!1;var C=e[k.onNewMessageButtonClick],D=!1;e.$on("ShowNewMessageButton",function(){e.showNewMessageBtn||(e.showNewMessageBtn=!0,n())}),e.$on("HideNewMessageButton",function(){e.showNewMessageBtn&&(e.showNewMessageBtn=!1,n())}),e.onTextEditorSubmitOnEnter=function(){if(e.textEditorCtrl.getEditorText().trim().length){e.currentItem&&(e.currentItem.inputMessageText=null);var a=j.cleanFromHTMLText(e.textEditorCtrl.getEditorHtmlText());a=c.cleanInputMessageText(a);var d=r(),f=d?d.chat:null;a&&a.length&&!/^\s*$/.test(a)&&f&&(e.cancelComposing(),b.sendMessageInChat(a,f),e.textEditorCtrl.clearContent(),w())}},e.onSpaceKeyPressInTextEditor=function(){var a=e.textEditorCtrl.getEditorText().trim();a&&a.length&&e.textEditorCtrl.cleanBlackListedWords()},e.newMsgButtonClickHandler=function(){C&&(C(),e.showNewMessageBtn=!1,n())},e.onAttachmentButtonClick=function(){var a=$(".message-input-box .inputHide",g);a.length&&d.fireEvent(a[0],"click")},e.giphyObject={searchText:"",actionType:""},e.openGiphyPopUp=function(){g.find("#iShowGiphyPopup").trigger("showGiphyPopover")},e.$on("$destroy",function(){g[0].cnvFullViewChatMessageInputElement=null,b.off("SelectedItemChange",s),b.off(h.ADMIN_MODE_CHANGE,t),g.closest("#fullViewChatAppCont").off("mouseup",B),e.giphyObject=null,g.off("resize",z),g.off(),e.textEditorCtrl.captureEvents.off(),e.textEditorCtrl.editorInitialized=null,e.currentItem&&p(e.currentItem),e.cancelComposing(!0),D=!0}),e.$on("setFocusOnInput",function(){!b.isNewChatData(e.currentItem)&&e.textEditorCtrl.initialized&&e.textEditorCtrl.focus()}),e.sendVideoCallLink=function(a,c,d){e.currentItem&&e.currentItem&&b.sendVideoMessageInChatItem(a,e.currentItem,d,c)},A()},controller:["$scope","$element","$attrs","appearinVideoCallService",function(a,c,d,i){function j(){return u}function k(){u&&(clearTimeout(u),u=null)}function l(){k(),u=setTimeout(function(){b.composingStarted(a.chat),t=Date.now(),u=null},w)}function m(){v&&(clearTimeout(v),v=null)}function n(){m(),v=setTimeout(function(){b.composingPaused(a.chat),k(),v=null},x)}function o(){var d=a.textEditorCtrl.getEditorText();if(a.currentItem&&(a.currentItem.inputMessageText=a.textEditorCtrl.getEditorHtmlText()),d=d.trim(),d.length>0){var e=(Date.now()-t)/1e3;n(),j()||(e>=10?(b.composingStarted(a.chat),t=Date.now()):l())}else k(),m(),b.composingPaused(a.chat);if(a.elementHeight>0){var f=c.outerHeight();if(f!=a.elementHeight){var g=f-a.elementHeight;a.elementHeight=f,q&&q(g)}}}function p(){a.textEditorCtrl.captureEvents.on("text-change",o)}var q=a[d.onMessageInputResize];a.elementHeight=0;var r={min:22,max:120},s={};a.textEditorCtrl={},a.textEditorCtrl.initialized=!1,a.textEditorCtrl.initialHtmlText="",a.textEditorCtrl.height=r,a.textEditorCtrl.captureEvents=s,a.textEditorCtrl.editorInitialized=p;var t,u,v,w=2e3,x=15e3;a.cancelComposing=function(c){k(),c&&v&&a.chat&&b.composingPaused(a.chat),m()},a.onEscKeyPressInTextEditor=function(){a.textEditorCtrl.getEditorText()&&a.textEditorCtrl.clearContent(),(j()||v)&&(k(),m(),b.composingPaused(a.chat))},a.onFocusOut=function(a){},a.clearMessageInput=function(){a.textEditorCtrl.getEditorText()&&a.textEditorCtrl.clearContent()},a.getCommandsWithDropdownItems=function(b,c){if(!a.chat||!a.chat.isInviteChat){var d=g.defer(),f=[];return"@"==c?f=e.queryAvailableCommands(b,5,e.sources.CHAT):":"==c&&(f=e.queryEmojiData(b,5)),d.resolve(f),d.promise}},a.OnCommandExecuted=function(b,c){if(a.chat){var d=_.keys(a.chat.participants).length;"Giphy"===b.label?setTimeout(function(){a.textEditorCtrl.getSelection(),a.giphyObject={searchText:c,actionType:"command"},a.openGiphyPopUp()},0):"Appear.in"===b.label&&i.generateAppearinVideoCallLink().then(function(b){var c=b.directLink,e="You started an appear.in video call.\n\ud83c\udfa5  <a href='"+c+"'>Join now: "+b.roomName+"</a>";a.sendVideoCallLink(e,h.VIDEO_MSG_APPEAR_IN,c),f.trackEvent(f.SENT_VIDEO_CALL,{Type:"Appear",Participants:d})})}}}]}}]),b.module("convoApp").directive("cnvChatMessagesContainer",["ChatsViewDataManager","appStateInfo","utils","UploadService","ChatViewsManager","$filter","ChatConstants","cnvChatsFilesUploadManager",function(a,b,c,d,e,f,g,h){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatMessagesContainer.tpl.html",link:function(i,j,k){function l(){}function m(){}function n(){this.node=ea[0],this.previousScrollHeightMinusTop=0,this.readyFor="up"}function o(){i.$broadcast("render")}function p(){ia=[],ja=null,i.messageItems=a.getMessageItems(i.chatViewData),a.isNewChatData(i.selectedItem)&&0==i.messageItems.length?i.showCreateNewMessage=!0:i.showCreateNewMessage=!1,o(),ga&&Q(),q(ea.scrollTop())}function q(a){var b,c,d,e,g;ja&&0!=ja.length||(ja=j.find(".isGif"),ka=ea[0].clientHeight);for(var h=0;h<ja.length;h++){var k=ia[h];if(k)b=k.element,c=k.top,d=k.isLoaded,e=k.gifImgHtml,g=k.height;else{var l=ja[h];b=$(l),c=l.offsetTop,g=l.clientHeight/2,d=b.hasClass("gifLoaded");var m=b.attr("index"),n=i.messageItems[+m];if(!n)var m=b.closest(".chat-message-item").index(),n=i.messageItems[m];if(!n)return ja=null,void setTimeout(function(){q(a)},50);var o=n.message.fileInfo,p=f("getOriginalImagePath")(o.originalName,i.chat.chatId);e='<img class="original-gif image-ctrl" cnv-popover cnv-popover-ctrl="'+o.name+'" onError="this.onerror=null;this.src=\'assets/img/chat/fileplainlarge.png\';" src="'+p+'"/>',k=ia[h]={element:b,top:c,isLoaded:d,gifImgHtml:e,height:g}}c>a-g&&a+ka-g>c?d||(b.append(e),k.isLoaded=!0,b.find(".original-gif")[0].onload=function(){$(this.parentElement).find(".gifIndicators").remove(),this.onload=null}):d&&(k.isLoaded=!1,b.find(".original-gif").remove(),b.removeClass("gifLoaded"))}}function r(){return ga}function s(a){i.chat==a.chat&&(da=_,x(),p(),L())}function t(a){i.chat==a.chat&&p()}function u(){P()&&o()}function v(a){i.chat==a.chat&&p()}function w(a){i.chat==a.chat&&(r()?da=_:a.message.senderId!=i.chat.thisUser.userId&&y(),L(a.message),p())}function x(){i.$broadcast("HideNewMessageButton")}function y(){i.$broadcast("ShowNewMessageButton")}function z(a){i.chat==a.chat&&(r()&&(da=ca),p())}function A(){da=aa}function B(a){i.loadingOlderMessages?(i.loadingOlderMessages=!1,A()):da=Z,i.fireRenderCompleteOnItem=a.lastMessageItem,p()}function C(a){i.chat==a.chat&&(p(),L())}function D(b){F(i.chatViewData),a.isNewChatData(b)&&(b.addListener("UPDATE",M),b.addListener("CHAT_CHANGED",N))}function E(b){G(i.chatViewData),a.isNewChatData(b)&&(b.removeListener("UPDATE",M),b.removeListener("CHAT_CHANGED",N))}function F(a){a&&(a.addListener("UPDATE",M),a.addListener(g.SEARCH_STARTED,H),a.addListener(g.SEARCH_ENDED,I),a.addListener(g.LOADED_MORE_MSGS_IN_SEARCH,J),a.addListener(g.MATCH_FETCH_COMPLETE,K))}function G(a){a&&(a.removeListener("UPDATE",M),a.removeListener(g.SEARCH_STARTED,H),a.removeListener(g.SEARCH_ENDED,I),a.removeListener(g.LOADED_MORE_MSGS_IN_SEARCH,J),a.removeListener(g.MATCH_FETCH_COMPLETE,K))}function H(){i.chatViewData&&(i.isInSearch=null!=i.chatViewData.searchInfo),i.isInSearch&&(fa=!1,p())}function I(){i.chatViewData&&(i.isInSearch=null!=i.chatViewData.searchInfo),i.isInSearch||(i.chat&&a.chatOpened(i.chat),
fa=!1,da=Z,p(),Q())}function J(){fa&&(da=aa,ha.prepareFor("up")),p()}function K(){p(),setTimeout(R,100)}function L(c){b.appHasFocus()&&b.isAppActivated()&&!b.isAppInShortIdleState()&&!b.isAppInLongIdleState()&&i.chatViewData&&!a.isNewChatData(i.selectedItem)&&(c?a.messageReadInChat(c,i.chat,!0):a.markChatReadIfNeeded(i.chatViewData))}function M(){var a=!1,b=P(),c=!1;i.chatViewData&&i.chatViewData.composingUsers&&i.chatViewData.composingUsers.length?i.showComposing||(i.showComposing=!0,a=r(),p(),c=!0,a&&Q()):i.showComposing&&(i.showComposing=!1,a=r(),p(),c=!0,a&&Q()),b&&!c&&o()}function N(){var b=W();i.chatViewData!=b&&(G(i.chatViewData),i.chatViewData=b,F(i.chatViewData)),i.isNewChat&&(i.showCreateNewChatLink=i.selectedItem.matchFound&&i.chatViewData&&i.chatViewData.type==g.GROUP_CHAT);var c=i.chatViewData?i.chatViewData.chat:null;i.chat!=c&&(da=Z,i.chat&&a.chatClosed(i.chat),i.chat=c,i.chat&&a.chatOpened(i.chat),X()),p()}function O(b){if(i.selectedItem!=b.item){i.selectedItem&&E(i.selectedItem),i.selectedItem=b.item,i.chatViewData=W(),i.isNewChat=a.isNewChatData(i.selectedItem),i.isNewChat?i.showCreateNewChatLink=i.selectedItem.matchFound&&i.chatViewData&&i.chatViewData.type==g.GROUP_CHAT:i.showCreateNewChatLink=!1,i.selectedItem&&(D(i.selectedItem),i.chatViewData?(i.isInSearch=null!=i.chatViewData.searchInfo,M()):i.isInSearch=!1);var c=i.chatViewData?i.chatViewData.chat:null;i.chat!=c&&(da!=ca&&(da=Z),i.chat&&a.chatClosed(i.chat),i.chat=c,i.chat&&(a.chatOpened(i.chat),L()),X()),P(),p(),x(),ga=!0}}function P(){var b=!1;return i.chatViewData&&(i.chatViewData.thisUserLeft||i.chatViewData.disabled)&&(b=!0),i.chat&&i.chat.isInviteChat&&(b=!0),a.isAdminMode()&&(b=!0),i.disableFileInput!=b?(i.disableFileInput=b,!0):!1}function Q(a,b){var c=function(){var b=ea[0].scrollHeight;a==Z?ea.animate({scrollTop:b},{duration:10}):ea.scrollTop(b);var c=e.getMessagesListScrollPosition(!0);c&&ea.scrollTop(c)};b?(a!=Z&&ea.scrollTop(ea[0].scrollHeight),setTimeout(c,b)):c()}function R(){var a=j.find(".highlight");if(a.length){var b=a.closest(".chat-message-item").position().top,c=ea[0].clientHeight/2,d=ea.scrollTop(),e=d+b-c+a.height()/2;0>e&&(e=0),ea.scrollTop(e)}}function S(){L()}function T(){la&&(la.destroyViewRelatedData(),d.off("cnvchange",V),la=null)}function U(a,b){b&&b.event&&(b.event==d.EVENT_FILE_SELECTED?i.insertOptionsCtrl.onFileSelected(b.file):i.insertOptionsCtrl.onChange(b))}function V(a,b){b.resourceId===i.chat.chatId&&U(null,b)}function W(){return a.isNewChatData(i.selectedItem)?i.selectedItem.chatViewData:i.selectedItem}function X(){setTimeout(function(){T();var a=c.generateUniqueCharId();j.find("div input[type=file]").attr("id",a);var b=i.chat?i.chat.chatId:"none",e={id:"#"+a,resourceId:b,uploadFrom:"chat-window",dropZoneId:"body",pasteZoneId:"#"+i.messagesContainerId,uploadAcknowledgement:function(){return!i.disableFileInput}};la=d.init(e),i.fileInputContext=la.context,d.on("cnvchange",V),h.init()},0)}function Y(){b.on("appActivate",S),b.on("appActive",S),b.on("appFocus",S),a.on("SelectedItemChange",O),a.on("MessageSentInChat",s),a.on("MessageReceivedAtServer",v),a.on("MessageReceivedInChat",w),a.on("ChatHistoryLoaded",B),a.on("NewerMessagesLoaded",C),a.on("FileUploadedInChat",z),a.on("MessageRemovedInChat",t),a.on(g.ADMIN_MODE_CHANGE,u);var c=a.getSelectedItem();c&&O({item:c})}j[0].cnvMemLeakHook=new m,i.cnvFullViewChatMessageContainer=new l;var Z=1,_=2,aa=3,ba=4,ca=5,da=ca,ea=j.find(".messages-list"),fa=!1;i.chatViewData=null,i.isInSearch=!1,i.invitedChatMessage=null;var ga=!0;i.disableFileInput=!1,i.isNewChat=!1,i.showCreateNewChatLink=!1,n.prototype.restore=function(){"up"==this.readyFor&&(this.node.scrollTop=this.node.scrollHeight-this.previousScrollHeightMinusTop)},n.prototype.prepareFor=function(a){this.readyFor=a||"up",this.previousScrollHeightMinusTop=this.node.scrollHeight-this.node.scrollTop};var ha=new n;i.loadingOlderMessages=!1,i.containerScrolled=function(b,c){var d=!1;ga=c,!i.isInSearch&&1>b&&i.chat&&a.loadOlderMessagesInChat(i.chat)?(i.loadingOlderMessages=!0,d=!0,ha.prepareFor("up")):(q(b),c&&x()),d&&p()};var ia=[],ja=null,ka=0;i.onListRenderComplete=function(){da==_||da==Z?(Q(),da=0):da==ca?(Q(da,1),da=0):da==aa?(ha.restore(),da=0):da==ba&&(da=0,R()),i.fireRenderCompleteOnItem=null},i.onMessageInputResize=function(a){r()&&Q()},i.resendMessage=function(b){a.resendMessageInChat(b,i.chat)},i.downloadFile=function(b){a.downloadFileFromChat(b,i.chat)},i.onNewMessageButtonClick=function(){Q(!1,1)},i.loadNextMatch=function(){fa=!1,a.loadNextMatch(i.chatViewData)},i.loadPreviousMatch=function(){fa=!1,a.loadPreviousMatch(i.chatViewData)},i.cancelSearch=function(){fa=!1,a.cancelSearch(i.chatViewData)},i.loadMessagesBeforeMsgItem=function(b){fa=!0,a.loadMessagesBeforeMsgItem(i.chatViewData,b)},i.loadMessagesAfterMsgItem=function(b){fa=!1,a.loadMessagesAfterMsgItem(i.chatViewData,b)},i.cancelMessageItem=function(b){a.cancelMessageItem(i.chatViewData,b)},i.explicitlyCreateNewChat=function(){i.isNewChat&&a.explicitlyCreateNewChat()},i.$on("$destroy",function(){b.off("appActivate",S),b.off("appActive",S),b.off("appFocus",S),a.off("SelectedItemChange",O),a.off("MessageSentInChat",s),a.off("MessageReceivedAtServer",v),a.off("MessageReceivedInChat",w),a.off("ChatHistoryLoaded",B),a.off("NewerMessagesLoaded",C),a.off("FileUploadedInChat",z),a.off("MessageRemovedInChat",t),a.off(g.ADMIN_MODE_CHANGE,u),T(),ea=null,i.selectedItem&&E(),ia=null});var la;Y()},controller:["$scope",function(b){function c(c){c=[c];for(var d in c)c[d].noteId=b.chat.chatId;b.$broadcast("enqueueFile",c);var e=c[0];e==b.files[0]&&console.log("both are same"),a.sendFilesInChat(b.chat,c[0])}function d(){b.insertOptionsCtrl={onFileSelected:c},b.filesUploadManagerCtrl={initialized:!1,templateType:"chat",filesArrayObj:b.files,dontClearPendingFileUploadsOnDestroy:!0}}b.files=[],b.messagesContainerId="fv_chat_messages_container",d()}]}}]),b.module("convoApp").directive("cnvChatProfileImage",["ChatsViewDataManager","ChatConstants",function(a,b){return{restrict:"E",priority:0,replace:!0,scope:!0,templateUrl:"chat/fullviewclient/templates/ChatProfileImage.tpl.html",link:function(c,d,e){function f(){c.pictureDims=c.size=c.$eval(e.size,10)||184,c.singleUser||(c.pictureDims=Math.floor(c.size/2)),a.on("SelectedItemChange",g);var b=a.getSelectedItem();b&&g({item:b})}function g(a){c.item!=a.item&&(null!=c.item&&c.item.removeListener("UPDATE",h),c.item=a.item,c.item.addListener("UPDATE",h),h())}function h(){if(c.item){var a=!1;c.item.type==b.CONTACT?(c.contact=c.item.contact,c.user=null,a=!0):c.item.type==b.USER?(a=!0,c.user=c.item.user,c.contact=null):(a=1==c.item.users.length,c.user=c.item.users[0],c.contact=null),c.singleUser=a,c.pictureDims=c.size,c.singleUser||(c.pictureDims=c.pictureDims/2),c.lineHeight=c.pictureDims,c.fontSize=c.lineHeight/2,i()}}function i(){c.$broadcast("refreshImage"),c.$broadcast("render")}c.singleUser=!0,c.item=null,c.user=null,c.contact=null,c.size=184,c.pictureDims=184,c.lineHeight=88,c.fontSize=40,c.$on("$destroy",function(){a.off("SelectedItemChange",g),null!=c.item&&c.item.removeListener("UPDATE",h)}),f()},controller:["$scope",function(a){a.loadingItems=!0}]}}]),b.module("convoApp").directive("cnvChatSearchControl",["ChatConstants","ChatsViewDataManager",function(a,b){return{restrict:"E",priority:0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatSearchControl.tpl.html",link:function(b,c,d){function e(){b.$broadcast("render")}function f(){i&&(clearTimeout(i),i=null)}function g(a){f(),""==p.val()?b.endSearch(!0,!0):(b.isInSearch||(b.isInSearch=!0,e()),i=setTimeout(function(){j&&j(p.val())},100))}function h(){p.on("input",g)}b.isInSearch=!1;var i,j=b[d.onSearch],k=b[d.onSearchCanceled],l=b[d.onSearchEnded],m=b[d.onArrowKeyUp],n=b[d.onArrowKeyDown],o=b[d.onEnterKeyDown],p=c.find(".chats-search-input");b.onSearchInputKeyDown=function(a){27==a.which?b.endSearch(!0):13==a.which?(o&&o(),b.endSearch()):38==a.which?m&&m():40==a.which&&n&&n()},b.endSearch=function(a,c){p.val(""),c||p.blur(),b.isInSearch&&(f(),b.isInSearch=!1,a?k&&k():l&&l(),e())},b.$on("$destroy",function(){p.off("input",g)}),b.$on(a.RESET_SEARCH_CONTROL,function(){b.endSearch()}),h()},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvChatSettingsContainer",["ChatsViewDataManager","chatUsersManager","FiltersQueryTransformer","$location","AppLinks","utils","ChatGorupImageService","$q","alertsService","ChatConstants","mixpanelService","config",function(a,b,c,d,e,f,h,i,j,k,l,m){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatSettingsContainer.tpl.html",link:function(n,o,p){function q(){}function r(){}function s(){n.isAdminMode?n.groupChatMemberOptions={type:"more-options",options:[{label:"View profile",callback:n.viewProfile},{label:"Share a post",callback:n.shareAPost}]}:(n.groupChatMemberOptions={type:"more-options",options:[{label:"Start a chat",callback:n.startAChat},{isDivider:!0},{label:"View profile",callback:n.viewProfile},{label:"Share a post",callback:n.shareAPost}]},n.groupChatSelfOptions={type:"more-options",options:[{label:"View profile",callback:n.viewProfile},{label:"Share a post",callback:n.shareAPost}]})}function t(){a.on("SelectedItemChange",u),a.on(k.ADMIN_MODE_CHANGE,v),o.find(".emoji-popup-btn").on("setFocusOnHideEmojiPopover",A);var b=a.getSelectedItem();b&&u({item:b})}function u(a){if(n.selectedChat!=a.item){if(null!=n.selectedChat&&n.selectedChat.removeListener("UPDATE",w),n.selectedChat=a.item,n.selectedChat&&n.selectedChat.chat){var b=h.uploadingImagesForChatsMap;b[n.selectedChat.chat.chatId]?o.find(".groupChatPhotoEditSpinner").show():o.find(".groupChatPhotoEditSpinner").hide()}n.cancelRenameGroupChat(a),n.selectedChat&&(n.selectedChat.addListener("UPDATE",w),w())}}function v(){n.selectedChat&&!a.isNewChatData(n.selectedChat)&&w()}function w(){n.isMuted=n.selectedChat.chat&&n.selectedChat.chat.isMuted,n.isGroupChat=n.selectedChat.isGroupChat,n.isDisabled=n.selectedChat.thisUserLeft||n.selectedChat.disabled,n.disableChatOptions=n.selectedChat.type==k.CONTACT,n.isAdminMode=a.isAdminMode();var b=[];if(n.isGroupChat){n.isDisabled||n.isAdminMode?b.push({label:"Share this chat",callback:n.shareThisChat}):(b.push({label:"Add people",callback:n.invitePeopleInChat}),b.push({isDivider:!0}),b.push({label:"Rename group",callback:n.initRenameGroupChat}),b.push({label:"Share this chat",callback:n.shareThisChat}),b.push({isDivider:!0}),n.isMuted?b.push({label:"Unmute chat",callback:n.muteChat}):b.push({label:"Mute chat",callback:n.muteChat}),b.push({label:"Leave chat",callback:n.leaveChat})),B=0;for(var c in n.selectedChat.chatMembers)++B;C+1>=B?(n.chatMembersDisplayCount=B,n.showAllMembersText=null):"Show Less"==n.showAllMembersText?n.chatMembersDisplayCount=B:(n.chatMembersDisplayCount=C,n.showAllMembersText="Show All ("+B+")"),s()}else n.selectedChat.disabled?(b.push({label:"Share this chat",callback:n.shareThisChat}),b.push({label:"View profile",callback:n.viewProfileWrapper})):n.isAdminMode?(b.push({label:"Share this chat",callback:n.shareThisChat}),b.push({isDivider:!0}),b.push({label:"View profile",callback:n.viewProfileWrapper}),b.push({label:"Share a post",callback:n.shareAPostWrapper})):(b.push({label:"Start a group chat",callback:n.startAGroupChat}),b.push({label:"Share this chat",callback:n.shareThisChat}),b.push({isDivider:!0}),b.push({label:"View profile",callback:n.viewProfileWrapper}),b.push({label:"Share a post",callback:n.shareAPostWrapper}),b.push({isDivider:!0}),n.isMuted?b.push({label:"Unmute chat",callback:n.muteChat}):b.push({label:"Mute chat",callback:n.muteChat})),n.showAllMembersText=null,n.chatMembersDisplayCount=0,B=0;if(n.chatOptions&&(n.chatOptions.options=b),a.isNewChatData(n.selectedChat)){var d=n.selectedChat.chatViewData;d?(n.selectedChat.chatIconUrl=d.chatIconUrl,n.chatTitle=d.biggerChatTitle):n.chatTitle="New Chat"}else n.selectedChat.biggerChatTitle?n.chatTitle=n.selectedChat.biggerChatTitle:n.selectedChat.title?n.chatTitle=n.selectedChat.title:2>B?n.chatTitle="Empty Room.":n.chatTitle=" ";x()}function x(){n.$broadcast("render")}function y(a){var b=m.IS_NATIVE?"Desktop":"Web",c=b+" Big Chat";l.trackEvent(a,{Via:c})}function z(a){if(this.files.length>0){var b=this.files[0];o.find(".groupChatPhotoEditSpinner").show();var c=h.uploadChatGroupPhoto(b,n.selectedChat);c.then(function(a){a&&(setTimeout(function(){o.find(".groupChatPhotoEditSpinner").hide()},500),y(l.UPLOAD_GROUP_CHAT_PHOTO))})}var d=o.find("#groupPictureInput");d.off("change",z),d.val(null)}function A(){o.find(".group-chat-rename-input-field").focus()}o[0].cnvFullViewChatSettingsContainerElement=new r,n.cnvFullViewChatSettingsContainer=new q,n.selectedChat=null,n.isGroupChat=!1,n.isDisabled=!1,n.isMuted=!1,n.disableChatOptions=!1,n.showAllMembersText=null,n.chatMembersDisplayCount=0;var B=0,C=4;n.muteChat=function(b,c,d){b&&b.stopPropagation(),a.muteChat(n.selectedChat.chat,!n.isMuted)},n.startAChatWrapper=function(){n.startAChat({userId:n.selectedChat.users[0].userId,email:n.selectedChat.users[0].email})},n.startAChat=function(c,d){var e=b.getUserById(c.userId);a.startChatWithUser(e,!1)},n.startAGroupChat=function(){var c=n.selectedChat?n.selectedChat.chat:null;if(c){var d=c.getOtherParticipant(c.thisUser.userId);if(d){var e=b.getUserById(d.userId);e&&a.createNewChat([e])}}},n.shareThisChat=function(a){D()};var D=function(){for(var a,b,c=n.selectedChat.chat.messages,d="Chat with "+n.selectedChat.biggerChatTitle,e="",f=0;f<c.length;f++)c[f].type==g.chatsdk.MessageType.MESSAGE&&(a="<b>"+n.selectedChat.chat.participants[c[f].senderId].name+"</b>",b="<p>"+c[f].messageText+"</p> <br/>",e+=a+b);n.$emit("openComposeBox",[e,d])};n.shareAPostWrapper=function(){n.shareAPost({userId:n.selectedChat.users[0].userId,email:n.selectedChat.users[0].email})},n.shareAPost=function(a,f){var g=b.getUserById(a.userId),h=null,i="from:'"+g.email+"'";try{h=c.queryToFilters(i)}catch(j){h=null,console.log(j)}if(h&&0!=h.length){var k=c.filtersToQuery(h);d.url(e.getFilterUrlForFilterStr(k))}else d.url("/feed");setTimeout(function(){$(".dummy-text-area").trigger("onCustomClick")},1e3)},n.viewProfileWrapper=function(){n.viewProfile({userId:n.selectedChat.users[0].userId,email:n.selectedChat.users[0].email})},n.viewProfile=function(a,f){var g=b.getUserById(a.userId),h=null,i="from:'"+g.email+"'";try{h=c.queryToFilters(i)}catch(j){h=null,console.log(j)}if(h&&0!=h.length){var k=c.filtersToQuery(h);d.url(e.getFilterUrlForFilterStr(k))}else d.url("/feed")},n.leaveChat=function(b){b&&b.stopPropagation(),j.promptModal("Leave chat?","You won't recieve any new messages in this chat group. Are you sure you want to leave?",function(){a.leaveChat(n.selectedChat.chat)},function(){},"Yes","Cancel",null,!0,!1,!1,"")},n.removeFromGroupChat=function(b,c){c&&c.stopPropagation(),n.selectedChat.chat.thisUser.userId==b.userId?n.leaveChat():a.removeParticipantFromChat(n.selectedChat,b.userId)},n.initRenameGroupChat=function(a){if(!n.isDisabled&&n.isGroupChat){o.find(".settings-group-with-menu").addClass("editing");var b=o.find(".group-chat-rename-input-field");b.focusout(n.onRenameGroupFocusOut),b.val(n.selectedChat.biggerChatTitle),b.focus(),b.select()}},n.onRenameGroupFocusOut=function(a){},n.cancelRenameGroupChat=function(a){a&&a.stopPropagation&&a.stopPropagation(),o.find(".settings-group-with-menu").removeClass("editing")},n.onChatTitleKeyUp=function(a){n.isAdminMode||(27==a.which?n.cancelRenameGroupChat(a):13==a.which&&n.renameGroupChat(a))},n.renameGroupChat=function(b){b.stopPropagation();var c=o.find(".group-chat-rename-input-field");c.unbind("focusout");var d=c.val().trim();d&&d.length&&n.selectedChat.biggerChatTitle!=d&&(a.updateChatTitle(n.selectedChat,d),y(l.UPDATE_GROUP_CHAT_NAME)),o.find(".settings-group-with-menu").removeClass("editing")},n.onEmojiSelected=function(a){var b=o.find(".group-chat-rename-input-field");b.val(b.val()+a)},n.sayHello=function(){alert("I am saying hello.")},n.updateGroupPhoto=function(){var a=o.find("#groupPictureInput");a.on("change",z),f.fireEvent(a[0],"click")},n.toggleAllChatMembers=function(){B>n.chatMembersDisplayCount?(n.chatMembersDisplayCount=B,n.showAllMembersText="Show Less"):(n.chatMembersDisplayCount=C,n.showAllMembersText="Show All ("+B+")"),x()},n.invitePeopleInChat=function(){var a=i.defer(),b=[],c="chat/fullviewclient/templates/AddPeopleInChatModal.tpl.html",d="addPeopleInChatModalCtrl",e={contacts:b,selectedChatItem:n.selectedChat},f={data:function(){return e}},g="add-people-in-chat-modal";return j.customModal(c,d,f,g,!0).result.then(function(a){},function(){a.resolve()}),a.promise},n.$on("$destroy",function(){a.off("SelectedItemChange",u),a.off(k.ADMIN_MODE_CHANGE,v),o.find(".emoji-popup-btn").off("setFocusOnHideEmojiPopover",A),null!=n.selectedChat&&n.selectedChat.removeListener("UPDATE",w)}),t()},controller:["$scope","$element",function(a,b){a.$on("$destroy",function(){a.chatOptions&&(a.chatOptions=null),a.groupChatMemberOptions&&(a.groupChatMemberOptions=null)}),a.chatOptions={type:"noIcon"},a.chatOptions.align="right",a.chatOptions.containerClass="dropdownLinkContainer"}]}}]),b.module("convoApp").directive("cnvChatUserImages",["ChatsViewDataManager",function(a){return{restrict:"E",priority:0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatUserImages.tpl.html",link:function(a,b,c){},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvChatsListContainer",["ChatsViewDataManager","userInfo","Contacts","ChatConstants","ChatViewsManager","popoverUtils","mixpanelService","config","accountInfo",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatsListContainer.tpl.html",link:function(i,j,k){function l(){}function m(){}function n(){S&&S.length&&S.removeClass("chat-item-suggested")}function o(){U=0,n()}function p(){i.searchInProgress||(i.searchInProgress=!0,i.displayedItemsCount=d.CHATS_LIST_PAGE_SIZE,R=i.selectedItem,i.selectedItem=null,z())}function q(){i.searchInProgress&&(i.searchInProgress=!1,i.displayedItemsCount=d.CHATS_LIST_PAGE_SIZE,null==i.selectedItem&&(i.selectedItem=R),R=null,z(),o())}function r(){i.$broadcast(d.RESET_SEARCH_CONTROL)}function s(){i.listItems=a.getListItems(),i.loadingItems&&(i.loadingItems=!1,i.displayedItemsCount<i.listItems.length&&(i.displayedItemsCount=Math.min(i.displayedItemsCount+d.CHATS_LIST_PAGE_SIZE,i.listItems.length)),a.canLoadMoreItems()||B()),i.showInviteTeammatesLink&&i.displayedItemsCount!=i.listItems.length&&(i.displayedItemsCount=i.listItems.length),x(),i.searchInProgress&&(t(),T=setTimeout(function(){var a=!0;F(a)},100))}function t(){T&&(clearTimeout(T),T=null)}function u(){i.listItems=a.getListItems(),i.listItems.length<d.CHATS_LIST_PAGE_SIZE&&(i.loadingItems=!0),x()}function v(b){var c=b.item;i.selectedItem!=c&&(i.selectedItem=c,a.isNewChatData(c)&&(i.newChatData=c),x())}function w(a){i.newChatData=null,x()}function x(){P&&(clearTimeout(P),P=null),P=setTimeout(function(){i.$broadcast("render"),P=null},5)}function y(){setTimeout(function(){Q.scrollTop(Q[0].scrollHeight)},1)}function z(){setTimeout(function(){Q.scrollTop(0)},1)}function A(){i.loadingItems||(i.displayedItemsCount<i.listItems.length?(i.displayedItemsCount<i.listItems.length-d.CHATS_LIST_PAGE_SIZE?i.displayedItemsCount+=d.CHATS_LIST_PAGE_SIZE:i.displayedItemsCount=i.listItems.length,x()):a.canLoadMoreItems()?(i.loadingItems=!0,x(),y(),a.loadMoreItems()):B())}function B(){i.searchInProgress||i.showInviteTeammatesLink||b.isGuestUser()||(i.showInviteTeammatesLink=!0,x())}function C(){var a=h.IS_NATIVE?"Desktop":"Web";return a+" Big Chat"}function D(b){i.selectedItem!=b&&(i.selectedItem=b,i.searchInProgress?(r(),setTimeout(function(){a.setSelectedItemFromSearch(b)},250),g.trackEvent(g.SEARCH_FOR_CHATS,{From:"Chats List",Via:C()})):a.setSelectedItem(b),x(),g.trackEvent(g.TAP_ON_CHAT))}function E(){if(S&&S.length){var a=S[0],b=Q[0],c=b.scrollTop,d=c+b.clientHeight,e=a.offsetTop-b.offsetTop,f=0;if(c>e?f=e-c:e+S.height()>d&&(f=e+S.height()-d+50),0!=f){var g=b.scrollTop+f;Q.animate({scrollTop:g},{duration:10})}}}function F(a){var b,c=Q.find(".chats-list-item");U<c.length&&(n(),b=$(c[U]),b.addClass("chat-item-suggested"),S=b,a||E())}function G(){var a=20;return i.newChatData&&(a+=65),a}function H(a,b){a&&a!=i.selectedItem&&0==b&&a.chat&&a.chat.unreadCount>0&&!i.searchInProgress&&!i.showNewMessagesNotification&&Q.scrollTop()>G()&&I()}function I(){i.showNewMessagesNotification||(i.showNewMessagesNotification=!0,x())}function J(){i.showNewMessagesNotification&&(i.showNewMessagesNotification=!1,x())}function K(a){H(a.item,a.index)}function L(a){H(a.item,a.toIndex)}function M(a){H(a.item,a.index)}function N(a){0==a.unreadCount&&J()}function O(){i.listItems=null,a.isReady()&&s(),a.on("ListItemsUpdate",s),a.on(d.LIST_ITEMS_SEARCH_IN_PROGRESS,u),a.on("SelectedItemChange",v),a.on(d.NEW_CHAT_REMOVED,w),a.on(d.CHAT_ITEM_ADDED,K),a.on(d.CHAT_ITEM_MOVED,L),a.on(d.CHAT_ITEM_UPDATED,M),a.on(d.CHATS_UNREAD_COUNT_CHANGE,N);var b=a.getSelectedItem();b&&v({item:b})}j[0].cnvMemLeakHook=new m,i.cnvFullViewChatListContainer=new l;var P,Q=j.find(".chats-scroll-container");i.displayedItemsCount=0,i.showInviteTeammatesLink=!1,i.selectedItem=null,i.searchInProgress=!1,i.newChatData=null,i.showNewMessagesNotification=!1;var R,S,T,U=0;i.containerScrolled=function(a,b){b&&A(),f.hide(),i.showNewMessagesNotification&&a<G()&&J()},i.onListRenderComplete=function(){var a=e.getChatsListScrollPosition(!0);a&&setTimeout(function(){Q.scrollTop(a)},1)},i.onItemSelected=function(a,b){a.isDefaultPrevented()||D(b)},i.openInviteTeammatesModal=function(){c.initContactsInviteModal({include_off_domain:!1,origin:"Chat_List",invite_via:"Invite_Dialog"})},i.search=function(b){p(),o(),a.search(b)},i.searchCanceled=function(){q(),a.searchCanceled()},i.searchEnded=function(){q(),a.searchEnded()},i.removeNewChat=function(b){b.stopPropagation(),b.stopImmediatePropagation(),a.removeNewChat()},i.inviteContact=function(b,c){b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation(),a.inviteContact(c)},i.moveToPrevSuggestion=_.throttle(function(){console.log("moveToPrevSuggestion"),U>0&&(--U,F())},100),i.moveToNextSuggestion=_.throttle(function(){console.log("moveToNextSuggestion");var a=Math.min(i.listItems?i.listItems.length:0,i.displayedItemsCount)-1;a>U&&(++U,F())},100),i.selectSuggestedItem=function(){var a=U;if(i.newChatData){if(0==U)return void(i.newChatData!=i.selectedItem&&D(i.newChatData));a=U-1}if(i.listItems&&a>=0&&a<i.listItems.length){var b=i.listItems[a];b!=i.selectedItem&&D(b)}},i.newMessagesNotificationClick=function(){J(),z()},i.$on("$destroy",function(){a.off("ListItemsUpdate",s),a.off(d.LIST_ITEMS_SEARCH_IN_PROGRESS,u),a.off("SelectedItemChange",v),a.off(d.NEW_CHAT_REMOVED,w),i.newChatData=null,Q=null,S=null,a.off(d.CHAT_ITEM_ADDED,K),a.off(d.CHAT_ITEM_MOVED,L),a.off(d.CHAT_ITEM_UPDATED,M),a.off(d.CHATS_UNREAD_COUNT_CHANGE,N),t()}),O()},controller:["$scope",function(a){a.loadingItems=!0,a.config=h,a.primaryDomain=i.getPrimaryAccountDomain().user_email_domain}]}}]),b.module("convoApp").directive("cnvChatsListHeader",["UserChatsSettingsManager","ChatConstants","ChatsViewDataManager","appStateInfo","mixpanelService","config",function(a,b,c,d,e,f){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatsListHeader.tpl.html",link:function(g,h,i){function j(){}function k(){}function l(){g.$broadcast("render")}function m(){g.$emit("userSignOutClick")}function n(){"userOnline"==g.presenceStatus?s.label="Available \u2713":s.label="Available","userBusy"==g.presenceStatus?t.label="Busy \u2713":t.label="Busy",a.isNotificationsOn()?u.label="Turn off notifications":u.label="Turn on notifications",a.isSoundsOn()?v.label="Turn off sounds":v.label="Turn on sounds",d.isAppInCompactView()?g.userOptionsCtrl.options=[s,t,{isDivider:!0},u,v,{isDivider:!0},w,{isDivider:!0},x]:g.userOptionsCtrl.options=[s,t,{isDivider:!0},u,v,{isDivider:!0},x]}function o(b){g.presenceStatus=a.getThisUserPresence(),g.thisUser=a.getThisUser(),n(),g.$broadcast("refreshImage"),l()}function p(a){var b=f.IS_NATIVE?"Desktop":"Web",c=b+" Big Chat";e.trackEvent(a,{Via:c})}function q(){g.disableCreateNewChat=c.isAdminMode(),l()}function r(){a.on(b.THIS_USER_PRESENCE_CHANGE,o),a.on(a.ON_USER_SETTINGS_CHANGE,n),c.on(b.ADMIN_MODE_CHANGE,q),d.on("appSwitchedToNormalView",n),d.on("appSwitchedToCompactView",n),o()}h[0].cnvFullViewChatsListHeader=new j,g.cnvFullViewChatsListHeaderElement=new k;var s={icon:"availableBubble",label:"Available \u2713",callback:function(){a.setUserCustomStatus(a.AVAILABLE)}},t={icon:"busyBubble",label:"Busy",callback:function(){a.setUserCustomStatus(a.BUSY)}},u={label:"Turn off notifications",callback:function(){a.toggleChatNotificationSettings(),n()}},v={label:"Turn off sounds",callback:function(){a.toggleChatNotificationSoundSettings(),n()}},w={label:"Create new",callback:function(){c.createNewChat(),n()}},x={label:"Sign Out",callback:m};g.createNewChat=function(){c.createNewChat(),p(e.CLICK_GROUP_CHAT_BUTTON)},g.$on("$destroy",function(){a.off(b.THIS_USER_PRESENCE_CHANGE,o),a.off(a.ON_USER_SETTINGS_CHANGE,n),c.off(b.ADMIN_MODE_CHANGE,q),d.off("appSwitchedToNormalView",n),d.off("appSwitchedToCompactView",n),h[0].cnvFullViewChatsListHeader=null,s=null,t=null,u=null,v=null,w=null,x=null}),r()},controller:["$scope",function(b){b.userOptionsCtrl={},b.userOptionsCtrl.type="noIcon",b.userOptionsCtrl.containerClass="dropdownLinkContainer",b.ddType="",b.presenceStatus=a.getThisUserPresence(),b.disableCreateNewChat=c.isAdminMode(),b.$on("$destroy",function(){b.userOptionsCtrl=null})}]}}]),b.module("convoApp").directive("cnvChatsListItem",["ChatsViewDataManager","chatUsersManager","ChatConstants",function(a,b,c){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/ChatsListItem.tpl.html",link:function(a,b,d){function e(){a.$broadcast("render"),a.$broadcast("render_date")}function f(){a.$broadcast("render_date")}function g(){var b=a.item;b&&b.type==c.GROUP_CHAT?a.participantsList=b.chatMembers.map(function(a){return a.user}):a.participantsList=[]}function h(){g(),e()}a.participantsList=[],a.item.addListener("UPDATE",h),a.item.addListener("UPDATE_TIME",f),a.$on("$destroy",function(){a.item.removeListener("UPDATE",h),a.item.removeListener("UPDATE_TIME",f)}),g()},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvFullViewChatApp",["chatUsersManager","chatManager","ChatsViewDataManager","utils","$rootScope","onboardingService","ChatViewsManager","ChatConstants","$location","appsInfo","chatManager","settingsService","config","desktopNotificationsService","userInfo","appStateInfo","appTitleManager","UserPresenceManager","adminService","bannerService",function(b,c,d,e,f,h,i,j,k,l,c,m,n,o,p,q,r,s,t,u){return{restrict:"AE",priority:0,scope:!1,link:function(s,v,w){function x(){}function y(){}function z(a){A(),s.$broadcast("refreshImage")}function A(){s.$broadcast("render")}function B(a){if(s.chatsLoaded=!0,d.isNewChatData(a.item))ia&&D(),s.showSettingsPanel&&(s.showSettingsPanel=!1,A());else{s.showSettingsPanel!=ja&&(s.showSettingsPanel=ja,A());var b=a.item;ia!=b&&(ia&&D(),ia=b,ia&&C())}aa()}function C(){ia&&ia.addListener(j.CONVERTED_TO_CHAT_ITEM,_)}function D(){ia&&ia.removeListener(j.CONVERTED_TO_CHAT_ITEM,_)}function E(){h.on("cnvOnboarding:feedOnboardingStateChange",F),F()}function F(){0!==$("body > #intercom-container").length&&(h.getFeedOnboardingState()?($("#intercom-io-btn").css("visibility","hidden"),$("body > #intercom-container").hide()):($("#intercom-io-btn").css("visibility","visible"),$("body > #intercom-container").show(),$("#intercom-io-btn").css({bottom:"40px",top:"auto"})))}function G(){var a=v.find(".chats-scroll-container").scrollTop();i.setChatsListScrollPosition(a);var b=v.find(".messages-list").scrollTop();if(i.setMessagesListScrollPosition(b),s.showSettingsPanel){i.setIsSettingPanelOpen(!0);var c=v.find(".chat-settings-container").scrollTop();i.setSettingsPanelScrollPosition(c)}}function H(){I()}function I(){var b=l.getFullViewChatAppUrl("all"),c=b.slice(1);k.url(c),a.location.reload()}function J(){document.body.style.overflowY="hidden",Z(),d.on("SelectedItemChange",B),t.on("refetchFeedOnAdminModeSwitched",H);var a=d.getSelectedItem(),b=s.tab;fa=b.appContCtrl.appCtrl,fa.navigate=ba,fa.activated=ca,fa.deactivated=da,fa.closing=ea,fa.active=!1,fa.initialized=!0,a&&B({item:a}),L(),X()}function K(){a.Audio&&!ga&&(ga=new Audio("assets/sounds/chat_audio."+(n.IS_NATIVE?"wav":"mp3")))}function L(){n.on("clientTypeUpdated",K),K(),c.addListener(g.chatsdk.ChatEvents.MESSAGE_RECEIVED,N),c.addListener(g.chatsdk.ChatEvents.CHAT_UPDATED,P),c.addListener(g.chatsdk.ChatEvents.CHAT_READ,Q),c.addListener(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,U),q.on("appFocus",T),b.addListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,M),b.addListener(g.chatsdk.ChatEvents.CONNECTED,z)}function M(a){var b=a.users,c=a.status;("UPDATED"===c||"CONNECTED"===c)&&o.showUserStatusNotifications(b)}function N(a){var b=a.chat,c=a.message;if(b&&c){var d=c.senderId,e=(b.participants[d],b.thisUser.userId),f=b.participants[e];!b.isMuted&&f.lastSeenMessageSequenceNumber<c._sequenceNumber&&o.showChatNotification(b),m.getChatSettings().then(function(a){a.play_sound_on_notification&&(!m.isBitONOFF(parseInt(a.play_sound_on_notification),m.DESKTOP)||d==p.user_id||b.isMuted||c.skipNotification||c.type!=g.chatsdk.MessageType.MESSAGE||ga&&ga.play())}),O(b,c)}}function O(a,c){if(a&&c){var d=c.senderId,e=a.thisUser.userId,f=a.participants[e];if(c.type===g.chatsdk.MessageType.MESSAGE&&d!=p.user_id&&!a.isMuted&&f.lastSeenMessageSequenceNumber<c._sequenceNumber){var h=b.getUser(d),i=h.getDisplayName()+" says...";if(!q.appHasFocus()||!q.isAppActivated()||q.isAppInShortIdleState()){var j;j=ka.hasOwnProperty(a.chatId)?ka[a.chatId]:ka[a.chatId]={chat:a,titles:[]},-1==j.titles.indexOf(i)&&j.titles.push(i)}r.toggleAppTitleWith(i)}}}function P(a){R(a.chat)}function Q(a){R(a.chat)}function R(a){if(a&&0==a.unreadCount&&ka.hasOwnProperty(a.chatId)){var b=ka[a.chatId];delete ka[a.chatId],r.clearToggleTitle(b.titles)}}function S(){var a,b,c=[];for(b in ka)a=ka[b],a.chat&&0==a.chat.unreadCount&&(c.push(b),r.clearToggleTitle(a.titles));for(b in c)delete ka[b]}function T(){var a;for(var b in ka)a=ka[b],a.titles&&r.clearToggleTitle(a.titles);ka={}}function U(a){S()}function V(a){a&&d.selectChatItemFromChatId(a.chatId)}function W(a){a&&d.startChatWithUser(a)}function X(){o.on("CHAT_NOTIFICATION_CLICKED",V),o.on("USER_STATUS_NOTIFICATION_CLICKED",W)}function Y(){o.off("CHAT_NOTIFICATION_CLICKED",V),o.off("USER_STATUS_NOTIFICATION_CLICKED",W)}function Z(){var a=s.tab.resourceLink,b=a.resourcePath.hierarchy[0].uid,c=a.view;c!=j.VIEW_CONTACT_CHAT&&c!=j.VIEW_USER_CHAT&&(c=null),b.length&&ha.chatId!=b&&d.selectChatItemFromChatId(b,c),ha.chatId=b,ha.view=c}function _(){var a=d.getSelectedItem();a&&!d.isNewChatData(a)&&a==ia&&aa(!0)}function aa(a){var b=d.getSelectedItem();if(b){var c,e=null,f=null,g=d.isNewChatData(b);if(g?f="new":b.type===j.CONTACT?(e=j.VIEW_CONTACT_CHAT,f=b.contact.email,c=f):b.type===j.USER?(e=j.VIEW_USER_CHAT,f=b.user.userId,c=b.user.getDisplayName()):b.chat&&(f=b.chat.chatId,c=b.biggerChatTitle),f&&ha.chatId!=f){var h=l.getFullViewChatAppUrl(f,e,c),i=h.slice(1),m=null;c&&c.length&&(m="title="+c,e&&e.length&&(m+="&view="+e)),"new"==ha.chatId||"all"==ha.chatId||a?m&&m.length?k.url(i).hash(m).replace():k.url(i).replace():m&&m.length?k.url(i).hash(m):k.url(i),ha.chatId=f,ha.view=e}}}function ba(a){fa.active=!0,Z()}function ca(){fa.active=!0}function da(){fa.active=!1}function ea(){fa.active=!1}v[0].cnvMemLeakHook=new x,s.cnvMemLeakHook=new y;var fa,ga,ha={chatId:null,view:null};s.isSafariBrowser=e.isSafari(),s.chatsLoaded=!1;var ia,ja=s.showSettingsPanel,ka={};s.showHideSettingsPanel=function(a){s.showSettingsPanel=!s.showSettingsPanel,ja=s.showSettingsPanel,
A()},s.exitAdminMode=function(){var a=t.exitAdminMode();u.showBanner_promise(a,"Exiting Admin Mode",null,"Error exiting admin mode. Please try again.",!1,!1),a.then(function(){I()})},s.$on("$destroy",function(){s.$emit("showCompactChat"),la(),d.off("SelectedItemChange",B),h.off("cnvOnboarding:feedOnboardingStateChange",F),n.off("clientTypeUpdated",K),c.removeListener(g.chatsdk.ChatEvents.MESSAGE_RECEIVED,N),c.removeListener(g.chatsdk.ChatEvents.CHAT_UPDATED,P),c.removeListener(g.chatsdk.ChatEvents.CHAT_READ,Q),c.removeListener(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,U),q.off("appFocus",T),b.removeListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,M),b.removeListener(g.chatsdk.ChatEvents.CONNECTED,z),t.off("refetchFeedOnAdminModeSwitched",H),Y(),D(),ga&&(ga.src="",ga=null),d.searchCanceled(),d.removeNewChat(),T()});var la=f.$on("intercomIO:loaded",E);F(),s.$on("cacheScrollPositions",G),J()},controller:["$scope",function(a){a.$emit("requestFullViewForApp",a.tab),a.$emit("hideCompactChat"),a.showSettingsPanel=i.getIsSettingPanelOpen(!0)}]}}]),b.module("convoApp").directive("cnvMessagesSearchBar",["ChatsViewDataManager","ChatConstants",function(a,b){return{restrict:"E",priority:0,replace:!0,templateUrl:"chat/fullviewclient/templates/MessagesSearchbar.tpl.html",link:function(c,d,e){function f(){setTimeout(function(){c.$broadcast("render")},100)}function g(a){l!=a.item&&(l&&j(),l=a.item,l&&l.searchInfo&&(k(),i()))}function h(){a.on("SelectedItemChange",g);var b=a.getSelectedItem();b&&b.searchInfo&&(l=b,k(),i())}function i(){l&&(l.addListener(b.SEARCH_STARTED,k),l.addListener(b.SEARCH_INITIALIZED,k),l.addListener(b.MATCH_FETCH_COMPLETE,k))}function j(){l&&(l.removeListener(b.SEARCH_STARTED,k),l.removeListener(b.SEARCH_INITIALIZED,k),l.removeListener(b.MATCH_FETCH_COMPLETE,k))}function k(){l&&(c.searchText=l.searchInfo.searchText,c.currentMatchInfo=l.chat.searchInfo.getCurrentMatchIndex()+1+" of "+l.chat.searchInfo.getMatchCount(),f())}var l;c.$on("$destroy",function(){a.off("SelectedItemChange",g),j()}),h()},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvNewChatItem",function(){return{restrict:"E",priority:0,replace:!0,templateUrl:"chat/fullviewclient/templates/NewChatItem.tpl.html",link:function(a,b,c){function d(){a.$broadcast("render")}var e=a.newChatData;e&&e.addListener("UPDATE",d),a.$on("$destroy",function(){e&&(e.removeListener("UPDATE",d),e=null)})},controller:["$scope",function(a){}]}}),b.module("convoApp").directive("cnvNewChatUsersInput",["ChatsViewDataManager","$q","atMentionsListProvider","$filter","datetimeService","utils","NewChatDataManager","userInfo",function(a,b,c,d,e,f,g,h){return{restrict:"E",priority:0,scope:!0,replace:!0,templateUrl:"chat/fullviewclient/templates/NewChatUsersInput.tpl.html",link:function(b,c,d){function e(){b.$broadcast("render"),b.$$phase||b.$digest()}function f(){}b.selectedItem&&b.selectedItem.addListener("UPDATE",e),b.onItemAddedInToField=function(c){"ERROR"===c.type?b.userItems.pop():"GROUP_CHAT"==c.type?(b.userItems.pop(),setTimeout(function(){a.openChatFromServerSuggestion(c.data)},0)):a.addUserByUserIdInNewChat(c.id)},b.onItemRemovedInToField=function(b){a.removeUserByUserIdFromNewChat(b.id)},b.$on("$destroy",function(){b.selectedItem.removeListener("UPDATE",e)}),f()},controller:["$scope",function(d){var e=20;if(d.userItems=[],a.isNewChatData(d.selectedItem)){var f=d.selectedItem.users.map(function(a){return a.userId});d.userItems=c.getPublishableUsersListItemsFromUserIds(f)}d.queryAutoCompleteItemsAvailableLocally=function(a,d){var f=b.defer(),g=[];g=c.queryPublishableUsers(a,d+e);for(var i=g.length,j=0;i>j;++j)if(g[j].id==h.getUserId()){g.splice(j,1);break}return f.resolve(g),f.promise},d.queryAutoCompleteItemsFromServer=function(a,b){var c=d.userItems.map(function(a){return a.id});return g.fetchChatSuggestions(c,a)}}]}}]),b.module("convoApp").directive("cnvRepeatDone",function(){return function(a,b,c){(a.$last||a.fireRenderCompleteOnItem==a.msgItem)&&a.$eval(c.cnvRepeatDone)}}),b.module("convoApp").controller("addPeopleInChatModalCtrl",["$scope","$modalInstance","data","usersGroupsListProvider","Users","Groups","config","mixpanelService","userInfo","ChatsViewDataManager",function(a,b,c,d,e,f,g,h,i,j){var k=a;k.modalTitle="Add People",k.userItems=[],k.selectedChatItem=c.selectedChatItem,k.doneBtnEnabled=!1,k.invite=function(){if(k.userItems.length){for(var a=[],c=0;c<k.userItems.length;++c)a.push(k.userItems[c].data);j.inviteUsersInChat(a,k.selectedChatItem),b.close("done")}},k.dismiss=function(){b.dismiss("cancel")},k.disableDoneBtn=function(){k.doneBtnEnabled&&(k.doneBtnEnabled=!1,k.$$phase||k.$digest())},k.enableDoneBtn=function(){k.doneBtnEnabled||(k.doneBtnEnabled=!0,k.$$phase||k.$digest())}}]),b.module("convoApp").factory("ChatConstants",function(){return{P2P_CHAT:1,GROUP_CHAT:2,USER:3,CONTACT:4,CHATS_LIST_PAGE_SIZE:20,VIDEO_MSG_HANGOUT:101,VIDEO_MSG_APPEAR_IN:102,CONVERTED_TO_CHAT_ITEM:"CONVERTED_TO_CHAT_ITEM",VIEW_USER_CHAT:"user-chat",VIEW_CONTACT_CHAT:"contact-chat",LIST_ITEMS_UPDATE:"ListItemsUpdate",LIST_ITEMS_SEARCH_IN_PROGRESS:"ListItemsSearchInProgress",RESET_SEARCH_CONTROL:"RESET_SEARCH_CONTROL",THIS_USER_PRESENCE_CHANGE:"ThisUserPresenceChange",NEW_CHAT_CREATED:"newChatCreated",NEW_CHAT_REMOVED:"newChatRemoved",SEARCH_STARTED:"searchStarted",SEARCH_ENDED:"searchEnded",SEARCH_INITIALIZED:"searchInitialized",LOADED_MORE_MSGS_IN_SEARCH:"loadedMoreMsgsInSearch",MATCH_FETCH_COMPLETE:"matchFetchComplete",ADMIN_MODE_CHANGE:"adminModeChange",CHAT_ITEM_ADDED:"chatItemAdded",CHAT_ITEM_MOVED:"chatItemMoved",CHAT_ITEM_UPDATED:"chatItemUpdated",CHATS_UNREAD_COUNT_CHANGE:"chatsUnreadCountChange"}}),b.module("convoApp").factory("ChatGorupImageService",["profilePicService","$q","ServerComm","awsService","utils","ChatsViewDataManager",function(a,b,c,d,e,f){function g(a,b,d,e,f){var g={method:"submitThumbnailGenerationRequest",request_id:a,file_name_with_extension:b,file_size:d},i=c.post("chat",g);i.success(function(b,c){h(a,e,f)})}function h(a,b,d){var e=setInterval(function(){if(k[d])return void(k[d]=!1);k[d]=!0;var f={method:"getThumbnailGenerationRequestStatus",request_id:a},g=c.post("chat",f);g.success(function(c,f){k[d]=!1,"SUCCESS"==c.data.status&&(clearInterval(e),i(a,b,d))})},5e3)}function i(a,b,d){var e={method:"updateUserChatIconIfUploaded",request_id:a,chat_id:d},f=c.post("chat",e);f.success(function(a,c){b.resolve(a)})}var j={};j.uploadingImagesForChatsMap={},j.uploadChatGroupPhoto=function(a,c){var h=c.chat.chatId;j.uploadingImagesForChatsMap[h]=!0;var i="req-"+e.generateGuid(),k=a.name.substring(a.name.lastIndexOf(".")+1).toLowerCase(),l=a.type,m=b.defer(),n=i+"-original."+k;return d.uploadFile(a,n,"temp/requests/"+i+"/"+n,l).then(function(b,c){g(i,n,a.size,m,h)}),m.promise.then(function(a){if(a){var b=a.data.chat_icon_image_version;f.updateChatImage(c,{imageVersion:b})}j.uploadingImagesForChatsMap[h]=!1},function(){j.uploadingImagesForChatsMap[h]=!1}),m.promise};var k={};return j}]),b.module("convoApp").factory("ChatMessagesUtils",["datetimeService","chatUsersManager","$filter","utils",function(a,b,c,d){function e(b,c,e,f,g,j){var k=!1,l=d.isTextSingleEmoji(e.messageText);if(b.isSingleEmoji!=l&&(b.isSingleEmoji=l,k=!0),e.fileInfo)k=h(b,e,c)||k;else{b.fileInfo&&(b.fileInfo=null,k=!0);var m=e.messageText.replace(/\n/gi,"<br>");b.messageText!=m&&(b.messageText=m,k=!0)}k=i(b,c,e,f,g,j)||k;var n=a.getTimeFormatHmma(e.getTimestamp());return b.messageTime!=n&&(b.messageTime=n,k=!0),k}function f(a,b,d){a.orignalWidth=+b.fileInfo.width,a.orignalHeight=+b.fileInfo.height,a.type=b.fileInfo.type.toUpperCase(),a.thumbnail_name=b.fileInfo.thumbnailName,a.fileId=b.fileInfo.fileId,a.fileFormat=b.fileInfo.fileFormat,a.fileId&&(a.fileResourceLinkURL=c("getFileResourceLinkUrl")(a.fileId,a.fileFormat,"6","6",d.chatId,b.fileInfo.name,"21"))}function h(a,b,c){var d=!1,e=a.fileInfo;return e?(b.fileInfo.thumbnailName!=e.thumbnail_name||e.fileId!=b.fileInfo.fileId||e.fileFormat!=b.fileInfo.fileFormat||e.orignalWidth!=b.fileInfo.width||e.orignalHeight!=b.fileInfo.height||e.type!=b.fileInfo.type.toUpperCase())&&(d=!0,f(e,b,c)):(d=!0,e={ver:3},f(e,b,c),a.fileInfo=e),d}function i(a,b,c,d,e,f){var h=!1;if(c.senderId==d)a.thisUserMsg||(a.thisUserMsg=!0,h=!0);else if(a.thisUserMsg&&(a.thisUserMsg=!1,h=!0),f&&f.senderId==c.senderId&&f.type==g.chatsdk.MessageType.MESSAGE?a.showUserImg&&(a.showUserImg=!1,a.user=null,h=!0):a.showUserImg||(a.showUserImg=!0,a.user=v(c,b),h=!0),e&&e.senderId==c.senderId||c.senderId==d||b.chatType!=g.chatsdk.ChatType.GROUP)a.userName&&(a.userName=null,a.user=null,h=!0);else{var i=a.user;i||(i=v(c,b),a.user=i);var j="function"==typeof i.getDisplayName?i.getDisplayName():i.name;a.userName!=j&&(a.userName=j,h=!0)}return h}function j(a,c,d,e,f,g){var h;if(d.senderId==e){var i=d.messageText.split(","),j="";j+=d.invitees[i[0]],i[0]==e&&(j="You"),i.length>1&&(j+=" and "+(i.length-1)+" others"),h="You have invited "+j}else{var k=" ";k=b.getUserById(d.senderId)?b.getUserById(d.senderId).getDisplayName():b.getInaccessibleUserById(d.senderId)?b.getInaccessibleUserById(d.senderId).getDisplayName():c.participants[d.senderId].name;var i=d.messageText.split(","),j="";j+=i[0]==e?"You":d.invitees[i[0]],i.length>1&&(j+=" and "+(i.length-1)+" others"),h=k+" has invited "+j}var l=!1;return a.isSystemMessage||(a.isSystemMessage=!0,l=!0),a.messageText!=h&&(a.messageText=h,l=!0),l}function k(a,c,d,e,f,g){var h,i=" ";e==d.senderId?h="You have left this chat.":(i=b.getUserById(d.senderId)?b.getUserById(d.senderId).getDisplayName():b.getInaccessibleUserById(d.senderId)?b.getInaccessibleUserById(d.senderId).getDisplayName():c.participants[d.senderId].name,h=i+" has left this chat.");var j=!1;return a.isSystemMessage||(a.isSystemMessage=!0,j=!0),a.messageText!=h&&(a.messageText=h,j=!0),j}function l(a,c,d,e,f,g){var h=" ",i="named this group chat "+d.messageText;e==d.senderId?i="You "+i:(h=b.getUserById(d.senderId)?b.getUserById(d.senderId).getDisplayName():b.getInaccessibleUserById(d.senderId)?b.getInaccessibleUserById(d.senderId).getDisplayName():c.participants[d.senderId].name,i=h+" "+i);var j=!1;return a.isSystemMessage||(a.isSystemMessage=!0,j=!0),a.messageText!=i&&(a.messageText=i,j=!0),j}function m(a,c,d,e){var f=" ",g=" changed the group photo.";e==d.senderId?g="You"+g:(f=b.getUserById(d.senderId)?b.getUserById(d.senderId).getDisplayName():b.getInaccessibleUserById(d.senderId)?b.getInaccessibleUserById(d.senderId).getDisplayName():c.participants[d.senderId].name,g=f+g);var h=!1;return a.isSystemMessage||(a.isSystemMessage=!0,h=!0),a.messageText!=g&&(a.messageText=g,h=!0),h}function n(a,c,d,e,f,g){var h,i=" ";if(i=e==d.senderId?"You ":b.getUserById(d.senderId)?b.getUserById(d.senderId).getDisplayName():b.getInaccessibleUserById(d.senderId)?b.getInaccessibleUserById(d.senderId).getDisplayName():c.participants[d.senderId].name,"101"==d.isSystemMessage||"102"==d.isSystemMessage||"103"==d.isSystemMessage)try{h=z[d.isSystemMessage],h=h.replace("<user-name>",i);var j=$("<div>").append(d.messageText).find("a"),k=j.attr("href"),l=j.text();h=h+'<a href="'+k+'" data-participants-count="'+_.keys(c.participants).length+'">"'+l+'"</a>'}catch(m){h=d.messageText}else h=d.messageText;var n=!1;return a.isSystemMessage||(a.isSystemMessage=!0,n=!0),a.messageText!=h&&(a.messageText=h,n=!0),n}function o(a,b){if(a==b)return!0;if(!a&&b)return!1;if(a&&!b)return!1;if(a.length!=b.length)return!1;if(a&&b)for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0}function p(a,b,c,d,e){if(c.userId!=b){var f=d[c.userId],g=a.getSequenceNumber();f?f.msgId!=a.messageId&&f.userActualSeqNo<c.lastSeenMessageSequenceNumber&&(e[f.msgId]=!0,f.msgId=a.messageId,f.userActualSeqNo=c.lastSeenMessageSequenceNumber,f.msgSeqNo=g):(f={msgId:a.messageId,userActualSeqNo:c.lastSeenMessageSequenceNumber,msgSeqNo:g},d[c.userId]=f)}}function q(a,b,c,d){var e=c[b.userId];e&&e.msgId==a.messageId&&delete c[b.userId]}function r(a,b,c,d,e){var f=null,g=b.getOtherParticipant(),h=a.getSequenceNumber();return 0!=h&&(h==g.lastSeenMessageSequenceNumber?(p(a,c,g,d,e),f=[g]):h<g.lastSeenMessageSequenceNumber&&(q(a,g,d,e),f=null)),f}function s(a,b,c,d,e){var f=a.getSequenceNumber();if(0==f)return null;var h=[],i=!1;for(var j in b.participants)if(c!=j){var k=b.participants[j];if(k.lastSeenMessageSequenceNumber==f)p(a,b.thisUser.userId,k,d,e),h.push(k);else if(k.lastSeenMessageSequenceNumber>f){i=!1;var l=b.messageForSequenceNumber(k.lastSeenMessageSequenceNumber);if(l&&l.type!=g.chatsdk.MessageType.MESSAGE){for(var m=k.lastSeenMessageSequenceNumber-1;m>=f&&(l=b.messageForSequenceNumber(m),!l||l.type!=g.chatsdk.MessageType.MESSAGE);--m);l&&l.getSequenceNumber()==f?(p(a,b.thisUser.userId,k,d,e),h.push(k)):i=!0}else i=!0;i&&q(a,k,d,e)}}return h.length?(h.sort(function(a,b){return a.userId<b.userId?-1:1}),h):null}function t(a,b,c,d,e){var f=!1,h=null;return h=b.chatType==g.chatsdk.ChatType.P2P?r(a.message,b,c,d,e):s(a.message,b,c,d,e),o(a.seenParticipants,h)||(a.seenParticipants=h,f=!0),f}function u(a){g.chatsdk.EventDispatcher.call(this),this.message=a,this.messageText=null,this.messageTime=null,this.showMessageDate=!1,this.fileInfo=null,this.isSystemMessage=!1,this.user=null,this.userName=null,this.showUserImg=!1,this.thisUserMsg=!1,this.isSingleEmoji=!1,this.seenParticipants=null,this.customClasses=null,this.isCurrentMatch=!1,this.showLoadOldMessages=!1,this.showLoadNewMessages=!1,this.isFailedMessage=!1}function v(a,c){var d=b.getUserById(a.senderId);return d=d?c.participants[a.senderId]:b.getInaccessibleUserById(a.senderId)}function w(a,b,c,d,e){return b?"\n":c?"":d?"":e?"\n":void 0}u.prototype=new g.chatsdk.EventDispatcher,u.prototype.constructor=u,u.prototype.recomputeShowDateAndPadding=function(b,c){var d=!1,e=!1,f=this.message.getTimestamp();if(b){var g=b.getTimestamp();a.isDayDiff(f,g)&&(e=!0),b.senderId!=this.message.senderId&&(d=this.addClassToMessageData("extraTopPadding")),f-g>3e5&&(f-g>36e5?e=!0:d=this.addClassToMessageData("extraTopPadding"))}return e?(this.showMessageDate||(this.showMessageDate=!0,d=!0),d=this.addClassToMessageData("extraTopPadding")||d):this.showMessageDate&&(this.showMessageDate=!1,d=!0),d},u.prototype.addClassToMessageData=function(a){return this.customClasses||(this.customClasses=""),-1==this.customClasses.indexOf(a)?(this.customClasses+=" "+a+" ",!0):!1},u.prototype.dispatchUpdateEvent=function(){this.dispatch("UPDATE",{})},u.prototype.dispatchUpdateTimeEvent=function(){this.dispatch("UPDATE_TIME",{})},u.prototype.recomputeSeenInfo=function(a,b,c){return t(this,a,b,c,{})},u.prototype.recomputeFailedState=function(){var a=!this.message.isFakeMessage&&0==this.message._sequenceNumber&&!this.message.isRetrying;return this.isFailedMessage!=a?(this.isFailedMessage=a,!0):!1},u.prototype.recompute=function(a,b,c,d,f,h){var i=!1;return this.message.type!=g.chatsdk.MessageType.MESSAGE||this.message.isSystemMessage?this.message.type==g.chatsdk.MessageType.INVITE?j(this,a,this.message,b,c,d)&&(i=!0):this.message.type==g.chatsdk.MessageType.LEFT?k(this,a,this.message,b,c,d)&&(i=!0):this.message.type==g.chatsdk.MessageType.CHAT_TITLE_UPDATE?l(this,a,this.message,b,c,d)&&(i=!0):this.message.type==g.chatsdk.MessageType.CHAT_IMAGE_UPDATE?m(this,a,this.message,b)&&(i=!0):this.message.isSystemMessage&&n(this,a,this.message,b,c,d)&&(i=!0):(e(this,a,this.message,b,c,d)&&(i=!0),t(this,a,b,f,h)&&(i=!0),a.searchInfo&&(a.searchInfo.isCurrentMatch(this.message)&&0==this.isCurrentMatch&&(this.isCurrentMatch=!0,i=!0),!c&&this.message.getSequenceNumber()>1||c&&c.getSequenceNumber()<this.message.getSequenceNumber()-1?this.showLoadOldMessages=!0:this.showLoadOldMessages=!1,this.showLoadOldMessages=!1,this.message.getSequenceNumber()>1&&(c?c.getSequenceNumber()<this.message.getSequenceNumber()-1&&(this.showLoadOldMessages=!0):this.showLoadOldMessages=!0),!d&&this.message.getSequenceNumber()<a.lastMessageSequenceNumber?this.showLoadNewMessages=!0:this.showLoadNewMessages=!1)),i=this.recomputeFailedState()||i,i=this.recomputeShowDateAndPadding(c,d)||i};var x=function(a,b,c,d,e,f,g){var h=new u(b);return h.recompute(a,c,d,e,f,g),h},y=function(a,b,c,d,e,f,g){var h,i=[],j={};if(1==b.length)h=x(a,b[0],c,d,e,f,g),i.push(h),j[b[0].messageId]=h;else if(b.length>1){h=x(a,b[0],c,d,b[1],f,g),i.push(h),j[b[0].messageId]=h;var k;for(k=1;k<b.length-1;++k)h=x(a,b[k],c,b[k-1],b[k+1],f,g),i.push(h),j[b[k].messageId]=h;h=x(a,b[k],c,b[k-1],e,f,g),i.push(h),j[b[k].messageId]=h}return{messageItems:i,messageItemsMap:j}},z={101:"<user-name> started a Google Hangouts video call.<br/>\ud83c\udfa5 ",102:"<user-name> started an Appear.in video call.<br/>\ud83c\udfa5 ",103:"<user-name> started a Room video call.<br/>\ud83c\udfa5 "},A=/(<\/div><div>)|(<div>)|(<\/div>)|(<br>)/gi,B=function(a){return a.replace(/<p><\/p>/gi,"<div></div>").replace(A,w).replace(/<p>\s*<\/p>/gi,"").replace(/(?!<\s*[a-z][a-z0-9]*.*\s)(class\s*=\s*"[a-z0-9-\s*]*\")(?=[^<>]*>)/gi,"").replace(/&nbsp;/g," ").trim()};return{createViewDataForMessages:y,createViewDataForMessage:x,cleanInputMessageText:B}}]),b.module("convoApp").factory("ChatViewsManager",function(){var a={};_.extend(a,Backbone.Events);var b=null;return a.getChatsListScrollPosition=function(a){var c=b?b.chatListScrollPosition:0;return c&&a&&(b.chatListScrollPosition=0),c},a.getMessagesListScrollPosition=function(a){var c=b?b.messageListScrollPosition:0;return c&&a&&(b.messageListScrollPosition=0),c},a.getSettingsPanelScrollPosition=function(a){var c=b?b.settingsPanelScrollPosition:0;return c&&a&&(b.settingsPanelScrollPosition=0),c},a.getIsSettingPanelOpen=function(a){var c=b?b.setIsSettingPanelOpen:0;return c&&a&&(b.wasOpen=0),c},a.setChatsListScrollPosition=function(a){b||(b={}),b.chatListScrollPosition=a},a.setMessagesListScrollPosition=function(a){b||(b={}),b.messageListScrollPosition=a},a.setSettingsPanelScrollPosition=function(a){b||(b={}),b.settingsPanelScrollPosition=a},a.setIsSettingPanelOpen=function(a){b||(b={}),b.setIsSettingPanelOpen=a},a}),b.module("convoApp").factory("cnvChatsFilesUploadManager",["UploadService","chatManager",function(a,b){function c(a,c){c&&c.event&&b.onFileDataChanged(c.file)}var d={},e=!1;return d.init=function(){e||(a.on("cnvchange",c),e=!0)},d}]),b.module("convoApp").factory("ChatsSearchDataManager",["chatUsersManager","ChatConstants","chatAdvancedSearchManager","ChatsUtils","chatManager",function(a,b,c,d,e){function f(){q=null,r=[],s=[],t=[],h()}function h(){z=0,p=[],v={},u=[],w=[],x=[],y={},c.canFetchMoreChats=!0,c.clearData()}function i(c){if(q!=c){var f=!1;h(),q=c,r=a.getFilteredUserList(q,!1,30,!0),r&&r.length>b.CHATS_LIST_PAGE_SIZE||(t=e.getChatsSearch(q)||[],f=!0,A(r,q,z)),s=r.map(function(a){return d.createUserView(a)});var g;t.forEach(function(a){g=d.createChatView(a),u.push(g),v[a.chatId]=g}),u.length&&(u[0].banner="Group Chats",m=u[0]),p=s.concat(u),f?l.trigger(b.LIST_ITEMS_SEARCH_IN_PROGRESS):l.trigger(b.LIST_ITEMS_UPDATE)}}function j(f){var h,i,j=!1,k=!1;if(u.length&&(h=u[0]),f.forEach(function(a){if(a.chatType!==g.chatsdk.ChatType.GROUP||a.message_match)a.message_match&&(w.push(a),k=!0);else if(v.hasOwnProperty(a.chatId));else{var b=e.getChat(a.chatId);b?t.push(b):t.push(a),j=!0}}),j){t.sort(function(a,b){return a.lastMessageTimestamp<b.lastMessageTimestamp?1:a.lastMessageTimestamp>b.lastMessageTimestamp?-1:0}),u=[];var r=v;v={},t.forEach(function(a){i=r.hasOwnProperty(a.chatId)?r[a.chatId]:d.createChatView(a),u.push(i),v[a.chatId]=i}),u.length&&(h&&h!=u[0]&&(h.banner=null,h.dispatchUpdateEvent()),u[0].banner="Group Chats",m=u[0])}if(k){h=null,x&&(h=x[0]),x=[];var z=y;y={},w.forEach(function(a){i=z.hasOwnProperty(a.chatId)?z[a.chatId]:d.createChatView(a),x.push(i),y[a.chatId]=i}),x.length&&(h&&h!=x[0]&&(h.banner=null,h.dispatchUpdateEvent()),x[0].banner="Messages",n=x[0])}var A=[];if(!c.canFetchMoreChats){var B=a.getFilteredContactList(q);B&&B.length&&(A=B.map(function(a){return d.createContactView(a)}),o&&o!=A[0]&&(o.banner=null,o.dispatchUpdateEvent()),A[0].banner="People you may know",o=A[0])}p=s.concat(u).concat(x).concat(A),l.trigger(b.LIST_ITEMS_UPDATE)}function k(){A(r,q,z)}var l={};_.extend(l,Backbone.Events);var m,n,o,p=[],q=null,r=[],s=[],t=[],u=[],v={},w=[],x=[],y={},z=0,A=_.debounce(function(a,b,d){c.fetchChats(a,b,d).then(function(a){b&&b==a.searchTerm&&a.chats&&(z+=a.chats.length,j(a.chats))})},100);return l.isInSearch=function(){return null!=q},l.search=function(a){i(a)},l.searchEnded=function(){l.isInSearch()&&(f(),m&&(m.banner=null,m.dispatchUpdateEvent()),n&&(n.banner=null,n.dispatchUpdateEvent()))},l.canLoadMoreItems=function(){return c.canFetchMoreChats},l.loadMoreItems=function(){k()},l.getListItems=function(){return p},l}]),b.module("convoApp").factory("ChatsUtils",["chatUsersManager","chatManager","ChatConstants","$filter","utils",function(a,b,c,d,e){function f(a){g.chatsdk.EventDispatcher.call(this),this.user=a,this.presenceStatus=l(a)}function h(a){g.chatsdk.EventDispatcher.call(this),this.isNewChat=!0,this.title="New Chat",this.users=a?a:[],this.chatViewData=null,this.usersHash=null,this.isGroupChat=!1,this.explicitlyCreatedLocalChat=!1,this.matchFound=!1,this.inputMessageText=null,this.thisUserLeft=!1,a&&this.recompute()}function i(a,b){g.chatsdk.EventDispatcher.call(this),this.biggerChatTitle="",this.isGroupChat=!1,this.isChat=!0,this.chatMembers=[],this.chat=null,this.type=b,this.user=null,this.contact=null,this.users=[],this.presenceStatus=null,this.unDisplayedUsersCount=0,this.usersToDisplay=0,this.itemId=null,this.renderId=null,this.render_prefix=0,this.type==c.P2P_CHAT||this.type==c.GROUP_CHAT?this.chat=a:this.type==c.USER?this.user=a:this.type==c.CONTACT&&(this.contact=a),this.messageItems=null,this.messageItemsMap=null,this.messagesSeenMap={},this.thisUserLeft=!1,this.banner=null,this.chatFiles=null,this.chatNoteItem=null,this.chatIconUrl=null,this.classes=null,this.searchInfo=null,this.invitedChatMessage=null,this.inputMessageText=null,this.disabled=!1,this.recompute(),this.bumpRenderId()}function j(a,b,c){var d=!1,e=_.find(b,function(b){return b.user==a});return e?e.updatePresence():(e=new f(a),d=!0,b.push(e)),delete c[a.userId],d}function k(a,b){return b.biggerChatTitle!=a?(b.biggerChatTitle=a,!0):!1}function l(a){var b=null;return 2!=a.getDevice()?(1==a.presenceStatus?b="userOnline":2==a.presenceStatus?b="userBusy":3==a.presenceStatus&&(b="userIdle"),4==a.presenceStatus&&(b=0==a.getHasMobile()?"userOffline":"userOfflineWithMobile")):b=4==a.presenceStatus?"userOfflineWithMobile":"userOnlineOnMobile",b}function m(a){return new h(a)}function n(a){return a&&a.hasOwnProperty("isNewChat")&&a.isNewChat}return f.prototype=new g.chatsdk.EventDispatcher,f.prototype.constructor=f,f.prototype.updatePresence=function(){var a=l(this.user);return this.presenceStatus!=a?(this.presenceStatus=a,this.dispatchUpdateEvent(),!0):!1},f.prototype.dispatchUpdateEvent=function(){this.dispatch("UPDATE",{})},h.prototype=new g.chatsdk.EventDispatcher,h.prototype.constructor=h,h.prototype.recompute=function(){this.unDisplayedUsersCount=0,this.usersToDisplay=0,this.users.length>4?(this.unDisplayedUsersCount=this.users.length-3,this.usersToDisplay=3):this.usersToDisplay=this.users.length;var a="Chat",b=this.users.length;if(b){var c=this.users.map(function(a){return a.getDisplayName()});a+=" with "+c.join(", ")}else a="New Chat";this.title=a},h.prototype.addUser=function(a){var b=this.users.indexOf(a);if(-1==b){this.users.push(a);var c=this.users.map(function(a){return a.userId});return this.usersHash=g.chatsdk.ChatUtils.generateUniqueKeyFromIds(c),this.recompute(),this.isGroupChat=this.users.length>1,!0}return!1},h.prototype.removeUser=function(a){var b=this.users.indexOf(a);if(-1!=b){this.users.splice(b,1);var c=this.users.map(function(a){return a.userId});return this.usersHash=g.chatsdk.ChatUtils.generateUniqueKeyFromIds(c),this.recompute(),!0}return!1},h.prototype.updateChatViewData=function(a,b){this.chatViewData!=a&&(this.chatViewData=a,this.matchFound=b,this.thisUserLeft=a?a.thisUserLeft:!1,this.dispatchChatChangeEvent())},h.prototype.dispatchUpdateEvent=function(){this.dispatch("UPDATE",{})},h.prototype.dispatchChatChangeEvent=function(){this.dispatch("CHAT_CHANGED",{})},i.prototype=new g.chatsdk.EventDispatcher,i.prototype.constructor=i,i.prototype.convertToChatView=function(a){this.type=a.chatType==g.chatsdk.ChatType.P2P?c.P2P_CHAT:c.GROUP_CHAT,this.user=null,this.chat=a,this.recompute(),this.dispatch(c.CONVERTED_TO_CHAT_ITEM)},i.prototype.recompute=function(){var a;return this.isGroupChat=this.isChat=!1,this.type==c.P2P_CHAT||this.type==c.GROUP_CHAT?(this.isChat=!0,this.isGroupChat=this.type==c.GROUP_CHAT,a=this.recomputeChatView()):this.type==c.USER?a=this.recomputeUserView():this.type==c.CONTACT&&(a=this.recomputeContactView()),a&&this.dispatchUpdateEvent(),a},i.prototype.setChatNoteItem=function(a){this.chatNoteItem=a;var b;a&&a.item_id&&(b=a.files["files_"+a.item_id]),this.setChatFiles(b)},i.prototype.setChatFiles=function(a){this.chatFiles=a,this.dispatch("CHAT_FILES_UPDATE",{})},i.prototype.initalizeMessagesData=function(){this.messageItems=[],this.messageItemsMap={}},i.prototype.updateChatMembersPresenceIfNeeded=function(a){this.chatMembers.map(function(b){a[b.user.userId]&&b.updatePresence()})},i.prototype.recomputeChatView=function(){var b,c,e=!1,f=this.chat,h=[];if(this.itemId=f.chatId,f.chatType==g.chatsdk.ChatType.P2P){var i=f.getOtherParticipant(f.thisUser.userId);b=a.getUserById(i.userId);var m=!1;b||(b=a.getInaccessibleUserById(i.userId),(f.lastMessageSequenceNumber>0||f.isFetchedChat)&&(m=!0)),this.disabled!=m&&(this.disabled=m,e=!0),h.push(b),c=l(b),this.presenceStatus!=c&&(this.presenceStatus=c,e=!0),k(b.getDisplayName(),this),(f.isInviteChat||b.isInvitedUser&&b.isInvitedUser())&&(this.invitedChatMessage=b.email+" hasn't joined yet, but you can still start a chat. Your messages will be delivered via email.")}else{var n={},o=!1;this.chatMembers.forEach(function(a){n[a.user.userId]=1}),k(this.chat.getOriginalTitle(!0)||"",this);var p,q=null==this.biggerChatTitle||0==this.biggerChatTitle.length,r=0,s=f.participants,t=Object.keys(s).length,u=a.getThisUser();for(var v in s)if(p=s[v],(p.status==g.chatsdk.ParticipantStatus.JOINED||"ACTIVE"==p.status)&&(b=a.getUserById(v),b||(b=a.getInaccessibleUserById(v)),b)){j(b,this.chatMembers,n)&&(o=!0),b.displayName=b.getDisplayName(),h.push(b);var w=b.firstName||b.displayName;4>r&&q&&b.userId!=u.userId&&(2>r||5>t?(this.biggerChatTitle.length>0&&(this.biggerChatTitle+=", "),this.biggerChatTitle+=w,r++):(this.biggerChatTitle+=", + "+(t-3)+" more",r+=2))}0==h.length&&(h.push(u),o=o||j(u,this.chatMembers,n));for(var x,y=this.chatMembers.length,z=y-1;z>=0;--z)x=this.chatMembers[z],n[x.user.userId]&&(this.chatMembers.splice(z,1),o=!0);e=e||o}var A=!1;if(h.length!=this.users.length)A=!0;else for(var B=0;B<h.length;++B)if(h[B]!=this.users[B]){A=!0;break}A&&(this.unDisplayedUsersCount=0,this.usersToDisplay=0,h.length>4?(this.unDisplayedUsersCount=h.length-3,this.usersToDisplay=3,this.users=h.slice(0,3)):this.users=h,e=!0);var C=f.participants[f.thisUser.userId],D=C&&C.status==g.chatsdk.ParticipantStatus.LEFT;if(this.thisUserLeft!=D&&(this.thisUserLeft=D,e=!0),f.composingParticipants&&f.composingParticipants.length&&!D){for(var E,F=[],G=f.composingParticipants.length>3?3:f.composingParticipants.length,H=f.composingParticipants.length-G,I=H+G,B=H;I>B;B++)E=f.composingParticipants[B].userId,a.getUserById(E)?F.push(a.getUserById(E)):a.getInaccessibleUserById(E)&&F.push(a.getInaccessibleUserById(E));if(F.length)if(this.composingUsers){if(F.length!=this.composingUsers.length)for(var B=0;B<F.length;++B)if(F[B]!=this.composingUsers[B]){this.composingUsers=F,e=!0;break}}else e=!0,this.composingUsers=F;else this.composingUsers&&(this.composingUsers=null,e=!0)}else this.composingUsers&&(this.composingUsers=null,e=!0);if(f.chatType==g.chatsdk.ChatType.GROUP){var J=f.getIconVersion(),K=null;J&&"0"!=J&&-1!=J&&(K=d("getChatImageThumbnailPath")(f.chatId,"96x96",f.getIconVersion())),this.chatIconUrl!=K&&(this.chatIconUrl=K,e=!0)}return e},i.prototype.recomputeUserView=function(){var a=!1,b=l(this.user);return this.presenceStatus!=b&&(this.presenceStatus=b,a=!0),a=k(this.user.getDisplayName(),this)||a,this.user.isInvitedUser&&this.user.isInvitedUser()&&(this.invitedChatMessage=this.user.getDisplayName()+" hasn't joined yet, but you can still start a chat. Your messages will be delivered via email."),a},i.prototype.recomputeContactView=function(){var a=!1;return this.classes||(this.classes="user contact-as-user "+e.getRandomSmiley()+" as-bg ",a=!0),a=k(this.contact.getDisplayName(),this)||a,this.invitedChatMessage=this.biggerChatTitle+" hasn't joined yet, but you can still start a chat. Your messages will be delivered via email.",a},i.prototype.bumpRenderId=function(){++this.render_prefix,this.renderId=this.render_prefix+"_"+this.itemId},i.prototype.dispatchUpdateEvent=function(){this.dispatch("UPDATE",{})},i.prototype.dispatchUpdateTimeEvent=function(){this.dispatch("UPDATE_TIME",{})},i.prototype.dispatchMsgItemsUpdateEvent=function(){this.dispatch("MSG_ITEMS_UPDATE",{})},{createChatView:function(a){var b=a.chatType==g.chatsdk.ChatType.P2P?c.P2P_CHAT:c.GROUP_CHAT;return new i(a,b)},createUserView:function(a){return new i(a,c.USER)},createContactView:function(a){return new i(a,c.CONTACT)},getPresenceValue:l,createNewChatData:m,isNewChatData:n,isUserParticipantOfChat:function(a,b){if(a&&b){var c=b.participants[a];return c&&c.status==g.chatsdk.ParticipantStatus.JOINED}return!1}}}]),b.module("convoApp").factory("ChatsViewDataManager",["chatUsersManager","chatManager","ChatsUtils","ChatMessagesUtils","ChatConstants","mixpanelService","appStateInfo","appsInfo","$filter","utils","ChatsSearchDataManager","bannerService","Users","chatAdvancedSearchManager","Feed","userInfo","ServerComm",function(a,b,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s){function t(){Ua=[],ab={},eb={},fb={},Ya=!1,Za=!1}function u(a,b){var c=ab[a];return!c&&b&&(c=bb[a]),c}function v(a){return bb[a]}function w(a,b){ab[b]=a}function x(a,b){bb[b]=a}function y(a){delete ab[a]}function z(a){delete bb[a]}function A(){if(Ya||Za){var c,e,f,g,h=b.getChats().length,i=Ua.length-h;if(i>0&&Ua.splice(h,i),Ya){var j,k={},l=eb,m=b.getUsersWithoutP2PChat(a.getUsers());for(e=m.length,c=0;e>c;++c)f=m[c],j=v(f.userId),j?z(f.userId):j=u(f.userId),j||(j=d.createUserView(f)),w(j,f.userId),k[f.userId]=!0,Ua.push(j),delete l[f.userId];for(var n in l)y(n),z(n);eb=k}if(Za){var o,p={},q=fb,r=a.getContacts();for(e=r.length,c=0;e>c;++c)g=r[c],o=v(g.email),o?z(g.email):o=u(g.email),o||(o=d.createContactView(g)),w(o,g.email),p[g.email]=!0,Ua.push(o),delete q[g.email],0==c?o.banner="People you may know":o.banner="";for(var s in q)y(s),z(s);fb=p}U()}}function B(){var c=0;if(!Ya){eb={};for(var e,f,g=b.getUsersWithoutP2PChat(a.getUsers()),h=g.length,i=0;h>i;++i)f=g[i],e=v(f.userId),e?z(f.userId):e=d.createUserView(f),w(e,f.userId),eb[f.userId]=!0,Ua.push(e);c=h,Ya=!0}return c}function C(){var b=0;if(!Za){var c,e=a.getContacts();fb={};for(var f,g=e.length,h=0;g>h;++h)f=e[h],c=v(f.email),c?z(f.email):c=d.createContactView(f),w(c,f.email),fb[f.email]=!0,Ua.push(c),0==h?c.banner="People you may know":c.banner="";b=g,Za=!0}return b}function D(a){Sa?(Sa=!1,W()):A()}function E(a){Sa||A()}function F(){if(a.isConnected()){var b=!0;W(b)}else Sa=!0}function G(){a.isConnected()?0===Ua.length&&W():Sa=!0}function H(a){var b,c=a.index,e=a.chat;if(e.chatType==g.chatsdk.ChatType.P2P){var h=e.getOtherParticipant(e.thisUser.userId);if(h&&(b=u(h.userId))){y(h.userId);var i=Ua.indexOf(b);-1!=i&&Ua.splice(i,1),b.convertToChatView(e)}}b?-1==Ua.indexOf(b)&&Ua.splice(c,0,b):(b=v(e.chatId),b||(b=d.createChatView(e)),Ua.splice(c,0,b)),w(b,e.chatId),z(e.chatId),U(),_a.trigger(f.CHAT_ITEM_ADDED,{index:c,item:b})}function I(a){var b=a.fromIndex,c=a.toIndex;a.chat;if(b!=c&&b>=0&&b<Ua.length&&c>=0&&c<Ua.length){var d=Ua[b];Ua.splice(b,1),Ua.splice(c,0,d),U(),_a.trigger(f.CHAT_ITEM_MOVED,{toIndex:c,item:d
})}}function J(a){if(Ra){var b,c,e=a.chats;if(e&&e.length){for(var f=0;f<e.length;f++)b=e[f],c=u(b.chatId),c?c.recompute():(c=v(b.chatId),c?z(b.chatId):c=d.createChatView(b),Ua.push(c),w(c,b.chatId));T()}}}function K(a){var b=a.index,c=a.chat,d=u(c.chatId,!0);if(d){var e=d.recompute();e||d.dispatchUpdateEvent()}_a.trigger(f.CHAT_ITEM_UPDATED,{index:b,item:d})}function L(a){var b=a.chat,c=u(b.chatId,!0);if(c){var d=c.recompute();d||c.dispatchUpdateEvent();var e=Ua.indexOf(c);_a.trigger(f.CHAT_ITEM_UPDATED,{index:e,item:c})}}function M(a){var b=a.chat,c=u(b.chatId,!0);if(c){var d=c.recompute();d||c.dispatchUpdateEvent()}}function N(a){var b=a.chat,c=u(b.chatId,!0);if(c){var d=c.recompute();d||c.dispatchUpdateEvent()}}function O(a){var b=a.chat,c=u(b.chatId,!0);c&&c.dispatchUpdateEvent()}function P(a){if(a&&(a.type==f.GROUP_CHAT||a.type==f.P2P_CHAT)){var b=a.chat;s.getx("notes?item_id="+b.chatId).then(function(b){if(200==b.status){var c=b.data.data;a.setChatNoteItem(c)}})}}function Q(a){var b=a.chat,c=u(b.chatId,!0);if(c&&c.messagesSeenMap){c.dispatchUpdateEvent();var d,e,f,h={},i=b.thisUser.userId;for(var j in b.participants)if(d=b.participants[j],f=!1,d.userId!=i&&d.lastSeenMessageSequenceNumber>0&&(e=c.messagesSeenMap[d.userId],e?e.userActualSeqNo!=d.lastSeenMessageSequenceNumber&&(h[e.msgId]=1,f=!0):f=!0,f)){var k=b.messageForSequenceNumber(d.lastSeenMessageSequenceNumber);k&&k.type!=g.chatsdk.MessageType.MESSAGE&&(k=b.getUserMessageBeforeGivenMessage(k)),k&&(h[k.messageId]=1)}ja(c,h)}}function R(a,b){if(a)if(a.type==f.P2P_CHAT){var c=a.chat.getOtherParticipant(a.chat.thisUser.userId);c&&b.hasOwnProperty(c.userId)&&a.recompute()}else a.type==f.USER?a.user&&b.hasOwnProperty(a.user.userId)&&a.recompute():a.type==f.GROUP_CHAT&&a.updateChatMembersPresenceIfNeeded(b)}function S(a){var b=a.users,c={};b.forEach(function(a){c[a.userId]=!0}),Ua.forEach(function(a){R(a,c)});for(var d in bb)R(v(d),c)}function T(){Ta&&(Ta=!1,U())}function U(){_a.trigger("ListItemsUpdate")}function V(){Ua.length<f.CHATS_LIST_PAGE_SIZE&&B(),Ua.length<f.CHATS_LIST_PAGE_SIZE&&C()}function W(a){var c,e,f=b.getChats();t();for(var g=0;g<f.length;g++)c=f[g],e=d.createChatView(c),Ua.push(e),w(e,c.chatId),z(c.chatId);if(V(),Ra=!0,U(),Xa){var h=a;gb(Xa.chatId,Xa.view,h)}else Va||(Va=Ua[0])}function X(a){if(Wa!=a&&(Wa&&b.chatLostFocus(Wa),Wa=a),Wa){var c=u(Wa.chatId,!0);c&&c.searchInfo||b.chatOpened(Wa),b.chatGainedFocus(Wa)}}function Y(a){Wa&&Wa==a&&(b.chatLostFocus(Wa),Wa=null)}function Z(a,c){c?b.muteChat(a,!0):b.unMuteChat(a,!0)}function $(a){b.leaveChat(a)}function aa(a,c){b.removeParticipantFromChat(a.chat,c)}function ba(a){a.chat.unreadCount>0&&b.chatRead(a.chat)}function ca(a){var b,c,d=[];if(_a.isNewChatData(a)&&(a=a.chatViewData),a&&(a.type==f.P2P_CHAT||a.type==f.GROUP_CHAT)){b=a.chat;var g=u(b.chatId,!0);if(g.searchInfo){var h=g.searchInfo;h.messageItems&&h.messageItems.length==b.searchInfo.messages.length||(h.messagesSeenMap||(h.messagesSeenMap={}),c=e.createViewDataForMessages(b,b.searchInfo.messages,b.thisUser.userId,null,null,h.messagesSeenMap,{}),h.messageItems=c.messageItems,h.messageItemsMap=c.messageItemsMap),d=h.messageItems}else g.messageItems&&g.messageItems.length==b.messages.length||(c=e.createViewDataForMessages(b,b.messages,b.thisUser.userId,null,null,g.messagesSeenMap,{}),g.messageItems=c.messageItems,g.messageItemsMap=c.messageItemsMap),d=g.messageItems}return d}function da(a){var c=a.chat,d=a.message,f=u(c.chatId,!0);if(f){if(f.messageItems){var h,i,j=f.messageItems,k=f.messageItemsMap,l={},m=j.length;m&&(h=j[m-1],i=m>1?j[m-2].message:null,h.recompute(c,c.thisUser.userId,i,d,f.messagesSeenMap,l)&&h.dispatchUpdateEvent());var n=e.createViewDataForMessage(c,d,c.thisUser.userId,h?h.message:null,null,f.messagesSeenMap,l);k[d.messageId]=n,j.push(n),ja(f,l),d.senderId===c.thisUser.userId&&b.chatRead(c),_a.trigger("MessageReceivedInChat",{chat:c,message:d})}if(d.type==g.chatsdk.MessageType.INVITE||d.type==g.chatsdk.MessageType.LEFT||d.type==g.chatsdk.MessageType.PARTICIPANT_REMOVED){var o=f.recompute();o||f.dispatchUpdateEvent()}(d.fileInfo||d.type==g.chatsdk.MessageType.INVITE)&&P(f)}}function ea(a,b,c){var d=b.messageItems,e=d.length,f=d.indexOf(a);if(-1!=f){var g=f>0?d[f-1].message:null,h=e-1>f?d[f+1].message:null;a.recompute(b.chat,b.chat.thisUser.userId,g,h,b.messagesSeenMap,c)}}function fa(a){var b=a.chat,c=a.message,d=u(b.chatId,!0);if(d&&(!d.messageItemsMap||!d.messageItemsMap.hasOwnProperty(c.messageId))){var f=d.messageItems,h=d.messageItemsMap;if(!f){if(Va!=d)return;d.initalizeMessagesData(),f=d.messageItems,h=d.messageItemsMap}var i,j,k=f.length,l={};k&&(i=f[k-1],j=k>1?f[k-2].message:null,i.recompute(b,b.thisUser.userId,j,c,d.messagesSeenMap,l)&&i.dispatchUpdateEvent());var m=e.createViewDataForMessage(b,c,b.thisUser.userId,i?i.message:null,null,d.messagesSeenMap,l);h[c.messageId]=m,f.push(m),ja(d,l),c.type==g.chatsdk.MessageType.LEFT&&(d.recompute(),_a.trigger("ThisUserParticipantStatusChange",{chat:b})),_a.trigger("MessageSentInChat",{chat:b})}}function ga(a,c,d,e){c.isInviteChat&&ta(c,a),ha(c),c.isInviteChat?b.sendFakeMessage(a,c):b.sendMessage(a,c,null,null,d,e)}function ha(a){if(_a.isNewChatData(Va)&&Va.chatViewData&&Va.chatViewData.chat==a){var b=u(a.chatId,!0);b||(b=d.createChatView(a),b.initalizeMessagesData(),x(b,a.chatId)),delete db[a.chatId],_a.setSelectedItem(b),_a.removeNewChat()}}function ia(a){var b,c,d=a.chat,e=a.message,f=u(d.chatId,!0);if(f&&f.messageItems){if(b=f.messageItemsMap,c=b[e.messageId]){if(c.isFailedMessage){var g=d.messages.indexOf(e),h=f.messageItems.indexOf(c);-1!=g&&-1!=h&&g!=h&&g<f.messageItems.length&&(f.messageItems.splice(h,1),f.messageItems.splice(g,0,c)),c.recomputeFailedState()}c.dispatchUpdateEvent(),_a.trigger("MessageReceivedAtServer",{chat:d})}e.fileInfo&&P(f)}}function ja(a,b){var c,d=a.chat,e=d.thisUser.userId;if(a.messageItemsMap)for(var f in b)c=a.messageItemsMap[f],c&&c.recomputeSeenInfo(d,e,a.messagesSeenMap)&&c.dispatchUpdateEvent()}function ka(a){var b=a.chat,c=a.messages,d=u(b.chatId,!0),f=c.length;if(d&&d.messageItems&&f>0){var g,h,i,j,k={},l=d.messageItems.length;if(l){j=d.messageItems[l-1];var m=l>1?d.messageItems[l-2].message:null;i=c[0],j.recompute(b,b.thisUser.userId,m,i,b,d.messagesSeenMap,k)&&j.dispatchUpdateEvent(),h=j.message}for(var n,o=0;f>o;++o)g=c[o],i=f-1>o?c[o+1]:null,n=e.createViewDataForMessage(b,g,b.thisUser.userId,h,i,d.messagesSeenMap,k),d.messageItemsMap[g.messageId]=n,d.messageItems.push(n),h=g;ja(d,k),_a.trigger("NewerMessagesLoaded",{chat:b,message:c[f-1]})}}function la(a){var b=a.chat,c=a.reset,d=a.messages,h=u(b.chatId,!0);if(!h&&b.chatType===g.chatsdk.ChatType.P2P){var i=b.getOtherParticipant(b.thisUser.userId);h=v(i.userId),h&&h.type==f.USER&&(h.convertToChatView(b),h.messageItems||h.initalizeMessagesData(),z(i.userId),x(h,b.chatId))}var j,k=d.length;if(h&&h.messageItems){if(c){h.messagesSeenMap={};var l=e.createViewDataForMessages(b,b.messages,b.thisUser.userId,null,null,h.messagesSeenMap,{});h.messageItems=l.messageItems,h.messageItemsMap=l.messageItemsMap}else if(k>0){var m,n,o,p,q={},r=h.messageItems.length;if(r){o=h.messageItems[0];var s=r>1?h.messageItems[1].message:null;p=o.message,o&&o.recompute(b,b.thisUser.userId,d[k-1],s,h.messagesSeenMap,q)&&o.dispatchUpdateEvent()}for(var t,w=k-1;w>=0;--w)m=d[w],n=w-1>=0?d[w-1]:null,t=e.createViewDataForMessage(b,m,b.thisUser.userId,n,p,h.messagesSeenMap,q),p=m,h.messageItemsMap[m.messageId]=t,h.messageItems.unshift(t);j=h.messageItems.length>r?h.messageItems[h.messageItems.length-r-1]:null,ja(h,q)}_a.trigger("ChatHistoryLoaded",{chat:b,lastMessageItem:j})}}function ma(a){var b,c=a.chat;if(Xa&&Xa.chatId==c.chatId)Va||(b=u(c.chatId,!0),b||(b=d.createChatView(c),b.initalizeMessagesData(),x(b,c.chatId)),Xa=null,_a.setSelectedItem(b));else if(b=u(c.chatId,!0)){var e=b.recompute();e||b.dispatchUpdateEvent(),cb&&cb.dispatchUpdateEvent()}}function na(a){var b=a.chatId;Xa&&Xa.chatId==b&&(!Va&&Ua.length&&_a.setSelectedItem(Ua[0]),Xa=null)}function oa(a){var b=a.chatId;Xa&&Xa.chatId==b&&(!Va&&Ua.length&&_a.setSelectedItem(Ua[0]),Xa=null)}function pa(a){var b,c,d=a.chat,e=a.message,f=u(d.chatId,!0);if(f&&f.messageItems){b=f.messageItemsMap;var g={};if(c=b[e.messageId]){if(c.message.fileInfo.thumbnailName&&c.message.fileInfo&&c.message.fileInfo.file){var h=new Image;h.src=k("getNoteThumbnailPath")(c.message.fileInfo,d.chatId),h.onload=function(){c.message.fileInfo.file.localUrl=h.src,ea(c,f,g),c.dispatchUpdateEvent(),_a.trigger("FileUploadedInChat",{chat:d})}}else ea(c,f,g),c.dispatchUpdateEvent(),_a.trigger("FileUploadedInChat",{chat:d});ja(f,g)}}}function qa(a){var b,c=a.chat,d=a.message,e=u(c.chatId,!0);e&&e.messageItemsMap&&(b=e.messageItemsMap[d.messageId],b&&b.dispatchUpdateEvent())}function ra(a){var b=a.chat,c=a.message,d=u(b.chatId,!0);if(d&&d.messageItems){var e=d.messageItemsMap[c.messageId];if(e){delete d.messageItemsMap[c.messageId];var f,g,h,i,j=d.messageItems.length,k=d.messageItems.indexOf(e),l={};-1!=k&&(k>0&&(g=d.messageItems[k-1],f=k-2>=0?d.messageItems[k-2].message:null),j-1>k&&(h=d.messageItems[k+1],i=j>k+2?d.messageItems[k+2].message:null),g&&g.recompute(b,b.thisUser.userId,f,h?h.message:null,d.messagesSeenMap,l)&&g.dispatchUpdateEvent(),h&&h.recompute(b,b.thisUser.userId,g?g.message:null,i,d.messagesSeenMap,l)&&g.dispatchUpdateEvent(),d.messageItems.splice(k,1),_a.trigger("MessageRemovedInChat",{chat:b,message:e.message}))}}}function sa(b){if(b.type==f.CONTACT){var d=b.contact;d.isInvitedUser()||(d.updateContactStatusAsInvited(),b.dispatchUpdateEvent(),o.inviteUsersToNetwork([d.email],c,c,c,"Chat").then(function(b){if(b.data.type)if(b.data.data.users_invited.length>0){d.updateUserId(b.data.data.users_invited[0].invitee_global_profile.user_id);var c=a.addInaccessibleUser(d.userId,d.getDisplayName());c.status=d.status,c.email=d.email,a.removeContact(d),A()}else b.data.data.users_not_invited.length>0&&(d.updateContactStatusAsNotInvited(),n.showBanner(b.data.data.users_not_invited[0].error_message,!1,!1))}))}}function ta(c,d){var e,h=c.getOtherParticipant(c.thisUser.userId).userId;c.chatId;e=o.inviteUsersToNetwork([h],d,!1,!0,"Chat"),e.then(function(d){if(d.data.type&&d.data.data.users_invited.length>0&&c.isInviteChat){b.updateInviteChatParticipants(c,d.data.data.users_invited),c.chatType===g.chatsdk.ChatType.P2P&&b.updateInviteP2PChatIdAndStatus(c),b.updateInviteChatFakeMessagesAsOriginal(c),b.addChatInCollection(c);var e=u(h,!0);if(e.contact){e.contact.updateUserId(d.data.data.users_invited[0].invitee_global_profile.user_id),e.contact.updateContactStatusAsInvited();var i=a.addInaccessibleUser(e.contact.userId,e.contact.getDisplayName());i.status=e.contact.status,i.email=e.contact.email}if(e){y(h),z(h);var j=Ua.indexOf(e);if(-1!=j&&(Ua.splice(j,1),e.banner&&e.banner.length)){if(j<Ua.length){var k=Ua[j];k.type==f.CONTACT&&(k.banner=e.banner,k.dispatchUpdateEvent())}e.banner=null}e.convertToChatView(c),e.dispatchUpdateEvent(),x(e,c.chatId)}b.sendInviteChatMessages(c)}else d.data.type&&d.data.data.users_not_invited.length>0&&n.showBanner(d.data.data.users_not_invited[0].error_message,!1,!1)})}function ua(a){var b=a.chat,c=u(b.chatId,!0);c&&c.searchInfo&&c.dispatch(f.SEARCH_STARTED)}function va(a){var b=a.searchInfo.messageItems;b&&b.length&&b.forEach(function(b){a.chat.searchInfo.isCurrentMatch(b.message)?b.isCurrentMatch||(b.isCurrentMatch=!0,b.dispatchUpdateEvent()):b.isCurrentMatch&&(b.isCurrentMatch=!1,b.dispatchUpdateEvent())})}function wa(a){var b=a.chat,c=u(b.chatId,!0);c&&c.searchInfo&&(va(c),c.dispatch(f.SEARCH_INITIALIZED))}function xa(a){var b=a.chat,c=u(b.chatId,!0);c&&c.searchInfo&&(va(c),c.dispatch(f.MATCH_FETCH_COMPLETE))}function ya(a){var b=a.chat,c=u(b.chatId,!0);c&&c.searchInfo&&c.dispatch(f.LOADED_MORE_MSGS_IN_SEARCH)}function za(a){var b=a.chat,c=u(b.chatId,!0);c&&c.searchInfo&&(c.searchInfo=null,c.dispatch(f.SEARCH_ENDED))}function Aa(a){_a.trigger(f.CHATS_UNREAD_COUNT_CHANGE,{unreadCount:a.unreadCount})}function Ba(){b.addListener(g.chatsdk.ChatEvents.CHATS_REFRESHED,F),b.addListener(g.chatsdk.ChatEvents.CHATS_CACHE_REFRESHED,G),b.addListener(g.chatsdk.ChatEvents.CHAT_ADDED,H),b.addListener(g.chatsdk.ChatEvents.CHAT_MOVED,I),b.addListener(g.chatsdk.ChatEvents.CHATS_ADDED,J),b.addListener(g.chatsdk.ChatEvents.CHAT_UPDATED,K),b.addListener(g.chatsdk.ChatEvents.CHAT_READ,L),b.addListener(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,K),b.addListener(g.chatsdk.ChatEvents.HISTORY_LOADED,la),b.addListener(g.chatsdk.ChatEvents.CHAT_INFO_RECEIVED,ma),b.addListener(g.chatsdk.ChatEvents.CHAT_INFO_ERROR_RECEIVED,na),b.addListener(g.chatsdk.ChatEvents.CHAT_INFO_LOAD_FAILED,oa),b.addListener(g.chatsdk.ChatEvents.SENT_MSG_FAILED,qa),b.addListener(g.chatsdk.ChatEvents.FILE_UPLOADED,pa),b.addListener(g.chatsdk.ChatEvents.MESSAGE_SENT_IN_CHAT,fa),b.addListener(g.chatsdk.ChatEvents.MESSAGE_RECEIVED,da),b.addListener(g.chatsdk.ChatEvents.MESSAGE_REMOVED,ra),b.addListener(g.chatsdk.ChatEvents.SENT_MSG_RECEIVED_AT_SERVER,ia),a.addListener(g.chatsdk.ChatEvents.CONNECTED,D),a.addListener(g.chatsdk.ChatEvents.CONTACTS_CONNECTED,E),b.addListener(g.chatsdk.ChatEvents.COMPOSING_STARTED,M),b.addListener(g.chatsdk.ChatEvents.COMPOSING_ENDED,N),b.addListener(g.chatsdk.ChatEvents.MUTE_STATUS_CHANGED,O),b.addListener(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,Q),a.addListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,S),b.addListener(g.chatsdk.ChatEvents.NEWER_MESSAGES_LOADED,ka),b.addListener(g.chatsdk.ChatEvents.SEARCH_STARTED,ua),b.addListener(g.chatsdk.ChatEvents.MATCH_FETCH_COMPLETE,xa),b.addListener(g.chatsdk.ChatEvents.SEARCH_MATCHES_RECEIVED,wa),b.addListener(g.chatsdk.ChatEvents.LOADED_MORE_MSGS,ya),b.addListener(g.chatsdk.ChatEvents.SEARCH_ENDED,za),b.addListener(g.chatsdk.ChatEvents.CHATS_UNREAD_COUNT_CHANGED,Aa)}function Ca(){}function Da(){function a(a){h=!1,a.type==f.P2P_CHAT||a.type==f.GROUP_CHAT?(i-a.chat.lastMessageTimestamp<e&&(h=!0),a.type==f.P2P_CHAT&&"userOfflineWithMobile"==a.presenceStatus&&(h=!0),i-a.lastMessageTimestamp<g&&c.push(a),h&&a.dispatchUpdateTimeEvent()):a.type==f.USER&&"userOfflineWithMobile"==a.presenceStatus&&a.dispatchUpdateTimeEvent()}var c=[],d=864e5,e=9*d,g=4*d,h=!1,i=b.getCurrentUTCTimestamp();Ua.forEach(a);for(var j in bb)a(v(j));c.forEach(function(a){a.messageItems&&a.messageItems.forEach(function(a){a.showMessageDate&&i-a.message.getTimestamp()<g&&a.dispatchUpdateTimeEvent()})})}function Ea(){Qa||(Qa=setInterval(Da,6e4))}function Fa(){_a.trigger(f.LIST_ITEMS_SEARCH_IN_PROGRESS)}function Ga(){_a.trigger(f.LIST_ITEMS_UPDATE)}function Ha(){m.on(f.LIST_ITEMS_SEARCH_IN_PROGRESS,Fa),m.on(f.LIST_ITEMS_UPDATE,Ga)}function Ia(){Ba(),Ca(),b.isConnected()&&!b.isChatsFetchInProgress()&&b.getChats().length?F():console.log("ChatViewDataManger.init: ChatManager is not connected yet"),a.isConnected()&&D({users:a.getUsers()}),b.isConnected()&&(i.appHasFocus()?b.appFocusGained():b.appFocusGained()),Ea(),Ha()}function Ja(a){var c=[],d=b.getChat(a.chatId);if(!d){for(var e in a.participants)c.push(a.participants[e]);var f=a.getOriginalTitle();d=b.openChatFromId(a.chatId,a.chatType,null,c,null,!0,!0,f)}return d}function Ka(a,b){b||(b=!1);var c=null;a&&(c=u(a.chatId,!0),c||(c=d.createChatView(a),x(c,a.chatId),db[a.chatId]=1)),cb.updateChatViewData(c,b)}function La(){if(cb&&1==cb.explicitlyCreatedLocalChat){var a=cb.chatViewData;if(a&&a.type==f.GROUP_CHAT){var c=a.chat;db[c.chatId]&&(z(c.chatId),delete db[c.chatId],b.removeLocallyCreatedChat(c.chatId)),cb.explicitlyCreatedLocalChat=!1}}}function Ma(){var a=cb.users;if(!a||0==a.length)return void Ka(null);if(1==a.length)return void Pa();var b=Oa(a),c=b.chat,d=b.matchFound;if(c)Ka(c,d);else{var e=a.map(function(a){return a.userId});p.fetchMatchingChat(e,cb.usersHash).then(function(a){cb&&(a.match?a.requestId==cb.usersHash?(Na(a.match,a.requestId),Ka(Ja(a.match),!0)):Na(a.match,a.requestId):Pa())},function(a){cb&&Pa()})}}function Na(a,b){a&&b&&($a[b]=a)}function Oa(a){var c,d=cb.users.map(function(a){return a.userId}),e=g.chatsdk.ChatUtils.generateUniqueKeyFromIds(d),f=$a[e],h=!1;return f?(c=Ja(f),h=!0):(c=b.getLocalChatWithUsers(cb.users),h=c&&c.lastMessageSequenceNumber>0),{chat:c,matchFound:h}}function Pa(){var a=b.startChatWithUsers(cb.users,!0);Ka(a)}var Qa,Ra=!1,Sa=!1,Ta=!1,Ua=[],Va=null,Wa=null,Xa=null,Ya=!1,Za=!1,$a={},_a={};_.extend(_a,Backbone.Events);var ab={},bb={},cb=null,db={},eb={},fb={},gb=function(c,e,g){if(Ra)if(g&&(Xa=null),"new"==c)r.isAdminMode()?_a.setSelectedItem(Ua[0]):cb?_a.setSelectedItem(cb):_a.createNewChat([]);else if("all"==c)_a.setSelectedItem(Ua[0]);else{var h,i=u(c,!0),j=!1;if(i)_a.setSelectedItem(i);else if(e){if(e==f.VIEW_USER_CHAT){var k=a.getUser(c);k?(h=b.startChatWithUser(k,!1,!0),i=u(h.chatId,!0),i||(i=u(k.userId)),i||(i=d.createUserView(k),i.chat=h,x(i,k.userId)),_a.setSelectedItem(i)):j=!0}else if(e==f.VIEW_CONTACT_CHAT){var l=a.getUserByEmail(c);l?(h=b.startChatWithUser(l,!0),i=u(h.chatId,!0),i||(i=u(l.email)),i||(i=d.createContactView(l),i.chat=h,x(i,l.email)),_a.setSelectedItem(i)):j=!0}j&&Ua.length&&_a.setSelectedItem(Ua[0])}else{var h=b.getChat(c);h?(i=d.createChatView(h),i.initalizeMessagesData(),x(i,h.chatId),_a.setSelectedItem(i)):(b.loadChatFromId(c,!0),Xa={chatId:c,view:e})}}else Xa={chatId:c,view:e}};return Ia(),_a.isReady=function(){return Ra},_a.getListItems=function(){return m.isInSearch()?m.getListItems():Ua},_a.canLoadMoreItems=function(){return m.isInSearch()?m.canLoadMoreItems():b.canLoadOlderChats()?!0:Ya&&Za?!1:!0},_a.loadMoreItems=function(){if(Ta=!0,m.isInSearch())m.loadMoreItems();else if(b.canLoadOlderChats())b.loadOlderChats();else{var a=0;if(Ya||(a=B()),a<f.CHATS_LIST_PAGE_SIZE&&!Za){var c=C();a+=c}U()}},_a.setSelectedItemFromSearch=function(a){if(a.type==f.USER)_a.startChatWithUser(a.user);else if(a.type==f.CONTACT)_a.startChatWithUser(a.contact,!0);else if(a.type==f.P2P_CHAT||a.type==f.GROUP_CHAT){var c,e,g=null;if(a.chat.isFetchedChat){var c;if(e=u(a.chat.chatId,!0),a.chat.message_match){g={searchText:a.chat.searchText,matchedMsgSeqNo:a.chat.sequenceNumber,matchedMsgId:a.chat.messageId},q.fetchChat(a.chat.chatId,g.searchText).then(function(a){b.chatSearchResultsReceived(a.data)});var h=[];for(var i in a.chat.participants)h.push(a.chat.participants[i]);e&&(e.searchInfo=g);var j=a.chat.getOriginalTitle();c=b.openChatInSearch(a.chat.chatId,a.chat.chatType,g.searchText,[],{seq_no:g.matchedMsgSeqNo,msg_id:g.matchedMsgId},h,null,9,!0,j),e||(e=d.createChatView(c),x(e,c.chatId),e.initalizeMessagesData(),e.searchInfo=g)}else e||(c=Ja(a.chat),e=d.createChatView(c),x(e,a.chat.chatId),e.initalizeMessagesData());_a.setSelectedItem(e)}else e=u(a.chat.chatId,!0),e||(c=b.getChat(a.chat.chatId),e=d.createChatView(c),x(e,c.chatId),e.initalizeMessagesData()),_a.setSelectedItem(e)}},_a.setSelectedItem=function(a){if(Va!=a){var c=Va;Va=a,a&&(_a.isNewChatData(a)||(a.type==f.USER?a.chat=b.startChatWithUser(a.user):a.type==f.CONTACT&&(a.chat=b.startChatWithUser(a.contact,!0)))),_a.trigger("SelectedItemChange",{item:Va}),c&&c.searchInfo&&_a.cancelSearch(c)}},_a.getSelectedItem=function(){return Va},_a.getItemFromId=function(a,b){return u(a,b)},_a.getItemNoteData=function(a){var b=a.chatNoteItem;return null===b&&P(a),b},_a.getItemFiles=function(a){var b=a.chatFiles;return null===b&&P(a),b},_a.getMessageItems=ca,_a.chatOpened=X,_a.chatClosed=Y,_a.messageReadInChat=function(a,c,d){a.senderId!=c.thisUser.userId&&(b.messageRead(a,c),d&&b.chatRead(c))},_a.sendMessageInChat=function(a,b){ga(a,b)},_a.cancelMessageItem=function(a,c){b.cancelMessageInChat(c.message,a.chat)},_a.sendVideoMessageInChatItem=function(a,b,c,d){var e;_a.isNewChatData(b)&&(b=b.chatViewData),e=b.chat,ga(a,e,c,d)},_a.loadOlderMessagesInChat=b.loadOlderMessagesInChat,_a.selectChatItemFromChatId=gb,_a.muteChat=Z,_a.leaveChat=$,_a.markChatReadIfNeeded=ba,_a.removeParticipantFromChat=aa,_a.composingPaused=function(a){a&&b.composingPaused(a)},_a.composingStarted=function(a){a&&b.composingStarted(a)},_a.sendFilesInChat=function(a,c){ha(a),b.sendFilesInChat(a,c)},_a.onFileDataChanged=function(a){b.onFileDataChanged(a)},_a.resendMessageInChat=function(a,c){b.reSendMessageInChat(a,c),h.trackEvent(h.RETRY_A_FAILED_CHAT)},_a.downloadFileFromChat=function(a,b){if(a.message&&a.message.fileInfo){var c=k("getPartialOriginalImagePath")(a.message.fileInfo.originalName,b.chatId);l.download([{path:c,name:a.message.fileInfo.name}])}},_a.startChatWithUser=function(a,c){if(a){var e=b.startChatWithUser(a,c,!0),f=u(e.chatId,!0);f||(c?(f=d.createContactView(a),f.chat=e,x(f,a.email)):(f=d.createChatView(e),x(f,e.chatId))),_a.setSelectedItem(f)}},_a.updateChatTitle=function(a,c){b.updateChatTitle(a.chat,c)},_a.updateChatImage=function(a,c){b.updateChatImage(a.chat,c)},_a.inviteUsersInChat=function(a,c){b.inviteUsersInChat(a,c.chat)},_a.search=function(a){m.search(a)},_a.searchEnded=function(){m.isInSearch()&&(m.searchEnded(),U())},_a.searchCanceled=function(){m.isInSearch()&&(m.searchEnded(),U())},_a.createNewChat=function(a){cb?a&&(cb=d.createNewChatData(a)):cb=d.createNewChatData(a),$a={},a&&a.length&&Ma(),_a.setSelectedItem(cb)},_a.removeNewChat=function(){if(cb){Va==cb&&Ua&&Ua.length&&_a.setSelectedItem(Ua[0]);for(var a in db)Va&&Va.chat&&Va.chat.chatId==a||(z(a),b.removeLocallyCreatedChat(a));cb=null,$a={},db={},_a.trigger(f.NEW_CHAT_REMOVED)}},_a.getNewChatData=function(){return cb},_a.isNewChatData=function(a){return d.isNewChatData(a)},_a.addUserByUserIdInNewChat=function(b){var c=a.getUserById(b);if(c){var d=cb.addUser(c);d&&(La(),Ma(),cb.dispatchUpdateEvent())}},_a.removeUserByUserIdFromNewChat=function(b){var c=a.getUserById(b);if(c){var d=cb.removeUser(c);d&&(La(),Ma(),cb.dispatchUpdateEvent())}},_a.openChatFromServerSuggestion=function(a){var b=u(a.chatId,!0);if(!b){var c=Ja(a);b=d.createChatView(c),x(b,c.chatId)}_a.setSelectedItem(b),_a.removeNewChat()},_a.explicitlyCreateNewChat=function(){cb&&0==cb.explicitlyCreatedLocalChat&&(Pa(),cb.explicitlyCreatedLocalChat=!0)},_a.loadNextMatch=function(a){a&&a.chat&&a.chat.searchInfo&&a.chat.searchInfo.moveToNextMatch()},_a.loadPreviousMatch=function(a){a&&a.chat&&a.chat.searchInfo&&a.chat.searchInfo.moveToPreviousMatch()},_a.cancelSearch=function(a){b.searchEnded(a.chat)},_a.loadMessagesBeforeMsgItem=function(a,b){if(a&&a.chat&&a.chat.searchInfo){var c,d=b.message.getSequenceNumber();d>1&&(d-=1,c=Math.max(1,d-20),a.chat.searchInfo.loadMoreMessages(c,d))}},_a.loadMessagesAfterMsgItem=function(a,b){if(a&&a.chat&&a.chat.searchInfo){var c,d=b.message.getSequenceNumber();d<a.chat.lastMessageSequenceNumber&&(d+=1,c=Math.min(a.chat.lastMessageSequenceNumber,d+20),a.chat.searchInfo.loadMoreMessages(d,c))}},_a.inviteContact=sa,_a.isAdminMode=function(){return r.isAdminMode()},_a}]),b.module("convoApp").factory("NewChatDataManager",["chatUsersManager","chatAdvancedSearchManager","$q","$filter","utils",function(a,b,c,d,e){function f(b){var c=b.participants,e=[];for(var f in c){var g=a.getUser(f);e.push(g)}var h=0;e.length>4?(h=e.length-3,e=e.splice(0,3)):0==e.length&&e.push(b.thisUser);var i=b.getTitle(),j=b.lastMessage,k={id:b.chatId,type:"GROUP_CHAT",label:i,formattedlabel:i,labelisemail:!1,desclabel:j,formatteddesclabel:j,desclabelisemail:!1,labelbadge:d("dateAgo")(b.lastMessageTimestamp,null,!0,!0),users:e,undisplayeduserscount:h,data:b};return b._iconVersion&&0!=b._iconVersion&&-1!=b._iconVersion&&(k.chaticonurl=d("getChatImageThumbnailPath")(b.chatId,"96x96",b._iconVersion)),k}var g,h={};return h.fetchChatSuggestions=function(d,h,i){g=(new Date).getTime();var j=a.getFilteredUserList(h,!1,30,!0),k=j.map(function(a){return a.userId}),l=c.defer();return b.fetchChatSuggestions(d,h,k,g,i).then(function(a){if(a.requestId==g){var b=a.suggestions,c=[];b&&b.length&&(c=b.map(f),c.unshift({label:"Group Chats",formattedlabel:"Group Chats",type:"SEPARATOR",id:e.generateHash("Group Chats")})),l.resolve(c)}}),l.promise},h}]),b.module("convoApp").factory("UserChatsSettingsManager",["chatUsersManager","settingsService","ServerComm","ChatsUtils","ChatConstants","userInfo",function(a,b,c,d,e,f){function h(a){c.post("user",{user_status:a,method:"updateUserStatus"})}function i(a){return c.post("user",a).then(function(a){return a.data.data})}function j(){i({method:"getUserStatus"}).then(function(b){var c=b;c==s.AVAILABLE?a.setThisUserCustomStatus(g.chatsdk.UserStatus.AVAILABLE):c==s.BUSY&&a.setThisUserCustomStatus(g.chatsdk.UserStatus.BUSY),l()})}function k(b){h(b),b==s.AVAILABLE?a.setThisUserCustomStatus(g.chatsdk.UserStatus.AVAILABLE):b==s.BUSY&&a.setThisUserCustomStatus(g.chatsdk.UserStatus.BUSY),l()}function l(){var b=a.getThisUser();if(b){var c=d.getPresenceValue(b);c!=t&&(t=c,s.trigger(e.THIS_USER_PRESENCE_CHANGE))}}function m(a){var c=b.isSoundEnabled();c=1==a?28:b.bitOFF(c,b.DESKTOP),b.saveSettingByName(b.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND,c)}function n(a){var c=b.getIncomingChatSetting();c=1==a?b.bitON(c,b.DESKTOP):b.bitOFF(c,b.DESKTOP),b.saveSettingByName(b.GENERAL_SETTING___NOTIFY_INCOMING_CHATS,c)}function o(){b.getChatSettings(!0).then(function(a){var c=b.getIncomingChatSetting(),d=b.isSoundEnabled();u=b.isBitONOFF(c,b.DESKTOP)?1:0,v=b.isBitONOFF(d,b.DESKTOP)?1:0,s.trigger(s.ON_USER_SETTINGS_CHANGE)})}function p(b){var c=b.users;if(c)for(var d=a.getThisUser(),e=c.length,f=0;e>f;++f)if(d==c[f]){l();break}}function q(a){l()}function r(){a.addListener(g.chatsdk.ChatEvents.CONNECTED,q),a.addListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,p),f.on("userDataRevisionNoChanged",o),j(),o(),a.isConnected()&&q({users:[a.thisUser]})}var s={};s.ON_USER_SETTINGS_CHANGE="ousc",s.AVAILABLE=g.chatsdk.UserStatus.AVAILABLE,s.BUSY=g.chatsdk.UserStatus.BUSY,_.extend(s,Backbone.Events);var t="userOffline",u=1,v=1;return r(),s.setUserCustomStatus=function(a){(a==s.AVAILABLE||a==s.BUSY)&&k(a)},s.toggleChatNotificationSettings=function(){u=u?0:1,n(u)},s.toggleChatNotificationSoundSettings=function(){v=v?0:1,m(v)},s.getThisUserPresence=function(){return t},s.isNotificationsOn=function(){return 1==u},s.isSoundsOn=function(){return 1==v},s.getThisUser=function(){return a.getThisUser()},s}]),a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatContextFactory=function(){function a(){return new g.chatsdk.ChatContext}var b;return{getChatContext:function(){return b||(b=a()),b}}}(),g.chatsdk.ChatContext=function(){var a=g.chatsdk;this.timestampManager=new a.TimestampManager,this.connectionManager=new a.ConnectionManager,this.messagesDiskManager=new a.MessagesDiskManager,this.callsManager=new a.XMPPCallsManager(this.connectionManager),this.usersManager=new a.UserManager(this.callsManager,this.timestampManager),this.localStoreManager=new a.LocalStoreManager(this.messagesDiskManager),this.chatManager=new a.ChatManager(this.usersManager,this.timestampManager,this.callsManager,this.messagesDiskManager,this.localStoreManager),this.usersManager.addListener(a.ChatEvents.CONNECTED,this.chatManager.usersUpdated),g.rtc.RTCFactory.init(this.callsManager,this.timestampManager)},b.module("convoApp").factory("chatAppContext",["$rootScope",function(a){return{connect:function(a,b,c,d,e,f,h){var i=g.chatsdk.ChatContextFactory.getChatContext();i.usersManager.setThisUser(b),i.messagesDiskManager.init(a,b.user_id),i.localStoreManager.init(a,i.usersManager)},connectConnectionManager:function(a,b,c,d,e,f,h,i,j){var k=g.chatsdk.ChatContextFactory.getChatContext();k.connectionManager.connect(a,b.user_id,c,d,e,f,h,i,j)},updateXmppAuthToken:function(a){var b=g.chatsdk.ChatContextFactory.getChatContext();b.connectionManager.updateAuthToken(a)},disconnect:function(){var a=g.chatsdk.ChatContextFactory.getChatContext();a.connectionManager.logout(),a.chatManager.destroy(),a.usersManager.destroy(),a.callsManager.destroy(),a.localStoreManager.destroy()},setServices:function(b,c,d,e){var f=g.chatsdk.ChatContextFactory.getChatContext();f.localStoreManager.appTabsService=b,g.chatsdk.ChatUtils.userInfoService=d,f.connectionManager.logger=c,f.connectionManager.clientInstanceId=a.clientInstanceId,f.connectionManager.uId=d.user_id,f.usersManager.usersService=e}}}]).factory("chatManager",[function(){return g.chatsdk.ChatContextFactory.getChatContext().chatManager}]).factory("chatUsersManager",["Users",function(a){return g.chatsdk.ChatContextFactory.getChatContext().usersManager}]),a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.XMPPCallsManager=function(a){function b(b){var d=c.ChatUtils.generateUniqueId(),g=a.getAppVersion().replace(/\./g,""),h=$iq({to:"convo-message-all@"+a.getDomain(),type:"set",id:d}).c(e.QUERY,{xmlns:f.APP_VERSION}).c("data").t(g).up();b.sendIQ(h,d,!0)}var c=g.chatsdk,d=c.ChatEvents,e=c.Constants.TAG,f=c.Constants.XMLNS,h=this;c.EventDispatcher.call(this),this.MAX_RETRY_COUNT=7,this.RETRY_TIME_INTERVAL=7e3,this._connectionManager=a,this._packetIdToPacketMap={},this._packetsInfo=[],this.timerId=null,this.pubsubManager=new g.rtc.PubsubManager(this,this._connectionManager),this._connectionManager.addListener(d.CONNECTED,function(){try{h.onXMPPConnected()}catch(a){console.error(a.stack)}}),this._connectionManager.addListener(d.DISCONNECTED,function(){try{h.onXMPPDisconnected()}catch(a){console.error(a.stack)}}),this.userIdToPresenceMap={},this.sendIQ=function(a,b,c,d,e,f){if(a&&b){if(c){var g={packetId:b,packet:a,retryCount:0,sentTimestamp:(new Date).getTime(),callback:d,errCallback:e,timeout:f};this._packetIdToPacketMap[b]=g,this._packetsInfo.push(g),this.checkTimerStartRequired()}this._connectionManager.sendIQ(a,d,e,f)}},this.sendMessage=function(a,b,c,d){if(a&&b){if(c&&!this._packetIdToPacketMap.hasOwnProperty(b)){var e={packetId:b,packet:a,retryCount:0,sentTimestamp:(new Date).getTime()};this._packetIdToPacketMap[b]=e,this._packetsInfo.push(e),this.checkTimerStartRequired()}this._connectionManager.sendPacket(a)}},this.subscribe=function(a,b,c){this.pubsubManager.subscribe(a,b,c)},this.unsubscribe=function(a,b,c){this.pubsubManager.unsubscribe(a,b,c)},this.publishItem=function(a,b,c,d){this.pubsubManager.publishItem(a,b,c,d)},this.removeItem=function(a,b,c,d){this.pubsubManager.removeItem(a,b,c,d)},this.remove=function(a,b,c){this.pubsubManager.remove(a,b,c)},this.checkTimerStartRequired=function(){this.timerId||(this.timerId=setInterval(function(){h.onRetryTimer()},this.RETRY_TIME_INTERVAL))},this.stopRetryTimerIfRequired=function(){this.timerId&&!this._packetsInfo.length&&(clearInterval(this.timerId),this.timerId=null)},this.onXMPPConnected=function(){this.attachHandlers(),this._packetsInfo.length&&this.onRetryTimer(!0),b(this),this.dispatch(d.CONNECTED)},this.attachHandlers=function(){this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.dispatch(d.ROSTER_RECEIVED,a)}catch(b){console.error(b.stack)}return!0},f.ROSTER,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.dispatch(d.PRESENCE_RECEIVED,a)}catch(b){console.error(b.stack)}return!0},f.PRESENCE_BATCHED,"message"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.onMessageReceived(a)}catch(b){console.error(b.stack)}return!0},f.CONVO_MESSAGE,"message"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.onGroupChatsAckReceived(a)}catch(b){console.error(b.stack)}return!0},f.CHAT_ACK_BATCHED,"message"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.onChatsQueryReceived(a)}catch(b){console.error(b.stack)}return!0},f.HISTORY_CHATS,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.dispatch(d.CHAT_INFO_RECEIVED,a)}catch(b){console.error(b.stack)}return!0},f.CHAT_INFO,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.dispatch(d.CHAT_INFO_ERROR_RECEIVED,a)}catch(b){console.error(b.stack)}return!0;
},f.CHAT_INFO,"iq","error"),this._connectionManager.addHandler(function(a){try{h.dispatch(d.CHATS_BASIC_INFO_RECEIVED,a)}catch(b){console.error(b.stack)}return!0},f.CHAT_BASIC_INFO,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.onMessageQueryReceived(a)}catch(b){console.error(b.stack)}return!0},f.HISTORY_MESSAGES,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.onChatReadQueryReceived(a)}catch(b){console.error(b.stack)}return!0},f.CHAT_READ,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.dispatch(d.HEARTBEAT_RECEIVED,{query:a,iqId:a.getAttribute("id")})}catch(b){console.error(b.stack)}return!0},f.HEARTBEAT,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.dispatch(d.RECENT_CHATS_RECEIVED,{query:a,iqId:a.getAttribute("id")})}catch(b){console.error(b.stack)}return!0},f.RECENT_CHATS,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id")),h.dispatch(d.MUTE_STATUS_CHANGED,a)}catch(b){console.error(b.stack)}return!0},f.CHAT_MUTE,"iq","result"),this._connectionManager.addHandler(function(a){try{h.removePacketFromRetryQueue(a.getAttribute("id"))}catch(b){console.error(b.stack)}return!0},null,"iq","result")},this.onXMPPDisconnected=function(){this.dispatch(d.DISCONNECTED)},this.getDomain=function(){return this._connectionManager.getDomain()},this.getJid=function(){return this._connectionManager.getJid()},this.isRetryingMessageWithId=function(a){return this._packetIdToPacketMap[a]},this.removePacketFromRetryQueue=function(a){if(this._packetIdToPacketMap[a]){delete this._packetIdToPacketMap[a];var b=this._packetsInfo.map(function(a){return a.packetId}).indexOf(a);this._packetsInfo.splice(b,1),this.stopRetryTimerIfRequired()}},this.onMessageReceived=function(a){this.dispatch(d.MESSAGE_RECEIVED,a)},this.onGroupChatsAckReceived=function(a){this.dispatch(d.GROUP_CHATS_ACK_RECEIVED,a)},this.onChatsQueryReceived=function(a){this.dispatch(d.CHAT_HISTORY_RECEIVED,a)},this.onMessageQueryReceived=function(a){this.dispatch(d.MESSAGE_HISTORY_RECEIVED,{query:a,iqId:a.getAttribute("id")})},this.onChatReadQueryReceived=function(a){this.dispatch(d.CHAT_READ,{query:a})},this.isConnected=function(){return this._connectionManager.isConnected()},this.onRetryTimer=function(a){if(this._connectionManager.isConnected()){for(var b,c=(new Date).getTime(),e={},f=this._packetsInfo.length,g=0;f>g;++g){b=this._packetsInfo[g];var h=b.sentTimestamp,i=b.packetId;if(a||c-h>=this.RETRY_TIME_INTERVAL){var j=b.packet,k=j.nodeTree.nodeName,l=b.retryCount;if(l<this.MAX_RETRY_COUNT){if("message"==k){var m=$(j.nodeTree).find("convo-message");m.length&&("message"===m.attr("message_type")&&m.attr("message_type","message_retry"),this._connectionManager.sendPacket(j))}else"iq"==k?this._connectionManager.sendIQ(j,b.callback,b.errback,b.timeout):this._connectionManager.sendPacket(j);b.sentTimestamp=c,++b.retryCount}else"message"==k?(this.dispatch(d.MESSAGE_SEND_FAILED,j.tree()),e[i]=!0):"iq"==k&&($(j.nodeTree).find("query[xmlns='convo:chat:history:messages']").length?this.dispatch(d.MESSAGES_IQ_FAILED,j.tree()):this.dispatch(d.CHATS_IQ_FAILED,j.tree()),e[i]=!0)}}var n;for(var o in e)this._packetIdToPacketMap.hasOwnProperty(o)&&(delete this._packetIdToPacketMap[o],n=!0);for(var p=f-1;p>=0;--p)b=this._packetsInfo[p],e[b.packetId]&&this._packetsInfo.splice(p,1);n&&this.stopRetryTimerIfRequired()}},this.destroy=function(){this._packetIdToPacketMap={};for(var a;this._packetsInfo.length>0;)a=this._packetsInfo.pop(),delete this._packetIdToPacketMap[a.packetId]}},g.chatsdk.XMPPCallsManager.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.XMPPCallsManager.prototype.constructor=g.chatsdk.XMPPCallsManager,a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatFilesManager=function(a,b,c){var d=g.chatsdk,a=a,e={};this.onFileLoaded=function(b,c){if(console.log("=============onFileLoaded ========= "),b){var f=new d.MessageFileInfo(c,!0);f.fileId=c.serverFileId,f.isUploading=!0;var g=a.sendMessage(f.name,b,f);g&&g.fileInfo&&g.fileInfo.isUploading&&(e[c.fileUploadName]||(e[c.fileUploadName]={chat:b,msg:g}))}},this.cancelUploadsInChat=function(a){var b,c=[];for(var f in e)b=e[f],b&&b.chat&&a.chatId==b.chat.chatId&&c.push(b);for(var g,h=c.length,i=0;h>i;i++)b=c[i],g=b.msg,g&&g.fileInfo&&g.fileInfo.status!=d.FileStatus.FS_SUCCESS&&(delete e[g.fileInfo.fileNameId],g.fileInfo.status=d.FileStatus.FS_ERROR,a.cancelMessage(g))},this.onFileDataChanged=function(b){var f,h,i;console.log("=============uploadFileVO.status ========= "+status),b.status==d.FileStatus.FS_SUCCESS||b.status==d.FileStatus.FS_CONVERSION_FAILED?isNaN(b.serverFileId)||(i=e[b.fileUploadName],i&&(delete e[b.fileUploadName],h=i.msg,f=i.chat,h.fileInfo&&(h.fileInfo.isUploading=!1,h.fileInfo.type=b.type,h.fileInfo.fileFormat=b.fileFormat,h.fileInfo.fileId=b.serverFileId,h.fileInfo.size=b.size,h.fileInfo.width=b.width,h.fileInfo.height=b.height,h.fileInfo.originalName=b.originalName,h.fileInfo.thumbnailName=b.thumbnailName,h.fileInfo.thumbnail_name=b.thumbnailName,h.fileInfo.itemId=f.chatId,h.fileInfo.availablePreviews=b.available_previews,h.fileInfo.previewName=b.preview_name,h.fileInfo.noOfPages=b.no_of_pages,a.reSendMessageInChat(h,f),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(f.dispatch(d.ChatEvents.FILE_UPLOADED,{message:h}),c.dispatch(d.ChatEvents.FILE_UPLOADED,{chat:f,message:h}))))):(b.status==d.FileStatus.FS_ERROR||b.status==d.FileStatus.FS_CONVERSION_REQ_FAILED)&&(b.uploadProgress=0,b.previousProgress=0,i=e[b.fileUploadName],i&&(h=i.msg,f=i.chat,f&&h&&a.markMessageFailedInChat(h,f)))},this.cancelMessage=function(a,b){var c=a.fileInfo;c&&delete e[c.fileNameId]}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatManager=function(a,b,c,d,e){function f(a,b,c){c||g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&i.dispatch(g.chatsdk.ChatEvents.CHAT_STARTED,{chat:a,meta:b})}function h(a){return a.replace(new RegExp("([{}()^$&.*?/+|[\\\\]|]|-)","g"),"\\$1")}g.chatsdk.EventDispatcher.call(this);var i=this;this.DEFAULT_XMPP_COMPOSING_DELAY=2e4,this.KDispatchIntervalTenSecs=1e4,this.chats=[],this.unreadChatsCount=0,this.usersManager=a;var j=new g.chatsdk.XMPPChatService(this.usersManager,this,b,c,this,d,e);this.searchKeyword=null,this.isComposingTimerRunning=!1,this.loadedFromCache=!1,this.chatsTable={},this.startChatWithUser=function(a,b,c){return j.startChatWithUser(a,b,c)},this.openChatFromId=function(a,b,c,d,e,g,h,i){var k=j.openChatFromId(a,b,c,d,g,h,i);return f(k,e,g),k},this.chatsForFilteredUsers=function(a){return j.chatsForFilteredUsers(a)},this.openChatInSearch=function(a,b,c,d,e,g,h,i,k,l){var m=j.openChatInSearch(a,b,c,d,e,g,i,k,l);return f(m,h,k),m},this.getUnreadChatsCount=function(){return j.getUnreadChatsCount()},this.chatSearchResultsReceived=function(a){j.chatSearchResultsReceived(a)},this.startChatWithUsers=function(a,b){return j.startChatWithUsers(a,b)},this.sendMessage=function(a,b,c,d,e,f){b.isInSearch()&&this.searchEnded(b,"newMessage"),j.sendMessage(a,b,c,d,e,f)},this.sendFakeMessage=function(a,b){j.sendFakeMessage(a,b)},this.reSendMessageInChat=function(a,b){j.reSendMessageInChat(a,b,!0)},this.muteChat=function(a,b){j.muteChat(a,b)},this.unMuteChat=function(a,b){j.unMuteChat(a,b)},this.chatGainedFocus=function(a){j.chatGainedFocus(a)},this.chatLostFocus=function(a){j.chatLostFocus(a)},this.appFocusGained=function(){j.appFocusGained()},this.appFocusLost=function(){j.appFocusLost()},this.getChats=function(){return j._chats},this.getChatsSearch=function(a){var b=j._chats,c=[],d=a.toLowerCase();if(d&&d.length)for(var e,f=new RegExp("(([\\s,<>():._])|^)("+h(d)+")","gi"),i=0;i<b.length;i++){var k=b[i];k.chatType==g.chatsdk.ChatType.GROUP&&(e=k._title?k._title:null,e||(e=k._computedTitle?k._computedTitle:null),e&&(e=e.toLowerCase(),e.match(f)&&c.push(k)))}return c},this.chatOpened=function(a){a.isInviteChat||j.chatOpened(a)},this.chatRestored=function(a){j.chatRestored(a)},this.getChat=function(a){return j.getChat(a)},this.chatClosed=function(a){j.chatClosed(a)},this.discardOldMessagesFromChatIfRequired=function(a,b){return j.discardOldMessagesFromChatIfRequired(a,b)},this.loadOlderMessagesInChat=function(a){return j.loadOlderMessagesInChat(a)},this.loadOlderChats=function(){return j.loadOlderChats()},this.canLoadOlderChats=function(){return j.canLoadOlderChats()},this.chatRead=function(a){j.chatRead(a)},this.messageRead=function(a,b){j.messageRead(a,b)},this.inviteUsersInChat=function(a,b){j.inviteUsersInChat(a,b)},this.updateParticipantsInChat=function(a,b){j.updateParticipantsInChat(a,b)},this.getService=function(){return j},this.leaveChat=function(a){j.leaveChat(a),j.chatRead(a)},this.removeParticipantFromChat=function(a,b){j.removeParticipantFromChat(a,b)},this.sendFilesInChat=function(a,b){a.isInSearch()&&this.searchEnded(a,"newMessage"),j.sendFilesInChat(a,b)},this.usersUpdated=function(){j.usersUpdated()},this.onFileDataChanged=function(a){j.onFileDataChanged(a)},this.searchEnded=function(a,b){j.searchEnded(a,b)},this.cancelMessageInChat=function(a,b){j.cancelMessageInChat(a,b)},this.composingStarted=function(a){a.isInviteChat||j.composingStarted(a)},this.composingPaused=function(a){a.isInviteChat||j.composingPaused(a)},this.updateInviteChatParticipants=function(a,b){j.updateInviteChatParticipants(a,b)},this.updateInviteP2PChatIdAndStatus=function(a){j.updateInviteP2PChatIdAndStatus(a)},this.updateInviteChatFakeMessagesAsOriginal=function(a){j.updateInviteChatFakeMessagesAsOriginal(a)},this.sendInviteChatMessages=function(a){for(var b=a.messages,c=0;c<b.length;c++)j.reSendMessageInChat(b[c],a,!1),j.messagesLoaderSentMessageInChat(b[c],a)},this.addChatInCollection=function(a){j.addChatInCollection(a)},this.updateChatTitle=function(a,b){j.updateChatTitle(a,b)},this.updateChatImage=function(a,b){j.updateChatImage(a,b)},this.destroy=function(){j.destroy()},this.isConnected=function(){return j.isConnected()},this.isChatsFetchInProgress=function(){return j.isChatsFetchInProgress()},this.getUsersWithoutP2PChat=function(a){return j.getUsersWithoutP2PChat(a)},this.getCurrentUTCTimestamp=function(){return b.UTCTimestamp()},this.getLocalChatWithUsers=function(a){return j.getLocalChatWithUsers(a)},this.loadChatFromId=function(a,b,c){j.loadChatFromId(a,b,c)},this.removeLocallyCreatedChat=function(a){j.removeLocallyCreatedChat(a)}},g.chatsdk.ChatManager.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.ChatManager.prototype.constructor=g.chatsdk.ChatManager,a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatSearchManager=function(a,b,c){function d(a,b){var c=e.chatIdToChatMap[a];c&&c.searchInfo&&c.searchInfo.matchesReceived(b)}this.messagesLoader=a,this.chatIdToChatMap=b,this.chatManager=c;var e=this;this.startSearchInChat=function(a){a.isInSearch&&a.searchInfo.start()},this.fetchMessages=function(a,b,c){return this.messagesLoader.loadMessagesInChat(a,b,c,!0,!0)},this.onChatSearchResultsReceived=function(a){if(a){for(var b,c=a.chat_id,e=a.chatResults,f=[],g=e.length,h=0;g>h;h++)b=e[h],f.push({sequenceNumber:parseInt(b.seq_no),messageId:b.msg_id});d(c,f)}}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatLocalStore=function(a,b,c){function d(a){x.setItem(p+a.chatId,a)}function e(a){return x.hasItem(q+a)}function f(a){return x.getItem(q+a)}function h(a,b){return x.setItem(q+a,b)}function i(a,b){if("participants"===a){var c,d={};if(b)for(var e in b)b.hasOwnProperty(e)&&(c=v.getUserById(e),c||v.addInaccessibleUser(e,b[e].name),d[e]=(new m.ChatParticipant).initialize(b[e]));b=d}return b}function j(a){var b=f(a.chatId);if(b&&b.length){for(var c,d,e=b.length,g=[],h=0;e>h;h++)c=b[h],d=(new m.ChatMessage).initialize(c),d.invitees=c.invitees,g.push(d);m.ChatUtils.sortMessages(g);var i=w.processFailedMessages(g,a);a.prependMessages(i)}}function k(a){var b=[];if(a&&a.length)for(var c,d=a.length,e=0;d>e;e++)c=(new m.Chat).initialize(a[e]),c.thisUser=v.getThisUser(),j(c),b.push(c);return b}function l(a){x.removeItem(n+a),x.removeItem(o+a)}var m=g.chatsdk,n=".chats.",o=".messages.",p=".chats.V1.",q=".messages.V1.",r=20,s=20,t=1,u=2,v=a,w=c,x=b;this.selectChat=function(a){return x.getItem(p+a)},this.selectAllChats=function(a){function b(b){if(0===b.indexOf(c)){var d=x.getItem(b,!0,a);return d.chatId?d:(x.removeItem(b,!0),null)}}var c=x.forgeKey(p);return x.getAllItems(b)},this.selectAllChatsWithOldPrefix=function(a){function b(b){if(0===b.indexOf(c)){var d=x.getItem(b,!0,a);return d.chatId?d:(x.removeItem(b,!0),null)}}var c=x.forgeKey(n);return x.getAllItems(b)},this.selectAllTypedChatsWithMessages=function(){var a=this.selectAllChats(i);return k(a)},this.updateChatAndMessagesIfRequired=function(a){if(!a)throw new Error("Chat can not be null");var b=0,c=this.selectChat(a.chatId),g=a.messages;if(!c||c.lastMessageSequenceNumber<a.lastMessageSequenceNumber)d(a),c||(b=t),g&&g.length&&h(a.chatId,a.messages);else{var i=a.unreadCount<c.unreadCount||a.isMuted!=c.isMuted||a._iconVersion!=c._iconVersion||a._title!=c._title;if(!i)for(var j in a.participants)if(c.participants[j]&&a.participants[j].lastSeenMessageSequenceNumber>c.participants[j].lastSeenMessageSequenceNumber){i=!0;break}if(i&&(d(a),b=u),g&&g.length>0)if(e(a.chatId)){var k=f(a.chatId);g.length>k.length&&k.length<s&&h(a.chatId,g)}else h(a.chatId,g)}return b},this.removeChat=function(a){x.removeItem(p+a),x.removeItem(q+a)},this.removeAllChatsWithOldPrefix=function(){for(var a=this.selectAllChatsWithOldPrefix(i),b=0;b<a.length;b++)l(a[b].chatId)},this.truncateChats=function(){var a=this.selectAllChats();if(m.ChatUtils.sortChats(a),a&&a.length>r)for(m.ChatUtils.sortChats(a);a.length>r;)this.removeChat(a.pop().chatId)},this.saveAllChats=function(a){for(var b=a?a.length:0,c=!1,d=!1,e=0,f=0;b>f;f++)e=this.updateChatAndMessagesIfRequired(a[f]),1===e?c=!0:2===e&&(d=!0);return c&&this.truncateChats(),c||d}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatsDiskManager=function(a){function b(){if(!k||!j)throw new Error("Not Initialized Exception, Please provide user ID and account ID");return"com.convo.chat."+j+"."+k.userId+".chats"}function c(){return b()+".hb.timestamp"}function d(){if(p)try{localStorage.setItem(c(),p)}catch(a){console.log("ChatsDiskManager.savePreviousHeartBeatTimestamp: localStorage.setItem error: "+a.message)}}function e(a){if(a)try{localStorage.setItem(b(),JSON.stringify(a))}catch(c){console.log("ChatsDiskManager.saveToLocalStore: localStorage.setItem error: "+c.message)}}function f(a,b){switch(a){case"messages":var c,d=[];if(b)for(var e=b.length,f=0;e>f;f++)c=(new i.ChatMessage).initialize(b[f]),c.invitees=b[f].invitees,d.push(c);i.ChatUtils.sortMessages(d),b=d;break;case"participants":var g,h={};if(b)for(var j in b)b.hasOwnProperty(j)&&(g=n.getUserById(j),g||n.addInaccessibleUser(j,b[j].name),h[j]=(new i.ChatParticipant).initialize(b[j]));b=h}return b}function h(a){var b=a.chats,c=a.unreadChatsCount;if(b){for(var d,e,f=[],h=b.length,j=0;h>j;j++){e=b[j],d=(new g.chatsdk.Chat).initialize(e);for(var l,m=e.messages.length,n=0;m>n;n++)l=e.messages[n],d.messagesMap[l.messageId]||(d.messagesMap[l.messageId]=l,d.messages.push(l));d.thisUser=k,f.push(d)}o.dispatch(i.ChatEvents.CHATS_REFRESHED,{chats:f,unreadChatsCount:c})}}var i=g.chatsdk;i.EventDispatcher.call(this);var j,k,l=20,m=20,n=a,o=this,p=0;this.init=function(a,b){j=a,k=b,this.loadFromLocalStore()},this.saveChats=function(a,b){if(a){for(var c=a.length,f=[],g=0;c>g;g++){var h=a[g];if(!(f.length>l)||h.isOpened){var j=h.messages;if(h=h.copy(),j){for(var k=[],n=j.length,o=n-1;o>=0&&k.length<=m;o--){var p=j[o];p.fileInfo?p.fileInfo.fileId&&(p.fileInfo.file=null,k.push(p)):k.push(p)}k.length>0?(i.ChatUtils.sortMessages(k),h.messages=k,h.minSequenceNumber=k[0].getSequenceNumber(),f.push(h)):h.lastMessageSequenceNumber>0&&f.push(h)}else h.lastMessageSequenceNumber>0&&f.push(h)}}f.length&&(e({chats:f,unreadChatsCount:b}),d())}},this.setPreviousHeartBeatTimestamp=function(a){a&&(p=a)},this.getPreviousHeartBeatTimestamp=function(){var a;try{a=localStorage.getItem(c())||0}catch(b){console.log("ChatsDiskManager.getPreviousHeartBeatTimestamp: localStorage.getItem error: "+b.message),a=null}return a},this.loadFromLocalStore=function(){var a;try{var c=localStorage.getItem(b());a=JSON.parse(c,f)}catch(d){console.log("ChatsDiskManager.loadFromLocalStore: localStorage.getItem or JSON.parse error: "+d.message),a=null}a&&h(a)}},g.chatsdk.ChatsDiskManager.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.ChatsDiskManager.prototype.constructor=g.chatsdk.ChatsDiskManager,a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatsLoader=function(a,b,c,d,e,f,h){function i(a,b){var c=j.ChatUtils.generateUniqueId(),d=$iq({to:n.getConvoChatJid(),type:"set",id:c}).c(k.QUERY,{xmlns:l.CHAT_MUTE}).c(k.CHAT,{id:a.chatId,action:b});n.xmppCallsManager.sendIQ(d,c,!0)}var j=g.chatsdk,k=j.Constants.TAG,l=j.Constants.XMLNS,m=20;this.CHATS_FETCH_PAGE_SIZE=20,this.CHAT_FETCH_PAGE_SIZE=20,this._canLoadMoreChats=!1,this.KDispatchIntervalFiveSecs=5e3,this._convoChatJid=null,this.fetchChatsCallInprogress=!1,this.fetchCallFromIndex=0,this.fetchCallToIndex=0,this.chatIdToChatMap=b,this._unreadChatsCount=0,this.delegates=[],this.messagesDiskManager=f,this.xmppCallsManager=e;var n=this;this.xmppCallsManager.addListener(j.ChatEvents.CHAT_HISTORY_RECEIVED,function(a){n.processReceivedChats(a)}),this.xmppCallsManager.addListener(j.ChatEvents.CHAT_READ,function(a){n.processChatMarkRead(a)}),this.xmppCallsManager.addListener(j.ChatEvents.MUTE_STATUS_CHANGED,function(a){n.processMuteChangeForQuery(a)}),this.xmppCallsManager.addListener(j.ChatEvents.CHAT_INFO_RECEIVED,function(a){if(a){var b=$(a).find(k.CHAT)[0];if(b){var c=n.processChatXML(b,!0,!0);n.processChatInfoReceived(c);var d=$(b).find(k.MESSAGES);d.length&&n.delegates.forEach(function(a){"function"==typeof a.chatsLoaderReceivedXMLMessagesForChat&&a.chatsLoaderReceivedXMLMessagesForChat(d,c)})}}}),this.xmppCallsManager.addListener(j.ChatEvents.CHAT_INFO_ERROR_RECEIVED,function(a){if(a){var b=$(a).find(k.CHAT)[0];if(b){var c=b.getAttribute("id");n.processChatInfoErrorReceived(c)}}}),this.xmppCallsManager.addListener(j.ChatEvents.CHATS_BASIC_INFO_RECEIVED,function(a){if(a){var b=$(a).find(k.BASIC_INFO);b&&n.updateUnreadChatsCount(b)}}),this.xmppCallsManager.addListener(j.ChatEvents.CHATS_IQ_FAILED,function(a){n.callsManagerChatsIqFailed(a)}),this.deltaFetcher=h,this.deltaFetcher.addListener(j.ChatEvents.HEARTBEAT_RECEIVED,function(a){n.deltaFetcherReceivedChatsXML(a.chatsXML,a.updatedChats,a.hasRecentChats)}),this.deltaFetcher.addListener(j.ChatEvents.UNREAD_COUNT_CHANGED,function(a){n.updateUnreadChatsCount(a)}),this.timestampManager=c,this.usersManager=a,this.chatManager=d,this.fetchTime=0,this.startChatWithUser=function(a,b,c){var d=b?a.email:a.userId,e=this.xmppCallsManager.getJid(),f=j.ChatUtils.generateChatId(e,d),g=this.chatIdToChatMap[f],h=!1;if(!g){g=new j.Chat;var i=this.usersManager.getThisUser();g.setInfo(f,a.getDisplayName(),null,j.ChatType.P2P,0,0,0,!1,i,b),g.isInviteChat?g.addParticipant(new j.ChatParticipant(a.email,a.getDisplayName(),j.ParticipantStatus.JOINED,0,this.timestampManager.UTCTimestamp())):g.addParticipant(new j.ChatParticipant(a.userId,a.getDisplayName(),j.ParticipantStatus.JOINED,0,this.timestampManager.UTCTimestamp())),g.addParticipant(new j.ChatParticipant(i.userId,i.getDisplayName(),j.ParticipantStatus.JOINED,0,this.timestampManager.UTCTimestamp())),g.isInviteChat||(this.chatIdToChatMap[g.chatId]=g,this.loadChat(f)),h=!0}return{chat:g,created:h}},this.startChatWithUsers=function(a){if(!a||0===a.length)return null;if(1===a.length)return this.startChatWithUser(a[0]).chat;var b=j.ChatUtils.generateUniqueId(),c=this.chatIdToChatMap[b];if(!c){var d=this.usersManager.getThisUser();c=new j.Chat,c.setInfo(b,null,null,j.ChatType.GROUP,0,0,0,!1,d);var e=this.timestampManager.UTCTimestamp();c.addParticipant(new j.ChatParticipant(d.userId,d.getDisplayName(),j.ParticipantStatus.JOINED,0,e)),a.forEach(function(a){a&&c.addParticipant(new j.ChatParticipant(a.userId,a.getDisplayName(),j.ParticipantStatus.JOINED,0,e))}),this.chatIdToChatMap[b]=c}return c},this.getLocalChatWithUsers=function(a){if(!a||0===a.length)return null;var c,d,e,f,g,h=0,i=[];for(var k in b)if(c=b[k],c.participants[c.thisUser.userId].status==j.ParticipantStatus.JOINED){e=!1,h=0;for(var l in c.participants)f=c.participants[l],f.userId!=c.thisUser.userId&&f.status==j.ParticipantStatus.JOINED&&++h;if(h==a.length)if(1==a.length)c.type==j.ChatType.P2P&&(c.participants.hasOwnProperty(a[0].userId),e=!0);else{for(g=0;g<a.length;++g)if(d=a[g],!c.participants.hasOwnProperty(d.userId)||c.participants[d.userId].status!=j.ParticipantStatus.JOINED){e=!1;break}e=g==a.length}e&&i.push(c)}return i.length?(j.ChatUtils.sortChats(i),i[0]):null},this.addDelegate=function(a){this.delegates.push(a)},this.chatsCacheRefreshed=function(a){a&&a.length>=this.CHATS_FETCH_PAGE_SIZE&&(this._canLoadMoreChats=!0)},this.refreshChats=function(){var a=!1;return this.fetchChatsCallInprogress||(a=!0,this.fetchCallFromIndex=0,this.fetchCallToIndex=this.CHATS_FETCH_PAGE_SIZE,this.fetchChats(!0)),a},this.fetchChats=function(a){this.fetchChatsCallInprogress=!0;var b=j.ChatUtils.generateUniqueId(),c={xmlns:l.HISTORY_CHATS};a&&(c["basic-info"]="true",this.fetchTime=(new Date).getTime());var d=this,e=$iq({to:d.getConvoChatJid(),type:"get",id:b}).c(k.QUERY,c).c(k.RANGE,{from_index:d.fetchCallFromIndex,to_index:d.fetchCallToIndex});this.xmppCallsManager.sendIQ(e,b,!0)},this.processDeltaFetcherChatXML=function(a,b,c,d){var e=this.processChatXML(a,c,d),f=$(a).find(k.MESSAGES);return f.length&&this.delegates.forEach(function(a){"function"==typeof a.chatsLoaderReceiveHeartBeatXMLMessagesForChat&&a.chatsLoaderReceiveHeartBeatXMLMessagesForChat(f,e,b)}),e},this.updateUnreadChatsCount=function(a){var b=parseInt(a.attr("unread_chats_count")),c=parseInt(a.attr("unread_chats_count_timestamp"));this.delegates.forEach(function(a){"function"==typeof a.updateUnreadChatsCount&&a.updateUnreadChatsCount(b,c)})},this.deltaFetcherReceivedChatsXML=function(a,b,c){var d=!1,e=[];c&&a.length===m&&(d=!0,this._canLoadMoreChats=!0),a.length&&a.find("chat").each(function(){var a=$(this),b=n.processDeltaFetcherChatXML(a,c,!d,!0);d&&e.push(b)}),b.length&&b.find("chat").each(function(){var a=$(this),b=n.processDeltaFetcherChatXML(a,c,!0,!1);d&&e.push(b)}),d&&this.delegates.forEach(function(a){"function"==typeof a.chatsLoaderChatsRefreshed&&a.chatsLoaderChatsRefreshed(e)})},this.processReceivedChats=function(a){a=$(a);var b=a.find("basic-info");b&&(b=$(b),this.timestampManager.initializeIfRequired(parseInt(b.attr("timestamp")),this.fetchTime),this.updateUnreadChatsCount(b));var c=0===this.fetchCallFromIndex&&this.fetchCallToIndex===this.CHATS_FETCH_PAGE_SIZE,d=0,e=[],f=[],h=this,i=a.find("chats")[0];if(!i)return console.warn("error in chats loading"),void(this.fetchChatsCallInprogress=!1);$(i).find(k.CHAT).each(function(){var a=$(this);d++;var b,c,i=a.attr("id"),k=a.attr("last_message_time"),l=a.attr("unread_count"),m=j.ChatUtils.unescape(a.attr("last_message")),n=a.attr("title"),o=a.attr("chat_icon_version"),p="chat"===a.attr("type")?j.ChatType.P2P:j.ChatType.GROUP,q="true"===a.attr("mute"),r=a.attr("sequence_number"),s=a.attr("last_message_sender_id"),t=h.chatIdToChatMap[i];t?(c=!1,(t.lastMessageTimestamp!=k||t.unreadCount!=l||t.lastMessageSequenceNumber!=r||t.isMuted!=q||t.hasPartialInformation)&&(t.unreadCount!=l&&f.push(t),t.update(n,m,l,k,q,s,o),t.lastMessageSequenceNumber=r),b=a.find("participants")[0],b&&h.processParticipantsForChat(b,t,c)):(c=!0,t=new j.Chat,t.setInfo(i,n,m,p,l,k,r,q,h.usersManager.getThisUser(),!1,s,o),b=a.find("participants")[0],b&&h.processParticipantsForChat(b,t,c),h.chatIdToChatMap[t.chatId]=t),t.updateThisUserMessageSeenParticipantsInfo(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&h.chatManager.dispatch(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,{chat:t}),e.push(t)}),this._canLoadMoreChats=d>=this.CHATS_FETCH_PAGE_SIZE,j.ChatUtils.sortChats(e);var l=this.delegates.length;if(c)for(var m=0;l>m;m++){var n=this.delegates[m];"function"==typeof n.chatsLoaderChatsRefreshed&&n.chatsLoaderChatsRefreshed(e)}else for(var m=0;l>m;m++){var n=this.delegates[m];"function"==typeof n.chatsLoaderChatsLoaded&&n.chatsLoaderChatsLoaded(e)}this.fetchChatsCallInprogress=!1},this.processChatMarkRead=function(a){var b=$(a).find(k.CHAT);if(b&&b.length||(b=$(a.query).find(k.CHAT)),b.length){var c=b.attr("id"),d=this.chatIdToChatMap[c];if(d){d.chatReadAtClientButNotAtServer=!1;var e=d.participantForId(this.usersManager.getThisUser().userId);e&&(e.lastSeenMessageSequenceNumber=d.lastMessageSequenceNumber);for(var f=this.delegates.length,g=0;f>g;g++){var h=this.delegates[g];"function"==typeof h.chatsLoaderChatMarkedRead&&h.chatsLoaderChatMarkedRead(d)}}}},this.muteChat=function(a,b){null==a||a.isMuted||a.isMuteStatusUpdateInProgress||(b?(a.isMuteStatusUpdateInProgress=!0,i(a,j.MuteAction.MUTE)):a.isMuted=!0)},this.unMuteChat=function(a,b){null!=a&&a.isMuted&&!a.isMuteStatusUpdateInProgress&&(b?(a.isMuteStatusUpdateInProgress=!0,i(a,j.MuteAction.UNMUTE)):a.isMuted=!1)},this.processMuteChangeForQuery=function(a){if(!a)return null;var b,c,d=$(a).find(k.CHAT);if(d.length&&(b=d.attr("id"),c=d.attr("action")),b){var e=this.chatIdToChatMap[b];if(e){e.isMuteStatusUpdateInProgress=!1;var f=!1;e.isMuted&&c==j.MuteAction.UNMUTE?(e.isMuted=!1,f=!0):e.isMuted||c!=j.MuteAction.MUTE||(e.isMuted=!0,f=!0),f&&(e.updateThisUserMessageSeenParticipantsInfo(),this.delegates.forEach(function(a){"function"==typeof a.chatsLoaderUpdatedChatMuteStatus&&a.chatsLoaderUpdatedChatMuteStatus(e)}))}}},this.processParticipantsForChat=function(a,b,c){var d=this;a=$(a),a.find("participant").each(function(){var a,e=$(this),f=e.attr("id"),g=d.usersManager.getUserById(f);g||(g=d.usersManager.addInaccessibleUser(f,e.attr("name")));var h=g.getDisplayName(),i=e.attr("status"),k=j.ParticipantStatus.LEFT;"joined"==i?k=j.ParticipantStatus.JOINED:"removed"==i&&(k=j.ParticipantStatus.REMOVED);var l=parseInt(e.attr("last_seen_message_sequence_number")),m=parseInt(e.attr("status_timestamp"));c?(a=new j.ChatParticipant(f,h,k,l,m),b.addParticipant(a)):(a=b.participantForId(f),a?a.update(h,k,l,m):(a=new j.ChatParticipant(f,h,k,l,m),b.addParticipant(a)))})},this.updateInviteChatParticipants=function(a,b){for(var c,d,e=a.participants,f=0;f<b.length;f++)c=b[f].invitee_global_profile.user_id,d=b[f].invitee_global_profile.email,a.addParticipantFromGivenParticipantAndDeleteGivenParticipant(e[d],c)},this.updateInviteP2PChatIdAndStatus=function(a){var b=a.getOtherParticipant().userId,c=this.xmppCallsManager.getJid(),d=j.ChatUtils.generateChatId(c,b);a.updateP2PChatId(d),a.updateChatStatusAsNonInviteChat()},this.getConvoChatJid=function(){return this._convoChatJid||(this._convoChatJid="convochat@"+this.xmppCallsManager.getDomain()),this._convoChatJid},this.loadChat=function(a,b){var c=j.ChatUtils.generateUniqueId(),d={id:a};b&&(d.messages_count=20);var e=$iq({to:n.getConvoChatJid(),type:"get",id:c}).c(k.QUERY,{xmlns:l.CHAT_INFO}).c(k.CHAT,d);this.xmppCallsManager.sendIQ(e,c,!0)},this.fetchUnreadChatsCount=function(){var a=j.ChatUtils.generateUniqueId(),b=$iq({to:n.getConvoChatJid(),type:"get",id:a}).c(k.QUERY,{xmlns:l.CHAT_BASIC_INFO});this.xmppCallsManager.sendIQ(b,a,!1)},this.appFocusGained=function(){var a=j.ChatUtils.generateUniqueId(),b=$iq({to:"convop@"+this.xmppCallsManager.getDomain(),type:"set",id:a}).c(k.QUERY,{xmlns:l.FOCUS_GAIN});this.xmppCallsManager.sendIQ(b,a,!0)},this.appFocusLost=function(){var a=j.ChatUtils.generateUniqueId(),b=$iq({to:"convop@"+this.xmppCallsManager.getDomain(),type:"set",id:a}).c(k.QUERY,{xmlns:l.FOCUS_LOSE});this.xmppCallsManager.sendIQ(b,a,!0)},this.processChatXML=function(a,b,c){a=$(a);var d,e=a.attr("id"),f=a.attr("last_message_timestamp")||a.attr("last_message_time");if(f){var h,i,k=parseInt(f),l=parseInt(a.attr("unread_count")),m=j.ChatUtils.unescape(a.attr("last_message")),n=a.attr("title"),o=a.attr("chat_icon_version"),p="chat"==a.attr("type")?j.ChatType.P2P:j.ChatType.GROUP,q="true"==a.attr("mute"),r=parseInt(a.attr("sequence_number")),s=a.attr("last_message_sender_id");if(d=this.chatIdToChatMap[e],d?((d.lastMessageTimestamp!=k||d.unreadCount!=l||d.lastMessageSequenceNumber!=r||d.isMuted!=q||d.hasPartialInformation)&&(i=d.unreadCount!=l,d.update(n,m,l,k,q,s,o),d.lastMessageSequenceNumber=r),h=a.find("participants")[0],h&&this.processParticipantsForChat(h,d,!1),d.updateThisUserMessageSeenParticipantsInfo(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,{chat:d})):c&&(d=new j.Chat,d.setInfo(e,n,m,p,l,k,r,q,this.usersManager.getThisUser(),null,s,o),h=a.find("participants")[0],h&&this.processParticipantsForChat(h,d,!0),this.chatIdToChatMap[d.chatId]=d,d.updateThisUserMessageSeenParticipantsInfo(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,{chat:d})),b&&d)for(var t=this.delegates.length,u=0;t>u;u++){var v=this.delegates[u];"function"==typeof v.chatsLoaderLoadedChat&&v.chatsLoaderLoadedChat(d,null,i,c)}}return d},this.processChatInfoReceived=function(a){for(var b=this.delegates.length,c=0;b>c;c++){var d=this.delegates[c];"function"==typeof d.chatInfoReceived&&d.chatInfoReceived(a)}},this.processChatInfoErrorReceived=function(a){for(var b=this.delegates.length,c=0;b>c;c++){var d=this.delegates[c];"function"==typeof d.chatInfoErrorReceived&&d.chatInfoErrorReceived(a)}},this.loadMoreChatsFromIndex=function(a){var b=!1;return this.fetchChatsCallInprogress||(b=!0,this.fetchCallFromIndex=a,this.fetchCallToIndex=this.fetchCallFromIndex+this.CHATS_FETCH_PAGE_SIZE,this.fetchChats(!0)),b},this.canLoadMoreChats=function(){return this._canLoadMoreChats},this.processChatMarkReadFailedForQuery=function(a){var b=$(a).find(k.CHAT);if(b&&b.length||(b=$(a.query).find(k.CHAT)),b.length){var c=b.attr("id"),d=this.chatIdToChatMap[c];if(d){d.chatReadAtClientButNotAtServer=!1,d.unreadCount=d.unreadCountBeforeReadAtServer||0;for(var e=this.delegates.length,f=0;e>f;f++){var g=this.delegates[f];"function"==typeof g.chatsLoaderMarkChatReadFailed&&g.chatsLoaderMarkChatReadFailed(d)}}}},this.processChatLoadFailedForQuery=function(a){var b=$(a).find(k.CHAT);if(b&&b.length||(b=$(a.query).find(k.CHAT)),b.length){var c=b.attr("id");if(c)for(var d=this.delegates.length,e=0;d>e;e++){var f=this.delegates[e];"function"==typeof f.chatsLoaderChatLoadFailedForId&&f.chatsLoaderChatLoadFailedForId(c)}}},this.processMuteFailedForQuery=function(a){var b=$(a).find(k.CHAT);if(b&&b.length||(b=$(a.query).find(k.CHAT)),b.length){var c=b.attr("id"),d=this.chatIdToChatMap[c];if(d){d.isMuteStatusUpdateInProgress=!1;for(var e=this.delegates.length,f=0;e>f;f++){var g=this.delegates[f];"function"==typeof g.chatsLoaderMuteChatFailed&&g.chatsLoaderMuteChatFailed(d)}}}},this.chatRead=function(a){if(a.unreadCount>0){var b=this,c=j.ChatUtils.generateUniqueId(),d=$iq({to:b.getConvoChatJid(),type:"set",id:c}).c(k.QUERY,{xmlns:l.CHAT_READ}).c(k.CHAT,{id:a.chatId});e.sendIQ(d,c,!0)}},this.callsManagerChatsIqFailed=function(a){if($(a.nodeTree).find("query[xmlns='"+l.HISTORY_CHATS+"']")[0]){this.fetchChatsCallInprogress=!1;for(var b=this.delegates.length,c=0;b>c;c++){var d=this.delegates[c];"function"==typeof d.chatsLoaderChatsLoadFailed&&d.chatsLoaderChatsLoadFailed()}}else $(a.nodeTree).find("query[xmlns='"+l.CHAT_READ+"']")[0]?this.processChatMarkReadFailedForQuery($(a.nodeTree).find("query[xmlns='"+l.CHAT_READ+"']")[0]):$(a.nodeTree).find("query[xmlns='"+l.CHAT_INFO+"']")[0]?this.processChatLoadFailedForQuery($(a.nodeTree).find("query[xmlns='"+l.CHAT_INFO+"']")[0]):$(a.nodeTree).find("query[xmlns='"+l.CHAT_MUTE+"']")[0]&&this.processMuteFailedForQuery($(a.nodeTree).find("query[xmlns='"+l.CHAT_MUTE+"']")[0]);
}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.CnvLocalStore=function(a,b){var c,d=a,e=b;this.forgeKey=function(a){if(!c){if(!e||!d)throw new Error("Not Initialized Exception, Please provide user ID and account ID");c="com.convo.chat."+d+"."+e.userId}return c+(a?a:"")},this.setItem=function(a,b){if("undefined"!=typeof b){"string"!=typeof b&&(b=JSON.stringify(b));try{localStorage.setItem(this.forgeKey(a),b)}catch(c){console.log("Not able to store the data in local store: "+c.message)}}},this.removeItem=function(a,b){try{localStorage.removeItem(b?a:this.forgeKey(a))}catch(c){}},this.getItem=function(a,b,c){var d,e;try{d=localStorage.getItem(b?a:this.forgeKey(a))}catch(f){console.log("loadFromLocalStore: localStorage.getItem error: "+f.message),d=null}if(d)try{e=JSON.parse(d,c)}catch(f){console.log("loadFromLocalStore: JSON.parse error: "+f.message),e=null}return e},this.getAllItems=function(a){var b=[];for(var c in localStorage)if(localStorage.hasOwnProperty(c)){var d=a(c);d&&b.push(d)}return b},this.hasItem=function(a){return localStorage.hasOwnProperty(this.forgeKey(a))}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.LocalStoreManager=function(a){function b(){t&&t>j.getItem(p)&&j.setItem(p,t)}function c(a){if(a){for(var c=a.length,d=[],f=0;c>f;f++){var g=a[f];if(!(d.length>l)||g.isOpened){var h=g.messages;if(g=g.copy(),h){for(var j=[],k=h.length,n=k-1;n>=0&&j.length<m;n--){var o=h[n];o.getSequenceNumber()>0&&(j.splice(0,0,o),o.fileInfo&&(o.fileInfo.file=null))}j.length>0?(e.ChatUtils.sortMessages(j),g.messages=j,g.minSequenceNumber=j[0].getSequenceNumber(),d.push(g)):g.lastMessageSequenceNumber>0&&d.push(g)}else g.lastMessageSequenceNumber>0&&d.push(g)}}d.length&&i.saveAllChats(d)&&b()}}function d(){var a=_.values(u),b=new e.ProfileClock("LocalStoreManager.cacheCall for "+(a?a.length:0)+" chat(s)");c(a),u={},k=null,b.end()}var e=g.chatsdk;e.EventDispatcher.call(this);var f,h,i,j,k,l=20,m=20,n=1e4,o=8e3,p=".hb.timestamp",q=".unread_chats_count_v2",r=a,s=this,t=0,u={};this.appTabsService=null;var v=!0;this.init=function(a,b){h=a,f=b,j=new e.CnvLocalStore(h,f.getThisUser()),i=new e.ChatLocalStore(f,j,r),u={},k&&(clearTimeout(k),k=null),v=!1,this.removePreviousLocalStore(),this.loadFromLocalStore()},this.destroy=function(){v=!0,h=null,f=null,j=null,i=null,u={},k&&(clearTimeout(k),k=null)},this.chatsUpdated=function(a,b){if(a&&a.length&&!v){for(var c,f=a.length,g=!1,h=0;f>h;h++)c=a[h],c.isInviteChat||e.ChatUtils.isAdminModeONAndOrThisUserIsNotInChatParticipants(c)||u.hasOwnProperty(c.chatId)||(u[c.chatId]=c,g=!0);if(g)if(b)clearTimeout(k),k=null,d();else if(!k){var i=this.appTabsService&&this.appTabsService.isThisTabLastActiveTab()?o:n;k=setTimeout(d,i)}}},this.setPreviousHeartBeatTimestamp=function(a){a&&!v&&(t=a)},this.getPreviousHeartBeatTimestamp=function(){return v?0:(t||(t=j.getItem(p)||0),t)},this.updateUnreadChatsCount=function(a){if(!v){var b=this.selectUnreadChatsCount();b!==a&&j.setItem(q,a)}},this.selectUnreadChatsCount=function(){return v?0:j.getItem(q)},this.loadFromLocalStore=function(){if(!v){var a=new e.ProfileClock("LocalStoreManager.loadFromLocalStore"),b=i.selectAllTypedChatsWithMessages();s.dispatch(e.ChatEvents.CHATS_CACHE_REFRESHED,{chats:b,unreadChatsCount:this.selectUnreadChatsCount()}),a.end()}},this.removePreviousLocalStore=function(){if(!v){var a=i.selectAllChatsWithOldPrefix();a&&a.length>0&&i.removeAllChatsWithOldPrefix()}}},g.chatsdk.LocalStoreManager.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.LocalStoreManager.prototype.constructor=g.chatsdk.LocalStoreManager,a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ConnectionManager=function(){function b(a){a!==y&&(y=a)}function c(){b(Strophe.Status.CONNECTING),B=setTimeout(function(){o.isConnected()||(z&&z.reset(),P())},s)}function d(){B&&(clearTimeout(B),B=null)}function e(){console.warn("Strophe is disconnected."),d();var a=y!==Strophe.Status.DISCONNECTING;z&&z.reset();var c=y;b(Strophe.Status.DISCONNECTED),c!==Strophe.Status.DISCONNECTED&&c!==Strophe.Status.CONNECTING&&c!==t&&o.dispatch(g.chatsdk.ChatEvents.DISCONNECTED),l.isConnected()&&a&&P()}function f(){return d(),z?(C=r,y=Strophe.Status.CONNECTED,m=!0,void o.dispatch(g.chatsdk.ChatEvents.CONNECTED)):void(l&&l.isConnected()&&R())}function h(){K||(z&&z.authenticated?(b(Strophe.Status.CONNECTED),m=!1,o.dispatch(g.chatsdk.ChatEvents.CONNECTED)):z&&z.connected||P(!0))}function i(){K||o.isConnected()&&(b(Strophe.Status.DISCONNECTED),o.dispatch(g.chatsdk.ChatEvents.DISCONNECTED))}g.chatsdk.EventDispatcher.call(this);var j,k,l,m=!1,n="bosh",o=this,p="socket",q=6e4,r=1e3,s=3e4,t=9,u="http",v="https",w=!1,x=null,y=Strophe.Status.DISCONNECTED,z=null,A=null,B=null,C=r,D=null,E=null,F=null,G=20,H=1,I=!1,J=!0,K=!1;$(a).unload(function(){o.disconnect(!0)});var L=function(){z&&(o.disconnect(),z=null,x=null)},M=function(){(!I||x&&x!==n)&&J?J&&x!==n&&(z=new Strophe.Connection(D),x=n):x=p},N=function(){A=null,y===t&&(l&&l.isConnected()?R():b(Strophe.Status.DISCONNECTED))},O=function(a){return l&&!l.isConnected()?void b(Strophe.Status.DISCONNECTED):(b(t),A&&clearTimeout(A),void(a?(C=r,N()):(C*=2,C>=q&&(C=r),A=setTimeout(N,C))))},P=function(a){L(),O(a)},Q=function(a){try{switch(a){case Strophe.Status.CONNECTING:c();break;case Strophe.Status.AUTHENTICATING:break;case Strophe.Status.AUTHFAIL:console.warn("Strophe AUTHFAIL.");break;case Strophe.Status.ERROR:console.warn("Strophe ERROR.");break;case Strophe.Status.ATTACHED:break;case Strophe.Status.DISCONNECTING:w=!1;break;case Strophe.Status.DISCONNECTED:case Strophe.Status.CONNFAIL:e();break;case Strophe.Status.CONNECTED:f()}}catch(b){console.error(b.stack)}},R=function(){K||(M(),z.connect(E,F,Q,G,H,null))};this.disconnect=function(a){y!==Strophe.Status.CONNECTING&&z&&z.connected?y===Strophe.Status.CONNECTED&&(y=Strophe.Status.DISCONNECTING,z.disconnect()):(z&&z.reset(),y=Strophe.Status.DISCONNECTED)},this.logout=function(){L(),j=null,K=!0},this.logger=null,this.clientInstanceId=null,this.uId,this.connect=function(a,b,c,d,e,f,m,n,o){y!==Strophe.Status.CONNECTED&&y===Strophe.Status.DISCONNECTED&&(K=!1,j=d,E=g.chatsdk.ChatUtils.makeJid(a,b,j,n),D=(f?v:u)+"://"+e+"/http-bind/",F=c,k=o,l||(l=m,l.on("up",h),l.on("down",i)),l.isConnected()&&R())},this.isConnected=function(){return y===Strophe.Status.CONNECTED},this.updateAuthToken=function(a){F=a},this.sendPacket=function(a){this.isConnected()&&z.send(a)},this.sendIQ=function(a,b,c,d){this.isConnected()&&z.sendIQ(a,b,c,d)},this.getDomain=function(){if(j)return j;throw new Error("Domain is null")},this.getAppVersion=function(){if(k)return k;throw new Error("appVersion is null")},this.getJid=function(){return z?z.jid:null},this.addHandler=function(a,b,c,d,e,f){m&&z.addHandler(a,b,c,d,e,f)}},g.chatsdk.ConnectionManager.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.ConnectionManager.prototype.constructor=g.chatsdk.ConnectionManager,a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.DeltaFetcher=function(a,b,c,d){function e(a,b){var c,d=$iq({to:t(),type:"get",id:a}).c(h.QUERY,{xmlns:b?i.RECENT_CHATS:i.HEARTBEAT,last_timestamp:m.getPreviousHeartBeatTimestamp(),basic_info:!0});b&&(d.c(h.CHATS),c=$build(h.CHATS_FOR_STATUS_UPDATE));for(var e in n)if(n.hasOwnProperty(e)){var g=n[e];g.lastMessageTimestamp>m.getPreviousHeartBeatTimestamp()&&d.c(h.CHAT,{id:g.chatId,sequence_number:g.lastMessageSequenceNumber}).up(),b&&(g.unreadCount>0||g.chatType===f.ChatType.P2P&&Object.keys(g.participants).length>0&&g.getOtherParticipant().lastSeenMessageSequenceNumber<g.lastMessageSequenceNumber)&&c.c(h.CHAT,{id:g.chatId}).up()}return b&&(d.up(),d.cnode(c.tree())),d}var f=g.chatsdk;f.EventDispatcher.call(this);var h=f.Constants.TAG,i=f.Constants.XMLNS,j=6e4,k=d,l=a,m=this;l.addListener(f.ChatEvents.HEARTBEAT_RECEIVED,function(a){m.callsManagerReceivedHeartbeatQuery(a.query,!1)}),l.addListener(f.ChatEvents.RECENT_CHATS_RECEIVED,function(a){m.callsManagerReceivedHeartbeatQuery(a.query,!0)});var n=c,o=b,p=null,q=null,r=0,s=0;this.setPreviousHeartBeatTimestamp=function(a){s=a,k.setPreviousHeartBeatTimestamp(a)},this.getPreviousHeartBeatTimestamp=function(){return s||(s=k.getPreviousHeartBeatTimestamp()),s},this.startHeartBeat=function(){if(!p){this.setPreviousHeartBeatTimestamp(o.UTCTimestamp());var a=this;p=setInterval(function(){a.sendHeartbeat()},j)}},this.stopHeartBeat=function(){p&&(clearInterval(p),p=null)},this.fetchRecentChats=function(){if(this.getPreviousHeartBeatTimestamp()>0){var a=f.ChatUtils.generateUniqueId(),b=e(a,!0);return r=(new Date).getTime(),l.sendIQ(b,a,!0),!0}return!1};var t=function(){return q||(q="convochat@"+l.getDomain()),q};this.sendHeartbeat=function(){var a=f.ChatUtils.generateUniqueId(),b=e(a,!1);l.sendIQ(b,a,!1)},this.callsManagerReceivedHeartbeatQuery=function(a,b){b&&this.startHeartBeat();var c=$(a),d=c.find("basic-info");if(d.length){var e=parseInt(d.attr("timestamp"));o.initializeIfRequired(e,r),this.setPreviousHeartBeatTimestamp(e),this.dispatch(f.ChatEvents.UNREAD_COUNT_CHANGED,d)}var g=c.find(h.CHATS),i=c.find(h.CHATS_FOR_STATUS_UPDATE);g.length&&this.dispatch(f.ChatEvents.HEARTBEAT_RECEIVED,{chatsXML:g,updatedChats:i,hasRecentChats:b})}},g.chatsdk.DeltaFetcher.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.DeltaFetcher.prototype.constructor=g.chatsdk.DeltaFetcher,a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.MessagesDiskManager=function(a,b){function c(){if(!k||!i)throw new Error("Not Initialized Exception, Please provide user ID and account ID");return"com.convo.chat."+i+"."+k+".failed_messages"}function d(a,b,c){var d=_.findWhere(b,{messageId:a.messageId});return d&&d.sequenceNumber>0?void j.deleteMessageWithIdForChatId(a.messageId,c):void b.push(a)}function e(){try{m&&localStorage.setItem(c(),JSON.stringify(m))}catch(a){console.log("Not able to store the data in local store: "+a.message)}}function f(){var a;try{var b=localStorage.getItem(c());a=JSON.parse(b)}catch(d){console.log("MessagesDiskManager.loadFromLocalStore: localStorage.getItem or JSON.parse error: "+d.message),a=null}m=a?h(a):{},n=!0}function h(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=[],e=a[c];e&&e.length&&e.forEach(function(a){d.push((new l.ChatMessage).initialize(a))}),b[c]=d}return b}var i=a,j=this,k=b,l=g.chatsdk;l.MessagesDiskManager.FAILED_MSGS_LSO_VERSION=1;var m={},n=!1;this.init=function(a,b){i=a,k=b},this.getMessagesForChatId=function(a){return n||f(),m[a]},this.processFailedMessages=function(a,b){var c=j.getMessagesForChatId(b.chatId);if(c&&c.length&&a.length){var e=a.concat(),f=1!=a[0].getSequenceNumber(),g=a[0].getTimestamp(),h=0,i=0,k=0;return b.messages&&b.messages.length?k=b.messages[0].getTimestamp():i=a[a.length-1].getTimestamp(),h=Math.max(k,i),c.forEach(function(a){var c=a.getTimestamp();c>=g?(h>=c||0==b.maxSequenceNumber||c>k)&&d(a,e,b.chatId):f||d(a,e,b.chatId)}),e}return a},this.saveMessageForChatId=function(a,b){if(a&&b){n||f();var c=m[b];c||(c=[],m[b]=c);for(var d=!1,g=c.length,h=0;g>h;h++){var i=c[h];if(i.messageId==a.messageId){d=!0;break}}d||(c.push(a),e())}},this.deleteMessageWithIdForChatId=function(a,b){n||f();var c=m[b];if(c){for(var d,g,h=c.length,i=0;h>i;++i)if(d=c[i],d.messageId==a){c.splice(i,1),g=!0;break}0==c.length&&delete m[b],g&&e()}}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.MessagesLoader=function(a,b,c,d,e,f){function h(a,b){a.c(k.CONVO_FILE,{xmlns:l.CONVO_FILE,name:b.name,size:b.size,width:b.width||0,height:b.height||0,type:b.type,thumbnail_name:b.thumbnailName?b.thumbnailName:"null",original_name:b.originalName,format:b.fileFormat,id:b.fileId,available_previews_x:b.availablePreviews,preview_name:b.previewName,number_of_pages:b.noOfPages})}function i(a){if(!a)return null;a=$(a);var b=new j.MessageFileInfo({name:j.ChatUtils.unescape(a.attr("name")),size:parseInt(a.attr("size")),width:parseInt(a.attr("width")),height:parseInt(a.attr("height")),type:a.attr("type"),thumbnailName:a.attr("thumbnail_name"),originalName:a.attr("original_name"),fileFormat:a.attr("format"),fileId:parseInt(a.attr("id")),availablePreviews:parseInt(a.attr("available_previews_x")),previewName:a.attr("preview_name"),noOfPages:a.attr("number_of_pages")});return b}g.chatsdk.MessagesLoader.MESSAGE_FETCH_PAGE_SIZE=20,this.MESSAGE_FETCH_PAGE_SIZE=g.chatsdk.MessagesLoader.MESSAGE_FETCH_PAGE_SIZE;var j=g.chatsdk,k=j.Constants.TAG,l=j.Constants.XMLNS,m={},n={},o=j.ComposingStatus,p=j.MessageType,q=j.ChatType,r=j.ParticipantStatus,s=j.ChatUtils;this.chatIdToChatMap=d,this.usersManager=a,this.timestampManager=b,this.chatsLoader=c,this.chatsLoader.addDelegate(this),this.delegates=[],this.messagesDiskManager=f,this.xmppCallsManager=e,this.chatIdToCallsMap={};var t=this;this.xmppCallsManager.addListener(j.ChatEvents.MESSAGE_RECEIVED,function(a){t.callsManagerReceivedMessage(a)}),this.xmppCallsManager.addListener(j.ChatEvents.GROUP_CHATS_ACK_RECEIVED,function(a){t.callsManagerGroupChatsAckReceived(a)}),this.xmppCallsManager.addListener(j.ChatEvents.MESSAGE_SEND_FAILED,function(a){t.callsManagerMessageSendFailed(a)}),this.xmppCallsManager.addListener(j.ChatEvents.MESSAGES_IQ_FAILED,function(a){t.callsManagerMessagesIqFailedForFirstFetch(a)}),this.xmppCallsManager.addListener(j.ChatEvents.MESSAGE_HISTORY_RECEIVED,function(a){t.processReceivedChatMessagesXML(a.query,a.iqId)}),this.sendMessage=function(a,b,c,d,e,f){var g=null;return b.participantForId(this.usersManager.getThisUser().userId).presenceStatus===r.LEFT?null:(b.chatType===q.P2P?g=this.sendMessageInP2PChat(a,b,c,d,e,f):b.chatType===q.GROUP&&(g=this.sendMessageInGroupChat(a,b,c,d,e,f)),g)},this.sendFakeMessage=function(a,b){var c=null;return c=this.sendFakeMessageInChat(a,b)},this.updateInviteChatFakeMessagesAsOriginal=function(a){for(var b=a.messages,c=0;c<b.length;c++)b[c].updateFakeChatMessageAsOriginal()},this.sendMessageInP2PChat=function(a,b,c,d,e,f){var g=new j.ChatMessage,i=this.usersManager.getThisUser();g.isRetrying=!0;var m=b.getOtherParticipant(i.userId),n=s.generateUniqueId();g.setInfo(n,i.userId,a,p.MESSAGE,this.timestampManager.UTCTimestamp(),0,c,!1,e),g.isRetrying=!0;var o={xmlns:l.CONVO_MESSAGE,chat_id:b.chatId,from_name:i.getDisplayName(),message_type:p.toString(p.MESSAGE),timestamp:g.getTimestamp(),for_user_id:m.userId,for_name:m.name};if(e&&(1==typeof e?o.is_system_message="1":("101"==e||"102"==e||"103"==e)&&(o.is_system_message=e,a=f)),null==c||c.status==j.FileStatus.FS_SUCCESS){var r=$msg({id:n,to:this.getConvoChatJid(),from:this.xmppCallsManager.getJid(),type:q.toString(q.P2P)}).c(k.BODY).t(a).up().c(k.CONVO_MESSAGE,o).up();g.fileInfo&&h(r,c),this.xmppCallsManager.sendMessage(r,n,!0,g.messageText)}g.fileInfo||this.messagesDiskManager.saveMessageForChatId(g,b.chatId);for(var t=this.delegates.length,u=0;t>u;u++){var v=this.delegates[u];"function"==typeof v.messagesLoaderSentMessageInChat&&v.messagesLoaderSentMessageInChat(g,b)}return g},this.sendMessageInGroupChat=function(a,b,c,d,e,f){var g=this.usersManager.getThisUser();d||(d=p.MESSAGE);var i=new j.ChatMessage;if(i.setInfo(s.generateUniqueId(),g.userId,a,d,this.timestampManager.UTCTimestamp(),0,c,!1,e),i.isRetrying=!0,!i.fileInfo||c.status==j.FileStatus.FS_SUCCESS){var m={xmlns:l.CONVO_MESSAGE,chat_id:b.chatId,message_type:p.toString(d),timestamp:i.getTimestamp(),from_name:g.getDisplayName()};d==p.CHAT_IMAGE_UPDATE&&(m.chat_icon=a),e&&("boolean"==typeof e?m.is_system_message="1":("101"==e||"102"==e||"103"==e)&&(m.is_system_message=e,a=f));var n=$msg({id:i.messageId,to:this.getConvoChatJid(),from:this.xmppCallsManager.getJid(),type:q.toString(q.GROUP)}).c(k.BODY).t(a).up().c(k.CONVO_MESSAGE,m).up();if(0==b.lastMessageSequenceNumber){n.c(k.PARTICIPANTS,{xmlns:l.PARTICIPANTS});for(var o in b.participants)if(b.participants.hasOwnProperty(o)){var r=b.participants[o];n.c(k.PARTICIPANT,{id:r.userId,name:r.name}).up()}n.up()}i.fileInfo&&h(n,c),this.xmppCallsManager.sendMessage(n,i.messageId,!0,i.messageText)}for(var t=this.delegates.length,u=0;t>u;u++){var v=this.delegates[u];"function"==typeof v.messagesLoaderSentMessageInChat&&v.messagesLoaderSentMessageInChat(i,b)}return i.fileInfo||this.messagesDiskManager.saveMessageForChatId(i,b.chatId),i},this.sendFakeMessageInChat=function(a,b){var c=this.usersManager.getThisUser(),d=new j.ChatMessage;d.setInfo(s.generateUniqueId(),c.userId,a,p.MESSAGE,this.timestampManager.UTCTimestamp(),0,null,!0);for(var e=this.delegates.length,f=0;e>f;f++){var g=this.delegates[f];"function"==typeof g.messagesLoaderSentMessageInChat&&g.messagesLoaderSentFakeMessageInChat(d,b)}return d},this.cancelMessageInChat=function(a,b){this.messagesDiskManager.deleteMessageWithIdForChatId(a.messageId,b.chatId)},this.reSendMessageInChat=function(a,b,c){var d=this.usersManager.getThisUser(),g=b.participantForId(d.userId);if(g.status!=r.LEFT&&(a.isRetrying=!0,a.setTimestamp(this.timestampManager.UTCTimestamp()),!a.fileInfo||!a.fileInfo.isUploading)){var i=$msg({id:a.messageId,to:this.getConvoChatJid(),from:this.xmppCallsManager.getJid(),type:q.toString(q.P2P)}).c(k.BODY).t(a.messageText).up(),j={xmlns:l.CONVO_MESSAGE,chat_id:b.chatId,from_name:d.getDisplayName(),message_type:c?p.toString(p.RETRY):p.toString(p.MESSAGE),timestamp:a.getTimestamp()};if(b.chatType==q.P2P){var m=b.getOtherParticipant();j.for_user_id=m.userId,j.for_name=m.name}else if(i.attrs({type:q.toString(q.GROUP)}),0==b.lastMessageSequenceNumber){i.c(k.PARTICIPANTS,{xmlns:l.PARTICIPANTS});for(var n in b.participants)if(b.participants.hasOwnProperty(n)){var o=b.participants[n];i.c(k.PARTICIPANT,{id:o.userId,name:o.name}).up()}i.up()}if(i.c(k.CONVO_MESSAGE,j).up(),a.fileInfo&&!a.fileInfo.isUploading&&h(i,a.fileInfo),e.sendMessage(i,a.messageId,!0,a.messageText),f.deleteMessageWithIdForChatId(a.messageId,b.chatId),a.fileInfo||f.saveMessageForChatId(a,b.chatId),c){a.clientTimestamp=a.getTimestamp(),b.removeMessage(a);for(var s=this.delegates.length,t=0;s>t;t++){var u=this.delegates[t];"function"==typeof u.messagesLoaderSentMessageInChat&&u.messagesLoaderSentMessageInChat(a,b)}}}},this.addDelegate=function(a){this.delegates.push(a)},this.callsManagerReceivedMessage=function(a){a=$(a);var b=a.find(k.CONVO_MESSAGE);if(!b.length)return void console.warn("callsManagerReceivedMessage: no convoMessageExtension found");var c=p.fromMessageElement(b),d=+b.attr("unread_chats_count");if(d||0===d)for(var e=parseInt(b.attr("unread_chats_count_timestamp")),f=this.delegates.length,g=b.attr("chat_id"),h=0;f>h;h++){var i=this.delegates[h];"function"==typeof i.updateUnreadChatsCount&&i.updateUnreadChatsCount(d,e,c,g)}c==p.RECIPIENT_ACK?this.xmppMessageAckReceived(a,b):a.attr("type")==q.toString(q.GROUP)?this.groupMessageReceived(a,b):c==p.MESSAGE?this.xmppMessageReceived(a,b):c==p.TYPING&&this.composingXMPPMessageReceived(a,b)},this.xmppMessageAckReceived=function(a,b){var c=s.makeUserIdFromJid(a.attr("from")),d=this.chatIdToChatMap[b.attr("chat_id")];if(d)if(c==this.usersManager.getThisUser().userId)for(var e=this.delegates.length,f=0;e>f;f++){var g=this.delegates[f];"function"==typeof g.messagesLoaderReceivedUnreadCountForChat&&g.messagesLoaderReceivedUnreadCountForChat(d,b.attr("unread_count"))}else if(d.chatType==q.P2P){var h=parseInt(b.attr("sequence_number")),i=d.participantForId(c);if(i)d.updateParticipantLastSeenMessageSequenceNumber(i.userId,h);else try{var j=this.usersManager.getUserById(c),k=j?j.getDisplayName():"UserNotFound";console.error("xmppMessageAckReceived:"+k+", userId:"+c+" not found in chat ID:"+d.chatId+", Title:"+d.getTitle()),console.error("Total users in users manager:"+this.usersManager.getUsers().length),console.error("Participants in chat: "+JSON.stringify(_.values(d.participants)))}catch(l){console.error(l.stack)}var m=d.messageForId(a.attr("id"));if(m){0==m.getSequenceNumber()&&(m.setSequenceNumber(h),this.xmppMessageReceived(a,b));for(var e=this.delegates.length,f=0;e>f;f++){var g=this.delegates[f];"function"==typeof g.messagesLoaderMessageReadInChatByParticipant&&g.messagesLoaderMessageReadInChatByParticipant(m,d,i)}}}},this.callsManagerGroupChatsAckReceived=function(a){a=$(a);var b=a.find(k.CHATS).find(k.CHAT);if(!b.length)return void console.warn("callsManagerReceivedMessage: no chats found");for(var c,d,e,f,g,h,i,j,l=0;l<b.length;l++)if(c=$(b[l]),f=c.attr("id"),g=this.chatIdToChatMap[f]){var m=[];d=c.find(k.PARTICIPANTS).find(k.PARTICIPANT);for(var n=0;n<d.length;n++)e=$(d[n]),h=e.attr("id"),j=parseInt(e.attr("sequence_number")),i=g.updateParticipantLastSeenMessageSequenceNumber(h,j),i&&m.push(i);this.delegates.forEach(function(a){"function"==typeof a.messagesLoaderReceivedAcksInGroupChat&&a.messagesLoaderReceivedAcksInGroupChat(g,m)})}},this.groupMessageReceived=function(a,b){console.log("sfaiz.debug - groupMessageReceived -- xmppMessage="+a+", convoMessage="+b);var c=p.fromMessageElement(b);if(c==p.INVITE||c==p.LEFT||c==p.MESSAGE||c==p.CHAT_TITLE_UPDATE||c==p.CHAT_IMAGE_UPDATE||c==p.PARTICIPANT_REMOVED){var d,e,f,g=s.makeUserIdFromJid(a.attr("from")),h=this.usersManager.getUserById(g),l=h?h.getDisplayName():b.attr("from_name"),m=this.usersManager.getThisUser(),n=parseInt(b.attr("sequence_number")),o="",u=b.attr("chat_id"),v=this.chatIdToChatMap[u],w=!1,x=this.timestampManager.UTCTimestamp(),y=parseInt(b.attr("timestamp")),z=!1,A=b.attr("removed_user");if(v){var B=v.participantForId(m.userId),C=v.participantForId(g);B||v.addParticipant(new j.ChatParticipant(m.userId,m.getDisplayName(),r.JOINED,0,x)),C||(f=r.JOINED,c==p.LEFT&&(f=r.LEFT),v.addParticipant(new j.ChatParticipant(g,l,f,n,x))),g!==m.userId&&t.usersManager.addInaccessibleUser(g,l)}else{w=!0,v=new j.Chat,v.setPartialInfo(u,q.GROUP,y,n,!1,m);var D=a.find(k.PARTICIPANTS);if(D.length){var E=D.find(k.PARTICIPANT);E.length&&E.each(function(){var a=$(this),b=a.attr("id");d=t.usersManager.getUserById(b),d||(d=t.usersManager.addInaccessibleUser(b,a.attr("name")));var c=d.getDisplayName();v.addParticipant(new j.ChatParticipant(b,c,r.JOINED,b===g?n:0,x))})}else this.chatsLoader.loadChat(v.chatId),e=!0,f=r.JOINED,c==p.LEFT&&(f=r.LEFT),v.addParticipant(new j.ChatParticipant(g,l,f,n,x)),g!==m.userId&&(t.usersManager.addInaccessibleUser(g,l),v.addParticipant(new j.ChatParticipant(m.userId,m.getDisplayName(),r.JOINED,0,x)));this.chatIdToChatMap[v.chatId]=v}var F=i(a.find(k.CONVO_FILE)[0]);F&&(F.itemId=v.chatId);var G=a.attr("id"),H=v.messageForId(G),I=null;if(!H)if(c==p.INVITE){z=!0;var J=a.find(k.INVITEES);if(J.length){var K=J.find(k.INVITEE);I={},K.each(function(){var a=$(this),b=a.attr("id");I[b]=a.attr("name"),o=o?o+","+b:b})}}else o=c==p.LEFT?"left":a.find(k.BODY).text();var L;if(H)H.isRetrying=!1,H=H.copy(),H.getSequenceNumber()!=n&&(H.setSequenceNumber(n),H.setTimestamp(y)),H.type==p.PARTICIPANT_REMOVED&&(H.messageText=a.find(k.BODY).text());else{L=!0;var M,N=b.attr("is_system_message");"1"==N?M="1":("101"==N||"102"==N||"103"==N)&&(M=N),H=new j.ChatMessage,H.setInfo(G,g,o,c,y,n,F,!1,M),H.invitees=I,H.clientTimestamp=this.timestampManager.UTCTimestamp()}if(H.removedParticipant=A,w?e?v.addMessage(H):this.processGroupMessage(H,v):(this.processMessagesForMissedMessages([H],v),L||this.processGroupMessage(H,v)),c==p.CHAT_TITLE_UPDATE&&(o=a.find(k.BODY).text(),o&&o.length>0&&(v.clearOldTitle(),v.getOriginalTitle()!=o&&(v.setTitle(o),this.delegates.forEach(function(a){"function"==typeof a.updatedChat&&a.updatedChat(v)})))),c==p.CHAT_IMAGE_UPDATE){var O=b.attr("chat_icon_version");v.getIconVersion()!=O&&(v.setIconVersion(O),this.delegates.forEach(function(a){"function"==typeof a.updatedChat&&a.updatedChat(v)}))}!w&&z&&this.chatsLoader.loadChat(v.chatId)}},this.processGroupMessage=function(a,b){a.type==p.PARTICIPANT_REMOVED&&console.log("sfaiz.debug - processGroupMessage: text="+a.messageText);var c=this.usersManager.getThisUser(),d=a.type==p.LEFT||a.type==p.PARTICIPANT_REMOVED?r.LEFT:r.JOINED,e=r.JOINED;if(a.senderId!=c.userId){if(!b.participantForId(a.senderId)){var g=this.usersManager.getUserById(a.senderId),h=g?g.getDisplayName():null;b.addParticipant(new j.ChatParticipant(a.senderId,h,d,a.getSequenceNumber(),a.getTimestamp()))}}else e=d;null!=b.participantForId(c.userId)||s.isAdminModeONAndOrThisUserIsNotInChatParticipants(b)||b.addParticipant(new j.ChatParticipant(c.userId,c.getDisplayName(),e,a.senderId===c.userId?a.getSequenceNumber():0,a.getTimestamp())),b.updateLastMessageSequenceNumber(a.getSequenceNumber());var i=a.senderId;b.updateParticipantLastSeenMessageSequenceNumber(i,a.getSequenceNumber());var k=b.messageForId(a.messageId);null==k&&(a.type==p.INVITE?this.updateParticipantsForChatForInviteMessage(b,a,!0):a.type==p.LEFT?this.updateParticipantsForChatForLeaveMessage(b,a,!0):a.type==p.PARTICIPANT_REMOVED&&this.updateChatParticipantsForRemoveMessage(b,a,!0)),a.type==p.CHAT_TITLE_UPDATE?(b.clearOldTitle(),b.getOriginalTitle()!=a.messageText&&(b.setTitle(a.messageText),this.delegates.forEach(function(a){"function"==typeof a.updatedChat&&a.updatedChat(b)}))):a.type==p.MESSAGE&&b.updateLastMessage(a.messageText,a.senderId),k?k.getSequenceNumber()!=a.getSequenceNumber&&(k.setSequenceNumber(a.getSequenceNumber()),k.setTimestamp(a.getTimestamp()),this.delegates.forEach(function(a){"function"==typeof a.messagesLoaderSentMessageReceivedAtServerInChat&&a.messagesLoaderSentMessageReceivedAtServerInChat(k,b)}),n[b.chatId]=k.getSequenceNumber(),f.deleteMessageWithIdForChatId(k.messageId,b.chatId)):(this.delegates.forEach(function(c){"function"==typeof c.messagesLoaderReceivedMessageInChat&&c.messagesLoaderReceivedMessageInChat(a,b)}),n[b.chatId]=a.getSequenceNumber())},this.updateParticipantsForChatForInviteMessage=function(a,b,c){if(b.type==p.INVITE&&b.invitees){var d;for(var e in b.invitees)if(b.invitees.hasOwnProperty(e))if(d=a.participantForId(e))d.status==r.LEFT&&(d.status=r.JOINED);else{var f=this.usersManager.getUserById(e),g=f?f.getDisplayName():b.invitees[e];f||this.usersManager.addInaccessibleUser(e,g),d=new j.ChatParticipant(e,g,r.JOINED,0,b.getTimestamp()),a.addParticipant(d)}a.setComputedTitle(null),c&&this.delegates.forEach(function(b){"function"==typeof b.messagesLoaderUpdatedChat&&b.messagesLoaderUpdatedChat(a)})}},this.updateParticipantsForChatForLeaveMessage=function(a,b,c){if(b.type==p.LEFT){var d=a.participantForId(b.senderId);d&&d.status!=r.LEFT&&(d.status=r.LEFT,this.delegates.forEach(function(b){"function"==typeof b.participantEndedComposingInChat&&b.participantEndedComposingInChat(d,a)}),a.setComputedTitle(null),c&&this.delegates.forEach(function(b){"function"==typeof b.messagesLoaderUpdatedChat&&b.messagesLoaderUpdatedChat(a)}))}},this.updateChatParticipantsForRemoveMessage=function(a,b,c){if(b.type==p.PARTICIPANT_REMOVED&&b.removedParticipant&&b.removedParticipant.length>0){var d=a.participantForId(b.removedParticipant);d&&d.status!=r.LEFT&&(d.status=r.LEFT,this.delegates.forEach(function(b){"function"==typeof b.participantEndedComposingInChat&&b.participantEndedComposingInChat(d,a)}),a.setComputedTitle(null),b.removedParticipant===this.usersManager.getThisUser().userId&&this.delegates.forEach(function(b){"function"==typeof b.clearAllComposingInChat&&b.clearAllComposingInChat(a)}),c&&this.delegates.forEach(function(b){"function"==typeof b.messagesLoaderUpdatedChat&&b.messagesLoaderUpdatedChat(a)}))}},this.xmppMessageReceived=function(a,b){var c=b.attr("chat_id"),d=this.usersManager.getThisUser(),e=b.attr("for_user_id"),f=this.usersManager.getUserById(e),g=f?f.getDisplayName():b.attr("for_name"),h=s.makeUserIdFromJid(a.attr("from"));f=this.usersManager.getUserById(h);var l=f?f.getDisplayName():b.attr("from_name"),m=this.chatIdToChatMap[c],n=!1,o=a.find(k.BODY).text(),t=parseInt(b.attr("timestamp")),u=parseInt(b.attr("sequence_number"));null==m?(m=new j.Chat,m.setInfo(c,null,null,q.P2P,0,t,u,!1,d),m.addParticipant(new j.ChatParticipant(e,g,r.JOINED,0,t)),m.addParticipant(new j.ChatParticipant(h,l,r.JOINED,u,t)),this.chatIdToChatMap[m.chatId]=m,n=!0):0===Object.keys(m.participants).length&&(m.addParticipant(new j.ChatParticipant(e,g,r.JOINED,0,t)),m.addParticipant(new j.ChatParticipant(h,l,r.JOINED,u,t)));var v=i(a.find(k.CONVO_FILE)[0]);v&&(v.itemId=m.chatId);var w=a.attr("id"),x=m.messageForId(w),y=!1;if(x)x=x.copy(),x.getSequenceNumber()!=u&&(x.setSequenceNumber(u),x.setTimestamp(t));else{y=!0;var z,A=b.attr("is_system_message");"1"==A?z="1":("101"==A||"102"==A||"103"==A)&&(z=A),x=new j.ChatMessage,x.setInfo(w,h,o,p.MESSAGE,t,u,v,!1,z),x.clientTimestamp=this.timestampManager.UTCTimestamp()}n?this.processP2PMessage(x,m):(this.processMessagesForMissedMessages([x],m),y||this.processP2PMessage(x,m))},this.composingXMPPMessageReceived=function(a,b){var c=s.makeUserIdFromJid(a.attr("from"));if(c!=this.usersManager.getThisUser.userId){var d=b.attr("chat_id"),e=o.fromString(b.attr("action"));e&&(e=parseInt(e));var f=this.chatIdToChatMap[d];if(f){var g=f.participantForId(c);g&&this.delegates.forEach(function(a){"function"==typeof a.messagesLoaderReceivedComposingMessageForChatFromParticipant&&a.messagesLoaderReceivedComposingMessageForChatFromParticipant(f,g,e)})}}},this.processP2PMessage=function(a,b){b.updateLastMessageSequenceNumber(a.getSequenceNumber());var c=a.senderId;b.updateParticipantLastSeenMessageSequenceNumber(c,a.getSequenceNumber());var d=b.messageForId(a.messageId);if(d){if(d.getSequenceNumber()!=a.getSequenceNumber()){d.setSequenceNumber(a.getSequenceNumber()),d.setTimestamp(a.getTimestamp());for(var e=this.delegates.length,g=0;e>g;g++){var h=this.delegates[g];"function"==typeof h.messagesLoaderSentMessageReceivedAtServerInChat&&h.messagesLoaderSentMessageReceivedAtServerInChat(d,b)}n[b.chatId]=d.getSequenceNumber(),f.deleteMessageWithIdForChatId(d.messageId,b.chatId)}}else{for(var e=this.delegates.length,g=0;e>g;g++){var h=this.delegates[g];"function"==typeof h.messagesLoaderReceivedMessageInChat&&h.messagesLoaderReceivedMessageInChat(a,b)}n[b.chatId]=a.getSequenceNumber()}},this.chatOpened=function(a){if(!a.isLoadingInProgress){var b,c=s.generateUniqueId();if(s.isAdminModeON()||0==a.unreadCount||a.unreadCount<=this.MESSAGE_FETCH_PAGE_SIZE)b={from_index:1,to_index:t.MESSAGE_FETCH_PAGE_SIZE};else{var d=a.participantForId(this.usersManager.getThisUser().userId);b={from_sequence_number:d.lastSeenMessageSequenceNumber+1,to_sequence_number:a.lastMessageSequenceNumber}}var e=$iq({to:t.getConvoChatJid(),type:"get",id:c}).c(k.QUERY,{xmlns:l.HISTORY_MESSAGES}).c(k.CHAT,{id:a.chatId}).c(k.RANGE,b);this.xmppCallsManager.sendIQ(e,c,!0),a.isLoadingInProgress=!0}},this.processReceivedChatMessagesXML=function(a,b){var c,d=[];a=$(a),a.find(k.MESSAGE).each(function(){var a=$(this),b=$(a.find(k.CONVO_MESSAGE)[0]);c||(c=b.attr("chat_id"));var e=a.attr("id"),f=a.attr("from"),g=s.makeUserIdFromJid(f),h=a.find(k.BODY).text(),l=(b.attr("from_name"),parseInt(b.attr("sequence_number"))),m=p.fromMessageElement(b),n=parseInt(b.attr("timestamp")),o=i(a.find(k.CONVO_FILE)[0]);o&&(o.itemId=c);var q=b.attr("is_system_message");q=q&&q.length?parseInt(q):0;var r=q>0?!0:!1,t=new j.ChatMessage;if(t.setInfo(e,g,h,m,n,l,o,!1,r),m==p.INVITE){var u={};a.find(k.INVITEE).each(function(){var a=$(this);u[a.attr("id")]=a.attr("name")}),t.invitees=u}d.push(t)});var e=c?this.chatIdToChatMap[c]:null;if(0==d.length)return void(e&&(e.isLoadingInProgress=!1));if(s.sortMessages(d),e)if(m[b]){delete m[b];for(var f=this.delegates.length,g=0;f>g;g++){var h=this.delegates[g];"function"==typeof h.messagesLoaderLoadedHistoryMessagesInChat&&h.messagesLoaderLoadedHistoryMessagesInChat(d,e,!0,b)}}else{var l=a.find(k.RANGE);d[d.length-1].sequenceNumber<e.minSequenceNumber||0==e.maxSequenceNumber||l.length&&l.attr("from_index")&&e.isFetchingRecentMessagesForMissedMessages?this.processMessages(d,e,!0,!1,null):this.processMessagesForMissedMessages(d,e)}},this.inviteUsersInChat=function(a,b){var c;if(b.chatType==q.GROUP&&a&&a.length){var d=this.timestampManager.UTCTimestamp(),f=this.usersManager.getThisUser();if(0==b.lastMessageSequenceNumber&&0==b.messages.length){
var g;a.forEach(function(a){g=b.participantForId(a.userId),g?g.status==r.LEFT&&(g.status=r.JOINED,g.statusTimestamp=d,c=!0,b.setComputedTitle(null)):(b.addParticipant(new j.ChatParticipant(a.userId,a.getDisplayName(),r.JOINED,0,d)),c=!0)},this)}else{var h="",i=[];a.forEach(function(a){g=b.participantForId(a.userId),g&&g.status!=r.LEFT||(g?(g.status=r.JOINED,g.statusTimestamp=d,b.setComputedTitle(null)):b.addParticipant(new j.ChatParticipant(a.userId,a.getDisplayName(),r.JOINED,0,d)),c=!0,h=h?h+","+a.userId:a.userId,i.push({id:a.userId,name:a.getDisplayName()}))});var m=new j.ChatMessage;m.setInfo(s.generateUniqueId(),f.userId,h,p.INVITE,d,0),b.addMessage(m);var n={xmlns:l.CONVO_MESSAGE,chat_id:b.chatId,message_type:p.toString(m.type),timestamp:m.getTimestamp(),from_name:f.getDisplayName()},o=$msg({id:m.messageId,to:this.getConvoChatJid(),from:this.xmppCallsManager.getJid(),type:q.toString(q.GROUP)}).c(k.BODY).t(m.messageText).up().c(k.CONVO_MESSAGE,n).up(),t={};o.c(k.INVITEES),i.forEach(function(a){o.c(k.INVITEE,a).up(),t[a.id]=a.name}),m.invitees=t,e.sendMessage(o,m.messageId,!0),this.delegates.forEach(function(a){"function"==typeof a.messagesLoaderSentMessageInChat&&a.messagesLoaderSentMessageInChat(m,b)})}this.delegates.forEach(function(a){"function"==typeof a.messagesLoaderUpdatedChat&&a.messagesLoaderUpdatedChat(b)})}},this.leaveChat=function(a){if(a.chatType!=q.P2P){var b=this.usersManager.getThisUser(),c=a.participantForId(b.userId);if(c.status!=r.LEFT){if(c.status=r.LEFT,this.delegates.forEach(function(b){"function"==typeof b.clearAllComposingInChat&&b.clearAllComposingInChat(a)}),0==a.lastMessageSequenceNumber&&0==a.messages.length)delete this.chatIdToChatMap[a.chatId];else{var d=new j.ChatMessage;d.setInfo(s.generateUniqueId(),b.userId,"left",p.LEFT,this.timestampManager.UTCTimestamp(),0),a.addMessage(d);var f={xmlns:l.CONVO_MESSAGE,chat_id:a.chatId,message_type:p.toString(d.type),timestamp:d.getTimestamp(),from_name:b.getDisplayName()},g=$msg({id:d.messageId,to:this.getConvoChatJid(),type:q.toString(q.GROUP)}).c(k.BODY).t(d.messageText).up().c(k.CONVO_MESSAGE,f).up();e.sendMessage(g,d.messageId,d.type),this.delegates.forEach(function(b){"function"==typeof b.messagesLoaderSentMessageInChat&&b.messagesLoaderSentMessageInChat(d,a)})}this.delegates.forEach(function(b){"function"==typeof b.messagesLoaderUpdatedChat&&b.messagesLoaderUpdatedChat(a)})}}},this.removeParticipantFromChat=function(a,b){if(a.chatType!=q.P2P){var c=this.usersManager.getThisUser(),d=a.participantForId(b);if(!d||d.status!=r.LEFT){d.status=r.LEFT;var f=new j.ChatMessage;f.setInfo(s.generateUniqueId(),c.userId,b,p.PARTICIPANT_REMOVED,this.timestampManager.UTCTimestamp(),0),f.isSystemMessage=!0;var g={xmlns:l.CONVO_MESSAGE,chat_id:a.chatId,message_type:p.toString(f.type),timestamp:f.getTimestamp(),from_name:c.getDisplayName()},h=$msg({id:f.messageId,to:this.getConvoChatJid(),type:q.toString(q.GROUP)}).c(k.BODY).t(f.messageText).up().c(k.CONVO_MESSAGE,g).up();e.sendMessage(h,f.messageId,f.type)}}},this.markMessageFailedInChat=function(a,b){if(b&&a){a.isSendingInProgress=!1;var c=b.messages.map(function(a){return a.messageId}).indexOf(a.messageId);if(-1!=c)for(var d=this.delegates.length,e=0;d>e;e++){var f=this.delegates[e];"function"==typeof f.messagesLoaderMessageSendFailedAtIndexInChat&&f.messagesLoaderMessageSendFailedAtIndexInChat(a,c,b)}}},this.processMessages=function(a,b,c,d,e){if(b){var f;if(a&&a.length&&(f=a[a.length-1].getSequenceNumber()),c)a=this.messagesDiskManager.processFailedMessages(a,b),this.delegates.forEach(function(c){"function"==typeof c.messagesLoaderLoadedHistoryMessagesInChat&&c.messagesLoaderLoadedHistoryMessagesInChat(a,b,!1,null)});else{var g,h=0;if(d)for(var i=a.length,j=i-1;j>=0;--j){g=a[j];var k=this.usersManager.getThisUser().userId;if(g.senderId==k||g.getSequenceNumber()<=b.maxSequenceNumber)break;(g.type==p.MESSAGE||g.type==p.INVITE&&g.invitees[k])&&++h}for(var l=this.delegates.length,j=0;l>j;j++){var m=this.delegates[j];"function"==typeof m.messagesLoaderLoadedNewerMessagesInChat&&m.messagesLoaderLoadedNewerMessagesInChat(a,b,h)}}n[b.chatId]=f,b.isLoadingInProgress=!1}},this.thisUserComposingInChat=function(a,b){var c=s.generateUniqueId(),d=$msg({id:c,to:this.getConvoChatJid(),from:this.xmppCallsManager.getJid(),type:q.toString(q.P2P)}).c(k.CONVO_MESSAGE,{xmlns:l.CONVO_MESSAGE,chat_id:a.chatId,message_type:p.toString(p.TYPING),action:o.toString(b)});this.xmppCallsManager.sendMessage(d,c,!1)},this.getConvoChatJid=function(){return this._convoChatJid||(this._convoChatJid="convochat@"+this.xmppCallsManager.getDomain()),this._convoChatJid},this.loadOlderMessagesInChat=function(a){if(a.isLoadingInProgress)return!1;var b=a.minSequenceNumber;if(b>1){a.isLoadingInProgress=!0;var c=Math.max(1,b-this.MESSAGE_FETCH_PAGE_SIZE),d=b-1;this.loadMessagesInChat(a,c,d,!0,!1)}return a.isLoadingInProgress},this.loadMessagesInChat=function(a,b,c,d,e){var f=s.generateUniqueId();b=Math.max(1,b);var g;g=d?{from_sequence_number:b,to_sequence_number:c}:{from_index:1,to_index:this.MESSAGE_FETCH_PAGE_SIZE};var h=$iq({to:t.getConvoChatJid(),type:"get",id:f}).c(k.QUERY,{xmlns:l.HISTORY_MESSAGES}).c(k.CHAT,{id:a.chatId}).c(k.RANGE,g);return this.xmppCallsManager.sendIQ(h,f,!0),e&&(m[f]=!0),f},this.messageReadInChat=function(a,b){if(!a||a.senderId!=this.usersManager.getThisUser().userId){var c={xmlns:l.CONVO_MESSAGE,chat_id:b.chatId,message_type:p.toString.call(p,p.RECIPIENT_ACK)},d=q.toString(b.chatType);if(b.chatType==q.P2P){var e=b.getOtherParticipant();c.for_user_id=e.userId,c.for_name=e.name}var f,h={to:this.getConvoChatJid(),from:this.xmppCallsManager.getJid(),type:d};a?(c.timestamp=a.getTimestamp(),c.sequence_number=a.getSequenceNumber(),h.id=a.messageId,f=a.messageId):(f=g.chatsdk.ChatUtils.generateUniqueId(),c.sequence_number=b.lastMessageSequenceNumber,h.id=f);var i=$msg(h).c(k.CONVO_MESSAGE,c);this.xmppCallsManager.sendMessage(i,f,!0)}},this.passMessagesInChat=function(a,b){var c=[],d=[];a.forEach(function(a){var e=b.messageForId(a.messageId);e&&0!=e.getSequenceNumber()||(c.push(a),(a.type==p.INVITE||a.type==p.LEFT||a.type==p.CHAT_TITLE_UPDATE||a.type==p.PARTICIPANT_REMOVED)&&d.push(a))}),c.length&&this.addMessagesInChatWithInviteLeaveMessages(c,b,d),b.isLoadingInProgress=!1},this.addMessagesInChatWithInviteLeaveMessages=function(a,b,c){var d=a.length,e=a[d-1];if(d>1||e.getSequenceNumber()<b.lastMessageSequenceNumber){var f=!1,g=!1;if(e.getSequenceNumber()>b.lastMessageSequenceNumber&&(0==b.messages.length||0!=b.messages[b.messages.length-1].getSequenceNumber())&&(a.splice(d-1,1),f=!0),b.chatType==q.GROUP&&c.length){f&&c[c.length-1]==e&&(c.splice(c.length-1,1),e.type==p.INVITE&&e.invitees&&e.invitees[this.usersManager.getThisUser().userId]&&(g=!0));var h=!1;c.forEach(function(a){a.type==p.INVITE?this.updateParticipantsForChatForInviteMessage(b,a,!1):a.type==p.LEFT?this.updateParticipantsForChatForLeaveMessage(b,a,!1):a.type==p.PARTICIPANT_REMOVED?this.updateChatParticipantsForRemoveMessage(b,a,!0):f&&a.type==p.CHAT_TITLE_UPDATE&&(b.clearOldTitle(),b.getOriginalTitle()!=a.messageText&&(b.setTitle(a.messageText),h=!0))},this),h&&this.delegates.forEach(function(a){"function"==typeof a.updatedChat&&a.updatedChat(b)})}e.getSequenceNumber()<b.minSequenceNumber?this.processMessages(a,b,!0,!1,c):f&&!g?this.processMessages(a,b,!1,!0,c):this.processMessages(a,b,!1,!1,c),f&&(b.chatType==q.GROUP?this.processGroupMessage(e,b):b.chatType==q.P2P&&this.processP2PMessage(e,b))}else 1==d&&(b.chatType==q.P2P?this.processP2PMessage(a[0],b):this.processGroupMessage(a[0],b))},this.addFetchCall=function(a,b,c,d){this.sendFetchCallToServerForChat(d,a,b);var e=new g.chatsdk.MessagesFetchCall(c,a,b),f=this.chatIdToCallsMap[d.chatId];f||(this.chatIdToCallsMap[d.chatId]=f=[]),f.push(e)},this.sendFetchCallToServerForChat=function(a,b,c){var d=s.generateUniqueId(),e=$iq({to:t.getConvoChatJid(),type:"get",id:d}).c(k.QUERY,{xmlns:l.HISTORY_MESSAGES}).c(k.CHAT,{id:a.chatId}).c(k.RANGE,{from_sequence_number:b,to_sequence_number:c});this.xmppCallsManager.sendIQ(e,d)},this.fetchChatMessagesforChat=function(a,b){if(b||!a.isLoadingInProgress){var c=!1,d=0,e=0;if(0!==a.unreadCount&&a.unreadCount>this.MESSAGE_FETCH_PAGE_SIZE){c=!0;var f=a.participantForId(this.usersManager.getThisUser().userId);d=f.lastSeenMessageSequenceNumber+1,e=a.lastMessageSequenceNumber}this.loadMessagesInChat(a,d,e,c,!1),a.isLoadingInProgress=!0}},this.processMessagesForMissedMessages=function(a,b){if(a&&0!=a.length&&b&&!b.isFetchingRecentMessagesForMissedMessages){var c,d=a.length,e=this.chatIdToCallsMap[b.chatId],f=a[0].getSequenceNumber(),g=a[d-1].getSequenceNumber();if(g<b.maxSequenceNumber&&(!e||0==e.length)||b.maxSequenceNumber<1)this.passMessagesInChat(a,b);else if(e&&0!=e.length){for(var h,i,j=e.length,k=0;j>k;k++){var l=e[k];if(l.getMaxSequenceNoOfMessages()>f){h=l;break}}var m=!1;if(h||(c=e[j-1],c.getMaxSequenceNoOfMessages()+1>=f&&(h=c,m=!0)),h){var o=[],p=[];if(a.forEach(function(a){a.getSequenceNumber()<=h.getMaxSequenceNoOfMessages()||m?o.push(a):p.push(a)}),h.insertMessages(o),p.length&&!i){var q=e.map(function(a){a.getMaxSequenceNoOfMessages()}).indexOf(h.getMaxSequenceNoOfMessages()),r=q+1;r>=e.length&&(r=q),i=e[r],i.insertMessages(p)}h.getMaxSequenceNoOfMessages()==e[0].getMaxSequenceNoOfMessages()&&h.allMessagesReceived()&&this.startDequeingMessagesFromCallsForChat(b)}else c=e[e.length-1],this.addFetchCall(c.getMaxSequenceNoOfMessages()+1,f-1,a,b)}else{var s=n[b.chatId];if(b.maxSequenceNumber+1<f&&(!s||f>s+1))if(b.maxSequenceNumber+50<f&&(!s||f>s+50))console.debug("Detected 50+ missed messages, will load top 20 only"),b.isFetchingRecentMessagesForMissedMessages=!0,a.length==this.MESSAGE_FETCH_PAGE_SIZE&&g===b.lastMessageSequenceNumber?this.processMessages(a,b,!0,!1,null):this.fetchChatMessagesforChat(b,!0);else{var t=b.maxSequenceNumber+1,u=f-1;this.addFetchCall(t,u,a,b)}else this.passMessagesInChat(a,b)}}},this.chatsLoaderReceivedXMLMessagesForChat=function(a,b){if(a=$(a),a.length){var c=[];a.find(k.MESSAGE).each(function(){var a=$(this),d=a.find(k.CONVO_MESSAGE),e=a.attr("id"),f=s.makeUserIdFromJid(a.attr("from")),g=a.find(k.BODY).text(),h=(d.attr("from_name"),parseInt(d.attr("sequence_number"))),l=p.fromMessageElement(d),m=parseInt(d.attr("timestamp")),n=i(a.find(k.CONVO_FILE)[0]);n&&(n.itemId=b.chatId);var o=d.attr("is_system_message");o=o&&o.length?parseInt(o):0;var q=o>0?!0:!1,r=new j.ChatMessage;if(r.setInfo(e,f,g,l,m,h,n,!1,q),l==p.INVITE){var t=a.find(k.INVITEES);if(t.length){var u={};t.find(k.INVITEE).each(function(){var a=$(this);u[a.attr("id")]=a.attr("name")}),r.invitees=u}}c.push(r)});var d=c.length;d&&(s.sortMessages(c),this.processMessagesForMissedMessages(c,b))}},this.chatsLoaderReceiveHeartBeatXMLMessagesForChat=function(a,b,c){if(a.length){var d=[];a.find(k.MESSAGE).each(function(){var a=$(this),c=a.find(k.CONVO_MESSAGE),e=a.attr("id"),f=s.makeUserIdFromJid(a.attr("from")),g=a.find(k.BODY).text(),h=(c.attr("from_name"),parseInt(c.attr("sequence_number"))),l=p.fromMessageElement(c),m=parseInt(c.attr("timestamp")),n=i(a.find(k.CONVO_FILE)[0]);n&&(n.itemId=b.chatId);var o=c.attr("is_system_message");o=o&&o.length?parseInt(o):0;var q=o>0?!0:!1,r=new j.ChatMessage;if(r.setInfo(e,f,g,l,m,h,n,!1,q),l==p.INVITE){var t=a.find(k.INVITEES);if(t.length){var u={};t.find(k.INVITEE).each(function(){var a=$(this);u[a.attr("id")]=a.attr("name")}),r.invitees=u}}d.push(r)});var e=d.length;if(e){s.sortMessages(d);var f=d[e-1];f.skipUnreadCount=!0;var g=this.usersManager.getThisUser().userId,h=b.participantForId(g);c&&(f.senderId==g||f.getSequenceNumber()<=h.lastSeenMessageSequenceNumber)&&(f.skipNotification=!0),this.processMessagesForMissedMessages(d,b)}}},this.startDequeingMessagesFromCallsForChat=function(a){var b=this.chatIdToCallsMap[a.chatId];if(b){var c=[],d=[];if(b.forEach(function(a){(a.allMessagesReceived()||a.hasFailedLoading)&&(c=c.concat(a.messages),d.push(a))}),c.length){this.passMessagesInChat(c,a);var e;d.forEach(function(a){e=b.map(function(a){return a.getMaxSequenceNoOfMessages()}).indexOf(a.getMaxSequenceNoOfMessages()),-1!=e&&b.splice(e,1)})}}},this.callsManagerMessageSendFailed=function(a){a=$(a);var b=a.find(k.CONVO_MESSAGE),c=b.attr("chat_id"),d=a.attr("id"),e=this.chatIdToChatMap[c];if(e){var f=e.messageForId(d);if(f){f.isRetrying=!1;var g=e.messages.map(function(a){return a.messageId}).indexOf(d);if(-1!=g){for(var h=this.delegates.length,i=0;h>i;i++){var j=this.delegates[i];"function"==typeof j.messagesLoaderMessageSendFailedAtIndexInChat&&j.messagesLoaderMessageSendFailedAtIndexInChat(f,g,e)}f.type==p.CHAT_TITLE_UPDATE&&(e.restoreOldTitle(),this.delegates.forEach(function(a){"function"==typeof a.updatedChat&&a.updatedChat(e)}))}}}},this.destroy=function(){n={}},this.callsManagerMessagesIqFailedForFirstFetch=function(a){if(!s.isAdminModeON()){var b,c,d,e=$(a).find("query[xmlns='"+l.HISTORY_MESSAGES+"']").find("chat"),f=e.find("range"),g=e.attr("id"),h=f.attr("from_sequence_number"),i=f.attr("to_sequence_number"),j=f.attr("from_index"),k=f.attr("to_index");if(+h>0&&+i>0?b=!0:+j>0&&+k>0&&(c=!0),g&&(c||b)){var m=this.chatIdToChatMap[g];if(m){if(b){var n=m.participantForId(this.usersManager.getThisUser().userId);+h===n.lastSeenMessageSequenceNumber+1&&+i===m.lastMessageSequenceNumber&&(d=!0)}else c&&+k===this.MESSAGE_FETCH_PAGE_SIZE&&1===+j&&(d=!0);if(d){m.isLoadingInProgress&&(m.isLoadingInProgress=!1);for(var o=this.delegates.length,p=0;o>p;p++){var q=this.delegates[p];"function"==typeof q.messagesLoaderFailedToLoadHistoryMessagesForChat&&q.messagesLoaderFailedToLoadHistoryMessagesForChat(m)}}}}}},this.callsManagerMessagesIqFailed=function(a){var b,c,d=$(a).find("query[xmlns='"+l.HISTORY_MESSAGES+"']"),e=d.attr("chat_id"),f=d.attr("from_sequence_number"),g=d.attr("to_sequence_number"),h=d.attr("from_index"),i=d.attr("to_index");if(+f>0&&+g>0?b=!0:+h>0&&+i>0&&(c=!0),e&&(c||b)){var j=this.chatIdToChatMap[e];if(j){if(c||+g<j.minSequenceNumber)for(var k=this.delegates.length,m=0;k>m;m++){var n=this.delegates[m];"function"==typeof n.messagesLoaderFailedToLoadHistoryMessagesForChat&&n.messagesLoaderFailedToLoadHistoryMessagesForChat(j)}j.isLoadingInProgress&&(j.isLoadingInProgress=!1)}}},this.updateChatTitle=function(a,b){var c=this.usersManager.getThisUser(),d=a.participantForId(c.userId);a.chatType==q.GROUP&&b&&d&&d.status==r.JOINED&&(this.sendMessageInGroupChat(b,a,null,p.CHAT_TITLE_UPDATE,!0),a.setTitle(b,!0),this.delegates.forEach(function(b){"function"==typeof b.updatedChat&&b.updatedChat(a)}))},this.updateChatImage=function(a,b){var c=this.usersManager.getThisUser(),d=a.participantForId(c.userId);a.chatType==q.GROUP&&d&&d.status==r.JOINED&&(this.sendMessageInGroupChat(b.imageVersion,a,null,p.CHAT_IMAGE_UPDATE,!0),a.setIconVersion(b.imageVersion),this.delegates.forEach(function(b){"function"==typeof b.updatedChat&&b.updatedChat(a)}))}},g.chatsdk.ComposingStatus={COMPOSING_STARTED:1,COMPOSING_ENDED:2,fromString:function(a){return"start"==a?this.COMPOSING_STARTED:"stop"==a?this.COMPOSING_ENDED:null},toString:function(a){return a==this.COMPOSING_STARTED?"start":a==this.COMPOSING_ENDED?"stop":null}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.PresenceManager=function(a){var b=this;this._callsManager=a,this.userIdToPresenceMap={},this._callsManager.addListener(g.chatsdk.ChatEvents.CONNECTED,function(a){setTimeout(function(){b.fetchRoster()},0)}),this._callsManager.addListener(g.chatsdk.ChatEvents.DISCONNECTED,function(a){b.userIdToPresenceMap={},b.dispatch(g.chatsdk.ChatEvents.DISCONNECTED)}),this._callsManager.addListener(g.chatsdk.ChatEvents.PRESENCE_RECEIVED,function(a){b.onPresenceReceived(a,!1),b.dispatch(g.chatsdk.ChatEvents.PRESENCE_CHANGED)}),this._callsManager.addListener(g.chatsdk.ChatEvents.ROSTER_RECEIVED,function(a){b.onPresenceReceived(a,!0),b.dispatch(g.chatsdk.ChatEvents.CONNECTED)})},g.chatsdk.PresenceManager.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.PresenceManager.prototype.constructor=g.chatsdk.PresenceManager,g.chatsdk.PresenceManager.prototype.onPresenceReceived=function(a,b){var c=g.chatsdk;b&&(this.userIdToPresenceMap={});var d=this;$(a).find("item").each(function(){var a=$(this),b=0,e=a.attr("type"),f=a.attr("value");if("unavailable"===e)b=c.UserStatus.UNAVAILABLE;else if(f)switch(f){case"available":b=c.UserStatus.AVAILABLE;break;case"away":b=c.UserStatus.IDLE;break;case"dnd":b=c.UserStatus.BUSY}else b=c.UserStatus.AVAILABLE;d.userIdToPresenceMap[a.attr("user_id")]={status:b,device:"mobile"===a.attr("device")?c.UserDevice.MOBILE:c.UserDevice.DESKTOP}})},g.chatsdk.PresenceManager.prototype.fetchRoster=function(){var a=g.chatsdk.ChatUtils.generateUniqueId(),b=$iq({to:"convop@"+this._callsManager.getDomain(),type:"get",id:a}).c("query",{xmlns:"convo:jabber:iq:roster"});this._callsManager.sendIQ(b,a,!0)},g.chatsdk.PresenceManager.prototype.refreshPresence=function(){this.fetchRoster()},g.chatsdk.PresenceManager.prototype.getUserPresenceInfo=function(a){var b=this.userIdToPresenceMap[a];return b?b.status:-1},g.chatsdk.PresenceManager.prototype.changePresence=function(a,b){var c,d=g.chatsdk,e=d.ChatUtils.generateUniqueId();switch(a){case d.UserStatus.AVAILABLE:c=b?$pres({id:e,explicit:1}):$pres({id:e});break;case d.UserStatus.BUSY:c=b?$pres({id:e,explicit:1}).c("show").t("dnd"):$pres({id:e}).c("show").t("dnd");break;case d.UserStatus.IDLE:c=$pres({id:e}).c("show").t("away");break;case d.UserStatus.UNAVAILABLE:c=$pres({id:e,type:"unavailable"})}this._callsManager.sendIQ(c,e,!1)},g.chatsdk.PresenceEvent={PRESENCE_CHANGED:"presenceChanged",USER_ARRIVED:"usersArrived",USER_LEFT:"usersLeft"},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.TimestampManager=function(){var a=0,b=0;this.UTCTimestamp=function(){var c=0;return c=a?a+((new Date).getTime()-b):(new Date).getTime()},this.initializeIfRequired=function(c,d){0==a&&0==b&&this.setTimestampAccordingToServerTimestamp(c,d)},this.update=function(c,d){c>a&&d>b&&this.setTimestampAccordingToServerTimestamp(c,d)},this.setTimestampAccordingToServerTimestamp=function(c,d){b=Math.ceil(((new Date).getTime()-d)/2),a=c+b,b=(new Date).getTime()}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.UserDevice={DESKTOP:1,MOBILE:2},g.chatsdk.UserStatus={AVAILABLE:1,BUSY:2,IDLE:3,UNAVAILABLE:4},g.chatsdk.UserManager=function(a,b){function c(){var a=m.usersService.updateUsersLastActiveTime();a.then(function(a){var b;for(var c in a)b=m.getUserById(c),b&&b.setLastPingTime(a[c].last_ping_time);m.dispatch(g.chatsdk.ChatEvents.LAST_ACTIVE_TIME_UPDATED)})}function d(){for(;s.length>0;)s.pop()}function e(){for(;t.length>0;)t.pop()}function f(a){var b;return u.hasOwnProperty(a)?(b=u[a],delete u[a]):v.hasOwnProperty(a)&&(b=v[a],delete v[a]),b}function h(a,b,c){var d=[],e=a.length;c=c||e;for(var f=0;e>f;f++){var g=a[f],h=g.getDisplayName();if(h!==g.email&&null!=h.match(b))d.push(g);else{var i=g.email.search(b);-1!==i&&i<g.email.indexOf("@")&&d.push(g)}if(d.length>=c)break}return d}function i(a,b){for(var c=[],d=a.length,e=0;d>e;e++){var f=a[e],g=f.getDisplayName(),h=!1;if(g!==f.email&&null!=g.match(b)&&(c.push(f),h=!0),!h){var i=f.email.search(b);-1!==i&&i<f.email.indexOf("@")&&c.push(f)}}return c}function j(a,b){var c=b||[];for(var d in v)if(v.hasOwnProperty(d)){var e=v[d];null!=e.getDisplayName().match(a)&&-1==c.indexOf(e)&&c.push(e)}return c}function k(a){return a.replace(new RegExp("([{}()^$&.*?/+|[\\\\]|]|-)","g"),"\\$1")}var l=g.chatsdk,m=this,n=null,o=l.UserStatus.AVAILABLE,p=b,q=!1,r=[],s=[],t=[],u={},v={},w=!1,x={};this.usersService=null;var y=[],z="",A=new g.chatsdk.PresenceManager(a);A.addListener(g.chatsdk.ChatEvents.CONNECTED,function(){m.onPresenceManagerIsConnected(),c()}),A.addListener(g.chatsdk.ChatEvents.PRESENCE_CHANGED,function(){m.onPresenceChanged()}),A.addListener(g.chatsdk.ChatEvents.DISCONNECTED,function(){m.onPresenceManagerDisconnected()});var B=!1;this.dispose=function(){n=null,q=!1,d(),u={},v={},o=l.UserStatus.AVAILABLE,r=[],y=[],z=""},this.getThisUser=function(){return n},this.setThisUser=function(a){n||(n=new g.chatsdk.User),n.setInfo(a),u[n.userId]=n},this.getUsers=function(){return s},this.getContacts=function(){return t},this.getUser=function(a){var b=this.getUserById(a);return b||(b=this.getInaccessibleUserById(a)),b},this.getUserById=function(a){return u[a]},this.getUserByEmail=function(a){return x[a]},this.setAppUsersAndContactsService=function(a,b){function c(){a.getBuddyUsers().then(function(b){a.fillRelevanciesInUsers().then(function(){m.setUsers(b)})})}function d(){b.getContacts(b.CONTACT_LIST_TYPES.ON_DOMAIN).then(function(a){m.setContacts(a)})}c(),d(),a.on("usersUpdated",c),b.on("network_contacts_updated",d)};var C=function(){s.length&&s.sort(g.chatsdk.ChatUtils.usersComparator)},D=function(a){m.dispatch(g.chatsdk.ChatEvents.CONNECTED,{users:a})},E=function(a){m.dispatch(g.chatsdk.ChatEvents.CONTACTS_CONNECTED,{contacts:a})};this.setUsers=function(a){var b,c,e=(a.length,{});d(),a.forEach(function(a){c=a.user_id,b=f(c),b||(b=new l.User),b.setInfoFromModel(a),e[c]=b,c!==n.userId&&s.push(b)});for(c in u)u.hasOwnProperty(c)&&(b=u[c],b.isAccessible=!1,v[c]=b);u=e,this.updateUsersPresenceStatus(),C(),w=!0,D(s)},this.setContacts=function(a){var b,c,d={};e(),a.forEach(function(a){c=a.email,b=new l.Contact,b.setContactInfoFromModel(a),d[c]=b,t.push(b)}),x=d,E(t)},this.addInaccessibleUser=function(a,b){if(!u.hasOwnProperty(a)){var c=v[a];if(!c){if(c=new l.User,c.firstName=b,c.userId=a,c.isAccessible=!1,B){var d=A.userIdToPresenceMap[a];d&&(c.presenceStatus=d.status,c.setDevice(d.device))}v[a]=c}return c}},this.addContactAsInvitedUser=function(a){this.removeContact(a);var b={user_id:a.userId,email:a.email,first_name:a.firstName,last_name:a.lastName,status:a.status};F(b)},this.getInaccessibleUserById=function(a){var b=v[a];return b||(b=this.usersService.findUser(a),b&&(b=this.addInaccessibleUser(b.id,b.first_name+" "+b.last_name))),b};var F=function(a){if(a)if(a.user_id!==n.userId){var b=new g.chatsdk.User;b.setInfo(a),s.push(b),u[b.userId]=b,v.hasOwnProperty(b.userId)&&delete v[b.userId]}else n.setInfo(a)};this.onUserIdle=function(a){q=!0,B&&A.changePresence(l.UserStatus.IDLE)},this.onUserNonIdle=function(a){q=!1,B&&(n.setDevice(l.UserDevice.DESKTOP),n.presenceStatus=o,A.changePresence(o),G([n],"UPDATED"))},this.isThiUserIdle=function(){return q},this.removeUser=function(a){var b=!1,c=s.map(function(a){return a.userId}).indexOf(a.userId);return-1!==c&&(s.splice(c,1),b=!0),b},this.removeContact=function(a){var b=!1,c=g.chatsdk.ChatUtils.findIndexInObjectArray(t,"email",a.email);return-1!==c&&(t.splice(c,1),b=!0,delete x[a.email]),b},this.getThisUserCustomStatus=function(){return o},this.setThisUserCustomStatus=function(a){if(o!==a&&(o=a,!q&&B)){var b=this.getThisUser();b.presenceStatus=a,b.customStatus=a,A.changePresence(o,1),G([b],"UPDATED")}};var G=function(a,b){m.dispatch(g.chatsdk.ChatEvents.PRESENCE_CHANGED,{users:a,status:b})};this.onPresenceChanged=function(){var a=this.updateUsersPresenceStatus();a&&a.length>0&&(C(),G(a,"UPDATED"))},this.disConnectUsers=function(){var a=[];n&&n.presenceStatus!==l.UserStatus.UNAVAILABLE&&(n.presenceStatus=l.UserStatus.UNAVAILABLE,a.push(n));for(var b=null,c=s.length,d=0;c>d;d++)b=s[d],b.presenceStatus!==l.UserStatus.UNAVAILABLE&&(b.presenceStatus=l.UserStatus.UNAVAILABLE,b.lastPingTime=p.UTCTimestamp(),a.push(b));for(var e in v)v.hasOwnProperty(e)&&(b=v[e],b.presenceStatus!==l.UserStatus.UNAVAILABLE&&(b.presenceStatus=l.UserStatus.UNAVAILABLE,b.lastPingTime=p.UTCTimestamp(),a.push(b)));C(),G(a,"DISCONNECTED")},this.onPresenceManagerIsConnected=function(){var a=q?l.UserStatus.IDLE:o;B=!0,n.presenceStatus=a,A.changePresence(a);var b=this.updateUsersPresenceStatus();b.push(n),C(),G(b,"CONNECTED")},this.updateUsersPresenceStatus=function(){var a=[];if(A.userIdToPresenceMap){var b=null;for(var c in A.userIdToPresenceMap)if(A.userIdToPresenceMap.hasOwnProperty(c)){var d=A.userIdToPresenceMap[c];c!=n.userId||q?(b=u[c]||v[c],b&&(b.presenceStatus!=d.status||b.getDevice()!=d.device)&&(b.presenceStatus=d.status,b.setDevice(d.device),d.status==l.UserStatus.UNAVAILABLE&&(b.lastPingTime=p.UTCTimestamp()),a.push(b))):(n.presenceStatus=d.status,n.setDevice(d.device),a.push(n))}}return a},this.onPresenceManagerDisconnected=function(){B=!1,this.disConnectUsers()},this.getUserIDFormUserEmail=function(a){var b=this.getUserFormUserEmail(a);return b&&b.userId?b.userId:null},this.getUserFormUserEmail=function(a){if(!a)return null;a=a.toLowerCase();for(var b=s.length,c=null,d=0;b>d;d++)if(c=s[d],c.email.toLowerCase()===a)return c;return null},this.getFilteredUserList=function(a,b,c,d){var e;a&&(e=new RegExp("(([\\s,<>():._])|^)("+k(a)+")","gi"));var f=h(s,e,c);return d&&(f=_.sortBy(f,function(a){return-a.relevancy})),b?j(e,f):f},this.getFilteredContactList=function(a){var b;a&&(b=new RegExp("(([\\s,<>():._-])|^)("+k(a)+")","gi"));var c=i(t,b);return c},this.isConnected=function(){return w},this.destroy=function(){this.dispose()}},g.chatsdk.UserManager.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.UserManager.prototype.constructor=g.chatsdk.UserManager,a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.XMPPChatService=function(b,c,d,e,f,h,i){function j(a){var b=a.chats;w.deltaFetcher.getPreviousHeartBeatTimestamp(),w.updateUnreadChatsCount(a.unreadChatsCount);var c=b?b.length:0;if(c>0){w.localChatsMap={},w._chats=[];for(var d,e=0;c>e;e++)d=b[e],w.localChatsMap[d.chatId]||(w._chats.push(d),w.localChatsMap[d.chatId]=d),w.sharedChatsMap[d.chatId]||(w.sharedChatsMap[d.chatId]=d);p.ChatUtils.sortChats(w._chats),w.chatsLoader.chatsCacheRefreshed(w._chats),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&w.chatManager.dispatch(q.CHATS_CACHE_REFRESHED)}}function k(){var a,b,c=w.timestampManager.UTCTimestamp(),d=[],e=!0;w._chats.forEach(function(f){var g=f.composingParticipants.length;if(g>0){d=[];for(var h,i=0;g>i;i++){if(h=f.composingParticipants[i],a=f.composingParticipantsInfo[h.userId],!(c-a>r)){e=!1;break}d.push(h)}b=!1,d.forEach(function(a){b=f.participantEndedComposing(a)||b}),b&&w.chatManager.dispatch(q.COMPOSING_ENDED,{chat:f})}}),e&&m()}function l(){o||(o=setInterval(k,s))}function m(){o&&(clearInterval(o),o=null)}function n(){w._chats.length&&w.deltaFetcher.fetchRecentChats()||w.chatsLoader.refreshChats()}var o,p=g.chatsdk,q=p.ChatEvents,r=(p.MessageType,15e3),s=1e4,t=null;this.KDispatchIntervalFiveSecs=5e3,this.usersManager=b,this.chatManager=f,this._unreadChatsCount=0,this.sharedChatsMap={},this.localChatsMap={},this.silentChatLoadMap={},this.unreadCountTimestamp=0,this._chats=[];var u=i;this.deltaFetcher=new p.DeltaFetcher(e,d,this.sharedChatsMap,u),this.chatsLoader=new p.ChatsLoader(b,this.sharedChatsMap,d,f,e,h,this.deltaFetcher),this.chatsLoader.addDelegate(this),this.messagesLoader=new p.MessagesLoader(b,d,this.chatsLoader,this.sharedChatsMap,e,h),this.messagesLoader.addDelegate(this);var v=new p.ChatSearchManager(this.messagesLoader,this.sharedChatsMap,this.chatManager);this.filesManager=new p.ChatFilesManager(this.messagesLoader,this.sharedChatsMap,f),this.xmppCallsManager=e;var w=this;this.xmppCallsManager.addListener(q.CONNECTED,function(){setTimeout(function(){w.onConnected()},0)}),this.xmppCallsManager.addListener(q.DISCONNECTED,function(){w.onDisconnected()}),this.timestampManager=d,this._selectedChat=null,$(a).unload(function(){u.chatsUpdated(w._chats,!0)}),u.addListener(q.CHATS_CACHE_REFRESHED,j),this.updateUnreadChatsCount=function(a,b,c,d){if(b){if(b<this.unreadCountTimestamp)return;this.unreadCountTimestamp=b}if(this._unreadChatsCount!=a){if(a>this._unreadChatsCount){var e=this._selectedChat&&d==this._selectedChat.chatId;if(e)return}this._unreadChatsCount=0>a?0:a,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHATS_UNREAD_COUNT_CHANGED,{unreadCount:this._unreadChatsCount}),u.updateUnreadChatsCount(a)}},this.getUnreadChatsCount=function(){return this._unreadChatsCount},this.usersUpdated=function(){this._chats.forEach(function(a){a.resetComputedTitle()})},this.startChatWithUser=function(a,b,c){var d=this.chatsLoader.startChatWithUser(a,b),e=d.chat,f=d.created;return f&&c&&(this.silentChatLoadMap[e.chatId]=!0),e},this.openChatFromId=function(a,b,c,d,e,f,g){var h=this.sharedChatsMap[a];if(!h){var i=this.usersManager.getThisUser();h=(new p.Chat).setInfo(a,g,null,b,0,0,0,!1,i),this.sharedChatsMap[h.chatId]=h;for(var j,k,l,m=d.length,n=0;m>n;n++)j=d[n],k=j.userId,l="function"==typeof j.getDisplayName?j.getDisplayName():j.name,h.participantForId(k)||h.addParticipant(new p.ChatParticipant(k,l,p.ParticipantStatus.JOINED,0,0));this.chatsLoader.loadChat(a,f),f&&(h.isLoadingInProgress=!0),e&&(this.silentChatLoadMap[a]=!0)}return this.searchEnded(h,null),h},this.openChatInSearch=function(a,b,c,d,e,f,h,i,j){var k,l=this.sharedChatsMap[a],m={sequenceNumber:parseInt(e.seq_no),messageId:e.msg_id};if(!l){var n=this.usersManager.getThisUser();l=(new p.Chat).setInfo(a,j,null,b,0,0,0,!1,n);for(var o,r,s,t=f.length,u=0;t>u;u++)o=f[u],r=o.userId,s="function"==typeof o.getDisplayName?o.getDisplayName():o.name,l.participantForId(o.userId)||l.addParticipant(new p.ChatParticipant(r,s,p.ParticipantStatus.JOINED,0,0));this.sharedChatsMap[l.chatId]=l,k=!0,this.chatsLoader.loadChat(a)}i&&(this.silentChatLoadMap[a]=!0);var w=null!==c&&c.length>0;l.searchInfo&&w&&(c!=l.searchInfo.searchText?this.searchEnded(l,null):(l.searchInfo.initialMatch=m,l.searchInfo.moveToMatch(m)));var x,y;if(w||(x=e.from_sequence_number,y=e.to_sequence_number),null==l.searchInfo||!w){var z=new p.ChatSearchInfo(l,c,d,m,v,k,x,y,h);l.searchInfo=z,v.startSearchInChat(l)}return l.searchInfo&&g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(l.dispatch(q.SEARCH_STARTED),this.chatManager.dispatch(q.SEARCH_STARTED,{chat:l})),l},this.chatSearchResultsReceived=function(a){v.onChatSearchResultsReceived(a)},this.searchEnded=function(a,b){a.isInSearch()&&(a.searchInfo=null,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(a.dispatch(q.SEARCH_ENDED,{reason:b}),this.chatManager.dispatch(q.SEARCH_ENDED,{chat:a,reason:b})))},this.startChatWithUsers=function(a,b){var c=this.chatsLoader.startChatWithUsers(a);return b&&c&&(this.silentChatLoadMap[c.chatId]=!0),c},this.sendMessage=function(a,b,c,d,e,f){this.messagesLoader.sendMessage(a,b,null,d,e,f)},this.sendFakeMessage=function(a,b){this.messagesLoader.sendFakeMessage(a,b)},this.muteChat=function(a,b){this.chatsLoader.muteChat(a,b)},this.unMuteChat=function(a,b){this.chatsLoader.unMuteChat(a,b)},this.chatsLoaderUpdatedChatMuteStatus=function(a){g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chatManager.dispatch(q.MUTE_STATUS_CHANGED,{chat:a}),a.dispatch(q.MUTE_STATUS_CHANGED)),u.chatsUpdated([a])},this.chatsLoaderUpdatedChatMuteStatus=function(a){g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chatManager.dispatch(q.MUTE_STATUS_CHANGED,{chat:a}),a.dispatch(q.MUTE_STATUS_CHANGED)),u.chatsUpdated([a])},this.updatedChat=function(a){var b=this._chats.map(function(a){return a.chatId}).indexOf(a.chatId);g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chatManager.dispatch(q.CHAT_UPDATED,{chat:a,index:b}),a.dispatch(q.CHAT_UPDATED));var c=a.participants[a.thisUser.userId],d=c&&c.status==p.ParticipantStatus.LEFT;u.chatsUpdated([a],d)},this.reSendMessageInChat=function(a,b,c){this.isConnected()&&this.messagesLoader.reSendMessageInChat(a,b,c)},this.isConnected=function(){return this.xmppCallsManager.isConnected()},this.isChatsFetchInProgress=function(){return this.chatsLoader.fetchChatsCallInprogress},this.chatRestored=function(a){this.sharedChatsMap[a.chatId]=a},this.messagesLoaderSentMessageInChat=function(a,b){b.addMessage(a);var c=this._chats.map(function(a){return a.chatId}).indexOf(b.chatId);0>c?(this._chats.splice(0,0,b),this.localChatsMap[b.chatId]=b,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_ADDED,{chat:b,index:0})):c>0?(this._chats.splice(c,1),this._chats.splice(0,0,b),
g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_MOVED,{chat:b,fromIndex:c,toIndex:0})):g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_UPDATED,{chat:b,index:c}),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.MESSAGE_SENT_IN_CHAT,{message:a,chat:b})},this.messagesLoaderSentFakeMessageInChat=function(a,b){b.addMessage(a),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.MESSAGE_SENT_IN_CHAT,{message:a,chat:b})},this.messagesLoaderSentMessageReceivedAtServerInChat=function(a,b){b.messageUpdated(a),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(b.dispatch(q.SENT_MSG_RECEIVED_AT_SERVER,{message:a}),this.chatManager.dispatch(q.SENT_MSG_RECEIVED_AT_SERVER,{chat:b,message:a})),b.updateThisUserMessageSeenParticipantsInfo(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,{chat:b}),u.chatsUpdated([b])},this.messagesLoaderReceivedComposingMessageForChatFromParticipant=function(a,b,c){var d=p.ComposingStatus;if(c==d.COMPOSING_STARTED){var e=a.participantStartedComposing(b,this.timestampManager.UTCTimestamp());e&&(l(),this.chatManager.dispatch(q.COMPOSING_STARTED,{chat:a,participant:b}))}else c==d.COMPOSING_ENDED&&this.participantEndedComposingInChat(b,a)},this.messagesLoaderUpdatedChat=function(a){var b=this._chats.map(function(a){return a.chatId}).indexOf(a.chatId);g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chatManager.dispatch(q.CHAT_UPDATED,{chat:a,index:b}),a.dispatch(q.PARTICIPANTS_CHANGED)),u.chatsUpdated([a])},this.clearAllComposingInChat=function(a){a.clearAllComposing(),this.chatManager.dispatch(q.COMPOSING_ENDED,{chat:a})},this.participantEndedComposingInChat=function(a,b){b.participantEndedComposing(a)&&this.chatManager.dispatch(q.COMPOSING_ENDED,{chat:b})},this.messagesLoaderReceivedMessageInChat=function(a,b){if(p.ChatUtils.isAdminModeONAndOrThisUserIsNotInChatParticipants(b))return void b.addMessage(a);if(b.addMessage(a)){var c=this.usersManager.getThisUser().userId;if(c==a.senderId)b.unreadCount>0&&(b.updateUnreadCount(0),this.chatManager.dispatch(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,{unreadCount:b.unreadCount,chat:b}));else if(!(a.skipUnreadCount||this._selectedChat&&b.chatId===this._selectedChat.chatId)){var d=!1;if(a.type==p.MessageType.MESSAGE)d=!0;else if(a.type==p.MessageType.INVITE&&a.invitees)for(var e in a.invitees)if(a.invitees.hasOwnProperty(e)&&e==c){d=!0;break}if(d){var f=this._selectedChat&&b.chatId==this._selectedChat.chatId;f?b.updateUnreadCount(0):b.updateUnreadCount(b.unreadCount+1),this.chatManager.dispatch(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,{unreadCount:b.unreadCount,chat:b})}var h=b.participantForId(a.senderId);h&&this.participantEndedComposingInChat(h,b)}b.addMessage(a);var i=this._chats.map(function(a){return a.chatId}).indexOf(b.chatId);if(0>i){var j=this.indexForChat(b);this._chats.splice(j,0,b),this.localChatsMap[b.chatId]=b,this.sharedChatsMap[b.chatId]||(this.sharedChatsMap[b.chatId]=b),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_ADDED,{chat:b,index:j})}else if(i>0){this._chats.splice(i,1);var j=this.indexForChat(b);i!=j?(this._chats.splice(j,0,b),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_MOVED,{chat:b,fromIndex:i,toIndex:j})):(this._chats.splice(i,0,b),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_UPDATED,{chat:b,index:i}))}else g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_UPDATED,{chat:b,index:i});b.updateThisUserMessageSeenParticipantsInfo(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.MESSAGE_RECEIVED,{chat:b,message:a}),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,{chat:b}),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&b.dispatch(q.MESSAGE_RECEIVED,{message:a}),u.chatsUpdated([b])}},this.indexForChat=function(a){for(var b=0,c=this._chats.length;c>b&&!(a.lastMessageTimestamp>this._chats[b].lastMessageTimestamp);b++);return b},this.chatsLoaderChatsRefreshed=function(a){this.deltaFetcher.startHeartBeat();var b=a.length;if(a&&b>0){for(;this._chats.length>0;)this._chats.pop();this.localChatsMap={};for(var c,d=0;b>d;d++)c=a[d],this.localChatsMap[c.chatId]||(this._chats.push(c),this.localChatsMap[c.chatId]=c),this.sharedChatsMap[c.chatId]||(this.sharedChatsMap[c.chatId]=c)}g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHATS_REFRESHED);u.chatsUpdated(a)},this.chatsLoaderChatsLoaded=function(a){for(var b,c=a.length,d=0;c>d;++d)b=a[d],this.localChatsMap[b.chatId]||(this._chats.push(b),this.localChatsMap[b.chatId]=b),this.sharedChatsMap[b.chatId]||(this.sharedChatsMap[b.chatId]=b);p.ChatUtils.sortChats(this._chats),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHATS_ADDED,{chats:a})},this.chatsForFilteredUsers=function(a){var b={chats:[],users:[]},c={};if(a&&a.length&&this._chats.length){var d;a.forEach(function(a){d=!1,this._chats.forEach(function(b){!c.hasOwnProperty(b.chatId)&&b.participantForId(a.userId)&&(c[b.chatId]=b,b.chatType==g.chatsdk.ChatType.P2P&&(d=!0))},this),!d&&a.isAccessible&&b.users.push(a)},this);for(var e in c)c.hasOwnProperty(e)&&b.chats.push(c[e]);p.ChatUtils.sortChats(b.chats)}else a.forEach(function(a){a.isAccessible&&b.users.push(a)});return b},this.getUsersWithoutP2PChat=function(a){var b=[];if(0==this._chats.length)return a;if(a&&a.length&&this._chats.length){var c,d={};this._chats.forEach(function(a){a.chatType==g.chatsdk.ChatType.P2P&&(c=a.getOtherParticipant(a.thisUser.userId).userId,d[c]=!0)}),a.forEach(function(a){!d.hasOwnProperty(a.userId)&&a.isAccessible&&b.push(a)})}return b},this.messagesLoaderReceivedUnreadCountForChat=function(a,b){if(b=parseInt(b),-1!=b){var c=this._selectedChat&&a.chatId==this._selectedChat.chatId;c?(a.unreadCount>0&&a.updateUnreadCount(0),this.chatManager.dispatch(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,{unreadCount:a.unreadCount,chat:a})):a.unreadCount!=b&&(0==a.unreadCount&&b>0?a.updateUnreadCount(b):a.unreadCount>0&&0==b?a.updateUnreadCount(b):a.updateUnreadCount(b),this.chatManager.dispatch(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,{unreadCount:a.unreadCount,chat:a}))}u.chatsUpdated([a])},this.messagesLoaderMessageReadInChatByParticipant=function(a,b,c){b.messageForId(a.messageId)&&b.chatType==p.ChatType.P2P&&(b.updateThisUserMessageSeenParticipantsInfo(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,{chat:b,message:a}),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&b.dispatch(q.MESSAGE_READ,{message:a}),u.chatsUpdated([b]))},this.messagesLoaderReceivedAcksInGroupChat=function(a,b){u.chatsUpdated([a],!0),a.updateThisUserMessageSeenParticipantsInfo(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&a.dispatch(q.GROUP_CHAT_ACKS_RECEIVED,{participants:b}),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,{chat:a})},this.onConnected=function(){n(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CONNECTED),this.chatsLoader.fetchUnreadChatsCount()},this.onDisconnected=function(){g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.DISCONNECTED),this.deltaFetcher.stopHeartBeat()},this.chatOpened=function(a){this.messagesLoader.chatOpened(a)},this.getChat=function(a){return this.sharedChatsMap[a]},this.chatClosed=function(a){a.isOpened=!1,this.chatLostFocus(a),a.isNeedToUpdateSummeryText=!0,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_CLOSED,{chat:a})},this.discardOldMessagesFromChatIfRequired=function(a,b){},this.chatGainedFocus=function(a){this._selectedChat=a},this.chatLostFocus=function(a){this._selectedChat&&this._selectedChat.chatId==a.chatId&&(this._selectedChat=null)},this.appFocusGained=function(){this.chatsLoader.appFocusGained()},this.appFocusLost=function(){this.chatsLoader.appFocusLost(),this._selectedChat=null},this.messagesLoaderLoadedNewerMessagesInChat=function(a,b,c){b.appendMessages(a),(!this._selectedChat||b.chatId!==this._selectedChat.chatId||b.isInSearch())&&c>0&&0==b.unreadCount&&b.updateUnreadCount(b.unreadCount+c),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(b.dispatch(q.NEWER_MESSAGES_LOADED,{messages:a}),f.dispatch(q.NEWER_MESSAGES_LOADED,{chat:b,messages:a})),u.chatsUpdated([b])},this.messagesLoaderLoadedHistoryMessagesInChat=function(a,b,c,d){if(c)b.searchInfo&&b.searchInfo.addMessages(a,d);else{var e=!1;b.isFetchingRecentMessagesForMissedMessages&&a.length&&a[0].getSequenceNumber()>=b.minSequenceNumber&&(b.isFetchingRecentMessagesForMissedMessages=!1,b.removeAllMessages(),e=!0),b.prependMessages(a),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(b.dispatch(q.HISTORY_LOADED,{reset:e,messages:a}),this.chatManager.dispatch(q.HISTORY_LOADED,{reset:e,messages:a,chat:b})),u.chatsUpdated([b])}},this.chatsLoaderLoadedChat=function(a,b,c,d){a.searchInfo&&a.searchInfo.chatLoaded();var e;if(d&&1==a.messages.length&&a.chatType==p.ChatType.GROUP&&(e=a.messages[0],e.type!=p.MessageType.MESSAGE||this._selectedChat&&a.chatId===this._selectedChat.chatId||this.usersManager.getThisUser().userId==e.senderId||a.unreadCount>0&&a.updateUnreadCount(a.unreadCount),a.updateThisUserMessageSeenParticipantsInfo(),e.type!=p.MessageType.LEFT&&g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.MESSAGE_RECEIVED,{chat:a,message:e}),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&a.dispatch(q.MESSAGE_RECEIVED,{message:e}),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(g.chatsdk.ChatEvents.UPDATE_LAST_MESSAGE_ACKS,{chat:a}),this.usersManager.getThisUser().userId!=e.senderId)){var f=a.participantForId(e.senderId);f&&this.participantEndedComposingInChat(f,a)}this.chatLoadComplete(a,b,d)},this.chatLoadComplete=function(a,b,c){if(!p.ChatUtils.isAdminModeONAndThisUserIsNotInChatParticipants(a)){var d=!1;this.silentChatLoadMap&&this.silentChatLoadMap.hasOwnProperty(a.chatId)&&(delete this.silentChatLoadMap[b],d=!0);var e=this._chats.map(function(a){return a.chatId}).indexOf(a.chatId);if(0>e){if(c){var f=this.indexForChat(a);d&&f==this._chats.length||(this._chats.splice(f,0,a),this.localChatsMap[a.chatId]=a,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_ADDED,{chat:a,index:f}))}}else{this._chats.splice(e,1);var f=this.indexForChat(a);e!==f?(this._chats.splice(f,0,a),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(q.CHAT_MOVED,{chat:a,fromIndex:e,toIndex:f})):(this._chats.splice(e,0,a),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chatManager.dispatch(q.CHAT_UPDATED,{chat:a,index:e}),a.dispatch(q.CHAT_UPDATED)))}this.sharedChatsMap[a.chatId]||(this.sharedChatsMap[a.chatId]=a),u.chatsUpdated([a])}},this.loadOlderMessagesInChat=function(a){var b=this.messagesLoader.loadOlderMessagesInChat(a);return b},this.loadOlderChats=function(){var a=this.canLoadOlderChats()&&this.chatsLoader.loadMoreChatsFromIndex(this._chats.length);return a},this.canLoadOlderChats=function(){var a=this.chatsLoader.canLoadMoreChats();return a},this.chatRead=function(a){if(a.unreadCount>0||a.chatReadAtClientButNotAtServer){var b=a.messages.length;if(this.chatsLoader.chatRead(a),b>0){for(var c,d=b-1;d>=0;--d)if(c=a.messages[d],c.getSequenceNumber()>0&&c.senderId!=this.usersManager.getThisUser().userId){this.messageRead(c,a);break}}else this.messageRead(null,a);a.chatReadAtClientButNotAtServer||(a.chatReadAtClientButNotAtServer=!0,a.unreadCountBeforeReadAtServer=a.unreadCount),a.unreadCount=0,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chatManager.dispatch(q.CHAT_READ,{chat:a}),a.dispatch(q.CHAT_READ)),this.updateUnreadChatsCount(this._unreadChatsCount-1),this.chatManager.dispatch(g.chatsdk.ChatEvents.CHAT_UNREAD_COUNT_CHANGED,{unreadCount:a.unreadCount,chat:a}),t=a.chatId}u.chatsUpdated([a])},this.chatsLoaderChatMarkedRead=function(a){a.unreadCount>0&&(a.resetUnreadCount(),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(a.dispatch(q.UNREAD_COUNT_CHANGED),this.chatManager.dispatch(q.CHAT_UNREAD_COUNT_CHANGED,{unreadCount:a.unreadCount,chat:a})),this.updateUnreadChatsCount(this._unreadChatsCount-1)),a.chatReadAtClientButNotAtServer=!1,a.unreadCountBeforeReadAtServer=null,u.chatsUpdated([a])},this.messageRead=function(a,b){this.messagesLoader.messageReadInChat(a,b)},this.inviteUsersInChat=function(a,b){this.messagesLoader.inviteUsersInChat(a,b)},this.updateParticipantsInChat=function(a,b){console.log("sfaiz.debug - participants="+a.length);var c,d=this.timestampManager.UTCTimestamp();for(var e in a)if(a.hasOwnProperty(e)){var f=b.participantForId(e.userId);if(!f){var g="function"==typeof e.getDisplayName?e.getDisplayName():e.name;b.addParticipant(new p.ChatParticipant(e.userId,g,p.ParticipantStatus.JOINED,0,d)),c=!0}}c&&(b.setComputedTitle(null),b.dispatch(q.PARTICIPANTS_CHANGED))},this.updateInviteChatParticipants=function(a,b){this.chatsLoader.updateInviteChatParticipants(a,b)},this.updateInviteP2PChatIdAndStatus=function(a){this.chatsLoader.updateInviteP2PChatIdAndStatus(a)},this.updateInviteChatFakeMessagesAsOriginal=function(a){this.messagesLoader.updateInviteChatFakeMessagesAsOriginal(a)},this.leaveChat=function(a){this.filesManager.cancelUploadsInChat(a),this.messagesLoader.leaveChat(a)},this.removeParticipantFromChat=function(a,b){this.messagesLoader.removeParticipantFromChat(a,b)},this.sendFilesInChat=function(a,b){this.filesManager.onFileLoaded(a,b)},this.onFileDataChanged=function(a){this.filesManager.onFileDataChanged(a)},this.cancelMessageInChat=function(a,b){this.filesManager.cancelMessage(a,b),this.messagesLoader.cancelMessageInChat(a,b),b.cancelMessage(a)&&g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.chatManager.dispatch(g.chatsdk.ChatEvents.MESSAGE_REMOVED,{chat:b,message:a})},this.composingStarted=function(a){this.messagesLoader.thisUserComposingInChat(a,g.chatsdk.ComposingStatus.COMPOSING_STARTED)},this.composingPaused=function(a){this.messagesLoader.thisUserComposingInChat(a,g.chatsdk.ComposingStatus.COMPOSING_ENDED)},this.messagesLoaderFailedToLoadHistoryMessagesForChat=function(a){this.chatOpened(a)},this.messagesLoaderMessageSendFailedAtIndexInChat=function(a,b,c){g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(c.dispatch(q.SENT_MSG_FAILED,{message:a,index:b}),this.chatManager.dispatch(q.SENT_MSG_FAILED,{chat:c,message:a,index:b}))},this.chatsLoaderChatLoadFailedForId=function(a){this.chatManager.dispatch(p.ChatEvents.CHAT_INFO_LOAD_FAILED,{chatId:a})},this.chatsLoaderChatsLoadFailed=function(){},this.chatsLoaderMarkChatReadFailed=function(a){a.chatId==this._selectedChat.chatId&&this.chatRead(a)},this.chatsLoaderMuteChatFailed=function(a){},this.chatInfoReceived=function(a){a.dispatch(p.ChatEvents.CHAT_INFO_RECV),this.chatManager.dispatch(p.ChatEvents.CHAT_INFO_RECEIVED,{chat:a})},this.chatInfoErrorReceived=function(a){this.chatManager.dispatch(p.ChatEvents.CHAT_INFO_ERROR_RECEIVED,{chatId:a})},this.addChatInCollection=function(a){var b=this.sharedChatsMap[a.chatId];b||(this.sharedChatsMap[a.chatId]=a)},this.updateChatTitle=function(a,b){this.messagesLoader.updateChatTitle(a,p.ChatUtils.escape(b))},this.updateChatImage=function(a,b){this.messagesLoader.updateChatImage(a,b)},this.getLocalChatWithUsers=function(a){return this.chatsLoader.getLocalChatWithUsers(a)},this.loadChatFromId=function(a,b,c){b&&(this.silentChatLoadMap[a]=!0),this.chatsLoader.loadChat(a,c)},this.removeLocallyCreatedChat=function(a){var b=this.sharedChatsMap[a];b&&0==b.lastMessageSequenceNumber&&b.chatType==p.ChatType.GROUP&&delete this.sharedChatsMap[a]},this.destroy=function(){for(m(),u.chatsUpdated(this._chats);this._chats.length>0;)this._chats.pop();this.localChatsMap={},this.messagesLoader.destroy()}},Strophe.addConnectionPlugin("connectionmanager",{pingTime:2e4,timeoutTime:1e4,pingInterval:null,connection:null,totalRetries:0,maxRetries:2,pingInProgress:!1,init:function(a){this.connection=a},statusChanged:function(a){var b=this;switch(a){case Strophe.Status.CONNECTED:case Strophe.Status.ATTACHED:clearInterval(this.pingInterval),this.pingInterval=setInterval(function(){b.pingServer()},this.pingTime);break;case Strophe.Status.DISCONNECTED:clearInterval(this.pingInterval)}},pingServer:function(){this.pingInProgress&&this.disconnect();var a=this,b=$iq({id:"ping",type:"get",to:this.connection.domain}).c("ping",{xmlns:"urn:xmpp:ping"});this.connection.sendIQ(b,function(){a.callback()},function(){a.requestTimedOut()},this.timeoutTime)},requestTimedOut:function(){this.pingInProgress=!1,this.totalRetries++,this.totalRetries>=this.maxRetries&&this.disconnect()},disconnect:function(){clearInterval(this.pingInterval),console.log(this.maxRetries+" pings failed, disconnecting from xmpp now"),this.connection.disconnect()},callback:function(){this.pingInProgress=!1,this.totalRetries=0}}),a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatEvents={PRESENCE_CHANGED:"presenceChanged",CONNECTED:"connected",DISCONNECTED:"disconnected",ROSTER_RECEIVED:"rosterReceived",PRESENCE_RECEIVED:"presenceReceived",CHAT_READ:"chtRead",HEARTBEAT_RECEIVED:"heartbeatRcvd",RECENT_CHATS_RECEIVED:"recentChtsRcvd",FILE_UPLOADED:"fileUploaded",MESSAGE_SENT:"messageSent",MESSAGE_RECEIVED:"msgRcvd",MESSAGE_REMOVED:"msgRmvd",CHAT_STARTED:"chatStrtd",CHAT_UNREAD_COUNT_CHANGED:"chtunrdcntchng",CHATS_UNREAD_COUNT_CHANGED:"chtsunrdcntchng",CHATS_REFRESHED:"chtsRefrshd",CHATS_CACHE_REFRESHED:"chtsCacheRefrshd",CHAT_HISTORY_RECEIVED:"chatHistoryRcvd",MESSAGE_HISTORY_RECEIVED:"msgHistoryRcvd",CHAT_INFO_RECEIVED:"chtInfoRcvd",CHAT_INFO_ERROR_RECEIVED:"chtInfoErrRcvd",CHAT_INFO_LOAD_FAILED:"chtInfoLdFld",CHAT_ADDED:"chatAdded",CHATS_ADDED:"chatsAdded",CHAT_MOVED:"chatMoved",CHAT_LOADED:"chatLoaded",MESSAGE_SENT_IN_CHAT:"messageSentInChat",CHATS_QUERY_RECEIVED:"chtsQryRcvd",MUTE_STATUS_CHANGED:"muteStatusChanged",UNREAD_COUNT_CHANGED:"unreadCntChngd",TITLE_CHANGED:"titleChngd",PARTICIPANTS_CHANGED:"prtcpntsChngd",CHAT_UPDATED:"chatUptd",LEFT:"left",JOINED:"joined",SENT_MSG_RECEIVED_AT_SERVER:"messageRcvdAtSrvr",MESSAGE_READ:"messageRead",HISTORY_LOADED:"historyLoaded",NEWER_MESSAGES_LOADED:"newMsgsLoaded",LOADING_STATUS_CHANGED:"lodngStusChng",COMPOSING_STARTED:"composingStarted",COMPOSING_ENDED:"composingEnded",SEARCH_STARTED:"srchStrtd",SEARCH_MATCHES_RECEIVED:"srchMtchsRcvd",MATCH_FETCH_COMPLETE:"mtchFtchCmplt",SEARCH_ENDED:"srchEnded",SENT_MSG_FAILED:"sentMsgFailed",LOADED_MORE_MSGS:"loadedMoreMsgs",MESSAGE_SEND_FAILED:"msgSndFail",MESSAGES_IQ_FAILED:"msgIqFail",CHATS_IQ_FAILED:"chtsIqFail",CONTACTS_CONNECTED:"contactsConnected",GROUP_CHATS_ACK_RECEIVED:"groupChatsAckReceived",GROUP_CHAT_ACKS_RECEIVED:"groupChatAcksReceived",UPDATE_LAST_MESSAGE_ACKS:"uptdLastMsgAcks",CHAT_CLOSED:"chatClosed",CHATS_BASIC_INFO_RECEIVED:"chtsBasicInfoRcvd"},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatUtils={NODE_SEPERATOR:";",generateUniqueId:function(){for(var a,b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",c=30,d="",e=b.length,f=0;c>f;f+=1)a=Math.random()*e,d+=b.charAt(a);return d.toLowerCase()},makeJid:function(a,b,c,d){var e=d?"/web2native-":"/web2-";return a+this.NODE_SEPERATOR+b+"@"+c+e+this.generateUniqueId()},escape:function(a){return a=_.escape(a),a.replace(/&#x27;/g,"&apos;")},unescape:function(a){return a?(a=a.replace(/&apos;/g,"'"),_.unescape(a)):null},usersComparator:function(a,b){return a.compareTo(b)},compareMessageSequenceNumber:function(a,b){return a.getSequenceNumber()<b.getSequenceNumber()?-1:a.getSequenceNumber()>b.getSequenceNumber()?1:0},sortMessages:function(a,b){if(b)return a.sort(this.compareMessageSequenceNumber);var c=this;a.sort(function(a,b){return a.clientTimestamp<b.clientTimestamp?-1:a.clientTimestamp>b.clientTimestamp?1:c.compareMessageSequenceNumber(a,b)})},sortChats:function(a){a.sort(function(a,b){return a.lastMessageTimestamp<b.lastMessageTimestamp?1:a.lastMessageTimestamp>b.lastMessageTimestamp?-1:0})},generateChatId:function(a,b){var c=null;if(a&&b){var d=this.makeUserIdAndAccountIdFromJid(a);c=d[0];var e=d[1];c+=e.localeCompare(b)<0?e+b:b+e,c=$().crypt({method:"sha1",source:c})}return c.toLowerCase()},generateUniqueKeyFromIds:function(a){if(!a||!a.length)return null;a.sort();var b=a.join("");return $().crypt({method:"sha1",source:b})},makeUserIdFromJid:function(a){return this.makeUserIdAndAccountIdFromJid(a)[1]},makeAccountIdFromJid:function(a){return this.makeUserIdAndAccountIdFromJid(a)[0]},makeUserIdAndAccountIdFromJid:function(a){var b=a.split("@")[0];return b.split(this.NODE_SEPERATOR)},userInfoService:null,isAdminModeONAndThisUserIsNotInChatParticipants:function(a){return g.chatsdk.ChatUtils.userInfoService.isAdminMode()&&!a.isThisUserIsInParticipants()},isAdminModeONAndOrThisUserIsNotInChatParticipants:function(a){return g.chatsdk.ChatUtils.userInfoService.isAdminMode()&&!a.isThisUserIsInParticipants()||!a.isThisUserIsInParticipants()},isAdminModeON:function(){return g.chatsdk.ChatUtils.userInfoService.isAdminMode()},findIndexInObjectArray:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]===c)return d;return-1}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.Constants={DISPATCH_EVENTS_TO_UI:!0,XMLNS:{CONVO_MESSAGE:"http://convo.com/xmpp/chat/message",PARTICIPANTS:"http://convo.com/xmpp/chat/message/participants",HISTORY_MESSAGES:"convo:chat:history:messages",HISTORY_CHATS:"convo:chat:history:chats",CONVO_FILE:"http://convo.com/xmpp/chat/file",CHAT_INFO:"convo:chat:info",CHAT_READ:"convo:chat:mark:read",CHAT_MUTE:"convo:chat:mute",FOCUS_GAIN:"convo:app:focus:gain",FOCUS_LOSE:"convo:app:focus:loose",HEARTBEAT:"convo:chat:heartbeat",RECENT_CHATS:"convo:chat:history:recent:chats",ROSTER:"convo:jabber:iq:roster",PRESENCE_BATCHED:"convo:presence:batched",CHAT_ACK_BATCHED:"convo:chat:ack:batched",APP_VERSION:"convo:client:native_version",CHAT_BASIC_INFO:"convo:chat:basic:info"},TAG:{CONVO_FILE:"convo-file",BODY:"body",CONVO_MESSAGE:"convo-message",PARTICIPANTS:"participants",PARTICIPANT:"participant",INVITEES:"invitees",INVITEE:"invitee",QUERY:"query",CHAT:"chat",CHATS:"chats",CHATS_FOR_STATUS_UPDATE:"chats-for-status-update",RANGE:"range",MESSAGE:"message",MESSAGES:"messages",BASIC_INFO:"basic-info"}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ProfileClock=function(a){this.methodName=a,this.startDate=new Date},g.chatsdk.ProfileClock.prototype.end=function(){},g.chatsdk.ProfileClock.TAG="--> PERF.SDK:",a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.MuteAction={MUTE:"mute",UNMUTE:"unmute"},g.chatsdk.ChatType={P2P:1,GROUP:2,toString:function(a){return a==this.P2P?"chat":a==this.GROUP?"groupchat":null},fromString:function(a){return"chat"==type?this.P2P:"groupchat"==type?this.GROUP:null}},g.chatsdk.Chat=function(){g.chatsdk.EventDispatcher.call(this),this.hasPartialInformation=!1,this.isFetchingRecentMessagesForMissedMessages=!1,this.chatId=null,this._title=null,this._iconVersion=null,this._computedTitle=null,this._oldTitle=null,this._summeryText=null,this.chatType=0,this.unreadCount=0,this.lastMessageTimestamp=0,this.lastMessageSequenceNumber=0,this.participants={},this.thisUser=null,this.messagesMap={},this.messages=[],this.minSequenceNumber=0,this.composingParticipants=[],this.composingParticipantsInfo={},this.isMuted=!1,this.isMuteStatusUpdateInProgress=!1,this.isLoadingInProgress=!1,this.maxSequenceNumber=0,this.chatReadAtClientButNotAtServer=!1,this.unreadCountBeforeReadAtServer,this.searchInfo=null,this.messageDraft="",this.isOpened=!1,this.isInviteChat=!1,this.isAnyParticipantComposing=!1,this.isNeedToUpdateSummeryText=!1,this.last_message_sender_id=null,this.seenParticipants=[],this.moreParticipantsCount=0,this.shouldShowSeenParticipantsInList=!1},g.chatsdk.Chat.prototype=new g.chatsdk.EventDispatcher,g.chatsdk.Chat.prototype.constructor=g.chatsdk.Chat,g.chatsdk.Chat.prototype.setInfo=function(a,b,c,d,e,f,h,i,j,k,l,m){if(this.chatId=a,this._title=b,m&&-1!=m&&(this._iconVersion=m),this.chatType=d,this.unreadCount=+e||0,this.chatReadAtClientButNotAtServer=!1,this.lastMessageTimestamp=+f,this.lastMessageSequenceNumber=+h,j)this.thisUser=j;else{var n=g.chatsdk.ChatContextFactory.getChatContext().usersManager;this.thisUser=n.getThisUser()}return this.isMuted=i,this.isInviteChat=k?k:!1,this.last_message_sender_id=l,this.setSummeryText(c),this.hasPartialInformation=!1,this},g.chatsdk.Chat.prototype.setPartialInfo=function(a,b,c,d,e,f){return this.setInfo(a,null,null,b,0,c,d,e,f),this.hasPartialInformation=!0,this},g.chatsdk.Chat.prototype.toJSON=function(){var a={chatId:this.chatId,_title:this._title,_iconVersion:this._iconVersion,_summeryText:this.getLastMessageText(),chatType:this.chatType,unreadCount:this.unreadCount,lastMessageTimestamp:this.lastMessageTimestamp,lastMessageSequenceNumber:this.lastMessageSequenceNumber,isMuted:this.isMuted,participants:this.participants,messageDraft:this.messageDraft,minSequenceNumber:this.minSequenceNumber,maxSequenceNumber:this.maxSequenceNumber,last_message_sender_id:this.last_message_sender_id};return this.chatReadAtClientButNotAtServer&&(a.unreadCount=this.unreadCountBeforeReadAtServer||0,console.log("SET ==== "+this.unreadCountBeforeReadAtServer)),a},g.chatsdk.Chat.prototype.copy=function(){return(new g.chatsdk.Chat).initialize(this)},g.chatsdk.Chat.prototype.initialize=function(a){if(!a.chatId)throw new Error("Chat id can not be null");return this.setInfo(a.chatId,a._title,a._summeryText,a.chatType,a.unreadCount,a.lastMessageTimestamp,a.lastMessageSequenceNumber,a.isMuted,a.thisUser,a.isInviteChat,a.last_message_sender_id,a._iconVersion),this.chatReadAtClientButNotAtServer=a.chatReadAtClientButNotAtServer,this.unreadCountBeforeReadAtServer=a.unreadCountBeforeReadAtServer,this.participants=a.participants,this.messageDraft=a.messageDraft,this.minSequenceNumber=a.minSequenceNumber,this.maxSequenceNumber=a.maxSequenceNumber,this.updateThisUserMessageSeenParticipantsInfo(),this},g.chatsdk.Chat.prototype.update=function(a,b,c,d,e,f,h){this._title=a,this._computedTitle=null,this.getTitle(),h&&-1!=h&&(this._iconVersion=h),this.updateLastMessage(b,f),this.unreadCount!==c&&(this.unreadCount=+c||0,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.dispatch(g.chatsdk.ChatEvents.UNREAD_COUNT_CHANGED)),this.chatReadAtClientButNotAtServer=!1,this.isMuted=e,g.chatsdk.Chat.prototype.updateThisUserMessageSeenParticipantsInfo(),this.hasPartialInformation=!1,this.lastMessageTimestamp<+d&&(this.lastMessageTimestamp=+d)},g.chatsdk.Chat.prototype.updateLastMessage=function(a,b){b&&(this.last_message_sender_id=b),this.setSummeryText(a)},g.chatsdk.Chat.prototype.updateP2PChatId=function(a){this.chatId=a},g.chatsdk.Chat.prototype.updateChatStatusAsNonInviteChat=function(){this.isInviteChat=!1},g.chatsdk.Chat.prototype.addParticipant=function(a){a.userId&&!this.participants[a.userId]&&(this.participants[a.userId]=a,this._title&&null!=this._title&&0!=this._title.length||(this._computedTitle=null))},g.chatsdk.Chat.prototype.addParticipantFromGivenParticipantAndDeleteGivenParticipant=function(a,b){this.addParticipant(new g.chatsdk.ChatParticipant(b,a.name,a.status,a.lastSeenMessageSequenceNumber,a.statusTimestamp)),delete this.participants[a.userId]},g.chatsdk.Chat.prototype.participantForId=function(a){return this.participants[a]},g.chatsdk.Chat.prototype.getOtherParticipant=function(){var a=null;for(var b in this.participants)if(this.participants.hasOwnProperty(b)&&b!==this.thisUser.userId){a=this.participants[b];break}return a},g.chatsdk.Chat.prototype.isThisUserIsInParticipants=function(){var a=!1;for(var b in this.participants)if(this.participants.hasOwnProperty(b)&&b===this.thisUser.userId){a=!0;break}return a},g.chatsdk.Chat.prototype.addMessage=function(a){var b=g.chatsdk,c=!1;return a&&!this.messagesMap[a.messageId]&&(this.messagesMap[a.messageId]=a,this.messages.push(a),c=!0,(a.type===b.MessageType.INVITE||a.type===b.MessageType.LEFT)&&(this._title&&null!=this._title&&0!=this._title.length||(this._computedTitle=null)),a.type===b.MessageType.MESSAGE&&(this.isNeedToUpdateSummeryText=!0),this.updateSequenceNumbers(a.getSequenceNumber()),this.lastMessageTimestamp<a.getTimestamp()&&(this.lastMessageTimestamp=a.getTimestamp())),c},g.chatsdk.Chat.prototype.removeMessage=function(a){if(a&&0!=this.messages.length){var b=this.messages.map(function(a){return a.messageId}).indexOf(a.messageId);-1!==b&&(this.messages.splice(b,1),delete this.messagesMap[a.messageId])}},g.chatsdk.Chat.prototype.removeAllMessages=function(){for(;this.messages.length>0;)this.messages.pop();this.messagesMap={},this.minSequenceNumber=0,this.maxSequenceNumber=0},g.chatsdk.Chat.prototype.prependMessages=function(a){if(!a||0===a.length)return 0;var b,c=0,d=a.length,e=!1,f=null,h=null;if(d>0)for(var i=0,j=d-1;j>=0;--j){b=a[j],b.getSequenceNumber()>0&&(f?f.getSequenceNumber()>b.getSequenceNumber()&&(f=b):f=b),h?h.getSequenceNumber()<b.getSequenceNumber()&&(h=b):h=b;var k=this.messagesMap[b.messageId];if(k){if(b.clientTimestamp=k.clientTimestamp,0!==k.getSequenceNumber())continue;this.removeMessage(k),e=!0,--c}this.messages.splice(i++,0,b),this.messagesMap[b.messageId]=b,e=!0,++c}return e&&(g.chatsdk.ChatUtils.sortMessages(this.messages),this.isNeedToUpdateSummeryText=!0,f&&this.updateSequenceNumbers(f.getSequenceNumber()),h&&this.updateSequenceNumbers(h.getSequenceNumber()),b=this.messages[this.messages.length-1],this.lastMessageTimestamp<b.getTimestamp()&&(this.lastMessageTimestamp=b.getTimestamp())),c},g.chatsdk.Chat.prototype.appendMessages=function(a){if(!a||0===a.length)return 0;var b,c=0,d=a.length,e=!1,f=null,h=null;if(d>0)for(var i=0;d>i;++i){b=a[i],b.getSequenceNumber()>0&&(f?f.getSequenceNumber()>b.getSequenceNumber()&&(f=b):f=b),h?h.getSequenceNumber()<b.getSequenceNumber()&&(h=b):h=b;var j=this.messagesMap[b.messageId];if(j){if(b.clientTimestamp=j.clientTimestamp,0!==j.getSequenceNumber())continue;this.removeMessage(j),e=!0,--c}this.messages.push(b),this.messagesMap[b.messageId]=b,e=!0,++c}return e&&(g.chatsdk.ChatUtils.sortMessages(this.messages),this.isNeedToUpdateSummeryText=!0,f&&this.updateSequenceNumbers(f.getSequenceNumber()),this.updateSequenceNumbers(h.getSequenceNumber()),b=this.messages[this.messages.length-1],this.lastMessageTimestamp<b.getTimestamp()&&(this.lastMessageTimestamp=b.getTimestamp())),c},g.chatsdk.Chat.prototype.discardOldMessagesIfRequired=function(a){var b=this.messages.length,a=a||20;if(b>a){for(var c=b-a-1;c>=0;--c){var d=this.messages[c];delete this.messagesMap[d.messageId]}this.messages.splice(0,b-a),this.minSequenceNumber=this.messages[0].getSequenceNumber()}return b>a},g.chatsdk.Chat.prototype.messageForId=function(a){return this.messagesMap[a]},g.chatsdk.Chat.prototype.messageForSequenceNumber=function(a){var b;for(var c in this.messagesMap)if(this.messagesMap[c].getSequenceNumber()===a){b=this.messagesMap[c];break}return b},g.chatsdk.Chat.prototype.getUserMessageBeforeGivenMessage=function(a){var b=this.messages.indexOf(a);if(-1!=b)for(var c=b-1;c>=0;--c){var d=this.messages[c];if(d.type==g.chatsdk.MessageType.MESSAGE)return d}return null},g.chatsdk.Chat.prototype.messageUpdated=function(a){this.updateSequenceNumbers(a.getSequenceNumber()),this.lastMessageTimestamp<a.getTimestamp()&&(this.lastMessageTimestamp=a.getTimestamp())},g.chatsdk.Chat.prototype.updateSequenceNumbers=function(a){a&&a>0&&(this.minSequenceNumber||this.maxSequenceNumber?this.minSequenceNumber>a?this.minSequenceNumber=a:this.maxSequenceNumber<a&&(this.maxSequenceNumber=a):this.minSequenceNumber=this.maxSequenceNumber=a)},g.chatsdk.Chat.prototype.resetComputedTitle=function(){this._computedTitle=null},g.chatsdk.Chat.prototype.updateLastMessageSequenceNumber=function(a){this.lastMessageSequenceNumber<a&&(this.lastMessageSequenceNumber=a)},g.chatsdk.Chat.prototype.cancelMessage=function(a){
var b=!1,c=this.messages.length;if(null!=a){for(var d=c-1;d>=0;d--){var e=this.messages[d];if(e.messageId===a.messageId)break}d>=0&&(d==c-1&&a.getTimestamp()==this.lastMessageTimestamp&&(0==d?this.lastMessageTimestamp=0:this.lastMessageTimestamp=this.messages[d-1].getTimestamp()),this.messages.splice(d,1),delete this.messagesMap[a.messageId],g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.dispatch(g.chatsdk.ChatEvents.MESSAGE_REMOVED,{message:a}),b=!0)}return b},g.chatsdk.Chat.prototype.getOriginalTitle=function(a){return a?g.chatsdk.ChatUtils.unescape(this._title):this._title},g.chatsdk.Chat.prototype.getTitle=function(){if(this._title&&this._title.length)return g.chatsdk.ChatUtils.unescape(this._title);var a=!1,b=0,c=g.chatsdk.ChatContextFactory.getChatContext().usersManager;if(!this._computedTitle||""===this._computedTitle||"Group Chat"===this._computedTitle||"Empty Room"===this._computedTitle){var d="";for(var e in this.participants)if(this.participants.hasOwnProperty(e)){var f=this.participants[e];if(f.status==g.chatsdk.ParticipantStatus.JOINED)if(f.userId===c.getThisUser().userId)a=!0;else if(b++,3>b)if(d&&(d+=", "),this.chatType===g.chatsdk.ChatType.GROUP){if(null!=c){var h=c.getUserById(f.userId);d+=h&&h.firstName?h.firstName:f.name.split(" ")[0]}}else{var h=c.getUserById(f.userId);d=h?h.getDisplayName():f.name}}b-=2,b>0&&(d+=" +"+b),this._computedTitle=d}return this._computedTitle||(a?this._computedTitle="Group Chat":this._computedTitle="Empty Room"),this._computedTitle},g.chatsdk.Chat.prototype.getIconVersion=function(){return this._iconVersion},g.chatsdk.Chat.prototype.setIconVersion=function(a){-1!=a&&(this._iconVersion=a)},g.chatsdk.Chat.prototype.setComputedTitle=function(a){this._computedTitle=a},g.chatsdk.Chat.prototype.setTitle=function(a,b){b&&(this._oldTitle=this._title),this._title=a},g.chatsdk.Chat.prototype.restoreOldTitle=function(){null!=this._oldTitle&&(this._title=this._oldTitle,this._oldTitle=null)},g.chatsdk.Chat.prototype.clearOldTitle=function(){this._oldTitle=null},g.chatsdk.Chat.prototype.getLastMessageText=function(){var a=this.messages?this.messages.length:0,b="";if(a>0)for(var c=a-1;c>=0;--c){var d=this.messages[c];if(d.type==g.chatsdk.MessageType.MESSAGE){b=d.messageText;break}}return b&&b.length>0?b:this._summeryText||""},g.chatsdk.Chat.prototype.getSummeryText=function(){var a;if(this.isNeedToUpdateSummeryText){this.isNeedToUpdateSummeryText=!1;var b=this.messages?this.messages.length:0;if(b>0)for(var c=b-1;c>=0;--c){var d=this.messages[c];if(d.type==g.chatsdk.MessageType.MESSAGE){this.last_message_sender_id=d.senderId,this.setSummeryText(d.messageText);break}}}if(a=this._summeryText,this.last_message_sender_id)if(this.thisUser&&this.thisUser.userId==this.last_message_sender_id)a="You: "+this._summeryText;else if(this.chatType!==g.chatsdk.ChatType.P2P){var e=g.chatsdk.ChatContextFactory.getChatContext().usersManager,f=e.getUserById(this.last_message_sender_id);f&&f.firstName&&(a=f.firstName+": "+this._summeryText)}return a},g.chatsdk.Chat.prototype.setSummeryText=function(a){a&&(a=a.replace(/(<P[\w\W]*?<\/P>)/gi,"\n"),a=a.replace(/<a.*>(.*)<\/a>/gi,"$1"),this.isNeedToUpdateSummeryText=!1,this._summeryText=g.chatsdk.ChatUtils.unescape(a))},g.chatsdk.Chat.prototype.isInSearch=function(){return null!=this.searchInfo},g.chatsdk.Chat.prototype.lastMessage=function(){var a=this.messages.length;return a>0?this.messages[a-1]:null},g.chatsdk.Chat.prototype.hasMessages=function(){return this.messages.length>0},g.chatsdk.Chat.prototype.lastPresentMessageTimeStamp=function(){var a=this.lastMessage();return a?a.getTimestamp():0},g.chatsdk.Chat.prototype.participantEndedComposing=function(a){if(this.participants[a.userId]&&this.composingParticipantsInfo[a.userId]){var b=this.composingParticipants.map(function(a){return a.userId}).indexOf(a.userId);if(b>=0)return this.composingParticipants.splice(b,1),delete this.composingParticipantsInfo[a.userId],g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.dispatch(g.chatsdk.ChatEvents.COMPOSING_ENDED,{participant:a}),this.isAnyParticipantComposing=!1,!0}return!1},g.chatsdk.Chat.prototype.participantStartedComposing=function(a,b){return this.participants[a.userId]&&!this.composingParticipantsInfo[a.userId]?(this.composingParticipants.push(a),this.composingParticipantsInfo[a.userId]=b,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.dispatch(g.chatsdk.ChatEvents.COMPOSING_STARTED,{participant:a}),this.isAnyParticipantComposing=!0,!0):this.participants[a.userId]&&this.composingParticipantsInfo[a.userId]?(this.isAnyParticipantComposing=!0,this.composingParticipantsInfo[a.userId]=b,!0):!1},g.chatsdk.Chat.prototype.updateUnreadCount=function(a){this.unreadCount=+a||0,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.dispatch(g.chatsdk.ChatEvents.UNREAD_COUNT_CHANGED),this.chatReadAtClientButNotAtServer=!1},g.chatsdk.Chat.prototype.resetUnreadCount=function(){0!=this.unreadCount&&(this.unreadCount=0,g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.dispatch(g.chatsdk.ChatEvents.UNREAD_COUNT_CHANGED)),this.chatReadAtClientButNotAtServer=!1},g.chatsdk.Chat.prototype.clearAllComposing=function(){return this.composingParticipants.length>0?(this.composingParticipants=[],this.composingParticipantsInfo={},g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&this.dispatch(g.chatsdk.ChatEvents.COMPOSING_ENDED),this.isAnyParticipantComposing=!1,!0):!1},g.chatsdk.Chat.prototype.updateParticipantLastSeenMessageSequenceNumber=function(a,b){var c=this.participants[a];return c&&c.updateLastSeenMessageSequenceNumber(b),c},g.chatsdk.Chat.prototype.updateThisUserMessageSeenParticipantsInfo=function(){var a=this.participants,b=this.lastMessageSequenceNumber,c=this.last_message_sender_id,d=this.messages?this.messages.length:0;if(d>0)for(var e=d-1;e>=0;--e){var f=this.messages[e];if(f.type==g.chatsdk.MessageType.MESSAGE){b=f._sequenceNumber,c=f.senderId;break}}this.seenParticipants=[];for(var h in a)b>0&&a[h].lastSeenMessageSequenceNumber>=b&&h!=this.thisUser.userId&&this.seenParticipants.push(a[h]);this.seenParticipants.sort(function(a,b){return a.userId<b.userId?-1:1});var i=this.seenParticipants.length,j=3;i>j?(this.moreParticipantsCount=i-(j-1),this.moreParticipantsCount>9&&(this.moreParticipantsCount=9)):this.moreParticipantsCount="",!this.seenParticipants.length||this.thisUser.userId!==c||this.isMuted||this.unreadCount>0?this.shouldShowSeenParticipantsInList=!1:this.shouldShowSeenParticipantsInList=!0},g.chatsdk.Chat.prototype.getParticipantsAsArray=function(){var a,b,c,d=g.chatsdk.ChatContextFactory.getChatContext().usersManager,e=[],f=this.participants;for(c in f){var a=f[c];a.status==g.chatsdk.ParticipantStatus.JOINED&&a.userId!=this.thisUser.userId&&(b=d.getUser(a.userId),b&&(b.displayName=b.getDisplayName(),e.push(b)))}return e},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.MessageType={TYPING:0,MESSAGE:1,RECIPIENT_ACK:2,INVITE:3,LEFT:4,RETRY:5,CHAT_TITLE_UPDATE:6,CHAT_IMAGE_UPDATE:7,PARTICIPANT_REMOVED:8,fromMessageElement:function(a){var b=this.fromString(a.attr("message_type"));return null==b&&"1"==a.attr("is_system_message")&&(b=this.MESSAGE),b},fromString:function(a){var b=null;switch(a){case"composing":b=this.TYPING;break;case"message":b=this.MESSAGE;break;case"recipient_ack":b=this.RECIPIENT_ACK;break;case"invite":b=this.INVITE;break;case"leave":b=this.LEFT;break;case"message_retry":b=this.RETRY;break;case"chat_title_update":b=this.CHAT_TITLE_UPDATE;break;case"chat_icon":b=this.CHAT_IMAGE_UPDATE;break;case"remove":b=this.PARTICIPANT_REMOVED}return b},toString:function(a){var b=null;switch(a){case this.TYPING:b="composing";break;case this.MESSAGE:b="message";break;case this.RECIPIENT_ACK:b="recipient_ack";break;case this.INVITE:b="invite";break;case this.LEFT:b="leave";break;case this.RETRY:b="message_retry";break;case this.CHAT_TITLE_UPDATE:b="chat_title_update";break;case this.CHAT_IMAGE_UPDATE:b="chat_icon";break;case this.PARTICIPANT_REMOVED:b="remove"}return b}},g.chatsdk.ChatMessage=function(){this.messageId=null,this.skipNotification=!1,this.senderId=null,this.messageText=null,this._escapedMessageText=null,this.type=null,this._timestamp=0,this.clientTimestamp=0,this._sequenceNumber=0,this.invitees={},this.senderDevice=null,this.fileIds=null,this.skipUnreadCount=!1,this.isRetrying=!1,this.isLastValidMessageInChunk=null,this.isFirstValidMessageInChunk=null,this.htmlParsedMessageText=null,this.parsedTimestamp=null,this.parsedTimeStampForMessageDayWiseTime=null,this.invitationString=null,this.fileInfo=null,this.isFakeMessage=!1,this.isSystemMessage=!1,this.removedParticipant=""},g.chatsdk.ChatMessage.prototype.initialize=function(a){var b=a.fileInfo?new g.chatsdk.MessageFileInfo(a.fileInfo,!1):null;return this.setInfo(a.messageId,a.senderId,a.messageText,a.type,a._timestamp,a._sequenceNumber,b,!1,a.isSystemMessage),this},g.chatsdk.ChatMessage.prototype.setInfo=function(a,b,c,d,e,f,g,h,i){return this.messageId=a,this.senderId=b,this.messageText=c?c.replace(/(<P[\w\W]*?<\/P>)/gi,"\n"):null,this.type=d,this._timestamp=+e,this.clientTimestamp=+e,this._sequenceNumber=+f,this.fileInfo=g,this.isFakeMessage=h?h:!1,this.isSystemMessage=i?i:!1,this},g.chatsdk.ChatMessage.prototype.copy=function(){var a=new g.chatsdk.ChatMessage;return a.messageId=this.messageId,a.senderId=this.senderId,a.messageText=this.messageText,a.type=this.type,a._timestamp=this._timestamp,a.clientTimestamp=this.clientTimestamp,a._sequenceNumber=this._sequenceNumber,a.senderDevice=this.senderDevice,a.fileIds=this.fileIds,a.fileInfo=this.fileInfo,a.isSystemMessage=this.isSystemMessage,a},g.chatsdk.ChatMessage.prototype.getTimestamp=function(){return this._timestamp},g.chatsdk.ChatMessage.prototype.setTimestamp=function(a){this._timestamp=a,this.clientTimestamp||(this.clientTimestamp=a),this.parsedTimestamp=this.parsedTimeStampForMessageDayWiseTime=null},g.chatsdk.ChatMessage.prototype.getSequenceNumber=function(){return this._sequenceNumber},g.chatsdk.ChatMessage.prototype.setSequenceNumber=function(a){this._sequenceNumber=+a,this._sequenceNumber>0&&(this.isRetrying=!1)},g.chatsdk.ChatMessage.prototype.htmlParseMessageText=function(){!this.htmlParsedMessageText},g.chatsdk.ChatMessage.prototype.parseTimestamp=function(){!this.parsedTimestamp},g.chatsdk.ChatMessage.prototype.getUnEscapedMessageText=function(){var a=function(a){return a=a.replace(/&apos;/g,"'"),_.unescape(a)};return this._escapedMessageText||(this._escapedMessageText=a(this.messageText)),this._escapedMessageText},g.chatsdk.ChatMessage.prototype.parseTimeStampForMessageDayWiseTime=function(){!this.parsedTimeStampForMessageDayWiseTime},g.chatsdk.ChatMessage.prototype.updateFakeChatMessageAsOriginal=function(){this.isFakeMessage=!1},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ParticipantStatus={LEFT:"left",JOINED:"joined"},g.chatsdk.ChatParticipant=function(a,b,c,d,e){this.userId=a,this.name=b,this.status=c,this.lastSeenMessageSequenceNumber=d,this.statusTimestamp=e},g.chatsdk.ChatParticipant.prototype.initialize=function(a){return this.userId=a.userId,this.name=a.name,this.status=a.status,this.lastSeenMessageSequenceNumber=a.lastSeenMessageSequenceNumber,this.statusTimestamp=a.statusTimestamp,this},g.chatsdk.ChatParticipant.prototype.update=function(a,b,c,d){this.name=a,this.status=b,this.updateLastSeenMessageSequenceNumber(c),this.statusTimestamp=d},g.chatsdk.ChatParticipant.prototype.updateLastSeenMessageSequenceNumber=function(a){return this.lastSeenMessageSequenceNumber<a?(this.lastSeenMessageSequenceNumber=a,!0):!1},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.ChatSearchInfo=function(a,b,c,d,e,f,g,h,i){this.messages=[],this.matchedMessagesInfo=[],this._currentMatchIndex=-1,this._matchCount=0,this.initialMatch=d,this.chat=a,this.searchTerms=c,this.isTextSearch=null!==b&&b.length>0,this.fromSeqNo=g,this.toSeqNo=h,this.fetchedMessagesSeqMap={},this.fetchedMatches={},this.searchManager=e,this.fetchingInProgressMap={},this.callIdToMatchMap={},this.chatNeedsLoad=f,this.searchText=b,this.requestedMatchIndex=-1,this.requestedSeqNo=0,this.CONTEXT_COUNT=i?i:2,this.searchMatchesReceived,this.requestdMatch},g.chatsdk.ChatSearchInfo.prototype.start=function(){this.isTextSearch?this.chatNeedsLoad||(this.requestedSeqNo=this.initialMatch.sequenceNumber,this.fetchMatch(this.initialMatch)):this.loadMoreMessages(this.fromSeqNo,this.toSeqNo)},g.chatsdk.ChatSearchInfo.prototype.chatLoaded=function(){this.chatNeedsLoad=!1,this.requestedSeqNo=this.initialMatch.sequenceNumber,this.fetchMatch(this.initialMatch),this.syncWithMatchesReceived()},g.chatsdk.ChatSearchInfo.prototype.getMatchSequenceNumbers=function(a){var b=a.sequenceNumber;if(this.fetchedMatches[b])return null;for(var c=b-this.CONTEXT_COUNT;b>c&&(1>c||this.fetchedMessagesSeqMap[c]);c++);for(var d=Math.min(b+this.CONTEXT_COUNT,this.chat.lastMessageSequenceNumber);d>b&&this.fetchedMessagesSeqMap[d];d--);return c==b&&d==b&&this.fetchedMessagesSeqMap[b]?(this.fetchedMatches[b]=!0,null):[c,d]},g.chatsdk.ChatSearchInfo.prototype.addMessages=function(a,b){var c=a.length;if(c>=1){for(var d,e=a.length,f=0;e>f;f++)d=a[f],this.fetchedMessagesSeqMap[d.getSequenceNumber()]||(this.messages.push(d),this.fetchedMessagesSeqMap[d.getSequenceNumber()]=d);if(g.chatsdk.ChatUtils.sortMessages(this.messages),this.callIdToMatchMap[b]){var h=this.callIdToMatchMap[b];this.fetchedMatches[h]=!0,delete this.fetchingInProgressMap[h],delete this.callIdToMatchMap[b],0!=this.requestedSeqNo&&this.requestedSeqNo==h&&(this.requestIsFetched(h),this.requestedSeqNo=0)}else g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chat.dispatch(g.chatsdk.ChatEvents.LOADED_MORE_MSGS),this.searchManager.chatManager.dispatch(g.chatsdk.ChatEvents.LOADED_MORE_MSGS,{chat:this.chat}))}},g.chatsdk.ChatSearchInfo.prototype.getSearchTermsText=function(){return this.searchText},g.chatsdk.ChatSearchInfo.prototype.matchesInfoFetched=function(){return this._currentMatchIndex>-1&&0!=this._matchCount},g.chatsdk.ChatSearchInfo.prototype.getCurrentMatchIndex=function(){return this._currentMatchIndex},g.chatsdk.ChatSearchInfo.prototype.setCurrentMatchIndex=function(a){this._currentMatchIndex=a},g.chatsdk.ChatSearchInfo.prototype.getMatchCount=function(){return this._matchCount},g.chatsdk.ChatSearchInfo.prototype.moveToPreviousMatch=function(){if(this._currentMatchIndex>0&&this.requestedMatchIndex!=this._currentMatchIndex-1){this.requestedMatchIndex=this._currentMatchIndex-1;var a=this.matchedMessagesInfo[this.requestedMatchIndex];this.requestedSeqNo=a.sequenceNumber,this.fetchMatch(a)}},g.chatsdk.ChatSearchInfo.prototype.moveToNextMatch=function(){if(this._currentMatchIndex>-1&&this._currentMatchIndex<this._matchCount-1&&this.requestedMatchIndex!=this._currentMatchIndex+1){this.requestedMatchIndex=this._currentMatchIndex+1;var a=this.matchedMessagesInfo[this.requestedMatchIndex];this.requestedSeqNo=a.sequenceNumber,this.fetchMatch(a)}},g.chatsdk.ChatSearchInfo.prototype.matchesReceived=function(a){for(var b,c=a.length,d=0;c>d;++d)if(b=a[d],this.initialMatch.sequenceNumber==b.sequenceNumber){this._currentMatchIndex=d;break}this._matchCount=c,this.matchedMessagesInfo=a,this.searchMatchesReceived=!0,this.syncWithMatchesReceived()},g.chatsdk.ChatSearchInfo.prototype.syncWithMatchesReceived=function(){!this.chatNeedsLoad&&this.searchMatchesReceived&&(g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chat.dispatch(g.chatsdk.ChatEvents.SEARCH_MATCHES_RECEIVED),this.searchManager.chatManager.dispatch(g.chatsdk.ChatEvents.SEARCH_MATCHES_RECEIVED,{chat:this.chat})),this.fetchRequestedMatchIfAny())},g.chatsdk.ChatSearchInfo.prototype.fetchMatch=function(a){var b=a.sequenceNumber;if(this.fetchingInProgressMap[b]);else{var c=this.getMatchSequenceNumbers(a);if(c){this.fetchingInProgressMap[b]=!0;var d=this.searchManager.fetchMessages(this.chat,c[0],c[1]);this.callIdToMatchMap[d]=b}else this.requestedSeqNo==b&&this.requestIsFetched(b)}},g.chatsdk.ChatSearchInfo.prototype.requestIsFetched=function(a){var b=this.fetchedMessagesSeqMap[a];b&&(this.requestedMatchIndex>-1&&(this._currentMatchIndex=this.requestedMatchIndex),g.chatsdk.Constants.DISPATCH_EVENTS_TO_UI&&(this.chat.dispatch(g.chatsdk.ChatEvents.MATCH_FETCH_COMPLETE,{message:b}),this.searchManager.chatManager.dispatch(g.chatsdk.ChatEvents.MATCH_FETCH_COMPLETE,{chat:this.chat,message:b})))},g.chatsdk.ChatSearchInfo.prototype.isCurrentMatch=function(a){if(0==this._matchCount)return a.getSequenceNumber()==this.initialMatch.sequenceNumber;if(this._currentMatchIndex>=0){var b=this.matchedMessagesInfo[this._currentMatchIndex];if(b)return b.sequenceNumber==a.getSequenceNumber()}return!1},g.chatsdk.ChatSearchInfo.prototype.moveToMatch=function(a){if(this._matchCount){for(var b,c=0;c<this._matchCount;++c)if(b=this.matchedMessagesInfo[c],a.sequenceNumber==b.sequenceNumber){this.requestedMatchIndex=c;break}this.requestedSeqNo=a.sequenceNumber,this.fetchMatch(a)}else this.requestdMatch=a},g.chatsdk.ChatSearchInfo.prototype.fetchRequestedMatchIfAny=function(){if(this.requestdMatch){for(var a,b=0;b<this._matchCount;++b)if(a=this.matchedMessagesInfo[b],this.requestdMatch.sequenceNumber==a.sequenceNumber){this.requestedMatchIndex=b;break}this.requestedSeqNo=this.requestdMatch.sequenceNumber,this.fetchMatch(this.requestdMatch),this.requestdMatch=null}},g.chatsdk.ChatSearchInfo.prototype.loadMoreMessages=function(a,b){if(b>=a){var c=b-a>g.chatsdk.MessagesLoader.MESSAGE_FETCH_PAGE_SIZE?a+g.chatsdk.MessagesLoader.MESSAGE_FETCH_PAGE_SIZE:b;this.searchManager.fetchMessages(this.chat,a,c)}};var g=g||{};g.chatsdk=g.chatsdk||{},g.chatsdk.Contact=function(){this.userId="",this.email="",this.firstName="",this.lastName="",this.status="NOT_INVITED"},g.chatsdk.Contact.prototype.setContactInfoFromModel=function(a){this.firstName=a.firstName?a.firstName:"",this.lastName=a.lastName?a.lastName:"",this.email=a.email},g.chatsdk.Contact.prototype.getDisplayName=function(){var a=this.firstName||"",b=this.lastName||"",c=a+" "+b;return 0==c.trim().length&&(c=this.email),c},g.chatsdk.Contact.prototype.updateUserId=function(a){this.userId=a},g.chatsdk.Contact.prototype.updateContactStatusAsInvited=function(){this.status="INVITED"},g.chatsdk.Contact.prototype.updateContactStatusAsNotInvited=function(){this.status="NOT_INVITED"},g.chatsdk.Contact.prototype.isInvitedUser=function(){return"INVITED"===this.status},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.FileStatus={FS_SUCCESS:"fscc",FS_ERROR:"fsuf",FS_CONVERSION_REQ_FAILED:"fscrf",FS_CONVERSION_FAILED:"fscf",FS_SELECTED:"fsw",FS_UPLOADING:"fsug",FS_WAITING:"fsw",FS_CONVERTING:"fscrs",THUMB_NOT_INITIALIZED:"THUMB_NOT_INITIALIZED",THUMB_LOADING:"THUMB_LOADING",THUMB_LOADED:"THUMB_LOADED",THUMB_ERROR:"THUMB_ERROR"},g.chatsdk.MessageFileInfo=function(a,b){a&&(this.unescapedName=a.name||null,b&&a.name?this.name=g.chatsdk.ChatUtils.escape(a.name):this.name=this.unescapedName,this.size=a.size||0,this.type=a.type||null,this.fileExt=a.fileExt||null,!this.fileExt&&this.type&&(this.fileExt=this.type.toLowerCase()),this.fileId=a.fileId||null,this.fileNameId=a.fileUploadName||a.fileNameId||null,this.localUrl=a.localUrl||null,this.status=a.status||null,this.uploadProgress=a.uploadProgress||0,this.isUploading=!1,this.availablePreviews=a.availablePreviews||0,this.previewName=a.previewName||null,this.noOfPages=a.noOfPages||"0",this.width=a.width||0,this.height=a.height||0,this.fileFormat=a.fileFormat||null,this.originalName=a.originalName||null,this.thumbnailName="null"===a.thumbnailName||"undefined"===a.thumbnailName?null:a.thumbnailName,this.itemId=a.itemId||null,this.isAudio="Audio"===g.utils.getFileFormat(this.type),this.file=a)},g.chatsdk.MessageFileInfo.prototype.getName=function(){return g.chatsdk.ChatUtils.unescape(this.name)},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.MessagesFetchCall=function(a,b,c){this.messageIdToMessageMap={},this.messages=[],this.minSequenceNoForCall=b,this.maxSequenceNoForCall=c,this.hasFailedLoading=!1,this.insertMessages(a)},g.chatsdk.MessagesFetchCall.prototype.getMinSequenceNoOfMessages=function(){return this.messages.length>0?this.messages[0].getSequenceNumber():0},g.chatsdk.MessagesFetchCall.prototype.getMaxSequenceNoOfMessages=function(){var a=0,b=this.messages.length;return b>0&&(a=this.messages[b-1].getSequenceNumber()),a>this.maxSequenceNoForCall?a:this.maxSequenceNoForCall},g.chatsdk.MessagesFetchCall.prototype.insertMessages=function(a){a&&a.length>0&&(a.forEach(function(a){this.messageIdToMessageMap[a.messageId]||(this.messageIdToMessageMap[a.messageId]=a,this.messages.push(a))},this),g.chatsdk.ChatUtils.sortMessages(this.messages,!0))},g.chatsdk.MessagesFetchCall.prototype.allMessagesReceived=function(){if(0==this.messages.length)return!1;for(var a=!1,b=0,c=!1,d=this.messages.length,e=0;d>e;e++){var f=this.messages[e];if(a){if(f.getSequenceNumber()!=b+1)break;if(f.getSequenceNumber()==this.maxSequenceNoForCall){c=!0;break}b=f.getSequenceNumber()}else if(f.getSequenceNumber()==this.minSequenceNoForCall){if(a=!0,f.getSequenceNumber()==this.maxSequenceNoForCall){c=!0;break}b=f.getSequenceNumber()}}return c},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},g.chatsdk.User=function(){this._hasMobile=0,this.lastPingTime=0,this.profileImageType=-1,this.profileImageVersion=-1,this.userId="",this.email="",this.firstName="",this.lastName="",this.isAccessible=!0,this.shortName=null,this.img=null,this.rank=0,this.relevancy=0,this.presenceStatus=g.chatsdk.UserStatus.UNAVAILABLE,this._device=null,this.status=""},g.chatsdk.User.prototype.setInfo=function(a){this.userId=a.user_id,this.firstName=a.first_name,this.lastName=a.last_name,this.email=a.email,this.profileImageType=a.profile_image_type,this.profileImageVersion=a.profile_image_version,this.setHasMobile(a.has_mobile),this.setLastPingTime(a.last_ping_time),this.relevancy=a.relevancy||0,this.isAccessible=!0,this.status=a.status},g.chatsdk.User.prototype.setInfoFromModel=function(a){this.userId=a.user_id,this.firstName=a.first_name,this.lastName=a.last_name,this.email=a.email,this.profileImageType=a.profile_image_type,this.profileImageVersion=a.profile_image_version,this.setHasMobile(a.has_mobile),this.setLastPingTime(a.last_ping_time),this.rank=a.rank||0,this.isAccessible=!0,this.status=a.status},g.chatsdk.User.prototype.getDisplayName=function(){var a=this.firstName||"",b=this.lastName||"",c=a+" "+b;return c.trim()||(c=this.email),c},g.chatsdk.User.prototype.getEmail=function(){return this.email},g.chatsdk.User.prototype.setLastPingTime=function(a){"string"==typeof a&&(a=a.replace(/[-]/g,"/"),a=Date.parse(a+" GMT")),a&&this.lastPingTime<a&&(this.lastPingTime=a)},g.chatsdk.User.prototype.getLastPingTime=function(){return this.lastPingTime},g.chatsdk.User.prototype.setHasMobile=function(a){!a||"0"===a&&"1"===this.getHasMobile()||(this._hasMobile="true"===a||"1"===a?1:0)},g.chatsdk.User.prototype.getHasMobile=function(){return this._hasMobile},g.chatsdk.User.prototype.setDevice=function(a){a&&(this._hasMobile=1===this._hasMobile||a===g.chatsdk.UserDevice.MOBILE?1:0,this._device=a)},g.chatsdk.User.prototype.getDevice=function(){return this._device},g.chatsdk.User.prototype.getPresenceClass=function(){var a=this.getDevice();if(2==a)return"listUserStatusMobileWhite";switch(this.presenceStatus){case 1:return"listUserStatusOnline";case 2:return"listUserStatusBusy";case 3:return"listUserStatusIdle";case 4:return this.getHasMobile()?"listUserStatusMobileWhite":"listUserStatusOffline"}return""},g.chatsdk.User.prototype.compareTo=function(a){var b,c,d;return this.isInvitedUser()||a.isInvitedUser()?this.isInvitedUser()&&a.isInvitedUser()?(b=this.getDisplayName(),c=a.getDisplayName(),d=c>b?-1:b===c?0:1):d=this.isInvitedUser()?1:-1:this.presenceStatus!==a.presenceStatus?(b=this.presenceStatus,c=a.presenceStatus,d=c>b?-1:b===c?0:1):(b=this.rank,c=a.rank,d=c>b?1:b===c?0:-1),d},g.chatsdk.User.prototype.isInvitedUser=function(){return"INVITED"===this.status},a.com_convo=a.com_convo||{};var g=a.com_convo;g.chatsdk=g.chatsdk||{},b.module("convoApp").constant("ServerErrorCodes",{AUTHENTICATION_ERROR:10401,RESOURCE_NOT_ACCESSIBLE:10403,SERVICE_ERROR:10500,DATABASE_NOT_AVAILABLE:10503,UPDATE_AVAILABLE:11001,IMMEDIATE_UPDATE:11002}),b.module("convoApp").factory("connectivity",[function(){function b(){f=a.Offline,f.options={checkOnLoad:!0,interceptRequests:!1,reconnect:{initialDelay:1,delay:1},requests:!1,game:!1,checks:{xhr:{timeout:1e3}}},f.on("up",c),f.on("down",d),f.init(),g="up"===f.state}function c(){console.log("net connection up"),g=!0,e.trigger("up")}function d(){console.log("net connection down"),g=!1,e.trigger("down")}var e={};_.extend(e,Backbone.Events);var f,g;return e.initialize=b,e.isConnected=function(){return g},e}]),b.module("convoApp").factory("ServerComm",["$http","$q","config","connectivity","$location",function(a,b,d,e,f){function g(a){return 0===a.indexOf("feed/")||0===a.indexOf("analytics/")||0===a.indexOf("tags/get")||0===a.indexOf("hashtags/get")||0===a.indexOf("conversations/")||0===a.indexOf("chat/")||0===a.indexOf("tags/related")}function h(a){return 0===a.indexOf("analytics/api/")}function i(a,b,c){if(c)return d.APP_DOMAIN+"/"+a;if(b)return d.FEED_REST_URL+a;var e=j(),f=e.subdomain+d.REST_URL+a;return{url:f,domainData:e}}function j(){for(var a,b=0;U>b;b++)if(V[b].requests<=1){var c=V[b];c.requests++,b>0&&(V.splice(b,1),V.splice(0,0,c)),a=c;break}return a||(a=V[U-1],a.requests++),a}function k(a){a.cnvId=Z++,Y[a.cnvId]={requestTS:Date.now()}}function l(a){return Y[a.cnvId]}function m(a){Y[a.cnvId].responseTS=Date.now();var b=Y[a.cnvId];return delete Y[a.cnvId],b}function n(c,d){if(O)return ca;var e,f,h=d[0],j=d[2];if(j||g(h)){d[0]=i(h,!0);var n=b.defer();e=n.promise,R&&"feed/fetch"===h?(R=!1,a[c].apply(null,d).then(function(a){D(),n.resolve(a)},function(a){n.reject(a),R=!0}),k(e)):S?(o(n,c,d),k(e)):(I.trigger("callAwaitingFirstFeedFetchCallResolution","request endpoint: "+h),T.push({defer:n,promise:e,method:c,args:d,isRequestX:!1}))}else{var p=i(h,!1);f=p.domainData,d[0]=p.url,e=a[c].apply(null,d),k(e)}return e.then(null,function(a){if(401===a.status){if(!P){var b=l(e);b.requestTS>aa&&(P=!0,I.trigger("sessionExpired"))}}else 499===a.status&&(Q||(Q=!0,I.trigger("appUpdateAvailable",a.data.client_version)));H("request endpoint:"+h+", status: "+a.status+", statusText: "+a.statusText)})["finally"](function(){f&&f.requests--,m(e)}),e}function o(b,c,d){a[c].apply(null,d).then(function(a){b.resolve(a)},function(a){b.reject(a)})}function p(){return n("get",arguments)}function q(){return n("post",arguments)}function r(){return n("put",arguments)}function s(a,c,e,f){if(O)return ca;var j,k,l;if(h(c)){k=i(c,!1,!0);var m=b.defer();j=E(a,k,e,!1,0,!1,d.ANALYTICS_CALL_TIMEOUT)}else if(g(c)){k=i(c,!0);var m=b.defer();j=m.promise,R&&"feed/fetch"===c?(R=!1,E(a,k,e,!1,1e3,!0).then(function(a){D(),m.resolve(a)},function(a){m.reject(a),R=!0})):S?t(m,a,k,e,f):(I.trigger("callAwaitingFirstFeedFetchCallResolution","requestx endpoint: "+c),T.push({defer:m,method:a,url:k,data:e,maxRetries:f,isRequestX:!0}))}else{var n=i(c,!1);l=n.domainData,k=n.url,j=E(a,k,e,!1,f)}return j.then(null,function(a){if(401===a.status){if(!P){var b=a.requestInfo;b.requestTS>aa&&(P=!0,I.trigger("sessionExpired"))}}else 499===a.status&&(Q||(Q=!0,I.trigger("appUpdateAvailable",a.jqXHR.responseJSON.client_version)));H("requestx endpoint:"+c+", status: "+a.status+", statusText: "+a.statusText+", customStatus: "+a.customStatus)})["finally"](function(){l&&l.requests--}),j}function t(a,b,c,d,e){E(b,c,d,!1,e).then(function(b){a.resolve(b)},function(b){a.reject(b)})}function u(a,b){return s("get",a,null,b)}function v(a,b,c){return s("post",a,b,c)}function w(a,b,c){return s("put",a,b,c)}function x(a,b,c){return s("delete",a,b,c)}function y(a,b,d,e,f,h,j,k,l,m){if(O)return void(h&&h());var n,o=b;if(!d)if(g(b))o=i(b,!0);else{var p=i(b,!1);n=p.domainData,o=p.url}F(a,o,e,function(a,b,c){f&&f(),n&&n.requests--},function(a,c,d,e,f){k||(401===a.status?P||f.requestTS>aa&&(P=!0,I.trigger("sessionExpired")):499===a.status&&(Q||(Q=!0,I.trigger("appUpdateAvailable",a.responseJSON.client_version)))),h&&h(),n&&n.requests--,H("requestr endpoint:"+b+", status: "+a.status+", textStatus: "+c+", errorThrown: "+d+", customStatus: "+e)},!1,j,c,l,m)}function z(a,b,d,e,f){return y("get",a,!1,c,b,d,e,f)}function A(a,b,c,d,e,f){return y("post",a,!1,b,c,d,e,f)}function B(a,b,d,e){return y("get",a,!0,c,b,d,e,!0)}function C(a,b,c,d,e,f,g){return y("post",a,!0,b,e,f,g,!0,c,d)}function D(){S=!0;for(var a=T,b=0,c=a.length;c>b;b++){var d=a[b];d.isRequestX?t(d.defer,d.method,d.url,d.data,d.maxRetries):(o(d.defer,d.method,d.args),k(d.promise))}T=[],I.trigger("firstFeedFetchCallResolved")}function E(a,d,e,f,g,h,i){var j=b.defer();return F(a,d,e,function(a,b,c){j.resolve({data:a,status:c.status,statusText:b})},function(a,b,c,d,e){j.reject({data:c,status:a.status,statusText:b,customStatus:d,jqXHR:a,requestInfo:e})},f,g,c,c,c,h,i),j.promise}function F(a,b,d,f,g,h,i,j,l,n,o,p){p===c&&(p=3e4),j===c&&(j=0),i===c&&(i=5),l===c&&(l="json"),n===c&&(n="application/json");var q={url:b,type:a,data:d?JSON.stringify(d):null,dataType:l,contentType:n,timeout:p,headers:N,success:function(a,b,c){m(q),f(a,b,c)},error:function(c,k,p){var r=m(q),s=c.status;if(999===s&&(c.status=0,s=0),200===s)return void f(p,k,c);if(O||!o&&e.isConnected()&&408!==s&&500!==s&&502!==s&&503!==s&&504!==s&&(0!==s||"error"!==k&&"timeout"!==k&&"parsererror"!==k))g(c,k,p,k,r);else{j++;var t=!h&&i>j,u="timeout"===k;t&&!o&&u&&j>=2&&(t=!1),t?u?F(a,b,d,f,g,h,i,j,l,n,o):setTimeout(function(){F(a,b,d,f,g,h,i,j,l,n,o)},4500+Math.round(1e3*Math.random())):g(c,k,p,k,r)}}};q.xhrFields={withCredentials:!0},k(q),$.ajax(q)}function G(b){J=b,a.defaults.headers.common[L]=J,a.defaults.headers.get[L]=J,N[L]=J}function H(a){I.trigger("requestFailed",a)}var I={};_.extend(I,Backbone.Events);for(var J,K="X-Convo-Client-Version",L="X-Convo-Client-Id",M="X-Convo-Client-Type",N={},O=!1,P=!1,Q=!1,R=!0,S=!1,T=[],U=d.NUM_APP_SERVER_SUBDOMAINS,V=[],W=d.getAppServerSubdomains(),X=0;U>X;X++)V.push({subdomain:W[X],requests:0});var Y={},Z=1,aa=0,ba=b.defer(),ca=ba.promise;return ba.reject({data:null,status:977}),a.defaults.headers.common[K]=d.APP_VERSION,a.defaults.headers.common[M]=d.CLIENT_TYPE,a.defaults.headers.get={},a.defaults.headers.get[K]=d.APP_VERSION,a.defaults.headers.get[M]=d.CLIENT_TYPE,N[K]=d.APP_VERSION,N[M]=d.CLIENT_TYPE,d.on("clientTypeUpdated",function(){a.defaults.headers.common[M]=d.CLIENT_TYPE,a.defaults.headers.get[M]=d.CLIENT_TYPE,N[M]=d.CLIENT_TYPE}),a.defaults.withCredentials=!0,I.get=p,I.post=q,I.put=r,I.getx=u,I.postx=v,I.putx=w,I.deletex=x,I.getr=z,I.postr=A,I.getr_absurl=B,I.postr_absurl=C,I.setClientInstanceId=G,I.startBlockingRequests=function(){O=!0},I.stopBlockingRequests=function(){O=!1},I.setSessionExpired=function(a){P=a,P||(aa=Date.now(),R=!0,S=!1)},I}]),b.module("convoApp").directive("cnvCommentLinkPreviewRenderer",["$filter","$templateCache",function(a,b){return{restrict:"E",scope:!0,compile:function(c,d,e){return c.append(b.get("comments/cnvCommentLinkPreviewRenderer/cnvCommentLinkPreviewRenderer.tpl.html")),function(b,c,d,e){function f(){b.link=b.commentData.links[0],g(),b.title=b.link.title,b.previewText=b.link.preview_text,b.source=b.link.source,b.domain=a("getDomainNameFormUrl")(b.link.source)}function g(){b.link=b.commentData.links[0];var c=b.faviconUrl,d=b.linkThumbnailUrl;return b.link.hasOwnProperty("createdFrom")&&"client"===b.link.createdFrom?(b.link.original_thumbnail_url&&(b.linkThumbnailUrl=b.link.original_thumbnail_url),b.faviconUrl=b.link.original_favicon_url):(b.faviconUrl=a("getFaviconIconPath")(b.link),b.link.preview_image&&(b.linkThumbnailUrl=a("getLinkThumbnailPath")(b.link.preview_image,b.link.ver))),b.faviconUrl!==c||b.linkThumbnailUrl!==d}b.$on("cnvFeedItem.feedItemUpdated",function(){
var a=g();a&&b.$broadcast("render")}),f(),b.$broadcast("render")}}}}]),b.module("convoApp").directive("cnvCommentEditor",["$timeout","UploadService","utils","bannerService","$filter","$rootScope","AppLinks","$templateCache",function(b,c,d,e,f,g,h,i){return{restrict:"E",priority:0,scope:!0,compile:function(a,e,h){return a.append(i.get("comments/commentEditor/cnvCommentEditor.tpl.html")),function(a,e,h,i){function j(){}function k(){return a.commentEditorCtrl.snippetData?!0:!1}function l(a){return{initialized:!1,templateType:"comment-attachment",files:a}}function m(){return{}}function n(){var a={};return o(a),a}function o(b){b.controllers={},b.initialized=!1,a.commentEditorCtrl.setAllowAttachments(k()||a.commentEditorCtrl.attachedLink?!1:!0)}function p(b){a.commentEditorCtrl.attachments.initialized?a.$broadcast("enqueueFile",b):(a.commentEditorCtrl.attachments.controllers.manager_controller=new l(b),a.commentEditorCtrl.attachments.controllers.file_input_controller=new m,a.commentEditorCtrl.attachments.initialized=!0,a.commentEditorCtrl.setAllowAttachments(!1),k()&&(a.commentEditorCtrl.snippetData=null),a.$$phase||a.$digest())}function q(b,d){if(d&&d.event)if(d.event==c.EVENT_FILE_SELECTED){var e=[d.file];a.active||a.onDummyTextAreaClick();for(var f in e)e[f].noteId=a.commentEditorCtrl.getNoteId(),e[f].appInstanceId=a.commentEditorCtrl.getAppInstanceId(),e[f].conversationId=a.commentEditorCtrl.getCommentId(),e[f].uploadFrom="comment-editor";p(e),a.textEditorCtrl&&a.textEditorCtrl.focus()}else d.event==w?p(d.files):a.commentEditorCtrl.attachments.initialized&&a.commentEditorCtrl.attachments.controllers.file_input_controller.onChange&&(a.commentEditorCtrl.attachments.controllers.file_input_controller.onChange(d),a.$$phase||a.$digest())}function r(b){var c=k(),d=!1;a.commentEditorCtrl.allowAttachments?d=!0:c=!0,c&&a.showSingltonMessageBanner(),d||(b.preventDefault(),b.stopImmediatePropagation())}function s(a){$(a.target).closest(".comment-action.gif-attachment").length&&r(a)}function t(b){if(a.commentEditorCtrl.onFocus){var c=a.commentEditorCtrl.getCommentId();a.commentEditorCtrl.onFocus(c),a.focused=!0,g.$emit("comment-editor-just-focused",c),a.$broadcast("render")}}function u(b,c){b.stopPropagation(),a.active&&c!=a.commentEditorCtrl.getCommentId()&&(a.focused=!1,a.$broadcast("render"))}var v;e.cnvCommentEditorElement=new j,a.enableEmoji=a.$eval(h.enableEmoji),a.enableEmoji||$(".comment-action-bar cnv-emoji-popover").hide();var w="ecfa";a.lastClickedElementIsChildOfDropdownMenu=!1,a.focusEditor=function(){b(function(){a.textEditorCtrl&&a.textEditorCtrl.focus()},50)},a.isClickOnEmojiPopover=function(a){return $(".popover").find(a.target).length>0},a.initWithFiles=function(a){for(var b=[],g=0,h=a.length;h>g;g++){var i=d.copyObject(a[g]);i.noteId=i.item_id,i.appInstanceId=i.app_instance_id,i.conversationId=i.conversation_uid,i.uploadFrom="comment-editor",i.inEdit=!0,i.localUrl=i.thumbnail_name?f("getNoteThumbnailPath")(i,i.item_id,g,i.app_instance_id):f("getFileIconByType")(i.type,32),i.status=c.FILE_STATUS_CONVERSION_COMPLETED,i.noTitle=i.thumbnail_name?!0:!1,b.push(i)}e.find(".comment-file-input").trigger("cnvchange",[{event:w,files:b}])};var x={id:"#"+d.generateUniqueCharId(),dropZoneId:"#"+d.generateUniqueCharId(),pasteZoneId:"#"+d.generateUniqueCharId(),uploadAcknowledgement:function(){return a.commentEditorCtrl.allowAttachments||a.showSingltonMessageBanner(),a.commentEditorCtrl.allowAttachments}},y=setTimeout(function(){e.find(".comment-file-input").attr("id",x.id.slice(1)),e.find(".attachment-drop-zone .dropzone-target").attr("id",x.dropZoneId.slice(1)),e.find(".feed-comment-editor-cont").attr("id",x.pasteZoneId.slice(1)),a.commentEditorCtrl.attachments=new n,a.commentEditorCtrl.attachments.file_input_upload_context=c.init(x),v=a.commentEditorCtrl.attachments.file_input_upload_context.input_element,v.on("cnvchange",q)},0);a._resetAttachmentControllers=function(){a.commentEditorCtrl&&o(a.commentEditorCtrl.attachments)},a.openFileChooser=function(){var b=k();a.commentEditorCtrl.allowAttachments?e.find(".comment-file-input").trigger("click"):b=!0,b&&a.showSingltonMessageBanner()},a.triggerGiphyPopover=function(){d.fireEvent(e[0].querySelector(".comment-action.gif-attachment #iShowGiphyPopup"),"click")};var z=g.$on("comment-editor-just-focused",u);e[0].addEventListener("click",s,!0),e[0].addEventListener("focus",t,!0),a.$on("cnvEditor::editorRootBlur",function(b,c){var f=c.relatedTarget;d.isFirefox()&&(f=c.explicitOriginalTarget);var g=!1;a.lastClickedElementIsChildOfDropdownMenu||(f?e[0].contains(f)||0!==mentionsDropdown.length&&mentionsDropdown[0].contains(f)||(g=!0):g=!0),g&&a.$emit("cnvCommentEditor::focusOut")}),a.$on("$destroy",function(){e[0].removeEventListener("click",s,!0),e[0].removeEventListener("focus",t,!0),e.find(".comment-file-input").off(),z(),clearTimeout(y),v&&(v.off().remove(),v=null),a.$emit("comment-will-exit-from-edit")})}},controller:["$scope","$q","usersGroupsListProvider","hashtagsProvider","atMentionsListProvider","utils","onboardingService","alertsService","Comments","idToFilterUrlFilter","BlackListWordsService",function(b,c,d,g,i,j,k,l,m,n,o){function p(){}function q(){var a=!1;return y.active&&(a=y.textEditorCtrl.initialized&&y.textEditorCtrl.getEditorText().trim().length>0,!a&&y.commentEditorCtrl.attachments.initialized&&y.commentEditorCtrl.attachments.controllers.manager_controller.initialized&&(y.commentEditorCtrl.attachments.controllers.manager_controller.isBusy()||y.commentEditorCtrl.attachments.controllers.manager_controller.getAllFiles().length)&&(a=!0),!a&&y.commentEditorCtrl.snippetData&&(a=!0)),a}function r(a,b){return{searchText:a||"",actionType:b||""}}function s(a){if(D=y.commentEditorCtrl.comment_uid?y.commentEditorCtrl.comment_uid:j.generateUniqueId(),y.textEditorCtrl={initialized:!1,initialHtmlText:a||"",height:C,editComment:y.commentEditorCtrl.commentEdit,captureEvents:{},editorInitialized:t},y.active=!0,y.focused=!0,y.onBoardingEnabled=k.getFeedOnboardingState(),y.commentEditorCtrl.editorWillInitialized&&y.commentEditorCtrl.editorWillInitialized(),y.commentEditorCtrl.attachedLink){y.commentEditorCtrl.link=x(y.commentEditorCtrl.attachedLink.url);var b=y.commentEditorCtrl.attachedLink,c=y.commentEditorCtrl.link.serverData,d=y.commentEditorCtrl.link.linkResolveCtrl;d.domain=f("getDomainNameFormUrl")(b.url),d.preview_text=b.preview_text,d.title=b.title,d.favicon_url=b.original_favicon_url,d.images_urls=[b.original_thumbnail_url],d.favicon_url_encoded=d.favicon_url,d.images_urls_encoded=d.images_urls,d.selectedIndex="0",c.linkInfo={},c.linkInfo.createdFrom="client",c.linkInfo.previewText=b.preview_text,c.linkInfo.title=b.title,c.linkInfo.faviconUrl=b.original_favicon_url,c.linkInfo.thumbnailUrl=b.original_thumbnail_url,y.commentEditorCtrl.link.linkResolveCtrl.data_pre_computed=!0,y.commentEditorCtrl.link.initialized=!0,y.commentEditorCtrl.setAllowAttachments(!1)}y.$broadcast("render")}function t(){y.textEditorCtrl.captureEvents.on("text-change",u)}function u(a,b,c){if(y.commentEditorCtrl&&y.commentEditorCtrl.link&&y.commentEditorCtrl.link.serverData&&y.commentEditorCtrl.link.serverData.url_to_resolve){var d=y.commentEditorCtrl.link.serverData.url_to_resolve;d=d.replace(/(https?:\/\/)?(www\.)?/i,""),d=d.trim().split("/")[0],setTimeout(function(){-1==y.textEditorCtrl.getEditorText().indexOf(d)&&(y.commentEditorCtrl.link=null,y.commentEditorCtrl.allowAttachments=!0,y.$$phase||y.$digest())},0)}}function v(){y.active=!1,y.focused=!1,y.commentEditorCtrl.snippetData=null,y.commentEditorCtrl.showAtMentionAlert=!1,y.commentsHasBeenBlocked=!1,y.commentEditorCtrl.waiting=!1,y.commentEditorCtrl.link=null,y._resetAttachmentControllers(),y.giphyObject=new r,y.textEditorCtrl.captureEvents.off(),y.textEditorCtrl.captureEvents=null,y.textEditorCtrl=null,y.commentsInEditModeCurrentFocus.status="new_comment",y.$broadcast("render"),y.$emit("cnvCommentEditor::deactivated")}function w(){k.checkState()&&k.getFeedOnboardingState()?y.onBoardingEnabled=!0:y.onBoardingEnabled=!1,y.$broadcast("render")}function x(a){return{linkResolveCtrl:{initialized:!1,url:a},serverData:{url_to_resolve:a,user_dismissed_resolved_url:!1},initialized:!1}}var y=b;y.cnvCommentEditorScope=new p;var z=5,A={ALLOWED_STRING:"Drop files here",NOT_ALLOWED_STRING:"You can add one attachment to comments at a time."},B=null,C=y.commentEditorCtrl.height,D="",E=0;y.giphyObject=new r,y.active=!1,y.focused=!1,y.alwaysActiveActionbar="InAppCommentsPanel"===y.commentEditorCtrl.source?!0:!1,y.commentEditorCtrl.showAtMentionAlert=y.commentEditorCtrl.showAtMentionAlert||!1,y.dropzoneCtrl={message:A.ALLOWED_STRING},y.onBoardingEnabled=!1,y.commentsHasBeenBlocked=!1,k.on("cnvOnboarding:stateChange",w),k.on("cnvOnboarding:feedOnboardingStateChange",w),b.$on("$destroy",function(){k.off("cnvOnboarding:stateChange",w),k.off("cnvOnboarding:feedOnboardingStateChange",w),y.commentEditorCtrl&&y.commentEditorCtrl.attachments&&y.commentEditorCtrl.attachments.file_input_upload_context&&(y.commentEditorCtrl.attachments.file_input_upload_context.destroy(),y.commentEditorCtrl.attachments.file_input_upload_context=null),y.textEditorCtrl=null,y.commentEditorCtrl=null}),y.checkIfCommentingClosed=function(){var a=!1;return y.commentEditorCtrl.permissions&&y.commentEditorCtrl.permissions.block&&!y.commentEditorCtrl.permissions.disable?q()?y.commentsHasBeenBlocked=!0:(a=!0,y.commentsHasBeenBlocked=!1):y.commentsHasBeenBlocked=!1,a},y.onDummyTextAreaClick=function(){s()},y.onEscKeyPressInTextEditor=function(){y.commentEditorCtrl.disableEsc||(v(),y.commentEditorCtrl.onEscInCommentEditorEditor&&y.commentEditorCtrl.onEscInCommentEditorEditor())},y.spaceKeyPressedInTextEditor=function(){y.textEditorCtrl.cleanBlackListedWords()},y.tabKeyPressedInTextEditor=function(){y.textEditorCtrl.getSelection(!0);y.textEditorCtrl.tabKeyPress()},y.enterKeyPressedInTextEditor=function(){y.textEditorCtrl.cleanBlackListedWords()},y.cnvClickedOutsideThis=function(a){y.commentEditorCtrl.clickOutsideExit||!y.active||y.isClickOnEmojiPopover(a)||0==q()&&v(),y.lastClickedElementIsChildOfDropdownMenu=!1;var b=$("body > ul.dropdown-menu");b.length>0&&b[0].contains(a.target)&&(y.lastClickedElementIsChildOfDropdownMenu=!0)};var F=!1;y.onTextEditorSubmitOnEnter=function(){var a=!0;y.commentsHasBeenBlocked&&!F&&(F=!0,a=!1,l.alertModal("Convo","You no longer have permissions to comment on this post.","Ok",function(){F=!1},!0,!0)),a&&y.commentEditorCtrl&&y.commentEditorCtrl.onCommentEntered&&y.commentEditorCtrl.onCommentEntered(o.clean(y.textEditorCtrl.getEditorText()),o.cleanFromHTMLText(y.textEditorCtrl.getEditorCleanHtmlText()))},y.getShareWithDropdownItems=function(a,b,d){var e=c.defer(),f=!1,g=!0;return"@"==b?(!a&&y.commentEditorCtrl.permissions&&y.commentEditorCtrl.permissions.allowLegitAtMentions&&(y.textEditorCtrl.getEditorText().trim().length&&(y.commentEditorCtrl.showAtMentionAlert=!0),g=!1,f=!0),g?y.commentEditorCtrl.allowAttachments?e.resolve(i.queryPublishableUsersGroupsAndCommands(a,d+z,i.sources.COMMENT,y.commentEditorCtrl.itemSharingInfoWithDropdownItems)):e.resolve(i.queryPublishableUsersAndGroups(a,d+z,y.commentEditorCtrl.itemSharingInfoWithDropdownItems)):e.resolve([])):":"==b&&e.resolve(items=i.queryEmojiData(a)),f&&y.$broadcast("render"),e.promise},y.getHashtags=function(a){var b=c.defer();return b.resolve(g.getHashtagsDropdownItems(a)),b.promise},y.onAtMentionAdded=function(a){E++,y.commentEditorCtrl.permissions&&y.commentEditorCtrl.permissions.allowLegitAtMentions?y.commentEditorCtrl.showAtMentionAlert=!1:y.commentEditorCtrl.showAtMentionAlert=!0,y.$broadcast("render")},y.onAtMentionRemoved=function(a){E--,0>=E&&(y.commentEditorCtrl.showAtMentionAlert=!1,y.$broadcast("render"))},y.onSelectionRemoved=function(a){setTimeout(function(){a&&a.length||(E=0,y.commentEditorCtrl.showAtMentionAlert=!1,y.$broadcast("render"))},100)},y.removeCommentEditorSnippetData=function(){y.commentEditorCtrl.commentEdit?(y.commentEditorCtrl.attachContext=!1,y.commentEditorCtrl.snippetData=null,y.commentEditorCtrl.setAllowAttachments(!0)):y.removeCommentEditorSnippet()},y.editCommentRemoveEditorSnippet=function(){y.commentEditorCtrl.commentEdit&&(y.editCommentEditorCtrl.attachContext=!1)},y.onFocusOut=function(){console.log("editor focusout."),y.commentEditorCtrl&&y.commentEditorCtrl.onFocusOut&&y.commentEditorCtrl.onFocusOut()},y.onCommandExecuted=function(a,b){setTimeout(function(){B=y.textEditorCtrl.getSelection(),y.giphyObject=new r(b,"command"),y.triggerGiphyPopover()},0)},y.showSingltonMessageBanner=function(){e.showBanner("You can add one attachment to comments at a time.",!1,!1,null,3e3)},y.getEditCommentSnippetImage=function(){var a="";if(y.commentEditorCtrl.snippetData.imageData)a=y.commentEditorCtrl.snippetData.imageData;else{var b=y.commentData,c=b.resource_link.collaboration_info.snippet_data.imageData;a=c?c:f("getSnippetImagePath")(b.resource_link.collaboration_info.snippet_data.data.fileName,b.uid)}return a},y.$on("cnvShareLink:renderingComplete",function(b,c){if(c){var d={};d.createdFrom="client",d.thumbnailUrl=c.originalThumbnailUrl,d.faviconUrl=c.faviconUrl,d.previewText=c.previewText,d.title=c.title,y.commentEditorCtrl.link.serverData.linkInfo=d}a.setTimeout(function(){y.textEditorCtrl.focus()},0)}),y.onUrlAddedInCommentEditor=function(a){var b=a.link.href,c=!0;h.parseUrl(b)&&(c=!1),c&&y.commentEditorCtrl.hasOwnProperty("snippetData")&&y.commentEditorCtrl.snippetData&&(c=!1),c&&y.commentEditorCtrl.attachments&&y.commentEditorCtrl.attachments.controllers&&y.commentEditorCtrl.attachments.controllers.manager_controller&&y.commentEditorCtrl.attachments.controllers.manager_controller.initialized&&(c=!1),c&&y.commentEditorCtrl.link&&y.commentEditorCtrl.link.initialized&&(c=!1),c&&(y.commentEditorCtrl.link=x(b),y.commentEditorCtrl.link.initialized=!0,y.commentEditorCtrl.setAllowAttachments(!1))},y.closeLinkPreview=function(a,b){y.commentEditorCtrl.link.linkResolveCtrl=null,y.commentEditorCtrl.link.serverData.user_dismissed_resolved_url=!0,y.commentEditorCtrl.link.serverData.url_to_resolve=null,y.commentEditorCtrl.setAllowAttachments(!0),y.$broadcast("render"),y.$$phase||y.$digest(),b&&b.hasOwnProperty("files")&&y.$broadcast("upload_url_as_image",b.files.map(function(a){return a.upload_from="comment-editor",a}))},y.commentEditorCtrl.setAllowAttachments=function(a){y.commentEditorCtrl.allowAttachments=a,y.dropzoneCtrl.message=y.commentEditorCtrl.allowAttachments===!1?A.NOT_ALLOWED_STRING:A.ALLOWED_STRING},y.commentEditorCtrl.getCommentId=function(){return y.commentEditorCtrl.comment_uid?y.commentEditorCtrl.comment_uid:D},y.commentEditorCtrl.clearContent=function(){y.textEditorCtrl.clearContent(),D=j.generateUniqueId(),y.commentEditorCtrl.showAtMentionAlert=!1,y.commentEditorCtrl.link=null,y._resetAttachmentControllers(),y.$broadcast("render")},y.commentEditorCtrl.activate=function(a,c){y.active?c?(y.textEditorCtrl.focus(),a&&y.textEditorCtrl.setContent(a,!0)):y.textEditorCtrl.setContent(a):(s(a),"$apply"!=b.$root.$$phase&&"$digest"!=b.$root.$$phase&&b.$digest())},y.commentEditorCtrl.getContent=function(){return y.textEditorCtrl.getEditorText()},y.commentEditorCtrl.setFocus=function(){y.focusEditor()},y.commentEditorCtrl.getHtmlContent=function(){return y.textEditorCtrl.getEditorHtmlText()},y.commentEditorCtrl.destroy=function(){return y.textEditorCtrl?y.textEditorCtrl.destroy:void 0},y.commentEditorCtrl.deactivate=function(){v()},y.commentEditorCtrl.render=function(){b.$broadcast("render")},y.$on("all-files-removed",function(a){a.stopPropagation(),y._resetAttachmentControllers()}),y.$on("giphyPopupClosed",function(){if(y.active)if(B){var a=y.textEditorCtrl.getSelection();a||y.textEditorCtrl.setSelection(B,"USER"),B=null}else y.textEditorCtrl.focus()}),y.$on("onLinkModeClose",y.closeLinkPreview),function(){y.commentEditorCtrl.instantLoad&&(s(y.commentEditorCtrl.initialText||""),setTimeout(function(){b.$$phase||b.$digest()},100)),y.commentEditorCtrl.attachedFiles&&setTimeout(function(){setTimeout(function(){y.initWithFiles(y.commentEditorCtrl.attachedFiles)},0)},0),y.commentEditorCtrl.initialized=!0,y.commentEditorCtrl.trigger&&y.commentEditorCtrl.trigger("initialized")}()}]}}]),b.module("convoApp").factory("Comments",["ServerComm","$rootScope","$q","utils","datetimeService","rtcNotificationManager","RTCNotification","accountInfo","awsService","userProvider","$filter","userInfo","logger",function(a,d,e,f,h,i,j,k,l,m,n,o,p){function q(){return{total_comments:0,comments:[],stale:!1}}function r(a,b,c,d){var e=q();if(a||(a=[]),c&&(a=M(a)),d)for(var f=0;f<a.length;f++){var g=a[f];g._comment_title=I(g.comment_text)}return e.comments=a,e.total_comments=b,e}function s(a,b,c,e,f){var g,i,j=h.getServerTimestamp(),k=n("limitHtmlText")(e,300,!0);k.isTruncated?(g=k.htmlStr,i=!0):(g=null,i=!1);var l,m,k=n("limitHtmlText")(e,130,!0);k.isTruncated?(l=k.htmlStr,m=!0):(l=null,m=!1);var o={is_posting:!0,uid:c,$$hashKey:c,app_instance_id:b,citem_uid:c,from_user:d.login_data.user.user_id,comment_text:e,comment_text_less:g,comment_text_less_snippet:l,has_more_text:i,has_more_text_snippet:m,resource_id:a,files:f,creation_timestamp:j,update_timestamp:j,like_info:{liked_by:null,liked_by_me:!1,likes_count:0,like_timestamp:0},_comment_title:I(e)};return o}function t(a){if(a){for(var b={},c=0;c<a.length;c++){var d=a[c],e=d[0]+"_"+d[1];b[e]=Q[e]}Q=b}else Q={}}function u(){R={}}function v(a,b,c){Q[b+"_"+a]=c}function w(a,b,c){R[b+"_"+a]=c}function x(a,b){return Q[b+"_"+a]}function y(a,b){return R[b+"_"+a]}function z(a,b,c,d){var e;if(e=d&&d!==Q?y(b,c):x(b,c),!e)return null;for(var f=e.comments,g=f.length,h=0;g>h;h++)if(f[h].uid==a)return f[h];return null}function A(a,b,c,d){var e;if(e=d&&d!==Q?y(b,c):x(b,c))for(var f=e.comments,g=f.length,h=0;g>h;h++)if(f[h].uid==a){f.splice(h,1),e.total_comments--;break}U.hasOwnProperty(a)&&(U[a].comment_exists=!1)}function B(a,b){var c=x(b,a);c&&C(c)}function C(a){a.comments.splice(0,a.comments.length),a.total_comments=0,a.stale=!1}function D(){var a=[];_.each(Q,function(b,c){b.stale||a.push(c)}),_.each(a,function(a){delete Q[a]})}function E(a,b){var c=x(b,a);c&&(c.stale=!0)}function F(a,b,c){var d=z(c,b,a);d&&(d._unread=!0)}function G(a,b,c){for(var d=x(b,a).comments,e=d.length,f=0;e>f;f++)d[f]._unread=!1}function H(a,b){for(var c=x(b,a).comments,d=c.length,e=0;d>e;e++)c[e].is_posting=!1}function I(a){return a=$("<div>"+a+"</div>")[0].textContent,a.substring(0,25)+(a.length>25?"...":"")}function J(a,b,c,d){K(a,b,c,d,"RTC")}function K(a,b,c,d,e,f){d||(d=[]);var g;g=f?y(a,b):x(a,b),g&&g.stale&&C(g);for(var h={},i=0;i<d.length;i++){var j=d[i];j.$$hashKey=j.uid,j?2!=j.update_kind||o.isAdminMode()?(j._comment_title||(j._comment_title=I(j.comment_text)),j.comment_text=j.comment_text.replace(/<p\s*align=\"LEFT\"><\/p>/gi,"<br>")):g||(d.splice(i,1),i--):(p.error("commentsService: null comment received from server"),d.splice(i,1),i--)}if(g){g.total_comments=c,h=L(g.comments,d,!1),g.comments=M(g.comments);var k="RTC"===e||"FEED_POLL"===e;V.trigger("commentsUpdated",{resource_id:a,app_instance_id:b,data:g,areNewerComments:k,updateInfo:h})}else g=q(),g.total_comments=c,g.comments=M(d),f?w(a,b,g):v(a,b,g);return g}function L(a,b,d){for(var e=N(a),f=[],g=0;g<b.length;g++){var h=e[b[g].uid];if(h!=c)if(2!=b[g].update_kind||o.isAdminMode()){if(b[g]._unread=a[h]._unread,b[g].files&&a[h].files)for(var i=0;i<b[g].files.length;i++){var j=a[h].files[i]||{};j.hasOwnProperty("preLocalData")&&(b[g].files[i].preLocalData=j.preLocalData)}!b[g].files&&a[h].files&&U.hasOwnProperty(b[g].uid)&&(U[b[g].uid].file_exists=!1),a[h]=b[g]}else a.splice(h,1),e=N(a),U.hasOwnProperty(b[g].uid)&&(U[b[g].uid].comment_exists=!1),U[b[g].uid]={};else if(2!=b[g].update_kind||o.isAdminMode()){if(d)for(var k=b[g].creation_timestamp,l=a.length-2;l>=0;l--){if(k>=a[l].creation_timestamp){a.splice(l+1,0,b[g]);break}0===l&&a.splice(0,0,b[g])}else a.push(b[g]);f.push({uid:b[g].uid,from_user:b[g].from_user})}}return{addedComments:f}}function M(a){return _.sortBy(a,"creation_timestamp")}function N(a){for(var b={},c=0;c<a.length;c++)b[a[c].uid]=c;return b}function O(a,b){var c=P(a.imageData),d=k.getAccountId()+"/snippets/"+b+"/"+a.snippetData.data.fileName,e=l.uploadSnippetImage(c,d);return e}function P(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}var Q={},R={},S={},T={},U={};i.addListener(g.rtc.PubsubEvents.NOTIFICATION_RECEIVE,function(a){var b=a.notification,a=b.data,c=!1;if(b.type===j.COMMENT_ADDED||b.type===j.COMMENT_UPDATED||b.type===j.COMMENT_DELETED){if(V.getUser(a.from_user)||a.user){if(!V.getUser(a.from_user)&&a.user){var d={};d[a.from_user]=a.user[a.from_user],V.updateUsersAndGroups(d)}}else c=!0;if(c)return void V.trigger("commentRTCChangeReceived");var e=x(a.resource_id,a.app_instance_id);if(b.type===j.COMMENT_UPDATED)z(a.uid,a.resource_id,a.app_instance_id)&&(J(a.resource_id,a.app_instance_id,e.total_comments,[a]),V.trigger("commentUpdatedByRemoteUser",a));else if(b.type===j.COMMENT_DELETED){if(!z(a.uid,a.resource_id,a.app_instance_id))return;J(a.resource_id,a.app_instance_id,e.total_comments-1,[a]),V.trigger("commentDeletedByRemoteUser",a)}V.trigger("commentRTCChangeReceived")}});var V={postComment:function(b,d,g,h,k,l,m,n,p,r,t,u,z,A){function B(){var c=a.postx("comments",E);return c.then(function(a){var c=a.data;t.creation_timestamp=parseInt(c.data.time_stamp),t.update_timestamp=t.creation_timestamp,V.trigger("commentAdded");var d={uid:m,citem_uid:m,app_instance_id:k,resource_id:g,updated_by:o.user_id,update_kind:0,creation_timestamp:c.data.time_stamp,update_timestamp:c.data.time_stamp,resource_link:E.resource_link,comment_text:b,from_user:o.user_id,should_show_snippet:!0,like_info:{likes_count:0,liked_by_me:!1,like_timestamp:0,liked_by:null}};c.files&&c.files[0]&&c.files[0].origional_file&&(d.files=c.files[0].origional_file),d.user={},d.user[o.user_id]=_.extend({accessible:!0},_.omit(o.getUserInfo(),"user_id"));var e=new j;e.type=j.COMMENT_ADDED,e.data=d,i.send(e)},function(a){console.log("error in post comment.")}),c}function C(){t.is_posting=!1,t.posting_failed=!1,t.postCommentFunctionArgumentsStringified=c}function D(){t.is_posting=!1,t.posting_failed=!0,t.postCommentFunctionArgumentsStringified=JSON.stringify({commentText:b,feedId:d,resourceId:g,resourceType:h,appInstanceId:k,snippetData:l,conversationUID:m,attachedFiles:r,resourceLinkData:n,collaborationInfo:p,useSearchResultsCommentsStore:A})}var E,F=e.defer(),G=null!=t;m||(m=f.generateUniqueId()),l&&m&&n?(E={method:"addComment",comment_text:b,feed_id:d,resource_id:g,resource_type:h,conversation_uid:m,resource_link:{resource_path:n,collaboration_info:{snippet_data:l.snippetData}}},l&&l.comment_file_data&&(E.resource_link.collaboration_info.on_comment_attachment={attachment_comment_id:l.comment_file_data.comment_id,file:l.comment_file_data.file}),p&&p.replied_to_comment_id&&(E.resource_link.collaboration_info.replied_to_comment_id=p.replied_to_comment_id),p&&p.replied_to_user_id&&(E.resource_link.collaboration_info.replied_to_user_id=p.replied_to_user_id),p?E.resource_link.collaboration_info.parent_resource_index=p.parent_resource_index:E.resource_link.collaboration_info.parent_resource_index=0,l.imageData&&(E.resource_link.collaboration_info.snippet_data.imageData=l.imageData),r&&r.serverData.length&&(E.files=r.serverData)):(E={method:"addComment",comment_text:b,feed_id:d,resource_id:g,resource_type:h,conversation_uid:m,resource_link:{resource_path:n,collaboration_info:null}},p?E.resource_link.collaboration_info={parent_resource_index:p.parent_resource_index}:E.resource_link.collaboration_info={parent_resource_index:0},r&&r.serverData.length&&(E.files=r.serverData),p&&p.replied_to_comment_id&&(E.resource_link.collaboration_info.replied_to_comment_id=p.replied_to_comment_id),p&&p.replied_to_user_id&&(E.resource_link.collaboration_info.replied_to_user_id=p.replied_to_user_id)),E.citem_uid=m;var H;if(H=A?y(g,k):x(g,k),H||(H=q(),A?w(g,k,H):v(g,k,H)),G||(t=s(g,k,m,b,r&&r.data)),t.resource_link=E.resource_link,z&&null!=z.linkInfo&&"client"===z.linkInfo.createdFrom){var I=z.linkInfo;t.links=[{createdFrom:"client",original_thumbnail_url:I.thumbnailUrl,original_favicon_url:I.faviconUrl,preview_text:I.previewText,title:I.title,source:z.url_to_resolve}]}return G||(H.comments.push(t),H.total_comments++),t.is_posting=!0,t.posting_failed=!1,u&&(E.mp_source=u),z&&z.hasOwnProperty("url_to_resolve")&&(E.url_to_resolve=z.url_to_resolve),z&&z.hasOwnProperty("user_dismissed_resolved_url")&&(E.user_dismissed_resolved_url=z.user_dismissed_resolved_url),l&&l.imageData&&!l.fileViewerTextAnnotation?O(l,m).then(function(a){B().then(function(a){C(),F.resolve(a.data)},function(a){D(),F.reject(a)})},function(a){D(),F.reject(a)}):B().then(function(a){C(),F.resolve(a.data)},function(a){D(),F.reject(a)}),F.promise},retryFailedPostComment:function(a,b,d){var e=z(a,b,d),f=JSON.parse(e.postCommentFunctionArgumentsStringified);return V.postComment(f.commentText,f.feedId,f.resourceId,f.resourceType,f.appInstanceId,f.snippetData,f.conversationUID,f.resourceLinkData,f.collaborationInfo,f.attachedFiles,e,c,c,f.useSearchResultsCommentsStore)},discardFailedPostComment:function(a,b,c){A(a,b,c)},editComment:function(b,c,d,e,f,g,k,l,m,n,p,q){var r=z(b,e,f,q?R:Q);r||(r=p);var s=r.comment_text,t=r.update_timestamp,u=r.resource_link.collaboration_info,v=r.files,w=r.links;r.is_editing=!0,r.comment_text=d,r.update_timestamp=h.getServerTimestamp(),r.files=m.data,r.files&&r.files.length&&(r.links=null);var x={snippet_data:null,parent_resource_index:0};u&&u.replied_to_comment_id&&u.replied_to_user_id&&(x.replied_to_comment_id=u.replied_to_comment_id,x.replied_to_user_id=u.replied_to_user_id),l&&(x.on_comment_attachment=l),g?(k&&(r.resource_link.collaboration_info?r.resource_link.collaboration_info.snippet_data=k:r.resource_link.collaboration_info={snippet_data:k,parent_resource_index:0}),x.snippet_data=r.resource_link.collaboration_info.snippet_data):r.resource_link.collaboration_info=null;var y={method:"updateComment",conversation_uid:b,citem_uid:c,comment_text:d,resource_id:e,app_instance_id:f,collaboration_info:x};if(m&&m.serverData&&m.serverData.length&&(y.files=m.serverData),n&&n.hasOwnProperty("url_to_resolve")&&(y.url_to_resolve=n.url_to_resolve),n&&n.hasOwnProperty("user_dismissed_resolved_url")&&(y.user_dismissed_resolved_url=n.user_dismissed_resolved_url),n&&null!=n.linkInfo&&"client"===n.linkInfo.createdFrom){var A=n.linkInfo;r.links=[{createdFrom:"client",original_thumbnail_url:A.thumbnailUrl,original_favicon_url:A.faviconUrl,preview_text:A.previewText,title:A.title,source:n.url_to_resolve}]}else r.links=null;var B=a.post("comments",y).success(function(a){r.is_editing=!1,V.trigger("commentUpdated");var d={uid:b,citem_uid:c,app_instance_id:f,resource_id:e,updated_by:o.user_id,update_kind:1,creation_timestamp:r.creation_timestamp,update_timestamp:a.data.time_stamp,resource_link:r.resource_link,comment_text:r.comment_text,summary:a.data.summary,from_user:o.user_id,should_show_snippet:!0,like_info:r.like_info};r.links&&r.links.length?w&&w.length?r.links[0].source==w[0].source?d.links=r.links:d.links=null:d.links=r.links:d.links=null,r.files&&r.files[0]&&r.files[0].origional_file&&(d.files=r.files[0].origional_file),d.user={},d.user[o.user_id]=_.extend({accessible:!0},_.omit(o.getUserInfo(),"user_id"));var g=new j;g.type=j.COMMENT_UPDATED,g.data=d,i.send(g)}).error(function(a){r.comment_text=s,r.update_timestamp=t,r.resource_link.collaboration_info=u,r.files=v,r.links=w});return B},deleteComment:function(b,c,d){var e={method:"deleteComment",conversation_uid:b,resource_id:c,app_instance_id:d},f=a.post("comments",e).success(function(a){var e=z(b,c,d),f=z(b,c,d,R);o.isAdminMode()?(e&&(e.updated_by=o.user_id,e.update_kind=2,e.update_timestamp=a.data.time_stamp),f&&(f.updated_by=o.user_id,f.update_kind=2,f.update_timestamp=a.data.time_stamp)):(A(b,c,d),A(b,c,d,R),V.trigger("commentDeleted"));var g=e||f,h={uid:b,app_instance_id:d,resource_id:c,updated_by:o.user_id,update_kind:2,creation_timestamp:g.creation_timestamp,update_timestamp:a.data.time_stamp,resource_link:g.resource_link,comment_text:g.comment_text,from_user:o.user_id,should_show_snippet:!0,like_info:g.like_info};h.user={},h.user[o.user_id]=_.extend({accessible:!0},_.omit(o.getUserInfo(),"user_id"));var k=new j;k.type=j.COMMENT_DELETED,k.data=h,i.send(k)}).error(function(a){});return f},getCommentAndAttachmentStatus:function(b,c){var d=e.defer();if(U.hasOwnProperty(b))d.resolve(U[b]);else{var f={method:"getCommentAndAttachmentStatus",conversation_uid:b,file_id:c};a.postx("comments",f).then(function(a){a=a.data,1==a.type?(U[b]=a.data,d.resolve(U[b])):d.resolve({})},function(){d.resolve({})})}return d.promise},getCommentAndAttachmentStatusFromStore:function(a,b){return U[a]},flushCommentsStatus:function(){U={}},getComment:function(a,b,c,d){var f=z(d,b,c);if(f){var g=e.defer();return g.resolve(f),g.promise}return V.getComments_newApi(a,b,c,!0).then(function(a){return z(d,b,c)})},getComments_newApi:function(b,f,g,h,i,j,k){var l,m=e.defer(),n=h;i||(i=0);var o=j===c||null===j,p=x(f,g);if(p){var r=i+(o?p.total_comments-i:j);r>p.total_comments&&(r=p.total_comments),i=p.comments.length,j=r-i,i>=r&&(n=!1)}else i=0;if(n){var s={authToken:d.login_data.xmpp_session_token,userID:d.login_data.user.user_id,accountID:d.login_data.account_id,feed_id:b,resource_id:f,path_id:f,app_instance_id:g};0==i&&o?s.all=!0:(s.offset=i,s.limit=j);var t=a.postx("conversations/fetchDiscussions",s);t.then(function(a){var b=a.data,c=K(f,g,b.discussions_counts,b.comments);V.updateUsersAndGroups(b.users,b.groups),m.resolve(c)})}else p||(p=q(),v(f,g,p)),l=p,m.resolve(l);return k&&!n?l:m.promise},getSearchResultsComments:function(a,b){var c=y(b,a);return c||(c=q(),w(b,a,c)),c},updateCommentsDataReceivedInFeedPoll:function(a,b,c,d,e){e||K(a,b,c,d,"FEED_POLL",!1)},updateCommentsDataReceivedInFeedFetch:function(a,b,c,d,e){K(a,b,c,d,"FEED_FETCH",e)},updateUsersAndGroups:function(a,c){a&&(b.extend(S,a),m.updateUsers(a,m.DATA_FORMAT_SERVICE)),c&&b.extend(T,c)},getUser:function(a){return S[a]},getUserName:function(a){var b=S[a];return"undefined"==typeof b?"Unknown":b.name},getGroup:function(a){return T[a]},checkIfCommentExistsInDataStore:function(a,b,c){var d=Q[c+"_"+b]?Q[c+"_"+b].comments:null;if(d)for(var e=0;e<d.length;e++)if(d[e].uid==a)return!0;return!1},checkIfCommentExistsInDataStoreAndIsNewerThanNthLast:function(a,b,c,d){var e=Q[c+"_"+b]?Q[c+"_"+b].comments:null;if(!e)return!1;for(var f=!1,g=0;g<e.length;g++)if(e[g].uid==a){f=!0;break}return f?{newerThanNthLast:e.length-g+1>=d}:!1},getCommentsDataFromStore:function(a,b){return x(a,b)},getCommentFromStore:function(a,b,c){return z(a,b,c)},updateCommentLikeInfoReceivedOnRTCNotification:function(a,b){a.like_info.like_timestamp=b.like_timestamp,a.like_info.likes_count=b.likes_count,a.like_info.liked_by=b.liked_by,b.last_liked_by===o.user_id&&(a.like_info.liked_by_me=!0),b.last_unliked_by===o.user_id&&(a.like_info.liked_by_me=!1)}};return V.initCommentsData=r,V.markCommentAsUnread=F,V.markCommentsAsRead=G,V.markCommentsAsPosted=H,V.clearCommentsStore=t,V.clearSearchResultsCommentsStore=u,V.clearCommentsData=B,V.removeAllNonStaleCommentsData=D,V.markCommentsDataAsStale=E,V.setCommentsData=function(a,b,c){v(c,b,a)},_.extend(V,Backbone.Events),V}]),b.module("convoApp").service("alertsService",["$modal","$sce",function(a,b){var c="common/alerts/templates/";this.alertModal=function(d,e,f,g,i,j,k){e=b.getTrustedHtml(e);var l=a.open({templateUrl:c+"alertModal.tpl.html",controller:h,resolve:{title:function(){return d},text:function(){return e},okBtnLabel:function(){return f},okCallback:function(){return g},dontShowCloseBtn:function(){return i}},windowClass:"alert-modal"+(k?" "+k:""),backdrop:"static",keyboard:!j});return l},this.promptModal=function(d,e,f,g,h,i,j,k,m,n,o){
e=b.getTrustedHtml(e);a.open({templateUrl:c+"promptModal.tpl.html",controller:l,resolve:{title:function(){return d},text:function(){return e},okCallback:function(){return f},cancelCallback:function(){return g},okBtnLabel:function(){return h},cancelBtnLabel:function(){return i},defaultBtn:function(){return j},dontShowCloseBtn:function(){return k},onlyDismissModalOnCloseBtn:function(){return m},showHeaderIcon:function(){return"undefined"!=typeof n?n:!0},customHeaderIcon:function(){return o}},windowClass:"prompt-modal",backdrop:"static"})},this.errorModal=function(d,e,f){e=b.getTrustedHtml(e);a.open({templateUrl:c+"errorModal.tpl.html",controller:k,resolve:{title:function(){return d},text:function(){return e},okBtnLabel:function(){return f}},windowClass:"error-modal"})},this.customModal=function(b,c,d,e,f){var g;return g="undefined"==typeof f?"static":f,a.open({templateUrl:b,controller:c,windowClass:"cnv-modal "+e,resolve:d,backdrop:g})}}]);var h=["$scope","$modalInstance","title","text","okBtnLabel","okCallback","dontShowCloseBtn",function(a,b,d,e,f,g,h){a.title="Alert Box",a.okBtnLabel="Ok",a.text=e,a.dontShowCloseBtn=h,d!==c&&(a.title=d),f!==c&&(a.okBtnLabel=f),a.ok=function(){b.close(),g&&g()},a.close=function(){b.close()}}],k=["$scope","$modalInstance","title","text","okBtnLabel",function(a,b,d,e,f){a.title="Alert Box",a.okBtnLabel="Ok",a.text=e,d!==c&&(a.title=d),f!==c&&(a.okBtnLabel=f),a.ok=function(){b.close()},a.close=function(){b.close()}}],l=["$scope","$modalInstance","title","text","okCallback","cancelCallback","okBtnLabel","cancelBtnLabel","defaultBtn","dontShowCloseBtn","onlyDismissModalOnCloseBtn","showHeaderIcon","customHeaderIcon","$window",function(a,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(b){8===b.keyCode?b.preventDefault():13===b.keyCode?a.ok():27===b.keyCode&&(a.cancel(),b.preventDefault())}function r(a){b.element(a.target).hasClass("close-modal-on-click")&&d.close()}a.title="Alert Box",a.okBtnLabel="Ok",a.text=f,a.cancelBtnLabel="Cancel",a.dontShowCloseBtn=l,a.onlyDismissModalOnCloseBtn=m,a.showHeaderIcon=!0,a.customHeaderIcon=o,e!==c&&(a.title=e),i!==c&&(a.okBtnLabel=i),j!==c&&(a.cancelBtnLabel=j),n!==c?a.showHeaderIcon=n:a.showHeaderIcon=!0,a.ok=function(){d.close(),g()},a.close=function(){d.close(),!a.onlyDismissModalOnCloseBtn&&h&&h()},a.cancel=function(){d.dismiss(),h&&h()};var s=b.element(p);s.on("keydown",q),s.on("click",r),a.$on("$destroy",function(){s.off("keydown",q),s.off("click",r)})}];b.module("convoApp").factory("appIndexedDBManager",[function(){function a(a,b){var c=indexedDB.open(h,i);c.onupgradeneeded=function(a){f=a.target.result,f.objectStoreNames.contains(j)||f.createObjectStore(j)},c.onsuccess=function(c){f=c.target.result,a(b)},c.onerror=function(a){},c.onblocked=function(a){}}function b(){f.close()}function c(a){var c=f.transaction([j],"readwrite"),e=c.objectStore(j),g={pushSubscriptionId:a.pushSubscriptionId,convoToken:a.convoToken,accountId:a.accountId,userId:a.userId},h=e.add(g,k);h.onerror=function(c){"Key already exists in the object store."===c.target.error.message?d(a):b()},h.onsuccess=function(a){b()}}function d(a){var c=f.transaction([j],"readwrite"),d=c.objectStore(j),e=d.get(k);e.onerror=function(a){b()},e.onsuccess=function(c){var f=e.result;f.accountId=a.accountId,f.userId=a.userId;var g=d.put(f,k);g.onerror=function(a){b()},g.onsuccess=function(a){b()}}}function e(a){var c=f.transaction([j],"readonly"),d=c.objectStore(j),e=d.get(k);return e.onerror=function(a){b()},e.onsuccess=function(c){var d=c.target.result;a(d),b()},e}var f,g={},h="convo_db",i=1,j="Push_SubscriptionId_ConvoToken_Details",k=1,l=function(b){a(c,b)},m=function(b){return a(e,b)};return g.writePushSubscriptionDetails=l,g.readPushSubscriptionDetails=m,g}]),b.module("convoApp").factory("appWebWorkerManager",["config","$q","utils","$window",function(a,b,c,d){function e(){return a.IS_NATIVE?!1:c.isChrome()?!0:!1}function f(){return a.IS_NATIVE?!1:c.isChrome()?Notification&&"denied"!==Notification.permission&&"default"!==Notification.permission?d.ServiceWorkerRegistration&&"showNotification"in d.ServiceWorkerRegistration.prototype?"serviceWorker"in navigator?"PushManager"in d?!0:(console.warn("Push messaging isn't supported."),!1):(console.warn("Service workers aren't supported in this browser."),!1):(console.warn("ServiceWorkerRegistration Or Notifications aren't supported."),!1):(console.warn("The user has blocked notifications or didn't decided yet."),!1):!1}function g(){return a.IS_NATIVE?!1:c.isChrome()?d.ServiceWorkerRegistration&&"showNotification"in d.ServiceWorkerRegistration.prototype?!0:(console.warn("ServiceWorkerRegistration Or Notifications aren't supported."),!1):!1}function h(b){return f()?void navigator.serviceWorker.getRegistration(a.APP_BASE_URL+"push-service-worker.js").then(function(c){if(c&&c.active&&"activated"===c.active.state)u=c,b&&k();else{if(v)return;v=!0,navigator.serviceWorker.register(a.APP_BASE_URL+"push-service-worker.js").then(function(a){u=a,v=!1,j()})["catch"](function(a){v=!1,console.error("Unable to register service worker.",a)})}}):void p()}function i(){return w?void 0:(w=!0,r=b.defer(),u.unregister().then(function(a){a?console.log("Push service worker is unregistered."):console.log("Push service worker can not be unregistered."),u=null,w=!1,r.resolve()})["catch"](function(a){console.error("Unable to un-register service worker.",a),w=!1,r.resolve()}),r.promise)}function j(){navigator.serviceWorker.ready.then(function(a){k()})}function k(){u.pushManager.subscribe({userVisibleOnly:!0}).then(function(a){console.log("subscribed to push notifications via GCM."),console.log(a),l()})["catch"](function(a){"denied"===Notification.permission?console.warn("Permission for Notifications was denied"):console.error("Unable to subscribe to push.",a)})}function l(){u.pushManager.getSubscription().then(function(a){return a?void a.unsubscribe().then(function(a){console.log("Unsubscribed to push notifications via GCM.")})["catch"](function(a){console.log("Unsubscription error: ",a)}):void console.log("No push subscription is available.")})["catch"](function(a){console.error("Error thrown while getting subscription from push messaging.",a)})}function m(){e()&&(s=setInterval(function(){u?"denied"===Notification.permission&&i():"granted"===Notification.permission&&h()},3e3))}function n(){clearInterval(s)}function o(){return u?(n(),i()):void 0}function p(){if(g()){var b=navigator.serviceWorker.getRegistration(a.APP_BASE_URL+"push-service-worker.js");return b.then(function(a){a&&(u=a)}),b}}function q(){var a=p();a&&a.then(function(a){a&&i()})}var r,s,t={},u=null,v=!1,w=!1,x=function(){h(!0),m()};return t.initialize=x,t.unRegisterPushNotificationsServiceWebWorkerOnSignout=o,t.stopPushServiceWebWorkerIfAlreadyRunning_Globally=q,t}]),b.module("convoApp").factory("bannerService",[function(){function a(a,b,c,d,e,f,g,h,i){this.promise=a,this.text=b,this.resolveText=c,this.errorText=d,this.dontAutoDismiss=e,this.showCloseBtn=f,this.linkClickCallback=g,this.autoDismissTime=h||3e3,this.bannerDismissCbk=i}function b(a){if(a.id=n++,a.displayText=a.text,!a.dontAutoDismiss)for(var b=m.length-1;b>=0;b--){var c=m[b];c.dontAutoDismiss||(clearTimeout(c.autoDismissTimeoutId),c.dismissedInternally=!0,m.splice(b,1))}return a.promise?a.promise.then(function(){a.dismissedInternally||(a.resolveText&&(a.displayText=a.resolveText,l.trigger("dataUpdated")),a.dontAutoDismiss||h(a))},function(){a.dismissedInternally||(a.errorText&&(a.displayText=a.errorText,l.trigger("dataUpdated")),a.dontAutoDismiss||h(a))}):a.dontAutoDismiss||h(a),m.unshift(a),l.trigger("dataUpdated"),a.id}function d(a,b){if("A"==a.target.nodeName){var c=_.find(m,function(a){return a.id==b});c.linkClickCallback&&c.linkClickCallback(a.target.className),i(c.id)}}function e(a){i(a)}function f(c,d,e,f,g,h){return b(new a(null,c,null,null,d,e,f,g,h))}function g(c,d,e,f,g,h,i,j,k){return b(new a(c,d,e,f,g,h,i,j,k))}function h(a){var b=setTimeout(function(){i(a.id)},a.autoDismissTime);a.autoDismissTimeoutId=b}function i(a){var b=_.find(m,function(b){return b.id==a});b.bannerDismissCbk&&b.bannerDismissCbk();for(var d,e=0;e<m.length;e++)if(m[e].id===a){d=e;break}d!==c&&(m.splice(d,1),l.trigger("dataUpdated"))}function j(){return m}function k(){for(var a=0;a<m.length;a++)i(m[a].id)}var l={};_.extend(l,Backbone.Events);var m=[],n=0;return l.getBannersStackReference=j,l.showBanner=f,l.showBanner_promise=g,l.dismissBanner=i,l.dismissAllBanners=k,l.onBannerTextClick=d,l.onBannerCloseBtnClick=e,l}]),b.module("convoApp").directive("boRepeat",["$parse","$animate","utils",function(a,d,e){var f="$$NG_REMOVED",g=function(a,b,c,d,e,f,g){a[c]=d,e&&(a[e]=f),a.$index=b,a.$first=0===b,a.$last=b===g-1,a.$middle=!(a.$first||a.$last),a.$odd=!(a.$even=0===(1&b))},h=function(a){return a.clone[0]},i=function(a){return a.clone[a.clone.length-1]};return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,compile:function(j,k){var l=k.boRepeat,m=document.createComment(" end boRepeat: "+l+" "),n=l.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!n)throw"boRepeat: Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '"+l+"'";var o=n[1],p=n[2],q=n[3],r=n[4];if(n=o.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/),!n)throw"'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '"+o+"'.";var s=n[3]||n[1],t=n[2];if(q&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(q)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent)$/.test(q)))throw"alias '"+q+"' is invalid --- must be a valid JS identifier which is not a reserved name.";var u,v,w,x,y={$id:e.hashKey};return r?u=a(r):(w=function(a,b){return e.hashKey(b)},x=function(a){return a}),function(a,j,k,n,o){u&&(v=function(b,c,d){return t&&(y[t]=b),y[s]=c,y.$index=d,u(a,y)});var r=Object.create(null),z=e.$watchCollection_withoutCreatingWatch(a,p,function(k){var n,p,u,y,z,A,B,C,D,E,F,G,H=j[0],I=Object.create(null);if(q&&(a[q]=k),b.isArray(k))D=k,C=v||w;else{C=v||x,D=[];for(var J in k)k.hasOwnProperty(J)&&"$"!=J.charAt(0)&&D.push(J);D.sort()}for(y=D.length,F=new Array(y),n=0;y>n;n++)if(z=k===D?n:D[n],A=k[z],B=C(z,A,n),r[B])E=r[B],delete r[B],I[B]=E,F[n]=E;else{if(I[B])throw _.forEach(F,function(a){a&&a.scope&&(r[a.id]=a)}),"Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: "+l+", Duplicate key: "+B+", Duplicate value: "+JSON.stringify(A);F[n]={id:B,scope:c,clone:c},I[B]=!0}for(var K in r){if(E=r[K],G=e.getBlockNodes(E.clone),G.remove(),G[0].parentNode)for(n=0,p=G.length;p>n;n++)G[n][f]=!0;E.scope.$destroy()}for(n=0;y>n;n++)if(z=k===D?n:D[n],A=k[z],E=F[n],E.scope){u=H;do u=u.nextSibling;while(u&&u[f]);h(E)!=u&&d.move(e.getBlockNodes(E.clone),null,$(H)),H=i(E),g(E.scope,n,s,A,t,z,y)}else o(function(a,b){E.scope=b;var c=m.cloneNode(!1);a[a.length++]=c,d.enter(a,null,$(H)),H=c,E.clone=a,I[E.id]=E,g(E.scope,n,s,A,t,z,y)});r=I}),A="render";k.boRepeatRenderId&&(A="render:boRepeat:"+k.boRepeatRenderId),a.$on(A,z)}}}}]),b.module("convoApp").directive("cnvAppStateInfo",["appStateInfo","config",function(b,c){return{restrict:"E",link:function(d,e,f){function g(){a.addEventListener("resize",k)}function h(){var b=1;0!==a.outerWidth&&(b=a.outerWidth/a.innerWidth);var d=Math.max(a.innerWidth-$("body").width(),0),e=Math.ceil(c.COMPACT_VIEW_UNSCALED_WIDTH*b+d*b);return e}function i(){var a=h();b.setScaledCompactWidth(a)}function j(){g(),i(),b.trigger("windowResized",a.innerWidth)}var k=function(c){l();var d;d=c.srcElement?c.srcElement.innerWidth:a.innerWidth,b.trigger("windowResized",d)},l=_.debounce(i,1e3);j(),d.$on("$destory",function(){a.removeEventListener("resize",k)})}}}]),b.module("convoApp").directive("cnvAutofocus",[function(){return{restrict:"A",scope:!1,link:function(a,b,d){function e(){var a,b=document.createElement("fakeelement"),d={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in d)if(b.style[a]!==c)return d[a]}function f(){b.focus(),$(d.cnvAutofocus).off(g,f)}if(d.cnvAutofocus){var g=e();g&&$(d.cnvAutofocus).on(g,f)}else setTimeout(function(){b.focus()},100)}}}]),b.module("convoApp").directive("cnvInviteTeammates",["accountInfo","alertsService","utils","Contacts","mixpanelService",function(a,b,d,e,f){return{restrict:"E",scope:!1,link:function(a,b,c){b.find("input").on("keydown",function(c){13==c.keyCode&&(a.invtTeammtCtrl.isNotShowingAutoComplete?b.find("input").val()&&d.isValidEmail(b.find("input").val())&&(a.invtTeammtCtrl.inviteTeammates([b.find("input").val()]),b.find("input").val("")):a.invitedTo.length&&a.inviteTeammate())})},templateUrl:"common/cnvInviteTeammates/templates/cnvInviteTeammates.tpl.html",controller:["$scope","alertsService","Users","usersGroupsListProvider","$q","userInfo","BlackListWordsService",function(b,f,g,h,i,j,k){function l(c){a.shouldInviteGuestsAsFullMembers()?b.placeholderText="teammate@domain.com":b.placeholderText="teammate@"+c.user_email_domain}function m(){b.invtTeammtCtrl.getAutoCompleteUserItem().then(function(a){r=a.nonMembers,s=a.members})}function n(){m()}var o,p,q,r=[],s=[];b.shouldInviteGuestsAsFullMembers=a.shouldInviteGuestsAsFullMembers(),a.shouldInviteGuestsAsFullMembers()?b.placeholderText="teammate@domain.com":b.placeholderText="teammate@"+a.getPrimaryAccountDomain().user_email_domain,a.on("accountInfo.updated.primaryAccountDomain",l),b.invtTeammtCtrl.isNotShowingAutoComplete?(b.invtDetails={},b.invtDetails.email=""):(b.$on("inviteTeammates:groupMembersUpdated",n),b.invitedTo=[],m(),b.getAutoCompleteUserItemsToInvite=function(a,b){var c=i.defer(),d="",e={allowed:!1,domain_restricted:!1};if(!j.isGuestUser()){var d=h.LIST_NAMES.NETWORK_ON_DOMAIN_CONTACTS_LIST;e.allowed=!0}var f=h.queryCustomList(r,a,b+4,null,d,e),g=[];return a&&(g=h.queryCustomList(s,a,2)),c.resolve(f.concat(g)),c.promise}),b.onItemAddedInToField=function(a){for(var d=b.invitedTo.length;d--;){var e=g.getUserById(b.invitedTo[d].id);if(e===c){var f=k.clean(b.invitedTo[d].label);f!==b.invitedTo[d].label&&b.invitedTo.splice(d,1)}else{var f=k.clean(e.email);f!==e.email&&b.invitedTo.splice(d,1)}}},b.onTextPasted=function(a){if(!b.invtTeammtCtrl.initialized||b.invtTeammtCtrl.isNotShowingAutoComplete)return!0;var e=d.parseEmailAddressesFromString(a);if(0===e.emails.length||1===e.numItems)return!0;for(var f=e.emails,g=[],i={},j=0;j<f.length;j++){var k=f[j].toLowerCase(),l=_.where(b.invitedTo,{email:k});0===l.length&&i[k]===c&&(g.push(k),i[k]=1)}if(g.length>0){for(var j=0;j<g.length;j++){var k=g[j],m=h.createUserListItem({email:k,name:k});m.type="CONTACT",m.classes=" user contact-as-user "+d.getRandomSmiley()+" as-content ",b.invitedTo.push(m)}b.$$phase||b.$digest()}return!1},b.openInviteTeammatesModal=function(){o="home/components/cnvInviteTeammatesWidget/templates/cnvInviteTeammatesModal.tpl.html",p="cnvInviteTeammatesModalCtrl",q="cnv-invite-teammates";var a={teammate_email:function(){return b.invtTeammtCtrl.isNotShowingAutoComplete?b.invtDetails.email:b.invitedTo[0]},showAutoComplete:function(){return!b.invtTeammtCtrl.isNotShowingAutoComplete},autoCompleteFieldLabelText:function(){return b.invtTeammtCtrl.autoCompleteFieldLabelText},autoCompleteItems:function(){return[]}};if(!b.invtTeammtCtrl.isNotShowingAutoComplete&&b.invtTeammtCtrl.initialized)b.invtTeammtCtrl.getAutoCompleteUserItem().then(function(c){a.autoCompleteItems=function(){return c};var d=f.customModal(o,p,a,q);d.result.then(function(a){for(var c,d=a.inviteTo,e=[],f=a.messageText,h=0;d&&h<d.length;h++)c=g.getUserById(d[h].id),c?e.push(c.email):e.push(d[h].label);b.invtTeammtCtrl.initialized&&b.invtTeammtCtrl.inviteTeammates(e,f)}),b.invitedTo=[]});else{var c=f.customModal(o,p,a,q);c.result.then(function(a){for(var c,d=a.inviteTo,e=[],f=a.messageText,h=0;d&&h<d.length;h++)c=g.getUserById(d[h].id),c?e.push(c.email):e.push(d[h].label);b.invtTeammtCtrl.initialized&&b.invtTeammtCtrl.inviteTeammates(e,f)}),b.invtDetails.email=""}},b.inviteFromAddressBk=function(){var a=b.invtTeammtCtrl.group;a?e.initContactsInviteModal({include_off_domain:!0,origin:"Group_Settings",invite_via:"Invite_Dialog",group:a}):e.initContactsInviteModal({include_off_domain:!1,origin:"Manage_Users",invite_via:"Invite_Dialog"})},b.inviteTeammate=function(a){if(b.invtTeammtCtrl.initialized&&!b.invtTeammtCtrl.isNotShowingAutoComplete){for(var c,e=[],f=0;f<b.invitedTo.length;f++){c=g.getUserById(b.invitedTo[f].id);var h=c&&c.email?c.email:b.invitedTo[f].label;if(h){var i=k.clean(h);i===h&&e.push(i)}}b.invtTeammtCtrl.initialized&&b.invtTeammtCtrl.inviteTeammates(e),b.invitedTo=[]}else if(b.invtTeammtCtrl.initialized&&b.invtDetails.email){var j=d.parseEmailAddressesFromString(b.invtDetails.email);j.emails.length>0&&(b.invtTeammtCtrl.inviteTeammates(j.emails),b.invtDetails.email="")}},b.shareableInviteLink=function(){var a="common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",b="findContactsSplashCtrl",c={data:function(){return{requestedView:"VANITY_URL"}}};f.customModal(a,b,c).result.then(function(a){console.log("invite complete.")},function(){console.log("invite complete.")})},b.$on("$destroy",function(){a.off("accountInfo.updated.primaryAccountDomain",l)})}]}}]),b.module("convoApp").controller("findContactsPermissionDenied",["$scope","$modalInstance","data",function(a,b,c){var d=a;d.data=c,d.VIEWS={MAC:"mac",WINDOWS:"windows"},d.VIEW=d.VIEWS.MAC,d.dismiss=function(){b.dismiss("cancel")}}]),b.module("convoApp").controller("findContactsSplashCtrl",["$scope","$modalInstance","data","accountInfo","Contacts","importMacContacts","$q","utils","mixpanelService","config","$location",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){m.inviteResult={},200==a.response.status||a.response.type?(m.inviteResult=a.response.data.data||a.response.data.invitation_data||a.response.data,m.inviteResult.totalInvitesSent=a.totalInvitesSent,m.inviteResult.invitedTo=a.invited_to):console.log(a)}var m=a;a.accountInfo=d;var n=null,o=1e4,p=!1,q=null;m.data=c;var r=m.data&&m.data.include_off_domain?!0:!1;m.inviteResult={},m.accountInfo=d,m.VIEWS={PERMISSION:"permission",PROCESSING:"processing",COMPLETE:"complete",VANITY_URL:"vanity_url"},m.isNative=j.IS_NATIVE,m.vanityURL=(j.WEBSITE_DOMAIN+"join/"+d.getPrimaryAccountDomain().account_domain).substring(8),m.commandSymbol=h.getCommandSymbol(),c.hasOwnProperty("requestedView")?m.VIEW=m.VIEWS[c.requestedView]:m.VIEW=m.VIEWS.PERMISSION,m.dismiss=function(){b.dismiss("cancel"),m.VIEW===m.VIEWS.PERMISSION&&(1==f.getProperties("display_import_users_nag_count")?i.trackEvent(i.DISMISS_IMPORT_PROMPT,{Type:"First"}):2==f.getProperties("display_import_users_nag_count")?i.trackEvent(i.DISMISS_IMPORT_PROMPT,{Type:"Reminder1"}):3==f.getProperties("display_import_users_nag_count")&&i.trackEvent(i.DISMISS_IMPORT_PROMPT,{Type:"Reminder2"}))},m["continue"]=function(){m.data.origin&&i.trackEvent(i.CLICK_IMPORT_CONTACTS,{Source:m.data.origin}),f["import"]().then(function(a){var c=a.data;"success"===c.status?c.contacts.length?(q=g.defer(),e.addUserContacts({src:"mac",contacts:c.contacts}).then(function(a){var c="";c=r?"getAccountUserContacts_includeOffDomain":"getAccountUserContacts",e[c](!0,!0).then(function(a){p?q.resolve({contacts:a}):b.close({contacts:a})},function(){p?q.reject({error:"get_master_list_failed"}):b.dismiss({error:"get_master_list_failed"})})},function(){p?q.reject({error:"submit_contacts_failed"}):b.dismiss({error:"submit_contacts_failed"})}),n=setTimeout(function(){m.longProcessing=!0,m.$$phase||m.$digest()},o)):b.dismiss({error:"no_contacts_found"}):"exception"===c.status?b.dismiss({error:"exception"}):b.dismiss({error:"permission_denied"})}),m.VIEW=m.VIEWS.PROCESSING,m.$$phase||m.$digest()},m.hide=function(){p=!0,b.dismiss({promise:q.promise}),clearTimeout(n)},m.showErrorPopup=function(){m.showErrorDetails=!0},m.onInputKeyDown=function(a){var b=a;(b.shiftKey||b.altKey||b.ctrlKey||b.metaKey)&&67==b.keyCode&&i.trackEvent(i.COPY_INVITE_LINK,{})},m.copyToClipboardNatively=function(a){h.copyToClipboard(m.vanityURL)},a.inviteEmailSubject="Join me on "+d.getAccountName(),a.inviteEmailBody="Hi there,%0D%0A%0D%0ALet's use Convo to make our internal communication faster!%0D%0A%0D%0ASign up with your work email at this link: https://"+m.vanityURL+"%0D%0A%0D%0ATake a look around and see what others are working on. Add a question or a great idea in comments. Then share a post and get really fast feedback.%0D%0A%0D%0ATry sharing posts instead of emails - even a complicated thread is easy to consume.",c.hasOwnProperty("response")&&l(c.response)}]),b.module("convoApp").directive("cnvOverlay",["config",function(a){return{restrict:"E",template:"<div></div>",link:function(b,c,d){var e=c.find("div");b.$on("showOverlay",function(b,c){e.addClass("overlay-cover"),a.IS_MENULET&&c.length>0&&(e[0].innerHTML="<div class='overlay-content'>Waiting for "+c[0]+"...</div>")}),b.$on("removeOverlay",function(){e.removeClass("overlay-cover"),a.IS_MENULET&&(e[0].innerHTML="")})}}}]),b.module("convoApp").factory("popoverUtils",function(){var a={counter:0,isShowing:!1,hide:function(b){a.isShowing&&(clearTimeout(a.timeout),b=b||$("#cnv-popover"),a.isShowing=!1,++a.counter,b.removeClass("show").removeAttr("hovered"))},show:function(b){a.isShowing||(b=b||$("#cnv-popover"),b&&b.length&&(b.addClass("show").data("hovered",!0),a.isShowing=!0))}};return a}).directive("cnvPopover",["$filter","popoverUtils",function(a,b){return{restrict:"AE",scope:!1,link:function(a,c,d){function e(c){i&&clearTimeout(i),i=setTimeout(function(){var e=a.$eval(d.cnvPopoverCtrl);j||(j=$("#cnv-popover")),j&&j.length&&e&&(b.show(j),"function"==typeof e?(j.find(".cnv-popover-content").html("..."),g(),e(function(a){j.data("hovered")&&(l?j.find(".cnv-popover-content").text(a):j.find(".cnv-popover-content").html(m?a:_.escape(a)),g())})):(l?j.find(".cnv-popover-content").text(e):j.find(".cnv-popover-content").html(m?e:_.escape(e)),g()),h(++b.counter,c.target))},400)}function f(a){i&&clearTimeout(i),b.hide()}function g(){var a=c.offset(),b=a.top-$(document).scrollTop()-j.outerHeight(!0),d=a.left+c.outerWidth(!0)/2-j.outerWidth(!0)/2;5>d?(d=5,$("#cnv-popover").addClass("leftPopover")):$("#cnv-popover").removeClass("leftPopover"),0>b?(b+=j.outerHeight(!0)+c.outerHeight(!0)+5,j.removeClass("bottom").addClass("top")):(b-=5,j.removeClass("top").addClass("bottom")),j.css({top:b,left:d})}function h(a,c){c.setAttribute("popover-data-id","cnv-"+a),clearTimeout(b.timeout),b.timeout=setTimeout(function(){return $("*[popover-data-id='cnv-"+a+"']").length||++b.counter,a===b.counter?h(a,c):void b.hide()},1500)}$(c).hover(e,f);var i,j=null,k=null,l="true"===d.cnvPopoverDisplayAsText,m="true"===d.cnvPopoverHtmlAlreadyEscaped;a.$on("$destroy",function(){$(c).off("mouseenter mouseleave"),j=null,k&&(clearTimeout(k),k=null),b.timeout&&(clearTimeout(b.timeout),b.timeout=null)})}}}]),b.module("convoApp").directive("dialogBox",["$window",function(a){return{restrict:"A",templateUrl:"common/dialogBox.tpl.html",link:function(c,d,e){d.css("top",a.innerHeight/2-d.height()/2+"px"),d.css("left",a.innerWidth/2-d.width()/2+"px"),c.showDialog=!0,b.element(a).bind("resize",function(){console.log("resize-window"),d.css("top",a.innerHeight/2-d.height()/2+"px"),d.css("left",a.innerWidth/2-d.width()/2+"px")})}}}]),b.module("convoApp").directive("cnvAddMembers",["$window",function(a){return{restrict:"E",scope:{data:"=data",propName:"@propName",callback:"&callback",maxCount:"@maxCount",itemsToExclude:"=itemsToExclude",defaultPlaceholder:"@defaultPlaceholder",excludeGuest:"@excludeGuest"},templateUrl:"common/directives/cnv-add-members/cnv-add-members.tpl.html",link:function(d,e,f){d.postCreatorsSearch=[],d.networkMembers=[],d.defaultPlaceholder=d.defaultPlaceholder!==c?d.defaultPlaceholder:"Add Member",d.excludeGuest=d.excludeGuest!==c?d.excludeGuest:!1,d.getNetworkMembers();var g=b.element(a);g.bind("click",function(a){var b=!$(a.target).parents(".add-members-container").length;b&&(d.postCreatorsSearch.length=0,d.$apply())}),b.element(document).bind("scroll",_.debounce(function(a){d.postCreatorsSearch.length=0,d.$apply()},200)),d.$on("$destroy",function(){b.element(a).unbind("click"),b.element(document).unbind("scroll")})},controller:["$scope","Users","accountInfo",function(b,c,d){function e(){var b=$(".add-members-container").position(),c=a.scrollY;$(".search-members").css({top:b.top-c+32})}function f(a){if(b.itemsToExclude){for(var c=0;c<b.itemsToExclude.length;c++){var d=b.itemsToExclude[c];if(d==a[b.propName])return!0}return!1}return!1}b.getNetworkMembers=function(){c.getPublishableUsers().then(function(a){b.networkMembers=a})},b.handleKeyup=function(a,c){e(),c?13===a.which?b.addMember(b.postCreatorsSearch[0]):b.searchMembers(c):b.postCreatorsSearch.length=0},b.searchMembers=function(a){if(a){var d=0,e=b.maxCount?b.maxCount:4;b.postCreatorsSearch.length=0;for(var g=0;g<b.networkMembers.length;g++){var h=b.networkMembers[g],i=h.first_name+" "+h.last_name,j=(c.getUser(h.id),f(h)||b.excludeGuest&&"GUEST"===h.user_role);if(-1!=i.toLocaleLowerCase().indexOf(a.toLocaleLowerCase())&&!j){if(h.isAlreadyPostCreator=b.data.hasOwnProperty(h[b.propName]),d++,!(e>=d))return;b.postCreatorsSearch.push(h)}}}},b.addMember=function(a){if(a){if(b.data[a[b.propName]])return;if(a.user_id&&!f(a)&&(b.data[a[b.propName]]=a),b.callback){var c=a[b.propName];b.callback({key:c,value:a})}b.postCreatorsSearch.length=0,b.addMembersSearchField=""}},b.$on("clearTextField",function(a){b.addMembersSearchField=""}),b.getFormattedName=function(a,b){return b&&b.length?a.replace(RegExp("("+b+")","gi"),"<b>$1</b>"):a}}]}}]),b.module("convoApp").directive("cnvFocus",["$timeout",function(a){return{restrict:"A",scope:{cnvFocus:"="},link:function(b,c,d){1==b.cnvFocus&&(a(function(){c.focus()}),0==b.cnvFocus)}}}]),b.module("convoApp").directive("cnvBindHtml",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return d.cnvBindHtml},function(d){c.html(d),a(c.contents())(b)})}}]),b.module("convoApp").directive("cnvEditableTextField",["$timeout",function(a){return{require:"ngModel",scope:{model:"=ngModel",modelTwo:"=modelTwo",type:"@type",imgSrc:"@imgSrc"},replace:!0,transclude:!1,template:'<div ng-form="editForm" ng-init="twoInputFocus = false;"><p ng-if="!editState && (type == \'inputText\' || type == \'inputTextArea\')" ng-class="{\'input-text-area\': type == \'inputTextArea\'}"ng-click="toggle()"class="info-label-editable">{{model.field_value ? model.field_value : model.meta.placeHolder}}<span class="pencil-icon pull-right hide"><img ng-if="!model.is_locked" src="assets/cnv-icons/source-icons/edit.svg" /><img ng-if="model.is_locked" src="assets/cnv-icons/source-icons/colored-svg/lock-gray.svg" /></span></p><div ng-if="!editState" ng-show="type == \'inputTextWithLabel\'" class="info-label-editable" ng-click="toggle()"><p class="input-label-text" style="display: inline;"> <span class="input-label-text-content"> <span class="input-label-text-strong">{{modelTwo.field_name}}: </span>{{model.field_value ? model.field_value : model.meta.placeHolder}}</span><span class="pencil-icon pull-right hide"><img ng-if="!model.is_locked" src="assets/cnv-icons/source-icons/edit.svg" /><img ng-if="model.is_locked" src="assets/cnv-icons/source-icons/colored-svg/lock-gray.svg" /></span></p></div><div ng-show="editState && type == \'inputTextWithLabel\'" class="input-text-with-label-input" ><p class="input-text-label-field" style="display: inline;"> <strong>{{modelTwo.field_name}}: </strong></p><input maxlength="75" class="inputTextWithLabel" name="modelOne" type="text" placeholder="{{localModel.meta.placeHolder}}" ng-blur="save()"ng-model="localModel.field_value"/></div><div ng-if="!editState" ng-show="type == \'inputTextLabelIcon\'" class="info-label-editable" ng-click="toggle()"><span><i class="action_icon {{imgSrc}}"></i></span><p style="display: inline;"> <strong>{{modelTwo.field_name}}: </strong><span class="input-text-label-content">{{model.field_value ? model.field_value : model.meta.placeHolder}}</span><span class="pencil-icon pull-right hide"><img ng-if="!model.is_locked" src="assets/cnv-icons/source-icons/edit.svg" /><img ng-if="model.is_locked" src="assets/cnv-icons/source-icons/colored-svg/lock-gray.svg" /></span></p></div><div class="label-input" ng-show="editState && type == \'inputTextLabelIcon\'" ><span><i class="action_icon {{imgSrc}}"></i></span><p style="display: inline;"> <strong>{{modelTwo.field_name}}: </strong></p><input maxlength="75" class="inputTextLabelIcon" name="modelOne" type="text" placeholder="{{localModel.meta.placeHolder}}" ng-blur="save()"ng-model="localModel.field_value"/></div><p ng-if="!editState && type == \'inputTextTwo\'" ng-click="toggle()" class="info-label-editable">{{model.field_value ? model.field_value : model.meta.placeHolder}} {{modelTwo.field_value ? modelTwo.field_value : modelTwo.meta.placeHolder}}<span class="pencil-icon pull-right hide"><img ng-if="!model.is_locked || !modelTwo.is_locked" src="assets/cnv-icons/source-icons/edit.svg" /><img ng-if="model.is_locked && modelTwo.is_locked" src="assets/cnv-icons/source-icons/colored-svg/lock-gray.svg" /></span></p><div ng-show="editState && type == \'inputText\'"><input maxlength="75" class="inputText"  name="modelOne" type="text" placeholder="{{localModel.meta.placeHolder}}" ng-blur="save()"ng-model="localModel.field_value"/></div><div class="input-text-two-input-container"> <div ng-show="editState && type == \'inputTextTwo\'"><input maxlength="75" class="inputTextTwo" name="modelOne"  ng-focus="twoInputFocus = true;" ng-blur="twoInputFocus = false; save();"type="text" placeholder="{{localModel.meta.placeHolder}}" ng-model="localModel.field_value" ng-disabled="localModel.is_locked"/></div><div ng-show="editState && type == \'inputTextTwo\'"><input maxlength="75" class="inputText"  name="modelTwo_"  ng-focus="twoInputFocus = true;" ng-blur="twoInputFocus = false; save();"type="text"  placeholder="{{modelTwoLocal.meta.placeHolder}}" ng-model="modelTwoLocal.field_value" ng-disabled="modelTwoLocal.is_locked"/></div> </div><div ng-show="editState && type == \'inputTextArea\'"><textarea  maxlength="150" class="inputTextArea" name="modelOne" style="width: 100%;" placeholder="{{localModel.meta.placeHolder}}" ng-blur="save()"ng-model="localModel.field_value"/textarea></div></div>',link:function(b,c,d){b.editState=!1,b.localModel=b.model;var e,f;setTimeout(function(){"inputTextTwo"==b.type&&(b.model&&"First name"==b.model.field_name&&(e=b.model.field_value),b.modelTwo&&"Last name"==b.modelTwo.field_name&&(f=b.modelTwo.field_value))},0),b.save=function(){console.log("save called."),b.model=b.localModel,b.modelTwo=b.modelTwoLocal,"inputTextTwo"!=b.type?b.model.meta.is_dirty=b.editForm.modelOne.$dirty:(b.modelTwo.meta.is_dirty=b.editForm.modelOne.$dirty,b.modelTwo.meta.is_dirty=b.editForm.modelTwo_.$dirty),b.editState&&b.toggle()},b.cancel=function(){b.localModel=b.model,b.modelTwoLocal=b.modelTwo,b.toggle()},c.bind("keydown, keypress",function(a){13===a.which&&(console.log("Enter key event called."),a.preventDefault(),b.save())}),b.toggle=function(){setTimeout(function(){var d=b.model.is_locked&&b.modelTwo.is_locked;if("inputTextTwo"!=b.type&&!b.model.is_locked||"inputTextTwo"==b.type&&!d&&!b.twoInputFocus){b.editState=!b.editState,b.localModel=b.model,b.modelTwoLocal=b.modelTwo,"inputTextTwo"==b.type&&("First name"!=b.model.field_name||b.model.field_value&&""!=b.model.field_value||(b.model.field_value=e),"Last name"!=b.modelTwo.field_name||b.modelTwo.field_value&&""!=b.modelTwo.field_value||(b.modelTwo.field_value=f));var g=c[0].querySelector("."+b.type);a(function(){b.editState?g.focus():g.blur()},100)}},0)}}}}]),b.module("convoApp").directive("cnvEventBinding",["$window",function(a){"use strict";var c={ESCAPE:27};return{restrict:"A",link:function(d,e,f){var g=f.cnvEventBinding.split(",");g.forEach(function(e){
var f=e.trim().split("::"),g=f[0],h=f[1];b.element(a).on(g,function(a){setTimeout(function(){a.which===c[h]?d.$broadcast("cnvEventBinding::keyup::"+h,a.target):d.$broadcast("cnvEventBinding::"+g,a.target)},100)})})}}}]),b.module("convoApp").directive("cnvLoadTemplate",["$compile","$templateCache",function(a,b){return{restrict:"A",replace:!0,link:function(c,d,e){var f=b.get(e.template1)+b.get(e.template2)+b.get(e.template3),g=a(f)(c);d.replaceWith(g)}}}]),b.module("convoApp").factory("errorInterceptor",["$q",function(a){return{responseError:function(b){a.defer();return console.log("***** ErrorInterceptor Called: "),console.log(b),b}}}]),b.module("convoApp").factory("loader",["$q","config",function(a,b){function c(a,b,c,d){n=a,o=b,p=c,q=d}function d(b,c){return b.promise?b.promise:(!r||c?b.promise=a(function(a){w.fileWithRetries("script",b.url,function(){b.loaded=!0,a()})}):b.promise=a(function(a){b.loaded=!0,a()}),b.promise)}function e(b){return b.promise?b.promise:(r?b.promise=a(function(a){b.loaded=!0,a()}):b.promise=a(function(a){w.fileWithRetries("style",b.url,function(){b.loaded=!0,a()})}),b.promise)}function f(a){return d(n[a],!1)}function g(a){return e(o[a],!1)}function h(a){return n[a].loaded}function i(a){return o[a].loaded}function j(){for(var a=0;a<p.length;a++)f(p[a]);p=[]}function k(){for(var a=0;a<q.length;a++)g(q[a]);q=[]}function l(a){return d(v[a],!0)}function m(a){w.fileWithRetries("script","plugins/"+a+"/"+a+".js")}var n,o,p,q,r=b.IS_DEV,s={APP_COMPLETE:"APP_COMPLETE",APP_CORE:"APP_CORE",APP_APPS:"APP_APPS",VENDOR_LIBS:"VENDOR_LIBS",VENDOR_GALLERY_LIBS:"VENDOR_GALLERY_LIBS"},t={APP_COMPLETE:"APP_COMPLETE",APP_CORE:"APP_CORE",APP_APPS:"APP_APPS"},u={YOUTUBE_API:"YOUTUBE_API",INTERCOM_IO_API:"INTERCOM_IO_API",PDF_WORKER_SCRIPT:"PDF_WORKER_SCRIPT"},v={YOUTUBE_API:{url:"https://www.youtube.com/player_api",loaded:!1},INTERCOM_IO_API:{url:"https://widget.intercom.io/widget/"+b.INTERCOM_IO_APP_ID,loaded:!1},PDF_WORKER_SCRIPT:{url:"assets/vendor/pdf-js/pdf.worker_v3.js",loaded:!1}},w={script:function(a,b){var c=document.createElement("script");c.onload=function(){b(!0)},c.onerror=function(){b(!1),c.parentNode.removeChild(c)},c.src=a,document.querySelector("head").appendChild(c)},style:function(a,b){function c(a,c){c||a.sheet.cssRules&&!a.sheet.cssRules.length?(b(!1),d.parentNode.removeChild(d)):b(!0)}var d=document.createElement("link");d.onload=function(){c(d)},d.onerror=function(){c(d,!0)},d.rel="stylesheet",d.href=a,document.querySelector("head").appendChild(d)},fileWithRetries:function(a,b,c){var d=this;d[a](b,function(e){e?c&&c():setTimeout(function(){d.fileWithRetries(a,b,c)},1e3)})}};return{SCRIPTS:s,EXTERNAL_SCRIPTS:u,STYLES:t,init:c,loadScript:f,isScriptLoaded:h,preloadScripts:j,loadStyle:g,isStyleLoaded:i,preloadStyles:k,loadExternalScript:l,loadPlugin:m}}]),b.module("convoApp").factory("textSelections",["$rootScope","$filter","utils","localStore",function(b,d,e,f){function g(a){if(L){var b,c=[],d=a.startContainer,e=a.endContainer,f=document.TEXT_NODE;if(d.nodeType===f&&(d=d.parentNode),e.nodeType===f&&(e=e.parentNode),d===e)return d.getBoundingClientRect();for(;d&&d!==e;)c.push(d),d=d.nextSibling;return b=i({nodes:c})}return a.getBoundingClientRect()}function h(a){var b=a.style.transform?a:a.parentNode,c="string"==typeof b.style.transform?"transform":"webkitTransform",d=b.style[c].match(/scaleX\((.+)\)/);return d=Array.isArray(d)?parseFloat(d[1],10):1,a.offsetWidth*d}function i(a){var b,c,d,e,f,g,i,j=a.pdfViewer,k=a.className||J,l=a.nodes||I("."+k),m=l.length;if(b=c=l[0],!b)return{top:0,left:0,height:0,width:0,nodes:null};d=$(b).offset(),f=j?h(b):b.offsetWidth;var n=$(l[m-1]);i=n.offset().top-d.top+n[0].offsetHeight;for(var o=1;m>o;++o)b=l[o],e=$(b).offset(),e.top!==d.top?(g=e.left-$(c).offset().left+(j?h(b):b.offsetWidth),g>f&&(f=g)):f=e.left-$(c).offset().left+(j?h(b):b.offsetWidth);var p=$(l[0]),q=p.offset();return 0!==q.top||0!==q.left||0!==i||0!==f?{top:q.top,left:q.left,height:i,width:f,nodes:l}:void 0}function j(){return F}function k(a){return N[a]?N[a].nodes:void 0}function l(a){var b=rangy.getSelection();return b.removeAllRanges(),b.addRange(a),b}function m(a){var b=a||I("."+J),c=b.length;if(0!==c){for(var d=b[0].childNodes[0],e=b[c-1].childNodes[0],f=document.createRange(),g=0;c>g;++g)delete b[g].dataset.commentId;f.setStart(d,0),f.setEnd(e,e.textContent.length);var h,i=rangy.getSelection(),j=i.isCollapsed;j||(h=i.getRangeAt(0));var k=l(f);D.undoToSelection(),k.removeAllRanges(),!j&&h&&k.addRange(h)}}function n(a){var c=N[a];if(c){var d=c.nodes,e=d.length,f=e?!0:!1;F===d&&(F=null);for(var g=0;e>g;++g)if(!document.contains(d[g])){f=!1;break}f&&(clearTimeout(c.timingFuncId),m(d)),b.$emit("SnippetArrow:destroy",a),c.nodes=null,delete N[a]}else{var d=$("span."+J+"[data-comment-id="+a+"]");d.length&&m(d)}}function o(){Object.keys(N).forEach(n),rangy.Selection.detachAll()}function p(a,b){var c,d,e=!1;if(N[a]){N[a].timingFuncId&&(clearTimeout(N[a].timingFuncId),N[a].timingFuncId=setTimeout(function(){n(a)},N[a].timerDelay)),F=N[a].nodes;var f=function(){b.complete&&b.complete(null)};$(b.scrollContainer).animate({scrollTop:N[a].containerScrollTop},{duration:400,complete:f}),e=!0}if(e)N[a].position=O++;else if(d=Object.keys(N),d.length>1){var g=d[0],h=O;d.forEach(function(a){N[a].position<h&&(g=a,h=N[a].position)}),c=g,N[c].timingFuncId&&(clearTimeout(N[c].timingFuncId),n(c))}return e?P:Q}function q(a){var b=a.data,c=!0;return b.beginIndex=b.beginIndex||0,b.endIndex=b.endIndex||1,b.endIndex<=b.beginIndex&&(b.endIndex=b.beginIndex+1),(!a.content||b.beginIndex>a.content.length)&&(c=!1),c}function r(a,b){function c(a){var b;if(a.nodeType!==e&&a.classList.contains(J))return b=a.dataset.commentId,void(f[b]||(f[b]=!0,n(b)));var c=a.querySelectorAll("."+J),d=c.length;if(d)for(var g=0;d>g;++g)b=c[g].dataset.commentId,f[b]||(f[b]=!0,n(b))}var d,e=document.TEXT_NODE,f={};if(a.nodeType===e&&(a=a.parentNode),b.nodeType===e&&(b=b.parentNode),a===b)c(a);else for(d=a;d&&d!==b&&(c(d),!d.contains(b));)do d=d.nextSibling;while(d&&d.nodeType===e);return Object.keys(f).length}function s(a,b){var c=b.data,d=!1,e=M[a+"Nodes"](b.nodes,c);e.startNode&&e.endNode&&r(e.startNode,e.endNode)&&(e=M[a+"Nodes"](b.nodes,c));var f=document.createRange();e.startNode,e.endNode;return e.startNode&&e.endNode&&(f.setStart(e.startNode,e.startNodeOffset),f.setEnd(e.endNode,e.endNodeOffset)),f.toString()==c.text&&(d=!0),{range:f,found:d}}function t(a,b){var d,e,f,g=b.data,h="(\u201c|\u201d|\"|\u2019|')",i=!1,j=g.text.replace(/&nbsp;/g," ").trim();for(d=new RegExp(j.replace(new RegExp("([{}()^$&.*?/+|[\\\\]|]|-)","g"),"\\$1").replace(/(\\n|\\r|\s)+/g,"\\s*").replace(new RegExp("("+h+")","g"),h),"g");null!==d.exec(b.content);){var k=d.lastIndex;e==c?e=k:Math.abs(g.beginIndex-k)<Math.abs(g.beginIndex-e)&&(e=k)}if(e!=c){for(var l=e,m=0,n=j.replace(/[\n|\r|\s]/g,""),o=n.length-1,p=new RegExp(h),q=l;q>=0&&((n[o]==b.content[q]||p.test(b.content[q]))&&(m=q,--o),!(0>o));--q);var s={beginIndex:m,endIndex:l};s.pageNo=g.pageNo,res=M[a+"Nodes"](b.nodes,s),r(res.startNode,res.endNode)&&(res=M[a+"Nodes"](b.nodes,s)),f=document.createRange(),res.startNode&&res.endNode&&(f.setStart(res.startNode,res.startNodeOffset),f.setEnd(res.endNode,res.endNodeOffset),i=!0)}return{range:f,found:i}}function u(a,b){var c=b.data,d=c.commentId,e=p(d,b);if(e===Q){if(b.content="function"==typeof b.getContent?b.getContent():"",q(b)){if(e=s(a,b),e.found||(e=t(a,b)),e.found){l(e.range),E.applyToSelection(),rangy.getSelection().removeAllRanges(),rangeDimensions=i({className:K,pdfViewer:b.pdfViewer}),F=rangeDimensions.nodes;for(var f=0,g=F.length;g>f;++f)F[f].dataset.commentId=d;return setTimeout(function(){function a(){setTimeout(function(){if(b.highlight&&$(rangeDimensions.nodes).removeClass(K).addClass(J),N[d]={nodes:rangeDimensions.nodes,containerScrollTop:c,position:O++},b.highlightRemoveTime&&(N[d].timerDelay=b.highlightRemoveTime,N[d].timingFuncId=setTimeout(function(){n(d)},b.highlightRemoveTime)),b.complete){$startNode=$(rangeDimensions.nodes[0]);var a=$startNode.offset();rangeDimensions.top=a.top,rangeDimensions.left=a.left,b.complete(rangeDimensions)}},200)}var c=0,e=400,f=b.selectionOffset||100,g=rangeDimensions.nodes[0],h=$(g).closest(".textLayer");for(h&&h.length>0&&h.show();g!=b.scrollContainer&&(c+=g.offsetTop,g=g.offsetParent,g||b.scrollContainer.nodeType!==document.body.parentNode.nodeType););c-f<b.scrollContainer.scrollTop?c-=f:c+f>b.scrollContainer.scrollTop+b.scrollContainer.offsetHeight?c=c+rangeDimensions.height-b.scrollContainer.offsetHeight+f:(c=b.scrollContainer.scrollTop,e=0),e?$(b.scrollContainer).animate({scrollTop:c},{duration:e,complete:a}):a()},0),e.range}return b.failure&&b.failure(),null}b.failure&&b.failure()}}function v(a,b){try{var c=document.createRange(),d=rangy.createRangyRange(),e=M[a+"Nodes"](b.nodes,b.data);e.startNode&&e.endNode&&(c.setStart(e.startNode,e.startNodeOffset),c.setEnd(e.endNode,e.endNodeOffset),d.startContainer=c.startContainer,d.endContainer=c.endContainer,d.startOffset=c.startOffset,d.endOffset=c.endOffset,d.commonAncestorContainer=c.commonAncestorContainer,d.collapsed=c.collapsed,D.applyToRange(d))}catch(f){}}function w(b,c){try{if(c.data.hasOwnProperty("beginIndex")&&c.data.hasOwnProperty("endIndex")){if(c.data.beginIndex===c.data.endIndex)return;var d=document.createRange(),e=M[b+"Nodes"](c.nodes,c.data);if(e.startNode&&e.endNode){d.setStart(e.startNode,e.startNodeOffset),d.setEnd(e.endNode,e.endNodeOffset);var f=a.getSelection();f.removeAllRanges(),f.addRange(d)}}}catch(g){}}function x(a){for(var b,c=a.childNodes,d=c.length,e=document.TEXT_NODE,f=[],g=0;d>g;++g)b=c[g],b.nodeType===e?f.push(b):b.childNodes.length&&(f=f.concat(x(b)));return f}function y(a,b){for(var c,d,e=document.TEXT_NODE;a.nodeType!==e;)c=x(a),d=c.length,a=d?"next"===b?c[0]:c[d-1]:a[b+"Sibling"];return a}function z(a,b,c){var d,e,f,g,h=document.TEXT_NODE,i=a.startContainer.nodeType===h?a.startContainer.parentNode:a.startContainer,j=a.endContainer.nodeType===h?a.endContainer.parentNode:a.endContainer,k=a.startOffset,l=a.endOffset,m=0;if(d=i,"string"==typeof b){for(;d.classList&&!d.classList.contains(b);)d=d.parentNode;if(d===document)return}else d=b;if(c){e=d.id,e=parseInt(e.match(/pageContainer(\d+)/)[1],10);for(var n=I("#pageContainer"+e+" .textLayer > div"),o=(n.length,0);n[o]!==i;++o)m+=n[o].textContent.length;for(f=m+k;n[o]!==j;++o)m+=n[o].textContent.length;return g=m+l,{pageNo:e,textStartIndex:f,textEndIndex:g}}var p=M,q=p.newState(d),r=a.startContainer,s=a.endContainer,h=document.TEXT_NODE;r.nodeType!==h&&(r=y(r,"next")),s.nodeType!==h&&(s=y(s,"previous"));var t=p._iterateNestedNodes(q,p._checkTarget(r,k,!0)),u=p._iterateNestedNodes(q,p._checkTarget(s,l,!0));return{beginIndex:t,endIndex:u}}function A(){f.writeData("comment_on_this_tooltip_visible",!0)}function B(a,b,c){var d,e,f,h=a.querySelector(".sel-open-comments.text-operations"),i=$(a).offset(),j=c?g(b):b.getBoundingClientRect();return h||(h=document.createElement("div"),h.innerHTML="<span class='cross cnv-icons-20 icons2_Close-darkgray'></span><i class='cnv-icons-20 icons_Comments-white'></i><span>Comment on this</span>",a.appendChild(h)),h.className="sel-open-comments text-operations",d=$(h).width(),h.nodeType===document.body.nodeType&&!a.scrollTop&&a.parentNode.scrollTop&&(a=a.parentNode),e=j.top+a.scrollTop-i.top-40,f=j.left+a.scrollLeft+j.width/2-i.left,f>d/2+20&&f+d+20<$(a).width()?(f-=d/2+9,h.classList.add("arrow-center")):f+d+20>$(a).width()?(f-=d-4,h.classList.add("arrow-right")):(f-=24,h.classList.add("arrow-left")),h.style.top=e+"px",h.style.left=f+"px",h.classList.add("visible"),h}function C(a,b){var c=rangy.getSelection(),e=d("unescape")(c.toHtml().replace(/<\/div>|<\/p>|<br>|<\/li>/g,"\n").replace(/<.*?>|<\/.*?>/g,"")),f=null;return e&&(f=z(c.getRangeAt(0),a,b),f&&(f.text=e.replace(/\n/g,"\r"),f.sel=c)),f}var D,E,F,G,H=document.querySelector.bind(document),I=document.querySelectorAll.bind(document),J="sel-text-highlight",K="sel-text-invisible-highlight",L=e.isIE();e.isIE(10);rangy.init(),rangy.createClassApplier===c?setTimeout(function R(){return rangy.createClassApplier===c?void setTimeout(R,0):(D=rangy.createClassApplier(J),E=rangy.createClassApplier("sel-text-invisible-highlight"),void(G.highlighter=D))},0):(D=rangy.createClassApplier(J),E=rangy.createClassApplier("sel-text-invisible-highlight"));var M={};M._checkTarget=function(a,b,c){return function(d,e,f){return c&&a===e?d-f+b:d>a?{node:e,nodeOffset:a-(d-f)}:!1}},M._iterateNestedNodes=function(a,b){for(var c,d,e,f,g=a.stack,h=document.TEXT_NODE,i=document.COMMENT_NODE;a.childIdx<a.childNodesLen;){if(d=a.childNodes[a.childIdx],d.nodeType===h){if(c=d.textContent.length,a.textLen+=c,f=b(a.textLen,d,c),f!==!1)return a.textLen-=c,f}else if(d.nodeType!==i&&d.childNodes.length){g.push({childIdx:a.childIdx+1,childNodes:a.childNodes,childNodesLen:a.childNodesLen}),a.childIdx=0,a.childNodes=d.childNodes,a.childNodesLen=a.childNodes.length;continue}for(++a.childIdx;a.childIdx>=a.childNodesLen&&g.length;)e=g.pop(),a.childIdx=e.childIdx,a.childNodes=e.childNodes,a.childNodesLen=e.childNodesLen,e=null}return 0},M.newState=function(a){return{stack:[],textLen:0,childIdx:0,childNodes:a.childNodes,childNodesLen:a.childNodes.length}},M.nestedNodes=function(a,b){var c=this,d=c.newState(a);--b.endIndex;var e=c._iterateNestedNodes(d,M._checkTarget(b.beginIndex)),f=c._iterateNestedNodes(d,M._checkTarget(b.endIndex));return++b.endIndex,++f.nodeOffset,{startNode:e.node,startNodeOffset:e.nodeOffset,endNode:f.node,endNodeOffset:f.nodeOffset}},M.textContentNodes=function(a,b){for(var c,d,e=b.beginIndex,f=b.endIndex,g=b.pageNo,h=0,i=0,j=a.length,k=0;j>k&&(h=a[k].str.length,i+=h,!(i>=e));++k);if(c=H("#pageContainer"+g+" > .textLayer > div.idx-"+k),null===c){for(;null===c&&j>k;)++k,c=H("#pageContainer"+g+" > .textLayer > div.idx-"+k);k===j&&--k,h=a[k].str.length,i+=h}if(d=e-(i-h),0>d&&(d=0),f>i){for(++k;j>k&&(h=a[k].str.length,i+=h,!(i>=f));++k);k===j&&--k}if(endNode=H("#pageContainer"+g+" > .textLayer > div.idx-"+k),null===endNode){for(;null===endNode&&j>k;)++k,endNode=H("#pageContainer"+g+" > .textLayer > div.idx-"+k);k===j&&--k,h=a[k].str.length,i+=h}return endNodeOffset=f-(i-h),endNodeOffset<0&&(endNodeOffset=0),{startNode:c?c.childNodes[0]:c,startNodeOffset:d,endNode:endNode?endNode.childNodes[0]:endNode,endNodeOffset:endNodeOffset}},M.flatNodes=function(a,b){for(var c,d,e,f,g,h=b.beginIndex,i=b.endIndex,j=a,k=j.length,l=0,m=!1,n=!1,o=0;k>o&&(c=j[o].textContent.length,0===c||(l+=c,!m&&l>h&&(d=j[o],f=h-(l-c),m=!0),!n&&l>i&&(e=j[o],g=i-(l-c),n=!0),!m||!n));++o);return{startNode:d.childNodes[0],startNodeOffset:f,endNode:e.childNodes[0],endNodeOffset:g}};var N={},O=0,P=!0,Q=!1;return G={commentOnThisTooltipClicked:A,restoreHighlightedSelection:v,getCurrentSelectionNodes:j,restoreNativeSelection:w,getSelectionNodesById:k,calcSelDimensions:i,getOffsetIndexes:z,rmSelectionById:n,rmAllSelections:o,showIcoAboveSel:B,getSelection:C,highlighter:D,mkSelection:l,rmSelection:m,selectText:u}}]),b.module("convoApp").directive("cnvUserProfileImage",["$compile","$injector","Users","userIdToImgUrlFilter","userImgUrlFilter","utils","config",function(a,b,c,d,e,f,g){return{restrict:"E",scope:!1,link:function(a,h,i){function j(){}function k(){p.removeEventListener("load",k),p.removeEventListener("error",l)}function l(a){if(k(),h){for(var b=h[0];b.firstChild;)b.removeChild(b.firstChild);q&&q(r)}}a.__leak_user_profile=new j;var m,n,o;g.IS_MENULET||(m=b.get("Feed"),n=b.get("Comments"),o=b.get("userIdToImgUrlForFeedFilter"));var p,q,r=null,s=function(){h.removeClass("faded");var b=a.$eval(i.size)||48,g=a.$eval(i.source),j=a.$eval(i.userId),s=(a.$eval(i.profile),a.$eval(i.width)||b),t=a.$eval(i.height)||b,u=a.$eval(i.imgUrl)||null,v=null;"function"==typeof u&&(u=u()),b=+s;var w=f.getUserProfileImageForSize(b);if(h.addClass(a.$eval(i.classes)||""),m&&g===m.source?(v=u||o(j,w),r=m.getUser(j),r||n&&(r=n.getUser(j)),r&&!r.accessible&&h.addClass("faded")):(v=u||d(j,w),r=c.getUserById(j),r&&"REMOVED"===r.status&&h.addClass("faded")),!r){var x=a.$eval(i.profileType),y=a.$eval(i.profileVersion),z=a.$eval(i.fullName);r={},r.name=z||". .",r.user_id=j,y&&x&&(r.profileVersion=y,r.profileType=x,v=u||e(r.user_id,r.profileType,r.profileVersion,w))}q=function(a){var b=a.name;b||(b=(a.first_name+" "+a.last_name).trim()),b||(b=a.email);var c=f.initials(b),d=f.stringToColor(a.name||(a.first_name||".")+" "+(a.last_name||".")),e=h.find(".img-circle");if(!e.length||e[0].innerHTML!=c){var g='<span class="img-circle" style="height: '+t+"px; width:"+s+"px; font-style: normal; line-height: "+t+"px;  text-align: center; font-weight: 100; font-size:inherit; letter-spacing: -1px; background-color:"+d+'">'+c+"</span>";$(h).empty().append($(g))}};var A=h.find("img");if(!A.length||A.attr("src")!=v)if(v)if(-1!==v.indexOf("user-images/default-user/thumbnails/"))r&&q&&q(r);else{p&&(k(),p=null),p=document.createElement("img"),p.src=u||v,p.style.width=s+"px",p.style.height=t+"px",String(a.$eval(i.classes)).includes("img-rounded")||(p.className=p.className+" img-circle");for(var B=h[0];B.firstChild;)B.removeChild(B.firstChild);B.appendChild(p),p.addEventListener("load",k),p.addEventListener("error",l)}else q&&q(r)};a.$on("$destroy",function(){t(),p&&(k(),p=null);var a=h.find("img");a&&a.length>0&&a.off().remove(),h.empty(),q=null,r=null,s=null,h=null,m=null,n=null,o=null});var t=a.$on("refreshImage",s);s()}}}]),b.module("convoApp").directive("cnvRightClick",["$parse",function(a){return function(b,c,d){var e=a(d.cnvRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}]).directive("cnvHandlePlaceholder",[function(){return function(a,b,c){var d=b[0].placeholder;b[0].addEventListener("keyup",function(){a.$apply(function(){b[0].value.length>0?b[0].placeholder="":b[0].placeholder=d})})}}]).directive("cnvMouseWheelScroll",["utils",function(b){return function(c,d,e){function f(b){i||j();var c=b||a.event,d=0;if("detail"in c&&(d=-1*c.detail),"wheelDelta"in c&&(d=c.wheelDelta),g?("wheelDeltaX"in c&&(d=c.wheelDeltaX),"deltaX"in c&&(d=-1*c.deltaX)):("wheelDeltaY"in c&&(d=c.wheelDeltaY),"deltaY"in c&&(d=-1*c.deltaY)),0!==d){var e=!1,f=$(b.target),k=f.closest(".cnvScrollContainer");if(k&&0!=k.length||(k=f.closest(".ql-editor")),k&&k.length>0){var l=g?k.scrollLeft():k.scrollTop();if(h){var m=k.scrollHeight,n=g?k.width():k.height();0==l&&d>0?e=!0:l+n+22>=m&&0>d&&(g?k.scrollLeft(m):k.scrollTop(m),e=!0)}else e=!0,l-=d,g?k.scrollLeft(l):k.scrollTop(l);e&&(b.preventDefault(),b.stopPropagation())}}}var g,h,i=!1,j=function(){var a=d.find(".cnvScrollContainer");if(a&&a.length>0){var b=a.css("overflow-x"),c=a.css("overflow-y");g="hidden"==c&&("scroll"==b||"auto"==b),i=!0}};setTimeout(function(){h=b.isFirefox()||b.isIE()||!b.isOsX(),j(),d[0].addEventListener("DOMMouseScroll",f),d[0].addEventListener("mousewheel",f)},50),c.$on("$destroy",function(){d[0].removeEventListener("DOMMouseScroll",f),d[0].removeEventListener("mousewheel",f)})}}]).directive("preventEventMousedown",function(){return function(a,b,c){function d(a){a.preventDefault()}b.on("mousedown",d),a.$on("destroy",function(){b.off("mousedown",d)})}}).directive("boDate",function(){return function(a,b,c){function d(){var d=a.$eval(c.boDate);b.text(d)}d(),a.$on("render_date",d)}}).directive("cnvPreventEvaluationWhenNotInViewport",function(){return{restrict:"A",priority:1001,scope:!0,compile:function(a,b){return{pre:function(a,b,c){a.$addWatcherGate(function(){return d(b[0])},function(a,b,c,d){return isDefined(d)&&"slyShow"==d?!1:!0})}}}}}).directive("cnvEvaluateOnlyWhen",["$parse",function(a){return{restrict:"A",priority:1001,compile:function(b,c){return{pre:function(b,c,d){a(d.cnvEvaluateOnlyWhen);b.$addWatcherGate(function(){return b.itemData._dirty?(b.itemData._dirty=!1,!0):!1},function(a,b,c,d){return!0})}}}}}]).directive("onScrolledBottom",function(){return function(a,b,c){var d=+a.$eval(c.triggerBefore)||0,e=b[0],f=_.throttle(function(b){e.scrollTop+e.offsetHeight>=e.scrollHeight-d&&a.$apply(function(){a.onScrolledBottom({e:b})})});b.bind("scroll mousewheel",f)}}).directive("onFeedScrolledBottom",function(){return function(b,c,d){var e=$(a),f=$(document),g=b[d.onFeedScrolledBottom],h=function(a){if(b.tab.selected){var c=e.scrollTop()+e.height(),d=f.height();c>d-500&&b.$apply(function(){g(c===d)})}};h=_.throttle(h,250),e.scroll(h)}}).directive("highlightText",["$interval",function(a){return function(b,c,d){var e=null;b.$watch(d.highlightText,function(b){b!=e&&(e=b,a(function(){var a=$(c);if(b&&b.length>0)for(var d=0;d<b.length;d++)a.highlight2(b[d],"text-highlight");else a.removeHighlight("text-highlight")},0,1))})}}]).directive("cnvClickedOutsideThis",["$parse",function(a){return{restrict:"A",link:function(a,b,c){function d(d){for(var e=d.target,f=!1;null!=e&&e!=document.documentElement;){if(e==b[0]||e.className&&e.className.indexOf&&-1!=e.className.indexOf(c.cnvExceptionSelectorClass)){f=!0;break}e=e.parentElement}f||a.cnvClickedOutsideThis(d)}$(document).on("mousedown",d),a.$on("$destroy",function(a){$(document).off("mousedown",d)})}}}]).directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}).directive("cnvAutoSelected",function(){return{restrict:"A",link:function(a,b,c){setTimeout(function(){b[0].select()},0)}}}).directive("suppressScrollPropagation",function(){return{restrict:"A",link:function(a,b,c){b.mousewheel(function(a,b){var c=null;if(c=$(a.target).hasScrollBar()?$(a.target):$(a.target).scrollParent(),c.length){var d=c.scrollTop();c[0].scrollHeight>c[0].clientHeight&&(0==d&&b>0||d==c[0].scrollHeight-c[0].clientHeight&&0>b)&&(a.stopImmediatePropagation(),a.preventDefault())}})}}}),function(){var a={};b.forEach("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(b){var c="bo"+b.charAt(0).toUpperCase()+b.slice(1);a[c]=["$parse",function(a){return{restrict:"A",compile:function(d,e){var f=a(e[c],null,!0);return function(a,c){c.on(b,function(b){f(a,{$event:b})})}}}}]}),b.module("convoApp").directive(a)}(),b.module("convoApp").filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]).filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("htmlToPlaintext",function(){return function(a){return String(a).replace(/<(?:.|\n)*?>/gm,"")}}).filter("limitText",function(){return function(a,b){return a&&a.length&&a.length>b?a.substr(0,b-3)+"...":a}}).filter("shift",function(){return function(a){return a.shift(),a}}).filter("listCount",function(){return function(a){for(var b=0,c=0,d=a.length;d>c;++c)a[c]&&++b;return b}}).filter("shortHandTitle",function(){return function(a){var b=a.trim().split(" "),c=b[0];return b.length>1&&(c+=" "+b[b.length-1].charAt(0)),c}}).filter("concatWithSpace",function(){return function(a,b){return a+" "+b}}).filter("subject",function(){return function(a,b){return a>1?a+" "+b+"s":a+" "+b}}).filter("removeTags",["utils",function(a){return function(b){return a.removeTags(b)}}]).filter("limitHtmlText",["utils",function(a){return function(b,c,d){var e={isTruncated:!1,htmlStr:b,fullText:""};if(b&&c>0){var f=document.createElement("div");if(f.innerHTML=b,e.fullText=f.innerText,e.fullText&&e.fullText.length>c){var g=a.truncateHtmlString(b,e.fullText.length-c);e.htmlStr=(g.htmlStr.substring(0,g.idx)+"..."+g.htmlStr.substring(g.idx)).replace(/^((<br>)|(<br \/>)|(<br >)|(<br\/>))*|((<br>)|(<br \/>)|(<br >)(<br\/>))*$/g,"").replace(/^(<br>)*|(<br\/>)*$/g,"").replace(/<p><br><\/p>/g,"").replace(/<(div|em|p|strong)[^>]*>\s*<\/(div|em|p|strong)>/g,""),e.isTruncated=!0}}return d?e:e.htmlStr}}]).filter("iif",function(){return function(a,b,c){return a?b:c||""}}).filter("dateAgo",["datetimeService",function(a){return function(b,c,d,e,f,g,h,i,j,k){return a.makeRelativeDateString(b,c,d,e,f,g,h,i,j,k)}}]).filter("localize",["datetimeService",function(a){return function(b,c){return a.localize(b,c)}}]).filter("dateSeparatorFromCurrentTimeByDayMonthOrYear",["datetimeService",function(a){return function(b){return a.dateSeparatorFromCurrentTimeByDayMonthOrYear(b)}}]).filter("dateSeparatorFromCurrentTime",["datetimeService",function(a){return function(b,c){return a.dateSeparatorFromCurrentTime(b,c)}}]).filter("getUserName",["Feed","Comments",function(a,b){return function(c){var d;return d=a.getUserName(c),"Unknown"===d&&(d=b.getUserName(c)),d}}]).filter("idToName",["Feed",function(a){return function(b){return b?a.getNameById(b):""}}]).filter("break",function(){return function(a){return a.replace(/\,/g,", ")}}).filter("sharingInfoTooltipText",["Feed","$filter",function(a,b){return function(c,d){for(var e,f="",g=d;e=c[g];g++)f+=b("limitText")(_.escape(a.getNameById(e.published_to)),80),g!==c.length-1&&(f+="<br>");return f}}]).filter("chatParticipentsTooltipText",["$filter","userInfo",function(a,b){return function(b,c,d,e){var f="";if(d){var g,h;e=e||10;var i=b?b.length:0;c?(h=i-c-e,e=c+e):h=i-e;for(var j,k=c;i>k;k++){if(!(e>=k+1)){f+="+ "+h+" more";break}j=b[k],g="function"==typeof j.getDisplayName?j.getDisplayName():j.displayName||j.name,f+=a("limitText")(_.escape(g),80)+"<br>"}}return f}}]).filter("getFeedItemLikeInfo",["Likes","Feed","$filter",function(a,b,c){return function(b,d){var e=b.resource_id,f=b.resource_id,g=b.app_instance_id,h=1;b.subResourceId&&(e+=","+b.subResourceId,h=null);var i=b.like_info.liked_by||"",j=d||null,k=a.getLikesDetailWithUsersInfo(e,f,g,h);k.then(function(a){var b="",d=a.data.users;d||(d=a.data);var e=0,f=Object.keys(d).length;for(var g in d)if(d.hasOwnProperty(g)){if(g===i&&b.length>1)continue;if(b+=c("limitText")(_.escape(d[g].name),80)+"<br>",e++,e>=14){b+="+ "+Number(f-e)+" more";break}}b=b.replace(/<br>\s*$/,""),j(b)})}}]).filter("getCommentLikeInfo",["Likes","Feed","$filter",function(a,b,c){return function(b,d){var e=d||null,f=a.getLikesDetailWithUsersInfo(null,null,null,null,b);f.then(function(a){var b="",d=a.data;for(var f in d)d.hasOwnProperty(f)&&(b+=c("limitText")(_.escape(d[f].name),80)+"<br>");b=b.replace(/<br>\s*$/,""),e(b)})}}]).filter("getFileIconByType",["config","utils",function(a,b){return function(c,d){var e=b.getFileFormat(c);if("Audio"===e)return(a.IS_MENULET?"../":"")+"assets/cnv-icons/sprites/png/icons_Audio-darkgray.png";c=c.toLowerCase();var f="default_v2";switch(c){case"docx":case"doc":case"rtf":f="doc";break;case"xls":case"xlsx":case"xlsm":case"xlsb":f="xls";break;case"jpg":case"jpeg":f="jpg";break;case"ppt":case"pptx":f="ppt";break;case"mov":case"qt":case"m4v":case"mp4":case"mpeg4":case"mpe":case"mpeg":case"avi":case"dat":case"mpg":case"flv":case"mkv":case"ogg":case"asf":case"wmv":case"webm":case"divx":case"3gp":f="video_v2";break;case"air":case"bmp":case"gif":case"mp3":case"pdf":case"png":case"pps":case"psd":case"tif":case"tga":case"txt":case"rar":case"wav":case"wma":f=c;break;default:f="default_v2"}return d=d||"16",a.AWS_FILE_DIR_BASE+"fileIcons/"+f+"_"+d+".png"}}]).filter("getNewFileIconByType",["utils",function(a){return function(b,c,d){var e="cnv-icons-"+c,f="fileplainlarge",g="darkgray";d&&(g=d);var h=a.getFileFormat(b);switch(h){case"Video":f="icons_Video";break;case"Audio":f="icons_Audio";break;default:f="fileplainlarge"}return e+" "+f+"-"+g}}]).filter("getSmallFileIconClassByTypeFromAssets",[function(){return function(a,b){a=a.toLowerCase();var c="fileplainsmall cnv-small-file-ico";switch(a){case"docx":c="cnv-small-file-ico docx";break;case"doc":c="cnv-small-file-ico doc";break;case"rtf":c="cnv-small-file-ico rtf";break;case"xls":c="cnv-small-file-ico xls";break;case"xlsx":c="cnv-small-file-ico xlsx";break;case"xlsm":c="cnv-small-file-ico xlsm";break;case"xlsb":c="cnv-small-file-ico xlsb";break;case"jpg":c="cnv-small-file-ico jpg";break;case"jpeg":c="cnv-small-file-ico jpeg";break;case"ppt":c="cnv-small-file-ico ppt";break;case"pptx":c="cnv-small-file-ico pptx";break;case"air":c="cnv-small-file-ico air";break;case"avi":c="cnv-small-file-ico avi";break;case"bmp":c="cnv-small-file-ico bmp";break;case"flv":c="cnv-small-file-ico flv";break;case"gif":c="cnv-small-file-ico gif";break;case"mp3":c="cnv-small-file-ico mp3";break;case"mp4":c="cnv-small-file-ico";break;case"mpeg":c="cnv-small-file-ico mpeg";break;case"pdf":c="cnv-small-file-ico pdf";break;case"png":c="cnv-small-file-ico png";break;case"pps":c="cnv-small-file-ico pps";break;case"psd":c="cnv-small-file-ico psd";break;case"tif":c="cnv-small-file-ico tif";break;case"tga":c="cnv-small-file-ico tga";break;case"txt":c="cnv-small-file-ico txt";break;case"rar":c="cnv-small-file-ico rar";break;case"wav":c="cnv-small-file-ico wav";break;case"wma":c="cnv-small-file-ico wav";break;case"mov":c="cnv-small-file-ico mov";break;case"json":c="cnv-small-file-ico json";break;default:c="cnv-small-file-ico"}return c}}]).filter("getFileNameToShowOnSnippet",["$filter",function(a){return function(b){var c=a("getFileTitleOnly")(b).substring(0,30);console.log(c);var d=a("getFileExtension")(b);return c=30==c.length?c+"..."+d:c+"."+d}}]).filter("getFileTitleOnly",function(){return function(a){return a=a.replace(/\\/g,"/"),a.substring(a.lastIndexOf("/")+1,a.lastIndexOf("."))}}).filter("getFileExtension",[function(){return function(a){a=a.toLowerCase();var b=a.lastIndexOf(".");return-1!==b?a.substr(b+1):"NONE"}}]).filter("getFileExtensionForIcon",[function(){return function(a){a=a.toLowerCase();var b=a.substr(a.lastIndexOf(".")+1)||a;return b.length>4&&(b=b.substring(0,2)+".."),b}}]).filter("matchedFilesNameCount",function(){return function(a,b){if(a.length&&b&&b.length){var c=[],d=0,e=!1;for(var f in b)c=c.concat(b[f].split("+"));for(var g in a){e=!1;for(var h in c)-1!=a[g].name.toLowerCase().indexOf(c[h])&&(e=!0);e&&d++}return d}return 0}}).filter("feedItemFilesLimit",["$filter",function(a){return function(b){var c=2;return a("limitTo")(b,c)}}]).filter("getImageResourceLinkUrl",["AppLinks",function(a){return function(b,c,d,e,f){var g=a.newResourceLink(c,[{type:d,uid:e,title:f},{type:"images",uid:b}],null,f);return a.linkToUrl(g,!0)}}]).filter("getFileResourceLinkUrl",["AppLinks",function(a){return function(b,d,e,f,g,h,i){if(b===c||d===c||f===c)return"";var j="files";"IMAGE"==d?j="images":"DOC"===d&&(j="files");var k=a.newResourceLink(e,[{type:f,uid:g,title:h},{type:j,uid:b}],null,h,i);return a.linkToUrl(k,!0)}}]).filter("getSnippetImagePath",["config","$rootScope",function(a,b){return function(c,d){if(c){var e=a.AWS_FILE_DIR_BASE+b.login_data.account_id+"/snippets/"+d+"/"+c.toString();return e}}}]).filter("getNoteThumbnailPath",["config","utils","$rootScope",function(a,b,d){return function(e,f,g,h,i){if(e.preLocalData)return e.preLocalData;var j=b.isRetina();i?i+="/":i=e.ver>=5?j?"980x500/":"490x250/":4==e.ver&&j?"855x900/":e.ver>=3?"566x600/":"",g===c&&(g=0);var k="";return k=4==h?"link":"note",a.getLoadBalancedAwsFileDirBase(g)+d.login_data.account_id+"/"+k+f+"/thumbnails/"+i+e.thumbnail_name.toString()}}]).filter("getChatImageThumbnailPath",["config","utils","$rootScope",function(a,b,c){return function(d,e,f){var g=b.isRetina();return e||(e=g?"750x750":"96x96"),a.getLoadBalancedAwsFileDirBase(0)+"chat_icons/"+c.login_data.account_id+"/"+d+"/thumbnails/"+d+"-thumbnail-"+e+"-"+f+".jpg"}}]).filter("getCommentAttachmentThumbnailPath",["config","utils","$rootScope",function(a,b,d){return function(e,f,g){var h="",i=b.isRetina(),h="";e.ver>=5?h=i?"980x500/":"490x250/":4==e.ver&&i?h="855x900/":e.ver>=3&&(h="566x600/");var j="";return 4==e.app_instance_id?j="link":6==e.app_instance_id&&(j="note"),g===c&&(g=0),a.getLoadBalancedAwsFileDirBase(g)+d.login_data.account_id+"/"+j+f+"/thumbnails/"+h+e.thumbnail_name.toString()}}]).filter("getCommentAttachmentThumbnailPathDefaultSize",["config","$rootScope",function(a,b){return function(d,e,f,g){var h="566x600/",i="";return 4==e?i="link":6==e&&(i="note"),g===c&&(g=0),a.getLoadBalancedAwsFileDirBase(g)+b.login_data.account_id+"/"+i+f+"/thumbnails/"+h+d;
}}]).filter("getPreviewImageThumbnailPath",["config","$rootScope",function(a,b){return function(c,d,e){var e=e||"566x600",f=a.AWS_FILE_DIR_BASE+b.login_data.account_id+"/note"+d+"/thumbnails/"+e+"/"+c;return f}}]).filter("getVideoPath",["config","$rootScope",function(a,b){return function(c,d,e,f,g,h){var i,j,k;return j=4==e?"link":"note",k=h?a.AWS_FILE_DIR_BASE_FOR_NO_AUTH:a.AWS_FILE_DIR_BASE,480===g?i=k+b.login_data.account_id+"/"+j+d+"/videos/"+c+"."+f:720===g?i=k+b.login_data.account_id+"/"+j+d+"/videos/1280x720/"+c+"."+f:1080===g&&(i=k+b.login_data.account_id+"/"+j+d+"/videos/1920x1080/"+c+"."+f),i}}]).filter("getVideoPreviewPath",["config","$rootScope",function(a,b){return function(c,d,e,f){var g="note";g=4==e?"link":"note";var h=a.AWS_FILE_DIR_BASE+b.login_data.account_id+"/"+g+d+"/"+c+"."+f;return h}}]).filter("getDownloadUrl",["$rootScope","utils",function(a,b){return function(c,d,e,f){var g="";return g=4==f?"link":"note",b.getDownloadUrl(a.login_data.account_id+"/"+g+e+"/"+d,c)}}]).filter("getOriginalImagePath",["config","$rootScope",function(a,b){return function(c,d,e,f,g){var h="";h=4==e?"link":"note";var i=a.AWS_FILE_DIR_BASE;return f&&(i=a.AWS_FILE_DIR_BASE_FOR_NO_AUTH),i+=b.login_data.account_id+"/"+h+d+"/"+c,g&&(i+="?a=a"),i}}]).filter("getFilePreviewPath",["config","$rootScope",function(a,b){return function(c,d,e,f,g,h){var i="";i=4==f?"link":"note";var j=a.AWS_FILE_DIR_BASE;return g&&(j=a.AWS_FILE_DIR_BASE_FOR_NO_AUTH),j+=b.login_data.account_id+"/"+i+e+"/"+c+"/pdf/"+d.substring(0,d.lastIndexOf("."))+".pdf",h&&(j+="?a=a"),j}}]).filter("getFaviconIconPath",["config",function(a){return function(b){var c;return b&&(+b.favicon_converted?c=a.AWS_FILE_DIR_BASE+"favicon/"+b.icon:b.icon?c=a.AWS_FILE_DIR_BASE+b.icon:b.original_favicon_url&&(c=b.original_favicon_url)),c}}]).filter("getPartialOriginalImagePath",["config","$rootScope",function(a,b){return function(a,c,d){var e="";e=4==d?"link":"note";var f=b.login_data.account_id+"/"+e+c+"/"+a;return f}}]).filter("hasFiles",function(){return function(a){return a&&a.files&&a.files.length>0?!0:!1}}).filter("hasTags",function(){return function(a){return a&&a.tags&&a.tags.length>0?!0:!1}}).filter("getFeedItemFilesCount",function(){return function(a){if(a&&a.files&&a.files.length>0){var b=a.files.length;return 1==b?b+" file":b+" files"}return""}}).filter("getOrigionalOrDefaultFavIcon",function(){return function(a){return"default_favicon.png"==a?"assets/img/feed/"+a:a}}).filter("getLinkThumbnailPath",["config","$rootScope",function(a,b){return function(c,d){var e=c;if(d||(d=1),1==d){var f=c.lastIndexOf(".");e=c.substring(0,f)+""+c.substring(f)}else if(2==d){var f=c.lastIndexOf(".");e=c.substring(0,f)+"-thumbnail-500x500"+c.substring(f)}else if(3==d){var f=c.lastIndexOf(".");e=c.substring(0,f)+"-thumbnail-340x260"+c.substring(f)}else if(4==d){var f=c.lastIndexOf(".");e=c.substring(0,f)+"-thumbnail-718x400"+c.substring(f)}return a.AWS_FILE_DIR_BASE+b.login_data.account_id+"/links-thumbnails/"+e}}]).filter("userIdToImgUrl",["userImgUrlFilter","Users",function(a,b){return function(c,d,e){var f=b.getUserById(c);return f?a(f.user_id,f.profile_image_type,f.profile_image_version,d,e,f.serialNo):a(null,0,0,d,e)}}]).filter("userIdToImgUrlForFeed",["userImgUrlFilter","Feed","Comments","Users",function(a,b,c,d){return function(e,f){var g=b.getUser(e);return g||(g=c.getUser(e)),g?a(e,g.profile_image_type,g.profile_image_version,f,!1,d.getUserSerialNo(e)):null}}]).filter("userImgUrl",["config","UserProfileImage",function(a,b){return function(d,e,f,g,h,i){g||(g=b.PROFILE_IMAGE_SIZE_48x48);var j=a.AWS_FILE_DIR_BASE;return h&&(j=a.AWS_FILE_DIR_BASE_FOR_NO_AUTH),d&&e==b.PROFILE_IMAGE_TYPE_SYSTEM?j+"user-images/system-user/thumbnails/system-user-thumbnail-"+g+".png":d&&0!=e&&0!=f?e==b.PROFILE_IMAGE_TYPE_CUSTOM?(h||i===c||(j=a.getLoadBalancedAwsFileDirBase(i)),j+"user-images/"+d+"/thumbnails/"+d+"-thumbnail-"+g+"-"+f+".jpg"):void 0:j+"user-images/default-user/thumbnails/default-user-thumbnail-"+g+".png"}}]).filter("idToFilterUrl",["$rootScope","Feed","Users","Comments","Groups",function(a,b,c,d,e){return function(e,f,g){var h,i,j="#/v1/"+a.login_data.account_id+"/feed?q=",k=e;if("USER"==f){if(h="from",i=b.getUserName(e),"Unknown"===i&&(i=d.getUserName(e)),g){var l=c.getUserById(e);l||(l=b.getUser(e)),l||(l=d.getUser(e)),l&&(k=l.email)}}else h="to",i=b.getGroupName(e);return j+=encodeURIComponent(h+':"'+k+'"')+"#title="+encodeURIComponent(i).replace(/'/g,"%27")}}]).filter("idToFilterUrlForApp",["accountInfo","Users","Groups",function(a,b,c){return function(d,e,f,g){var h,i,j="#/v1/"+a.getAccountId()+"/feed?q=",k=d;if("USER"==e){h="from";var l=b.getUser(d);!g&&l&&(g=l.getFullName),f&&(i=k,k=l.email)}else{h="to";var m=c.getGroup(d);!g&&m&&(g=m.get("title"))}return j+=encodeURIComponent(h+':"'+k+'"')+"#title="+encodeURIComponent(g).replace(/'/g,"%27"),i&&(j+="&filter_value="+encodeURIComponent(i)),j}}]).filter("stagNameToFilterUrlForApp",["accountInfo","Users",function(a,b){return function(b){var c="#/v1/"+a.getAccountId()+"/feed?q=";return c+=encodeURIComponent("#"+b)+" stag=true"}}]).filter("idToFilterUrlForFeed",["Feed",function(a){return function(a,b){}}]).filter("isUserGroupAssessibleForNotesApp",["notesAppDataProvider",function(a){return function(b){var c=a.getItem(b);return c&&c.accessible}}]).filter("idToFilterUrlForNotesApp",["accountInfo","notesAppDataProvider","userInfo",function(a,b,c){return function(d){var e,f="#/v1/"+a.getAccountId()+"/feed?q=",g=d,h=b.getItem(d);return h&&(c.isAdminMode()||h.accessible||"USER"===h.type?(e="USER"==h.type?"from":"to",f+=encodeURIComponent(e+':"'+g+'"')+"#title="+encodeURIComponent(h.label).replace(/'/g,"%27")):f="javascript:void(0);"),f}}]).filter("isUserGroupAssessibleForLinksApp",["linksAppDataProvider",function(a){return function(b){var c=a.getItem(b);return c&&c.accessible}}]).filter("idToFilterUrlForLinksApp",["accountInfo","linksAppDataProvider","userInfo",function(a,b,c){return function(d){var e,f="#/v1/"+a.getAccountId()+"/feed?q=",g=d,h=b.getItem(d);return h&&(c.isAdminMode()||h.accessible||"USER"===h.type?(e="USER"==h.type?"from":"to",f+=encodeURIComponent(e+':"'+g+'"')+"#title="+encodeURIComponent(h.label).replace(/'/g,"%27")):f="javascript:void(0);"),f}}]).filter("idToNameForLinksApp",["linksAppDataProvider",function(a){return function(b){return a.getNameById(b)}}]).filter("idToNameForNotesApp",["notesAppDataProvider",function(a){return function(b){return a.getNameById(b)}}]).filter("idToShortNameForNotesApp",["notesAppDataProvider",function(a){return function(b){return a.getShortNameById(b)}}]).filter("dataToFilterUrl",["accountInfo",function(a){return function(b,c,d){var e,f,g="#/v1/"+a.getAccountId()+"/feed?q=",h=b.id;return"USER"==c?(e="from",f=b.userName,d&&(h=b.email)):(e="to",f=b.groupName),g+=encodeURIComponent(e+':"'+h+'"')+"#title="+encodeURIComponent(f)}}]).filter("getDomainNameFormUrl",["utils",function(a){return function(b){return a.getDomainNameFromUrl(b)}}]).filter("getResourceLinkUrl",["AppLinks",function(a){return function(b,d,e,f,g,h){if(0===d.length||d[0].uid===c)return"";var i=a.newResourceLink(b,d,e,f,null,null,g,h);return a.linkToUrl(i,!0)}}]).filter("getCommentResourceLinkUrl",["getResourceLinkUrlFilter","userProvider",function(a,b){return function(c,d,e,f,g,h){var i=b.getUser(e.from_user,b.DATA_FORMAT_SERVICE).name+': "';return i+=h?h:e._comment_title,i+='"',a(c,d,e.uid,i,f,g)}}]).filter("getCommentUrl",["getCommentResourceLinkUrlFilter",function(a){return function(b){return b.resource_link.resource_path?a(b.app_instance_id,b.resource_link.resource_path.hierarchy,b):""}}]).filter("getCommentAttachmentUrl",["getCommentResourceLinkUrlFilter",function(a){return function(b,c,d,e){return b.resource_link.resource_path?a(b.app_instance_id,b.resource_link.resource_path.hierarchy,b,c,d,e):""}}]).filter("getCommentsCountString",function(){return function(a){return 1==a?a+" Comment":a+" Comments"}}).filter("searchGroupUser",function(){return function(a,b,c){var d=[];if(b&&b.length>0){for(var e=b.replace(new RegExp("([{}()^$&.*?/+|[\\\\]|]|-)","g"),"\\$1"),f=0;f<a.length;f++){var g=new RegExp("(([\\s,<>():@.])|^)"+e,"gi");a[f].email?(a[f].formattedName=a[f].title,a[f].formattedEmail=a[f].email,(a[f].title.match(g)||a[f].email.match(g))&&(d.push(a[f]),a[f].title.match(g)&&(a[f].formattedName=a[f].formattedName.replace(new RegExp("(([\\s,<>():@.])|^)("+e+")","gi"),"$1<b>$3</b>")),a[f].email.match(g)&&(a[f].formattedEmail=a[f].formattedEmail.replace(new RegExp("(([\\s,<>():@.])|^)("+e+")","gi"),"$1<b>$3</b>")))):(a[f].formattedName=a[f].title,a[f].title.match(g)&&(d.push(a[f]),a[f].formattedName=a[f].title,a[f].formattedName=a[f].formattedName.replace(new RegExp("(([\\s,<>():@.])|^)("+e+")","gi"),"$1<b>$3</b>")))}d.length>0&&null==c&&d.sort(function(a,b){return a.title>b.title?1:a.title<b.title?-1:0})}return c&&!b?a:d}}).filter("fullLinkRegExp",function(){return function(a){return a=a.trim(),a.length&&-1!=a.search(/(ftp:\/\/|https:\/\/|http:\/\/|www\.)([\w\/\-\_\+\.\?\=\#\&\%\@\,\:\;\~\(\)\*\'\$\!]+)/gi)?!0:!1}}).filter("partialLinkRegExp",function(){return function(a){return a=a.trim(),a.length&&-1!=a.search(/([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+(com|org|net|edu|gov|mil|biz|info|mobi|name|aero|asia|jobs|museum|coop)([\w\/\-\_\+\.\?\=\#\&\%\@\,\:\;\~\(\)\*\'\$\!]*)/gi)?!0:!1}}).filter("orderByRank",["Groups",function(a){return function(a){var b=[];if(a){for(var c=0;c<a.length;c++)a[c].isPublishable&&b.push(a[c]);b.sort(function(a,b){return a.rank<b.rank?1:a.rank>b.rank?-1:a.title>b.title?1:a.title<b.title?-1:0})}return b}}]).filter("sharedToOrderByCurrentUser",["userInfo",function(a){return function(b){for(var c=a.getUserId(),d=0;d<b.length;d++)if("USER"===b[d].type&&b[d].published_to===c){var e=b.splice(d,1);b.splice(0,0,e[0]);break}return b}}]).filter("partialLinkToFullLink",function(){return function(a){var b=a;return-1==b.indexOf("http")&&-1==b.indexOf("https")&&(b=-1==b.indexOf("www")?"http://www."+b:"http://"+b),b}}).filter("hashtagToFilterLink",["AppLinks","Filters","FilterTypes",function(a,b,c){return function(d){var e={url:a.linkToUrl(a.newFilterLink(b.newANDFiltersChain([b.newFilter(c.TAG,d,d)]),"Tags"),!0)};return e.url}}]).filter("labelToHashtag",[function(){return function(a){return"#"!=a.charAt(0)&&(a="#"+a),a}}]).filter("limitToWithEllipsis",[function(){return function(a,b,c,d){if(!a)return"";if(c=parseInt(c,10),!c)return a;if(a.length<=c)return a;if(a=a.substr(0,c),b){var e=a.lastIndexOf(" ");-1!=e&&(a=a.substr(0,e))}return a+(d||" \u2026")}}]).filter("unescape",[function(){return function(a){return a=a.replace(/&apos;/g,"'").replace(/&nbsp;/g," "),_.unescape(a)}}]).filter("slice",function(){return function(a,b,c){return a.slice(b,c)}}).filter("escapeHtmlXSS",function(){return function(a){return _.escape(a).replace(new RegExp("b1%b1_1","gi"),"<b>").replace(new RegExp("b2%b2_2","gi"),"</b>")}}).filter("getTwitterInvalidHandlesInfo",function(){return function(a,b){for(var c=b||null,d="",e=0;e<a.length;e++)d+=_.escape(a[e])+"<br>";d=d.replace(/<br>\s*$/,""),c(d)}}).filter("getRevisionResourceLinkUrl",["AppLinks",function(a){return function(b,d,e,f,g){if(g===c||e===c)return"";var h=a.newResourceLink(b,[{type:e,uid:d,title:f},{type:"versions",uid:g}]);return a.linkToUrl(h,!0)}}]).filter("getIntegrationAppIcon",function(){return function(a){return"assets/img/integrations/"+a}}).filter("getNetworksInConnectedAccoutns",function(){return function(a,b){for(var c="",d=0;d<a.length;d++)c+=a[d].account_name+"<br>";return c=c.replace(/<br>\s*$/,"")}}),b.module("convoApp").factory("utils",["$parse","config","bannerService","logger",function(c,d,e,f){var g=0,h={COLOR_MAP:["#FF5740","#FF880D","#FFCE09","#2ADD2E","#59CCF5","#1C9CF7","#6853DC","#FF9500","#383838","#8E8E93"],SMILEY_MAP:["smiley-01","smiley-02","smiley-03","smiley-04","smiley-05","smiley-06","smiley-07","smiley-08","smiley-09","smiley-10","smiley-11","smiley-12"],escapeRegexCharsRegex:new RegExp("([{}()^$&.*?/+|[\\\\]|]|-)","g"),downloadingBanner:{timeout:null,banner:null},getDocumentScrollNode:function(){var a=null;return a=h.isFirefox()||h.isIE()?document.documentElement:document.body},escapeRegexChars:function(a){return a.replace(h.escapeRegexCharsRegex,"\\$1")},getUserGroupSearchRegex:function(a){return new RegExp("(([\\s,<>():._])|^)("+h.escapeRegexChars(a)+")","gi")},getAppUrlRegex1:function(){return new RegExp("^((https?://[a-z]?links\\.([a-z0-9-.]*)"+h.escapeRegexChars(d.HOST_DOMAIN)+")|(convo:))","i")},getAppUrlRegex2:function(){return new RegExp("^https?://([a-z0-9-.]+)"+h.escapeRegexChars(d.HOST_DOMAIN,"i"))},isGroupIdLike:function(a){return a&&(0===a.indexOf("g_")||0===a.indexOf("grp-"))},isUserIdLike:function(a){return a&&-1!==a.search(/^[a-zA-Z0-9\-]+$/)},generateUniqueId:function(){for(var a,b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",c=30,d="",e=b.length,f=0;c>f;f+=1)a=Math.random()*e,d+=b.charAt(a);return d},generateUniqueIdForAppearin:function(){for(var a,b="abcdefghijklmnopqrstuvwxyz0123456789",c=16,d="",e=b.length,f=0;c>f;f+=1)a=Math.random()*e,d+=b.charAt(a);return d},generateUniqueCharId:function(){for(var a,b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",c=30,d="",e=b.length,f=0;c>f;f+=1)a=Math.random()*e,d+=b.charAt(a);return d},generateGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},nextUid:function(){return++g},hashKey:function(a,b){var c=a&&a.$$hashKey;if(c)return"function"==typeof c&&(c=a.$$hashKey()),c;var d=typeof a;return c="function"==d||"object"==d&&null!==a?a.$$hashKey=d+":"+(b||h.nextUid)():d+":"+a},findInObjectArray:function(a,b,c){for(var d=null,e=0;e<a.length;e++)if(a[e][b]===c){d=a[e];break}return d},findIndexInObjectArray:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]===c)return d;return-1},getSignupAppUrl:function(){return"https://www.convo.com/signup"},getCommandSymbol:function(){return this.isOsX()?"\u2318":"ctrl"},offsetTop:function(a,b){for(var c={top:0};b!==a;)c.top+=b.offsetTop,b=b.offsetParent;return c},isValidUrl:function(a){return a=a.trim(),a?-1!==a.search(/^(ftp:\/\/|https:\/\/|http:\/\/|www\.)([\w\/\-\_\+\.\?\=\#\&\%\@\,\:\;\~\(\)\*\'\$\!]+)$/i)||-1!==a.search(/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+(com|org|net|edu|gov|mil|biz|info|mobi|name|aero|asia|jobs|museum|coop)([\w\/\-\_\+\.\?\=\#\&\%\@\,\:\;\~\(\)\*\'\$\!]*)$/i):!1},isValidEmail:function(a){return a.match(/^[^@]+@([^.\s@]+\.){1,}[^.\s]+$/)},parseEmailAddressesFromString:function(a){for(var b=a.split(/[\s,]+/g),c=[],d=0;d<b.length;d++)h.isValidEmail(b[d])&&c.push(b[d]);return{emails:c,numItems:b.length}},formatBytes:function(a,b){if(0==a)return"0 Byte";var c=1e3,d=b+1||2,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return parseFloat((a/Math.pow(c,f)).toFixed(d))+" "+e[f]},partialToFullUrl:function(a){var b=a;return-1==a.indexOf("http")&&-1==a.indexOf("https")&&(b=-1==a.indexOf("www")?"http://www."+a:"http://"+a),b},getFileFormat:_.memoize(function(a){var b="File";return a=a.toUpperCase(),0==a.indexOf("DOC")||0==a.indexOf("DOCX")?b="DOC":0==a.indexOf("XLS")||0==a.indexOf("XLSX")||0==a.indexOf("XLSM")||0==a.indexOf("XLSB")?b="Excel sheet":0==a.indexOf("PPT")||0==a.indexOf("PPTX")?b="PPT":0==a.indexOf("PDF")?b="PDF":0==a.indexOf("TXT")?b="Text file":0==a.indexOf("PS")?b="PS":0==a.indexOf("ODP")?b="ODP":0==a.indexOf("ODS")?b="ODS":0==a.indexOf("DXF")?b="DXF":0==a.indexOf("RTF")?b="RTF":0==a.indexOf("JPEG")||0==a.indexOf("JPG")||0==a.indexOf("JFIF")||0==a.indexOf("TIF")||0==a.indexOf("TIFF")||0==a.indexOf("PNG")||0==a.indexOf("GIF")||0==a.indexOf("BMP")||0==a.indexOf("PPM")||0==a.indexOf("PGM")||0==a.indexOf("PBM")||0==a.indexOf("PNM")||0==a.indexOf("SVG")||0==a.indexOf("PSD")||0==a.indexOf("EMF")||0==a.indexOf("TGA")?b="Image":0==a.indexOf("FLV")||0==a.indexOf("MOV")||0==a.indexOf("WEBM")||0==a.indexOf("AVI")||0==a.indexOf("MPEG")||0==a.indexOf("MPG")||0==a.indexOf("MP4")?b="Video":(0===a.indexOf("MP3")||0===a.indexOf("WAV")||0===a.indexOf("OGG")||0===a.indexOf("FLAC")||0===a.indexOf("WMA")||0===a.indexOf("AIFF")||0===a.indexOf("AIF")||0===a.indexOf("VOX")||0===a.indexOf("AU")||0===a.indexOf("AAC")||0===a.indexOf("CAF")||0===a.indexOf("M4A")||0===a.indexOf("AMR"))&&(b="Audio"),b}),copyObject:function(a){return JSON.parse(JSON.stringify(a))},initials:_.memoize(function(a){var b=a.trim().split(" ");return((b[0]?b[0].charAt(0):"")+(b.length>1&&b[b.length-1]?" "+b[b.length-1].charAt(0):"")).toUpperCase()}),hashCode:function(a){var b,c="",d=a.length;if(0==d)return c;for(b=0;d>b;b++)c+=a.charCodeAt(b);return c},removeTags:function(a){var b=document.createElement("div");return b.innerHTML=a,b.innerText},stringToColor:_.memoize(function(a){try{return h.COLOR_MAP[parseInt(parseInt(+h.hashCode(a.substr(0,3)).substr(0,6)-1)/999998*9+1)]}catch(b){return h.COLOR_MAP[0]}}),getRandomSmiley:function(){return h.SMILEY_MAP[Math.floor(Math.random()*h.SMILEY_MAP.length)]},htmlToPlaintext:function(a){return String(a).replace(/<[^>]+>/gm,"")},truncateHtmlString:function(a,b,c){b=b||1,c=c||"";var d;if(""==a||1>b);else{d=a.length-1;for(var e,f="begin";;){if(e=a.charAt(d),"<"==e)f="<";else if(">"==e)f=">";else if(">"!=f&&("<"==f||"begin"==f)){var g=!0;c.length>0&&-1==c.indexOf(a.charAt(d))&&(g=!1),g&&(a=a.substring(0,d)+a.substr(d+1)),b--}if(d--,-1==d||0==b)break}}var h={};return h.idx=d+1,h.htmlStr=a,h},openInBrowser:function(a){var b=document.createElement("a");b.href=a,b.target="_blank",document.body.appendChild(b),b.click(),document.body.removeChild(b)},download:function(b,c,f){function g(){e.dismissBanner(h.downloadingBanner.banner),h.downloadingBanner.timeout=h.downloadingBanner.banner=null}if(d.IS_NATIVE||h.isChrome()){var i=document.body;for(var j in b){var k=document.createElement("a");k.href=c?b[j].path:h.getDownloadUrl(b[j].path,b[j].name),k.download=b[j].name,d.IS_MAC||(k.target="_blank"),i.appendChild(k),k.click(),i.removeChild(k)}}else for(var j in b)a.open(h.getDownloadUrl(b[j].path,b[j].name),"_blank");null!=h.downloadingBanner.timeout&&null!=h.downloadingBanner.banner&&(clearTimeout(h.downloadingBanner.timeout),g()),f||(h.downloadingBanner.banner=e.showBanner("Downloading...",!0,!1),h.downloadingBanner.timeout=setTimeout(g,2e3))},getDownloadUrl:function(b,c){return d.IS_NATIVE||h.isChrome()?d.AWS_FILE_DIR_BASE+b+"?"+$.param({name:c}):a.location.protocol+"//"+a.location.host+"/app/download.php?"+$.param({path:b,name:c})},sizeOf:function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},generateHash:function(a){var b,c,d,e=0;if(0==a.length)return e;for(b=0,d=a.length;d>b;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e},closestInArray:function(a,b){for(var c=b[0],d=Math.abs(a-c),e=0,f=b.length;f>e;++e){var g=Math.abs(a-b[e]);d>g&&(d=g,c=b[e])}return c},createEvent:function(a){var b;if("function"==typeof Event)b=new Event(a);else{var b=document.createEvent("Event");b.initEvent(a,!0,!0)}return b},fireEvent:function(a,b){var c;if(a.ownerDocument)c=a.ownerDocument;else{if(9!=a.nodeType)throw new Error("Invalid node passed to fireEvent: "+a.id);c=a}if(a.dispatchEvent){var d="";switch(b){case"click":case"mousedown":case"mouseup":case"contextmenu":d="MouseEvents";break;case"focus":case"change":case"blur":case"select":d="HTMLEvents";break;default:throw"fireEvent: Couldn't find an event class for event '"+b+"'."}var e=c.createEvent(d),f="change"==b?!1:!0;e.initEvent(b,f,!0),e.synthetic=!0,a.dispatchEvent(e,!0)}else if(a.fireEvent){var e=c.createEventObject();e.synthetic=!0,a.fireEvent("on"+b,e)}},$watchCollection_withoutCreatingWatch:function(a,d,e){function f(a){i=a;var c,d,e,f,g;if(!b.isUndefined(i)){if(b.isObject(i))if(b.isArray(i)){j!==m&&(j=m,o=j.length=0,k++),c=i.length,o!==c&&(k++,j.length=o=c);for(var h=0;c>h;h++)g=j[h],f=i[h],e=g!==g&&f!==f,e||g===f||(k++,j[h]=f)}else{j!==n&&(j=n={},o=0,k++),c=0;for(d in i)i.hasOwnProperty(d)&&(c++,f=i[d],g=j[d],d in j?(e=g!==g&&f!==f,e||g===f||(k++,j[d]=f)):(o++,j[d]=f,k++));if(o>c){k++;for(d in j)i.hasOwnProperty(d)||(o--,delete j[d])}}else j!==i&&(j=i,k++);return k}}function g(){e(i)}function h(){k!==l(a)&&g()}f.$stateful=!0;var i,j,k=(e.length>1,0),l=c(d,f),m=[],n={},o=0;return h(),h},getBlockNodes:function(a){var b=a[0],c=a[a.length-1],d=[b];do{if(b=b.nextSibling,!b)break;d.push(b)}while(b!==c);return $(d)},getLabelShortVersion:function(a){var b=a.trim().split(" "),c=b[0];return b.length>1&&(c+=" "+b[b.length-1].charAt(0)),c},isIE:function(b){b=b||999;var c;return"IE"==a.platform.name?(c=parseInt(a.platform.version),c&&b>=c):!1},isEdge:function(){var a=navigator.userAgent;return a?(a=a.toLowerCase(),a.indexOf("edge")>=0):!1},isOpera:function(){return!!a.opera||navigator.userAgent.indexOf(" OPR/")>=0},isFirefox:function(){var a="undefined"!=typeof InstallTrigger;return a},isSafari:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},isSafari9:function(){return h.isSafari()&&a.platform.version&&9===parseInt(a.platform.version)},isChrome:function(){return!!a.chrome&&!h.isOpera()&&!h.isIE()},isOsX:function(){var b=a.platform;return b.os.family&&-1!==b.os.family.toLowerCase().indexOf("os x")?!0:!1},whichOS:function(){var b=a.platform;if(!b.os.family||-1===b.os.family.toLowerCase().indexOf("windows"))return"";if(b.os.version){var c=parseFloat(b.os.version);return 8>=c?"Windows8OrOlder":c>8?"Windows81OrNewer":"Windows8OrOlder"}return"Windows8OrOlder"},windowsOSVersion:function(){var b=a.platform,c=NaN;return b.os.family&&-1!==b.os.family.toLowerCase().indexOf("windows")?(b.os.version&&(c=parseFloat(b.os.version)),c):c},whichBrowser:function(){return h.isIE()&&"IE"||h.isOpera()&&"OPERA"||h.isFirefox()&&"FIREFOX"||h.isSafari()&&"SAFARI"||h.isChrome()&&"CHROME"},copyToClipboard:function(b){if(d.IS_NATIVE)nativeCommBridge.saveDataInClipboard(b),e.showBanner("Copied to clipboard",!1,!1);else if(h.isIE())a.prompt("Press Ctrl+C (or CMD+C on Mac) to copy the text",b);else{var c=!0,f=document.createElement("textarea");f.style.position="fixed",f.style.top="1px",f.style.zIndex="-9999",f.style.opacity="0",f.value=b,f.setAttribute("readonly",""),f.setAttribute("id","someFakeId"),document.body.appendChild(f),f.select();try{c=document.execCommand("copy")}catch(g){c=!1}document.body.removeChild(f),f=null,c===!0?e.showBanner("Copied to clipboard",!1,!1,null,1500):a.prompt("Press Ctrl+C (or CMD+C on Mac) to copy the text",b)}},containsSurrogatePair:function(a){return/[\uD800-\uDFFF]/.test(a)},formatCheck:function(a,b){var c=document.createElement("VIDEO"),d=0;if("preview"==a){if(b.isWebmPreviewAvailable&&c.canPlayType("video/webm"))var d=1;if(b.isMp4PreviewAvailable&&c.canPlayType("video/mp4"))var d=2}if("video"==a){if(b.isWebmAvailable&&c.canPlayType("video/webm"))var d=1;if(b.isMp4Available&&c.canPlayType("video/mp4"))var d=2}return d},canPlayVideoType:function(a){var b=document.createElement("VIDEO"),c={};return c.canPlayMp4=!1,c.canPlayWebm=!1,c.canPlay720mp4=!1,c.canPlay720webm=!1,c.canPlay1080mp4=!1,c.canPlay1080webm=!1,c.canPlay480=!1,c.canPlay720=!1,c.canPlay1080=!1,b.canPlayType("video/webm")&&(a.isWebmAvailable&&(c.canPlayWebm=!0),a.is720WebmAvailable&&(c.canPlay720webm=!0),a.is1080WebmAvailable&&(c.canPlay1080webm=!0)),b.canPlayType("video/mp4")&&(a.isMp4Available&&(c.canPlayMp4=!0),a.is720Mp4Available&&(c.canPlay720mp4=!0),a.is1080Mp4Available&&(c.canPlay1080mp4=!0)),(c.canPlay1080mp4||c.canPlay1080webm)&&(c.canPlay1080=!0),(c.canPlay720mp4||c.canPlay720webm)&&(c.canPlay720=!0),(c.canPlayMp4||c.canPlayWebm)&&(c.canPlay480=!0),c},canPlayAudioType:_.memoize(function(a){var b=document.createElement("AUDIO");return""!==b.canPlayType("audio/"+a)}),getNormalizedTimeString:function(a){return a.replace(" ","T")+"Z"},getDomainNameFromUrl:function(a){for(var b=a.indexOf("?"),c=a.substr(0,b>0?b:a.length),d=c.split("/"),e=0,f=d.length;f>e;e++)if(-1!=d[e].indexOf("."))return d[e].toUpperCase();return a},isRetinaSet:!1,isDeviceRetina:!1,isRetina:function(){if(!h.isRetinaSet){var b="(-webkit-min-device-pixel-ratio: 1.5),(min--moz-device-pixel-ratio: 1.5),(-o-min-device-pixel-ratio: 3/2),(min-resolution: 1.5dppx)";a.devicePixelRatio>1||a.matchMedia&&a.matchMedia(b).matches?h.isDeviceRetina=!0:h.isDeviceRetina=!1,h.isRetinaSet=!0}return h.isDeviceRetina},getUserProfileImageForSize:_.memoize(function(a){return a=+a,h.isRetina()&&(a*=2),a=22>=a?22:28>=a?28:32>=a?32:48>=a?48:64>=a?64:81>=a?81:96>=a?96:129>=a?129:144>=a?144:184>=a?184:750,a+"x"+a}),isTextSingleEmoji:function(a){if(a.length>0&&a.length<70){var b=["\ud83c[\udf00-\udfff]","\ud83d[\udc00-\ude4f]","\ud83d[\ude80-\udeff]","\u2708","\u263a","\u25aa","\u25ab","\u2611","\u2b50\ufe0f","\u261d","\ud83e\udd14","\ud83e\udd16","\u26be","\ud83e\udd80","\ud83e\udd17","\u2708\ufe0e","\u2708\ufe0e","\u27a0","\u27a0","\u2708\ufe0e","\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d\udc67","\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67","\u270b","\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68","\ud83c\uddf3\ud83c\uddff","\ud83c\uddf3\ud83c\uddf4","\ud83c\uddfe\ud83c\uddf9","\ud83c\uddf2\ud83c\uddfc","\u270a","\u26a1","\u26c5","\u2614","\u2b50","\u2615","\u2728","\u26c4","\u26fa","\u26bd","\u26f3","\u26fd","\u2693","\u200d\u2764\ufe0f\u200d","\u27a2","\u26f5","\u26f2","\u26ea","\u231a","\u23f0","\u23f3","\u231b","\u260e","\u2709","\u2702","\u2712","\u270f","\u26d4","\u3299","\u3297","\u2747","\u2733","\u274e","\u2705","\u2734","\u2648","\u2649","\u264a","\u264b","\u264c","\u264d","\u264e","\u264f","\u2650","\u2651","\u2652","\u2653","\u267f","\u25b6","\u25c0","\u23e9","\u23ea","\u23eb","\u23ec","\u27a1","\u2b05","\u2b06","\u2b07","\u2197","\u2198","\u2199","\u2196","\u2195","\u2194","\u21aa","\u21a9","\u2934","\u2935","\u2139","\u2795","\u2796","\u3030","\u2797","\u2716","\u2714","\u2122","\xa9","\xae","\u27b0","\u27bf","\u303d","\u2757","\u2753","\u2755","\u2754","\u203c","\u2049","\u274c","\u2b55","\u24c2","\u26ce","\u26a0","\u2668","\u267b","\u2660","\u2663","\u2665","\u2666","\u26aa","\u26ab","\u2b1b","\u2b1c","\u25fc","\u25fb","\u25fe","\u25fd","\u261d\ufe0f","\ud83c\udfff","\ud83c\udffe","\ud83c\udffd","\ud83c\udffc","\ud83c\udffb","\ud83c\udccf","\ud83c\udc04","\ud83c\ude51","\ud83c\ude50","\ud83c\ude34","\ud83c\ude35","\ud83c\ude32","\ud83c\ude36","\ud83c\ude1a","\ud83c\ude38","\ud83c\ude3a","\ud83c\ude37","\ud83c\ude39","\ud83c\ude33","\ud83c\ude02","\ud83c\ude01","\ud83c\ude2f","\ud83c\udd9a","\ud83c\udd70","\ud83c\udd71","\ud83c\udd8e","\ud83c\udd91","\ud83c\udd7e","\ud83c\udd98","\ud83c\udd94","\ud83c\udd7f","\ud83c\udd92","\ud83c\udd93","\ud83c\udd95","\ud83c\udd96","\ud83c\udd97","\ud83c\udd99","\u2764\ufe0f","\u2764","\ud83e\udd25","\ud83e\udd21"],c=new RegExp(b.join("|"),"g"),d=a.match(c);if(d&&d.length>0){var e=a.replace(c,"");e=e.replace(/\r?\n|\r| /g,"");for(var f=e.length,g=0,h=0;f>g;){var i=e.charCodeAt(g);(65038==i||65039==i||8205==i)&&h++,g++}if(e.length==h)return!0}}return!1}};return h.debounce_firstImmediate=function(a,b){var c,d,e,f,g,h=!1,i=function(){var j=_.now()-f;b>j&&j>0?(h=!1,c=setTimeout(i,b-j)):(c=null,h||(g=a.apply(e,d),c||(e=d=null)),h=!1)};return function(){e=this,d=arguments,f=_.now();var j=!c;return c||(c=setTimeout(i,b)),j&&(g=a.apply(e,d),e=d=null,h=!0),g}},h.ActivityWatch=function(a,b,c){function d(a){return Date.now()-a}var e,g,h=a,i=b,j=c,k=0,l={},m=null;this.markOccurrence=function(a){k++,a&&_.each(a,function(a,b){a&&(l[b]||(l[b]=0),l[b]++)}),g=Date.now(),1===k&&(e=g),(!m||d(m)>=j)&&k>=i&&(f.logToServer("ActivityWatch: "+h+": numOccurrences: "+k+": detailsCounts: "+JSON.stringify(l)+", timeSinceFirstOccurrence: "+d(e),f.DEBUG),m=Date.now())},this.clear=function(){k=0,l={},m=null}},_.extend(a.com_convo.utils,h),h}]),Number.prototype.checkBitAt=function(a){return(this>>a-1)%2!=0},Number.prototype.setBitAt=function(a){return this|1<<a-1},Number.prototype.clearBitAt=function(a){return this&~(1<<a-1)},Number.prototype.toggleBitAt=function(a){return this.checkBit(a-1)?this.clearBit(a-1):this.setBit(a-1)},function(a){a.fn.hasScrollBar=function(){return this.get(0).scrollHeight>this.outerHeight()}}(jQuery),function(){Object.defineProperty(Array.prototype,"prepend",{enumerable:!1,writable:!1,configurable:!1,value:function(a){a instanceof Array&&a.reverse().forEach(function(a){this.unshift(a)},this)}}),Object.defineProperty(Array.prototype,"append",{enumerable:!1,writable:!1,configurable:!1,value:function(a){a instanceof Array&&a.reverse().forEach(function(a){this.push(a)},this)}})}(),a.getLocalStorageSize=function(){var a=0;for(var b in localStorage)a+=2*localStorage[b].length/1024/1024;console.log(a)},b.module("convoApp").directive("cnvVideoPlayer",["$filter","videoPlayerSettings","$timeout","utils","resourcesTabsManager","config","mixpanelService","$q",function(b,d,e,f,g,h,i,j){return{restrict:"E",priority:0,scope:{file:"=cnvVideoPlayerFile",onFileDeleted:"&cnvVideoPlayerOnFileDeleted",playerOptions:"=cnvVideoPlayerOptions",playerCtrl:"=cnvVideoPlayerCtrl"},templateUrl:"common/videoPlayer/cnvVideoPlayer.tpl.html",link:function(b,k,l){function m(a){Ma||(a.stopImmediatePropagation(),a.preventDefault())}function n(a){a=a||!1;var b=$(ua).innerHeight(),c=$(ua).innerWidth(),d=ua.videoHeight/ua.videoWidth,e=(ua.videoHeight-b,ua.videoWidth-c,b/d);a?e>c?(Da.width(c),Da.height(c*d),Da[0].style.top=(b-c*d)/2+"px"):(Da.height(b),Da.width(b/d),Da[0].style.left=(c-b/d)/2+"px"):(Da.css("height","auto"),Da.css("width","auto"),e>c?(Da[0].setAttribute("width",c),Da[0].setAttribute("height",c*d),Da[0].style.top=(b-c*d)/2+"px"):(Da[0].setAttribute("height",b),Da[0].setAttribute("width",b/d),Da[0].style.left=(c-b/d)/2+"px"))}function o(){var a=Da[0].getContext("2d");a.drawImage(ua,0,0,$(Da[0]).innerWidth(),$(Da[0]).innerHeight())}function p(){if(b.videoLoaded){var a=d.getSeekPosition(b.file.id);if(ua.currentTime-a>1||ua.currentTime-a<-1)var c=0,e=setInterval(function(){c++,ua.currentTime=a,(parseInt(a)-parseInt(ua.currentTime)==0||5===c)&&clearInterval(e)},100);b.setMuteState(d.getMuteState())}}function q(a){xa.innerHTML="";for(var b=0;b<ua.buffered.length;b++){var c=document.createElement("DIV");c.setAttribute("class","seekbarBuffer"),c.style.left=ua.buffered.start(b)/ua.duration*100+"%",c.style.width=(ua.buffered.end(b)-ua.buffered.start(b))/ua.duration*100+"%",xa.appendChild(c)}}function r(a){setTimeout(function(){Ha||b.playVideo(),Ha=!1,setTimeout(function(){I()},1e3)},0)}function s(a){t()}function t(){setTimeout(function(){-1==Pa?b.playerCtrl&&b.playerCtrl.initialized&&!b.playerCtrl.isReady&&(b.playerCtrl.isReady=!0,b.playerCtrl.trigger("ready")):ua.currentTime!=Pa&&(ua.currentTime=Pa)},1)}function u(){if(ua.currentTime.toFixed(5)===Pa.toFixed(5)){Ta&&clearTimeout(Ta);var a=function(){return $a?void(Ta=setTimeout(a,50)):(Aa.is(":visible")&&Aa.hide(),Da.is(":visible")&&x(),k.find(".feedVideoPlayer").fadeTo(400,1),Pa=-1,Qa&&(Qa.resolve(),Qa=null),void(b.playerCtrl&&b.playerCtrl.initialized&&!b.playerCtrl.isReady&&(b.playerCtrl.isReady=!0,b.playerCtrl.trigger("ready"))))};Ta=setTimeout(a,1)}Sa&&!$a?sa(Pa,ra,0):ra()}function v(){var a=f.isSafari()?ua.HAVE_ENOUGH_DATA:ua.HAVE_CURRENT_DATA;-1!=Pa&&(ua.readyState>=a?u():(null!=Ua&&(clearTimeout(Ua),Ua=null),Ua=setTimeout(v,1e3)))}function w(a){Pa>-1&&v()}function x(){Da.hide()}function y(){if(!ua.paused&&!b.isVideoSwitching){ua.readyState>ua.HAVE_CURRENT_DATA&&(Aa.is(":visible")&&ua.currentTime>d.getSeekPosition(b.file.id)&&(Wa>0||!f.isIE()||!f.isSafari()?(Aa.hide(),Wa=0):Wa++),Da.is(":visible")&&ua.currentTime>d.getSeekPosition(b.file.id)&&(Va>0||!f.isIE()&&f.isSafari()?(x(),b.setMuteState(d.getMuteState()),Va=0):Va++)),b.currentSeekPossition=ua.currentTime,d.updateSeekPosition(b.file.id,ua.currentTime),b.showCurrentTime=B(ua.currentTime);var a=b.$root.$$phase;"$apply"!=a&&"$digest"!=a&&b.$digest(),Fa||(wa.style.width=ua.currentTime/ua.duration*100+"%"),Xa()}b.playerCtrl&&b.playerCtrl.trigger("videoTimeUpdate")}function z(){Ra||ua&&!ua.paused&&Aa.show();
}function A(){b.sendMixPanelevent(i.WATCHED_TO_END),Ha=!0,Ja=!0,wa.style.width="100%",setTimeout(function(){wa.style.width="0%",b.currentSeekPossition=0,d.updateSeekPosition(b.file.id,0),e(function(){b.videoPlayerIsPaused=!0},0),b.isFullScreen||b.cleanUp()},100)}function B(a){var b,c,d,e=Math.round(a),f=e,g="";return b=Math.floor(f/3600),f-=3600*b,b>0&&(g=b+":"),c=Math.floor(f/60),f-=60*c,g=g+("0"+c).slice(-2)+":",d=f,g+=("0"+d).slice(-2)}function C(){b.videoLoaded=!0,p(),ua.muted=!0,b.isVideoSwitching=!1,ua.paused&&-1==Pa&&Aa.hide();var a=b.$root.$$phase;"$apply"!=a&&"$digest"!=a&&b.$digest()}function D(){b.showDuration=B(ua.duration);var a=b.$root.$$phase;"$apply"!=a&&"$digest"!=a&&b.$digest()}function E(){Ka=!0}function F(b){for(var c=b.toElement||b.relatedTarget;c&&c.parentNode&&c.parentNode!=a;){if(c.parentNode==this||c==this)return c.preventDefault&&c.preventDefault(),!1;c=c.parentNode}Ka=!1,ta()}function G(c){for(var d=c.toElement||c.relatedTarget;d&&d.parentNode&&d.parentNode!=a;){if(d.parentNode==this||d==this)return d.preventDefault&&d.preventDefault(),!1;d=d.parentNode}La=!1,setTimeout(function(){b.isFullScreen||!ua.paused&&!ua.ended||b.cleanUp()},50),J()}function H(){La=!0,I()}function I(){if(!b.playerCtrl||"gallery"!=b.playerCtrl.view||0!=b.isFullScreen){var a=k.find(".feedVideoPlayerHeader")[0],c=k.find(".feedVideoPlayerFooter")[0];a.style.opacity="1",a.style.transform="translate(0px,30px)",a.style.msTransform="translate(0px,30px)",a.style.webkitTransform="translate(0px,30px)",c.style.opacity="1",c.style.transform="translate(0px,-30px)",c.style.msTransform="translate(0px,-30px)",c.style.webkitTransform="translate(0px,-30px)",k.find(".closeFullScreen").show(),ta()}}function J(){if((!b.playerCtrl||"gallery"!=b.playerCtrl.view||0!=b.isFullScreen)&&b.videoLoaded&&!b.videoPlayerIsPaused&&!b.dropdownMenuState&&!Ka&&!k.find(".volumeBarHolder").is(":visible")&&!k.find(".hdPannel").is(":visible")){var a=k.find(".feedVideoPlayerHeader")[0],c=k.find(".feedVideoPlayerFooter")[0];a.style.opacity="0",a.style.transform="translate(0px,0px)",a.style.msTransform="translate(0px,0px)",a.style.webkitTransform="translate(0px,0px)",c.style.opacity="0",c.style.transform="translate(0px,0px)",c.style.msTransform="translate(0px,0px)",c.style.webkitTransform="translate(0px,0px)",k.find(".closeFullwebkitTransformScreen").hide()}}function K(){var a=k.find(".headerClose")[0],b=k.find(".pauseBtn")[0],c=k.find(".seekbarHolder")[0],d=k.find(".volume")[0],e=k.find(".resize")[0],f=(k.find(".volumeBarBase")[0],k.find(".volumeBar")[0]),g=k.find(".feedVideoPlayerBody")[0],h=k.find(".closeFullScreen")[0],i=k.find(".hdplay")[0];a.addEventListener("click",ea,!1),b.addEventListener("click",M,!1),c.addEventListener("mouseover",X,!1),c.addEventListener("mouseout",Y,!1),c.addEventListener("mousedown",Z,!1),c.addEventListener("mousemove",aa,!1),f.addEventListener("mousedown",U,!1),f.addEventListener("mousemove",V,!1),document.addEventListener("mouseup",da,!1),d.addEventListener("click",fa,!1),d.addEventListener("mouseover",P,!1),d.addEventListener("mouseout",Q,!1),i.addEventListener("click",R,!1),e.addEventListener("click",ga,!1),h.addEventListener("click",ga,!1),g.addEventListener("click",M,!1),ya.addEventListener("keyup",O,!1),za.addEventListener("keyup",O,!1)}function L(){var a=k.find(".headerClose")[0],b=k.find(".pauseBtn")[0],c=k.find(".seekbarHolder")[0],d=k.find(".volume")[0],e=k.find(".resize")[0],f=(k.find(".volumeBarBase")[0],k.find(".volumeBar")[0]),g=k.find(".feedVideoPlayerBody")[0],h=k.find(".closeFullScreen")[0],i=k.find(".hdplay")[0];a.removeEventListener("click",ea,!1),b.removeEventListener("click",M,!1),c.removeEventListener("mouseover",X,!1),c.removeEventListener("mouseout",Y,!1),c.removeEventListener("mousedown",Z,!1),c.removeEventListener("mousemove",aa,!1),f.removeEventListener("mousedown",U,!1),f.removeEventListener("mousemove",V,!1),document.removeEventListener("mouseup",da,!1),d.removeEventListener("click",fa,!1),d.removeEventListener("mouseover",P,!1),d.removeEventListener("mouseout",Q,!1),i.removeEventListener("click",R,!1),e.removeEventListener("click",ga,!1),h.removeEventListener("click",ga,!1),g.removeEventListener("mousedown",M,!1),ya.removeEventListener("keyup",O,!0),za.removeEventListener("keyup",O,!0)}function M(){var a=k.find(".hdPannel");a.is(":visible")||b.dropdownMenuState||(ua.paused?(b.sendMixPanelevent(i.CLICKED_PLAY),b.playVideo(),Ia=!1,Ja=!1):(b.sendMixPanelevent(i.CLICKED_PAUSE),b.pauseVideo(),Ia=!0))}function N(a){var b=a.which||a.keyCode;32==b&&(M(),a.preventDefault())}function O(a){Ya(a)}function P(){var a=k.find(".volumeBarHolder");a.addClass("show"),b.playerCtrl&&b.playerCtrl.trigger("volumeBarShow")}function Q(){setTimeout(function(){var a=k.find(".volumeBarHolder");a.removeClass("show"),b.playerCtrl&&b.playerCtrl.trigger("volumeBarHide")},1e3)}function R(){if(b.canPlayVideoType.canPlay1080||b.canPlayVideoType.canPlay720){var a=k.find(".hdPannel");a.is(":visible")||(a.addClass("show"),setTimeout(function(){document.addEventListener("click",S)},0),b.playerCtrl&&b.playerCtrl.trigger("hdPanelShow"))}}function S(a){0===$(a.target).parents(".hdPannel").length&&T()}function T(){var a=k.find(".hdPannel");a.removeClass("show"),document.removeEventListener("click",S),ta(),b.cleanUp(),b.playerCtrl&&b.playerCtrl.trigger("hdPanelHide")}function U(a){Ga=!0,$.proxy(W,this,a)()}function V(a){Ga&&$.proxy(W,this,a)()}function W(a){var c=$(this),d=c.find(".volumeBarBase"),e=c.find(".volumeBarTop"),f=a.pageY-d.offset().top;f>52&&(f=52),0>f&&(f=0),e[0].style.top=f+"px",b.setVolume(Math.abs(f-52)/52),b.setMuteState(!1)}function X(){$(wa).addClass("seekbarCurrentHover")}function Y(){$(wa).removeClass("seekbarCurrentHover")}function Z(a){Da.is(":hidden")&&(n(),o()),$.proxy(ca,this,a)(),Fa=!0,Ha=!0,Na=!0,ua.pause()}function aa(a){Fa&&(Ha=!0,Na=!0,ua.pause(),$.proxy(ca,this,a)())}function ba(){ua.play(),Na=!1}function ca(a){var c=$(this),e=a.pageX-c.offset().left,f=e/c.outerWidth()*100,g=f*ua.duration/100;wa.style.width=f+"%",ua.currentTime=g,d.updateSeekPosition(b.file.id,ua.currentTime),b.showCurrentTime=B(ua.currentTime);for(var h=b.$root.$$phase,i=!1,j=0;j<ua.buffered.length;j++)g>ua.buffered.start(j)&&g<ua.buffered.end(j)&&(i=!0);i||Aa.show(),Ia||Ja?Na=!1:Za(),"$apply"!=h&&"$digest"!=h&&b.$digest()}function da(a){Fa=!1,Ga=!1}function ea(){b.pauseVideo(!1,!0)}function fa(){0==ua.volume?b.ApplyVolume(.2):b.setMuteState(!ua.muted)}function ga(a,c){if(null==c)b.isFullScreen=!b.isFullScreen;else{if(b.isFullScreen===c)return;b.isFullScreen=c}b.isFullScreen?(Oa=k.height(),h.IS_NATIVE&&setTimeout(qa,500)):h.IS_NATIVE&&setTimeout(oa,250),b.$emit("NotesApp:FullScreen",{isFullScreen:b.isFullScreen,isVideo:!0,id:b.file.id}),b.playerCtrl&&b.playerCtrl.trigger("fullScreenToggle",b.isFullScreen)}function ha(){if(ua){b.isFullScreen=!1,ua.paused&&(La=!1,b.cleanUp());var a=0,c=setInterval(function(){a++,(k.height()===Oa||a>30)&&(setTimeout(function(){oa()},100),clearInterval(c))},250)}}function ia(){null===document.fullscreenElement?ha():pa()}function ja(){null===document.mozFullScreenElement?ha():pa()}function ka(){null===document.webkitFullscreenElement?ha():pa()}function la(){null===document.msFullscreenElement?ha():pa()}function ma(){Ma=!1}function na(){ua&&ua.paused&&setTimeout(function(){b.cleanUp(!0)},4e3)}function oa(){var a=d.getQuality(b.file.id);a||(La=!0,b.canPlayVideoType.canPlay1080&&"feed"!=b.playerOptions.location?b.changeQuality(1080,!0):b.canPlayVideoType.canPlay720?b.changeQuality(720,!0):b.canPlayVideoType.canPlay480&&b.changeQuality(480,!0)),Da.is(":visible")&&n(!0)}function pa(){if(b.isFullScreen)var c=0,d=setInterval(function(){c++,(a.screen.height===$("body").height()||c>20)&&(qa(),clearInterval(d))},250)}function qa(){var a=d.getQuality(b.file.id);a||(b.canPlayVideoType.canPlay1080?b.changeQuality(1080,!0):b.canPlayVideoType.canPlay720?b.changeQuality(720,!0):b.canPlayVideoType.canPlay480&&b.changeQuality(480,!0)),Da.is(":visible")&&n(!0)}function ra(){b.currentSeekPossition=ua.currentTime;var a=ua.currentTime/ua.duration*100;wa.style.width=a+"%",d.updateSeekPosition(b.file.id,ua.currentTime),b.showCurrentTime=B(ua.currentTime);var c=b.$root.$$phase;Sa=!1,"$apply"!=c&&"$digest"!=c&&b.$digest()}function sa(a,b,c){$a=!0;var d=k.find(".feedVideoPlayerControls .seekbar"),e=d.width(),f=k.find(".feedVideoPlayer");f.fadeTo(500,.3);var g=d.offset();$(".videoSeeker").remove(),$("body").append("<div class='videoSeeker'><span class='seektime'></span><div class='arrow'></div></div>");var h=$(".videoSeeker"),i=h.find(".seektime"),j=0===c?0:ua.currentTime;i.text(B(j));var l=ua.duration||0;c=0===c?c:e*(j/l);var m=g.left+c-20;h.css({top:g.top-30+"px",left:m+"px"}),setTimeout(function(){h.css({opacity:1})},1);var n=j,o=600,p=a,q=p-n,r=Math.round(p),s=Math.max(Math.abs(Math.floor(o/q)),50);_a&&clearTimeout(_a),ab&&clearInterval(ab),_a=setTimeout(function(){function c(){f=(new Date).getTime(),f-j>300&&b();var c=Math.max((k-f)/o,0),d=Math.round(p-c*q);d==r?(console.log("now - startTime === "+(f-j)),clearInterval(ab),i.text(B(a)),_a=setTimeout(function(){h.css({opacity:0}),$a=!1,_a=setTimeout(function(){h.remove()},500)},100)):i.text(B(d))}Aa.show();var d=(ua.duration||0,e*(a/ua.duration));h.css({left:g.left+d-20+"px"});var f,j=(new Date).getTime(),k=j+o;ab=setInterval(c,s)},500)}var ta,ua=k.find("video")[0],va=k.find(".feedVideoPlayerControls")[0],wa=k.find(".seekbarCurrent")[0],xa=k.find(".seekbarBufferHolder")[0],ya=k.find(".activeElem")[0],za=k.find(".holderDiv")[0],Aa=k.find(".cnv-spinner"),Ba=k.find(".feedVideoPlayerHeader")[0],Ca=k.find(".feedVideoPlayerFooter")[0],Da=k.find(".videoPreview"),Ea=k.find(".hd_icon"),Fa=!1,Ga=!1,Ha=!1,Ia=!1,Ja=!1,Ka=!1,La=!1,Ma=!1,Na=!1,Oa=0,Pa=-1,Qa=null,Ra=!1;b.isFullScreen=!1,b.isVideoSwitching=!1,b.videoPlayerIsPaused=!0,Aa.show(),Da[0].style.height="100%",Da[0].style.width="100%",Da.show(),za.addEventListener("mousedown",m,!0),za.addEventListener("click",m,!0),b.setVideoSource=function(){var a=k.find("source")[0];if((h.IS_DEV||1==f.isSafari()||1==f.isChrome())&&(ua.crossOrigin="use-credentials"),b.videoURL&&b.videoURL.length){var c=b.videoURL.split("."),d=c.pop();"mp4"==d?a.setAttribute("type","video/mp4"):"webm"==d&&a.setAttribute("type","video/webm"),a.setAttribute("src",b.videoURL),-1!=Pa&&0==f.isIE()&&(ua.currentTime=Pa),ua.load(),0==f.isIE()&&-1!=Pa&&ua.currentTime!=Pa&&(ua.currentTime=Pa),b.videoSourceSet=!0}},b.changeQuality=function(a,c){if(a!==b.resolutionPlaying){var e=!1;(480===a||720===a||1080===a)&&(e=ua.paused?!0:!1,b.pauseVideo(!1,!1,!0),b.videoURL=b.getVideoURL(a),b.resolutionPlaying=a,c||(d.setQuality(b.file.id,a),480===a?b.sendMixPanelevent(i.WATCHED_480):720===a?b.sendMixPanelevent(i.WATCHED_720):1080===a&&b.sendMixPanelevent(i.WATCHED_1080)),!b.isVideoSwitching&&b.videoLoaded&&(b.isVideoSwitching=!0,Aa.is(":hidden")&&(n(),o(),y(),Aa.show()),Da.show()),b.isVideoSwitching=!0,b.videoLoaded=!1,e?b.setVideoSource():setTimeout(function(){b.videoSourceSet=!1,b.playVideo()},0),setTimeout(function(){T()},250))}},b.removeVideoSource=function(){var a=k.find("source")[0];a.setAttribute("src",""),ua.load()},b.playVideo=function(){Ma=!0,b.broadcastPlaying(),b.videoSourceSet===!1&&b.setVideoSource(),p(),ua.play(),e(function(){b.videoPlayerIsPaused=!1},0),ya.focus(),ta(),La=!0};var Sa=!1;b.seekVideo=function(a){Sa=!0,Ma=!0,b.broadcastPlaying(),0==f.isIE()&&(ua.currentTime=a),ua.preload&&"auto"!=ua.preload&&(ua.preload="auto"),Pa=a,b.videoSourceSet===!1&&b.setVideoSource(),d.updateSeekPosition(b.file.id,a),e(function(){b.videoPlayerIsPaused=!0},0),ya.focus(),ta(),La=!0},b.pauseVideo=function(a,c,d){c=c||!1,ua.paused||(Ha=!0),ua.pause(),d||Aa.hide(),e(function(){b.videoPlayerIsPaused=!0},0),c&&b.isFullScreen||b.cleanUp(a,c)},b.setMuteState=function(a){ua.muted=a,d.setMuteState(a),1==a?k.find(".volumeBarTop")[0].style.top="52px":b.ApplyVolume(d.getCurrentVolume()),b.isMuted=a;var c=b.$root.$$phase;"$apply"!=c&&"$digest"!=c&&b.$digest()},b.setVolume=function(a){ua.volume=parseFloat(a.toString().slice(0,3)),d.setCurrentVolume(ua.volume),b.videoVolume=ua.volume},b.ApplyVolume=function(a){b.setVolume(a),yPos=Math.abs(52-52*a);var c=k.find(".volumeBarTop")[0];c.style.top=yPos+"px"},ua.addEventListener("ended",A),ua.addEventListener("progress",q),ua.addEventListener("timeupdate",y),ua.addEventListener("loadedmetadata",D),ua.addEventListener("loadeddata",C),ua.addEventListener("pause",r),ua.addEventListener("seeked",w),ua.addEventListener("canplay",s);var Ta,Ua=null,Va=0,Wa=0,Xa=_.debounce(z,4e3);za.addEventListener("mousemove",H,!1),za.addEventListener("mouseover",H,!1),za.addEventListener("mouseout",G,!1),Ba.addEventListener("mouseover",E,!1),Ca.addEventListener("mouseover",E,!1),Ba.addEventListener("mouseout",F,!1),Ca.addEventListener("mouseout",F,!1),ta=_.debounce(J,2e3),I(),K();var Ya=_.debounce(N,50),Za=_.debounce(ba,500);b.cleanUp=function(a,c){return Ma?(c=c||!1,void((c||!(Na||La||b.dropdownMenuState||!ua||!ua.paused&&!ua.ended||b.isFullScreen||k.find(".hdPannel").is(":visible")))&&b.$emit("VideoPlayback:cleanUp",{id:b.file.id,withoutAnomation:a,force:c}))):!1},document.fullscreenEnabled!==c?document.addEventListener("fullscreenchange",ia,!1):document.mozFullScreenEnabled!==c?document.addEventListener("mozfullscreenchange",ja,!1):document.webkitFullscreenEnabled!==c?document.addEventListener("webkitfullscreenchange",ka,!1):document.msFullscreenEnabled!==c&&document.addEventListener("MSFullscreenChange",la,!1),b.$on("$locationChangeStart",function(a){b.isFullScreen&&ga(null,!1)}),b.$on("videoPlayback:MinimizeVideoIfFullScreen",function(){b.isFullScreen&&ga(null,!1)}),b.$on("$destroy",function(){b.isFullScreen&&ga(null,!1),b.pauseVideo(!0),L(),document.fullscreenEnabled!==c?document.removeEventListener("fullscreenchange",ia,!1):document.mozFullScreenEnabled!==c?document.removeEventListener("mozfullscreenchange",ja,!1):document.webkitFullscreenEnabled!==c?document.removeEventListener("webkitfullscreenchange",ka,!1):document.msFullscreenEnabled!==c&&document.removeEventListener("MSFullscreenChange",la,!1),za.removeEventListener("mousedown",m,!0),za.removeEventListener("click",m,!0),Ba.removeEventListener("mouseover",E,!1),Ca.removeEventListener("mouseover",E,!1),Ba.removeEventListener("mouseout",F,!1),Ca.removeEventListener("mouseout",F,!1),za.removeEventListener("mousemove",I,!1),za.removeEventListener("mouseout",J,!1),ua.removeEventListener("ended",A),ua.removeEventListener("progress",q),ua.removeEventListener("timeupdate",y),ua.removeEventListener("loadedmetadata",D),ua.removeEventListener("loadeddata",C),ua.removeEventListener("pause",r),ua.removeEventListener("seeked",w),ua.removeEventListener("canplay",s),k.find("video").each(function(){this.pause(),$(this).prop("src","").find("source").attr("src",""),$(this).empty().remove(),delete this}),g.off("homeTabSelected",na),ua=null,va=null,wa=null,xa=null,ya=null,za=null,Aa=null,Ba=null,Ca=null,Da=null,Ea=null,Qa&&(Qa.reject("video closed"),Qa=null),b.playerCtrl&&(b.playerCtrl.initialized=!1,b.playerCtrl.isReady=!1,b.playerCtrl.pauseVideo=null,b.playerCtrl.getCurrentTimeObject=null,b.playerCtrl.requestFrameAtTime=null,b.playerCtrl.getVideoElement=null,b.playerCtrl.getVideoElement=null,b.playerCtrl.togglePlayPause=null),Ra=!0}),$(za).on("playerCollapsed",ma),b.$on("cnvDropdownToggled",function(a,c){b.dropdownMenuState=c.state,b.dropdownMenuState||(ta(),ua.paused&&b.cleanUp())}),g.on("homeTabSelected",na);var $a,_a,ab;b.playerCtrl&&(b.playerCtrl.pauseVideo=function(){b.pauseVideo(),Ia=!0},b.playerCtrl.getCurrentTimeObject=function(){return{currentTime:ua.currentTime,currentTimeString:B(ua.currentTime)}},b.playerCtrl.requestFrameAtTime=function(a){function b(){Pa!=a&&(Pa=a,ua.currentTime=a),Da.is(":visible")&&x(),Ia||Ja?Na=!1:Za(),ra()}return Qa&&(Qa.reject("new requestedFrameTime received"),Qa=null),Qa=j.defer(),Ta&&clearTimeout(Ta),a!=Pa&&a!=ua.currentTime?sa(a,b):b(),Qa.promise},b.playerCtrl.getVideoElement=function(){return ua},b.playerCtrl.togglePlayPause=function(){M()},b.playerCtrl.focusOnVideo=function(){ya&&ya.focus()},b.playerCtrl.hasVideoFocus=function(){return document.activeElement==ya||document.activeElement==za},b.playerCtrl.initialized=!0,b.playerCtrl.trigger("initialized")),document.fullscreenEnabled!==c?document.addEventListener("fullscreenchange",function(){null===document.fullscreenElement?ha():pa()},!1):document.mozFullScreenEnabled!==c?document.addEventListener("mozfullscreenchange",function(){null===document.mozFullScreenElement?ha():pa()},!1):document.webkitFullscreenEnabled!==c?document.addEventListener("webkitfullscreenchange",function(){null===document.webkitFullscreenElement?ha():pa()},!1):document.msFullscreenEnabled!==c&&document.addEventListener("MSFullscreenChange",function(){null===document.msFullscreenElement?ha():pa()},!1)},controller:["$scope","$rootScope","accountInfo","utils","bannerService",function(c,e,f,g,j){function k(){c.dropdownCtrl={align:"right"},c.dropdownCtrl.type="video_player",c.dropdownCtrl.options=[],c.dropdownCtrl.options.push({label:c.processedName,isNotHoverable:!0});var b=+c.file.width&&+c.file.height?c.file.width+"x"+c.file.height:"";c.dropdownCtrl.options.push({label:b+(b?", ":"")+g.formatBytes(c.file.size),"class":"subtext",isNotHoverable:!0}),c.dropdownCtrl.options.push({isDivider:!0}),c.dropdownCtrl.options.push({label:"Open in gallery",icon:"cnv-icons-20 Icon1_expand-01-white",callback:function(){a.location=c.playerOptions.resourceLinkUrl}}),c.dropdownCtrl.options.push({label:"Copy link",icon:"cnv-icons-20 linkhorizontal-white",callback:function(){g.copyToClipboard(h.CONVO_LINKS_BASE_URL+c.playerOptions.resourceLinkUrl.slice(1))}}),c.dropdownCtrl.options.push({label:"Download",icon:"cnv-icons-20 Icon1__Download-white",callback:function(){c.sendMixPanelevent(i.DOWNLOAD_VIDEOS),g.download([{path:f.getAccountId()+"/note"+c.file.item_id+"/"+c.file.original_name.toString(),name:c.file.name}])}}),c.file.canDeleteFile&&(c.dropdownCtrl.options.push({isDivider:!0}),c.dropdownCtrl.options.push({label:"Delete",icon:"cnv-icons-20 icons2_Trash-white",callback:function(){c.pauseVideo(!0,!0),"function"==typeof c.onFileDeleted&&c.onFileDeleted()}})),c.dropdownCtrl.alwaysUpwordsDirection=!0}function l(a,b){b.id!=c.file.id&&c.pauseVideo(!1)}function m(a,b){b.id===c.file.id&&(c.sendMixPanelevent(i.CLICKED_PLAY),c.playVideo())}function n(a,b){b.id===c.file.id&&c.seekVideo(b.requestedFrameTime)}function o(a,b){c.pauseVideo(!0)}c.currentSeekPossition=0,c.videoSourceSet=!1,c.showDuration="0:00",c.showCurrentTime="0:00",c.isMuted=!1,c.videoLoaded=!1,c.processedName="",c.dropdownMenuState=!1,c.videoURL=!1,c.videoURL=!1;var p=!1;c.isThumbnailAvailable=32&c.file.available_previews,c.isMp4PreviewAvailable=64&c.file.available_previews,c.isWebmPreviewAvailable=128&c.file.available_previews,c.isMp4Available=256&c.file.available_previews,c.isWebmAvailable=512&c.file.available_previews,c.is720Mp4Available=1024&c.file.available_previews,c.is720WebmAvailable=2048&c.file.available_previews,c.is1080Mp4Available=4096&c.file.available_previews,c.is1080WebmAvailable=8192&c.file.available_previews,c.resolutionPlaying=0,c.file.name.length>30?c.processedName=c.file.name.substr(0,30)+"...":c.processedName=c.file.name;var q=c.file.original_name.split(".");q.pop(),q=q.join("."),c.playerOptions.showControlsMenu&&(c.dropdownCtrl={},k());var r={};r.isMp4PreviewAvailable=c.isMp4PreviewAvailable,r.isWebmPreviewAvailable=c.isWebmPreviewAvailable,r.isMp4Available=c.isMp4Available,r.isWebmAvailable=c.isWebmAvailable,r.is720Mp4Available=c.is720Mp4Available,r.is720WebmAvailable=c.is720WebmAvailable,r.is1080Mp4Available=c.is1080Mp4Available,r.is1080WebmAvailable=c.is1080WebmAvailable,c.canPlayVideoType=g.canPlayVideoType(r),c.getVideoURL=function(a){var d,e=c.file.item_id,f=h.IS_NATIVE||g.isFirefox()||g.isIE();return e||(e=c.file.noteId),480===a&&(c.canPlayVideoType.canPlayMp4?d=b("getVideoPath")(q,e,c.file.appInstanceId,"mp4",480,f):c.canPlayVideoType.canPlayWebm&&(d=b("getVideoPath")(q,e,c.file.appInstanceId,"webm",480,f))),720===a&&(c.canPlayVideoType.canPlay720mp4?d=b("getVideoPath")(q,e,c.file.appInstanceId,"mp4",720,f):c.canPlayVideoType.canPlay720webm&&(d=b("getVideoPath")(q,e,c.file.appInstanceId,"webm",720,f))),1080===a&&(c.canPlayVideoType.canPlay1080mp4?d=b("getVideoPath")(q,e,c.file.appInstanceId,"mp4",1080,f):c.canPlayVideoType.canPlay1080webm&&(d=b("getVideoPath")(q,e,c.file.appInstanceId,"webm",1080,f))),d},p=d.getQuality(c.file.id),p?(c.videoURL=c.getVideoURL(p),c.resolutionPlaying=p):c.canPlayVideoType.canPlay1080&&"feed"!=c.playerOptions.location?(c.videoURL=c.getVideoURL(1080),c.resolutionPlaying=1080):c.canPlayVideoType.canPlay720?(c.videoURL=c.getVideoURL(720),c.resolutionPlaying=720):c.canPlayVideoType.canPlay480&&(c.videoURL=c.getVideoURL(480),c.resolutionPlaying=480),c.broadcastPlaying=function(){var a={id:c.file.id};c.$emit("VideoPlayback:Playing",a)},c.getFileResourceLinkUrl=function(){return b("getFileResourceLinkUrl")(c.file.id,c.file.file_format,c.feedItemData.app_instance_id,c.feedItemData.resource_type,c.file.item_id,c.file.name)},c.sendMixPanelevent=function(a){i.trackEvent(a,{Source:c.playerOptions.source})},c.$on("VideoPlayback:stopBuffering",l),c.$on("VideoPlayback:playVideo",m),c.$on("VideoPlayback:seekVideo",n),c.$on("$locationChangeStart",o)}]}}]),b.module("convoApp").directive("cnvVideoThumbnail",["$filter","appStateInfo",function(a,b){return{restrict:"E",priority:0,replace:!0,scope:{origionalFile:"=cnvVideoThumbnailFile",lazyLoadId:"@cnvVideoThumbnailLazyLoadId",lazyLoad:"=cnvVideoThumbnailLazyLoad",dataFormat:"@cnvVideoThumbnailDataFormat",scrollingHolder:"=cnvVideoThumbnailScrollingHolder",showVideoPreview:"@cnvVideoThumbnailShowPreview",resourceURL:"@cnvVideoResourceurl"},templateUrl:"common/videoThumbnail/cnvVideoThumbnail.tpl.html",link:function(a,c,d){function e(){a.isThumbnailAvailable||(l.style.display="none",m.style.display="block"),a.isVideoPreviewLoaded=!0}function f(b){"FEED"==a.dataFormat&&a.videoURL&&(a.emitVideoId(),b.stopImmediatePropagation(),b.preventDefault())}function g(){1==a.isThumbnailInViewY&&1==a.isAppFocused?a.onItemScrolledIntoView():a.onItemScrolledOutOfView()}function h(){a.isAppFocused=!0,g()}function i(){a.isAppFocused=!1,g()}var j=c.find("source"),k=c.find("video")[0],l=c.find("i")[0],m=c.find(".videoHoverIcon")[0],n=c.find("img")[0];a.insertPreviewInDOM=function(){a.isThumbnailAvailable&&(a.videoURL||"CHAT"===a.dataFormat)?(l.style.display="none",n.style.display="inline-block",m.style.display="block"):n.style.display="none","true"==a.showVideoPreview&&a.videoPreviewURL&&(a.videoURL||"CHAT"===a.dataFormat)&&(1==a.canPlayPreviewType?j[0].setAttribute("type","video/webm"):2==a.canPlayPreviewType&&j[0].setAttribute("type","video/mp4"),j[0].setAttribute("src",a.videoPreviewURL),a.isVideoPreviewInsertedInDOM=!0,k.load())},k.addEventListener("loadeddata",e),a.pausePreview=function(){k.paused===!1&&a.isVideoPreviewInsertedInDOM&&k.pause()},a.playPreview=function(){k.paused===!0&&a.isVideoPreviewInsertedInDOM&&k.play()},c[0].addEventListener("click",$.proxy(f,c)),a.onItemScrolledOutOfView=function(){a.pausePreview()},a.onItemScrolledIntoView=function(){a.isVideoPreviewInsertedInDOM===!1?a.insertPreviewInDOM():a.playPreview()},a.insertPreviewInDOM(),a.lazyLoad?(a.$on("cnvNoteGallery:unloadThumbnails",function(b,c){var d=a.isThumbnailInViewY;a.isThumbnailInViewY=!1,a.isThumbnailInViewY!=d&&g()}),a.$on("cnvNoteGallery:reloadThumbnails",function(b,c){var d=a.isThumbnailInViewY;a.isThumbnailInViewY=!0,a.isThumbnailInViewY!=d&&g()})):(a.isThumbnailInViewY=!0,g()),b.on("appFocus",h),b.on("appBlur",i),a.$on("$destroy",function(){a.pausePreview(),c[0].removeEventListener("click",$.proxy(f,c)),k.removeEventListener("loadeddata",e),b.off("appFocus",h),b.off("appBlur",i),c.find("video").each(function(){this.pause(),$(this).prop("src","").find("source").attr("src",""),$(this).empty().remove(),delete this}),j=null,k=null,l=null,m=null,n=null})},controller:["$scope","utils",function(c,d){function e(){var b={};if(b.iconStyle={position:"absolute",top:"50%",margin:"-32px -32px",left:"50%"},"FEED"===c.dataFormat){var d=c.origionalFile;b.available_previews=d.available_previews,b.name=d.name,b.preview_name=d.preview_name,b.noteId=d.noteId,b.original_name=d.original_name,b.id=d.id,b.appInstanceId=d.app_instance_id,b.thumbWidth=d.thumbWidth||250,b.thumbHeight=d.thumbHeight||220,b.thumbnail_image=d.thumbnail_image,b.thumbStyle={width:b.thumbWidth,height:b.thumbHeight}}else"NOTE"===c.dataFormat?(b.available_previews=c.origionalFile.available_previews,b.name=c.origionalFile.name,b.preview_name=c.origionalFile.preview_name,b.noteId=c.origionalFile.item_id,b.appInstanceId=c.origionalFile.app_instance_id,b.original_name=c.origionalFile.original_name,b.id=c.origionalFile.file_id,b.thumbWidth=215,b.thumbHeight=170,32&b.available_previews&&(b.thumbnail_image=a("getNoteThumbnailPath")(c.origionalFile,c.origionalFile.item_id)),b.thumbStyle={},b.iconStyle.margin="-50px -32px",b.iconStyle.top="85px"):"CHAT"===c.dataFormat&&(b.available_previews=c.origionalFile.availablePreviews,b.name=c.origionalFile.name,b.preview_name=c.origionalFile.previewName,b.noteId=c.origionalFile.itemId,b.appInstanceId=c.origionalFile.app_instance_id,b.original_name=c.origionalFile.originalName,b.id=c.origionalFile.fileId,b.thumbWidth=155,b.thumbHeight=100,(32&b.available_previews||0==b.availablePreviews)&&(c.origionalFile.thumbnail_name||(c.origionalFile.thumbnail_name=c.origionalFile.thumbnailName),b.thumbnail_image=a("getNoteThumbnailPath")(c.origionalFile,c.origionalFile.itemId)),b.thumbStyle={width:b.thumbWidth,height:b.thumbHeight});b.name.length>50?b.tooltip=b.name.substr(0,50)+"...":b.tooltip=b.name,c.file=b}c.file={},e();var f=c.file.original_name.split(".");f.pop(),f=f.join("."),c.canPlayPreviewType=0,c.canPlayVideoType=0,c.videoPreviewURL=!1,c.videoURL=!1,c.isThumbnailAvailable=32&c.file.available_previews,c.isMp4PreviewAvailable=64&c.file.available_previews,c.isWebmPreviewAvailable=128&c.file.available_previews,c.isMp4Available=256&c.file.available_previews,c.isWebmAvailable=512&c.file.available_previews,c.isThumbnailInViewY=!1,c.isAppFocused=b.appHasFocus();var g={};g.isMp4PreviewAvailable=c.isMp4PreviewAvailable,g.isWebmPreviewAvailable=c.isWebmPreviewAvailable,g.isMp4Available=c.isMp4Available,g.isWebmAvailable=c.isWebmAvailable,c.canPlayPreviewType=d.formatCheck("preview",g),c.canPlayVideoType=d.formatCheck("video",g),1===c.canPlayPreviewType?c.videoPreviewURL=a("getVideoPreviewPath")(c.file.preview_name,c.file.noteId,c.file.appInstanceId,"webm"):2===c.canPlayPreviewType&&(c.videoPreviewURL=a("getVideoPreviewPath")(c.file.preview_name,c.file.noteId,c.file.appInstanceId,"mp4")),1===c.canPlayVideoType?c.videoURL=a("getVideoPath")(f,c.file.noteId,c.file.appInstanceId,"webm",480):2===c.canPlayVideoType&&(c.videoURL=a("getVideoPath")(f,c.file.noteId,c.file.appInstanceId,"mp4",480)),c.isVideoPreviewInsertedInDOM=!1,c.isVideoPreviewLoaded=!1,c.currentState=0,c.emitVideoId=function(){var a={id:c.file.id};c.$emit("VideoPlayback:clicked",a)}}]}}]),b.module("convoApp").controller("cnvAuthCodesModalCtrl",["$scope","$modalInstance","utils","backup_codes","account_name",function(a,b,c,d,e){var f=a,g=null;f.copiedText=!1,f.backupCodes=d,f.accountName=e,f.copyCodes=function(){c.copyToClipboard(f.backupCodes.map(function(a){return a.backup_code}).join("\n")),f.copiedText=!0,clearTimeout(g),g=setTimeout(function(){f.copiedText=!1,f.$digest()},3e3)},f.dismiss=function(){b.dismiss()},f.close=function(){b.close()},$("body").addClass("visible-dialog-only-on-print"),f.$on("$destroy",function(){$("body").removeClass("visible-dialog-only-on-print")})}]),b.module("convoApp").directive("cnvBanners",[function(){return{restrict:"A",scope:!0,templateUrl:"components/cnvBanners/cnvBanners.tpl.html",compile:function(a,b,c){return function(a,b,c,d){}},controller:["$scope","bannerService",function(a,b){a.bannersStack=b.getBannersStackReference(),a.onBannerTextClick=function(a,c){b.onBannerTextClick(a,c)},a.onBannerCloseBtnClick=function(a){b.onBannerCloseBtnClick(a)},b.on("dataUpdated",function(){a.$broadcast("render")})}]}}]),b.module("convoApp").directive("cnvInputIncrementBox",[function(){return{restrict:"E",priority:0,templateUrl:"components/cnvInputIncrementBox/cnvInputIncrementBox.tpl.html",scope:{ctrl:"=controller",min:"@min",max:"@max",value:"=value"},link:function(a,b,c,d){function e(){return a.cnvInputIncrementBox.value=parseInt(a.cnvInputIncrementBox.value),!(a.cnvInputIncrementBox.value>a.cnvInputIncrementBox.max||a.cnvInputIncrementBox.value<a.cnvInputIncrementBox.min)}function f(){return e()?a.cnvInputIncrementBox.value:!1}function g(b){a.cnvInputIncrementBox.value=parseInt(b),parseInt(b)>6&&(a.cnvInputIncrementBox.disabled=!1)}function h(){a.ctrl.getValue=f,a.ctrl.setValue=g}a.increment=function(){return a.cnvInputIncrementBox.value=parseInt(a.cnvInputIncrementBox.value),a.cnvInputIncrementBox.value>=a.cnvInputIncrementBox.max?!1:(a.cnvInputIncrementBox.value=a.cnvInputIncrementBox.value+1,void(a.cnvInputIncrementBox.value>6&&(a.cnvInputIncrementBox.disabled=!1)))},a.decrement=function(){return a.cnvInputIncrementBox.value=parseInt(a.cnvInputIncrementBox.value),a.cnvInputIncrementBox.value<=a.cnvInputIncrementBox.min?!1:(a.cnvInputIncrementBox.value=a.cnvInputIncrementBox.value-1,void(a.cnvInputIncrementBox.value<=6&&(a.cnvInputIncrementBox.disabled=!0)))},h()},controller:["$scope",function(a){a.cnvInputIncrementBox={max:parseInt(a.max),min:parseInt(a.min),disabled:!0},null==a.cnvInputIncrementBox.value&&(a.cnvInputIncrementBox.value=parseInt(a.value))}]}}]),b.module("convoApp").directive("cnvLikeButton",function(){return{restrict:"A",scope:{like_info:"=likeInfo",likeHandler:"&"},template:"<a bo-href=\"\" ng-click=\"onLikeClick()\" bo-class=\"{'like_btn': true, 'like_btn_disabled': like_pending}\" bo-bind=\"like_info.liked_by_me ? 'Unlike' : 'Like'\"></a>",controller:["$scope","$rootScope",function(a,b){function d(){}function e(a,b,c){"like"===a?(b.liked_by_me=!1,b.likes_count--,b.liked_by=c):b.liked_by_me=!0}a.like_pending=!1,a.__leak_like=new d,a.onLikeClick=function(){if(!a.like_pending){a.like_pending=!0;var d=a.like_info,f=d.liked_by,g=d.liked_by_me?"unlike":"like";"like"==g?(d.liked_by_me=!0,d.likes_count++,d.liked_by=b.login_data.user.user_id):(d.liked_by_me=!1,d.likes_count>0&&d.likes_count--),a.$emit("setItemDirty"),a.likeHandler({action:g}).then(function(b){a.like_pending=!1;var h=a.like_info;b.success?(h.liked_by_me=d.liked_by_me,h.likes_count=parseInt(b.like_count),b.liked_by!=c?h.liked_by=b.liked_by:b.likedBy!=c&&(h.liked_by=b.likedBy)):e(g,h,f),a.$emit("setItemDirty")},function(){a.like_pending=!1,e(g,a.like_info,f),a.$emit("setItemDirty")})}}}]}}),b.module("convoApp").directive("cnvLogoWithFeedDirtyIndicator",[function(){return{scope:!1,restrict:"E",templateUrl:"components/cnvLogoWithFeedDirtyIndicator/cnvLogoWithFeedDirtyIndicator.tpl.html",controller:["$scope","feedDirtyInfo","accountInfo","mixpanelService","utils","resourcesTabsManager",function(a,b,c,d,e,f){function g(){a.feedDirty=!0}function h(){a.feedDirty=!1}function i(){a.networkLogo,a.accountInfo=c,a.networkLogo=c.getAccountImageUrl(),a.$broadcast("render")}b.on("feedDirty",g),b.on("feedDirtyClear",h),a.feedDirty=b.getIsDirty(),a.isFullChatView=f.isFullViewChatOpen(),c.on("accountImageVersionUpdated",i),c.on("accountNameUpdated",i),i(),a.$on("$destroy",function(){b.off("feedDirty",g),b.off("feedDirtyClear",h),c.off("accountImageVersionUpdated",i),c.off("accountNameUpdated",i)})}]}}]),b.module("convoApp").directive("cnvNetworkAlert",["onboardingService",function(a){return{restrict:"AE",scope:!0,templateUrl:"components/cnvNetworkAlert/cnvNetworkAlert.tpl.html",compile:function(){return function(b,c,d){function e(a){b.doShow=!0,b.contentHtml=a.contents,b.showCloseBtn=a.crossable;var d=a.color+"-bg";b.bgClass!==d&&(c.find(".network-alert-cont").removeClass(b.bgClass),
b.bgClass=d),i(),j||(j=c.find(".text-cont"),j.on("click","a",h))}function f(){b.doShow=!1,i(),j.off("click","a",h),j=null}function g(){a.recordAction("limits_banner_dismissed"),f(),b.$emit("cnvNetworkAlert.alertDismissed")}function h(a){b.$emit("cnvNetworkAlert.linkInTextClicked",a.currentTarget.href)}function i(){b.$broadcast("render")}b.doShow=!1;var j;b.$on("$destroy",function(){j.off("click","a",h),j=null}),b.$on("cnvNetworkAlert.showAlert",function(a,b){e(b)}),b.$on("cnvNetworkAlert.hideAlert",f),b.$on("cnvNetworkAlert.dismissAlert",g),b.dismissAlert=g}},controller:["$scope",function(a){}]}}]),b.module("convoApp").controller("CombinedSetProfilePictureModalCtrl",["$scope","$modalInstance",function(a,b){a.dismiss=function(){b.dismiss()},a.$on("dismissProfilePictureCombinedModal",a.dismiss)}]),b.module("convoApp").directive("cnvCombinedSetProfilePictureModal",["alertsService","$rootScope","userInfo","profilePicService","awsService","accountInfo","bannerService","config","utils","mixpanelService","homeViewStateInfo","onboardingService",function(b,c,d,e,f,g,h,i,j,k,l,m){return{restrict:"A",controller:["$scope",function(a){function b(){a.thisUser=d.getUserInfo(),a.$broadcast("refreshImage")}a.thisUser=d.getUserInfo(),a.utils=j,a.config=i,d.on("userInfo.updated",b),a.$on("$destroy",function(){d.off("userInfo.updated",b)})}],link:function(h,l,m){function n(){w.on("change",o)}function o(a){this.files.length>0&&q(this.files[0]),w.val(null)}function p(a,b,c){if(!y){var d=new Image;y=!0,d.onload=function(){var a=document.createElement("canvas");a.width=d.width,a.height=d.height;var b=a.getContext("2d");b.drawImage(d,0,0);var e=t(a.toDataURL("image/png"));s(e,"png","png",0,0,d.width,d.height,c)},b?d.setAttribute("crossOrigin","use-credentials"):d.setAttribute("crossOrigin","anonymous"),d.src=a}}function q(a){var d="home/userView/centerPanelWidgets/profilePictureModal.tpl.html",e="ProfilePictureModalCtrl",f={startWebcam:function(){return!1},file:function(){return a}},g=b.customModal(d,e,f,"cnvUserProfilePictureModal",!0);g.result.then(function(a){h.$broadcast("render"),c.$broadcast("userProfilePictureUpdated"),c.$broadcast("refreshImage"),h.$emit("dismissProfilePictureCombinedModal")})}function r(a,b,f){var i=e.getThumbnailGenerationRequestStatus(a);i.then(function(i,j){if("SUCCESS"==i.data.status){var l=e.updateUserProfileImageIfUploaded(a,d.getUserId(),g.getAccountId());clearInterval(b),l.then(function(a,b){var d,e;y=!1,a.hasOwnProperty("data")&&(d=a.data.user_profile_image_type,e=a.data.user_profile_image_version),h.alerts={success:"Picture uploaded."},k.trackEvent(k.Upload_Profile_Pic,{Source:f}),c.$broadcast("userProfilePictureUpdated",d,e),c.$broadcast("refreshImage"),h.$emit("dismissProfilePictureCombinedModal")},function(a){y=!1})}},function(a){y=!1})}function s(a,b,c,d,g,i,j,k){b=b.toLowerCase();var l=e.generateRequestUUID();l.then(function(l,m){var n=l.data,o=f.uploadFile(a,n+"-original."+b,"temp/requests/"+n+"/"+n+"-original."+b,c);h.alerts={success:"Uploading Photo..."},o.then(function(c,f){var l=e.generateProfileThumbnails(n,n+"."+b,a.size,100,{x:g,y:d,width:i,height:j});h.alerts={success:"Generating thumbnails..."},l.then(function(a,b){var c=setInterval(function(){r(n,c,k)},5e3)},function(a){y=!1})},function(a){y=!1})},function(a){y=!1})}function t(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}function u(a){y||j.fireEvent(l.find("#combinedProfileUploadInput")[0],"click")}function v(b){if("string"==typeof b.data){var c=JSON.parse(b.data);if(c.hasOwnProperty("error_message"))h.alerts={error:c.error_message},h.$$phase||h.$digest(),y=!1;else if(c.hasOwnProperty("data")&&c.data.hasOwnProperty("profile_image_url")){var d=c.data.source;"TWITTER"===d?p(i.APP_DOMAIN+"/app/link_resolver.php?url="+c.data.profile_image_url_https,!0,"Twitter"):"LINKEDIN"===d?p(i.APP_DOMAIN+"/app/link_resolver.php?url="+c.data.profile_image_url_https,!0,"LinkedIn"):"FACEBOOK"===d?p(c.data.profile_image_url_https,!1,"Facebook"):p(i.APP_DOMAIN+"/app/link_resolver.php?url="+c.data.profile_image_url_https,!0),z=null,A=null,B=null}a.removeEventListener("message",v,!1)}}var w=l.find("#combinedProfileUploadInput"),x=i.APP_DOMAIN+"/app/integrations/connect/splash.php?provider=",y=!1,z=null,A=null,B=null;h.setProfilePictureViaWebcam=function(){if(!y){var a="home/userView/centerPanelWidgets/profilePictureModal.tpl.html",d="ProfilePictureModalCtrl",e={startWebcam:function(){return!0},file:function(){return null}},f=b.customModal(a,d,e,"cnvUserProfilePictureModal");f.result.then(function(a){h.$broadcast("render"),c.$broadcast("userProfilePictureUpdated"),c.$broadcast("refreshImage"),h.$emit("dismissProfilePictureCombinedModal")})}},l.on("click",".uploadButton",u),h.uploadViaLinkedIn=function(){if(!y){var b=screen.width/2-300,c=screen.height/2-300;B&&(B.close(),B=null),B=a.open(x+"linkedin","","width=600, height=600, top="+c+", left="+b),a.focus&&B.focus(),a.addEventListener("message",v,!1)}},h.uploadViaFb=function(){if(!y){var b=screen.width/2-512,c=screen.height/2-300;A&&(A.close(),A=null),A=a.open(x+"facebook","","width=580, height=400, top="+c+", left="+b),a.focus&&A.focus(),a.addEventListener("message",v,!1)}},h.uploadViaTwitter=function(){if(!y){var b=screen.width/2-300,c=screen.height/2-300;z&&(z.close(),z=null),z=a.open(x+"twitter","","width=600, height=600, top="+c+", left="+b),a.focus&&z.focus(),a.addEventListener("message",v,!1)}},h.$on("$destroy",function(){a.removeEventListener("message",v,!1),l.off("click",".uploadButton",u),w.off("change",o),w=null}),n()}}}]),b.module("convoApp").directive("cnvDropdown",["$compile","$timeout",function(a,b){return{restrict:"E",scope:{dropdown_items:"=items",show_dropdown:"=show",itemSelectCallback:"&"},link:function(c,d,e){function f(){}function g(){}function h(a){if(c.dropdown_items[m].separator||c.dropdown_items[m].disabled){if(0==c.dropdown_items[m].separator&&0==c.dropdown_items[m].disabled){var b=c.dropdown_items[m];c.itemSelectCallback({item:b,withTabKey:a})}}else{var b=c.dropdown_items[m];c.itemSelectCallback({item:b,withTabKey:a})}}function i(a){for(var b=0,c=a.parentElement;c.children[b]!=a;)b++;return b}function j(a){if(c.show_dropdown)if(27==a.which)c.$apply(function(){c.show_dropdown=!1});else if(38===a.which){if(a.preventDefault(),n>-1)if(m>0){if(m--,c.dropdown_items[m].separator||c.dropdown_items[m].disabled)for(;c.dropdown_items[m].separator===!0||c.dropdown_items[m].disabled===!0;)(c.dropdown_items[m].separator===!0||c.dropdown_items[m].disabled===!0)&&(m--,-1==m&&(m=n));$(".dropdown-item-cont",$(d[0])).removeClass("selected"),$(d[0].children[0].children[m]).addClass("selected")}else if(0>=m){if($(".dropdown-item-cont",$(d[0])).removeClass("selected"),m=n,c.dropdown_items[m].separator||c.dropdown_items[m].disabled)for(;c.dropdown_items[m].separator===!0||c.dropdown_items[m].disabled===!0;)(c.dropdown_items[m].separator===!0||c.dropdown_items[m].disabled===!0)&&m--;$(d[0].children[0].children[m]).addClass("selected")}}else if(40===a.which){if(a.preventDefault(),n>-1)if(n>m){if(m++,c.dropdown_items[m].separator||c.dropdown_items[m].disabled)for(;c.dropdown_items[m].separator===!0||c.dropdown_items[m].disabled===!0;)(c.dropdown_items[m].separator===!0||c.dropdown_items[m].disabled===!0)&&(m++,m==n&&(m=0));$(".dropdown-item-cont",$(d[0])).removeClass("selected"),$(d[0].children[0].children[m]).addClass("selected")}else if(m>=n){if($(".dropdown-item-cont",$(d[0])).removeClass("selected"),m=0,c.dropdown_items[m].separator||c.dropdown_items[m].disabled)for(;c.dropdown_items[m].separator===!0||c.dropdown_items[m].disabled===!0;)(c.dropdown_items[m].separator===!0||c.dropdown_items[m].disabled===!0)&&m++;$(d[0].children[0].children[m]).addClass("selected")}}else 13===a.which?-1!=m&&(a.preventDefault(),c.$apply(function(){h()})):9===a.which&&-1!=m&&(a.preventDefault(),c.$apply(function(){h(!0)}))}function k(a){c.show_dropdown&&a.target!=this&&c.$apply(function(){c.show_dropdown=!1})}function l(a){r&&a.target!==r[0]&&!d[0].contains(a.target)&&c.$apply(function(){c.show_dropdown=!1})}d[0].cnvMemLeakHook=new f,c.cnvMemLeakHook=new g;var m=-1,n=0,o=c.$eval(e.watchOnLengthOnly),p=a('<ul class="dropdown-cont '+e.dropdownClass+'" ng-show="show_dropdown"><li ng-repeat="item in dropdown_items" ng-mouseover="mouseover($event)" ng-click="clickedOnSelectedItem($event)" class="dropdown-item-cont" ng-class="{disabled: item.disabled}" ng-include="getTemplateForItem(item)"></li></ul>')(c);d.append(p),c.$watch("show_dropdown",function(a,b){c.show_dropdown||-1==m||($(d[0].children[0].children[m]).removeClass("selected"),m=-1)}),o||c.$watch("dropdown_items",function(a,b){$(".dropdown-item-cont",$(d[0])).removeClass("selected"),n=a.length-1,m=-1}),o&&c.$watch("dropdown_items.length",function(a,c){n=a-1,b(function(){d.find(".selected").length>0&&(m=i(d.find(".selected")[0]))},0)}),c.clickedOnSelectedItem=function(a){$(a.target).hasClass("sec-link")||h()},c.mouseover=function(a){$(".dropdown-item-cont",$(d[0])).removeClass("selected"),$(a.currentTarget).addClass("selected"),m=i(a.currentTarget),(1==c.dropdown_items[m].separator||c.dropdown_items[m].disabled===!0)&&$(".dropdown-item-cont",$(d[0])).removeClass("selected")},c.getTemplateForItem=function(a){return a.separator?"components/dropdown/separatorListItem.tpl.html":e.itemTemplate};var q,r=$("#"+e.navSourceElemId);r&&r.length>0&&(r.on("keydown",j),r.on("blur",k),q=$(document.body),q.on("mousedown",l)),c.$on("$destroy",function(){r.off("keydown",j),r.off("blur",k),q&&(q.off("mousedown",l),q=null),o=null,r=null,d[0].cnvMemLeakHook=null})}}}]),b.module("convoApp").directive("cnvDropdowns",["$templateCache","$compile","popoverUtils","networkSettingService",function(b,c,d,e){return{restrict:"AE",scope:!0,templateUrl:"components/dropdown/cnvDropdown.tpl.html",controller:["$scope",function(a){}],link:function(b,f,g){function h(){}function i(){}function j(c){var d=f.find(".dropdown-main-menu"),e=d[0].getBoundingClientRect(),g=e.top,h=d.height();(g+h>$(a).height()||c)&&d.css("top",-1*h-15),e.left+e.width>$(a).width()?d.css("left",-1*e.width+15):e.left+2*e.width<$(a).width()&&"right"!=b.ddAlign&&d.css("left",0)}function k(){n.css("position","absolute").css("top","20px")}function l(d,f){if(d&&d.length>0)for(var g=0;g<d.length;g++){var h=b.$new(!1,null),i=d[g];if(0!==e.getChatStatus()||!i.isDivider&&-1==i.label.indexOf("Start a chat")){h.option=i;var j,k,m,n=[],o=1;if(i.checkBox)j="<li",i.isNotHoverable&&(j+=' class="notHoverable"'),j+='><span class="menu-item-wrapper"',i.callback&&(j+=' ng-click="option.callback(dropDownCallbackParams, $event)"'),j+=">",k="</li>",m=b.dropDownCallbackParams[i.checkBoxId]?j+'<input type="checkbox" class="cnv-checkbox" id="'+i.checkBoxId+'" checked="checked" /> <label for="'+i.checkBoxId+'"></label><span>&nbsp;&nbsp;'+_.escape(i.label)+"</span>"+k:j+'<input type="checkbox" class="cnv-checkbox" id="'+i.checkBoxId+'"/> <label for="'+i.checkBoxId+'"></label><span>&nbsp;&nbsp;'+_.escape(i.label)+"</span>"+k;else if(j="<li",i.isNotHoverable&&(j+=' class="notHoverable"'),j+='><a href="',i.url?j+=i.url:(j+='javascript:void(0)"',j+=' oncontextmenu="event.preventDefault();"'),j+=i["class"]?'" class="menu-item-wrapper '+i["class"]+'"':'" class="menu-item-wrapper"',i.callback&&(j+=' ng-click="option.callback(dropDownCallbackParams, $event, option.callbackParam)"'),j+=">",k="</a></li>",i.showIndicator&&(j+="<div class='dropdownMenuIndicator'></div>"),i.conditionalLabelIcon)m=b.condition[i.condition]?j+'<i class="'+i.icon+'"></i><span>'+_.escape(i.label)+"</span>"+k:j+'<span class="dummy-block-14"></span><span>'+_.escape(i.label)+"</span>"+k;else if(i.subtext)m=j,i.escapeAngularBindings?(m+='<span id="textInsertionTarget'+o+'"></span>',n.push(["textInsertionTarget"+o,i.label]),o++):m+="<span>"+_.escape(i.label)+"</span>",m+="<br>",i.escapeAngularBindings?(m+='<span class="subtext" id="textInsertionTarget'+o+'"></span>',n.push(["textInsertionTarget"+o,i.subtext]),o++):m+='<span class="subtext">'+_.escape(i.subtext)+"</span>",m+=k;else if(i.icon)m=j+'<i class="'+i.icon+'"></i><span>'+_.escape(i.label)+'</span><ul class="submenu1 dropdown-menu"></ul>'+k;else if(i.isDivider)m='<li class="divider"></li>';else if(i.conditionalLabel){if(!b.condition[i.condition])continue;m='<li class="divider"></li>'+j+"<span>"+_.escape(i.label)+"</span>"+k}else i.toggleLabel?m=b.condition[i.condition]?j+"<span>"+_.escape(i.label)+"</span>"+k:j+"<span>"+_.escape(i.toggleLabelWith)+"</span>"+k:i.escapeAngularBindings?(m=j+'<span id="textInsertionTarget'+o+'"></span>'+k,n.push(["textInsertionTarget"+o,i.label]),o++):m=j+"<span>"+_.escape(i.label)+"</span>"+k;for(var q=c(m)(h),r=0;r<n.length;r++){var s=n[r];q.find("#"+s[0]).text(s[1])}if(f.append(q),i.submenu&&i.submenu.length>0){var t=q.find(".submenu1"),u=!1;t.css("position","absolute").css({left:"196px","margin-top":"-26px"}),l(i.submenu,t);var v=function(){u=!0,t.css("display","block");var b=t[0].getBoundingClientRect(),c=$(a).width(),d=t.width();b.left+d+4>c&&t.css("left",parseInt(t.css("left").replace("px",""))-(b.left+d-c-4))},w=function(){u=!1,setTimeout(function(){u||t.css("display","none")},150)};q.on("mouseenter",v),q.on("mouseleave",w),p.push(q)}}}}function m(){for(var a=0;a<p.length;a++)p[a].off(),p.splice(a,1)}f[0].cnvMemLeakHook=new h,b.cnvMemLeakHook=new i;var n=f.find(".dropdown-menu"),o=b.$eval(g.cnvDropdownCtrl),p=[];if(o&&o.type&&(b.ddType=o.type,b.$broadcast("render")),o&&o.align&&(b.ddAlign=o.align,b.$broadcast("render")),b.containerClass=o.containerClass,o&&o.hasOwnProperty("attrs"))for(var q=o.attrs,r=0;r<q.length;r++){var s=q[r];f.find(s.selector).attr(s.key,s.value)}var t=function(a,c,d,e){n.hide(),b.isopen=!1,$("body").off("mousewheel",t)};b.toggled=function(c){if(b.isopen=c,n&&(m(),n.empty()),c){var e=b.$eval(g.cnvDropdownCtrl);if(b.config=e,b.options=e.options,g.cnvDropdownCallbackParams&&(b.dropDownCallbackParams=b.$eval(g.cnvDropdownCallbackParams)),g.condition&&(b.condition=b.$eval(g.condition)),l(b.options,n),k(),n.show(),e.fixedPosition){var h=f.find(".dropdown-toggle").offset(),i=h.top-$(a).scrollTop()+20,o=h.left-140;if(e.alwaysUpwordsDirection){var p=f.find(".dropdown-main-menu"),q=p.height();i-=q+40}n.css("position","fixed").css("top",i).css("left",o).css("right","auto"),$("body").on("mousewheel",t)}else j(e.alwaysUpwordsDirection);e.onMenuOpen&&e.onMenuOpen(),b.config.wrapperClass&&f.closest("."+b.config.wrapperClass).css("display","block"),d.hide()}else n&&(m(),n.empty(),n.hide()),b.config.wrapperClass&&f.closest("."+b.config.wrapperClass).css("display","");b.$emit("cnvDropdownToggled",{state:c})},b.$on("toggleCnvDropdown",function(){b.isopen||(m(),n.empty(),n.show(),b.isopen=!0,a.setTimeout(function(){b.$apply(b.toggled(!0))},0))}),b.$on("$destroy",function(){$("body").off("mousewheel",t),m(),f.find("li").off("mouseenter").off("mouseleave"),f.empty(),n.empty(),n=null})}}}]),b.module("convoApp").controller("groupInvtStatusDialogCtrl",["$scope","$modalInstance","$filter","inviteSuccessEmails","inviteFailEmails",function(a,b,c,d,e){function f(){a.successEmailsTooltip={text:""};for(var b=h;b<a.inviteSuccessEmails.length;b++)a.inviteSuccessEmails.hasOwnProperty(b)&&(a.successEmailsTooltip.text+=c("limitText")(a.inviteSuccessEmails[b].invitee_global_profile.email,80)+"<br>")}function g(){a.FailEmailsTooltip={text:""};for(var b=h;b<a.inviteFailEmails.length;b++)a.inviteFailEmails.hasOwnProperty(b)&&(a.FailEmailsTooltip.text+=c("limitText")(a.inviteFailEmails[b].invitee_email,80)+"<br>")}a.title="Alert Box",a.okBtnLabel="Ok",a.inviteSuccessEmails=d,a.inviteFailEmails=e;var h=2;a.ok=function(){b.close()},f(),g()}]),b.module("convoApp").directive("cnvTagInput",[function(){return{restrict:"A",scope:{},link:function(a,b,c){var d,e=["red","green","blue","brown","yellow","abc","cba","ba","ad","af","ag"];d="Share with others"==c.action?JSON.parse(c.data):[c.data],$("#taginput").select2({tags:e,dropdownAutoWidth:!0,tokenSeparators:[","]}),$("#taginput").select2("val",d),"Share with others"==c.action&&$(".select2-search-choice-close").each(function(){$(this).removeAttr("href"),$(this).replaceWith("<span class='select2-search-choice-close select2-lock-choice'> </span>")}),$(".select2-choices").addClass("select2-ul-scroll"),setTimeout(function(){$(".select2-input").focus()},500),$(".modal-body").on("keyup",function(a){var b=($(".select2-container").offset(),$(".select2-choices").width()),c=($(".select2-search-choice-focus").width(),$(".select2-choices")[0].scrollLeft);if(37==a.which){var d=$(".select2-search-choice-focus")[0].offsetLeft;c>d&&$(".select2-choices").animate({scrollLeft:d},100)}if(39==a.which){var d=$(".select2-search-choice-focus")[0].offsetLeft;d>c&&$(".select2-choices").animate({scrollLeft:d},100)}if((38==a.which||40==a.which)&&!$(".select2-search-field").is(":focus")){var d=$(".select2-search-field")[0].offsetLeft;$(".select2-choices").animate({scrollLeft:d-b/2},100)}})}}}]),b.module("convoApp").directive("cnvEditor",["$injector","$compile","$templateCache","accountInfo","utils","idToFilterUrlForAppFilter","$filter","AppLinks","FilterTypes","alertsService","$timeout","config","emojiDataService","BlackListWordsService",function(b,d,e,f,g,h,i,j,k,l,m,n,o,p){return{restrict:"E",priority:0,scope:{atMentionsSource:"&cnvAtMentions",onCommandExecuted:"&cnvOnCommandExecuted",onAtMentionAdded:"&cnvOnAtMentionAdded",onHashTagAdded:"&cnvOnHashTagAdded",onAtMentionRemoved:"&cnvOnAtMentionRemoved",onTextSelectionRemoved:"&cnvTextSelectionRemoved",atMentionsSuggestionItemTemplate:"@cnvAtMentionsSuggestionItemTemplate",hashtagSource:"&cnvHashtags",toolbarId:"=toolbarId",onTextPasted:"&cnvTextEditorOnTextPasted",onFocusOut:"&cnvTextEditorOnFocusOut",onUrlAdded:"&cnvTextEditorOnUrlAdded",onEscKeyPress:"&cnvTextEditorOnEscKeyPress",onTabKeyPressInTextEditor:"&cnvTextEditorOnTabKeyPress",onSpaceKeyPressInTextEditor:"&cnvTextEditorOnSpaceKeyPress",onEnterKeyPressInTextEditor:"&cnvTextEditorOnEnterKeyPress",onCtrlOrCmdEnterPress:"&cnvTextEditorOnCtrlOrCmdEnterPress",onEnterPress:"&cnvTextEditorOnEnterPress",onCtrlOrCmdSavePress:"&cnvTextEditorOnCtrlOrCmdSavePress",onShiftTabPress:"&cnvTextEditorOnShiftTabPress",onTabPress:"&cnvTextEditorOnTabPress",onEditorDestroy:"&cnvTextEditorOnDestroy",submitOnEnter:"&cnvTextEditorSubmitOnEnter",ctrl:"=cnvTextEditorCtrl",readOnly:"=cnvReadOnly",placeholder:"@cnvPlaceholder",cnvEditorSource:"@cnvEditorSource"},compile:function(d,e,f){return function(d,e,f,m){function q(){}function r(a,b,c){var d={};return d.data={},d.data.prev_content_length_in_editor=c,d.data.link={},d.data.link.title=b,d.data.link.href=a,d}function s(a){var b=!1,d=a.getSelection(),e=$(a.root.childNodes).scrollParent()[0],f=e.scrollTop;0==a.getText().trim().length&&(a.insertText(0,".",c,"user"),b=!0);var g="common/dialogs/templates/cnvResolveLinkModal.tpl.html",h="cnvAddPinContentModalCtrl",i={resource_name:function(){return a.getText().substr(d.start,d.end-d.start)},resource_url:function(){return""},provided_desc:function(){return""},title:function(){return!1},btnTitle:function(){return!1},source:function(){return"show_suggestion"}},j=l.customModal(g,h,i);j.result.then(function(c){setTimeout(function(){if(a.focus(),b&&a.deleteText(0,1,"user"),c&&d){d.start!=d.end&&a.deleteText(d.start,d.end,"user");var e=c.url,f=c.resource_name;a.insertText(d.start,f,{link:e.trim().replace(/\'/g,"%27")},"user");var g=H.getSelection();g&&0===g.start&&0===g.end&&(console.debug("Editor: edit selection messedup bug handled gracefully"),a.setSelection(d.start+f.length,d.start+f.length))}},0),e.scrollTop=f},function(){setTimeout(function(){H.focus(),b&&H.deleteText(0,1,"user")},0),e.scrollTop=f})}function t(a,b,c){if(c||I&&f.cnvTextSelectionRemoved){var e=[].map.call(H.root.querySelectorAll("."+v.AT_MENTION_DOM_CLASSES.MENTION),function(a){return a.className});e=e.toString(),e=e.replace(new RegExp(v.AT_MENTION_DOM_CLASSES.MENTION+" "+v.AT_MENTION_DOM_CLASSES.MARKER+" ","g"),""),d.$apply(function(){d.onTextSelectionRemoved({$atMentionNodes:e.toString()}),I=!1})}}var u={},v=b.get("usersGroupsListProvider"),w=f.cnvTextEditorMode||"basic",x=f.toolbarId||"",y=f.cnvFocusOnLoad||"true",z=f.cnvPlaceholder||!1,A=d.readOnly||!1,B=null!=f.cnvTextEditorOnUrlAdded,C=g.generateUniqueCharId(),D=$('<div id="'+C+'"></div>');$(e).append(D),d.cnvEditorScope=new q;var E=[];E="full"===w?["bold","italic","underline","strike","bullet","list","align","link","color"]:"diff"===w?["bold","italic","underline","strike","bullet","list","align","link","color","background"]:"basic"===w?["bold","italic","underline","strike","align","link"]:"minimal"===w?["link"]:[];var F=!1,G={formats:E,readOnly:A,pollInterval:100,styles:!1,theme:"snow",modules:{"paste-manager":!0,resize:{minHeight:m.ctrl.height.min||72,maxHeight:m.ctrl.height.max},setup:{init:function(a){function b(b){a.onModuleLoad("capture-events",function(a){_.extend(b,Backbone.Events)}),a.addModule("capture-events",{"text-change":function(a,c){"user"===c&&b.trigger("text-change",{delta:a,source:c})},"selection-change":function(a,c){a&&b.trigger("selection-change",{range:a,source:c})}})}function h(b){var c,d=a.getSelection(),e=a.root.ownerDocument.getSelection();if(d){if(e.focusNode.parentNode.nodeName.toLowerCase()!==k.ANCHOR&&e.focusNode.nodeName.toLowerCase()!==k.ANCHOR){var f=a.getText(),h=Math.min(f.lastIndexOf(" ",d.start-2),f.lastIndexOf(" ",d.start-1)),h=Math.max(h,f.lastIndexOf("\n",d.start-1))+1,i=d.end-h-(b?0:1),j=f.substr(h,i);e.focusNode.nodeValue&&e.focusNode.nodeValue.indexOf(j)>-1&&g.isValidUrl(j.trim())&&(j=p.clean(j.trim()),c=j,-1==j.indexOf("http")&&(c="http://"+c),a.deleteText(h,d.end-(b?0:1),"user"),a.insertText(h,j,{link:c.trim().replace(/\'/g,"%27")},"user"))}return c}}function i(b,c){var d=$(a.root),e=d.scrollTop();d[0].scrollHeight>d[0].clientHeight&&(0==e&&c>0||e==d[0].scrollHeight-d[0].clientHeight&&0>c)&&b.preventDefault()}a.__nuke__=u,m.ctrl.destroy={},a.addFormat("highlight",{tag:"a",attribute:"href"}),a.addFormat("addclass",{attribute:"class"}),a.addFormat("target",{attribute:"target"});var j={ENTER:13,ESCAPE:27,SPACE:32,SAVE:83,BACKSPACE:8,LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,DELETE:46},k={ANCHOR:"a",TEXT:"#text",DIV:"div"};if(a.flags={},z&&a.addModule("placeholder",{placeholder:z}),a.addModule("emoji",{}),m.ctrl.initialHtmlText){a.setHTML(m.ctrl.initialHtmlText);var l=a.getText().length;m.ctrl.prevent_focus_on_load||a.setSelection(l,l)}"true"===y&&a.focus(),m.ctrl.hasOwnProperty("captureEvents")&&"object"==typeof m.ctrl.captureEvents&&b(m.ctrl.captureEvents),m.ctrl.collaboration&&(m.ctrl.collaboration.initialize=function(){var c=m.ctrl.collaboration;b(c),a.onModuleLoad("multi-cursor",function(b){b.options.template='<span class="cursor-flag"> <span class="cursor-triangle top"></span> <img class="cursor-image" /> <span class="cursor-name"></span> <span class="cursor-triangle bottom"></span> </span> <span class="cursor-caret"></span>',c.mc_service={clearCursors:function(){b.clearCursors()},moveCursor:function(c,d){d<a.getText().length?b.moveCursor(c,d):console.debug("Editor: cursor position is out of bounds")},removeCursor:function(a){b.removeCursor(a)},setCursor:function(a,c,d,e,f){var g=b.setCursor(a,d,e,f||"rgba(51, 158, 202, 0.95)"),h=$(g.elem);h.find(".cursor-image").attr("src",c),h.find(".cursor-name").prepend(h.find(".cursor-image"))},shiftCursors:function(a,c,d){b.shiftCursors(a,c,d)},update:function(){b.update()}}});var d=c.cursorTimeout?c.cursorTimeout:1e5;a.addModule("multi-cursor",{timeout:d}),c.updateContents=function(b,c){a.updateContents(b,c)}},m.ctrl.collaboration.dispose=function(){m.ctrl.collaboration.off(),m.ctrl.collaboration=null}),m.ctrl.getEditorHtmlText=function(){$("a.convo-to-webapp-url",e[0]).each(function(){var a=$(this),b=a.attr("href");0!==b.indexOf("convo:")&&a.attr("href","convo:"+b.slice(1)),a.removeClass("convo-to-webapp-url")});var b=a.getHTML().replace(/(?!<a*)&amp;(?=[^<>]*>)/g,"&").replace(/&#8203;/g,"&apos;").replace(/'/g,"&apos;").replace(/\s*align\s*=\s*"LEFT"\s*/gi,"").replace(/^(<div><br><\/div>)*|(<div><br><\/div>)*$/g,"").replace(/<div><br><\/div>/g,"<p></p>");return b=o.replaceEmojiCodes(b,d.cnvEditorSource)},m.ctrl.getEditorCleanHtmlText=function(){return m.ctrl.getEditorHtmlText().replace(/<div>/g,"<p>").replace(/<\/div>/g,"</p>").replace(/<p><\/p>/g,"<br>")},m.ctrl.getEditorText=function(){return html_str=a.getText(),html_str},m.ctrl.clearContent=function(){try{a.setHTML("")}catch(b){}},m.ctrl.setContent=function(b,c){a.setHTML(b);var d=m.ctrl.getEditorText().length;c===!0&&a.setSelection(d,d)},m.ctrl.cleanNoteEditor=function(){var b,d=a.getSelection(!0);return null!==d&&d!==c?a.getText().length>0?(b=p.cleanFromHTMLText(a.getHTML()),b.length==a.getHTML().length-1&&d.start==a.getText().length?m.ctrl.setContent(b,!0):m.ctrl.setContentWithCursorAtSpecificPosition(b,d.start),b):b="":void(a.getText().length>0&&(b=p.cleanFromHTMLText(a.getHTML()),m.ctrl.setContent(b,!1)))},m.ctrl.setContentWithCursorAtSpecificPosition=function(b,c){a.setHTML(b),a.setSelection(c,c)},m.ctrl.setSpaceSeperatedContent=function(b,c,d,e,f,g,h){var i=m.ctrl.getEditorText().length;if(f)if(g>0){a.insertText(d,b,{},"user");var j=d+g,k=e+g;d=j,a.deleteText(j,k,"user")}else a.deleteText(d,e,"user");else d>i&&("tab"===h?a.insertText(d,"	",{},"user"):"enter"===h?a.insertText(d,"\n",{},"user"):"space"===h&&a.insertText(d," ",{},"user"));i>d&&(c=!1),c===!0?a.setSelection(i,i):a.setSelection(d,d)},m.ctrl.tabKeyPress=function(){m.ctrl.cleanBlackListedWords(!0,c)},m.ctrl.enterKeyPress=function(){m.ctrl.cleanBlackListedWords(c,!0)},m.ctrl.cleanBlackListedWords=function(b,d){var e,f=a.getSelection(!0),g=a.getText(),h=g.lastIndexOf(" ",f.end-2),i=g.lastIndexOf("	",f.end-2),j=g.lastIndexOf("\n",f.end-2);e=h>i&&h>j?h:i>h&&i>j?i:j>h&&j>i?j:-1;var k,l,n="",o=!1;if(-1!==e){k=f.end-2-e;var q=g.substr(e+1,k);n=p.clean(q),q.length!==n.length?(o=!0,l=n.length>0?n.length:0):o=!1}else{k=g.trim().length;var q=g.trim();n=p.clean(q),q.length!==n.length?(o=!0,l=n.length>0?n.length:0):o=!1}var r="space";b!==c&&b===!0?r="tab":d!==c&&d===!0&&(r="enter"),o?m.ctrl.setSpaceSeperatedContent(n,!0,f.start-1-k,f.start,o,l,r):m.ctrl.setSpaceSeperatedContent(n,!0,f.start,c,o,c,r)},m.ctrl.setContents=function(b){a.setContents(b)},m.ctrl.updateContents=function(b){a.updateContents(b)},m.ctrl.getContents=function(){return a.getContents()},m.ctrl.getContentsFromIndices=function(b,c){return a.getContents(b,c)},m.ctrl.disable=function(){a.editor.disable();var b=a.modules["link-tooltip"];b&&b.hideTooltip()},m.ctrl.enable=function(b){if(a.editor.enable(),b){a.focus(!0);var c=m.ctrl.getEditorText().length;a.setSelection(c,c)}},m.ctrl.getSelection=function(){return a.getSelection()},m.ctrl.focus=function(){a.focus()},m.ctrl.hasFocus=function(){return a.hasFocus()},m.ctrl.blur=function(){$("#bogus-element").focus(),$("#bogus-element").blur()},m.ctrl.resize=function(b){var c=a.getModule("resize");c.options.minHeight=b.min,c.options.maxHeight=b.max,c.update(),$(c.element).scrollTop(c.element.scrollHeight)},m.ctrl.getRootElement=function(){return a.root},m.ctrl.getContainerElement=function(){return a.container},m.ctrl.setSelection=function(b,c){if(b&&b.hasOwnProperty("start")&&b.hasOwnProperty("end")){var d=a.getText().length;d<b.start&&(b.start=d-1),d<b.end&&(b.end=d-1),a.setSelection(b.start,b.end,c)}},m.ctrl.emoji={_module:function(){a.onModuleLoad("emoji",function(a){setTimeout(function(){m.ctrl.emoji._module=a},0)})}(),set:function(b){var c=a.root.scrollHeight;m.ctrl.emoji._module.setEmoji(b);var d=a.root.scrollHeight;d>c&&(a.root.scrollTop+=d-c)},focus:function(){var b=a.root.scrollTop;m.ctrl.focus(),a.root.scrollTop=b}},m.ctrl.getLeafForIndex=function(b){var c=a.editor.doc.findLeafAt(b);return c&&c.length?c[0].node:null},m.ctrl.getLineForIndex=function(b){var c=a.editor.doc.findLineAt(b);return c&&c.length?c[0].node:null},m.ctrl.getBounds=function(b){return a.editor.getBounds(b)},m.ctrl.getHTML=function(){return a.getHTML()},m.ctrl.getText=function(b,c){return a.getText(b,c)},m.ctrl.initialized=!0,"function"==typeof m.ctrl.editorInitialized&&m.ctrl.editorInitialized(),a.on("selection-change",function(a){a?a.start!=a.end&&(I=!0):!F&&f.cnvTextEditorOnFocusOut&&(d.$$phase||"$apply"==d.$root.$$phase||"$digest"==d.$root.$$phase||d.$apply(function(){d.onFocusOut({event:{}})}))}),a.on("text-change",t),a.root.addEventListener("keyup",function(b){if(b.keyCode==j.SPACE){var c=h();if(c&&B){var e;0==/\s/.test(a.getText().trim())&&(e=0),d.$apply(function(){d.onUrlAdded(r(c,c,e))})}f.cnvTextEditorOnSpaceKeyPress&&d.$apply(function(){d.onSpaceKeyPressInTextEditor()})}else if(b.keyCode==j.ESCAPE)(1==d.escapeKeyDown||n.IS_WINDOWS)&&(f.cnvTextEditorOnEscKeyPress&&d.$apply(function(){d.onEscKeyPress()}),d.escapeKeyDown=!1);else if(b.keyCode==j.ENTER)f.cnvTextEditorOnEnterKeyPress&&d.$apply(function(){d.onEnterKeyPressInTextEditor()});else if(b.keyCode==j.TAB){a.getSelection(!0);f.cnvTextEditorOnTabKeyPress&&d.$apply(function(){d.onTabKeyPressInTextEditor()})}}),a.root.addEventListener("blur",function(a){d.$emit("cnvEditor::editorRootBlur",a)}),(g.isFirefox()||g.isIE())&&a.root.addEventListener("keydown",function(b){var c=a.root.ownerDocument.getSelection();if(c.isCollapsed&&c.focusNode.parentNode.nodeName.toLowerCase()===k.ANCHOR&&c.focusNode.nodeName.toLowerCase()===k.TEXT&&(c.focusNode.textContent.length===c.focusOffset||0===c.focusOffset)){var d=c.getRangeAt(0),e=d.startContainer.parentNode.parentNode,f=e.childNodes,g=document.createRange(),h=0;if(0===c.focusOffset)for(;f[h]!==d.startContainer.parentNode;)++h;else do++h;while(f[h-1]!==d.startContainer.parentNode);g.setStart(e,h),g.setEnd(e,h),c.removeAllRanges(),c.addRange(g)}},!0),a.root.addEventListener("keydown",function(b){if(b.keyCode==j.SAVE||b.keyCode==j.BACKSPACE||b.keyCode==j.LEFT||b.keyCode==j.RIGHT||b.keyCode==j.TAB||b.keyCode==j.ENTER||b.keyCode==j.DELETE){var e=!1,i=b.shiftKey||b.altKey||b.ctrlKey||b.metaKey,l=a.getSelection();if(b.keyCode==j.ENTER)a.flags.dropdownVisible||(h(!0),f.cnvTextEditorSubmitOnEnter&&(i?(a.insertText(a.getSelection().start,"\n",c,"user"),a.root.scrollTop=a.root.scrollTop+28):d.$apply(function(){d.submitOnEnter()}),e=!0),f.cnvTextEditorOnCtrlOrCmdEnterPress&&(b.ctrlKey||b.metaKey)?(d.$apply(function(){d.onCtrlOrCmdEnterPress()}),e=!0):f.cnvTextEditorOnEnterPress&&(d.$apply(function(){d.onEnterPress()}),e=!0));else if(b.keyCode==j.SAVE)f.cnvTextEditorOnCtrlOrCmdSavePress&&(b.ctrlKey||b.metaKey)&&(d.$apply(function(){d.onCtrlOrCmdSavePress()}),e=!0);else if(b.keyCode==j.BACKSPACE){var m=a.root.ownerDocument.getSelection().focusNode,n=a.root.ownerDocument.getSelection().focusOffset,o=null;if(m&&(m.parentNode.nodeName.toLowerCase()===k.ANCHOR?o=m.parentNode:m.previousSibling&&m.previousSibling.nodeName.toLowerCase()===k.ANCHOR&&!n&&(o=m.previousSibling),o&&-1!=o.className.indexOf(v.AT_MENTION_DOM_CLASSES.MENTION)&&l&&l.start==l.end)){var p={id:o.className.split(" ").pop()};a.once("text-change",function(b,c){a.root.querySelector("."+p.id)||d.$apply(function(){d.onAtMentionRemoved({item:p})})});var q=a.getSelection(),r=a.getText();r=r.replace(/\s/g," ");var s=Math.max(r.lastIndexOf(" ",q.start),r.lastIndexOf("@",q.start));s==q.start&&(s=Math.max(r.lastIndexOf(" ",q.start-1),r.lastIndexOf("@",q.start-1)));var t=q.start;a.deleteText(s,t,"user"),e=!0}if(l&&l.start==l.end){var r=a.getText();g.containsSurrogatePair(r.substr(l.start-1,1))&&setTimeout(function(){var b=a.getSelection();a.deleteText(b.start-1,b.start,Quill.sources.USER)},0)}}else if(b.keyCode==j.DELETE){if(l&&l.start==l.end){var r=a.getText();g.containsSurrogatePair(r.substr(l.start,1))&&setTimeout(function(){var b=a.getSelection();a.deleteText(l.start,b.start+1,Quill.sources.USER)},0)}}else if(b.keyCode!=j.LEFT||i)if(b.keyCode!=j.RIGHT||i)b.keyCode==j.TAB&&(f.cnvTextEditorOnShiftTabPress&&b.shiftKey?(d.onShiftTabPress(),
e=!0):f.cnvTextEditorOnTabPress&&(e=0==$(".rte-autocomplete").length,e&&d.onTabPress()));else{var m=a.root.ownerDocument.getSelection().focusNode,n=a.root.ownerDocument.getSelection().focusOffset,o=null;if(m&&(m.parentNode.nodeName.toLowerCase()===k.ANCHOR?o=m.parentNode:m.previousSibling&&m.previousSibling.nodeName.toLowerCase()===k.ANCHOR&&!n&&(o=m.previousSibling),o&&-1!=o.className.indexOf(v.AT_MENTION_DOM_CLASSES.MENTION))){var r=a.getText();r=r.replace(/\s/g," ");var q=a.getSelection(),s=r.indexOf(" ",q.start+1);s=0>s?a.getLength():s;var t=s;a.setSelection(s,t),e=!0}}else{var m=a.root.ownerDocument.getSelection().focusNode,n=a.root.ownerDocument.getSelection().focusOffset,o=null;if(m&&(m.parentNode.nodeName.toLowerCase()===k.ANCHOR?o=m.parentNode:m.previousSibling&&m.previousSibling.nodeName.toLowerCase()===k.ANCHOR&&!n&&(o=m.previousSibling),o&&-1!=o.className.indexOf(v.AT_MENTION_DOM_CLASSES.MENTION))){var r=a.getText();r=r.replace(/\s/g," ");var q=a.getSelection(),s=r.lastIndexOf(" ",q.start-1)+1;if(s!=q.start){s=0>s?0:s;var t=s;a.setSelection(s,t),e=!0}}}if(e)return b.preventDefault(),b.stopImmediatePropagation(),!1}}),$(a.root).on("mousewheel",i)}},paste:{pastePreProcess:function(a){if("true"==H.root.contentEditable){var b,c=j.parseUrl(a),e=null;if(c)e={title:c.title||a,href:j.linkToConvoColonUrl(c,!0)},e.scrybe_link=!0;else{var f=a.slice().trim().replace(/<\/?[^>]+(>|$)/g,"").trim();g.isValidUrl(f)&&(c=j.parseUrl(f),c?(e={title:c.title||f,href:j.linkToConvoColonUrl(c,!0)},e.scrybe_link=!0):(e={title:f,href:f.match(/^[a-zA-Z]+:/)?f:"http://"+f},b=H.getText().trim().length))}if(F=!0,setTimeout(function(){setTimeout(function(){F=!1},0)},0),e){var h=H.getSelection(),i=h&&h.start||0;e.href=e.href.trim().replace(/\'/g,"%27").replace(/amp;/g,"&"),H.insertText(i,e.title,{link:e.href},"user");var k=0,l=0;return h=H.getSelection(),h&&(k=h.start,l=h.end),H.insertText(k," ",{},"user"),k!=l&&H.deleteText(k,l,"user"),d.$apply(function(){d.onUrlAdded(r(e.href,e.title,b))}),!1}}},pastePostProcess:function(a,b){var c=H.getHTML(),e=p.cleanFromHTMLText(c),b=H.getSelection(!0);m.ctrl.setContentWithCursorAtSpecificPosition(e,b.start);var h=$(H.root).find("a");if(h.length){var i=new RegExp("/^(https?://[a-z]?links."+g.escapeRegexChars(n.HOST_DOMAIN)+"/)(.*)","i"),b=H.getSelection();h.length;h.each(function(a){var b=$(this);if("A"!==b.prop("tagName")||!b.hasClass(v.AT_MENTION_DOM_CLASSES.MENTION)){var c=b.attr("href");if(c){var e=c.replace(i,"convo:/$2").replace(new RegExp(n.APP_BASE_URL+"#","i"),"convo:"),g=j.parseUrl(c),h=b.text();if(g&&g.type===j.FILTER_LINK){var l=null;if(g.filter&&1==g.filter.filters.length){var m=g.filter.filters[0];(m.type==k.TO||m.type==k.FROM)&&(l=v.getPublishableUserListItem(m.value)||v.getPublishableGroupListItem(m.value)||null)}var o=H.editor.selection._positionToIndex(b[0],0),p=o+H.editor.selection._encodePosition(b[0])[1];H.deleteText(o,p,"user"),l?H.insertText(o,h,{link:e.trim().replace(/\'/g,"%27"),addclass:v.AT_MENTION_DOM_CLASSES.MENTION+" "+v.AT_MENTION_DOM_CLASSES.MARKER+" "+l.id},"user"):H.insertText(o,h,{link:e.trim().replace(/\'/g,"%27")},"user"),l&&f.cnvOnAtMentionAdded&&d.$apply(function(){d.onAtMentionAdded({item:l})})}else b[0].setAttribute("href",e.trim())}}})}}}}};("full"==w||"basic"==w||"minimal"==w)&&(G.modules.mention={queryBy:"label",delay:100,delimiter:["@",":"],source:function(a,b,c){d.atMentionsSource({$query:a,delimiter:c}).then(function(a){b(a)})},insert:function(b,e){if(b.hasOwnProperty("type")&&"cmd"==b.type){var f=e.split(" ");f.shift(),f=f.join(" "),d.$apply(function(){d.onCommandExecuted({item:b,search:f})})}else!b.hasOwnProperty("type")||"USER"!=b.type&&"GROUP"!=b.type&&"CONTACT"!=b.type||(d.$apply(function(){d.onAtMentionAdded({item:b})}),a.setTimeout(function(){t(c,c,!0)},0));return b.hasOwnProperty("type")&&"EMOJI"==b.type&&o.updateFrequentEmojiData(b.short_name),b.label+="",{id:b.id,type:b.type,unicode:b.unicode,href:"convo:"+h(b.id,b.type,!0).slice(1),value:"@"+b.label,classes:v.AT_MENTION_DOM_CLASSES.MENTION+" "+v.AT_MENTION_DOM_CLASSES.MARKER+" "+b.id}},render:function(a){var b="USER"==a.type?-1!=a.imgurl.indexOf("user-images/default-user/thumbnails/")?'<span style="height:32px; width:32px; font-style: normal; line-height:32px; font-size: inherit; text-align: center; border-radius: 100%; background-color:'+g.stringToColor(a.label)+'">'+g.initials(a.label)+"</span>":'<img src="'+a.imgurl+'" class="usr-img-32 img-circle"/>':'<span style="height:32px; width:32px; font-style: normal; line-height:32px; font-size: inherit; text-align: center; border-radius: 4px; background-color:#fff; color:#7b8386">. .</span>';return"cmd"==a.type&&(b='<div style=" background-color:#fff; border-radius:50%; overflow: hidden;"><img src="'+a.imgurl+'" class="usr-img-32 '+a.imgClasses+'"/></div>'),"EMOJI"==a.type&&(b=a.render),'<li class="dropdown-item-cont"><a href="javascript:;"><div class="img-label-list-item"><cnv-user-profile-image class="single-user '+a.classes+'" width="60" height="60">'+b+"</cnv-user-profile-image><span>"+("EMOJI"===a.type?a.formattedlabel:i("escapeHtmlXSS")(a.formattedlabel))+'</span><span class="sec-label">'+("EMOJI"===a.type?a.formatteddesclabel:i("escapeHtmlXSS")(a.formatteddesclabel))+"</span>"+(a.invited?'<status class="list-item-status light">Invited</status>':"")+"</div></a></li>"}}),("full"==w||"basic"==w)&&(G.modules.hashtag={queryBy:"label",delay:250,source:function(a,b,c){f.cnvHashtags&&d.hashtagSource({$query:c+a}).then(function(a){b(a)})},insert:function(a){if(!($.trim(a.label).length<2)){var b=a.label.slice(1);if(b&&/[a-zA-Z]+/.test(b)){d.$apply(function(){d.onHashTagAdded({item:a})});var c=a.label;return{value:c,classes:"cnv-hashtag"}}}},render:function(a){var b;return b=a.stag?'<li class="dropdown-item-cont"><a class="shashtag-dropdown-item-text" href="javascript:;">'+i("escapeHtmlXSS")(a.formattedlabel)+"</a></li>":'<li class="dropdown-item-cont"><a href="javascript:;">'+i("escapeHtmlXSS")(a.formattedlabel)+"</a></li>"}});var H=new Quill("#"+C,G);"full"==w&&x&&document.getElementById(x)&&(setTimeout(function(){H.addModule("toolbar",{container:"#"+x})},0),H.onModuleLoad("toolbar",function(a){function b(a){return H.focus(),s(H),a.stopImmediatePropagation(),a.preventDefault(),!1}function c(a){var b=$(H.root).scrollParent()[0],c={editorScrollParentPos:b.scrollTop,editorScrollPos:H.root.scrollTop};setTimeout(function(){b.scrollTop=c.editorScrollParentPos,H.root.scrollTop=c.editorScrollPos},0)}function d(a){a.preventDefault()}function e(){a.container.querySelector(".ql-inline-link").removeEventListener("click",b),a.container.removeEventListener("click",c,!0),a.container.removeEventListener("mousedown",d,!0)}var f=$(a).find(".ql-color.ql-picker.ql-color-picker"),g=f.find(".ql-picker-label");g.append("<i></i>"),f.find(".ql-picker-options").mouseup(function(){g.css({"background-color":g.attr("data-value")})}),a.container.querySelector(".ql-inline-link").addEventListener("click",b),a.container.addEventListener("click",c,!0),a.container.addEventListener("mousedown",d,!0),H.__nuke__._unregister_EventListeners=e})),("full"===w||"basic"===w||"minimal"===w)&&(setTimeout(function(){H.addModule("link-tooltip",{maxLength:60,offset:10,template:'<a href="#" style="display: inline-block;text-overflow: ellipsis; overflow: hidden; vertical-align: middle;" class="url" target="_blank" href="about:blank"></a><input style="word-break: break-all;" class="input" type="text">&nbsp;&nbsp;<a href="javascript:;" class="change">&nbsp;&nbsp;Change&nbsp;&nbsp;</a><a href="javascript:;" class="link-tooltip-remove">&nbsp;&nbsp;Remove&nbsp;&nbsp;</a><a href="javascript:;" class="done">&nbsp;&nbsp;Done</a>'})},0),H.onModuleLoad("link-tooltip",function(b){function c(a){27==a.keyCode&&(d.escapeKeyDown=!0),(a.ctrlKey||a.metaKey)&&a.keyCode==i.K&&(s(H),a.preventDefault())}function e(a){var c=a.target,d=$(c).closest(b.container);return d.length?void 0:(b.hideTooltip(),document.removeEventListener("click",e),a.stopImmediatePropagation(),a.preventDefault(),!1)}function f(){document.removeEventListener("click",e)}var h=H.root,i={K:75};H.modules["link-tooltip"].constructor.hotkeys.LINK.key="";var k=H.modules["link-tooltip"].setMode,l=H.modules["link-tooltip"].show;b.hideTooltip=function(){b.container.style.left="-10000px"},H.modules["link-tooltip"].savingUrl=function(a){return j.parseUrl(a)?"convo:"+a.slice(a.indexOf("#")+1):a},H.modules["link-tooltip"].setMode=function(a,c){var e=null,f=!0;return a&&(e=j.parseUrl(a)),"Chat"===d.cnvEditorSource?f=!1:e&&(e.type===j.FILTER_LINK?f=!1:e.type===j.RESOURCE_LINK&&(a=a.replace(g.getAppUrlRegex1(),"#"))),"http:"===a&&(f=!1,setTimeout(function(){b.removeLink(H.getSelection())},0)),f?(b.textbox.style.width=b.link.offsetWidth+"px",k.bind(b)(a,c)):void 0},H.modules["link-tooltip"].show=function(c){var f=null,g=!0;if(c.href&&(f=j.parseUrl(c.href)),"Chat"===d.cnvEditorSource?g=!1:f&&f.type===j.FILTER_LINK&&(g=!1),g&&"A"===c.nodeName){var h=c.text;if(0===h.indexOf("#")&&0===c.href.indexOf("javascript:"))g=!1;else{var i=H.root.ownerDocument.getSelection();(0===i.focusOffset||i.focusOffset===h.length)&&(g=!1,b.hideTooltip())}}if(g){l.bind(b)(c);b.link.style.width="initial";var k=b.container.getBoundingClientRect(),m=k.left+k.width-$(a).width();m>0&&(b.link.style.width=b.link.offsetWidth-m-16+"px"),"Comment"===d.cnvEditorSource&&"0px"==b.container.style.top&&(d.ctrl.editComment?b.container.style.top="36px":b.container.style.top="-36px"),n.IS_MENULET||(document.removeEventListener("click",e),document.addEventListener("click",e))}},H.__nuke__._unregister_document_EventListeners=f,n.IS_MENULET||h.addEventListener("keydown",c,!0)})),H.onModuleLoad("paste-manager",function(a){function b(){g=f.scrollTop,d=c.scrollTop,e=!0}var c=H.root,d=0,e=!1,f=$(c).scrollParent()[0],g=0;c.addEventListener("paste",b,!0),H.__nuke__._unregisterEditorRootEvents=function(){c.removeEventListener("paste",b,!0)},H.on("selection-change",function(){if(e){f.scrollTop=g,c.scrollTop=d,e=!1;var a=function(a){return f.scrollTop=g,c.scrollTop=d,a.preventDefault(),a.stopImmediatePropagation(),!1};f.addEventListener("scroll",a,!0),setTimeout(function(){f.removeEventListener("scroll",a,!0)},0),H.root.scrollHeight>H.root.clientHeight&&setTimeout(function(){var a=H.getSelection();if(a){var b=H.editor.doc.findLineAt(a.start)[0];lineOffset=b.node.offsetTop+$(b.node).height(),lineOffset>H.root.scrollTop+H.root.clientHeight&&(H.root.scrollTop=lineOffset-H.root.clientHeight)}},0)}})});var I=!1;d.$on("$destroy",function(){m.ctrl.collaboration&&m.ctrl.collaboration.initialized&&m.ctrl.collaboration.dispose();for(var a in H.__nuke__)H.__nuke__.hasOwnProperty(a)&&(H.__nuke__[a](),H.__nuke__[a]=null);f.cnvTextEditorOnDestroy&&d.onEditorDestroy(),f.cnvTextEditorOnFocusOut&&d.onFocusOut({event:{}}),m.ctrl.captureEvents&&m.ctrl.captureEvents.off(),m.ctrl.destroy.flush=!0;for(var b in m.ctrl)m.ctrl[b]=null;$(H.root).off(),$(H.container).off(),H.destroy(),H.__nuke__=null,H.editor=null,H=null,m.ctrl.initialized=!1,G.modules.setup=null,G.modules.paste=null,G.modules.resize=null,G.modules.mention=null,G.modules.hashtag=null,G.modules=null,G=null,m.ctrl=null,$(e).remove(),D=null})}},controller:["$scope",function(a){this.ctrl=a.ctrl,this.ctrl||(this.ctrl={}),this.ctrl.getEditorHtmlText=null,this.ctrl.getEditorText=null,this.ctrl.setContent=null,this.ctrl.clearContent=null}]}}]),b.module("convoApp").factory("config",["$window",function(a){var b={};_.extend(b,Backbone.Events),b.APP_VERSION=a.com_convo.clientVersion,b.CLIENT_APP_VERSION="2018.05.24.01",b.VENDOR_VERSION="2017.05.16.01",b.VENDOR_GALLERY_VERSION="2017.04.04.01",b.IS_NATIVE=!1,b.IS_WINDOWS=!1,b.IS_MAC=!1,b.IS_MENULET=!1,b.IS_DEV=!1,b.ANALYTICS_CALL_TIMEOUT=18e4,b.DEBUG_BAR=!0,b.setClientType=function(){b.CLIENT_TYPE=b.IS_NATIVE||b.IS_MENULET?"p2":"w2",b.trigger("clientTypeUpdated")},b.setClientType(),b.FACEBOOK_APP_ID="724834957650563",b.LINKEDIN_API_KEY="77qzs1o9i931no",b.APPEARIN_VIDEO_CALL_DIRECT_LINK_PREFIX="https://appear.in/",b.COMPACT_VIEW_UNSCALED_WIDTH=690;var c=location.host.split("."),d=c.slice(Math.max(c.length-2,1));b.WHITELIST_URLS_REGEX="(https?:\\/\\/.*\\."+d[0]+"\\.com\\/app\\/integrations\\/connect\\/splash\\.php.*|https?:\\/\\/.*\\."+d[0]+"\\.com\\/app\\/contacts\\/ImportGmailContacts\\.php.*|https?:\\/\\/.*\\.convo\\.com\\/app\\/oauth2_client\\/google\\/splash\\.php.*|https?:\\/\\/.*\\.convo\\.com\\/app\\/oauth2_client\\/facebook\\/splash\\.php.*|https?:\\/\\/.*\\.convo\\.com\\/app\\/oauth2_client\\/twitter\\/splash\\.php.*|https?:\\/\\/.*\\.convo\\.com\\/app\\/oauth2_client\\/dropbox\\/splash\\.php.*|https?:\\/\\/.*\\.convo\\.com\\/app\\/oauth2_client\\/box\\/splash\\.php.*|https?:\\/\\/.*\\."+d[0]+"\\.com\\/app\\/integrations\\/connect\\/splash\\.php.*|https?:\\/\\/.*\\."+d[0]+"\\.com\\/app\\/hybridauth\\/twitter\\.php.*|https?:\\/\\/www\\.facebook\\.com\\/.*\\/dialog\\/oauth.*|https?:\\/\\/platform\\.linkedin\\.com\\/js\\/.*|https?:\\/\\/www\\.dropbox\\.com\\/chooser.*|https?:\\/\\/app.box.com\\/index\\.php\\?rm=box_select_view.*|https?:\\/\\/accounts\\.google\\.com\\/o\\/oauth2\\/auth.*|https?:\\/\\/.*\\.convo\\.com\\/app\\/oauth2_client\\/o365\\/splash\\.php.*)",b.API_VERSION="v1",b.FEED_SERVICES_VERSION="20150918",b.XMPP_SERVER="bosh.convo.com",b.XMPP_DOMAIN="xmpp.convo.com",b.SECURE_COMM=!0,b.DOMAIN_NAME_FOR_SUBDOMAINS_GENERATION="convo.com",b.WEBSITE_DOMAIN="https://www.convo.com/",b.HOST_DOMAIN=d[0]+"."+d[1],b.APP_DOMAIN=location.protocol+"//"+location.host,b.APP_BASE_URL=location.protocol+"//"+location.host+location.pathname,b.FLEX_APP_URL="https://app.convo.com/web/",b.CONVO_LINKS_BASE_URL="http://links.convo.com",b.HTML_APP_DOWNLOAD_URL=b.APP_DOMAIN+"/app/app_download.php",b.LOGIN_URL="/app/login/",b.LOGOUT_URL=b.LOGIN_URL+"?logout=1",b.TWO_FACTOR_AUTH_URL=b.APP_BASE_URL+"mfa/#/",b.AWS_FILE_DIR_BASE="https://fs1.app.convo.com/api/"+b.API_VERSION+"/files/",b.AWS_FILE_DIR_BASE_FOR_NO_AUTH="https://app.convo.com/api/"+b.API_VERSION+"/files/",b.AWS_FILE_DIR_NUM_SUBDOMAINS=5,b.getLoadBalancedAwsFileDirBase=function(a){return"https://fs"+Math.abs(a%b.AWS_FILE_DIR_NUM_SUBDOMAINS-b.AWS_FILE_DIR_NUM_SUBDOMAINS)+".app.convo.com/api/"+b.API_VERSION+"/files/"},b.GOOGLE_SPLASH_URL="https://api.convo.com/app/oauth2_client/google/splash.php",b.TWITTER_SPLASH_URL="https://api.convo.com/app/oauth2_client/twitter/splash.php",b.DROPBOX_SPLASH_URL="https://api.convo.com/app/oauth2_client/dropbox/splash.php",b.BOX_SPLASH_URL="https://api.convo.com/app/oauth2_client/box/splash.php",b.FACEBOOK_SPLASH_URL="https://api.convo.com/app/oauth2_client/facebook/splash.php",b.O365_SPLASH_URL="https://api.convo.com/app/oauth2_client/o365/splash.php",b.TWITTER_PIC_POPUP_URL=b.APP_DOMAIN+"/app/hybridauth/twitter.php",b.WEBSITE_TERMS_BILLING_PAGE="https://www.convo.com/terms/billing/",b.INTERCOM_IO_APP_ID="hb2ontzy",b.GOOGLE_MAPS_API_KEY="AIzaSyC764tr6nZnnVR0no-hgsiqCHGQHmaNrQU",b.GOOGLE_MAPS_URL="https://maps.googleapis.com/maps/api/js?key=",b.REST_URL="/api/"+b.API_VERSION+"/",b.FEED_REST_URL="/index_services_"+b.FEED_SERVICES_VERSION+"/scrybe/",b.NUM_APP_SERVER_SUBDOMAINS=10,b.IS_DEV&&(b.NUM_APP_SERVER_SUBDOMAINS=1);var e=function(){var c=location.protocol,d=location.host;if(a.com_convo.config.dontUseShardedDomains)return[c+"//"+d];if(d=b.DOMAIN_NAME_FOR_SUBDOMAINS_GENERATION,b.IS_DEV)return["https://perf17.convoapps.com"];for(var e=[],f=0;f<b.NUM_APP_SERVER_SUBDOMAINS;f++)e.push(c+"//app"+(f+1)+"."+d);return e}();if(b.getAppServerSubdomains=function(){return e},!b.IS_DEV){for(var f={},g=0;g<e.length;g++)f[e[g]]="/app/xd/proxy-v1.html";a.xdomain.slaves(f)}return b}]),b.module("convoApp").constant("FeedActionTypes",{ADDED:"ADDED",UPDATED:"UPDATED",DISCUSSION:"DISCUSSION"}),b.module("convoApp").directive("cnvFeed",["$rootScope","$window","logger","utils","perf","appStateInfo","Feed","resourcesTabsManager",function(d,e,f,g,h,i,j,k){return{restrict:"AE",priority:0,scope:!1,compile:function(b,d,f){return function(b,d,f,g){function h(a){return d[0].contains(a)}function i(a,b){if($("body").css({overflow:"hidden","overflow-x":"hidden","overflow-y":"hidden"}),b)s.scrollTop(0),k();else{var c=q;r=!0,s.scrollTop(c),setTimeout(function(){r=!1,s.scrollTop(c)},10)}}function k(){if(!b.tab.selected||r)return!0;var a=!1;b.documentHeight=s[0].scrollHeight,b.cachedFeedItemViews||(b.cachedFeedItemViews=d.find('cnv-feed-item[hasFiles="true"]'),b.cachedElementPositions=[],a=!0);for(var c,e=b.cachedFeedItemViews,f=null,g=null,h=null,i=0,k=0,l=!1,m=0,n=e.length,o=b.feed_data.feed_ids_map;n>m;m++){if(c=b.cachedElementPositions[m],!c){if(c={},c.scopes=[],f=$(e[m]),g=f.attr("id"),h=o[g],h&&(h.hasGifsInReel&&c.scopes.push(h.imagesScope),h.hasGifsInComment&&h.commentScopes))for(var p in h.commentScopes)c.scopes.push(h.commentScopes[p]);c.scopes.length>0?(c.hasScopes=!0,c.isHidden=!0,c.top=f.position().top,c.height=f.height()):c.hasScopes=!1,b.cachedElementPositions[m]=c}if(c.hasScopes)if(i=c.top,k=c.height,l=c.isHidden,i+k+400>b.scrollTop&&i<b.scrollTop+b.windowHeight+400){if(l||a){for(var t=0;t<c.scopes.length;t++)c.scopes[t]&&c.scopes[t].reloadImages();b.cachedElementPositions[m].isHidden=!1}}else if(!l||a){for(var t=0;t<c.scopes.length;t++)c.scopes[t]&&c.scopes[t].unloadImages();b.cachedElementPositions[m].isHidden=!0}}var u=b.scrollTop+b.windowHeight;u>b.documentHeight-1e3?b.loadMoreFeedOnScrollToBottom():b.scrollTop<=0&&q>0&&!b.isCommentEditingInProgress()&&!b.isVideoFullScreen()&&(b.pollFeed(),b.onFeedScrolledToTop()),b.feedScrolledMoreThanOneFeedItem=b.isFeedScrolledMoreThanOneFeedItem(b.scrollTop),j.setIsFeedScrolledMoreThanOneFeedItem(b.feedScrolledMoreThanOneFeedItem),q=b.scrollTop}function l(){b.windowHeight=s.height(),b.documentHeight=$(document).height()}function m(){null===document.fullscreenElement&&b.onFullScreenExit()}function n(){null===document.mozFullScreenElement&&b.onFullScreenExit()}function o(){null===document.webkitFullscreenElement&&b.onFullScreenExit()}function p(){null===document.msFullscreenElement&&b.onFullScreenExit()}var q=b.scrollTop,r=!1,s=$("#feedScroller");b.scrollTop=0,b.cachedFeedItemViews=null,b.cachedElementPositions=[],b.$watch("server_now_timestamp",function(){e.setTimeout(function(){b.$broadcast("render_date")},0)}),b.getFeed=function(){return b.isMyFeed()?b.my_feed_data.feed_items:b.feed_data.feed_items},b.$on("cnvCommentEditor::deactivated",function(){b.onCommentEditorFocusOut()}),b.$on("cnvCommentEditor::focusOut",function(){b.onCommentEditorFocusOut()}),b.isFeedScrolledMoreThanOneFeedItem=function(a){return a===c&&(a=s.scrollTop()),a>270},b.isUserWritingCommentOnFeedItem=function(a){return b.isCommentEditingInProgress()?document.activeElement===$(".feed-cont",d).find("#"+a+" .ql-editor")[0]:!1},b.isCommentEditingInProgress=function(){var a=document.activeElement&&h(document.activeElement)&&$(document.activeElement).hasClass("ql-editor");return a},b.isAudioPlaying=function(){for(var a=$(".cnv-audio-player",d),b=!1,c=0;c<a.length;c++)if(!a[c].paused){b=!0;break}return a=null,b},b.isVideoPlaying=function(){for(var a=$(".feedVideoPlayer",d),b=!1,c=0;c<a.length;c++){var e=a[c];e.paused||(b=!0)}return $(".videoPlaying",d).length>0&&(b=!0),a=null,b},b.isVideoFullScreen=function(){for(var a=$("video",d),b=!1,c=0;c<a.length;c++){var e=a[c];$(e).height()===screen.height&&(b=!0)}for(var f=$("iframe",d),c=0;c<f.length;c++){var e=f[c];$(e).height()===screen.height&&(b=!0)}return a=null,f=null,b},b.setScrollTopWithoutAnim=function(a){s.scrollTop(a)},b.setScrollTop=function(){s.animate({scrollTop:0},{duration:400,complete:function(){var a=function(a){return a.preventDefault(),a.stopImmediatePropagation(),s.scrollTop(0),!1};s[0].addEventListener("scroll",a,!0),setTimeout(function(){s[0].removeEventListener("scroll",a,!0)},200)}})},b.renderFirst=function(){k()},s.on("scroll",function(a){b.scrollEndTimeout&&clearTimeout(b.scrollEndTimeout),b.scrollEndTimeout=setTimeout(function(){b.scrollTop=s.scrollTop(),k(),b.scrollEndTimeout=null},100)}),a.addEventListener("resize",l,!1),b.windowHeight=s.height(),document.fullscreenEnabled!==c?document.addEventListener("fullscreenchange",m,!1):document.mozFullScreenEnabled!==c?document.addEventListener("mozfullscreenchange",n,!1):document.webkitFullscreenEnabled!==c?document.addEventListener("webkitfullscreenchange",o,!1):document.msFullscreenEnabled!==c&&document.addEventListener("MSFullscreenChange",p,!1),b.$on("activated",i),b.$on("$destroy",function(){s=null,s.off("scroll"),a.addEventListener("resize",l,!1),document.fullscreenEnabled!==c?document.removeEventListener("fullscreenchange",m,!1):document.mozFullScreenEnabled!==c?document.removeEventListener("mozfullscreenchange",n,!1):document.webkitFullscreenEnabled!==c?document.removeEventListener("webkitfullscreenchange",o,!1):document.msFullscreenEnabled!==c&&document.removeEventListener("MSFullscreenChange",p,!1)})}},controller:["$scope","$filter","$interval","$timeout","AppLinks","$location","FiltersQueryTransformer","Filters","FilterTypes","datetimeService","chatService","userInfo","bannerService","Comments","serverPingService","Likes","appTabs","alertsService","accountInfo","config","filterInfo","usersGroupsListProvider","Group","User","connectivity","appsInfo","feedToggleService","advSearchService",function(d,f,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){function L(){return{feed_items:[],feedItemsPendingMerge:[],num_displayed:0,all_fetched:!1,fetching:!1,feed_ids_map:{},feedItemsUpdatesAvailable:0,isTextSearch:!1,isFirstFeedFetchDone:!1,staggeredFetchingIntervalId:c}}function M(){ab===_a?qa():N()}function N(a,b,e,f,g,i){if(h.recordMeasure("fetch called"),a||d.feed_data!==fb){a||(a=d.feed_data),b||(b=Ya),d.hasHiddenItems&&setTimeout(function(){d.hasHiddenItems=!1,d.showLoadingSpinner=!1,d.cachedFeedItemViews=null,d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest()},1);var k=a.feed_items.length;if(!(a.fetching||!d.tab.selected&&k>10||a.all_fetched)){a.fetching=!0,d.showLoadingSpinner=!0,f||d.$$phase||(d.cachedFeedItemViews=null,d.$digest());var l=a.feedItemsPendingMerge,m=l.length;if(m>0)for(var n,o=a.feed_ids_map,p={},q=0;m>q;q++)n=l[q].feed_id,p.hasOwnProperty(n)||(p[n]=!0,o.hasOwnProperty(n)||k++);i===c&&(i=0),(g===c||g!==k)&&(i=0),j.fetchFeed(k+i,b,kb,lb,mb).then(function(b){h.recordMeasure("cnvFeed.controller GOT FEED"),a.fetching=!1;var e=b.data,g=e.feed_items,j=b.status,l=g.length;if(d.showLoadingSpinner=!1,f&&d.$broadcast("render:boRepeat:feedItems"),200==j&&g&&l>0){var m=0,n=function(){for(;g.length;)O(a,g.shift(),mb)&&m++;var b=d.scrollTop+d.windowHeight;b>tb[0].scrollHeight-1e3||a.feed_items.length<10?(d.cachedFeedItemViews=null,d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest(),setTimeout(function(){a===db&&jb||(0===m?N(a,c,c,c,k,i+1):N(a))},100)):d.hasHiddenItems=!0};0!=a.feed_items.length||qb?n():(O(a,g.shift(),mb)&&m++,g.length>0&&O(a,g.shift(),mb)&&m++,d.cachedFeedItemViews=null,d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest(),setTimeout(function(){h.recordMeasure("*********************** rendered ***********************"),n(),qb||setTimeout(function(){qb||(qb=!0,d.$emit("cnvFeed::firstFeedRenderStart"))},100)},100)),a.isFirstFeedFetchDone||(a.isFirstFeedFetchDone=!0),a.all_fetched=!1,Ya>l&&(a.all_fetched=!0)}else if(204==j)a.all_fetched=!0;else if(200!=j){var o=d.scrollTop+d.windowHeight;o>tb[0].scrollHeight-600&&setTimeout(function(){N(a)},500)}else a.all_fetched=!0},function(b){a.fetching=!1})}}}function O(a,b,c){var d=a.feed_ids_map,e=a.feed_items;return d[b.feed_id]?!1:(b._actions={},Ca(b,a),e.push(b),d[b.feed_id]=b,a.num_displayed++,!0)}function P(a,c,e){if(cb)return void rb.markOccurrence();cb=!0,rb.clear();var f=b.copy(kb),g=j.pollFeed(bb,f,lb,mb);g.then(function(a){if(a=a.data,cb=!1,bb=a.last_feed_poll_timestamp,a.feed_items&&a.feed_items.length>0){db.feedItemsPendingMerge=db.feedItemsPendingMerge.concat(a.feed_items),2!==db.feedItemsUpdatesAvailable&&(db.feedItemsUpdatesAvailable=0);var c=Q(db);c.updatesFromOtherUsers&&d.$emit("feedUpdatesFromOtherUsersReceived"),setTimeout(function(){d.cachedFeedItemViews=null,d.renderFirst()},1),d.feed_data===fb&&Na(),ab!==_a||jb||(Ua.feedItemsPendingMerge=Ua.feedItemsPendingMerge.concat(a.feed_items),Q(Ua,!0))}else!db.feedItemsUpdatesAvailable&&db.feedItemsPendingMerge.length>0&&Q(db);if(jb&&b.equals(kb,f)){var e=da(r.IN,r.IN_TRASH);if(a.filter_feed_items&&a.filter_feed_items.length>0?(eb.feedItemsPendingMerge=eb.feedItemsPendingMerge.concat(a.filter_feed_items),2!==eb.feedItemsUpdatesAvailable&&(eb.feedItemsUpdatesAvailable=0),Q(eb,!1,e),ab===_a&&(Ua.feedItemsPendingMerge=Ua.feedItemsPendingMerge.concat(a.filter_feed_items),Q(Ua,!0,e))):!eb.feedItemsUpdatesAvailable&&eb.feedItemsPendingMerge.length>0&&Q(eb,!1,e),a.feed_items&&a.feed_items.length>0){for(var g=[],h=[],i=a.feed_items,j=i.length,k=0;j>k;k++){var l=i[k].action;"DOUBLE_DELETED"===l||2==i[k].deleted?g.push(i[k]):"RESTORED"===l&&h.push(i[k])}if(!u.isAdminMode()&&g.length>0&&e)for(var k=0;k<g.length;k++)T(eb,g[k].feed_id),ab===_a&&T(Ua,g[k].feed_id);if(h.length>0&&e)for(var k=0;k<h.length;k++)T(eb,h[k].feed_id),ab===_a&&T(Ua,h[k].feed_id);if(da(r.IN,r.IN_STARRED))for(var k=0;j>k;k++)0===i[k].starred&&(T(eb,i[k].feed_id),ab===_a&&T(Ua,i[k].feed_id));if(da(r.IN,r.IN_DRAFTS))for(var k=0;j>k;k++)0===i[k].draft&&(T(eb,i[k].feed_id),ab===_a&&T(Ua,i[k].feed_id));d.$broadcast("render:boRepeat:feedItems")}}0!==d.feed_data.feedItemsPendingMerge.length||d.feedScrolledMoreThanOneFeedItem||d.isVideoPlaying()||d.isAudioPlaying()||Y(),ua()},function(a){cb=!1}),c&&v.showBanner_promise(g,"Loading...",null,null,!1,!1,null,700)}function Q(a,b,e){var f={};if(0===a.feedItemsPendingMerge.length)return f;var g=!1,h=!1,i=[],k=u.getUserId(),l=a.feed_ids_map,m=a===d.feed_data,n=0,o="0000-00-00 00:00:00.0";if(a.feed_items.length>0){n=a.feed_items[0].timestamp,o=a.feed_items[0].created_date;for(var p=1;p<a.feed_items.length;p++)a.feed_items[p].timestamp<n&&(n=a.feed_items[p].timestamp,o=a.feed_items[p].created_date)}for(var p=0;p<a.feedItemsPendingMerge.length;p++){var q,r=a.feedItemsPendingMerge[p],s=!1;if(l[r.feed_id]!==c?(s=!0,q=a.feed_items[aa(a.feed_items,"feed_id",r.feed_id)],r._actions=q._actions):r._actions={},"DELETED"===r.action||"DOUBLE_DELETED"===r.action||r.deleted>0)if(e&&(u.isAdminMode()||"DOUBLE_DELETED"!==r.action&&2!=r.deleted))R(a,[r],!1,!0,u.isAdminMode()),a.feedItemsPendingMerge.splice(p,1),p--;else{m&&d.isUserWritingCommentOnFeedItem(r.feed_id)?A.alertModal("","The post you were commenting on has just been deleted by its creator.","Okay",function(){T(a,r.feed_id)}):(T(a,r.feed_id),s&&!q._hide&&Z(a,1));for(var t=a.feedItemsPendingMerge[p].feed_id,v=0;v<a.feedItemsPendingMerge.length;++v)a.feedItemsPendingMerge[v].feed_id===t&&(a.feedItemsPendingMerge.splice(v,1),--v,--p)}else if(r.silent_update_timestamp>r.timestamp)s?("LIKE"===r.action&&r.like_info.liked_by!==k?(r._actions.liked=!0,1===r.like_info.likes_count&&0===r.conversations_count&&(r._actions.firstLike=!0)):(r._actions.liked=!1,r._actions.firstLike=!1),i.push(r)):r.timestamp<n?(a.feedItemsPendingMerge.splice(p,1),p--):"ADDED"===r.action&&r.updated_by!==k&&(g=!0,h=!0);else if("DISCUSSION"!==r.action&&r.updated_by!==k||"DISCUSSION"===r.action&&r.conversations[0].from_user!==k){if(g=!0,s&&"UPDATED"===r.action)i.push(r),(r._actions.updatedByOtherUser_TS===c||r.last_modified_date>r._actions.updatedByOtherUser_TS)&&(r._actions.updatedByOtherUser_TS=r.last_modified_date,r._actions.updatedByOtherUser=!0);else if(s&&"DISCUSSION"===r.action){i.push(r);for(var x,y=r.conversations?r.conversations.length:0,z=0;y>z;z++)if(2!=r.conversations[z].update_kind){x=r.conversations[z];break}x!==c&&(r._actions.unreadComments||(r._actions.unreadComments={}),r._actions.unreadComments_updateTS||(r._actions.unreadComments_updateTS={}),(r._actions.unreadComments_updateTS[x.uid]===c||x.update_timestamp>r._actions.unreadComments_updateTS[x.uid])&&(w.markCommentAsUnread(r.app_instance_id,r.resource_id,x.uid),r._actions.unreadComments_updateTS[x.uid]=x.update_timestamp,r._actions.unreadComments[x.uid]=!0))}!s&&("ADDED"===r.action||r.created_date>o)&&(h=!0)}else("UPDATED"===r.action||"DISCUSSION"===r.action)&&s&&i.push(r)}if(f.updatesFromOtherUsers=g,0===a.feedItemsPendingMerge.length)return 2!==a.feedItemsUpdatesAvailable&&(a.feedItemsUpdatesAvailable=0),m&&d.$broadcast("render:boRepeat:feedItems"),f;d.tab.selected&&(d.feedScrolledMoreThanOneFeedItem=d.isFeedScrolledMoreThanOneFeedItem(),j.setIsFeedScrolledMoreThanOneFeedItem(d.feedScrolledMoreThanOneFeedItem));var B=d.isCommentEditingInProgress(),C=d.isVideoFullScreen();if(!b&&(lb||d.feedScrolledMoreThanOneFeedItem||B||C))sb.markOccurrence({isSearch:lb,isFeedScrolledMoreThanOneFeedItem:d.feedScrolledMoreThanOneFeedItem,isCommentEditingInProgress:B,isVideoFullScreen:C}),i.length>0&&R(a,i,!0),h&&!a.feedItemsUpdatesAvailable&&(a.feedItemsUpdatesAvailable=1,a.feedItemsUpdatesAvailableNotifText="New Posts");else{sb.clear();for(var D=_.values(_.groupBy(a.feedItemsPendingMerge,"feed_id")),E=[],p=0;p<D.length;p++){var F=D[p];E.push({maxTS:F[F.length-1].timestamp,feedItems:F})}E=_.sortBy(E,function(a){return-a.maxTS});for(var p=0;p<E.length;p++)R(a,E[p].feedItems);a.feedItemsPendingMerge=[],a.feedItemsUpdatesAvailable=0}return m&&d.$broadcast("render:boRepeat:feedItems"),f}function R(a,b,c,d,e){for(var f=0;f<b.length;f++){var g=b[f];"DOUBLE_DELETED"===g.action||2==g.deleted?e?S(a,g,c):T(a,g.feed_id):"DELETED"===g.action||1==g.deleted?d?S(a,g,c):T(a,g.feed_id):S(a,g,c)}}function S(a,b,c){var d=a.feed_items,e=a.feed_ids_map,f=b.timestamp,g=0,h=b.feed_id;if(Ca(b,a),b._dirty=!0,e[h]?(g=aa(d,"feed_id",h),b._hide=d[g]._hide,b.last_modified_date>d[g].last_modified_date&&(b._content_updated=!0),d[g]=b):(b._actions._new=!0,d.unshift(b),e[h]=b,a.num_displayed++),!c)if(1==d.length||(0==g||f<=d[g-1].timestamp)&&(g==d.length-1||f>=d[g+1].timestamp));else{d.splice(g,1);for(var i=0,j=0;j<d.length;j++){if(!(f<d[j].timestamp)){i=j;break}i++}d.splice(i,0,b),b._hide&&(b._hide=!1,a.num_displayed++)}}function T(a,b){var c=a.feed_ids_map;if(c[b]){var d=a.feed_items,e=aa(d,"feed_id",b);d[e]._hide||a.num_displayed--,d.splice(e,1),delete c[b]}}function U(a,b){for(var c=a.feed_ids_map,d=a.feed_items,e=a.feedItemsPendingMerge,f={},g=0,h=b.length;h>g;g++)f[b[g]]=!0;for(var g=d.length-1;g>=0;g--){var i=d[g];f.hasOwnProperty(i.feed_id)&&(i._hide||a.num_displayed--,d.splice(g,1),delete c[i.feed_id])}for(var g=e.length-1;g>=0;g--){var i=e[g];f.hasOwnProperty(i.feed_id)&&e.splice(g,1)}0===e.length&&2!==a.feedItemsUpdatesAvailable&&(a.feedItemsUpdatesAvailable=0)}function V(a){W(db,a),W(eb,a),ab===_a&&W(Ua,a)}function W(a,b){var c=a.feed_items;if(0!==c.length){for(var d=[],e={},f=0,g=b.length;g>f;f++)e[b[f]]=!0;for(var f=0,g=c.length;g>f;f++){var h=c[f];h.created_by==u.getUserId()||X(h.sharing_info,e)||d.push(h.feed_id)}d.length>0&&U(a,d)}}function X(a,b){for(var c=u.getUserId(),d=0,e=a.length;e>d;d++){var f=a[d];if(!b.hasOwnProperty(f.published_to))if("USER"===f.type){if(f.published_to===c)return!0}else if(j.getGroup(f.published_to).accessible)return!0}return!1}function Y(a,b){var c=a||Za,e=[d.feed_data];jb&&e.push(db);for(var f=!1,g=0;g<e.length;g++){var h=e[g];if(h.feed_items.length>c){h===d.feed_data&&(f=!0);var i=h.feed_items;i.splice(c,i.length-c),h.num_displayed=c,h.feed_ids_map={};for(var j=0;c>j;j++)h.feed_ids_map[i[j].feed_id]=i[j];h.all_fetched=!1}}d.cachedFeedItemViews=null,d.cachedElementPositions=[],f&&(d.hasHiddenItems=!1),b||d.$broadcast("render:boRepeat:feedItems")}function Z(a,b){var c=a.feed_items,d=c.length-a.num_displayed;b=Math.min(b,d);for(var e=0;b>e;e++)c[e+a.num_displayed]._hide=!1;a.num_displayed+=b}function aa(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1}function ba(a){for(var b={},c=0;c<a.length;c++)b[a[c].feed_id]=c;return b}function ca(a){for(var b=a.feed_items,c=b.length,d=0;c>d;d++){var e=b[d],f=e._actions,g=!1;if(f.unreadComments)g=!0,w.markCommentsAsRead(e.app_instance_id,e.resource_id,f.unreadComments);else for(var h in f)if(f.hasOwnProperty(h)&&"updatedByOtherUser_TS"!=h&&"unreadComments_updateTS"!=h){
g=!0;break}if(g){var i=f.updatedByOtherUser_TS,j=f.unreadComments_updateTS;e._actions={},e._actions.updatedByOtherUser_TS=i,e._actions.unreadComments_updateTS=j,e._dirty=!0}}}function da(a,b){if(!jb)return!1;for(var c=kb.filters.length,d=0;c>d;d++){var e=kb.filters[d];if(e.type==a&&e.value==b)return!0}return!1}function ea(){ab===_a?qa():(Q(d.feed_data,!0),ca(d.feed_data)),d.setScrollTop()}function fa(a,b){ab===_a&&(db=Ua,d.my_feed_data=db,pa()),kb=a,jb=!0;var e=q.hasAnySearchFilter(kb.filters);e?(lb=!0,mb=e.hasTextFilter,d.search_words=q.getSearchWordsIfHasWordSearchFilter(kb.filters)):(lb=!1,mb=!1,d.search_words=null),w.clearSearchResultsCommentsStore(),eb=L(),eb.isTextSearch=mb,d.feed_data=eb,eb.initiating=!0,d.cachedFeedItemViews=null,b||d.$broadcast("render:boRepeat:feedItems"),setTimeout(function(){N(eb,c,c,b),eb.initiating=!1},1)}function ga(){if(ab===_a&&pa(),q.hasAnySearchFilter(kb.filters)&&db.feed_items.length>0){for(var a=[],b=eb.feed_items,c=0;c<b.length;c++)a.push(b[c].feed_id);b=db.feed_items;for(var e=ba(db.feed_items),c=0;c<a.length;c++)e.hasOwnProperty(a[c])&&(b[e[a[c]]]._dirty=!0)}kb=null,jb=!1,lb=!1,mb=!1,d.search_words=null,eb=L(),db.isFirstFeedFetchDone?(Q(db,!0),ca(db)):(db=L(),d.my_feed_data=db),d.feed_data=db,d.cachedFeedItemViews=null,Y(10,!0),d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest(),db.isFirstFeedFetchDone?P(null,!1,"USER_ACTION: cleared filter"):N(),tb.scrollTop(0)}function ha(a){a.defaultPrevented||(D.filterApplied&&D.filterLink.filter?fa(D.filterLink.filter):ga())}function ia(){P(null,!1,"PERIODIC")}function ja(){P(null,!1,"PERIODIC")}function ka(a,b,c){P(null,b,c)}function la(){P()}function ma(){ab!==_a||jb||pa(),db=L(),d.my_feed_data=db,jb||(d.feed_data=db,N())}function na(){ab===_a&&pa(),db=L(),d.my_feed_data=db,d.hasHiddenItems=!1,jb?fa(kb,!0):(eb=L(),d.feed_data=db,N(c,c,c,!0))}function oa(){na(),d.tab.selected&&d.feedScrolledMoreThanOneFeedItem&&d.setScrollTopWithoutAnim(0)}function pa(){Ua=null,ab=$a}function qa(){for(var a=Ua.feed_items,b=a.length,c=0;b>c;c++){var e=a[c];w.updateCommentsDataReceivedInFeedFetch(e.resource_id,e.app_instance_id,e.conversations_count,e.conversations,Ua.isTextSearch)}jb?eb=Ua:(db=Ua,d.my_feed_data=db),jb?d.feed_data=L():d.my_feed_data=L(),d.$broadcast("render:boRepeat:feedItems"),d.feed_data=Ua,d.my_feed_data=db,d.$broadcast("render:boRepeat:feedItems"),N(),pa(),v.showBanner("For testing: Swapped stale feed with fresh feed")}function ra(){hb=l(ja,Wa)}function sa(){l.cancel(hb)}function ta(){d.server_now_timestamp=s.getServerTimestamp()}function ua(){null===nb&&(nb=setTimeout(va,2e3))}function va(){nb=null,x.getUpdatesFromServer()}function wa(){setTimeout(function(){Q(d.feed_data)},250)}function xa(){var a=d.feed_data;!a.feedItemsUpdatesAvailable&&a.feedItemsPendingMerge.length>0&&Q(a)}function ya(){ab===_a?qa():(d.feed_data.feedItemsUpdatesAvailable=0,Aa(),ca(d.feed_data))}function za(){P(c,c,"CONNECTIVITY_UP")}function Aa(){null===ob&&(ob=m(Ba,1500))}function Ba(){ob=null,Q(d.feed_data,!0),!pb||d.isVideoPlaying()||d.isAudioPlaying()||Y()}function Ca(a,b){var c={};if(6==a.app_instance_id&&(a.hasFiles=a.data.files.length>0,c.filesSearchMatches=a.matching_files,mb?c.numMatchingPostFiles=a.matching_files?_.keys(a.matching_files).length:0:c.numMatchingPostFiles=a.attachment_count),!a.hasFiles)for(var e,g=a.conversations?a.conversations.length:0,h=0,i=g-1;i>=0;i--){if(e=a.conversations[i].files,2>h&&e&&e.length>0){a.hasFiles=!0;break}h++}d.cachedFeedItemViews=null,a.hierarchy[0].searched_title||(a.hierarchy[0].searched_title=a.hierarchy[0].title),lb||(a.hierarchy[0].searched_title=_.escape(a.hierarchy[0].title)),c.createdByFilterUrl=ub(a.created_by,"USER"),c.createdByClass=Ea({type:"USER",published_to:a.created_by})?"in-accessible-user":"",c.createdByName=wb(vb(a.created_by),80),f("sharedToOrderByCurrentUser")(a.sharing_info);for(var j=a.sharing_info.slice(0,2),k=u.getUserId(),l=u.isAdminMode(),m=0,n=j.length;n>m;m++){var o=j[m];if(o.published_to===k)o.href=ub(k,o.type),o["class"]="",o.bind="Me";else{o["class"]="";var p=Ea(o);"GROUP"===o.type&&p&&!l?(o.href="javascript:void",o["class"]+=" in-accessible"):(o.href=ub(o.published_to,o.type),("USER"===o.type&&p||l&&p)&&(o["class"]+=" in-accessible-user")),o.bind=wb(vb(o.published_to),80)}}c.sharingInfo=j,c.note_gallery_height="232px",b===eb&&mb?(a.comments_data=w.getSearchResultsComments(a.app_instance_id,a.resource_id),c.commentsFilesSearchMatches=a.matching_conversation_files||{}):b.isTextSearch||(a.comments_data=w.getComments_newApi(a.feed_id,a.resource_id,a.app_instance_id,!1,0,2,!0)),("DOUBLE_DELETED"==a.action||"2"==a.deleted)&&(c.feed_item_state_class="dim-feed-item"),a.logged_in_user_permissions.checkBitAt(3)||(a.itemSharingInfoWithDropdownItems=Da(a.created_by,a.sharing_info)),c.resourceLinkUrl=xb(a.app_instance_id,[{type:a.resource_type,uid:a.resource_id,title:a.hierarchy[0].title}],null,a.hierarchy[0].title);for(var q=[],r=a.tags.trim().split(","),m=0;m<r.length;m++)r[m]&&q.push(r[m]);var s=q.length>0;if(c.hasTags=s,s){var t=q[0];c.firstTagFilterUrl=yb(t),c.firstTagLabel=zb(t),c.tagsTail=q.slice(1),c.numTags=q.length}a.viewData=c}function Da(a,b){var c=[],d=j.getUser(a);c.push(E.createUserListItem(_.extend({user_id:a,email:""},d)));for(var e=0,f=b.length;f>e;e++){var g=b[e];if(g.type===r.USER&&g.published_to!==a){var d=j.getUser(g.published_to);c.push(E.createUserListItem(_.extend({user_id:g.published_to,email:""},d)))}else if(g.type===r.GROUP){var h=j.getGroup(g.published_to);c.push(E.createGroupListItem(new F(_.extend({id:g.published_to,title:h.name},h))))}}return c}function Ea(a){if("USER"===a.type){var b=j.getUser(a.published_to);b&&(a=b)}else{var c=j.getGroup(a.published_to);c&&(a=c)}return!a.accessible}function Fa(a,b){return _.find(d.feed_data.feed_items,function(c){return c.resource_id==a&&c.app_instance_id==b?!0:void 0})}function Ga(a){var b=Fa(a.resource_id,a.app_instance_id);b&&(b._dirty=!0,d.cachedFeedItemViews=null,d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest())}function Ha(a){var b=Fa(a.resource_id,a.app_instance_id);if(b){var c=!1;if(a.like_info.like_timestamp>b.like_info.like_timestamp){if(!j.getUser(a.last_liked_by)&&!a.user||a.path_ids.split(",").length>1)c=!0;else if(!j.getUser(a.last_liked_by)&&a.user){var e={};e[a.last_liked_by]=a.user[a.last_liked_by],j.setUsers(e)}c?P():(b.like_info.like_timestamp=a.like_info.like_timestamp,b.like_info.liked_by=a.like_info.liked_by,b.like_info.likes_count=a.like_info.likes_count,a.like_info.hasOwnProperty("sub_res_like_count")&&(b.like_info.sub_res_like_count=a.like_info.sub_res_like_count),b._dirty=!0,d.cachedFeedItemViews=null,d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest())}}}function Ia(a){var b=Fa(a.resource_id,a.app_instance_id);if(b){var c=!1;a.like_info.like_timestamp>b.like_info.like_timestamp&&((!j.getUser(a.like_info.liked_by)||a.path_ids.split(",").length>1)&&(c=!0),c?P():(b.like_info.like_timestamp=a.like_info.like_timestamp,b.like_info.liked_by=a.like_info.liked_by,b.like_info.likes_count=a.like_info.likes_count,a.like_info.hasOwnProperty("sub_res_like_count")&&(b.like_info.sub_res_like_count=a.like_info.sub_res_like_count),b._dirty=!0,d.cachedFeedItemViews=null,d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest()))}}function Ja(a){fb.feedItemsPendingMerge=fb.feedItemsPendingMerge.concat(a),fb.feedItemsUpdatesAvailable=0,Q(fb)}function Ka(a,b){fb=L(),d.feed_data=fb,d.hideFeedEndPlaceholder=!0,b&&Ja(b),d.cachedFeedItemViews=null,d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest()}function La(a,b){Ja(b)}function Ma(a){d.feed_data=db,fb=L(),d.hideFeedEndPlaceholder=!1,d.cachedFeedItemViews=null,d.$broadcast("render:boRepeat:feedItems"),d.$$phase||d.$digest(),e.setTimeout(function(){d.$broadcast("cnvNoteGallery:forceRender")},500)}function Na(){fb.feed_items.forEach(function(a){a._dirty=!0})}function Oa(a){a?(ib=d.$on("pollFeedRequest",ka),gb=l(ia,Va),H.on("up",za),sa(),P(null,!1,"TAB_ACTIVATED")):(ib(),l.cancel(gb),H.off("up",za),ra())}function Pa(){P(null,!1,"TAB_ACTIVATED")}function Qa(){P(null,!1,"NATIVE_APP_FOCUS")}function Ra(a,b){lb&&null!==d.search_words&&j.fetchChat(b.chatId,d.search_words[0]).then(function(a){t.searchResults(a.data)});var c=d.search_words&&d.search_words.length>0?d.search_words[0]:null;t.openSearchedChat(b.chatId,b.chatType,c,b.data,b.chatParticipants,!0)}function Sa(){y.off("resourceLikedByRemoteUser",Ha),y.off("resourceUnlikedByRemoteUser",Ia),y.off("commentLikedByRemoteUser",Ga),y.off("commentUnlikedByRemoteUser",Ga),w.off("commentAddedByRemoteUser",Ga),w.off("commentUpdatedByRemoteUser",Ga),w.off("commentDeletedByRemoteUser",Ga),J.off("cnvFeedToggleSearch:applyFilters",Ta),tb=null,tb.off("scroll"),a.addEventListener("resize",onWindowResize,!1)}function Ta(a){j.setPostDisplayOption(a[0].value);var b=null;try{var e=n.resolveUrlParts(o.url());if(e=e.queryParams.q,""===e||e===c)e=r.POST_DISPLAY_OPTION+':"'+a[0].value+'"',b=p.queryToFilters(e);else if(b=p.queryToFilters(e),q.hasAnyPostDisplayOptionFilter(b))for(var f=0;f<b.length;f++)b[f].type===r.POST_DISPLAY_OPTION&&(b[f].value=a[0].value,b[f].description=a[0].description);else{var g=q.newFilter(r.POST_DISPLAY_OPTION,a[0].value,a[0].description);b.push(g)}if(b&&0!=b.length){var h=p.filtersToQuery(b),i=n.getFilterUrlForFilterStr(h);i=i.replace(/%3A/g,":"),o.url()==i?d.$emit("refreshFeed",!0,"USER_ACTION: submit feed search text again"):o.url(i)}else o.url("/feed")}catch(k){return void(b=null)}}var Ua,Va=B.isTNWAccount()?15e3:6e4,Wa=9e5,Xa=6e4,Ya=5,Za=20,$a=1,_a=2,ab=$a,bb=null,cb=!1,db=L(),eb=L(),fb=L();d.feed_data=db,d.my_feed_data=db;var gb,hb,ib,jb=!1,kb=null,lb=!1,mb=!1,nb=null,ob=null,pb=!0,qb=!1,rb=new g.ActivityWatch("cnvFeed feedPollPending",5,15e3),sb=new g.ActivityWatch("cnvFeed feedMergePending",5,15e3),tb=$("#feedScroller");j.dataService.getFeedData||(j.dataService.getFeedData=function(a){var b=null,e=d.feed_data;return a&&e.feed_ids_map[a]!==c&&(b=e.feed_items[aa(e.feed_items,"feed_id",a)]),b}),d.search_words=null,d.showLoadingSpinner=!0,d.isStarterNetwork=B.isStarterNetwork(),d.upgradeAppUrl=I.getPremiumUpgradeAppUrl(),d.loadMoreFeedOnScrollToBottom=M,d.loadMoreFeed=N,d.pollFeed=P,d.onFullScreenExit=wa,d.onCommentEditorFocusOut=xa,d.onFeedScrolledToTop=ya,d.onFeedItemsUpdatesAvailableNotifClick=ea,d.feed_search_text="",d.isMyFeed=function(){return d.feed_data===db};var ub=f("idToFilterUrl"),vb=f("idToName"),wb=f("limitText"),xb=f("getResourceLinkUrl"),yb=f("hashtagToFilterLink"),zb=f("labelToHashtag");d.hideFeedEndPlaceholder=!1,y.on("resourceLikedByRemoteUser",Ha),y.on("resourceUnlikedByRemoteUser",Ia),y.on("commentLikedByRemoteUser",Ga),y.on("commentUnlikedByRemoteUser",Ga),w.on("commentAddedByRemoteUser",Ga),w.on("commentUpdatedByRemoteUser",Ga),w.on("commentDeletedByRemoteUser",Ga),z.on("thisTabLastActiveChanged",Oa),z.on("onTabFocus_alreadySetAsLastActiveTab",Pa),i.on("appActivate",Pa),C.IS_NATIVE&&setTimeout(function(){i.on("appFocus",_.throttle(Qa,5e3,{trailing:!1}))},15e3),k.on("homeTabUnselected",function(){d.$broadcast("cnvFeed.pauseAudioPlaybackOnHomeTabUnselected")}),d.$on("forcePollFeedRequest",la),d.$on("reFetchFeed",na),d.$on("reFetchFeedOnSessionRefresh",oa),d.$on("refetchMainFeed",ma),d.$on("filterChange",ha),d.$on("cnvFeed.clearFilter",ga),d.$on("cnvFeed.removeFeedItemsSharedWithGroups",function(a,b){V(b)}),d.$on("Note:newNoteCreated",function(){P(null,!1,"FORCE: note created")}),d.$on("Link:newLinkCreated",function(){P(null,!1,"FORCE: link created")}),d.$on("cnvOnboarding:setOnboardingFeedData",Ka),d.$on("cnvOnboarding:addFeedItems",La),d.$on("cnvOnboarding:removeOnboardingFeedData",Ma),d.$on("openChatWindow",Ra),d.$on("VideoPlayback:Playing",function(a,b){d.$broadcast("VideoPlayback:stopBuffering",b)}),d.$on("$destroy",Sa),J.on("cnvFeedToggleSearch:applyFilters",Ta),ta(),l(ta,Xa),z.isThisTabLastActiveTab()?(ib=d.$on("pollFeedRequest",ka),gb=l(ia,Va),H.on("up",za)):ra(),D.waitingForServerDataBeforeEvaluatingTheFilter||(D.filterApplied&&D.filterLink.filter?fa(D.filterLink.filter):N())}]}}]),b.module("convoApp").directive("cnvFeedInviteWidget",["accountInfo","alertsService","Contacts","userInfo","$window",function(a,b,c,d,e){return{restrict:"E",scope:!0,replace:!0,templateUrl:"feed/components/cnvFeedInviteWidget/cnvFeedInviteWidget.tpl.html",link:function(f,g,h){var i=function(){f.networkPrimaryDomain=a.getPrimaryAccountDomain().user_email_domain};e.com_convo.sessionData&&e.com_convo.sessionData.signInResponseData?i():e.document.body.addEventListener("loginDataRecieved",function(){i()}),f.isGuest=d.isGuestUser(),f.shouldInviteGuestsAsFullMembers=a.shouldInviteGuestsAsFullMembers(),f.inviteContacts=function(){c.initContactsInviteModal({include_off_domain:!1,invite_via:"Invite_Dialog",origin:"Right_Column"})},f.onShareableLinkClick=function(){var a="common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",c="findContactsSplashCtrl",d={data:function(){return{requestedView:"VANITY_URL"}}};b.customModal(a,c,d).result.then(function(a){console.log("invite complete.")},function(){console.log("invite complete.")})}}}}]),b.module("convoApp").directive("cnvNoteSnippetPlaybackBanner",["Comments","$filter","resourcesTabsManager","utils","$compile",function(a,b,c,d,e){return{restrict:"E",replace:!0,scope:!0,templateUrl:"feed/components/cnvNoteSnippetPlaybackBanner/cnvNoteSnippetPlaybackBanner.tpl.html",link:function(f,g,h){var i=e('<a href="javascript:void(0)" class="back-btn" ng-click="backToComments()"></a>');f.$on("Feed:showNoteSnippetPlaybackBanner",function(d,e,h){var j=a.getComment(null,e.resourceId,e.appInstanceId,e.commentId);j.then(function(a,d){f.bannerVisible=!0,f.commentData=a,f.$broadcast("render"),f.$broadcast("refreshImage");var e=g.find(".comment-body"),j=b("limitHtmlText")(f.commentData.comment_text,160,!0);e.html(""),e.append(j.htmlStr.replace(/<\/? *i *>/gi,"")),setTimeout(function(){e.height()>24&&"P"===e[0].lastChild.nodeName?$(e[0].lastChild).append(" ").append(i(f).html("").append("Back&nbsp;to&nbsp;comments")):e.append(i(f).html("").append("Back&nbsp;to&nbsp;comments"))},0);var k=g.height();g.css("top",h.top-k-10).css("left",75),g.show(),c.on("homeTabUnselected",f.dismissBanner)})}),f.dismissBanner=function(){f.bannerVisible=!1,g.hide(),f.$emit("NoteSnippet:removeHighlightedText"),c.off("homeTabUnselected",f.dismissBanner)},f.backToComments=function(){g.hide(),f.$emit("NoteSnippet:removeHighlightedText");var a=g.parent().find(".comments-collection"),b=d.offsetTop($("#feedScroller")[0],a[0]).top-100;$("#feedScroller").animate({scrollTop:b},{duration:400})},f.$on("NoteSnippetBanner:hidePopup",function(a){f.bannerVisible&&(f.dismissBanner(),f.$emit("NoteSnippet:removeHighlightedText"))})},controller:["$scope",function(a){a.bannerVisible=!1}]}}]),b.module("convoApp").factory("feedDirtyInfo",["appTabs",function(a){function b(b,c){b!==e&&(e=b,e?(d.trigger("feedDirty"),c||a.dispatchTabsEvent2("feedDirty")):(d.trigger("feedDirtyClear"),c||a.dispatchTabsEvent2("feedDirtyClear")))}function c(){return e}var d={};_.extend(d,Backbone.Events);var e=!1;return a.addTabsEventListener2("feedDirty",function(){b(!0,!0)}),a.addTabsEventListener2("feedDirtyClear",function(){b(!1,!0)}),d.setIsDirty=b,d.getIsDirty=c,d}]),b.module("convoApp").factory("Feed",["Comments","ServerComm","accountInfo","userInfo","config","$q","$timeout","loginResponseData","logger","Contacts","networkSettingService",function(a,c,d,e,f,g,h,i,j,k,l){function m(a,b){a&&a.filters&&a.filters.length>0&&(a.filters.forEach(function(c,d){b||"chat"!=c.description||a.filters.splice(d,1),"postDisplayOption"==c.type?(a.filters.splice(d,1),a.numberOfFilters--,z=c.value):c.value[0].split("=")[0]==A&&a.filters.splice(d,1)}),a.numberOfFilters=a.filters.length)}function n(a,b,f,h,j){var k=!!l.getChatStatus();m(b,k);var n={authToken:i.getXmppSessionToken(),userID:e.getUserId(),accountID:d.getAccountId(),from_index:a,feedIDsWithTimestamp:null,filter:b,suggestionsCount:f,includeChats:h&&k},o=g.defer(),p=c.postx("feed/searchsuggestions",n);return p.then(function(a,b){a.data&&(a.data.searchedText=j),o.resolve(a)},function(a,b){o.reject(a)}),p}function o(a,b,f,h,j){var k=!!l.getChatStatus();m(f,k);var n={authToken:i.getXmppSessionToken(),userID:e.getUserId(),accountID:d.getAccountId(),fromIndex:a,itemsCount:b,summaryParams:null,sortBy:1,feedIDsWithTimestamp:null,filter:f,isSearch:h,includeChats:k&&f&&f.hasOwnProperty("filters")&&f.filters.length>0?x.includeChats:!1,includeDrafts:x.includeDrafts,applyHighlight:!0,postDisplayOption:z};r&&(console.log("first feed fetch. admin_mode: "+e.isAdminMode()),n.switchToAdminMode=e.isAdminMode()?1:0,r=!1);var o=g.defer(),p=c.postx("feed/fetch",n);return p.then(function(a,b){o.resolve(a)},function(a,b){o.reject(a)}),o.promise}function p(a){return 3==a.app_instance_id||14==a.app_instance_id?!1:!0}function q(a){return 3==a.app_instance_id||14==a.app_instance_id||21==a.app_instance_id||10==a.app_instance_id?!1:!0}var r=!0,s={},t=!1,u={},v={},w=[],x={includeChats:!0,includeDrafts:!1},y={consumed:!1,promise:null},z="latestActivity",A="stag",B={source:"Feed",fetchFeed:function(c,d,f,g,h,i){var j,k=function(c){if(response=c.data,response.users&&b.extend(u,response.users),response.groups&&b.extend(v,response.groups),response.feed_items){a.updateUsersAndGroups(response.users,response.groups);for(var d=_.filter(response.feed_items,function(a){return p(a)}),f=0;f<d.length;f++){var g=d[f];s[g.app_instance_id+":"+g.resource_id]=g.feed_id,i||a.updateCommentsDataReceivedInFeedFetch(g.resource_id,g.app_instance_id,g.conversations_count,g.conversations,h)}}return response.pinned_items&&B.updatePinnedItems(response.pinned_items),e.setUserDataRevisionNo(response.account_user_revision_number),c};return f||y.consumed||!y.promise?(y.consumed=!0,j=o(c,d,f,g).then(k)):(y.consumed=!0,j=y.promise.then(function(a){var b=JSON.parse(a);if(b&&b.feed_items&&5===b.feed_items.length){var e={data:b,status:200};return k(e)}return o(c,d,f,g).then(k)},function(){})),j},pollFeed:function(g,h,j,l){m(h,null);var n={authToken:i.getXmppSessionToken(),userID:e.getUserId(),accountID:d.getAccountId(),filter:h,includeChats:h&&h.hasOwnProperty("filters")&&h.filters.length>0?x.includeChats:!1,includeDrafts:x.includeDrafts,applyHighlight:!0,mark_notifications:1,client:f.CLIENT_TYPE,postDisplayOption:z};g&&(n.lastFeedPollTimestamp=""+g);var o=c.postx("feed/poll",n);return o.then(function(c){c=c.data,c.users&&b.extend(u,c.users),c.groups&&b.extend(v,c.groups),a.updateUsersAndGroups(c.users,c.groups);var f;if(c.feed_items){f=_.filter(c.feed_items,function(a){return q(a)});for(var g=0;g<f.length;g++){var h=f[g];s[h.app_instance_id+":"+h.resource_id]=h.feed_id,a.updateCommentsDataReceivedInFeedPoll(h.resource_id,h.app_instance_id,h.conversations_count,h.conversations,!1)}c.feed_items=f}if(c.filter_feed_items)for(var i=c.filter_feed_items,g=0;g<i.length;g++){var j=i[g];s[j.app_instance_id+":"+j.resource_id]=j.feed_id,a.updateCommentsDataReceivedInFeedPoll(j.resource_id,j.app_instance_id,j.conversations_count,j.conversations,l)}c.pinned_items&&B.updatePinnedItems(c.pinned_items),d.setAccountDataRevisionNo(c.account_revision_number),e.setUserDataRevisionNo(c.account_user_revision_number),k.setAccountContactsRevisionNo(c.account_contacts_revision_number),B.trigger("feedPolled",{feed_items:f,filter_feed_items:c.filter_feed_items,feed_items_hidden_groups:c.feed_items_hidden_groups})}),o},getFeedIdOfResource:function(a,b){return s[a+":"+b]||null},getUser:function(a){return u[a]},setUsers:function(a){b.extend(u,a)},updateUserProfileImageInfo:function(a,b,c){var d=u[a];d&&(d.profile_image_type=b,d.profile_image_version=c)},getGroup:function(a){return v[a]},getNameById:function(a){return 0===a.indexOf("grp-")||0===a.indexOf("g_")?B.getGroupName(a):B.getUserName(a)},getUserName:function(a){var b=u[a];return"undefined"==typeof b?"Unknown":b.name},getGroupName:function(a){var b=v[a];return"undefined"==typeof b?"Unknown":b.name},fetchChat:function(a,b){var f={authToken:i.getXmppSessionToken(),userID:e.getUserId(),accountID:d.getAccountId(),fromIndex:0,itemsCount:0,sortBy:1,chatId:a,chatSearchTerm:b},g=c.post("chat/fetchChat",f);return g},setFetchOptions:function(a,b){x.hasOwnProperty(a)&&(x[a]=b)},getPinnedItems:function(){return w},updatePinnedItems:function(a){w=a,B.trigger("feedService:pinnedItemsUpdated",w)},setCachedFeedDataPromise:function(a){y.promise=a},getFeedSearchSuggestions:n,dataService:{getFeedData:null},setIsFeedScrolledMoreThanOneFeedItem:function(a){t=a},getIsFeedScrolledMoreThanOneFeedItem:function(){return t},setPostDisplayOption:function(a){z=a},getPostDisplayOption:function(){return z}};return _.extend(B,Backbone.Events),B}]),b.module("convoApp").directive("cnvAppFeedItem",["$compile",function(a){return{restrict:"AE",scope:!0,link:function(b,c,d){var e="cnv-feed-item-appid"+b.itemData.app_instance_id+"-restype"+b.itemData.resource_type,f=a("<"+e+"></"+e+">")(b);c.replaceWith(f)},controller:["$scope","AppLinks",function(a,b){a.getResourceLinkUrl=function(){var c=a.itemData.hierarchy[0].title,d=b.newResourceLink(a.itemData.app_instance_id,[{type:a.itemData.resource_type,uid:a.itemData.resource_id,title:c}],null,c);return b.linkToUrl(d,!0)}}]}}]),b.module("convoApp").directive("cnvFeedItem",["$filter","$location","textSelections","utils","config","getResourceLinkUrlFilter","usersGroupsListProvider","idToFilterUrlFilter","bannerService","mixpanelService","$compile","$templateCache","$rootScope","$window",function(c,d,e,f,g,h,i,j,k,l,m,n,o,p){return{restrict:"AE",priority:0,compile:function(b,d,o){var p=n.get("feed/renderers/cnvFeedItem.tpl.html");return b.append(p),function(b,d,o){function p(){}function q(a){A&&($(A).off("click",B),$(A).hide()),$("body").off("click",q),$("body").off("mousewheel",r)}function r(a,b){var c=d.find(".note-details").offset().top;if(0==C&&(C=$(A).offset().top-c),$(A)){var e=c+C;$(A).css({top:e})}}function s(a){var c=e.getSelection(d.find(".note-details")[0]);if(A&&$(A).off("click",B),c&&c.sel&&c.sel.getRangeAt(0).endContainer.parentNode.classList.contains("more_text")){if(c.sel.getRangeAt(0).startContainer==c.sel.getRangeAt(0).endContainer)return;var g=document.createRange();g.setStart(c.sel.getRangeAt(0).startContainer,c.sel.getRangeAt(0).startOffset),g.setEnd(c.sel.getRangeAt(0).endContainer.parentNode.parentNode,0),e.mkSelection(g),c=e.getSelection(d.find(".note-details")[0])}c&&c.beginIndex<c.endIndex&&""!=c.text.trim()&&b.relatedPermissions.canComment&&(A&&$(A).show(),A=e.showIcoAboveSel($("body")[0],c.sel.getRangeAt(0).nativeRange),C=0,$(A).show(),B=function(a){if(a.target.classList.contains("cross"))return e.rmAllSelections(),void(A&&(A.remove(),A=null));var d={snippetData:{type:"scrybe.components.snippet.NotesSnippet",data:{beginIndex:c.beginIndex,endIndex:c.endIndex,text:c.text}},fileViewerTextAnnotation:!0,classes:"detail_snippet"};if("new_comment"!==b.commentsInEditModeCurrentFocus.status)b.$broadcast("embedSnippetDataInComment",{currentlyFocusedEditor:b.commentsInEditModeCurrentFocus.state,data:d});else{var g=!0;b.commentEditorCtrl.attachments.controllers&&b.commentEditorCtrl.attachments.controllers.manager_controller&&b.commentEditorCtrl.attachments.controllers.manager_controller.initialized&&(g=!1,k.showBanner("You can add one attachment to comments at a time.",!1,!1,null,3e3)),g&&b.commentEditorCtrl.link&&b.commentEditorCtrl.link.serverData&&!b.commentEditorCtrl.link.serverData.user_dismissed_resolved_url&&(g=!1,k.showBanner("You can add one attachment to comments at a time.",!1,!1,null,3e3)),g&&(d.snippetData.data.snippetId=f.generateUniqueId(),b.commentEditorCtrl.snippetData=d,b.commentEditorCtrl.setAllowAttachments(!1),b.$$phase||b.$digest(),b.showAndActivateCommentsPanel("",!0))}$(A).off("click",B),$("body").off("mousewheel",r),$(A).hide(),a.stopPropagation()},$("body").off("click",q),$("body").on("click",q),$("body").off("mousewheel",r),$("body").on("mousewheel",r),$(A).off("click",B),$(A).on("click",B))}function t(a){setTimeout(function(){s(a)},0)}function u(){var a=d.find("cnv-comment-editor"),c="onboarding/templates/cnvOnboardingAddCommentTooltip.tpl.html",e=m(n.get(c));a.append(e(b.$new())),a.addClass("cnv-onboarding-clickable"),b.feedOnboardingPostFirstComment=!0}function v(){var a=d.find("cnv-comment-editor"),c="onboarding/templates/cnvOnboardingAnnotationAddCommentTooltip.tpl.html",e=m(n.get(c));a.append(e(b.$new())),a.addClass("cnv-onboarding-clickable"),b.feedOnboardingPostSecondComment=!0}function w(a){var b="cnv-onboarding-clickable",c=$(a.target).closest("cnv-comment-editor");c.length&&c.hasClass("cnv-onboarding-clickable")||$(a.target).hasClass(b)||(a.stopImmediatePropagation(),a.preventDefault())}function x(){b.initializeDropdownOptions()}var y=$("#feedScroller");d[0].cnvMemLeakHook=new p,b.$on("commentReplyButtonClick",function(a,c){return b.collaborationInfo={replied_to_comment_id:c.commentId,replied_to_user_id:c.from,parent_resource_index:0},b.onCommentReplyButtonClick(c.from),!1}),b.copyPostLink=function(){f.copyToClipboard(g.CONVO_LINKS_BASE_URL+h(b.itemData.app_instance_id,[{type:b.itemData.hierarchy[0].type,uid:b.itemData.hierarchy[0].uid,title:b.itemData.hierarchy[0].title}],null,b.itemData.hierarchy[0].title).slice(1))},b.itemData._actions._new&&(d.addClass("this-user-new-post overflow-hidden"),setTimeout(function(){b.itemData._actions._new=!1,d.removeClass("this-user-new-post overflow-hidden")},1e3));var z=1;b.selectText=function(a){function c(){return h.textContent}function f(c){var e=d.find(".sel-text-highlight").position(),f={commentId:a.commentId,appInstanceId:b.itemData.app_instance_id,resourceId:b.itemData.resource_id};l.trackEvent(l.ANNOTATION_PLAYBACK,{Type:"Post","Snippet Type":"Text",Via:"Newsfeed"}),b.$broadcast("Feed:showNoteSnippetPlaybackBanner",f,e)}function g(){if(1==z){var c=b.noteFeedItemCtrl.loadCompleteNoteText();c.then(function(){b.selectText(a)}),z=2}else z=1}e.rmAllSelections();var h=d.find(".note-details")[0],i={data:a,nodes:h,scrollContainer:y[0],highlight:!0,selectionOffset:150,highlightRemoveTime:null,getContent:c,complete:f,failure:g};e.selectText("nested",i)},b.$on("Feed:selectText",function(a,c,d){c.commentId=d,z=1,b.selectText(c)});var A,B,C=0;b.removeCommentEditorSnippet=function(){b.commentEditorCtrl.snippetData=null,b.commentEditorCtrl.setAllowAttachments(!0),b.collaborationInfo=null},b.removeOnboardingAddCommentTooltip=function(){d.find(".cnv-onboarding-add-comment-tooltip").remove()},b.$on("Comment:replySnippetCreated",function(a,d,e){var f=!0;if(b.commentEditorCtrl.attachments.controllers&&b.commentEditorCtrl.attachments.controllers.manager_controller&&b.commentEditorCtrl.attachments.controllers.manager_controller.initialized&&(f=!1,k.showBanner("You can add one attachment to comments at a time.",!1,!1,null,3e3)),f&&b.commentEditorCtrl.link&&b.commentEditorCtrl.link.serverData&&!b.commentEditorCtrl.link.serverData.user_dismissed_resolved_url&&(f=!1,k.showBanner("You can add one attachment to comments at a time.",!1,!1,null,3e3)),f){b.commentEditorCtrl.snippetData=d,b.commentEditorCtrl.setAllowAttachments(!1),b.commentEditorCtrl.snippetData.classes="comment_snippet",b.$$phase||b.$digest(),b.collaborationInfo=e;var g="";if(e&&e.replied_to_user_id){var h=j(e.replied_to_user_id,"USER",!0).slice(1);h=h.slice(0,h.indexOf("#"))+"&ignoreatmention=1"+h.slice(h.indexOf("#")),g='<a class="'+i.AT_MENTION_DOM_CLASSES.MENTION+'" href="convo:'+h+'">@'+c("idToName")(e.replied_to_user_id)+"</a>&nbsp;"}b.showAndActivateCommentsPanel(g,!0)}}),b.$on("NoteSnippet:removeHighlightedText",function(){e.rmAllSelections()}),b.$on("Feed:hideNoteSnippetPlaybackBanner",function(a){b.$broadcast("NoteSnippetBanner:hidePopup")}),b.$on("cnvOnboarding:showAddCommentTooltip",function(c,e){if(b.itemData.feed_id==e){var f=d.find(".comments-panel-wrapper");f.css("height",0).css("opacity",0),b.showAndActivateCommentsPanel("",!0),a.setTimeout(function(){f.animate({height:68,opacity:1},500,function(){f.css("height","auto"),a.setTimeout(u,700)})},0)}}),b.$on("cnvOnboarding:showAnnotationAddCommentTooltip",function(a,b){v()}),b.$on("cnvOnboarding:incrementConversationsCount",function(a,c){b.itemData.feed_id==c&&(b.itemData.conversations_count+=1)}),b.$on("cnvOnboarding:enableClicksOnFeedItems",function(a){b.commentEditorCtrl.disableEsc=!1,d[0].removeEventListener("click",w,!0),document.removeEventListener("mousedown",w,!0),d.removeClass("hideEmojiPopover"),d.find("cnv-comment-editor").removeClass("cnv-onboarding-clickable")}),b.$on("cnvOnboarding:disableClicksOnFeedItems",function(a){b.commentEditorCtrl.disableEsc=!0,d[0].addEventListener("click",w,!0),document.addEventListener("mousedown",w,!0),d.addClass("hideEmojiPopover")});var D=function(a){27==a.keyCode&&(b.commentEditorCtrl&&(b.commentEditorCtrl.showAtMentionAlert=!1),b.removeCommentEditorSnippet(),b.$broadcast("render"))};b.dismissPermissionsTooltip=function(){d.find(".onboardingToolTips.post-permissions-tooltip").remove()},b.createPermissionsTooltip=function(){var a="onboarding/templates/cnvOnboardingPermissionsTooltip.tpl.html",c=m(n.get(a));d.find(".feed-item-container").append(c(b.$new()))},b.showAndActivateCommentsPanel=function(a,c){b.showCommentsPanel=!0,b.$broadcast("render");var e=function(){b.commentEditorCtrl.activate(a||"",c)},g=f.offsetTop(y[0],d.find(".feed-comment-editor")[0]),h=y.innerHeight(),i=y.scrollTop();g.top+150>i+h?y.animate({scrollTop:g.top-h+210},200,e):e()};var E=setTimeout(function(){var a=d[0].querySelector(".note-details");a&&a.addEventListener("mouseup",t,!0),d.find("cnv-comment-editor").on({keyup:D});var b=d.find(".feed-item-options-menu-container .dropdown-toggle")[0];b&&b.addEventListener("click",x,!0)},1);b.$on("$destroy",function(){clearTimeout(E);var a=d.find(".feed-item-options-menu-container .dropdown-toggle")[0];a&&a.removeEventListener("click",x,!0);var b=d[0].querySelector(".note-details");b&&b.removeEventListener("mouseup",t,!0),$("body").off("click",q),$("body").off("mousewheel",r),d.find("cnv-comment-editor").off("keyup",D),d[0].removeEventListener("click",w,!0),document.removeEventListener("mousedown",w,!0),d.find(".onboardingToolTips").remove()})}},controller:["$scope","Likes","Comments","Users","Groups","idToFilterUrlFilter","usersGroupsListProvider","$filter","userInfo","homeViewStateInfo","itemService","alertsService","bannerService","Feed","resourceLikeInfoModalService","utils","mixpanelService","UploadService","accountInfo","onboardingService","Comments",function(a,c,e,f,g,h,i,j,k,l,m,n,q,r,s,t,u,v,w,x,y){function z(){}function A(){setTimeout(function(){a.createPermissionsTooltip()},1500),x.recordAction("post_permissions_tooltip_shown"),o.login_data&&o.login_data.onboarding_state&&o.login_data.onboarding_state.show_post_permissions_tooltip&&(o.login_data.onboarding_state.show_post_permissions_tooltip=0)}function z(){}function B(){var b={initialized:!1,height:{min:30,max:315},source:"Feed",disableEsc:!1};return b.itemSharingInfoWithDropdownItems=a.itemData.itemSharingInfoWithDropdownItems,b.permissions=new C,b.onFocusOut=function(){setTimeout(function(){F()},0)},b.onFocus=function(b){a.commentsInEditModeCurrentFocus.state=b,a.commentsInEditModeCurrentFocus.status="new_comment"},b.getNoteId=function(){return a.itemData.resource_id},b.getAppInstanceId=function(){return a.itemData.app_instance_id},b.onCommentEntered=D,b}function C(){var b={};return b.block=!a.itemData.logged_in_user_permissions.checkBitAt(2),b.block&&(b.message="Comments are closed for this post &nbsp;&nbsp;&nbsp;\u2022&nbsp;&nbsp;&nbsp;<a class='meta' href='"+j("idToFilterUrl")(a.itemData.permissions_changed_by,"USER")+"'>"+j("limitText")(j("getUserName")(a.itemData.permissions_changed_by),80)+"</a>&nbsp;&nbsp;&nbsp;\u2022&nbsp;&nbsp;&nbsp;<a class='meta' href='"+j("getResourceLinkUrl")(a.itemData.app_instance_id,[{type:a.itemData.resource_type,uid:a.itemData.resource_id,title:a.itemData.hierarchy[0].title}],null,a.itemData.hierarchy[0].title)+"'>"+j("dateAgo")(a.itemData.permissions_change_date,a.server_now_timestamp,!0,!0)+"</a>"),
b.allowLegitAtMentions=!a.itemData.logged_in_user_permissions.checkBitAt(3),b}function D(b,c){b=b&&b.trim()||"",c=c||"",c=c.replace(/<p>&#160;<\/p>|<p>&nbsp;<\/p>|\n/g,"<br>").replace(/^(<br>)*|(<br>)*$/g,"");var d,f=a.itemData,g={app_instance:{uid:a.itemData.app_instance_id,title:a.itemData.hierarchy[0].title,type:"APPINSTANCE",data:"",created_by:a.itemData.created_by,version:"-1"},hierarchy:[{uid:a.itemData.hierarchy[0].uid,type:a.itemData.hierarchy[0].type,title:a.itemData.hierarchy[0].title,version:a.itemData.hierarchy[0].version,data:null,created_by:a.itemData.hierarchy[0].created_by}]};d=a.collaborationInfo?a.collaborationInfo:{parent_resource_index:0};var h=a.commentEditorCtrl.getCommentId(),i=a.feedOnboardingPostFirstComment||a.feedOnboardingPostSecondComment?"GS":null,j={serverData:[],data:[]};if(a.commentEditorCtrl.waiting=!1,a.commentEditorCtrl.attachments.controllers&&a.commentEditorCtrl.attachments.controllers.manager_controller&&a.commentEditorCtrl.attachments.controllers.manager_controller.initialized&&a.commentEditorCtrl.attachments.controllers.manager_controller.isBusy()){var k=a.$on("filesUploadManagerCtrl_allFilesProcessed",function(){k();for(var b=a.commentEditorCtrl.attachments.controllers.manager_controller.getSuccessfullyProcessedFiles(),c=0;c<b.length;c++)b[c].status===v.FILE_STATUS_CONVERSION_REQ_FAILED&&b.splice(c,1);0==b.length?(n.alertModal("Convo alert","The file could not be attached. Please try again.","Okay",function(){a.commentEditorCtrl.clickOutsideExit=!1}),a.commentEditorCtrl.clickOutsideExit=!0):l(),a.commentEditorCtrl.waiting=!1});a.commentEditorCtrl.waiting=!0}var l=function(){var k=!0;if(a.commentEditorCtrl.attachments.controllers&&a.commentEditorCtrl.attachments.controllers.manager_controller&&a.commentEditorCtrl.attachments.controllers.manager_controller.initialized){for(var l=a.commentEditorCtrl.attachments.controllers.manager_controller.getSuccessfullyProcessedFiles(),m=0;m<l.length;m++)l[m].status===v.FILE_STATUS_CONVERSION_REQ_FAILED&&l.splice(m,1);for(var m=0;m<l.length;m++){var n=l[m],o=null;n.fileObjFromServer&&(o=[n.fileObjFromServer]),j.serverData.push({name:n.name,size:n.size,file_name_id:n.fileId,file_id:n.serverFileId,type:n.type}),j.data.push({preLocalData:n.localUrl,thumbnail_name:n.thumbnailName,isDefaultThumbnail:-1==n.localUrl.indexOf("files/fileIcons")?!1:!0,origional_file:o,mp_attachment_source:n.mp_attachment_source,height:n.height,width:n.width})}}if(0===j.serverData.length&&0===b.length&&(k=!1),k){var p=null;a.commentEditorCtrl.link&&a.commentEditorCtrl.link.serverData&&(p=a.commentEditorCtrl.link.serverData,p.user_dismissed_resolved_url&&(p.linkInfo=null)),a.$broadcast("cnvFeedItem.aboutToPostComment");var q=e.postComment(c,f.feed_id,f.resource_id,f.resource_type,f.app_instance_id,a.commentEditorCtrl.snippetData,h,g,d,j,null,i,p,a.feed_data.isTextSearch);if(j&&j.serverData&&j.serverData.length){var r={},s="";a.MP_DATA_SOURCE&&"feed"===a.MP_DATA_SOURCE.currentSubApp&&(s="Feed"),r.Source=s,r["Attachment Type"]=j.serverData[0].type,r["Attachment Source"]=j.data[0].mp_attachment_source,u.trackEvent(u.CLICK_SEND,r)}a.itemData.conversations_count+=1,a.commentEditorCtrl.showAtMentionAlert=!1,X(),a.$broadcast("cnvFeedItem.commentPosted");var t;a.commentEditorCtrl.snippetData&&(t=$.extend(!0,{},a.commentEditorCtrl.snippetData.snippetData),a.removeCommentEditorSnippet()),a.feedOnboardingPostFirstComment&&(a.feedOnboardingPostFirstComment=!1,a.removeOnboardingAddCommentTooltip(),a.$emit("cnvOnboarding:cnvPilotFetchFirstComment")),a.feedOnboardingPostSecondComment&&(a.feedOnboardingPostSecondComment=!1,a.removeOnboardingAddCommentTooltip(),a.$emit("cnvOnboarding:cnvPilotFetchSecondComment",h)),q.then(function(a,b){t&&(E(t.data.source&&"comment"==t.data.source?"Comment":"Post"),t=null)}),q["finally"](function(){a.commentEditorCtrl.snippetData=null,a.commentEditorCtrl.setAllowAttachments(!0),a.collaborationInfo=null,X()}),a.commentEditorCtrl.deactivate()}};a.commentEditorCtrl.waiting||l()}function E(a){u.trackEvent(u.ANNOTATED,{Type:a,Via:"Newsfeed",Using:"Text"})}function F(b){if(a.showCommentsPanel){var c=b?0:a.itemData.like_info.likes_count;0===a.itemData.conversations_count&&c+a.itemData.like_info.sub_res_like_count===0&&(a.commentEditorCtrl.destroy()||(a.showCommentsPanel=!1,a.$broadcast("render")))}}function G(a){return k.isAdminMode()||H(k.getUserId(),a)}function H(a,b){var c=b.get("groupAdmins");return _.keys(_.find(c,function(b){return b.user_id==a?!0:void 0})).length>0}function I(){var b=m.changePermissions(m.canEdit,a.itemData.app_instance_id,a.itemData.resource_id);b.then(function(b){a.itemData.permissions=b.data.item.permissions,a.itemData.logged_in_user_permissions=b.data.item.logged_in_user_permissions,a.evaluatePostPermissions(),q.showBanner("Permissions updated")})}function J(){var b=m.changePermissions(m.canComment,a.itemData.app_instance_id,a.itemData.resource_id);b.then(function(b){a.itemData.permissions=b.data.item.permissions,a.itemData.logged_in_user_permissions=b.data.item.logged_in_user_permissions,a.evaluatePostPermissions(),q.showBanner("Permissions updated")})}function K(){var b=m.changePermissions(m.canView,a.itemData.app_instance_id,a.itemData.resource_id);b.then(function(b){a.itemData.permissions=b.data.item.permissions,a.itemData.logged_in_user_permissions=b.data.item.logged_in_user_permissions,a.evaluatePostPermissions(),q.showBanner("Permissions updated")})}function L(){var b=[{type:a.itemData.resource_type,uid:a.itemData.resource_id,title:a.itemData.hierarchy[0].title}],c=j("getResourceLinkUrl")(a.itemData.app_instance_id,b,null,a.itemData.hierarchy[0].title);d.url(c.slice(1)),u.trackEvent(u.OPENED_POST,{In:"Existing Tab",From:"Newsfeed"})}function M(){u.trackEvent(u.CLICK_EDIT_POST,{Via:"In Feed Menu"});var b=[{type:a.itemData.resource_type,uid:a.itemData.resource_id,title:a.itemData.hierarchy[0].title}],c=j("getResourceLinkUrl")(a.itemData.app_instance_id,b,null,a.itemData.hierarchy[0].title);c+="&view=Edit",d.url(c.slice(1))}function N(){m.deletePermanently(a.itemData.app_instance_id,a.itemData.resource_id)}function O(){var b=m.moveToTrash(a.itemData.app_instance_id,a.itemData.resource_id);q.showBanner_promise(b,"Moving to trash...","Moved to trash","Error... click here to try again.",!1,!1,b)}function P(){var b=m.restorePost(a.itemData.app_instance_id,a.itemData.resource_id);q.showBanner_promise(b,"Restoring item...","Item restored","Error... click here to try again.",!1,!1,b)}function Q(){var b=m.starPost(a.itemData.app_instance_id,a.itemData.resource_id);b.then(function(b){a.itemData.starred=1,a.$broadcast("render")}),u.trackEvent(u.STARRED_POST,{Via:"News Feed"})}function R(){var b=m.unStarPost(a.itemData.app_instance_id,a.itemData.resource_id);b.then(function(b){a.itemData.starred=0,a.$broadcast("render")})}function S(){var b=m.mutePost(a.itemData.app_instance_id,a.itemData.resource_id);b.then(function(b){a.itemData.muted=1,a.$broadcast("render")})}function T(){var b=m.unmutePost(a.itemData.app_instance_id,a.itemData.resource_id);b.then(function(b){a.itemData.muted=0,a.$broadcast("render")})}function U(){var b="home/components/cnvSharePostWidget/cnvSharePostWidget.tpl.html",c="cnvSharePostWidgetCtrl",d={sharingInfo:function(){return a.itemData.sharing_info},preventProcessSharingInfo:function(){return!1},submitAnyway:function(){return a.itemData.draft?!0:!1}},e=n.customModal(b,c,d);e.result.then(function(b){for(var c=[],d=0;d<b.length;d++){var e;e="CONTACT"===b[d].type?{published_to:b[d].email,type:"USER_EMAIL"}:{published_to:b[d].id,type:b[d].type,access_level:"ALL"},e&&c.push(e)}var f=m.updateSharingInfo(null,c,a.itemData.app_instance_id,a.itemData.resource_id);f.then(function(a){var b=a.data;if(b.hasOwnProperty("invite_response")){for(var c=b.invite_response,d=c.users_not_invited,e="",f=0,g=d.length;g>f;f++)e+=d[f].error_message+"<br>";e&&q.showBanner(e)}}),q.showBanner_promise(f,"Updating sharing info",null,"Error",!1,!1,null)})}function V(){var b="home/components/cnvAddTagsWidget/cnvAddTagsWidget.tpl.html",c="cnvAddTagsWidgetCtrl",d={tags:function(){return a.itemData.tags}},e=n.customModal(b,c,d);e.result.then(function(b){for(var c=[],d=0;d<b.length;d++)c.push("#"===b[d].label.charAt(0)?b[d].label:"#"+b[d].label);u.trackEvent(u.ADDED_TAGS_TO_POST,{Via:"In Feed Modal"});m.updateTags(null,c.join(),a.itemData.app_instance_id,a.itemData.resource_id)})}function W(){var b={app_instance_id:a.itemData.app_instance_id,resource_id:a.itemData.resource_id,resource_name:a.itemData.hierarchy[0].title,resource_type:a.itemData.resource_type,type:"SCRYBE"},c=g.getGroup(l.getToFilter().value);c.pinContentToGroup(b)}function X(){setTimeout(function(){a.evaluatePostPermissions(),a.commentEditorCtrl.permissions=new C,a.$broadcast("render"),a.$broadcast("refreshImage"),a.$broadcast("render_date"),a.$broadcast("render:boRepeat:feedItemSharingInfo"),a.$broadcast("cnvFeedItem.feedItemUpdated")},0)}function Y(a){var b=$(a.target).parents(".map-container");if(!b.length){var c=$('.map-container:not(".hide")');b=$(a.target).parents(".geo-location-container"),b.length?c.not(b.siblings(".map-container")).addClass("hide"):c.addClass("hide")}}a.cnvMemLeakHook=new z,a.dropdownCtrl={},a.noteFeedItemCtrl={},a.HACK_CHECK_FOR_FEED={state:!0},a.isGuest=k.isGuestUser(),a.isAdminMode=k.isAdminMode(),a.MP_DATA_SOURCE={currentSubApp:"feed"},a.commentsInEditModeCurrentFocus={state:null,status:"new_comment"},a.permissionsDropdownIconConditions={canEdit:!1,canComment:!1,canView:!1},a.relatedPermissions={canEdit:!1,canComment:!1,canView:!1};var Z=a.itemData.app_instance_id;3==Z||4==Z||6==Z||14==Z?a.feedItemOptionsMenu=!0:a.feedItemOptionsMenu=!1,a.itemData.enable_permissions_tooltip&&(a.itemData.enable_permissions_tooltip=!1,x.isOnboardingStepsCompleted()||1===x.getChecklist().onboarding_dismissed?A():x.on("cnvOnboarding:showUpgradeTooltip",A)),a.cnvFeedItemScope=new z,a.openSharedInfoModal=function(){var b,c=[];for(var d in a.itemData.sharing_info)b=a.itemData.sharing_info[d].published_to,"USER"==a.itemData.sharing_info[d].type?c.push(_.extend({id:b,typ:"USER"},r.getUser(b))):"GROUP"==a.itemData.sharing_info[d].type&&c.push(_.extend({id:b,typ:"GROUP"},r.getGroup(b)));var e="home/components/sharedInfoWidget/templates/sharedInfoModal.tpl.html",f="sharedInfoModalCtrl",g="cnv-shared-info-modal",h={sharedInfo:function(){return c}};n.customModal(e,f,h,g,!0)},a.evaluatePostPermissions=function(){a.permissionsDropdownIconConditions.canEdit=a.permissionsDropdownIconConditions.canComment=a.permissionsDropdownIconConditions.canView=!1,a.relatedPermissions.permissions=a.itemData.permissions,a.relatedPermissions.loggedInUserPermissions=a.itemData.logged_in_user_permissions,a.relatedPermissions.canChangePermissions=a.itemData.can_change_permissions,a.relatedPermissions.canEdit=a.itemData.logged_in_user_permissions.checkBitAt(3),a.relatedPermissions.canComment=a.itemData.logged_in_user_permissions.checkBitAt(2),a.relatedPermissions.canView=a.itemData.logged_in_user_permissions.checkBitAt(1),a.itemData.permissions.checkBitAt(3)?a.permissionsDropdownIconConditions.canEdit=!0:a.itemData.permissions.checkBitAt(2)?a.permissionsDropdownIconConditions.canComment=!0:a.itemData.permissions.checkBitAt(1)&&(a.permissionsDropdownIconConditions.canView=!0),a.commentEditorCtrl&&(a.commentEditorCtrl.itemSharingInfoWithDropdownItems=a.itemData.itemSharingInfoWithDropdownItems)},a.evaluatePostPermissions(),a.openLikeInfoModal=function(){s.openPostLikeInfoModal(a.itemData.hierarchy[0].uid,a.itemData.hierarchy[0].uid,a.itemData.app_instance_id,1)},a.$watch("itemData._dirty",function(){a.itemData._dirty&&(a.itemData._dirty=!1,X())}),a.$on("setItemDirty",function(a){X()}),a.openChatDetails=function(){var b,c,d={},e=[];for(var f in a.itemData.sharing_info)b=a.itemData.sharing_info[f].published_to,c=r.getUser(b),c&&e.push(c);d.chatId=a.itemData.hierarchy[0].uid,d.chatParticipants=e,d.data=a.itemData.data,d.chatType=function(){return"groupchat"==a.itemData.data.chatType?2:1}(),d.messageInfo=null,a.$emit("openChatWindow",d)},a.onLikeClick=function(b){var d=a.itemData,e=c.likeResource(d.feed_id,d.resource_id,d.app_instance_id,b,d.hierarchy[0].title,d.hierarchy[0].type);return e.then(function(){"unlike"===b&&1===a.itemData.like_info.likes_count&&F(!0)}),e},a.likeInfoTooltipText=function(b){j("getFeedItemLikeInfo")(a.itemData,b)},a.setCurrentCommentInEdit=function(b){a.commentsInEditModeCurrentFocus.state=b,a.commentsInEditModeCurrentFocus.status=null},a.commentEditorCtrl=new B,a.onCommentButtonClick=function(){return a.showAndActivateCommentsPanel(),!1},a.onCommentReplyButtonClick=function(b){if(a.commentEditorCtrl.initialized&&!a.commentEditorCtrl.waiting){var c="",d=i.getUserListItem(b);if(d){var e=h(d.id,d.type,!0).slice(1);e=e.slice(0,e.indexOf("#"))+"&ignoreatmention=1"+e.slice(e.indexOf("#")),c='<a class="'+i.AT_MENTION_DOM_CLASSES.MENTION+'" href="convo:'+e+'">@'+_.escape(d.label)+"</a>&nbsp;"}a.commentEditorCtrl.snippetData&&a.removeCommentEditorSnippet(),a.showAndActivateCommentsPanel(c,!0)}},a.getResourceLinkUrl=function(){var b=a.itemData.hierarchy[0].title,c=appLinks.newResourceLink(a.itemData.app_instance_id,[{type:a.itemData.resource_type,uid:a.itemData.resource_id,title:b}],null,b);return appLinks.linkToUrl(c,!0)},a.isUserOrGroupNotAccessible=function(a){if("USER"===a.type){var b=r.getUser(a.published_to);b&&(a=b)}else{var c=r.getGroup(a.published_to);c&&(a=c)}return!a.accessible},a.onSnippetCliek=function(){a.selectText()},a.initializeDropdownOptions=function(){function b(){a.copyPostLink()}k.getUserId();if(a.dropdownCtrl.options=[],a.dropdownCtrl.options.push({label:"Open post",icon:"cnv-icons-20 icons_Post-white","class":"open-in-detail-view",callback:L}),6==a.itemData.app_instance_id&&0==a.itemData.is_system_message&&(a.relatedPermissions.canEdit?a.dropdownCtrl.options.push({label:"Edit post",icon:"cnv-icons-20 icons2_Compose-white","class":"open-in-detail-view",callback:M}):a.dropdownCtrl.options.push({label:"Edit post",icon:"cnv-icons-20 edit-closed-menu-icon","class":"open-in-detail-view disabled"})),w.getAccountLevel()!==w.ACCOUNT_LEVELS.STARTER){if(a.itemData.can_change_permissions){var c=[];0==a.itemData.is_system_message&&c.push({label:"Can edit and comment",icon:"cnv-icons-14 cnv-tick v-align-m",conditionalLabelIcon:!0,condition:"canEdit",callback:I}),c.push({label:"Comment only",icon:"cnv-icons-14 cnv-tick v-align-m",conditionalLabelIcon:!0,condition:"canComment",callback:J}),c.push({label:"View only",icon:"cnv-icons-14 cnv-tick v-align-m",conditionalLabelIcon:!0,condition:"canView",callback:K}),a.dropdownCtrl.options.push({label:"Permissions",icon:"cnv-icons-20 icons_Lock-white","class":"sharing_preferences pseudo-submenu-arrow",submenu:c})}}else a.isGuest||a.dropdownCtrl.options.push({label:"Permissions (Upgrade)",icon:"cnv-icons-20 icons_Lock-white",callback:function(){o.$emit("upgrade-to-permium")}});if(a.dropdownCtrl.options.push({isDivider:!0}),0==a.itemData.muted&&0==a.itemData.deleted&&0==a.itemData.draft?a.dropdownCtrl.options.push({label:"Mute notifications",icon:"cnv-icons-20 icons2_Mute-white",callback:S}):1==a.itemData.muted&&a.dropdownCtrl.options.push({label:"Unmute notifications",icon:"cnv-icons-20 icons2_Speaker-white",callback:T}),a.relatedPermissions.canEdit&&!a.itemData.is_system_message&&a.dropdownCtrl.options.push({label:"Add tags",icon:"cnv-icons-17 icon_tag-01-01-white",callback:V}),"GROUP"==l.getState()){var d=g.getGroup(l.getToFilter().value),e=(d.get("pinnedContents"),d.get("membersCanPinContent")),f=G(d);(e||f)&&a.dropdownCtrl.options.push({label:"Pin post to group",icon:"cnv-icons-20 icons_Post-white",callback:W})}1==a.itemData.starred?a.dropdownCtrl.options.push({label:"Unstar this post",icon:"cnv-icons-20 icons_Star-white",callback:R}):a.dropdownCtrl.options.push({label:"Star this post",icon:"cnv-icons-20 icons_Star-white",callback:Q}),a.dropdownCtrl.options.push({isDivider:!0}),0==a.itemData.deleted&&a.relatedPermissions.canEdit&&!a.itemData.is_system_message&&a.dropdownCtrl.options.push({label:"Share with others",icon:"cnv-icons-20 icons2_Share-white",callback:U}),a.dropdownCtrl.options.push({label:"Copy link",icon:"cnv-icons-20 linkhorizontal-white",callback:b}),a.itemData.restorable&&3!=a.itemData.app_instance_id&&(a.dropdownCtrl.options.push({isDivider:!0}),a.dropdownCtrl.options.push({label:"Restore post",icon:"cnv-icons-17 Icon1_restore-white",callback:P})),a.itemData.deletable&&(1==a.itemData.deleted?a.dropdownCtrl.options.push({label:"Delete permanently",icon:"cnv-icons-20 icons2_Trash-white",callback:N}):(a.dropdownCtrl.options.push({isDivider:!0}),a.dropdownCtrl.options.push({label:"Delete post",icon:"cnv-icons-20 icons2_Trash-white",callback:O})))},a.initRemoveMap=function(a,b){var c=document.getElementById("map-"+a),d="hide";if(c.className.indexOf(d)>-1){c.className=c.className.replace(new RegExp("(\\s|^)"+d+"(\\s|$)")," ").replace(/^\s+|\s+$/g,"");var e={center:new google.maps.LatLng(b.lat,b.lng),zoom:16,panControl:!1,zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1,rotateControl:!1,fullscreenControl:!1};setTimeout(function(){var a=new google.maps.Map(c,e);new google.maps.Marker({position:a.getCenter(),icon:{url:"assets/cnv-icons/source-icons/colored-svg/map-pin.svg",scaledSize:new google.maps.Size(45,45),origin:new google.maps.Point(0,0)},map:a})},30)}else c.className+=" "+d};var aa=b.element(p);aa.on("click",Y),a.$on("$destroy",function(){x.off("cnvOnboarding:showUpgradeTooltip",A),aa.off("click",Y)})}]}}]),b.module("convoApp").directive("cnvComment",["$filter","$timeout","textSelections","utils","mixpanelService","bannerService","Comments","$rootScope","alertsService","$templateCache",function(b,d,e,f,g,h,i,j,k,l){return{restrict:"A",scope:!0,compile:function(d,j,k){return d.append(l.get("feed/renderers/comment/cnvComment.tpl.html")),function(d,j,k,l){function m(){}function n(){}function o(a,b){if(d.editCommentEditorCtrl&&b.currentlyFocusedEditor===d.commentData.uid){var c=b.data,e=d.getOpenedResource(),f=d.commentData.resource_link.collaboration_info,g=d.commentData.resource_link.hierarchy,k=e.uid||e.resource_id,l=!1;if(k==g[g.length-1].uid)l=!0;else if(f&&f.commentId){var m=i.getCommentFromStore(f.commentId,d.commentData.resource_id,d.commentData.app_instance_id);m&&m.files&&m.files[0].file_id==g[g.length-1].uid&&(l=!0)}if(l){var n=!0;if(d.editCommentEditorCtrl.attachments.controllers&&d.editCommentEditorCtrl.attachments.controllers.manager_controller&&d.editCommentEditorCtrl.attachments.controllers.manager_controller.initialized&&(n=!1,h.showBanner("You can add one attachment to comments at a time.",!1,!1,null,3e3)),n&&d.editCommentEditorCtrl.link&&d.editCommentEditorCtrl.link.serverData&&!d.editCommentEditorCtrl.link.serverData.user_dismissed_resolved_url&&(n=!1,h.showBanner("You can add one attachment to comments at a time.",!1,!1,null,3e3)),n){d.editCommentEditorCtrl.snippetData=c,d.editCommentEditorCtrl.setAllowAttachments(!1),d.editCommentEditorCtrl.attachContext=!0;var o=$("#feedScroller"),p=o.offset(),q=o.innerHeight(),r=o.scrollTop(),s=j.find(".feed-comment-editor-active-cont").offset();s.top+150>p.top+q&&o.animate({scrollTop:r+(s.top-(p.top+q))+210},200),d.editCommentEditorCtrl.setFocus(),d.$$phase||d.$digest(),d.$emit("setItemDirty")}}else h.showBanner("You can not change context for this comment.",!1,!1,null,3e3)}}function p(a){var b=a.find("> p:last-child");return b.length||(b=a),b}function q(){j&&(d.showMore==c&&(d.showMore=!1),C=j.find(".comment-inner.less"),D=j.find(".comment-inner.full"),C.empty(),D.empty(),D.append(d.commentData.comment_text),d.commentData.summary?(C.append(d.commentData.summary),(d.commentData.resource_link.collaboration_info&&d.commentData.resource_link.collaboration_info.snippet_data||d.commentData.summary)&&(p(C).append("<span>...</span><span class='truncate-placeholder hover_underline'>more<span>"),p(D).append("<span class='truncate-placeholder hover_underline'>less<span>"))):d.commentData.has_more_text?(d.commentData.resource_link.collaboration_info&&d.commentData.resource_link.collaboration_info.snippet_data?C.append(d.commentData.comment_text_less_snippet):d.commentData.has_more_text?C.append(d.commentData.comment_text_less):C.append(d.commentData.comment_text),(d.commentData.resource_link.collaboration_info&&d.commentData.resource_link.collaboration_info.snippet_data||d.commentData.has_more_text)&&(p(C).append("<span class='truncate-placeholder hover_underline'>more<span>"),p(D).append("<span class='truncate-placeholder hover_underline'>less<span>"))):C.append(d.commentData.comment_text))}function r(b){E&&($(E).off("click",F),$(E).hide(),E=null),$("body").off("click",r),a.removeEventListener("scroll",s,!0)}function s(b){if(E){var c=j.find(".comment_body").offset().top,d=$(E).offset().top,e=j.closest(".comments-collection"),f=e.offset().top,g=f+e.height();if(0==G&&(G=d-c),d+50>f&&g>d+30){var h=c+G;$(E).css({top:h})}else $(E).off("click",F),$(E).hide(),$("body").off("click",r),a.removeEventListener("scroll",s,!0),E=null}}function t(b){var c=$(b.target).find(".comment-inner:visible")[0];if(c||(c=$(b.target).closest(".comment-inner:visible")[0]),c){var g=e.getSelection(c);if(g&&g.sel&&g.sel.getRangeAt(0).endContainer.parentNode.classList.contains("truncate-placeholder")){if(g.sel.getRangeAt(0).startContainer==g.sel.getRangeAt(0).endContainer)return;var h=document.createRange();h.setStart(g.sel.getRangeAt(0).startContainer,g.sel.getRangeAt(0).startOffset),"more"==g.sel.getRangeAt(0).endContainer.nodeValue?h.setEnd(g.sel.getRangeAt(0).endContainer.parentNode.previousSibling.previousSibling,g.sel.getRangeAt(0).endContainer.parentNode.previousSibling.previousSibling.nodeValue.length):h.setEnd(g.sel.getRangeAt(0).endContainer.parentNode.previousSibling,g.sel.getRangeAt(0).endContainer.parentNode.previousSibling.nodeValue.length),e.mkSelection(h),g=e.getSelection(c)}$("body").off("click",r),a.removeEventListener("scroll",s,!0),E&&$(E).off("click",F),g&&g.beginIndex<g.endIndex&&""!=g.text.trim()&&d.relatedPermissions.canComment&&(E=e.showIcoAboveSel($("body")[0],g.sel.getRangeAt(0).nativeRange),E&&$(E).show(),G=0,F=function(b){if(b.target.classList.contains("cross"))return e.rmAllSelections(),void(E&&(E.remove(),E=null));var c={snippetData:{type:"scrybe.components.snippet.NotesSnippet",data:{beginIndex:g.beginIndex,endIndex:g.endIndex,text:g.text,source:"comment"}},fileViewerTextAnnotation:!0};d.getOpenedResource();c.snippetData.data.snippetId=f.generateUniqueId();var h={replied_to_comment_id:d.commentData.uid,replied_to_user_id:d.commentData.from_user,parent_resource_index:0};d.$emit("Comment:replySnippetCreated",c,h),$(E).off("click",F),a.removeEventListener("scroll",s,!0),$(E).hide(),E=null,b.stopPropagation()},$("body").on("click",r),a.addEventListener("scroll",s,!0),$(E).on("click",F))}}function u(a){function b(){return f.innerText.replace(/\n/g,"")}function c(a){j.find(".sel-text-highlight").position();g.trackEvent(g.ANNOTATION_PLAYBACK,{Type:"Comment","Snippet Type":"Text",Via:"Comment Panel"})}function d(){}var f=j.find(".comment_txt .comment-inner:visible")[0],h={data:a,nodes:f,scrollContainer:j.closest(".comments-scrollable-panel")[0],highlight:!0,highlightRemoveTime:null,selectionOffset:10,getContent:b,complete:c,failure:d};e.selectText("nested",h)}function v(a){setTimeout(function(){t(a)},0)}function w(){var a=j.find("div.comment > div.comment_body > div.comment_txt div.comment-inner-less").html(),b="selecting some text",c=a.indexOf("refer"),e=a.indexOf("specific")+8;b=b.replace(/(\s+)/,"(<[^>]+>)*$1(<[^>]+>)*");var g=new RegExp("("+b+")","gi");a=a.replace(g,"<mark class='onboarding-comment-highlight'>$1<span></span></mark>"),a=a.replace(/(<mark>[^<>]*)((<[^>]+>)+)([^<>]*<\/mark>)/,"$1</mark>$2<mark>$4"),j.find("div.comment > div.comment_body > div.comment_txt div.comment-inner-less").html(a);var h="<div class='sel-open-comments text-operations arrow-center visible onboarding-annotation-tooltip cnv-onboarding-clickable'><span class='cross cnv-icons-20 icons2_Close-darkgray cnv-onboarding-clickable'></span><i class='cnv-icons-20 icons_Comments-white cnv-onboarding-clickable'></i><span class='cnv-onboarding-clickable'>Comment on this</span></div>";j.append(h),j.find(".onboarding-annotation-tooltip").on("click",function(a){var b={snippetData:{type:"scrybe.components.snippet.NotesSnippet",data:{beginIndex:c,endIndex:e,text:"selecting some text",source:"comment"}},fileViewerTextAnnotation:!0};b.snippetData.data.snippetId=f.generateUniqueId();var g={replied_to_comment_id:d.commentData.uid,replied_to_user_id:d.commentData.from_user,parent_resource_index:0};d.$emit("Comment:replySnippetCreated",b,g),d.$emit("cnvOnboarding:showAnnotationAddCommentTooltip"),j.find(".onboarding-annotation-tooltip").off("click"),j.find(".onboarding-annotation-tooltip").remove()})}function x(){j.find(".onboarding-annotation-tooltip").remove()}j[0].cnvMemLeakHook=new m,d.cnvCommentScope=new n;var y=!1,z=!1,A=!1,B=d.itemData;d.$on("embedSnippetDataInComment",o),d.commentData.is_posting&&($(j).addClass("this-user-new-comment behind"),setTimeout(function(){$(j).removeClass("this-user-new-comment behind")},500)),d.commentData._unread&&($(j).closest(".comments-scrollable-panel").addClass("bring-front"),$(j).addClass("unread-comment remote-user-new-comment behind"),setTimeout(function(){$(j).closest(".comments-scrollable-panel").removeClass("bring-front"),$(j).removeClass("behind").addClass("block-anim")},500)),d.$on("render",function(){d.commentData._unread?$(j).addClass("unread-comment"):$(j).removeClass("unread-comment remote-user-new-comment"),E&&$(E).hide()});var C,D;d.getCommentText=function(){var a=D.html();return a=a.replace(/<span .*?class=".*?truncate-placeholder.*?">.*?<\/span>/g,"").replace(/<span .*?class=".*?cnv-sh.*?">/g,'<span class="cnv-rm-sh">')},d.updateCommentText=function(){q()},d.setCommentText=q,q();var E,F,G=0;setTimeout(function(){var a=j[0];a&&a.addEventListener("mouseup",v)},0),d.$on("Comments:hideCommentsForReplySnippetPlayback",function(a,b){b.hasOwnProperty(d.commentData.uid)&&(j.slideUp(700),y=!0)}),d.$on("Comments:displayShowAllButton",function(a,b){if(b.source_cid==d.commentData.uid){var c=$("<div class='show-all-cont animate-bottom-up ng-hide'>View all comments</div>");c.on("click",function(){d.$emit("Comments:unHideAll")}),j.find(".comment").append(c),setTimeout(function(){c.removeClass("ng-hide")},1e3),j.addClass("thread-b-pad"),z=!0}b.dest_cid==d.commentData.uid&&j.addClass("thread-t-pad")}),d.$on("Comments:source-comment-pointer",function(a,b){b==d.commentData.uid&&(A=!0,j.addClass("source-comment-pointer"))}),d.$on("Comments:replied-comment-pointer",function(a,b){b==d.commentData.uid&&(j.addClass("replied-comment-pointer"),A=!0,d.currentlyPlayingCommentSnippet=!0,d.$emit("setItemDirty"))}),d.$on("Comments:highlightText",function(b,c,f){c==d.commentData.uid&&(d.showMore=!0,d.immediateUpdateAttachmentStyles(),d.$emit("setItemDirty"),d.$$phase||d.$digest(),a.setTimeout(function(){a.setTimeout(function(){f.data.commentId=c,e.rmAllSelections(),u(f.data),j.removeClass("remote-user-new-comment")},0)},0))}),d.$on("Comments:showAllWithoutAnim",function(a){y&&(d.currentlyPlayingCommentSnippet=!1,j.show()),z&&(e.rmAllSelections(),j.find(".show-all-cont").remove()),A&&(j.removeClass("source-comment-pointer thread-b-pad"),j.removeClass("replied-comment-pointer thread-t-pad"),d.currentlyPlayingCommentSnippet=!1,d.$emit("setItemDirty"))}),d.$on("Comments:showAll",function(a){y&&j.slideDown(700),z&&(e.rmAllSelections(),j.removeClass("source-comment-pointer"),j.find(".show-all-cont").fadeOut(250,function(){$(this).remove()})),A&&(j.removeClass("source-comment-pointer thread-b-pad"),j.removeClass("replied-comment-pointer thread-t-pad"),d.currentlyPlayingCommentSnippet=!1,d.$emit("setItemDirty"))}),d.$on("cnvOnboarding:highlightTextAndShowTooltip",function(a,b){b==d.commentData.uid&&w()}),d.$on("cnvComment:removeCommentAnimFlags",function(a,b){B.feed_id==b&&(d.commentData.is_posting=!1,d.commentData._unread=!1,$(j).closest(".comments-scrollable-panel").removeClass("bring-front"),$(j).removeClass("behind").removeClass("this-user-new-comment"),$(j).closest(".comments-scrollable-panel").removeClass("bring-front"),$(j).removeClass("behind"))}),d.$on("cnvComment:removeHighlightTextAndShowTooltip",function(a,b){b==d.commentData.uid&&x()}),d.getElement=function(){return j},d.hasGifs=!1,d.fileUrl=null,d.gifUrl=null,d.loadImageThumb=function(a){if(a=a||0,!d.imageFile&&(d.imageFile=d.getElement().find("#commentImage"),!d.imageFile||0==d.imageFile.length))return d.imageFile=null,void(10>a&&setTimeout(function(){d.loadImageThumb(++a)},300));var b=d.imageFile.attr("src");d.hasGifs?(j.find(".attachment-cont .cnv-spinner").remove(),j.find(".attachment-cont").append('<span class="cnv-spinner"></span>'),b!=d.gifUrl&&b!=d.fileUrl?d.imageFile.on("load",function(){d.imageFile.attr("src")==d.gifUrl?(j.find(".attachment-cont .cnv-spinner").remove(),d.imageFile.off("load")):d.imageFile.attr("src",d.gifUrl)}).attr("src",d.fileUrl):j.find(".attachment-cont .cnv-spinner").remove()):b!=d.fileUrl&&d.imageFile.attr("src",d.fileUrl)},d.setFileUrl=function(){if(d.commentData.files&&d.commentData.files.length){d.commentData.hasFiles=!0;var a=d.commentData.files[0];!a.file_id&&a.origional_file&&a.origional_file.length>0&&(a=a.origional_file[0]),a&&a.thumbnail_name&&(d.fileUrl=b("getCommentAttachmentThumbnailPath")(a,d.resourceId,0),"gif"===a.type?(d.hasGifs=!0,d.itemData&&!d.itemData.commentScopes&&(d.itemData.commentScopes={},d.itemData.hasGifsInComment=!0,d.itemData.commentScopes[d.commentData.uid]=d),d.gifUrl=b("getOriginalImagePath")(a.original_name,d.resourceId,d.appInstanceId)):d.hasGifs=!1,d.loadImageThumb())}else d.imageFile&&(d.imageFile.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="),d.imageFile=null)},d.setFileUrl();var H=null;d.saveCommentHeight=function(){H=j.height()},d.revealCommentAfterEditSeemlessly=function(a){j.height(H),a&&(d.hideAttachments=!0),setTimeout(function(){j.height("auto"),a&&(d.hideAttachments=!1,j.find(".comment-attachments").removeClass("ng-hide"))},150)},d.immediateUpdateAttachmentStyles=function(){d.calcAttachmentHeight(),j.find(".comment-attachments .comment-attachment").css(d.attachmentStyles)},d.toggle=function(){d.showMore=!d.showMore,d.immediateUpdateAttachmentStyles(),d.$emit("setItemDirty")},j.on("click",".truncate-placeholder",d.toggle),d.$on("$destroy",function(){if($("body").off("click",r),E){var a=$(E);a.off("click",F),a.remove(),E=null}j.off("click",".truncate-placeholder",d.toggle),d.itemData&&d.itemData.commentScopes&&d.commentData.uid&&d.itemData.commentScopes[d.commentData.uid]==d&&(d.itemData.commentScopes[d.commentData.uid]=null),d.imageFile||(d.imageFile=d.getElement().find("#commentImage")),d.imageFile.length>0&&(d.imageFile.off("load").off("error"),d.imageFile.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="),d.imageFile.remove()),d.imageFile=null,j[0].removeEventListener("mouseup",v)})}},controller:["$scope","$filter","Likes","$q","resourceLikeInfoModalService","userInfo","awsService","accountInfo","resourcesTabsManager","config","nativeCommBridge","mixpanelService","UploadService",function(a,b,d,e,g,h,l,m,n,o,p,q,r){function s(){if(a.fileSearchMatchesText=null,a.fileSearchHighlightedName=null,a.isAudio=!1,a.fileNameEscaped="",a.commentData.files&&a.commentData.files.length){var b=a.commentData.files[0];if(!b.file_id&&b.origional_file&&b.origional_file.length>0&&(b=b.origional_file[0]),!b.file_id)return;if(a.isAudio="Audio"===f.getFileFormat(b.type),a.fileNameEscaped=_.escape(b.name),!a.itemData)return;if(a.itemData.viewData.commentsFilesSearchMatches){var c=b.file_id,d=a.itemData.viewData.commentsFilesSearchMatches[c];d&&(d.total_word_occurrences>0&&(a.fileSearchMatchesText=d.total_word_occurrences+" match"+(d.total_word_occurrences>1?"es":"")),
a.fileSearchHighlightedName=d.file_matching_name)}}}function t(b,c){function d(){function b(){var b=!0;if(a.editCommentEditorCtrl.attachments.controllers&&a.editCommentEditorCtrl.attachments.controllers.manager_controller&&a.editCommentEditorCtrl.attachments.controllers.manager_controller.initialized){for(var e=a.editCommentEditorCtrl.attachments.controllers.manager_controller.getSuccessfullyProcessedFiles(),f=0;f<e.length;f++)e[f].status===r.FILE_STATUS_CONVERSION_REQ_FAILED&&e.splice(f,1);for(var f=0;f<e.length;f++){var g=e[f],h=null;if(g.fileObjFromServer?h=[g.fileObjFromServer]:a.commentData.files&&(h=[a.commentData.files[0]]),!g.name){var j=g.origional_file[0];g.name=j.name,g.size=j.size,g.type=j.type,g.original_name=j.original_name,g.thumbnail_name=j.thumbnail_name,g.file_id=j.file_id}d.serverData.push({name:g.name,size:g.size,type:g.type}),g.inEdit?(d.serverData[f].file_name_id=g.serverFileId?g.serverFileId:g.original_name.trim().split(".")[0],d.serverData[f].file_id=g.fileId?g.fileId:g.file_id):(d.serverData[f].file_name_id=g.fileId?g.fileId:g.file_id,d.serverData[f].file_id=g.serverFileId?g.serverFileId:g.original_name.trim().split(".")[0]),d.data.push({preLocalData:g.localUrl,thumbnail_name:g.thumbnailName||g.thumbnail_name,isDefaultThumbnail:-1==g.localUrl.indexOf("files/fileIcons")?!1:!0,origional_file:h,height:g.height||90,width:g.width||90}),a.editCommentEditorCtrl.attachContext=!1}}var k=a.editCommentEditorCtrl.snippetData;k&&k.hasOwnProperty("snippetData")&&(k=a.editCommentEditorCtrl.snippetData.snippetData),0===d.serverData.length&&0===c.length&&(b=!1);var l;a.editCommentEditorCtrl.link&&a.editCommentEditorCtrl.link.serverData&&(l=a.editCommentEditorCtrl.link.serverData,l.user_dismissed_resolved_url&&(l.linkInfo=null));var m=a.commentData.resource_link.collaboration_info&&a.commentData.resource_link.collaboration_info.on_comment_attachment;b&&(a.commentEditingPending=!0,i.editComment(a.commentData.uid,a.commentData.citem_uid,c,a.resourceId,a.appInstanceId,a.editCommentEditorCtrl.attachContext,k,m,d,l,a.commentData).success(function(b){a.commentEditingPending=!1,a.calcAttachmentHeight(),a.$emit("setItemDirty"),b.data.mappings&&a.$emit("cnvComment.atMentionsAddedInEditedComment",b.data.mappings)}).error(function(b){a.commentEditingPending=!1,a.updateCommentText(),a.calcAttachmentHeight(),a.$emit("setItemDirty"),a.$broadcast("render_date")}),a.revealCommentAfterEditSeemlessly(!0),a.editCommentEditorCtrl.deactivate(),a.editCommentEditorCtrl=null,a.hasOwnProperty("commentEditorCtrl")&&(a.commentEditorCtrl=null),a.updateCommentText(),a.calcAttachmentHeight(),a.$emit("setItemDirty"),a.$broadcast("render_date"),setTimeout(function(){a.imageFile=null,a.setFileUrl()},100))}c=c.replace(/<p>&#160;<\/p>|<p>&nbsp;<\/p>|\n/g,"<br>").replace(/^(<br>)*|(<br>)*$/g,""),!a.editCommentEditorCtrl.attachContext||a.editCommentEditorCtrl.snippetData||a.commentData.resource_link.collaboration_info||(a.editCommentEditorCtrl.attachContext=!1),a.editCommentEditorCtrl.snippetData=a.editCommentEditorCtrl.snippetData||null;var d={serverData:[],data:[]};if(a.editCommentEditorCtrl.attachments.controllers&&a.editCommentEditorCtrl.attachments.controllers.manager_controller&&a.editCommentEditorCtrl.attachments.controllers.manager_controller.initialized&&a.editCommentEditorCtrl.attachments.controllers.manager_controller.isBusy()){var e=a.$on("filesUploadManagerCtrl_allFilesProcessed",function(c){e(),c.stopPropagation();for(var d=a.editCommentEditorCtrl.attachments.controllers.manager_controller.getSuccessfullyProcessedFiles(),f=0;f<d.length;f++)d[f].status===r.FILE_STATUS_CONVERSION_REQ_FAILED&&d.splice(f,1);0==d.length?(k.alertModal("Convo alert","The file could not be attached. Please try again."),a.commentEditorCtrl.waiting=!1):b()});a.editCommentEditorCtrl.waiting=!0}a.editCommentEditorCtrl.waiting||b()}if(a.relatedPermissions.canComment){if(a.editCommentEditorCtrl.snippetData&&a.editCommentEditorCtrl.snippetData.imageData&&!a.editCommentEditorCtrl.snippetData.fileViewerTextAnnotation){var e=z(a.editCommentEditorCtrl.snippetData.imageData),f="";f=a.editCommentEditorCtrl.snippetData.snippetData?a.editCommentEditorCtrl.snippetData.snippetData.data.fileName:a.editCommentEditorCtrl.snippetData.data.fileName;var g=m.getAccountId()+"/snippets/"+a.commentData.uid+"/"+f;l.uploadSnippetImage(e,g).success(function(){a.editCommentEditorCtrl.waiting=!1,d()}).error(function(){a.editCommentEditorCtrl.waiting=!1}),a.editCommentEditorCtrl.waiting=!0}else d();a.$emit("snippetImagePosted")}else k.alertModal("Convo","You no longer have permissions to comment on this post.","Ok",function(){_commentsBlockedAlertPending=!1},!0,!0)}function u(b,c,d,e){var f,g={min:23};return a.commentData.links&&a.commentData.links.length>0&&(f=a.commentData.links[0],f.url=a.commentData.links[0].source),{initialized:!1,commentEdit:!0,comment_uid:b,clickOutsideExit:!0,instantLoad:!0,attachContext:!0,height:g,initialText:c,snippetData:w(d),attachedFiles:e,attachedLink:f,getNoteId:function(){return a.resourceId},getAppInstanceId:function(){return a.appInstanceId},onFocus:function(){a.setCurrentCommentInEdit(a.commentData.uid)},onEscInCommentEditorEditor:function(){a.editCommentEditorCtrl=null,a.hasOwnProperty("commentEditorCtrl")&&(a.commentEditorCtrl=null),a.revealCommentAfterEditSeemlessly(!0),a.$emit("setItemDirty"),a.$emit("snippetImagePosted"),setTimeout(function(){a.imageFile=null,a.loadImageThumb()},100)},permissions:new v,onCommentEntered:t}}function v(){var a={block:!1,disable:!1};return a}function w(a){var b=null;return a&&("scrybe.components.snippet.NotesSnippet"===a.type?(b={},"comment"===a.data.source?b.classes="comment_snippet":b.classes="detail_snippet",b.fileViewerTextAnnotation=!0,b.snippetData=a):b=a),b}function x(){a.saveCommentHeight(),a.revealCommentAfterEditSeemlessly(),a.commentWillGoInEdit(a.commentData.uid,a.getElement()),a.commentEditorCtrl=a.editCommentEditorCtrl=new u(a.commentData.uid,a.getCommentText(),a.commentData.resource_link.collaboration_info.snippet_data,a.commentData.files),a.setCurrentCommentInEdit(a.commentData.uid),a.$emit("setItemDirty")}function y(){k.promptModal("Delete Comment","Are you sure you want to delete this comment? This cannot be undone.",function(){i.deleteComment(a.commentData.uid,a.resourceId,a.appInstanceId).then(function(b){a.$emit("setItemDirty")})},null,"Delete")}function z(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}a.showMore=!1,a.commentInjected="",a.itemData?(a.commentInjected="feed-comment-panel",a.resourceId=a.itemData.resource_id,a.appInstanceId=a.itemData.app_instance_id,a.resourceType=""+a.itemData.app_instance_id):a.noteData?(a.commentInjected="right-comment-panel",a.resourceId=a.noteData.item.item_id,a.appInstanceId=a.noteData.item.type,a.resourceType=""+a.noteData.item.type):a.linkData&&(a.commentInjected="right-comment-panel",a.resourceId=a.linkData.item.item_id,a.appInstanceId=a.linkData.item.type,a.resourceType=""+a.linkData.item.type),s(),a.currentlyPlayingCommentSnippet=!1,a.attachmentStyles={},a.cmmtDropdownCtrl={},a.cmmtDropdownCtrl.type="circleLessChevron",a.calcAttachmentHeight=function(b){if(a.commentData.files&&a.commentData.files.length){var c=i.getCommentFromStore(a.commentData.uid,a.commentData.resource_id,a.commentData.app_instance_id);if(c||(c=a.commentData),c.files&&c.files.length){var d,e=+c.files[0].width,f=+c.files[0].height;d=b?b:"feed-comment-panel"===a.commentInjected?c.comment_text&&!a.showMore||!a.commentData.resource_link||!a.commentData.resource_link.collaboration_info||a.commentData.resource_link.collaboration_info.replied_to_user_id?90:155:170;var g=f/e;g?(a.attachmentStyles.height=Math.min(d,f),a.attachmentStyles.width=a.attachmentStyles.height/g):(a.attachmentStyles.height=0,a.attachmentStyles.width=0),"feed-comment-panel"===a.commentInjected?a.attachmentStyles.width>350&&(a.attachmentStyles.width=350,a.attachmentStyles.height=g*a.attachmentStyles.width):a.attachmentStyles.width>215&&(a.attachmentStyles.width=215,a.attachmentStyles.height=g*a.attachmentStyles.width)}}},a.calcAttachmentHeight(),a.thisUserInfo=h,_.extend(a.editCommentEditorCtrl,Backbone.Events),a.loadAndDisplayImage=function(){var c=a.commentData,d=c.resource_link.collaboration_info.snippet_data.imageData;return d?d:b("getSnippetImagePath")(c.resource_link.collaboration_info.snippet_data.data.fileName,c.uid)},a.isHomeTabSelected=n.isHomeTabSelected(),a.onLikeClick=function(b){return d.likeConversation(a.commentData.uid,a.resourceId,a.appInstanceId,b)},a.openLikeInfoModal=function(){g.openCommentLikeInfoModal(a.commentData.uid)},a.likeInfoTooltipText=function(c){b("getCommentLikeInfo")(a.commentData.uid,c)},a.selectText=function(b){var c,d,e=b.resource_link;e.resource_path.hierarchy[1]&&!n.isHomeTabSelected()?(c="drawSnippetOnCanvas",d=a,e.collaboration_info.snippet_data.data.fileId||(e.collaboration_info.snippet_data.data.fileId=e.hierarchy[1].uid)):n.isHomeTabSelected()?1===e.resource_path.hierarchy.length&&(c="Feed:selectText",d=a):(c="Editor:selectText",d=j),c&&d.$emit(c,e.collaboration_info.snippet_data.data,b.uid)},a.retryFailedPostComment=function(){i.retryFailedPostComment(a.commentData.uid,a.resourceId,a.appInstanceId)["finally"](function(){a.$emit("setItemDirty")}),a.$emit("setItemDirty")},a.discardFailedPostComment=function(){i.discardFailedPostComment(a.commentData.uid,a.resourceId,a.appInstanceId)},a.commentReplyPlayback=function(){var b=a.commentData.resource_link.collaboration_info;q.trackEvent(q.VIEW_THREAD),a.$emit("Comment:ReplyCommentPlayback",b,a.commentData.uid)},a.copyCommentLink=function(){f.copyToClipboard(o.CONVO_LINKS_BASE_URL+b("getCommentUrl")(a.commentData).slice(1))},a.$on("cnvNoteGallery:reloadThumbnails",function(b,c){if(c.hasOwnProperty(a.commentData.uid)){var d={};if(a.commentData.files){for(var e=0,f=a.commentData.files.length;f>e;e++)d[a.commentData.files[e].file_id]=!0;a.$broadcast("cnvNoteGallery:reloadThumbnailsHorizontal",d)}}}),a.initializeCmntDropDownOptions=function(){"right"==a.alignDropDowns&&(a.cmmtDropdownCtrl.align="right"),a.cmmtDropdownCtrl.fixedPosition=!0,a.cmmtDropdownCtrl.options=[],a.cmmtDropdownCtrl.options.push({label:"Copy comment link",callback:a.copyCommentLink}),a.commentData.files&&a.commentData.files.length&&a.cmmtDropdownCtrl.options.push({label:"Copy attachment link",callback:function(){f.copyToClipboard(o.CONVO_LINKS_BASE_URL+b("getCommentAttachmentUrl")(a.commentData,a.commentData.files[0].file_id,a.commentData.files[0].file_format.toLowerCase(),a.commentData.files[0].name).slice(1))}}),2!=a.commentData.update_kind&&a.commentData.from_user==h.getUserId()&&a.relatedPermissions&&a.relatedPermissions.canComment&&a.cmmtDropdownCtrl.options.push({label:"Edit",callback:x}),2==a.commentData.update_kind||a.commentData.from_user!=h.getUserId()&&!h.isAdminMode()||a.cmmtDropdownCtrl.options.push({label:"Delete",callback:y})},a.$on("render",function(){a.showMore==c&&(a.showMore=!1),setTimeout(function(){a.setCommentText()},0),a.calcAttachmentHeight(),a.setFileUrl(),s()}),a.imageFile=null,a.unloadImages=function(){a.commentData.hasFiles&&a.gifUrl&&(a.imageFile||(a.imageFile=a.getElement().find("#commentImage")),a.imageFile.attr("src",a.fileUrl))},a.reloadImages=function(){a.imageFile&&a.commentData.hasFiles&&a.gifUrl&&a.imageFile.attr("src",a.gifUrl)},a.downloadFile=function(c,d){var e=b("getPartialOriginalImagePath")(c,a.resourceId,a.appInstanceId);f.download([{path:e,name:d}])}}]}}]),b.module("convoApp").directive("cnvCommentsPanel",["userInfo","bannerService","Comments","mixpanelService","utils","Feed",function(b,d,e,f,g,h){return{restrict:"EA",scope:!0,compile:function(i,j,k){return function(i,j,k){function l(){this.node=r[0],this.previousScrollHeightMinusTop=0,this.readyFor="up"}function m(a){var b=u.scrollTop(),c=j.find("#"+a).position(),d=u.height();return c&&c.top>0&&c.top+b<b+d?!0:!1}function n(a,b,c){var d,e=j.find("#"+a).position();b?(d=e.top+u.scrollTop()+u.height(),c&&(d-=c)):d=e.top+u.scrollTop(),u.animate({scrollTop:d},{duration:100})}function o(){s[0].scrollHeight-s[0].scrollTop<=s[0].clientHeight&&(j.find(".new-comments-badge").hide(),s.off("scroll",o))}function p(a){$(a.currentTarget).hasClass("comment-snippet-attachment")&&(a.stopImmediatePropagation(),a.preventDefault())}function q(a){for(var b={source:"COMMENTS_PANEL"},c=i.itemData.comments_data.comments.length-1;c>=0;--c){var d=i.itemData.comments_data.comments[c],e=j.find("."+d.uid),f=e.offset(),g=e.innerHeight(),h=r.offset(),k=r.innerHeight();if(!e.length||h.top+k<f.top&&h.top>f.top+g){console.info("comment in view breaking at"+c);break}h.top+k>f.top&&h.top<f.top+g&&(b[d.uid]=!0)}(a||JSON.stringify(b)!=JSON.stringify(D))&&(D=b,i.$broadcast("cnvNoteGallery:reloadThumbnails",D))}var r=j.find(".comments-collection"),s=r,t=h.getFeedIdOfResource(i.itemData.app_instance_id,i.itemData.resource_id);l.prototype.restore=function(){"up"==this.readyFor&&(this.node.scrollTop=this.node.scrollHeight-this.previousScrollHeightMinusTop)},l.prototype.prepareFor=function(a){this.readyFor=a||"up",this.previousScrollHeightMinusTop=this.node.scrollHeight-this.node.scrollTop},i.setElementInView=function(a){if(a){var b=a[0].offsetTop,c=b+a.height()-r.height();r.scrollTop()<c&&r.animate({scrollTop:c},{duration:400})}},i.ScrollPosition=new l,i.scrollToBottom=function(a){var b=0;a&&(b=400);var c=r[0].scrollHeight-r[0].clientHeight+10;s.animate({scrollTop:c},{duration:b})},i.newCommentsBadgeSlidesUp=function(){j.find(".new-comments-badge").hide()},i.currentlyPlayingSnippetForComment=null,i.$on("Comment:ReplyCommentPlayback",function(b,c,f){function g(a){for(var b=[],e={},g=!1,h=0;h<i.itemData.comments_data.comments.length;h++){var j=i.itemData.comments_data.comments[h];if(c.replied_to_comment_id==j.uid&&b.push(j.uid),f==j.uid){b.push(j.uid);break}b.length>=1&&c.replied_to_comment_id!=j.uid&&(e[j.uid]=!0,g||(g=!0))}setTimeout(function(){if(b.length==i.LATEST_COMMENTS_ONLY_COUNT){a&&i.scrollToBottom();var f=0;g&&(f=600),i.currentlyPlayingSnippetForComment&&i.currentlyPlayingSnippetForComment!=b[1]&&i.$broadcast("Comments:showAllWithoutAnim"),g&&i.$broadcast("Comments:displayShowAllButton",{source_cid:b[0],dest_cid:b[1]}),setTimeout(function(){i.$broadcast("Comments:replied-comment-pointer",b[1])},f),setTimeout(function(){i.$broadcast("Comments:source-comment-pointer",b[0])},f),setTimeout(function(){i.$broadcast("Comments:hideCommentsForReplySnippetPlayback",e)},f/2),setTimeout(function(){m(b[0])?m(b[0])&&!m(b[1])&&n(b[0]):n(b[0]),c.snippet_data&&setTimeout(function(){i.$broadcast("Comments:highlightText",b[0],c.snippet_data)},f+50)},0),i.currentlyPlayingSnippetForComment=b[1]}else d.showBanner("The comment that this reply is referring to is deleted by the user.",!1,!1,null),i.currentlyPlayingSnippetForComment=null},0)}if(e.checkIfCommentExistsInDataStore(c.replied_to_comment_id,i.itemData.resource_id,i.itemData.app_instance_id))if(j.find(".comments-collection > #"+c.replied_to_comment_id).length>0)g();else if(i.comments_expanded){var h=e.getComments_newApi(null,i.itemData.resource_id,i.itemData.app_instance_id,!1,null,null);h.then(function(b,c){i.comments_expanded=!0,i.loadedCommentsCount=b.comments.length,i.$emit("setItemDirty"),a.setTimeout(function(){i.checkIfCommentsPanelIsInView()||i.scrollCommentsPanelInView()},0),g(!0)})}else{var h=e.getComments_newApi(null,i.itemData.resource_id,i.itemData.app_instance_id,!1,null,null);h.then(function(b,c){var d=!1;if(3===b.comments.length&&i.itemData.comments_data.total_comments>3&&(d=!0),d){var e=i.loadAllComments(!0,!1,!0);e.then(function(){i.loadedCommentsCount=i.itemData.comments_data.total_comments,g(!0)})}else i.loadedCommentsCount=b.comments.length,i.comments_expanded=!0,i.$emit("setItemDirty"),g(!0),a.setTimeout(function(){i.checkIfCommentsPanelIsInView()||i.scrollCommentsPanelInView()},0)})}else{var h=i.loadAllComments(!0,!1,!0);h.then(function(){i.loadedCommentsCount=i.itemData.comments_data.total_comments,g(!0)})}}),i.$on("Comments:unHideAll",function(b,c){i.currentlyPlayingSnippetForComment=null,i.$broadcast("Comments:showAll"),c&&a.setTimeout(function(){m(c)||a.setTimeout(function(){n(c)},0)},900)}),i.$on("render",function(){(i.itemData.comments_data.total_comments>i.totalComments||i.totalComments===c&&i.commentsInEditMode>0&&!i.comments_expanded)&&(i.totalComments=i.itemData.comments_data.total_comments,i.itemData.comments_data.comments[i.itemData.comments_data.comments.length-1].from_user!=b.getUserId()&&a.setTimeout(function(){s[0].scrollHeight-s[0].scrollTop-30>s[0].clientHeight&&(j.find(".new-comments-badge").show(),s.on("scroll",o))},800))});var u=j.find(".comments-collection"),v=!1,w=!1,x=null,y=function(b){if(!v&&!w){var c=function(){g.isSafari()?u.css("overflow-y","scroll"):u.css("overflow-y","auto"),u.on("scroll",B),u.on("mousewheel DOMMouseScroll",C),w=!0};"touchstart"===b.type?c():x=a.setTimeout(c,250)}},z=function(a){x&&clearTimeout(x),w&&(g.isSafari()?u.css("overflow-y","scroll"):u.css("overflow-y","hidden"),u.off("scroll",B),u.off("mousewheel DOMMouseScroll",C),w=!1)},A=null,B=function(a){A&&clearTimeout(A),A=setTimeout(function(){if(u.height()>=435&&i.comments_expanded){var a=u[0].scrollTop;50>a&&(i.ScrollPosition.prepareFor("up"),i.loadedCommentsCount+=10,i.$broadcast("render:boRepeat:commentItems"),i.ScrollPosition.restore())}E()},50),i.drawShaowsIfScrollable()},C=function(a,b){if(Math.ceil(u.height())>=435){var c=Math.ceil(u.scrollTop());(0==c&&b>0||Math.ceil(u[0].scrollHeight)-c<=Math.ceil(u.outerHeight())&&0>b)&&a.preventDefault()}};u.on({"mouseenter touchstart":y,mouseleave:z});var D={},E=_.throttle(q,250);i.$on("cnvNoteGallery:reloadThumbnails",function(a,b){"FEED"===b.source&&(a.defaultPrevented=!0,b.hasOwnProperty(t)&&q(!0))}),i.$on("cnvNoteGallery:unloadThumbnails",function(a,b){"FEED"===b.source&&(a.defaultPrevented=!0,b.hasOwnProperty(t)||i.$broadcast("cnvNoteGallery:reloadThumbnails",{}))}),u.on("click","a",p),i.scrollCommentsPanelInView=function(){var a=g.offsetTop($("#feedScroller")[0],j.closest(".comments-panel-wrapper")[0]).top-4;$("#feedScroller").animate({scrollTop:a},{duration:250})},i.checkIfCommentsPanelIsInView=function(){var b=j.closest(".comments-panel-wrapper");b=b.length?b:j;var c=b[0].getBoundingClientRect();return c.top>=90&&c.bottom<=(a.innerHeight||document.documentElement.clientHeight)},i.tagCount=0,i.onTagAdded=function(a){i.tagCount+=1},i.onTagRemoved=function(a){i.tagCount-1},i.trackExpandComments=function(){f.trackEvent(f.EXPAND_COMMENTS,{Via:"Newsfeed"})},i.trackCollapseComments=function(){f.trackEvent(f.HIDE_COMMENTS,{Via:"Newsfeed"})},i.drawShaowsIfScrollable=function(a){if(r[0].scrollHeight>r[0].clientHeight){var b=u[0].scrollTop;0==b?(i.loadedCommentsCount>=i.itemData.comments_data.total_comments&&j.find(".comments_info").removeClass("shadow-bottom"),a||j.find(".feed-comment-editor").addClass("shadow-top")):b+u[0].clientHeight+2>=u[0].scrollHeight?(j.find(".comments_info").addClass("shadow-bottom"),j.find(".feed-comment-editor").removeClass("shadow-top")):(j.find(".comments_info").addClass("shadow-bottom"),a||j.find(".feed-comment-editor").addClass("shadow-top"))}else j.find(".comments_info").removeClass("shadow-bottom"),j.find(".feed-comment-editor").removeClass("shadow-top")},i.$on("$destroy",function(){u.off({"mouseenter touchstart":y,mouseleave:z,scroll:B,"mousewheel DOMMouseScroll":C}).off("click","a",p),u=null,i.ScrollPosition=null,r=null,s=r,j=null,x&&clearTimeout(x),x=null}),i.commentsInfoElm=j.find(".comments_info")}},controller:["$scope","Comments","$filter","$q","$timeout",function(b,c,d,e,f){function g(a){a.resource_id===b.itemData.resource_id&&a.updateInfo&&a.updateInfo.addedComments&&a.updateInfo.addedComments.length&&(b.loadedCommentsCount+=a.updateInfo.addedComments.length)}function i(a){b.feed_data.isTextSearch?(b.itemData.comments_data=c.getSearchResultsComments(b.itemData.app_instance_id,b.itemData.resource_id),a||b.$emit("setItemDirty")):(b.itemData.comments_data=c.getComments_newApi(k,b.itemData.resource_id,b.itemData.app_instance_id,!1,0,b.LATEST_COMMENTS_ONLY_COUNT,!0),a||b.$emit("setItemDirty"))}b.LATEST_COMMENTS_ONLY_COUNT=2;var j=10;b.loadingComments=!1,b.comments_expanded=!1,b.commentsInEditMode=0,b.loadedCommentsCount=b.LATEST_COMMENTS_ONLY_COUNT,b.isTextSearch_previousValue=b.feed_data.isTextSearch;var k=h.getFeedIdOfResource(b.itemData.app_instance_id,b.itemData.resource_id),l=!1;b.loadMoreComments=function(){b.loadingComments||(b.loadingComments=!0,b.$emit("setItemDirty"),c.getComments_newApi(k,b.itemData.resource_id,b.itemData.app_instance_id,!0,b.itemData.comments_data.comments.length,j).then(function(a){b.comments_expanded=!0,b.loadingComments=!1,b.loadedCommentsCount+=j,b.$emit("setItemDirty")}))},b.loadAllComments=function(d,f){if(!b.loadingComments){b.loadingComments=!0;var g=e.defer();b.$emit("setItemDirty");var h=b.commentsInfoElm.find(".fetch-more-spinner");return h&&0!=h.length||b.commentsInfoElm.append('<span class="fetch-more-spinner">&nbsp;&nbsp;&nbsp;</span>'),c.getComments_newApi(k,b.itemData.resource_id,b.itemData.app_instance_id,!0,b.feed_data.isTextSearch?0:b.itemData.comments_data.comments.length,10).then(function(e){b.commentsInfoElm.find(".fetch-more-spinner").remove(),b.itemData.comments_data=e,b.comments_expanded=!0,b.loadedCommentsCount=10,b.totalComments=e.total_comments,b.$emit("setItemDirty"),d||a.setTimeout(function(){b.scrollToBottom(),b.ScrollPosition.prepareFor("up")},0),f||a.setTimeout(function(){b.checkIfCommentsPanelIsInView()||b.scrollCommentsPanelInView()},0),c.getComments_newApi(k,b.itemData.resource_id,b.itemData.app_instance_id,!0,0,null).then(function(a){b.loadingComments=!1,b.$emit("setItemDirty"),b.ScrollPosition.restore(),g.resolve()},function(){b.loadingComments=!1})},function(){b.loadingComments=!1}),g.promise}},b.toggleComments=function(){b.comments_expanded?b.showLatestCommentsOnly():b.loadAllComments()},b.showLatestCommentsOnly=function(){b.comments_expanded=!1,b.loadedCommentsCount=b.LATEST_COMMENTS_ONLY_COUNT,b.$broadcast("Comments:showAll"),b.currentlyPlayingSnippetForComment=null,b.newCommentsBadgeSlidesUp(),i()},b.commentWillGoInEdit=function(a,d){b.commentsInEditMode++,c.off("commentsUpdated",g),c.on("commentsUpdated",g),setTimeout(function(){b.setElementInView(d)},400)},b.$on("comment-will-exit-from-edit",function(a){a.stopPropagation(),b.commentsInEditMode--,0===b.commentsInEditMode&&(c.off("commentsUpdated",g),b.comments_expanded||(b.loadedCommentsCount=b.LATEST_COMMENTS_ONLY_COUNT,b.newCommentsBadgeSlidesUp()))}),b.getOpenedResource=function(){return b.itemData},b.$on("cnvFeedItem.aboutToPostComment",function(){l=!0,setTimeout(function(){l=!1},1e3)}),b.$on("cnvFeedItem.commentPosted",function(){b.loadedCommentsCount>b.LATEST_COMMENTS_ONLY_COUNT&&(b.loadedCommentsCount+=1,a.setTimeout(function(){b.scrollToBottom(!0)},100))}),b.$on("render",function(){b.isTextSearch_previousValue!==!0||b.feed_data.isTextSearch!==!1||b.comments_expanded||c.getComments_newApi(k,b.itemData.resource_id,b.itemData.app_instance_id,!1,0,b.LATEST_COMMENTS_ONLY_COUNT).then(function(a){b.itemData.comments_data=a,b.$emit("setItemDirty")}),b.isTextSearch_previousValue=b.feed_data.isTextSearch,b.$broadcast("render:boRepeat:commentItems"),b.drawShaowsIfScrollable(l)}),b.$on("$destroy",function(){c.off("commentsUpdated",g)})}]}}]),b.module("convoApp").directive("cnvFeedVideoPlayerWrapper",["alertsService",function(a){return{restrict:"E",priority:0,scope:!0,templateUrl:"feed/renderers/gallery/cnvFeedVideoPlayerWrapper.tpl.html",link:function(a,b,c){},controller:["$scope","$filter","appsInfo","utils","bannerService",function(b,c,d,e,f){b.playerOptions={},b.playerOptions.resourceLinkUrl=c("getFileResourceLinkUrl")(b.file.id,b.file.file_format,b.itemData.app_instance_id,b.itemData.resource_type,b.file.noteId,b.file.name),b.playerOptions.onExpand="feedView",b.playerOptions.location="feed",b.playerOptions.source="News Feed",b.playerOptions.showHeader=!0,b.playerOptions.showControlsMenu=!0,b.onFileDeleted=function(){function c(){a.promptModal('Delete "'+b.file.name+'"',"Are you sure you want to delete this file?",function(){var a=d.getAppMainService(d.NOTES_APP),c=a.deleteFile(b.itemData.resource_id,b.itemData.app_instance_id,b.file.id);c.then(function(a){var c=e.findIndexInObjectArray(b.itemData.data.files,"id",b.file.id);-1!=c&&(b.itemData.data.files.splice(c,1),b.$broadcast("render"))}),f.showBanner_promise(c,"Deleting file...","Deleted","Error... click here to try again",!1,!1,c)},null,"Delete")}d.isAppRegistered(d.NOTES_APP)?c():d.once(d.NOTES_APP+"Registered",c)}}]}}]),b.module("convoApp").directive("cnvNoteGallery",["$templateCache","$compile","$filter","$rootScope","$location","mixpanelService","utils","getOriginalImagePathFilter","getFileExtensionFilter","$sce","bannerService","appsInfo","alertsService",function(b,d,e,f,g,h,j,k,l,m,n,o,p){return{restrict:"E",replace:!0,controller:["$scope","AppLinks",function(b,m){function q(){b.feed_data.isTextSearch?R.removeClass("text-search-not-applied").addClass("text-search-applied"):R.removeClass("text-search-applied").addClass("text-search-not-applied")}function r(){"hidden"!=b.feedGalleryContainer.style.overflowX&&(P=R.scrollLeft())}function s(){R.scrollLeft(P)}function t(){if(S){b.filesList=b.itemData.data.files,b.filesSearchMatches=b.itemData.viewData.filesSearchMatches||{};var a=!1,c=b.itemData.permissions.checkBitAt(3);c!==J&&(a=!0,J=c);for(var d=!1,e=0;e<b.filesList.length;e++)if(b.filesConversionStatus[b.filesList[e].id]!=b.filesList[e].available_previews){d=!0;break}if(b.lastFilesCount!=b.filesList.length||b.latestRevisionNumber>1&&b.latestRevisionNumber<b.filesList[b.filesList.length-1].insert_revision||V||d){if(b.isVideoPlaying())return Q=!0,!1;Q=!1,S.empty(),b.latestRevisionNumber=1,b.latestFilesCount=0,b.lastFilesCount=b.filesList.length.valueOf(),v(),f.$$phase||b.$digest(),b.$emit("setItemDirty"),V=!1}else u(!1),a&&b.$broadcast("cnvNoteGallery.postPermissionsChanged",J)}}function u(a){if(a){var b=I.find(".latest-files-badge").first();if(b&&b.parent().position()){var c=R.scrollLeft()+b.parent().position().left;R.scrollLeft(c)}}else if(P>=0)s();else{var b=I.find(".latest-files-badge").first();if(b&&b.parent().position()){var c=R.scrollLeft()+b.parent().position().left;R.scrollLeft(c)}}}function v(){var a=b.filesList.slice(),c=a.length;b.initialThumbsCombinedWidth=0,b.hasVideo=!1,W=[],ca=0,b.cachedThumbsPositions=[],ba=null,aa=null;for(var d=0;c>d;d++)W.push(x(a[d],c,d));ba?aa.prepend('<i class="latest-files-badge">'+b.latestFilesCount+" new</i>"):ca=2;for(var d=ca-2;ca+4>d;d++)0>d&&(d=0),b.cachedThumbsPositions[d]&&w(b.cachedThumbsPositions[d]);S.append(W),ba&&(R.scrollLeft(ba),P=ba),b.initialThumbsCombinedWidth<b.containerWidth&&($(X).remove(),X=null)}function w(a){var b=a.itemImage,c=a.imgLink;if(b.length&&c){a.isLoaded=!0;var d=a.gifLink;if(d){var e=b.closest("li");e.find(".cnv-spinner").show(),e.find(".gif-badge").show(),b.on("load",function(){var b=$(this);if(b.attr("src")==d){b.off("load").off("error");var c=b.closest("li");c.find(".cnv-spinner").hide(),c.find(".gif-badge").hide()}else a.isLoaded?b.attr("src",d):b.off("load").off("error")})}b.on("error",function(){b.off("error"),setTimeout(function(){var a=new Image;a.src=c},1e3)}),b.attr("src",c)}}function x(a,c,f){if(b.filesConversionStatus[a.id]=a.available_previews,"OTHER"!==a.file_format&&"SUCCESS"===a.status&&a.thumbnail_name){if(a.width<L&&a.height<K)a.thumbWidth=a.width,a.thumbHeight=a.height,a.containerWidth=L+2,a.containerHeight=K+2;else{var g=K/a.height,h=M/a.width,m=Math.min(g,h),n=Math.ceil(m*a.width),o=Math.ceil(m*a.height);a.thumbWidth=n,a.thumbHeight=o,a.containerWidth=n+2,a.containerHeight=K+2}a.thumbnail_image=e("getNoteThumbnailPath")(a,b.noteId,i)}else a.thumbnail_class=e("getNewFileIconByType")(a.type,"64","darkgray"),a.width=b.FILE_ICONS_SIZE,a.height=b.FILE_ICONS_SIZE,a.containerWidth=L,a.containerHeight=K;a.isThumbnailAvailable=32&a.available_previews,a.isMp4PreviewAvailable=64&a.available_previews,a.isWebmPreviewAvailable=128&a.available_previews,a.isMp4Available=256&a.available_previews,a.isWebmAvailable=512&a.available_previews,a.canPlayVideoType=j.formatCheck("video",a),a.noteId=b.noteId,a.firstItemClass=0===f?"first-item":"",a.minWidthStyle=Math.max(a.containerWidth,180),b.initialThumbsCombinedWidth+=a.minWidthStyle+5,a.isGif="gif"===a.type,a.isGif&&(b.itemData.imagesScope=b,b.itemData.hasGifsInReel=!0),a.isVideo="VIDEO"===a.file_format,a.isAudio="Audio"===j.getFileFormat(a.type),a.isDoc="DOC"===a.file_format,a.isVideoDocOrOther=a.isVideo||"DOC"===a.file_format||"OTHER"===a.file_format,a.isImagePendingConversion="IMAGE"===a.file_format&&"SUCCESS"!==a.status,a.fileResourceLinkUrl=b.getFileResourceLinkUrl(a.id,a.file_format,a.name),a.originalImagePath=k(a.original_name||"",a.noteId),a.previewPath=e("getFilePreviewPath")(a.preview_name||"",a.original_name||"",a.item_id,a.app_instance_id),a.fileExt=l(a.name);var p=b.filesSearchMatches[a.id];p&&(a.numSearchMatches=p.total_word_occurrences,a.highlightedName=p.file_matching_name),a.canDeleteFile=J;var q=$(z(a));if(a.isVideo){b.hasVideo=!0;var r=b.$new(!1);r.file=a,q.prepend(d(y(a))(r))}if(a.isAudio){var r=b.$new(!1);r.file=a,r.resourceLinkUrl=e("getFileResourceLinkUrl")(a.id,a.file_format,b.itemData.app_instance_id,b.itemData.resource_type,a.noteId,a.name),q.prepend(d('<cnv-audio-player data-show-menu="true"></cnv-audio-player>')(r))}var s=+a.insert_revision;s>b.latestRevisionNumber&&(b.latestRevisionNumber=s,b.latestFilesCount=c-f,b.latestFilesCount>0&&(aa=q,ba=b.initialThumbsCombinedWidth-(a.containerWidth+5),ca=f));var t=b.initialThumbsCombinedWidth-(a.minWidthStyle+5);return b.cachedThumbsPositions[f]={id:a.id,left:t,right:b.initialThumbsCombinedWidth,imgLink:a.isVideo?null:a.thumbnail_image,gifLink:a.isGif?a.originalImagePath:null,isLoaded:!1,itemImage:a.isVideo?[]:q.find("img")},q}function y(a){return'<div class="feedVideoHolder"><div style="position: relative; width: 0px; height: 0px; left: -1px"><div class="sizeable" id="sizeable'+a.id+'"></div></div><a class="thumb-wrapper video-thumb-wrapper" href="'+a.fileResourceLinkUrl+'"><cnv-video-thumbnail cnv-video-thumbnail-data-format="FEED" cnv-video-thumbnail-lazy-load="true"cnv-video-thumbnail-lazy-load-id="'+b.itemData.feed_id+'" cnv-video-thumbnail-file="file" cnv-video-thumbnail-scrolling-holder="feedGalleryContainer" cnv-video-thumbnail-show-preview="true"></cnv-video-thumbnail></a></div>'}function z(a,b){var c='<li style="width:'+a.containerWidth+"px;min-width:"+a.minWidthStyle+'px" class="mainLi" id="mainLi'+a.id+'"><a style="width:100%;height:100%;margin: 0px; display: block;"  href="'+a.fileResourceLinkUrl+'">';return a.numSearchMatches&&a.numSearchMatches>0&&(c+='<i class="search-matches-badge">'+a.numSearchMatches+" match"+(a.numSearchMatches>1?"es":"")+"</i>"),a.isVideo||(a.isGif&&(c+='<i class="gif-badge">GIF</i><i class="cnv-spinner light"></i>'),a.thumbnail_image&&(c+='<img class="feedReelImage" id="'+a.id+'" data-thumb="'+a.thumbnail_image+'" type="'+a.type,a.isGif?c+='" data-gif="'+a.originalImagePath:a.isDoc&&(c+='" data-preview="'+a.previewPath),c+='" style="width:'+a.thumbWidth+"px; height:"+a.thumbHeight+'px"',c+=a.height<250?' class="middle-align"/></a>':" />"),a.thumbnail_class&&(c+='<i class="'+a.thumbnail_class+'"></i>')),(a.isVideoDocOrOther||a.isImagePendingConversion)&&(c+='<div class="file-detail-tab"><i class="ext_holder cnv-small-file-ico '+a.fileExt+'"><span class="fileExt">'+_.escape(a.fileExt)+'</span></i><span class="filename">'+(a.highlightedName?a.highlightedName:_.escape(a.name))+"</span></div>"),c+="</a></li>"}function A(){var a,c,d,e,f=0,g=b.cachedThumbsPositions.length,h=S.position().left;for(P=R.scrollLeft(),X&&(b.containerWidth-h>b.initialThumbsCombinedWidth-1?X.style.display="none":X.style.display="block");g>f;f++)a=b.cachedThumbsPositions[f],
a&&(c=a.left,e=a.right,d=a.isLoaded,!d&&c<b.containerWidth-h+200&&e+h>-200?w(a):d&&(-h-500>e||c>-h+b.containerWidth+500)&&(a.isLoaded=!1,a.itemImage.attr("src",ea)))}function B(a){a?(r(),document.body.style.overflow="hidden",document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen()):(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),C())}function C(){document.body.style.overflow="auto",I.find(".sizeable").removeClass("fullscreen"),P>-1&&s()}function D(){null===document.fullscreenElement&&C()}function E(){null===document.mozFullScreenElement&&C()}function F(){null===document.webkitFullscreenElement&&C()}function G(){null===document.msFullscreenElement&&C()}var H=$(".feed-cont cnv-feed-item"),I=H.eq(b.getFeed().indexOf(b.itemData)).find("#note-gallery-directive");b.filesConversionStatus=[],b.filesSearchMatches=b.itemData.viewData.filesSearchMatches||{};var J=b.itemData.permissions.checkBitAt(3),K=220,L=250,M=485,N=495,O=278,P=-1,Q=!1;b.filesList=b.itemData.data.files,b.noteId=b.itemData.resource_id,b.appId=b.itemData.app_instance_id,b.resourceType=b.itemData.resource_type,b.filesConversionStatus=[],b.latestRevisionNumber=1,b.latestFilesCount=0;var R=$(".feedGalleryContainer",I),S=R.find("ul");b.feedGalleryContainer=R[0],b.getFileResourceLinkUrl=function(a,c,d){return e("getFileResourceLinkUrl")(a,c,b.appId,b.resourceType,b.noteId,d)},b.isVideoPlaying=function(){for(var a=$("video.feedVideoPlayer",I),b=0;b<a.length;b++){var c=a[b];if(!c.paused)return!0}return $(".videoPlaying",I).length>0?!0:!1},b.openFile=function(a,c,d){g.url(decodeURIComponent(b.getFileResourceLinkUrl(a,c,d).substr(2)))},b.unloadImages=function(){for(var a,c=b.cachedThumbsPositions.length,d=0;c>d;d++)if(a=b.cachedThumbsPositions[d],a&&a.isLoaded&&a.gifLink){var e=a.itemImage,f=e.closest("li");f.find(".cnv-spinner").hide(),f.find(".gif-badge").hide(),e.attr("src",a.imgLink).off("load")}},b.reloadImages=function(){for(var a,c=b.cachedThumbsPositions.length,d=0;c>d;d++)if(a=b.cachedThumbsPositions[d],a&&a.isLoaded&&a.gifLink){var e=a.itemImage,f=e.closest("li");f.find(".cnv-spinner").hide(),f.find(".gif-badge").hide(),e.attr("src",a.gifLink)}};var T=!1;b.lastFilesCount=b.filesList.length.valueOf(),b.FILE_ICONS_SIZE=32;b.MAXIMUM_THUMBS_TO_SHOW=10;var U=!1,V=!1,W=null;q(),b.isVideoPlaying=function(){for(var a=$("video.feedVideoPlayer",I),b=0;b<a.length;b++){var c=a[b];if(!c.paused)return!0}return $(".videoPlaying",I).length>0?!0:!1},b.tab.selected?v():V=!0,b.containerWidth=495;var X=I.find(".overlay")[0],Y=function(a,c,d,e){if(T||(h.trackEvent(h.SCROLLED_IMAGE_GALLERY),T=!0),!j.isIE()){var f=Math.abs(d),g=Math.abs(e);if(f>g){(0==b.reelWidth||"undefined"==typeof b.reelWidth)&&(b.reelWidth=I.find(".feedGalleryContainer > ul")[0].scrollWidth);var i=R.scrollLeft(),k=0>d&&0==i,l=d>0&&i+b.containerWidth+5>=b.reelWidth;if(k||l)return a.stopPropagation(),a.preventDefault(),!1}}},Z=function(a,b,c,d){da||(da=setTimeout(function(){A(),da=null},100))};setTimeout(function(){R&&(b.feedGalleryContainer&&b.feedGalleryContainer.addEventListener("scroll",Z),R&&R.on({mousewheel:Y}))},10);var aa,ba,ca,da=null;b.openFile=function(a,c,d){g.url(decodeURIComponent(b.getFileResourceLinkUrl(a,c,d).substr(2)))};var ea="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";b.$on("render",function(){return b.itemData._hide?-1:(b.tab.selected&&!U?a.setTimeout(function(){t()},0):U=!0,void q())}),b.$on("filterChange",function(){a.setTimeout(function(){(U||V)&&(t(),U=!1)},0)}),b.$on("activated",function(b){a.setTimeout(function(){(U||V)&&(t(),U=!1)},0)}),b.$on("cnvNoteGallery:forceRender",function(a){S.empty(),b.latestRevisionNumber=1,b.latestFilesCount=0,b.lastFilesCount=b.filesList.length.valueOf(),v(),f.$$phase||b.$digest(),b.$emit("setItemDirty"),V=!1}),b.$on("$destroy",function(){if(b.feedGalleryContainer.removeEventListener("scroll",Z),R.off({mousewheel:Y}),R.off(),b.cachedThumbsPositions)for(var a,d=b.cachedThumbsPositions.length,e=0;d>e;e++)a=b.cachedThumbsPositions[e],a.itemImage&&a.itemImage.attr&&(a.itemImage.attr("src",ea).off("load").off("error"),a.itemImage.remove()),a=null,b.cachedThumbsPositions[e]=null;b.cachedThumbsPositions=null,b.itemData.imagesScope==b&&(b.itemData.imagesScope=null,b.itemData.hasGifsInReel=null),I.find("li").off("mouseover"),I.find("video").off("click").off(),I.find("img").each(function(){this.src=ea,$(this).off("load").off("error")}),I.find("*").off(),R=null,$(X).remove(),X=null,S=null,b.feedGalleryContainer=null,document.fullscreenEnabled!==c?document.removeEventListener("fullscreenchange",D,!1):document.mozFullScreenEnabled!==c?document.removeEventListener("mozfullscreenchange",E,!1):document.webkitFullscreenEnabled!==c?document.removeEventListener("webkitfullscreenchange",F,!1):document.msFullscreenEnabled!==c&&document.removeEventListener("MSFullscreenChange",G,!1),H=null,I=null}),b.$on("VideoPlayback:clicked",function(a,c){function e(){b.$broadcast("VideoPlayback:playVideo",c),j.isIE(),g.removeEventListener("transitionend",e,!1)}var f=I.find("#sizeable"+c.id),g=f[0],h=I.find("#mainLi"+c.id),i=h.find(".feedVideoHolder")[0],k=i.getClientRects()[0];if(f.find("video").length<1){var l=j.findIndexInObjectArray(b.filesList,"id",c.id),m=b.$new(!1);m.file=b.filesList[l],m.file.item_id=b.noteId;var n=d("<cnv-feed-video-player-wrapper></cnv-feed-video-player-wrapper>")(m);f.append(n)}var o=g.style;o.height=k.height+"px",o.width=k.width+"px",o.left="0px",o.top="0px",o.transition="all 0.25s",o.display="block";var p=b.feedGalleryContainer.style;p.overflowX="hidden",p.minWidth=N+"px",p.minHeight=O+"px",g.setAttribute("cleaned",0),setTimeout(function(){var a=b.feedGalleryContainer.getClientRects()[0],c=a.left-k.left-1,d=g.style;d.height=O+"px",d.width=N+"px",d.left=c+"px",d.opacity="1",g.addEventListener("transitionend",e,!1)},0)}),b.$on("VideoPlayback:cleanUp",function(a,c){function d(){f.removeEventListener("transitionend",d,!1),$(f).hide(100),b.feedGalleryContainer.style.overflowX="auto",b.feedGalleryContainer.style.minWidth="0px",b.feedGalleryContainer.style.minHeight="0px",Q&&t()}var e=c.force||!1;if(!e&&b.filesList.length<2)return!1;var f=I.find("#sizeable"+c.id)[0];if(0==f.getAttribute("cleaned")){f.setAttribute("cleaned",1);var g=I.find("#mainLi"+c.id)[0],h=f.getClientRects()[0],i=g.getClientRects()[0],j=c.withoutAnomation||!1;if($("#videoPlayer"+c.id).trigger("playerCollapsed"),h&&!j){i.left-h.left-5;f.style.height=i.height-3+"px",f.style.width=i.width-2+"px",f.style.left="1px",f.style.top="1px",f.style.transition="all 0.25s",f.addEventListener("transitionend",d,!1)}else f.style.display="none",b.feedGalleryContainer.style.overflowX="auto",b.feedGalleryContainer.style.minWidth="0px",b.feedGalleryContainer.style.minHeight="0px",f.style.opacity="0",Q&&t()}}),b.$on("NotesApp:FullScreen",function(a,b){if(1==b.isVideo){var c=I.find("#sizeable"+b.id);c.length>0&&(b.isFullScreen&&c.addClass("fullscreen"),B(b.isFullScreen))}}),document.fullscreenEnabled!==c?document.addEventListener("fullscreenchange",D,!1):document.mozFullScreenEnabled!==c?document.addEventListener("mozfullscreenchange",E,!1):document.webkitFullscreenEnabled!==c?document.addEventListener("webkitfullscreenchange",F,!1):document.msFullscreenEnabled!==c&&document.addEventListener("MSFullscreenChange",G,!1),b.$on("cnvAudioPlayer.deleteFile",function(a,c){function d(){p.promptModal('Delete "'+c.name+'"',"Are you sure you want to delete this file?",function(){var a=o.getAppMainService(o.NOTES_APP),d=a.deleteFile(b.itemData.resource_id,b.itemData.app_instance_id,c.id);d.then(function(){var a=j.findIndexInObjectArray(b.itemData.data.files,"id",c.id);-1!==a&&(b.itemData.data.files.splice(a,1),b.$broadcast("render"))}),n.showBanner_promise(d,"Deleting file...","Deleted","Error... click here to try again",!1,!1,d)},null,"Delete")}o.isAppRegistered(o.NOTES_APP)?d():o.once(o.NOTES_APP+"Registered",d)})}]}}]),b.module("convoApp").factory("inFeedActionService",["ServerComm","dialogService",function(a,b){var c={Edit:function(){},AddTags:function(){},starThisPost:function(){},shareWithOthers:function(){},copyPostLink:function(){}};return c}]),b.module("convoApp").directive("cnvFeedItemAppid4Restype4",["$filter","loader","config","utils",function(b,d,e,f){return{restrict:"A",link:function(b,g){function h(){null===document.fullscreenElement?m():l()}function i(){null===document.mozFullScreenElement?m():l()}function j(){null===document.webkitFullscreenElement?m():l()}function k(){null===document.msFullscreenElement?m():l()}function l(){var a;b.isYTURL?a=g.find(".youtubeIframe"):b.isVimeoURL&&(a=g.find(".viemoIframe")),a&&setTimeout(function(){a.height()===screen.height&&(N=!0)},1e3)}function m(){N&&($(a).scrollTop(O),N=!1)}function n(){C(b.itemData.data.source);g.find(".youtubeIframe").attr("id","ytplayer"+L),d.loadExternalScript(d.EXTERNAL_SCRIPTS.YOUTUBE_API).then(function(){if(1==YT.loaded)o();else var a=setInterval(function(){console.log("Check YT API"),1==YT.loaded&&(o(),console.log("YT API loaded"),clearInterval(a))},50)})}function o(){var b=e.IS_NATIVE?0:1;H=new YT.Player("ytplayer"+L,{height:"278",width:"495",videoId:P,playerVars:{fs:b,html5:1},events:{onStateChange:"onYoutubePlayerStateChange"}}),a.document.addEventListener("onYoutubePlayerStateChange",p),I=!0}function p(a){var b=a.detail;b.target==H&&(b.data!=YT.PlayerState.PLAYING||K?K=!1:(q(),K=!0),(b.data==YT.PlayerState.ENDED||b.data==YT.PlayerState.PAUSED)&&E())}function q(){var a={id:b.itemData.feed_id};b.$emit("VideoPlayback:Playing",a),D()}function r(){"function"==typeof H.stopVideo&&H.stopVideo()}function s(){H=g.find(".viemoIframe"),H&&a.addEventListener("message",t,!1)}function t(a){if(!/^https?:\/\/player.vimeo.com/.test(a.origin))return!1;"*"===J&&(J=a.origin);var c=JSON.parse(a.data);if(c.player_id==b.itemData.feed_id)switch(c.event){case"ready":v();break;case"pause":E();break;case"play":w();break;case"finish":E()}}function u(){b.isVimeoURL?x("play"):H.playVideo()}function v(){x("addEventListener","play"),x("addEventListener","pause"),x("addEventListener","finish"),x("addEventListener","playProgress")}function w(){var a={id:b.itemData.feed_id};b.$emit("VideoPlayback:Playing",a),D()}function x(a,b){var c,d={method:a};b&&(d.value=b);var e=JSON.stringify(d);null==H[0].contentWindow?c=setInterval(function(){H[0].contentWindow&&(clearInterval(c),H[0].contentWindow.postMessage(e,J))},50):H[0].contentWindow.postMessage(e,J)}function y(a){var b=/(videos|video|channels|staffpicks|\.com)\/([\d]+)/,c=a.match(b);return c?c[2]:!1}function z(){x("pause")}function A(a,c){b.isVimeoURL&&z(),b.isYTURL&&r()}function B(a,c){c.id!=b.itemData.feed_id&&(b.isVimeoURL&&z(),b.isYTURL&&r())}function C(a){var b=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,c=a.match(b);return c&&11==c[7].length?c[7]:!1}function D(){g.addClass("videoPlaying"),M=!0}function E(){g.removeClass("videoPlaying"),M=!1}function F(){O=$(a).scrollTop()}function G(a,b){"undefined"!=typeof a&&"undefined"!=typeof b&&(a.destroy(),b.attr("src","about:blank"),b.remove())}var H,I=!1,J="*",K=!1,L=f.generateUniqueId(),M=!1,N=!1,O=0;if(b.isYTURL){var P=C(b.itemData.data.source);b.YTLink="https://www.youtube.com/embed/"+P+"?version=3&enablejsapi=1&origin=https://localhost.convo.com",b.itemData.data.favicon_converted||(b.itemData.data.original_favicon_url="assets/img/videoPlayback/youtube.png"),n()}if(b.isVimeoURL){var Q=y(b.itemData.data.source);b.vimeoLink="https://player.vimeo.com/video/"+Q+"?api=1&player_id="+b.itemData.feed_id,b.itemData.data.favicon_converted||(b.itemData.data.original_favicon_url="assets/img/videoPlayback/viemo.png"),s()}b.onItemClicked=function(){if(b.isYTURL||b.isVimeoURL)if(e.IS_NATIVE&&b.isVimeoURL)a.open(b.itemData.data.source);else{var c=g.find(".link-feed-thumbnail-wrapper").width(),d=g.find(".link-feed-thumbnail-wrapper").height();g.find(".link-feed-thumbnail-wrapper").hide(),g.find(".link-feed-description")[0].style.display="none";var f=g.find(".feedExternalVideoHolder").show().find("iframe");f.css({width:c,height:d,transition:"none"}),f.attr("src",b.vimeoLink),setTimeout(function(){f.css({transition:"all 0.3s",width:"495px",height:"278px"}),u()},1)}},document.fullscreenEnabled!==c?document.addEventListener("fullscreenchange",h,!0):document.mozFullScreenEnabled!==c?document.addEventListener("mozfullscreenchange",i,!0):document.webkitFullscreenEnabled!==c?document.addEventListener("webkitfullscreenchange",j,!0):document.msFullscreenEnabled!==c&&document.addEventListener("MSFullscreenChange",k,!0),b.$on("$locationChangeStart",A),b.$on("VideoPlayback:stopBuffering",B),g.find(".feedExternalVideoHolder").on("mouseover",F),b.$on("$destroy",function(){g.find(".feedExternalVideoHolder").off("mouseover",F),a.removeEventListener("message",t,!1),document.fullscreenEnabled!==c?document.removeEventListener("fullscreenchange",h,!0):document.mozFullScreenEnabled!==c?document.removeEventListener("mozfullscreenchange",i,!0):document.webkitFullscreenEnabled!==c?document.removeEventListener("webkitfullscreenchange",j,!0):document.msFullscreenEnabled!==c&&document.removeEventListener("MSFullscreenChange",k,!0),H&&(I?(a.document.removeEventListener("onYoutubePlayerStateChange",p),G(H,g.find(".youtubeIframe"))):b.isVimeoURL&&(z(),x("removeEventListener","play"),x("removeEventListener","pause"),x("removeEventListener","finish"),x("removeEventListener","playProgress"),H.src=""))})},controller:["$scope",function(a){a.isYTURL=a.itemData.data.source.toLowerCase().indexOf("youtube.com")>-1||a.itemData.data.source.toLowerCase().indexOf("youtu.be")>-1?!0:!1,a.isVimeoURL=a.itemData.data.source.toLowerCase().indexOf("vimeo.com")>-1?!0:!1,a.linkThumbnailUrl="",a.itemData.data.thumbnail_converted&&a.itemData.data.thumbnailURL?a.linkThumbnailUrl=b("getLinkThumbnailPath")(a.itemData.data.thumbnailURL,a.itemData.data.ver):a.itemData.data.thumbnailURL&&(a.linkThumbnailUrl=e.AWS_FILE_DIR_BASE+a.itemData.data.thumbnailURL)}]}}]),b.module("convoApp").directive("cnvFeedItemAppid6Restype6",["noteFeedItemService","mixpanelService","utils",function(a,b,c){return{restrict:"A",link:function(d,e,f){function g(){var a,b=e.find(".note-details"),c=function(){d.viewState=d.VIEW_STATES.COMPLETE,b.find(".fetch-more-spinner").remove(),d.$broadcast("render")};if(d.details_complete_content)a=new Promise(function(a,b){a()}),c();else{a=h();var f=b.find(".fetch-more-spinner");f&&0!=f.length||b.append('<span class="fetch-more-spinner">&nbsp;&nbsp;&nbsp;</span>'),a.then(c)}return a}function h(){return i?j:j=new Promise(function(c,e){i=!0,a.getFullText(d.itemData.resource_id).then(function(a,e){i=!1,d.details_complete_content=a.data.large_summary,b.trackEvent(b.CLICK_EXPAND_POST),c()})})}var i=!1,j=null;d.noteFeedItemCtrl.loadCompleteNoteText=g,d.onDetailsContentToggle=function(a){a===d.VIEW_STATES.SUMMARY?$("#feedScroller").animate({scrollTop:c.offsetTop($("#feedScroller")[0],e[0]).top-124},{duration:250,always:function(){d.viewState=d.VIEW_STATES.SUMMARY,d.$broadcast("render"),b.trackEvent(b.CLICK_MINIMIZE_POST)}}):a===d.VIEW_STATES.COMPLETE&&g(),d.$emit("Feed:moreLessButtonClicked")},d.viewState===d.VIEW_STATES.COMPLETE&&g(),d.$on("render",function(){d.$emit("Feed:hideNoteSnippetPlaybackBanner"),d.viewState===d.VIEW_STATES.COMPLETE&&d.itemData._content_updated&&(d.itemData._content_updated=!1,d.details_complete_content=null,g())})},controller:["$scope",function(a){a.VIEW_STATES={SUMMARY:1,COMPLETE:2},a.viewState=a.VIEW_STATES.SUMMARY}]}}]),b.module("convoApp").factory("noteFeedItemService",["ServerComm",function(a){var b={};return b.getLargeSummary=function(b){var c={item_id:b,method:"getLargeSummary"};return a.get("note",{params:c})},b.getFullText=function(b){var c={item_id:b,method:"getLargeSummary",get_full_text:!0};return a.get("note",{params:c})},b}]),b.module("convoApp").factory("FeedSearchAutoCompleteUtils",["FilterTypes",function(a){function b(a){for(var b=0,c=a.indexOf('"');-1!=c;)b++,c=a.indexOf('"',c+1);if(b%2!=0)return a.lastIndexOf('"')+1;c=0;for(var d,e,i=f,j=0;j<i.length;j++)d=i[j],e=a.lastIndexOf(d),e>c&&(c=e+d.length);e=a.lastIndexOf(h),e>c&&(c=e+1);for(var j=0;j<g.length;j++)e=a.lastIndexOf(g[j]+" "),e>=c&&(0===e||" "===a.charAt(e-1))&&(c=e+g[j].length+1);return e=a.lastIndexOf("#"),e>=c&&(0===e||" "===a.charAt(e-1))&&(c=e+1),c}function c(c){for(var d=b(c);d>0;){for(var f=!1,g=0;g<e.length;g++)if(c.charAt(d-1)==e[g]){d--,f=!0;break}if(c.charAt(d-1)==h&&(d--,f=!0),!f)break}var i=a.WORDS;if(0==d)return a.WORDS;if(-1!=c.lastIndexOf(a.TO,d)&&c.lastIndexOf(a.TO,d)+a.TO.length==d?(d=c.lastIndexOf(a.TO,d),i=a.TO):-1!=c.lastIndexOf(a.FROM,d)&&c.lastIndexOf(a.FROM,d)+a.FROM.length==d?(d=c.lastIndexOf(a.FROM,d),i=a.FROM):-1!=c.lastIndexOf(a.DISCUSSIONS,d)&&c.lastIndexOf(a.DISCUSSIONS,d)+a.DISCUSSIONS.length==d?(d=c.lastIndexOf(a.DISCUSSIONS,d),i=a.DISCUSSIONS):-1!=c.lastIndexOf(a.COMMENTS,d)&&c.lastIndexOf(a.COMMENTS,d)+a.COMMENTS.length==d?(d=c.lastIndexOf(a.COMMENTS,d),i=a.COMMENTS):-1!=c.lastIndexOf(a.IN,d)&&c.lastIndexOf(a.IN,d)+a.IN.length==d?(d=c.lastIndexOf(a.IN,d),i=a.IN):-1!=c.lastIndexOf(a.IS,d)&&c.lastIndexOf(a.IS,d)+a.IS.length==d?(d=c.lastIndexOf(a.IS,d),i=a.IS):-1!=c.lastIndexOf(a.HAS,d)&&c.lastIndexOf(a.HAS,d)+a.HAS.length==d?(d=c.lastIndexOf(a.HAS,d),i=a.HAS):-1!=c.lastIndexOf(a.GROUP,d)&&c.lastIndexOf(a.GROUP,d)+a.GROUP.length==d?(d=c.lastIndexOf(a.GROUP,d),i=a.GROUP):-1!=c.lastIndexOf(a.USER,d)&&c.lastIndexOf(a.USER,d)+a.USER.length==d?(d=c.lastIndexOf(a.USER,d),i=a.USER):-1!==c.lastIndexOf(a.TAG_HASH,d)&&c.lastIndexOf(a.TAG_HASH,d)+a.TAG_HASH.length===d?(d=c.lastIndexOf(a.TAG_HASH,d),i=a.TAG):-1!=c.lastIndexOf(a.TAGS,d)&&c.lastIndexOf(a.TAGS,d)+a.TAGS.length==d?(d=c.lastIndexOf(a.TAGS,d),i=a.TAG):-1!=c.lastIndexOf(a.TAG,d)&&c.lastIndexOf(a.TAG,d)+a.TAG.length==d?(d=c.lastIndexOf(a.TAG,d),i=a.TAG):-1!=c.lastIndexOf(a.FILENAME,d)&&c.lastIndexOf(a.FILENAME,d)+a.FILENAME.length==d?(d=c.lastIndexOf(a.FILENAME,d),i=a.FILENAME):-1!=c.lastIndexOf(a.TEXT,d)&&c.lastIndexOf(a.TEXT,d)+a.TEXT.length==d&&(d=c.lastIndexOf(a.TEXT,d),i=a.TEXT),0==d)return i;for(var j=0;j<e.length;j++)if(c.charAt(d-1)==e[j])return i;return a.WORDS}function d(c){for(var d=b(c);d>0;){for(var f=!1,g=0;g<e.length;g++)if(c.charAt(d-1)==e[g]){d--,f=!0;break}if(c.charAt(d-1)==h&&(d--,f=!0),!f)break}return 0==d?-1:-1!=c.lastIndexOf(a.TO,d)&&c.lastIndexOf(a.TO,d)+a.TO.length==d?c.lastIndexOf(a.TO,d):-1!=c.lastIndexOf(a.FROM,d)&&c.lastIndexOf(a.FROM,d)+a.FROM.length==d?c.lastIndexOf(a.FROM,d):-1!=c.lastIndexOf(a.DISCUSSIONS,d)&&c.lastIndexOf(a.DISCUSSIONS,d)+a.DISCUSSIONS.length==d?c.lastIndexOf(a.DISCUSSIONS,d):-1!=c.lastIndexOf(a.COMMENTS,d)&&c.lastIndexOf(a.COMMENTS,d)+a.COMMENTS.length==d?c.lastIndexOf(a.COMMENTS,d):-1!=c.lastIndexOf(a.IN,d)&&c.lastIndexOf(a.IN,d)+a.IN.length==d?c.lastIndexOf(a.IN,d):-1!=c.lastIndexOf(a.IS,d)&&c.lastIndexOf(a.IS,d)+a.IS.length==d?c.lastIndexOf(a.IS,d):-1!=c.lastIndexOf(a.HAS,d)&&c.lastIndexOf(a.HAS,d)+a.HAS.length==d?c.lastIndexOf(a.HAS,d):-1!=c.lastIndexOf(a.GROUP,d)&&c.lastIndexOf(a.GROUP,d)+a.GROUP.length==d?c.lastIndexOf(a.GROUP,d):-1!=c.lastIndexOf(a.USER,d)&&c.lastIndexOf(a.USER,d)+a.USER.length==d?c.lastIndexOf(a.USER,d):-1!==c.lastIndexOf(a.TAG_HASH,d)&&c.lastIndexOf(a.TAG_HASH,d)+a.TAG_HASH.length===d?c.lastIndexOf(a.TAG_HASH,d):-1!=c.lastIndexOf(a.TAGS,d)&&c.lastIndexOf(a.TAGS,d)+a.TAGS.length==d?c.lastIndexOf(a.TAGS,d):-1!=c.lastIndexOf(a.TAG,d)&&c.lastIndexOf(a.TAG,d)+a.TAG.length==d?c.lastIndexOf(a.TAG,d):-1!=c.lastIndexOf(a.FILENAME,d)&&c.lastIndexOf(a.FILENAME,d)+a.FILENAME.length==d?c.lastIndexOf(a.FILENAME,d):-1!=c.lastIndexOf(a.TEXT,d)&&c.lastIndexOf(a.TEXT,d)+a.TEXT.length==d?c.lastIndexOf(a.TEXT,d):d+1}var e=[" ","+"," and "," or ",'"',"(",")","<",">","|"],f=["+"," and "," or ",'"',"(",")","<",">","|"],g=["from","to","has","is","in"],h=":";return{searchForKey:b,getType:c,getSearchStart:d}}]),b.module("convoApp").directive("cnvUploadFileUi",function(){return{restrict:"A",scope:!0,link:function(a,b,c){a.dontWaitForConversion="dontWaitForConversion"===c.cnvUploadFileUi},controller:["$scope","UploadService","popoverUtils","$timeout",function(a,b,c,d){function e(){}function f(c,d){if(a.file===d.file){var c=d.event;if(c===b.EVENT_UPLOAD_PROGRESS||c===b.EVENT_UPLOAD_FAILED)a.$$phase||a.$digest();else if(c===b.EVENT_FILE_CONVERSION_REQ_FAILED)g=d.file_input_context,a.$$phase||a.$digest();else if(c===b.EVENT_FILE_CONVERSION_FAILED)"chat-window"!==a.file.uploadFrom||a.$$phase||a.$digest(a.files);else if(c===b.EVENT_FILE_CONVERSION_COMPLETE&&a.message&&a.message.fileInfo.file){a.file.fileUploaded=!0;var e=+a.file.width,f=+a.file.height;e>f&&e>200&&(f*=200/e,e=200),f>200&&(e*=200/f,f=200),a.file.fileHeight=f+"px",a.file.fileWidth=e+"px",a.$broadcast("render")}}}var g=null;a.message&&a.message.fileInfo.file?a.file=a.message.fileInfo.file:a.msgItem&&a.msgItem.message.fileInfo.file&&(a.file=a.msgItem.message.fileInfo.file),a.cnvUploadFileUiScope=new e,a.remove=function(){var b=a.file;b.onFileRemoved?b.onFileRemoved(b.fileId):(b.jqXHR&&b.jqXHR.abort(),b.onFileRemovedFromService&&b.onFileRemovedFromService(),b.removed=!0),a.$emit("fileRemovedClicked",a.message)},a.retry=function(){a.file.status===b.FILE_STATUS_UPLOAD_FAILED?a.file.restartUploadCallback():g&&b.fileConversionReq(g,a.file),a.file.status=b.FILE_STATUS_UPLOADING},a.isInProgress=function(){var c=a.file.status;return a.dontWaitForConversion?c===b.FILE_STATUS_WAITING||c===b.FILE_STATUS_UPLOADING:c!=b.FILE_STATUS_CONVERSION_COMPLETED&&c!=b.FILE_STATUS_UPLOAD_FAILED&&c!=b.FILE_STATUS_CONVERSION_REQ_FAILED&&c!=b.FILE_STATUS_CONVERSION_FAILED},a.converting=function(){return a.file.status==b.FILE_STATUS_CONVERSION_REQ_SUCCESS},a.conversionCompleted=function(){return a.file.status==b.FILE_STATUS_CONVERSION_COMPLETED||a.file.status==b.FILE_STATUS_CONVERSION_FAILED},a.failed=function(){return a.file.status==b.FILE_STATUS_UPLOAD_FAILED||a.file.status==b.FILE_STATUS_CONVERSION_REQ_FAILED},b.on("cnvchange",f),a.$emit("fileDidAppear"),a.$on("$destroy",function(d){b.off("cnvchange",f),a.file.onFileRemoved=null,c.hide()})}]}}),b.module("convoApp").directive("cnvUploadFilesUiManager",["$compile","$templateCache",function(a,b){return{restrict:"A",scope:{ctrl:"=cnvUploadFilesUiManagerCtrl",fileInputController:"=cnvInsertAddItemOptionsCtrl"},link:function(c,d,e){if("chat"!=c.ctrl.templateType){var f="fileUpload/cnvUploadFilesUiManager.tpl.html",g=a(b.get(f))(c);d.empty().append(g)}c.scrollToEnd=function(){var a=d.find(".upload-files-scroll-cont");a.length&&a.animate({scrollLeft:a[0].scrollWidth},"500","swing")},c.$on("$destroy",function(a){d.off()})},controller:["$scope","$rootScope","UploadService","getNoteThumbnailPathFilter","getFileIconByTypeFilter",function(a,b,c,d,e){function f(){}function g(b){b.onFileRemoved=h,a.files.push(b),a.ctrl.filesUnderProcessCount=a.files.length,"chat-window"==b.uploadFrom&&a.$digest(a.files)}function h(b){for(var c=0,d=a.files;c<d.length;c++){var e=d[c];if(e.fileId==b){e.jqXHR&&e.jqXHR.abort(),e.onFileRemovedFromService&&e.onFileRemovedFromService(),e.removed=!0,d.splice(c,1);break}}a.ctrl.filesUnderProcessCount=a.files.length,k()}function i(){var b=a.files;for(var c in b)h(b[c].fileId);a.$emit("all-files-removed")}function j(){for(var b=a.files,c=0;c<b.length;c++){var d=b[c];d.jqXHR&&d.jqXHR.abort(),d.onFileRemovedFromService&&d.onFileRemovedFromService(),d.removed=!0}}function k(){var b=a.files,d=c;for(var e in b)if(n){if(b[e].status===d.FILE_STATUS_WAITING||b[e].status===d.FILE_STATUS_UPLOADING)return}else if(b[e].status===d.FILE_STATUS_WAITING||b[e].status===d.FILE_STATUS_UPLOADING||b[e].status===d.FILE_STATUS_UPLOADED||b[e].status===d.FILE_STATUS_CONVERSION_REQ_SUCCESS)return;a.$emit("filesUploadManagerCtrl_allFilesProcessed",{})}var l=a,m=c,n=l.ctrl.dontWaitForFileConversion,o=l.ctrl.dontClearPendingFileUploadsOnDestroy;l.type=l.ctrl.templateType,l.cnvUploadFilesUiManagerScope=new f,l.FILE_STATUS_WAITING=m.FILE_STATUS_WAITING,l.FILE_STATUS_UPLOADING=m.FILE_STATUS_UPLOADING,l.FILE_STATUS_UPLOADED=m.FILE_STATUS_UPLOADED,l.FILE_STATUS_UPLOAD_FAILED=m.FILE_STATUS_UPLOAD_FAILED,l.FILE_STATUS_CONVERSION_REQ_SUCCESS=m.FILE_STATUS_CONVERSION_REQ_SUCCESS,l.FILE_STATUS_CONVERSION_REQ_FAILED=m.FILE_STATUS_CONVERSION_REQ_FAILED,l.FILE_STATUS_CONVERSION_COMPLETED=m.FILE_STATUS_CONVERSION_COMPLETED,l.FILE_STATUS_CONVERSION_FAILED=m.FILE_STATUS_CONVERSION_FAILED,l.fileInputController.onChange=function(b){var c=b.event;switch(c){case m.EVENT_UPLOAD_COMPLETE:k();break;case m.EVENT_UPLOAD_FAILED:k();break;case m.EVENT_FILE_CONVERSION_REQ_FAILED:k();break;case m.EVENT_FILE_CONVERSION_FAILED:k();break;case m.EVENT_FILE_CONVERSION_COMPLETE:k();break;default:console.log("Invalid Event fired.")}n?(c===m.EVENT_UPLOAD_COMPLETE||c===m.EVENT_FILE_CONVERSION_COMPLETE||c===m.EVENT_FILE_CONVERSION_FAILED||c===m.EVENT_FILE_CONVERSION_REQ_SUCCESS||c===m.EVENT_FILE_CONVERSION_REQ_FAILED)&&a.$emit("filesUploadManagerCtrl_fileProcessed"):(c===m.EVENT_FILE_CONVERSION_COMPLETE||c===m.EVENT_FILE_CONVERSION_FAILED||c===m.EVENT_FILE_CONVERSION_REQ_FAILED)&&a.$emit("filesUploadManagerCtrl_fileProcessed")},l.openFileChooser=function(){l.fileInputController.onTriggerFileChooser()};var p=l.$on("enqueueFile",function(a,b){for(var c=0;c<b.length;c++)g(b[c])}),q=_.debounce(function(){l.scrollToEnd()},1e3),r=l.$on("fileDidAppear",function(a,b){a.stopPropagation(),q()});if(l.ctrl.addSuccessfullyProcessedFile=function(b){var f={};f.fileId=b.file_id,f.fileUploadName=b.original_name,f.localUrl=b.thumbnail_name?d(b,b.item_id):e(b.type,16),f.noTitle=b.thumbnail_name?!0:!1,f.name=b.name,f.noteId=b.item_id,f.retryAllowed=!1,f.size=b.size,f.status=c.FILE_STATUS_CONVERSION_COMPLETED,f.type=b.type,f.serverFileId=b.file_id,f.onFileRemoved=h,a.files.push(f),a.ctrl.filesCount=a.files.length},l.ctrl.isBusy=function(){var b=a.files;if(!b)return!1;var d=c;for(var e in b)if(n){if(b[e].status===d.FILE_STATUS_WAITING||b[e].status===d.FILE_STATUS_UPLOADING)return!0}else if(b[e].status===d.FILE_STATUS_WAITING||b[e].status===d.FILE_STATUS_UPLOADING||b[e].status===d.FILE_STATUS_UPLOADED||b[e].status===d.FILE_STATUS_CONVERSION_REQ_SUCCESS)return!0;return!1},l.ctrl.getSuccessfullyProcessedFiles=function(){var b=[],d=a.files,e=c;for(var f in d)n?(d[f].status===e.FILE_STATUS_UPLOADED||d[f].status===e.FILE_STATUS_CONVERSION_COMPLETED||d[f].status===e.FILE_STATUS_CONVERSION_FAILED||d[f].status===e.FILE_STATUS_CONVERSION_REQ_SUCCESS||d[f].status===e.FILE_STATUS_CONVERSION_REQ_FAILED)&&b.push(d[f]):(d[f].status===e.FILE_STATUS_CONVERSION_COMPLETED||d[f].status===e.FILE_STATUS_CONVERSION_FAILED||d[f].status===e.FILE_STATUS_CONVERSION_REQ_FAILED)&&b.push(d[f]);return b},l.ctrl.getAllFiles=function(){return a.files},l.ctrl.removeFile=function(b,c){var d=a.files;for(var e in d)if(d[e].fileId===b){h(d[e].fileId);break}c||k()},l.ctrl.removeAllFiles=i,l.ctrl.haltFilesProcessing=j,a.ctrl.filesArrayObj)l.files=a.ctrl.filesArrayObj;else if(l.files=[],l.ctrl.files)for(var s in l.ctrl.files)g(l.ctrl.files[s]);a.$on("$destroy",function(a){o?l.files=null:i(),r(),p(),l.fileInputController.onChange=null,l.ctrl.getSuccessfullyProcessedFiles=l.ctrl.addSuccessfullyProcessedFile=l.ctrl.removeAllFiles=l.ctrl.haltFilesProcessing=l.ctrl.getAllFiles=l.ctrl.removeFile=l.ctrl.isBusy=null}),a.ctrl.initialized=!0}]}}]),b.module("convoApp").directive("cnvUploadFromUrl",function(){return{restrict:"AE",scope:{cnvFileContext:"="},link:function(a,b,c){},controller:["$scope","utils","UploadService","$filter",function(a,b,c,d){a.$on("upload_url_as_image",function(e,f){for(var g=0;g<f.length;g++){var h=f[g];_fileObj={},_fileObj.name=h.name,_fileObj.size=h.size,_fileObj.fileExt=h.type,_fileObj.type=h.type,_fileObj.fileId=b.generateGuid(),_fileObj.fileUploadName=_fileObj.fileId+"."+_fileObj.type,_fileObj.localUrl=d("getFileIconByType")(_fileObj.type,32),_fileObj.file_url=h.url,_fileObj.uploadFrom=h.upload_from,_fileObj.source="url",_fileObj.mp_attachment_source="Image Link",_fileObj.status=c.FILE_STATUS_WAITING,a.cnvFileContext.event_dispacher.dispach({event:c.EVENT_FILE_SELECTED,file:_fileObj}),c.fileConversionReq(a.cnvFileContext,_fileObj)}})}]}}),b.module("convoApp").factory("UploadService",["ServerComm","$rootScope","$http","$interval","$q","utils","awsService","$filter","datetimeService","nativeCommBridge","config","logger","accountInfo","alertsService","appsInfo","$location","loginResponseData","userInfo",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t={FILE_STATUS_WAITING:"fsw",FILE_STATUS_UPLOADING:"fsug",FILE_STATUS_UPLOADED:"fsud",FILE_STATUS_UPLOAD_FAILED:"fsuf",FILE_STATUS_CONVERSION_REQ_SUCCESS:"fscrs",FILE_STATUS_CONVERSION_REQ_FAILED:"fscrf",FILE_STATUS_CONVERSION_COMPLETED:"fscc",FILE_STATUS_CONVERSION_FAILED:"fscf",CONCURRENT_FILE_UPLOAD_LIMIT:2,PROGRESS_TIMEOUT_LIMIT:3e4,EVENT_FILE_SELECTED:"fileselected",EVENT_UPLOAD_PROGRESS:"uploadprogress",EVENT_UPLOAD_COMPLETE:"uploadcomplete",EVENT_UPLOAD_FAILED:"uploadfailed",EVENT_FILE_CONVERSION_REQ_SUCCESS:"fileconversionrequestsuccess",EVENT_FILE_CONVERSION_REQ_FAILED:"fileconversionrequestfailed",EVENT_FILE_CONVERSION_COMPLETE:"fileconversioncomplete",EVENT_FILE_CONVERSION_PENDING:"fileconversionpending",EVENT_FILE_CONVERSION_FAILED:"fileconversionfailed",UPLOAD_MAX_PERCENT:80,init:function(a){var b;(l.IS_NATIVE||l.IS_MENULET)&&$(a.pasteZoneId).on("paste",function(b){b.originalEvent.clipboardData.getData("text")||(k.getImageFromClipboard(a.pasteZoneId),b.stopPropagation(),b.preventDefault())});var d={url:h.getS3BucketUrl(),type:"POST",dropZone:a.dropZoneId?$(a.dropZoneId):!1,pasteZone:a.pasteZoneId?$(a.pasteZoneId):!1,uploadMaxPercent:a.excludeConversionFromProgress?95:t.UPLOAD_MAX_PERCENT,maxRetries:5,retryTimeout:500,limitConcurrentUploads:t.CONCURRENT_FILE_UPLOAD_LIMIT,fileConversionStatusReqInterval:null,fileConversionReq:t.fileConversionReq,pollForFilesStatus:t.pollForFilesStatus,filesConversionStatusReq:t.filesConversionStatusReq,filesConversionContext:function(b){var c={pendingFilesConversionIds:[],files:{},setFileById:function(a,b){c.files[+a]=b},getFileById:function(a){return c.files[+a]||null},removeFileById:function(a){delete c.files[+a]},input_element_id:b,event_dispacher:{dispach:function(c){$(b).trigger("cnvchange",[c]),a.resourceId&&(c.resourceId=a.resourceId,t.trigger("cnvchange",null,c))}}};return _.extend(c,Backbone.Events),c}(a.id),validateFiles:function(a,b){var d=p.getPremiumUpgradeAppUrl(),e=r.get().account_package.file_size_limit;if(-1==e)return!0;for(var f=0,g=b.length;g>f;f++)if(b[f].size>1e6*e){var h="The "+_.escape(b[f].name)+" file exceeds the "+e+" MB attachment limit.";return s.isGuestUser()||l.IS_MENULET?o.alertModal("A file cannot be attached",h,"Got it",c,c,c,"black-text"):o.promptModal("A file cannot be attached",h+' To share files up to 5 GB, <a href="'+d+'" class="close-modal-on-click">upgrade to Pro</a>.',function(){q.url(d.slice(1))},c,"Upgrade","Later"),!1}return!0},add:function(b,c){var e=c&&c.files&&c.files.length?c.files[0]:null;if(e&&(!a.hasOwnProperty("uploadAcknowledgement")||typeof a.uploadAcknowledgement!=typeof Function||a.uploadAcknowledgement.apply(this))){var f={};f.retries=0,f.name=e.name||(new Date).getTime()+(-1!=e.type.indexOf("image")?".png":""),f.size=e.size?e.size:1,-1!=f.name.lastIndexOf(".")?f.type=f.name.substr(f.name.lastIndexOf(".")+1).toLowerCase():f.type=-1!=e.type.indexOf("image")?"png":e.type,"ai"==f.type?f.contentType="application/illustrator":e.type?f.contentType=e.type:f.contentType="application/octet-stream",f.fileId=g.generateGuid(),f.fileUploadName=f.fileId+"."+f.type,
f.localUrl=i("getFileIconByType")(f.type,32),f.uploadFrom=a.uploadFrom,f.status=t.FILE_STATUS_WAITING,f.mp_attachment_source="Local Photos",f.progressTimeout=null,f.retryAllowed=!1,d.generateThumbnail.queue_in(e,f),t.dispach(this,{event:t.EVENT_FILE_SELECTED,file:f},a.resourceId),e.renderedSelectedFileData=f,c.formData={"x-amz-server-side-encryption":"AES256",AWSAccessKeyId:h.getAwsData().access_key,acl:"private",policy:h.getAwsData().s3_policy,Filename:f.fileUploadName,signature:h.getAwsData().s3_signature,success_action_status:"201","Content-Type":f.contentType,key:t.getFileUploadPath(f.noteId,f.appInstanceId,f.fileUploadName)},c.paramName&&"files[]"==c.paramName[0]&&(c.paramName[0]="file"),f.jqXHR=c.submit(),console.debug("File "+f.fileUploadName+"submit for upload.")}},progress:function(b,c){var e=c.files[0].renderedSelectedFileData;e.status=t.FILE_STATUS_UPLOADING,e.progress=t.calculateProgress(c,d.uploadMaxPercent),console.debug("File "+e.fileUploadName+": "+e.progress+"% upload progress."),clearTimeout(e.progressTimeout),e.progressTimeout=setTimeout(function(){0!=e.progress&&e.progress<d.uploadMaxPercent&&(console.debug("File "+e.fileUploadName+": ABORTED due to progress timeout."),e.aborted_due_to_progress_timeout=!0,e.jqXHR.abort())},t.PROGRESS_TIMEOUT_LIMIT),t.dispach(this,{event:t.EVENT_UPLOAD_PROGRESS,file:e},a.resourceId)},done:function(b,c){var e=c.files[0].renderedSelectedFileData;e.progress=d.uploadMaxPercent,e.status=t.FILE_STATUS_UPLOADED,clearTimeout(e.progressTimeout),t.dispach(this,{event:t.EVENT_UPLOAD_COMPLETE,file:e},a.resourceId),e.removed||c.fileConversionReq(c.filesConversionContext,e),console.debug("File "+e.fileUploadName+" upload complete.")},fail:function(b,c){function e(){var a=h.getAwsData();c.data=null,c.formData.AWSAccessKeyId=a.access_key,c.formData.policy=a.s3_policy,c.formData.signature=a.s3_signature}var f=403===c.jqXHR.status;f&&n.getAwsDataNow().then(function(){e()});var g=c.files[0].renderedSelectedFileData,i=function(){g.jqXHR=c.submit()};clearTimeout(g.progressTimeout),!f&&("abort"!==c.errorThrown||1==g.aborted_due_to_progress_timeout)&&c.uploadedBytes<c.files[0].size&&g.retries<d.maxRetries?(g.aborted_due_to_progress_timeout=!1,g.retries+=1,console.debug("File "+g.fileUploadName+" upload failed + retrying in "+g.retries*d.retryTimeout+"ms"),setTimeout(i,g.retries*d.retryTimeout)):(console.debug("File "+g.fileUploadName+" upload failed."),g.status=t.FILE_STATUS_UPLOAD_FAILED,g.retryAllowed=!0,g.restartUploadCallback=function(){g.jqXHR=c.submit(),g.restartUploadCallback=null},t.dispach(this,{event:t.EVENT_UPLOAD_FAILED,file:g},a.resourceId),m.logToServer("uploadService.fail: textStatus: "+c.textStatus+", fileUploadName: "+g.fileUploadName))},generateThumbnail:{queue:[],processing:!1,queue_in:function(a,b){this.queue.push({selected_file:a,file_details:b}),this.processing||this.process_next()},process_next:function(){if(this.queue.length){this.processing=!0;var a=this.queue[0];if("Image"===g.getFileFormat(a.file_details.type)){var b=new FileReader;b.readAsDataURL(a.selected_file);var c=this,d=function(d){if(b.onload=b.onerror=null,b=null,0!==d.target.result.indexOf("data:image")||-1!==d.target.result.indexOf("IMAGE/TIFF")||-1!==d.target.result.indexOf("image/tiff"))c.queue.shift(),c.processing=!1,c.process_next();else{var e=new Image,f=250,g=250,h=c,i=function(){e.onload=e.onerror=null;var b=document.createElement("canvas"),c=b.getContext("2d");if(e.width>f||e.height>g){var d=f/e.width,i=g/e.height,j=Math.min(d,i);e.width=e.width*j,e.height=e.height*j,b.width=e.width,b.height=e.height}else b.width=e.width,b.height=e.height;c.drawImage(e,0,0,e.width,e.height),a.file_details.noTitle=!0,a.file_details.showImage=!0,a.file_details.localUrl=b.toDataURL("image/jpg",.6),e=null,setTimeout(function(){h.queue.shift(),h.processing=!1,h.process_next()},400)},j=function(){e.onload=e.onerror=null,e=null,h.queue.shift(),h.processing=!1,h.process_next()};e.onload=i,e.onerror=j,e.src=d.target.result}};b.onload=d,b.onerror=e;var e=function(){b.onload=b.onerror=null,b=null,c.queue.shift(),c.processing=!1,c.process_next()}}else this.queue.shift(),this.processing=!1,this.process_next()}}}},e=d.filesConversionContext,f=$(a.id).fileupload(d);return b={viewDestroyed:!1,context:e,input_element:f,destroyViewRelatedData:function(){d.dropZone&&d.dropZone.off(),d.pasteZoneId&&d.pasteZoneId.off(),(l.IS_NATIVE||l.IS_MENULET)&&$(a.pasteZoneId).off("paste"),f.off(),d.generateThumbnail.queue=[],b.viewDestroyed=!0},destroyFilesConversionContext:function(){Object.keys(e).forEach(function(a){delete e[a]}),e=null},destroy:function(){b.destroyViewRelatedData(),b.destroyFilesConversionContext()}}},fileConversionReq:function(b,c){var d={file:{item_id:c.noteId,name:c.name,file_upload_name:c.fileUploadName,type:c.type,size:c.size,file_url:c.file_url,file_source:c.source||null,file_access_token:c.file_access_token||null,file_preview_url:c.file_preview_url||null}};c.conversationId&&""+c.conversationId.length>0&&(d.file.conversation_uid=c.conversationId,d.file.app_instance_id=parseInt(c.appInstanceId)),console.debug("File "+c.fileUploadName+" submit for conversion.");var e="files";a.post(e,d).success(function(a,d){a&&a.file&&"converting"==a.file.status.toLowerCase()||"success"==a.file.status.toLowerCase()?(c.serverFileId=a.file.file_id,c.fileFormat=a.file.file_format,"converting"==a.file.status.toLowerCase()?(c.status=t.FILE_STATUS_CONVERSION_REQ_SUCCESS,c.progress=80,b.setFileById(c.serverFileId,c),b.pendingFilesConversionIds.push(c.serverFileId),c.onFileRemovedFromService=function(){b.removeFileById(c.serverFileId),t.removeValueFromArray(b.pendingFilesConversionIds,c.serverFileId)},t.pollForFilesStatus(b),console.debug("File "+c.fileUploadName+" submited for conversion."),b.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_REQ_SUCCESS,file:c})):(c.width=a.file.width,c.height=a.file.height,c.thumbnailName=a.file.thumbnail_name,c.originalName=a.file.original_name,c.preview_name=a.file.preview_name,c.available_previews=a.file.available_previews,c.no_of_pages=a.file.no_of_pages,c.fileObjFromServer=a.file,!c.showImage&&a.file.thumbnail_name&&(c.localUrl=i("getNoteThumbnailPath")(a.file,c.noteId,0,c.appInstanceId),c.showImage=!0,c.noTitle=!0),c.status=t.FILE_STATUS_CONVERSION_COMPLETED,console.debug("File "+c.fileUploadName+" upload+conversion completed *"),b.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_COMPLETE,file:c}))):(c.status=t.FILE_STATUS_CONVERSION_REQ_FAILED,c.retryAllowed=!0,console.debug("File "+c.fileUploadName+" submit for conversion failed."),b.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_REQ_FAILED,file:c,file_input_context:b}))}).error(function(a,d){c.status=t.FILE_STATUS_CONVERSION_REQ_FAILED,c.retryAllowed=!0,b.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_REQ_FAILED,file:c,file_input_context:b})})},pollForFilesStatus:function(a){if(a.pendingFilesConversionIds.length&&!a.pollingForConversionStatus){var b=a.pendingFilesConversionIds,c=t.filesConversionStatusReq(a.pendingFilesConversionIds);a.pollingForConversionStatus=!0;var d=!1;console.debug("Files ["+a.pendingFilesConversionIds+"] polling for conversion status"),c.success(function(c,e){if(a.pollingForConversionStatus=!1,c&&c.files_status)for(var f in c.files_status){var g=a.getFileById(c.files_status[f].file_id);g&&("success"==c.files_status[f].status.toLowerCase()?(a.removeFileById(g.serverFileId),g.width=c.files_status[f].width,g.height=c.files_status[f].height,g.thumbnailName=c.files_status[f].thumbnail_name,g.originalName=c.files_status[f].original_name,g.preview_name=c.files_status[f].preview_name,g.available_previews=c.files_status[f].available_previews,g.no_of_pages=c.files_status[f].no_of_pages,g.fileObjFromServer=c.files_status[f],!g.showImage&&c.files_status[f].thumbnail_name&&(g.localUrl=i("getNoteThumbnailPath")(c.files_status[f],g.noteId,0,g.appInstanceId),g.showImage=!0,g.noTitle=!0),t.removeValueFromArray(a.pendingFilesConversionIds,c.files_status[f].file_id),g.progress=100,g.status=t.FILE_STATUS_CONVERSION_COMPLETED,console.debug("File "+g.fileUploadName+" upload+conversion completed *"),a.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_COMPLETE,file:g})):"converting"==c.files_status[f].status.toLowerCase()?(d=!0,g.progress<90?g.progress+=(100-g.progress)/4:g.progress<96&&(g.progress+=.2),console.debug("File "+g.fileUploadName+" converting."),a.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_PENDING,file:g})):(a.removeFileById(g.serverFileId),t.removeValueFromArray(a.pendingFilesConversionIds,c.files_status[f].file_id),g.retryAllowed=!1,g.status=t.FILE_STATUS_CONVERSION_FAILED,console.debug("File "+g.fileUploadName+" convertion failed."),a.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_FAILED,file:g})))}else for(var f=0;f<b.length;f++){var g=a.getFileById(b[f]);g&&(g.retryAllowed=!1,g.status=t.FILE_STATUS_CONVERSION_FAILED,a.removeFileById(g.serverFileId),t.removeValueFromArray(a.pendingFilesConversionIds,b[f]),console.debug("File "+g.fileUploadName+" files status error."),a.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_FAILED,file:g}))}(d||a.pendingFilesConversionIds.length>0)&&setTimeout(function(){t.pollForFilesStatus(a)},3e3)}),c.error(function(c,d){a.pollingForConversionStatus=!1;for(var e=0;e<b.length;e++){var f=a.getFileById(b[e]);f&&(f.retryAllowed=!1,f.status=t.FILE_STATUS_CONVERSION_FAILED,a.removeFileById(f.serverFileId),t.removeValueFromArray(a.pendingFilesConversionIds,b[e]),console.debug("File "+f.fileUploadName+" promise error."),a.event_dispacher.dispach({event:t.EVENT_FILE_CONVERSION_FAILED,file:f}))}})}},filesConversionStatusReq:function(b){return a.post("files",{converting_file_ids:b.join()})},dispach:function(a,b,c){$(a).trigger("cnvchange",[b]),c&&(b.resourceId=c,t.trigger("cnvchange",null,b))},removeValueFromArray:function(a,b){var c=a.indexOf(b);-1!=c&&a.splice(c,1)},getFileUploadPath:function(a,c,d){var e="";return e=4==c?"link":"note",b.login_data.account_id+"/"+e+a+"/"+d},calculateProgress:function(a,b){return parseInt(a.loaded/a.total*100,10)/100*b}};return _.extend(t,Backbone.Events),t}]),b.module("convoApp").factory("BlackListWordsService",["$rootScope","ServerComm","$q",function(a,b,c){function d(a){var b=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\_]/g,"\\$&");return b}var e={},f=[],g="",h="";return e.getBlackListWordsList=function(){var a=b.getx("accounts/black-list-words?method=readBlackListWords"),e=c.defer();return a.then(function(a){if(e.resolve(a.data),f=a.data.data,f&&f.length){var b="(^|[\\W0-9_]+)(";f.forEach(function(a,c){a=d(a),b+=a,c<f.length-1&&(b+="|")}),b+=")(?![a-z]+)",g=new RegExp(b,"gim")}if(f&&f.length){var b="(^|[\\W0-9_]+)(";f.forEach(function(a,c){b+="("+a.split("").map(function(a){return d(a)}).join("(<.*>)*")+")",c<f.length-1&&(b+="|")}),b+=")(?![a-z]+)",h=new RegExp(b,"gim")}},function(a){console.log("Error getting Black list "),f=[]}),e.promise},e.isProfane=function(a){return a.replace(g,"$1")},e.clean=function(a){return f&&f.length?this.isProfane(a):a},e.cleanFromHTMLText=function(a){return f&&f.length?a.replace(h,"$1"):a},e}]);var m=["$filter","BlackListWordsService","$parse",function(a,b,c){function d(a,c,d){var g=e(a);c===!0&&g.start<g.end&&f(a,d,g.start,g.end);var h=a.value;if(h.trim().length){var i=h.lastIndexOf(" ",g.start-1),j=h.lastIndexOf("	",g.start-1),k=h.lastIndexOf("\n",g.start-1),l=Math.max(i,k,j);0>l&&(l=0),h=h.substr(l,g.start-l);var m=b.clean(h);f(a,m,l,g.start)}}function e(a){var b,c,d,e,f,g=0,h=0;return"number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd?(g=a.selectionStart,h=a.selectionEnd):(c=document.selection.createRange(),c&&c.parentElement()==a&&(e=a.value.length,b=a.value.replace(/\r\n/g,"\n"),d=a.createTextRange(),d.moveToBookmark(c.getBookmark()),f=a.createTextRange(),f.collapse(!1),d.compareEndPoints("StartToEnd",f)>-1?g=h=e:(g=-d.moveStart("character",-e),g+=b.slice(0,g).split("\n").length-1,d.compareEndPoints("EndToEnd",f)>-1?h=e:(h=-d.moveEnd("character",-e),h+=b.slice(0,h).split("\n").length-1)))),{start:g,end:h}}function f(a,b,c,d){var e=c;if(document.selection){a.focus();var f=document.selection.createRange();f.text=b,e+=b.length,input.setSelectionRange(e,e)}else c||0==c?(a.value=a.value.substring(0,c)+b+a.value.substring(d,a.value.length),e+=b.length,a.selectionStart=a.selectionEnd=e):(a.value+=b,a.selectionStart=a.selectionEnd=a.value.length)}return function(a,e,f){if(e&&e[0]&&("text"==e[0].type||"url"==e[0].type||"search"==e[0].type||"email"==e[0].type||"TEXTAREA"===e[0].tagName)){a.placeholder=e[0].placeholder;var g={ENTER:13,ESCAPE:27,SPACE:32,SAVE:83,BACKSPACE:8,LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,DELETE:46};e[0].addEventListener("keydown",function(b){if(b.keyCode==g.SPACE&&d(e[0],!0,""),b.keyCode==g.ENTER&&(d(e[0],!0,""),$(e[0]).attr("ng-model"))){var f=c($(e[0]).attr("ng-model"));f.assign(a,e[0].value),a.$apply()}},!1),e[0].addEventListener("change",function(d){var f=e[0].value;f=b.clean(f).trim();var g="";if(g=f.trim().length>0?f:"",e[0].value=g,$(e[0]).attr("ng-model")){var h=c($(e[0]).attr("ng-model"));h.assign(a,g),a.$apply()}},!0),e[0].addEventListener("blur",function(a){var c=e[0].value;c=b.clean(c).trim(),e[0].value=c},!0),e[0].addEventListener("paste",function(a){setTimeout(function(){var a=e[0].value;a=b.clean(a),e[0].value=a}.bind(this),20)},!0)}}}];b.module("convoApp").directive("input",m).directive("textarea",m),b.module("convoApp").factory("filterInfo",function(){var a={};return a.filterApplied=!1,a.filterLink=null,a.waitingForServerDataBeforeEvaluatingTheFilter=!1,a}),b.module("convoApp").factory("FilterTypes",[function(){var a={};return a.ALL_TYPES=["to","from","in","is","discussions","comments","has","tag","tags","filename","like","post","vls","from_date","to_date","date","postDisplayOption","stag"],a.TO="to",a.FROM="from",a.DATA_TYPE="is",a.IN="in",a.TEXT="text",a.DISCUSSIONS="discussions",a.HAS="has",a.TAG="tag",a.TAGS="tags",a.TAG_HASH="#",a.STAG="stag",a.FILENAME="filename",a.POST="post",a.ANY_VALUE="any",a.NONE_VALUE="none",a.IS_SYSTEM_MESSAGE="systemmessage",a.IN_DRAFTS="drafts",a.IN_TRASH="trash",a.IN_STARRED="starred",a.IS="is",a.USER="USER",a.GROUP="GROUP",a.WORDS="words",a.DRAFTS="drafts",a.TRASH="trash",a.LIKE="like",a.VLS="vls",a.FROM_DATE="from_date",a.TO_DATE="to_date",a.DATE="date",a.COMMENTS="comments",a.ORDER_TYPE="order_type",a.POST_DISPLAY_OPTION="postDisplayOption",a}]),b.module("convoApp").factory("Filters",["FilterTypes","utils",function(a,b){var c={OFFICE_FILES:"Office files",OFFICE_FILES_VALUE:"docx,pptx,xlsx,doc,ppt,xls",ALL_FILES:"Files",ALL_FILES_VALUE:"docx,pptx,xlsx,doc,ppt,xls,pdf,mp4",IMAGES:"Images",IMAGES_VALUE:"jpg,jpeg,jfif,tif,png,gif,bmp,ppm,pgm,pbm,pnm,svg,psd,tga",VIDEOS:"Videos",VIDEOS_VALUE:"video",AUDIOS:"Audio",AUDIOS_VALUE:"mp3,wav,ogg,flac,wma,aiff,aif,vox,au,aac,caf,m4a,amr",WORD_DOCS:"Word docs",WORD_DOCS_VALUE:"docx,doc",EXCEL_SHEETS:"Excel sheets",EXCEL_SHEETS_VALUE:"xlsx,xls",SLIDE_SHOWS:"Powerpoint slideshows",SLIDE_SHOWS_VALUE:"pptx,ppt",PDF:"PDF",PDF_VALUE:"pdf",PHOTOSHOP:"Photoshop files",PHOTOSHOP_VALUE:"psd"},d={};return d.newFilter=function(a,b,c){return{type:a,value:b,description:c,nature:"PERMANENT"}},d.newFromFilter=function(b,c){return d.newFilter(a.FROM,b,c)},d.newANDFiltersChain=function(a,b){return{type:"AND_CHAIN",description:b,numberOfFilters:a.length,nature:"PERMANENT",id:"123",filters:a}},d.isGroupFilter=function(c){return c.type===a.TO&&b.isGroupIdLike(c.value)},d.hasAnySearchFilter=function(b){for(var c=!1,d=!1,e=0;e<b.length;e++){var f=b[e].type;if((f==a.TEXT||f==a.TAG||f==a.HAS||f==a.FILENAME||f==a.DISCUSSIONS)&&(c=!0,f==a.TEXT)){d=!0;break}}return c?{hasTextFilter:d}:!1},d.hasAnyTextFilter=function(b){for(var c=0;c<b.length;c++){var d=b[c].type;if(d==a.TEXT||d==a.TAG)return!0}return!1},d.hasAnyUserFilter=function(c){for(var d=[],e=0;e<c.length;e++){var f=c[e].type,g=c[e].value;(f===a.FROM||f===a.TO&&!b.isGroupIdLike(g))&&d.push(c[e])}return d.length>0?d:!1},d.hasAnyGroupFilter=function(c){for(var d=0;d<c.length;d++){var e=c[d].type,f=c[d].value;if(e===a.TO&&b.isGroupIdLike(f))return!0}return!1},d.hasAnyPostFilter=function(b){for(var c=0;c<b.length;c++)if(b[c].type===a.POST)return!0;return!1},d.hasAnyFromOrToFilters=function(b){for(var c={fromFilters:[],toFilters:[]},d=0;d<b.length;d++){var e=b[d].type;b[d].value;e===a.FROM?c.fromFilters.push(b[d]):e===a.TO&&c.toFilters.push(b[d])}return c.fromFilters.length>0||c.toFilters.length>0?c:!1},d.hasAnyFromOrToFiltersWithNonIdValues=function(c){for(var d={fromFilters:[],toFilters:[]},e=0;e<c.length;e++){var f=c[e].type,g=c[e].value;f===a.FROM?b.isUserIdLike(g)||d.fromFilters.push(c[e]):f===a.TO&&(b.isUserIdLike(g)||b.isGroupIdLike(g)||d.toFilters.push(c[e]))}return d.fromFilters.length>0||d.toFilters.length>0?d:!1},d.getSearchWordsIfHasWordSearchFilter=function(b){for(var c=0;c<b.length;c++)if(b[c].type==a.TEXT)return b[c].value;return null},d.getTextFilterValue=function(a){},d.newHasFilter=function(b){b=$.trim(b.toLowerCase());var e=null,f=null,g=c;return b==g.OFFICE_FILES.toLowerCase()?(e=g.OFFICE_FILES_VALUE,f=g.OFFICE_FILES):b==g.ALL_FILES.toLowerCase()||"all files"==b?(e=g.ALL_FILES_VALUE,f=g.ALL_FILES):b==g.IMAGES.toLowerCase()?(e=g.IMAGES_VALUE,f=g.IMAGES):b==g.VIDEOS.toLowerCase()?(e=g.VIDEOS_VALUE,f=g.VIDEOS):b==g.AUDIOS.toLowerCase()?(e=g.AUDIOS_VALUE,f=g.AUDIOS):b.indexOf("jpg")>=0?(e=b.replace("jpg","jpeg,jpg,jfif"),f=b):b.indexOf("jpeg")>=0?(e=b.replace("jpeg","jpeg,jpg,jfif"),f=b):b.indexOf("jfif")>=0?(e=b.replace("jfif","jpeg,jpg,jfif"),f=b):(e=b,f=b),d.newFilter(a.HAS,e,f)},d.hasAnyPostDisplayOptionFilter=function(b){for(var c={postDisplayOptionFilter:[]},d=0;d<b.length;d++){var e=b[d].type;b[d].value;e===a.POST_DISPLAY_OPTION&&c.postDisplayOptionFilter.push(b[d])}return c.postDisplayOptionFilter.length>0?!0:!1},d.hasFilter=c,d}]),b.module("convoApp").factory("Group",["$q","ServerComm",function(a,c){function d(a){a.sort(function(a,b){var c=a.first_name+" "+a.last_name,d=b.first_name+" "+b.last_name;c=c.toLowerCase(),d=d.toLowerCase();var e=a.user_email_id,f=b.user_email_id;if(e=e.toLowerCase(),f=f.toLowerCase(),c&&d){if(d>c)return-1;if(c>d)return 1}else if(e&&f){if(f>e)return-1;if(e>f)return 1}return 0})}function e(a){var b=[];if(a)for(var c=0;c<a.length;c++)"ADMINISTRATOR"==a[c].user_role&&b.push(a[c]);return b}function f(a){var b=[];if(a)for(var c=0;c<a.length;c++)("ACTIVE"==a[c].user_status||"INVITED"==a[c].user_status)&&b.push(a[c]);return b}function g(a,c,d,e){var f=a.get(c);f?e&&f&&(f.length=0):f=e?[]:{},a.set(c,b.extend(f,d))}var h=Backbone.Model.extend({fetchingDetailsFromServer:!1,detailsDeferred:null,initialize:function(){},defaults:{},getDetails:function(b){var h=this;return h.fetchingDetailsFromServer&&!b?h.detailsDeferred.promise:(h.fetchingDetailsFromServer=!0,h.detailsDeferred=a.defer(),c.postx("groups",{group_id:h.get("id"),method:"getGroupDetails",get_notification_settings:"1"}).then(function(a){a=a.data,a.type?(h.set({title:a.data.title,description:a.data.description?a.data.description:"",access:a.data.access,groupEmail:a.data.email,thisUserCanLeave:a.data.this_user_can_leave,createdBy:a.data.created_by,membersCanInvite:a.data.members_can_invite,membersCanLeave:a.data.members_can_leave,membersCanPost:a.data.members_can_post,membersAllowedToPost:a.data.members_allowed_to_post,memberCanPostInThisGroup:a.data.member_can_post_in_this_group,membersCanPinContent:a.data.members_can_pin_content,membersCanSetupIntegrations:a.data.members_can_setup_integrations,hideFromFeedForThisUser:a.data.hide_from_feed_for_this_user,autoFollowEnabled:a.data.auto_follow_enabled,creator:a.data.creator,email:a.data.email,pendingInviteCount:a.data.pending_invite_count,_hint_this_user_action:a.data._hint_this_user_action}),g(h,"groupMembers",f(a.data.users),!0),g(h,"groupAdmins",e(a.data.users),!0),g(h,"pinnedContents",a.data.pinned_contents,!0),g(h,"notificationSettings",a.data.notification_settings,!1),d(h.get("groupMembers")),h.fetchingDetailsFromServer=!1,h.detailsDeferred.resolve()):(h.fetchingDetailsFromServer=!1,h.detailsDeferred.reject(a))},function(a){h.fetchingDetailsFromServer=!1,h.detailsDeferred.reject(a)}),h.detailsDeferred.promise)},updateGroupDetails:function(a){var b=this,e={method:"updateGroupDetails",group_id:this.get("id")};a.title&&(e.title=a.title),a.description&&(e.description=a.description),a.access&&(e.access=a.access),"undefined"!=typeof a.membersCanInvite&&(e.members_can_invite=a.membersCanInvite),"undefined"!=typeof a.membersCanLeave&&(e.members_can_leave=a.membersCanLeave),"undefined"!=typeof a.membersCanPost&&(e.members_can_post=a.membersCanPost),"undefined"!=typeof a.membersAllowedToPost&&(e.members_allowed_to_post=a.membersAllowedToPost),"undefined"!=typeof a.memberCanPostInThisGroup&&(e.member_can_post_in_this_group=a.memberCanPostInThisGroup),"undefined"!=typeof a.membersCanPinContent&&(e.members_can_pin_content=a.membersCanPinContent),"undefined"!=typeof a.membersCanSetupIntegrations&&(e.members_can_setup_integrations=a.membersCanSetupIntegrations),"undefined"!=typeof a.autoFollowEnabled&&(e.auto_follow_enabled=a.autoFollowEnabled),"undefined"!=typeof a.hideFromFeedForThisUser&&(e.hide_from_feed_for_this_user=a.hideFromFeedForThisUser),a.notificationSettings&&(e.notification_settings=a.notificationSettings),a.addedAdminIds&&(e.make_admins=a.addedAdminIds),a.removedAdminIds&&(e.revoke_admins=a.removedAdminIds);var f=c.post("groups",e).success(function(c,e){if(c.type){if(c.data.users_added){for(var f=c.data.users_added,g=b.get("groupMembers"),h=0;h<f.length;h++)g.push(f[h]);d(b.get("groupMembers")),b.trigger("Group:groupMembersUpdated")}if(a.title&&b.set("title",a.title),a.description&&b.set("description",a.description),a.access&&b.set("access",a.access),"undefined"!=typeof a.membersCanInvite&&b.set("membersCanInvite",a.membersCanInvite),"undefined"!=typeof a.membersCanLeave&&b.set("membersCanLeave",a.membersCanLeave),"undefined"!=typeof a.membersCanPost&&b.set("membersCanPost",a.membersCanPost),"undefined"!=typeof a.memberCanPostInThisGroup&&b.set("memberCanPostInThisGroup",a.memberCanPostInThisGroup),"undefined"!=typeof a.membersCanPinContent&&b.set("membersCanPinContent",a.membersCanPinContent),"undefined"!=typeof a.membersCanSetupIntegrations&&b.set("membersCanSetupIntegrations",a.membersCanSetupIntegrations),"undefined"!=typeof a.autoFollowEnabled&&b.set("autoFollowEnabled",a.autoFollowEnabled),"undefined"!=typeof a.hideFromFeedForThisUser&&b.set("hideFromFeedForThisUser",a.hideFromFeedForThisUser),a.notificationSettings){var i=b.get("notificationSettings");i.desktop=a.notificationSettings.desktop,i.mobile=a.notificationSettings.mobile,i.in_app=a.notificationSettings.in_app,i.email=a.notificationSettings.email}if(a.addedAdminIds)for(var j,k=0;k<a.addedAdminIds.length;k++)if(j=_.find(b.get("groupMembers"),function(b){return b.user_id==a.addedAdminIds[k]?!0:void 0})){j.user_role="ADMINISTRATOR";var l=_.where(b.get("adminMembers"),{user_id:j.user_id});l.length||b.get("groupAdmins").push(_.extend({},j))}if(a.removedAdminIds)for(var j,m,k=0;k<a.removedAdminIds.length;k++){j=_.find(b.get("groupMembers"),function(b){return b.user_id==a.removedAdminIds[k]?!0:void 0}),j&&(j.user_role="USER"),m=_.find(b.get("groupAdmins"),function(b){return b.user_id==a.removedAdminIds[k]?!0:void 0});var n=_.indexOf(b.get("groupAdmins"),m);n>=0&&b.get("groupAdmins").splice(n,1)}}});return f},getDescription:function(){var a=this;return a.getDetails().then(function(){return a.get("description")})},getGroupEmail:function(){var a=this;return a.getDetails().then(function(){return a.get("groupEmail")})},getThisUserCanLeave:function(){var a=this;return a.getDetails().then(function(){return a.get("thisUserCanLeave")})},getGroupMembers:function(a){var b=this;return b.getDetails(a).then(function(){return b.get("groupMembers")})},getPinnedContents:function(){var a=this;return a.getDetails().then(function(){return a.get("pinnedContents")})},updateDescription:function(a){var b=this,d={method:"updateGroupDetails",group_id:b.get("id"),title:b.get("title"),members_can_invite:b.get("membersCanInvite"),members_can_leave:b.get("membersCanLeave"),members_can_post:b.get("membersCanPost"),members_allowed_to_post:b.get("membersAllowedToPost"),member_can_post_in_this_group:b.get("memberCanPostInThisGroup"),description:a};return c.post("groups",d).then(function(c){return c.data&&1===c.data.type&&b.set({description:a}),c.data})},pinPost:function(a){var b,c=this;return b=c.get("pinnedContents")?c.get("pinnedContents").slice():[],b.push(a),c.updatePinnedContents(b).success(function(b,d){var e=c.get("pinnedContents")||[];e.push(a),c.set("pinnedContents",e),c.trigger("Group:pinnedContentsUpdated")})},removePinnedPostAtIndex:function(a){var b=this,c=b.get("pinnedContents").slice().splice(a,1);return b.updatePinnedContents(c).success(function(c,d){b.set("pinnedContents",b.get("pinnedContents").splice(a,1))})},updatePinnedContents:function(a){var b=this,d={method:"updatePinnedContents",group_id:b.get("id"),pinned_contents:a};return c.post("groups",d).success(function(a,b){})},pinContentToGroup:function(a){var b=this,d={method:"addPinnedContent",group_id:b.get("id"),pinned_content:a};return c.post("groups",d).success(function(a,c){var d=b.get("pinnedContents")||[];d.push(a.data),b.set("pinnedContents",d),b.trigger("Group:pinnedContentsUpdated")})},unpinContentFromGroup:function(a){var b=this,d={method:"removePinnedContent",group_id:b.get("id"),pinned_content_id:a};return c.post("groups",d).success(function(c,d){if(c.type){var e=b.get("pinnedContents").map(function(a){return a.id}).indexOf(a);b.get("pinnedContents").splice(e,1)}})},editPinnedContentInGroup:function(a,b){var d=this,e={method:"editPinnedContent",group_id:d.get("id"),pinned_content_id:a,pinned_content:b};return c.post("groups",e).success(function(b,c){if(b.type){var e=_.find(d.get("pinnedContents"),function(b){return b.id==a?!0:void 0});"WEB"==b.data.type?(e.id=b.data.id,e.resource_name=b.data.resource_name,e.url=b.data.url,e.type=b.data.type):"SCRYBE"==b.data.type&&(e.id=b.data.id,e.resource_name=b.data.resource_name,e.url=b.data.url,e.type=b.data.type,e.resource_id=b.data.resource_id,e.app_instance_id=b.data.app_instance_id,e.resource_type=b.data.resource_type)}})},getGroupJoinReqs:function(){var a,b=this,d={method:"getGroupJoinRequests",group_id:b.get("id")};return c.post("groups",d).success(function(c,d){if(c.type&&c.data){a=_.toArray(c.data);for(var e=_.keys(c.data),f=0;f<a.length;f++)_.extend(a[f],{user_id:e[f]})}b.set("groupJoinReqs",a)})},updateGroupJoinReqStatus:function(a,b,e){var f,g=this,h={method:"updateGroupJoinRequestStatus",group_id:g.get("id"),group_join_req_id:a,status:b},i={};return c.post("groups",h).success(function(c,h){if(c.type){var j=_.find(g.get("groupJoinReqs"),function(b){return b.group_join_req_id==a?!0:void 0});g.get("groupJoinReqs").splice(_.indexOf(g.get("groupJoinReqs"),j),1),"ACCEPTED"==b&&(i.user_id=e.user_id,i.user_email_id=e.email,f=e.name.split(" "),i.first_name=f[0],i.last_name=f.length>1?f[f.length-1]:"",i.user_role="USER",i.user_status="ACTIVE",i.profile_image_type=e.profile_image_type,i.profile_image_version=e.profile_image_version,g.get("groupMembers").push(i),d(g.get("groupMembers")),g.trigger("Group:groupMembersUpdated"))}})},inviteUserToGroupAgain:function(a){var b=this,d={method:"inviteUsers",group_id:b.get("id"),emails:a};return c.post("invite",d)},inviteUsersToGroup:function(a,b,e){var f=this,g={method:"inviteUsers",group_id:f.get("id"),emails:a};return e&&(g.view=e),b&&(g.message=b),c.post("invite",g).success(function(a,b){var c=a.data.users_invited;if(c&&c.length){for(var e=f.get("groupMembers"),g=0;g<c.length;g++){var h=_.pick(c[g].invitee_global_profile,"user_id","first_name","last_name","profile_image_type","profile_image_version");if(!_.findWhere(e,{user_id:h.user_id})){if(h.user_email_id=c[g].invitee_global_profile.email,"REQUESTED"==c[g].invitee_status_in_group){h.user_status="ACTIVE";var i=_.find(f.get("groupJoinReqs"),function(a){return a.user_id==h.user_id?!0:void 0});f.get("groupJoinReqs").splice(_.indexOf(f.get("groupJoinReqs"),i),1)}else h.user_status=c[g].invitee_status_in_group;h.user_role="USER",e.push(h)}}d(e),f.trigger("Group:groupMembersUpdated")}})},resetUnreadCount:function(){this.set("unreadCount",0)},removeMemberFromGroup:function(a){var b=this,d={groupId:b.get("id"),userId:a,method:"removeUserFromGroup"};return c.post("groups",d).success(function(c,d){if(c.type){var e=_.find(b.get("groupMembers"),function(b){return b.user_id==a?!0:void 0}),f=_.indexOf(b.get("groupMembers"),e);if(f>=0&&(b.get("groupMembers").splice(f,1),b.trigger("Group:groupMembersUpdated")),"ADMINISTRATOR"==e.user_role){var g=_.find(b.get("groupAdmins"),function(b){return b.user_id==a?!0:void 0}),h=_.indexOf(b.get("groupAdmins"),g);h>=0&&(b.get("groupAdmins").splice(h,1),b.trigger("Group:groupAdminsUpdated"))}}})},makeMemberAsGroupAdmin:function(a){var b=this,d={method:"makeUserGroupAdmin",group_id:b.get("id"),user_id:a};return c.post("groups",d).success(function(c,d){if(c.type){var e=_.find(b.get("groupMembers"),function(b){return b.user_id==a?!0:void 0});if(e){e.user_role="ADMINISTRATOR";var f=_.where(b.get("groupAdmins"),{user_id:e.user_id});f.length||(b.get("groupAdmins").push(_.extend({},e)),b.trigger("Group:groupAdminsUpdated"))}}})},revokeGroupAdminPrivileges:function(a){var b=this,d={method:"revokeAdminPrivileges",group_id:b.get("id"),user_id:a};return c.post("groups",d).success(function(c,d){if(c.type){var e=_.find(b.get("groupMembers"),function(b){return b.user_id==a?!0:void 0});e&&(e.user_role="USER");var f=_.find(b.get("groupAdmins"),function(b){return b.user_id==a?!0:void 0}),g=_.indexOf(b.get("groupAdmins"),f);g>=0&&(b.get("groupAdmins").splice(g,1),b.trigger("Group:groupAdminsUpdated"))}})},hideFromFeedForThisUser:function(a){var b={method:"updateGroupDetails",group_id:this.get("id"),hide_from_feed_for_this_user:a};return c.post("groups",b)},setIsHidden:function(a){var b=this;b.set("isHidden",a)},getNotificationSettings:function(){var a=this;return a.getDetails().then(function(){return a.get("notificationSettings")})},isGroupAdmin:function(a){var b=this,c=_.where(b.get("groupAdmins"),{user_id:a});return c.length>0},isThisUserIsTheOnlyGroupAdmin:function(a){var b=this;return b.get("groupAdmins")&&1==b.get("groupAdmins").length&&b.get("groupAdmins")[0].user_id==a},isNonMemberPrivateGroup:function(){return!this.get("isMember")&&("PRIVATE"===this.get("access")||"SECRET"===this.get("access"))},isNonMemberPublicGroup:function(){return"PUBLIC"===this.get("access")&&!this.get("isMember")}});return h}]),b.module("convoApp").directive("cnvPostCreators",["$window",function(a){return{restrict:"E",scope:{postCreatorsAddresses:"=ngModel",postCreatorsUpdate:"=updateModel",itemsToExclude:"=itemsToExclude",disableDirective:"=disableDirective",requiredInfo:"@requiredInfo",allowedUsers:"=allowedUsers",updateCallback:"&updateCallback"},templateUrl:"groups/cnvPostCreators/templates/cnvPostCreators.tpl.html",link:function(a,b,c){a.postCreators=[],a.postCreatorsObj={},a.postCreatorsSearch=[],a.networkMembers=[],a.postCreatorsInputField,a.showInputArea=!1,a.getPublishable(),a.toggleInput=function(){if(a.showInputArea){var b=$(".add-members-search-field");b&&b.focus()}else a.showInputArea=!0,setTimeout(function(){var a=$(".add-members-search-field");a&&a.focus()},0)},a.initPostersFilter=function(){a.postersFilterField="",a.showPostFilterField=!1},a.initPostersFilter()},controller:["$scope","Contacts","Users","accountInfo",function(a,b,c,d){function e(b){b&&b.forEach(function(b){a.networkMembers.forEach(function(c){c.email!=b||f(c)||(a.postCreators.push(c),a.postCreatorsUpdate.push(c.email),a.postCreatorsObj[b]=c)})})}function f(b){for(var c=0;c<a.itemsToExclude.length;c++){var d=a.itemsToExclude[c];if(b.email==d)return!0}return!1}function g(b){b?(a.postCreators=_.values(b),a.postCreatorsAddresses=_.keys(b)):(a.postCreators=[],
a.postCreatorsAddresses=[],a.postCreatorsUpdate=[])}a.handleFilterKeyup=function(b){27==b.keyCode&&a.initPostersFilter()},a.postersFilter=function(b){var c=a.postersFilterField;if(b.first_name){var d=b.first_name+" "+b.last_name;return-1!=d.toLocaleLowerCase().indexOf(c.toLocaleLowerCase())?!0:!1}return-1!=b.email.toLocaleLowerCase().indexOf(c.toLocaleLowerCase())?!0:!1},a.togglePostersFilter=function(){if(a.showPostFilterField){var b=$(".posters-filter-field");b&&b.focus()}else a.showPostFilterField=!0,setTimeout(function(){var a=$(".posters-filter-field");a&&a.focus()},0)},a.getPublishable=function(){c.getPublishableUsers().then(function(b){a.networkMembers=b,e(a.postCreatorsAddresses)})},a.removePostCreator=function(b){b.isAlreadyPostCreator=!1,a.postCreatorsObj[b.email]&&(a.postCreatorsUpdate.splice(a.postCreatorsUpdate.indexOf(b.email),1),delete a.postCreatorsObj[b.email],g(a.postCreatorsObj)),a.updateCallback&&a.updateCallback()},a.cnvAddMemberCallback=function(b,c){a.postCreatorsObj&&(a.postCreatorsUpdate.push(b),g(a.postCreatorsObj),a.showInputArea=!1,a.updateCallback&&a.updateCallback())}}]}}]),b.module("convoApp").directive("cnvJoinedBtn",[function(){return{restrict:"E",scope:!1,templateUrl:"groups/groupActionBtns/templates/cnvJoinedBtn.tpl.html",link:function(a,b,c){$(b).on("mouseenter",function(){a.showBtn="leave",a.$broadcast("render")}),$(b).on("mouseleave",function(){a.showBtn="joined",a.$broadcast("render")})},controller:["$scope",function(a){a.showBtn="joined",a.$broadcast("render")}]}}]),b.module("convoApp").factory("Groups",["ServerComm","accountInfo","userInfo","$q","relevanciesService","Group","accountDataService","AccountDataChangeNotificationType","localStore","RTCNotification","$injector",function(a,b,d,e,f,h,i,j,k,l,m){function n(){return Ia}function o(){var a=k.readData(n());return a&&a.version!==Ha&&(a=null,k.clearData(n())),a}function p(a){for(var b,e=[],f=[],g=[],i=[],j=[],k=d.getUserId(),l={},m=[],n=a.length,o=0;n>o;o++){var p=new h(a[o]);p.set("rank",Ga[p.id]),p.set({memberCanPost:p.get("members_can_post")===c?1:p.get("members_can_post"),memberCanPostInThisGroup:p.get("member_can_post_in_this_group")===c?1:p.get("member_can_post_in_this_group")}),p.get("pinned_at")!==c||p.get("rank")?f.push(p):(e.push(p),p.get("isPublishable")&&g.push(p),p.get("isListable")&&i.push(p),p.get("isSearchable")&&j.push(p)),l[p.id]=!0,Ea.hasOwnProperty(p.id)&&(Ea[p.id]="p"),b||"PROFILE"!==p.get("type")||p.get("created_by")!==k||(b=p.id)}var q=f.length;if(q>0){var r=f;Fa&&(r=_.sortBy(f,function(a){return-a.get("rank")})),r=_.sortBy(r,function(a){return a.get("pinned_at")});for(var o=q-1;o>=0;o--){var p=r[o];e.unshift(p),p.get("isPublishable")&&g.unshift(p),p.get("isListable")&&i.unshift(p),p.get("isSearchable")&&j.unshift(p)}}_.each(Ea,function(a,b){"p"!==a&&Aa.get(b).get("isMember")&&m.push(b)}),Aa.set(e),Ea=l,Ba.set(g),Ca.set(i),Da.set(j),d.setAccountUserProfileGroupId(b),m.length>0&&ua.trigger("groupsDeletedOrUserRemovedFrom",m)}function q(c,f){if(!wa&&(!xa||c||f)){va=e.defer();var g=!1;if(!f){var h=o();h&&h.data.account_data_revision_no==b.getAccountDataRevisionNo()&&(p(h.data.groups_data),xa=!0,va.resolve(),g=!0)}if(!g){var i=a.getx("groups");wa=!0,i.then(function(a){a=a.data;var b=Aa.mustTriggerUpdatedEvent||Aa.length>0;if(Aa.mustTriggerUpdatedEvent=!1,p(a.groups),wa=!1,xa=!0,!d.isAdminMode()){var c={};c.groups_data=a.groups,c.account_data_revision_no=a.account_data_revision_number,k.writeData(n(),c,Ha)||k.writeData(n(),"",Ha)}va.resolve(),b&&ua.trigger("groupsUpdated")},function(a){0===Aa.length&&(Aa.mustTriggerUpdatedEvent=!0),wa=!1,xa=!1,va.reject(a)})}}return va.promise}function r(){k.writeData(n(),"",Ha)}function s(a){Aa.add(a),Ea[a.id]=!0}function t(){q(!0,!0).then(function(a){console.log("JK: triggering groupsUpdated event"),ua.trigger("groupsUpdated")})}function u(){return q().then(function(a){return Ba})}function v(a){return a?Ca:q().then(function(){return Ca})}function w(){return q().then(function(a){return Da})}function x(){return Fa?Ca:null}function y(){for(var a=[],b=0;b<Aa.length;b++){var d=Aa.at(b);d.set("rank",Ga[d.id]),(d.get("pinned_at")!==c||d.get("rank"))&&(Aa.remove(d.id),Ca.remove(d.id),b--,a.push(d))}if(a.length>0){var e=_.sortBy(a,function(a){return-a.get("rank")});e=_.sortBy(e,function(a){return a.get("pinned_at")});for(var b=e.length-1;b>=0;b--){var d=e[b];Aa.unshift(d),d.get("isListable")&&Ca.unshift(d)}}}function z(a){return v().then(function(b){var c=b;return Fa?c:f.getRelevancies(c.pluck("id"),!1,a).then(function(a){var b=a.groups;if(!b)return c;for(var d=0;d<b.length;d++){var e=b[d];Ga[e.term]=e.rank}return y(),Fa=!0,Ca})})}function A(a){return q().then(function(b){for(var c=!1,d=0;d<a.length;d++){var e=a[d],f=parseInt(e.updates_count),g=Aa.get(e.group_id);g&&f!=g.get("unreadCount")&&(g.set("unreadCount",f),c=!0)}return c})}function B(a){if(a){var b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=Aa.get(c);d.set("pinned_at",a[c]),Aa.remove(d.id),Ca.remove(d.id),b.push(d)}if(b.length>0)for(var e=_.sortBy(b,function(a){return a.get("pinned_at")}),f=e.length-1;f>=0;f--){var d=e[f];Aa.unshift(d),d.get("isListable")&&Ca.unshift(d)}r()}}function C(a){return q().then(function(b){return Aa.get(a)})}function D(b){return q().then(function(c){var d=Aa.get(b);return d?d:a.getx("groups?group_id="+encodeURIComponent(b)).then(function(a){return d=a.data.groups.length>0?a.data.groups[0]:null,d&&s(d),d})})}function E(a){return Aa.get(a)}function F(a){return Aa.get(a)?Aa.get(a).get("title"):"Unknown"}function G(a){var b=a.toLowerCase();return Aa.find(function(a){return a.get("title").toLowerCase()==b})}function H(b,c,d,e,f,g,h,i,j,k,l,m){var n={method:"createGroup",name:b,description:c,access:d,auto_follow:e,members_can_invite_others:f,users_to_invite:g};return"undefined"!=typeof j&&(n.members_can_leave=j),"undefined"!=typeof k&&(n.members_can_post=k,n.members_allowed_to_post=l),"undefined"!=typeof m&&(n.custom_message_post_creators=m),h&&(n.custom_message=h),i&&(n.mp_selection_type=i),a.post("groups",n).success(function(a,b){console.log(a)})}function I(b,c){var d={groupId:b,userId:c,method:"removeUserFromGroup"},f=a.post("groups",d),g=e.defer();return f.success(function(a,d){ea(a,{groupId:b,userId:c}),g.resolve(a)}),g.promise}function J(b){var c={method:"pinGroup",group_id:b};return a.post("groups",c).success(function(a,b){B(a.data),ua.trigger("groupsUpdated")})}function K(b){var c={method:"unpinGroup",group_id:b};return a.post("groups",c).success(function(a,c){Aa.get(b).unset("pinned_at"),B(a.data),ua.trigger("groupsUpdated")})}function L(b){var c={method:"getGroupsInfo",group_name:b},d=a.post("groups",c);return d}function M(b){var c={method:"requestToJoinGroup",group_id:b},e=a.post("groups",c).success(function(a,c){a.type&&(Z(a,{groupId:b,change:"reqToJoinGroup"}),ia(a,{groupId:b,userId:d.user_id}))});return e}function N(b,c,d,e){var f={method:"inviteUsers",group_id:b,emails:c};return d&&(f.message=d),a.post("invite",f)}function O(a,b){return a.updateGroupDetails(b).success(function(c,d){c.type&&(b.hasOwnProperty("notificationSettings")||b.hasOwnProperty("hideFromFeedForThisUser")||Z(c,{groupId:a.get("id")}),b.hasOwnProperty("hideFromFeedForThisUser")&&ka(a.get("id"),b.hideFromFeedForThisUser,!1))})}function P(b){var c={method:"deleteGroup",groupId:b};return a.postx("groups",c).then(function(a){1==a.data.type&&aa(a,{groupId:b})})}function Q(a,b){return a.pinContentToGroup(b).success(function(b,c){b.type&&Z(b,{groupId:a.get("id")})})}function R(a,b){return a.unpinContentFromGroup(b).success(function(b,c){b.type&&Z(b,{groupId:a.get("id")})})}function S(a,b,c){return a.editPinnedContentInGroup(b,c).success(function(b,c){b.type&&Z(b,{groupId:a.get("id")})})}function T(a,b){return a.revokeGroupAdminPrivileges(b).success(function(b,c){b.type&&Z(b,{groupId:a.get("id")})})}function U(a,b){return a.makeMemberAsGroupAdmin(b).success(function(b,c){b.type&&Z(b,{groupId:a.get("id")})})}function V(a,b,c,d){return a.updateGroupJoinReqStatus(b,c,d).success(function(b,c){b.type&&ga(b,{groupId:a.get("id")})})}function W(a,b,c,d){return a.inviteUsersToGroup(b,c,d).success(function(b,c){b.type&&ca(b,{groupId:a.get("id")})})}function X(a,b){return a.removeMemberFromGroup(b).success(function(c,d){c.type&&ea(c,{groupId:a.get("id"),userId:b})})}function Y(a,b){var c=a.hideFromFeedForThisUser(b);return c.success(function(c,d){c.type&&ka(a.get("id"),b,!1)}),c}function Z(a,b){$(b,!1),i.sendAccountDataChangeNotification(j.GROUP_MODIFIED,b)}function $(a,b){b&&ua.trigger("groupModifiedByRemoteUser",a)}function aa(a,b){ba(b,!1),i.sendAccountDataChangeNotification(j.GROUP_DELETED,b)}function ba(a,b){b?ua.trigger("groupDeletedByRemoteUser",a.groupId):ua.trigger("groupDeleted",a.groupId)}function ca(a,b){da(b,!1),i.sendAccountDataChangeNotification(j.USERS_INVITED_TO_GROUP,b)}function da(a,b){b&&ua.trigger("usersInvitedToGroupByRemoteUser",a.groupId)}function ea(a,b){fa(b,!1),i.sendAccountDataChangeNotification(j.USER_REMOVED_FROM_GROUP,b)}function fa(a,b){b?ua.trigger("userRemovedFromGroupByRemoteUser",a.groupId,a.userId):ua.trigger("userRemovedFromGroup",a.groupId,a.userId)}function ga(a,b){ha(b,!1),i.sendAccountDataChangeNotification(j.GROUP_JOIN_REQ_STATUS_UPDATED,b)}function ha(a,b){b&&ua.trigger("groupJoinReqStatusUpdatedByRemoteUser",a.groupId)}function ia(a,b){ja(b,!1),i.sendAccountDataChangeNotification(j.GROUP_JOIN_REQ_SENT,b)}function ja(a,b){b?ua.trigger("groupJoinReqSentByRemoteUser",a.groupId,a.userId):ua.trigger("groupJoinReqSent",a.groupId,a.userId)}function ka(a,b,c){ua.trigger("toggledShowHidePostsInFeed",a,b,c),c||sa(za,{groupId:a,hideFromFeedForThisUser:b})}function la(){ua.trigger("relevanciesFetched")}function ma(b){var c={method:"getGroupsDirectory"};return b&&(c.account_data_revision_no=b),a.post("groups",c)}function na(b,c){var d={method:"updateGroupDetails",group_id:b,notification_settings:{email:c}};return a.post("groups",d)}function oa(b,c){var d={method:"updateGroupDetails",group_id:b,notification_settings:{mobile:c}};return a.post("groups",d)}function pa(b,c,d){var e={method:"updateGroupJoinRequestStatus",group_id:b,group_join_req_id:c,status:d};return a.post("groups",e).success(function(a,c){a.type&&ga(a,{groupId:b})})}function qa(){return a.get("admin/groups?method=getAllCompanyGroups")}function ra(a){if(a.notification.data&&a.notification.data.userId===d.getUserId()&&a.notification.type===l.USER_GROUP_SETTINGS_UPDATED){console.log("RECEIVED: RTCNotification.USER_GROUP_SETTINGS_UPDATED");var b=a.notification.data;b.type===za&&ka(b.data.groupId,b.data.hideFromFeedForThisUser,!0)}}function sa(a,b){var c=new l;c.type=l.USER_GROUP_SETTINGS_UPDATED,c.data={userId:d.getUserId(),type:a,data:b},ya.send(c),console.log("SENT: RTCNotification.USER_GROUP_SETTINGS_UPDATED")}function ta(){ya=m.get("rtcNotificationManager"),ya.addListener(g.rtc.PubsubEvents.NOTIFICATION_RECEIVE,ra)}var ua={};_.extend(ua,Backbone.Events);var va,wa,xa,ya,za=1,Aa=new Backbone.Collection([],{model:h}),Ba=new Backbone.Collection([],{model:h}),Ca=new Backbone.Collection([],{model:h}),Da=new Backbone.Collection([],{model:h}),Ea={},Fa=!1,Ga={},Ha=3,Ia="USR_GRPS";return b.on("accountDataRevisionNoChanged",function(){q(!0).then(function(a){console.log("JK: triggering groupsUpdated event"),ua.trigger("groupsUpdated")})}),i.on("groupModifiedByRemoteUser",function(a){$(a,!0)}),i.on("groupDeletedByRemoteUser",function(a){ba(a,!0)}),i.on("usersInvitedToGroupByRemoteUser",function(a){da(a,!0)}),i.on("userRemovedFromGroupByRemoteUser",function(a){fa(a,!0)}),i.on("groupJoinReqStatusUpdatedByRemoteUser",function(a){ha(a,!0)}),i.on("groupJoinReqSentByRemoteUser",function(a){ja(a,!0)}),f.on("relevanciesFetched",la),ua.getGroups=q,ua.getPublishableGroups=u,ua.getListableGroups=v,ua.getListableGroupsIfRelevanciesHaveBeenFilled=x,ua.getSearchableGroups=w,ua.fillRelevanciesInListableGroups=z,ua.getGroup=E,ua.findGroupHavingName=G,ua.createGroup=H,ua.removeUserFromGroup=I,ua.fillGroupsUnreadCounts=A,ua.pinGroup=J,ua.unpinGroup=K,ua.getGroupInfo=L,ua.reqToJoinGroup=M,ua.getGroup_promise=C,ua.inviteUsersToGroup=N,ua.updateGroupDetails=O,ua.deleteGroup=P,ua.pinContentToGroup=Q,ua.unpinContentFromGroup=R,ua.editPinnedContentInGroup=S,ua.revokeGroupAdminPrivileges=T,ua.makeMemberAsGroupAdmin=U,ua.updateGroupJoinReqStatus=V,ua.inviteUsersToGroupRTC=W,ua.removeMemberFromGroup=X,ua.getGroupName=F,ua.getGroupsDirectory=ma,ua.updateGroupEmailNotification=na,ua.updateGroupMobileNotification=oa,ua.updateGrpJoinReqStatus=pa,ua.getGroupFromServerIfNotAvailableLocally=D,ua.getGroupsFromServer=t,ua.getCompanyGroups=qa,ua.toggleShowHidePostsInFeed=Y,ua.initRTC=ta,ua}]),b.module("convoApp").controller("FeedRightPanelCtrl",["$scope","AppLinks","$location","alertsService","accountInfo","Users","bannerService","userInfo","config","$filter","integrationsIntroService","mixpanelService","usagePolicyService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.userInfo=h,a.thisUserRole=h.userRole,a.displayUsagePolicyInRightPanel=m.getDisplayUsagePolicyInRightPanel(),a.twitterIntegrationsLink=j("getResourceLinkUrl")(100,[{uid:0,type:"100"},{uid:"2",type:"AddTwitterIntegration"}],null,"Add Twitter Integration"),a.gmailIntegrationsLink=j("getResourceLinkUrl")(100,[{uid:0,type:"100"},{uid:"2",type:"AddGmailIntegration"}],null,"Add Gmail Integration"),a.dropboxIntegrationsLink=j("getResourceLinkUrl")(100,[{uid:0,type:"100"},{uid:"2",type:"AddDropboxIntegration"}],null,"Add Dropbox Integration"),a.gDriveIntegrationsLink=j("getResourceLinkUrl")(100,[{uid:0,type:"100"},{uid:"2",type:"AddGdriveIntegration"}],null,"Add Google Drive Integration"),a.boxIntegrationsLink=j("getResourceLinkUrl")(100,[{uid:0,type:"100"},{uid:"2",type:"AddBoxIntegration"}],null,"Add Box Integration"),a.salesForceIntegrationsLink="https://zapier.com/app/min/1243/start",a.browseIntegrationApp=function(a){"Salesforce"===a?l.trackEvent(l.CLICK_ADD_INTEGRATION,{From:"Standard Newsfeed",Via:"Zapier",Source:a}):l.trackEvent(l.CLICK_ADD_INTEGRATION,{From:"Standard Newsfeed",Via:"Direct",Source:a})},a.$broadcast("render"),a.adminSettingsFlexURL=i.FLEX_APP_URL+b.linkToUrl(b.newActionLink_flexFormat("manageAccount","Manage Network"),!0),a.openDownloadAppsModal=function(){var a="home/components/downloadAppsModal/downloadAppsModal.tpl.html",b="DownloadAppsModalCtrl";d.customModal(a,b,null,"download-apps-modal-wrapper")},a.openIntegrationsPage=function(){k.initIntegrationsIntroDialog()},a.openUsagePolicyModal=function(){var a=(m.getDisplayUsagePolicyInRightPanel(),"home/components/usagePolicyModal/usagePolicyModal.tpl.html"),b="usagePolicyModalCtrl";d.customModal(a,b,null,"usage-policy-modal-wrapper")}}]),b.module("convoApp").controller("HomeRightPanelCtrl",["$scope","homeViewStateInfo","userInfo","onboardingService","appLoadSequenceManager",function(a,b,c,d,e){a.userInfo=c,a.viewState=b.getState(),a.onboardingStateActive=d.checkState(),a.$on("homeViewStateChange",function(){a.viewState=b.getState()}),d.on("cnvOnboarding:stateChange",function(){a.onboardingStateActive=d.checkState()}),e.okToLoad(e.comps.RIGHT_PANEL)?$("#home-right-panel").css("visibility","visible"):e.on("okToLoad"+e.comps.RIGHT_PANEL,function(){$("#home-right-panel").css("visibility","visible")})}]),b.module("convoApp").directive("cnvHome",["perf",function(a){return{restrict:"AE",priority:0,scope:!1,compile:function(a,b,c){return function(a,b,c,d){}},controller:["$scope","homeViewStateInfo","$rootScope","Filters",function(a,b,c,d){function e(){a.activeFilter=null;var b=a.filterInfo;b.filterApplied?a.feed_title=b.filterLink.title:a.feed_title="My Feed"}function f(){var b=a.filterInfo;if(b.filterApplied&&b.filterLink.filter){var c=d.hasAnyUserFilter(b.filterLink.filter.filters),e=d.hasAnyGroupFilter(b.filterLink.filter.filters),f=d.hasAnyTextFilter(b.filterLink.filter.filters),g=d.hasAnyPostDisplayOptionFilter(b.filterLink.filter.filters);!e&&!c||f?(!g||f)&&(a.is_search=!0):a.is_search=!1}else a.is_search=!1}var g=a.tab.appContCtrl.appCtrl;g.activated=function(){console.log("home tab activated")},g.initialized=!0,a.feed_title="News Feed",a.newsFeedFilter={url:"#/feed"},a.is_search=!1,a.$on("openEditProfileModal",function(b,c){a.$broadcast("openEditProfileWidget",c)}),a.$on("reRenderUserView",function(b){a.$broadcast("reRenderUserProfile")}),a.$on("filterChange",e),e(),a.$on("userUnfollowed",function(){a.$broadcast("reRenderUserView")}),a.$on("userFollowed",function(){a.$broadcast("reRenderUserView")}),a.$on("reqToJoinGroupSuccessful",function(){a.$broadcast("grpJoinReqSuccessful")}),a.$on("homeViewStateChange",f)}]}}]),b.module("convoApp").directive("cnvHomeCenterPanel",["Groups","homeViewStateInfo","AppLinks","Filters","FilterTypes","$rootScope","tagsService","searchService","$location","userInfo","perf","$window","$timeout",function(c,d,e,f,g,h,i,j,k,l,m,n,o){return{restrict:"E",scope:!0,templateUrl:"home/templates/cnvHomeCenterPanel.tpl.html",link:function(a,b,c){},controller:["$scope",function(o){function p(){}function q(a){o.feedRelatedSuggestions=j.getSearchSuggestions(a)}function r(a){var b=i.getRelatedTags(a);b.then(function(a,b){o.relatedTags=a.data})}function s(){var a=h.filterInfo;if(a.filterApplied)for(var b=0;b<a.filterLink.filter.filters.length;b++){if(a.filterLink.filter.filters[b].description.split("=")[0]==g.STAG)return!0;if(a.filterLink.filter.filters[b].type==g.TAG)return i.isSTag(a.filterLink.filter.filters[b].value[0])}return!1}function t(){o.activeFilter=null,o.filteredGroupId=null,o.relatedTags=null,o.feedRelatedSuggestions=null,o.isStagFilterApplied=s();var a=h.filterInfo;if(a.filterApplied&&a.filterLink.filter){var b=(f.hasAnySearchFilter(a.filterLink.filter.filters),f.hasAnyTextFilter(a.filterLink.filter.filters));if(b&&(q(a.filterLink.filter.filters),r(a.filterLink.filter.filters)),1==a.filterLink.filter.filters.length){var c=a.filterLink.filter.filters[0];c.type==g.TO?(o.filteredGroupId=c.value,c.value==o.thisUserId&&(o.activeFilter=o.mentionsFilter)):c.type==g.IN?c.value==g.IN_STARRED?o.activeFilter=o.starredFilter:c.value==g.IN_DRAFTS?o.activeFilter=o.draftsFilter:c.value==g.IN_TRASH&&(o.activeFilter=o.trashFilter):c.type==g.POST&&(o.activeFilter=o.postFilter)}}else o.activeFilter=o.newsFeedFilter}function u(){o.$on("homeViewStateChange",w)}function v(){var a=d.getToFilter();o.group=c.getGroup(a.value),o.group&&o.group.getDetails()}function w(){d.getState()==d.STATE_GROUP&&(v(),o.reqJoinGrpSuccess=!1)}function x(a){a&&0===$(a.target).closest(".filter-dropdown").length&&(o.activeFilterDropdown=null,b.element(n).off("click",x),o.$broadcast("render"))}m.recordMeasure("cnvHomeCenterPanelController begin"),o.newsFeedFilter={url:"#/feed"},o.mentionsFilter={url:e.linkToUrl(e.newFilterLink(f.newANDFiltersChain([f.newFilter(g.TO,"me","me")]),"Mentions"),!0)},o.starredFilter={url:e.linkToUrl(e.newFilterLink(f.newANDFiltersChain([f.newFilter(g.IN,g.IN_STARRED,g.IN_STARRED)]),"Starred"),!0)},o.draftsFilter={url:e.linkToUrl(e.newFilterLink(f.newANDFiltersChain([f.newFilter(g.IN,g.IN_DRAFTS,g.IN_DRAFTS)]),"Drafts"),!0)},o.trashFilter={url:e.linkToUrl(e.newFilterLink(f.newANDFiltersChain([f.newFilter(g.IN,g.IN_TRASH,g.IN_TRASH)]),"Trash"),!0)},o.postFilter="POST_FILTER",o.activeFilter=null,o.MAX_RELATED_TAGS=7;var y=null;o.orderFilter={latestActivity:!0,latestPost:!1},o.isStagFilterApplied=!1,o.isNonMemberPrivateGroupFilterAppliedAndNotAdminMode=function(){return d.getState()==d.STATE_GROUP&&o.group?!l.isAdminMode()&&o.group.isNonMemberPrivateGroup():!1},o.isNonMemberPublicGroupFilterAppliedAndNotAdminMode=function(){return d.getState()==d.STATE_GROUP&&o.group?!l.isAdminMode()&&o.group.isNonMemberPublicGroup():!1},o.reqToJoinGroup=function(){var a=c.reqToJoinGroup(o.group.get("id"));a.then(function(a,b){o.reqJoinGrpSuccess=!0,o.$emit("reqToJoinGroupSuccessful")})},o.$on("grpJoinReqSuccessful",function(){o.reqJoinGrpSuccess=!0}),o.openUrl=function(a){k.url(a)},h.$on("filterChange",t),o.openFilterDropdown=function(c,d){c&&$(c.target).closest(".filter-dropdown").length>0||(o.activeFilterDropdown===d?(o.activeFilterDropdown=null,b.element(n).off("click",x)):(o.activeFilterDropdown=d,c&&c.stopPropagation(),o.opened=!1,b.element(n).on("click",x)),a.setTimeout(function(){y.find(".add-more-placeholder").trigger("click")},0),o.$broadcast("render"))},o.closeFilterDropdown=function(a){a&&a.stopPropagation(),o.activeFilterDropdown=null,b.element(n).off("click",x),o.$broadcast("render")},o.$on("$destroy",function(){b.element(n).off("click",x)}),o.getPostFilterTitle=function(){return"Latest Activity"},t(),u(),p()}]}}]),b.module("convoApp").controller("cnvAddTagsWidgetCtrl",["$scope","$modalInstance","tags","hashtagsProvider","$q","Feed","utils","BlackListWordsService",function(a,b,c,d,e,f,g,h){function i(a,b){for(var c=!1,d=0;d<a.length-1&&(a[d].label===b&&(c=!0),!c);d++);return c}var j=c.split(",");a.tags=[];for(var k=0;k<j.length;k++)if(""!=j[k]){var l="#"==j[k].charAt(0)?j[k]:"#"+j[k];a.tags.push({id:g.generateHash(l),label:l,locked:!0})}a.getHashtags=function(a){var b=e.defer();return b.resolve(d.getHashtagsDropdownItems("#"+a)),b.promise},a.onSubmit=function(){var c=a.tags||[],d="",e="";if(c.length>0)for(var f=c.length;f--;)if(e=c[f].label,d=h.clean(e.substr(1,e.length)),d.length!==e.length)if(d.length>0){if(d="#"+d,e!==d){var g=i(c,d);g?c.splice(f,1):c[f].label=d}}else c.splice(f,1);b.close(a.tags)},a.dismiss=function(){b.dismiss()}}]),b.module("convoApp").controller("cnvFeedLinkThis",["$scope","$modalInstance","keyword","feedId","feedLikeThisService","$sce","utils",function(a,b,c,d,e,f,g){function h(b){a.keywords.length=0;for(var c=0;c<b.length;c++)a.keywords.push({id:g.generateHash(b[c]),label:b[c],readonly:!1});a.currentKeywords=a.keywords}a.feedLikeThisData={},a.feedLikeThisSuggestions=[],a.showBody=!0,a.processing=!0,a.loadMore="Load More",a.top_terms="",a.currentKeywords=c,a.feed=d,a.keywords=[];var i=0;console.log("////////////////////////////////////////////Feed Like This CONTROLLER/////////////////////////////////////"),console.log(c),console.log(d),a.dismiss=function(){b.dismiss()},a.loadData=function(b,c,d,g){a.loadMore="Please Wait",b||(b=a.keywords),1==d&&(a.feedLikeThisSuggestions=[],i=0);for(var j=[],k=0;k<b.length;k++)j.push(b[k].label);a.currentKeywords=b,promise=e.getFeeds(j.join(" "),c,i,g),console.log(promise),promise.then(function(b){a.feedLikeThisData=b.data,a.feedLikeThisSuggestions=a.feedLikeThisSuggestions.concat(b.data.suggestions),h(a.feedLikeThisData.top_terms),setTimeout(function(){for(a.top_terms="",k=0;k<a.feedLikeThisData.top_terms.length;k++)a.top_terms+="<span class='high"+(k+1)+"'>",a.top_terms+=a.feedLikeThisData.top_terms[k]+"</span>",k<a.feedLikeThisData.top_terms.length-1?a.top_terms+=", ":a.top_terms+=" ",$("div.fetchMore").highlight(a.feedLikeThisData.top_terms[k],{element:"em",className:("high"+(k+1)).toString()});for(a.rest_terms="",k=0;k<a.feedLikeThisData.rest_terms.length;k++)a.rest_terms+="<span class='restTerms'>",a.rest_terms+=a.feedLikeThisData.rest_terms[k]+"</span>",k<a.feedLikeThisData.rest_terms.length-1?a.rest_terms+=", ":a.rest_terms+=" ",$("div.fetchMore").highlight(a.feedLikeThisData.rest_terms[k],{element:"em",className:"restTerms"});a.top_terms_sec=f.trustAsHtml(a.top_terms),a.rest_terms_sec=f.trustAsHtml(a.rest_terms),a.$$phase||a.$digest()},0),a.processing=!1,i+=50,a.loadMore="Load More"})},a.onEscKeyPressInToField=function(){},a.onItemAddedInToField=function(a){},a.onItemRemovedInToField=function(a){},a.onCtrlOrCmdEnterPressInTextEditor=function(){},a.getShareWithDropdownItems=function(a){},a.loadData([{label:a.currentKeywords}],a.feed,!1,!1)}]),b.module("convoApp").directive("cnvGroupsFilterList",["Groups","$compile","$rootScope",function(a,b,c){return{restrict:"A",scope:{},controller:["$scope",function(d){function e(){var a=c.filter_info;a.filter_applied?d.filtered_group_id=a.filter.filters[0].value:d.filtered_group_id=null}d.filtered_group_id=null,d.getGroupsData=function(){d.groups=[],a.getAccessibleRegularAndStreamGroupsSortedByRelevancy().then(function(a){d.groups=a})},d.applyFilterToTop3=function(a,b){},d.expandGroupList=function(){0!=$("div.group_list").length||d.isAlreadyRemoved?d.isAlreadyRemoved=!1:$("div.expand").append(b('<div class="group_list" cnv-groups-filter-expand-list></div>')(d))},c.$on("filterChange",e)}],link:function(a,b,c){a.getGroupsData()},templateUrl:"home/components/cnvGroupsFilterList/cnvGroupsFilterList.tpl.html"}}]).directive("cnvGroupsFilterExpandList",function(){return{restrict:"A",controller:["$scope",function(a){a.setFocusToInputField=function(){$("div.group_list").find("input").focus(),$("div.group_list").find("input").text(""),a.searchGroupText=""},a.applyFilter=function(b,c){$("div.group_list").length>0&&$("div.group_list").remove(),a.isAlreadyRemoved=!0},a.highlightItemOnKeyup=function(b){if(27==b.keyCode&&$("div.group_list").length>0&&$("div.group_list").remove(),13==b.keyCode&&a.prevHighlightedItem){$(a.prevHighlightedItem).find("a").attr("href");$(a.prevHighlightedItem).find("a").click(),$("div.group_list").length>0&&$("div.group_list").remove()}(a.keypress||8==b.keyCode)&&(a.keypress?(a.prevHighlightedItem?($(a.prevHighlightedItem).css("background-color","transparent"),a.searchGroupText&&a.searchGroupText.length>0&&$("div.group_list").find("tr:nth-child(2)").css("background-color","#7eced1"),a.prevHighlightedItem=$("div.group_list").find("tr:nth-child(2)")):(a.searchGroupText&&a.searchGroupText.length>0&&$("div.group_list").find("tr:nth-child(2)").css("background-color","#7eced1"),a.prevHighlightedItem=$("div.group_list").find("tr:nth-child(2)")),a.keypress=!1):a.prevHighlightedItem&&(a.searchGroupText&&a.searchGroupText.length>0?($(a.prevHighlightedItem).css("background-color","transparent"),$("div.group_list").find("tr:nth-child(2)").css("background-color","#7eced1"),a.prevHighlightedItem=$("div.group_list").find("tr:nth-child(2)")):($(a.prevHighlightedItem).css("background-color","transparent"),a.prevHighlightedItem=null)))},a.highlightItemOnKeypress=function(b){13!=b.keyCode&&(a.keypress=!0)},a.highlightItemOnKeydown=function(b){38==b.keyCode&&(b.preventDefault(),a.prevHighlightedItem&&0==$(a.prevHighlightedItem).prev("tr").find("input").length?($(a.prevHighlightedItem).css("background-color","transparent"),$(a.prevHighlightedItem).prev().css("background-color","#7eced1"),$(a.prevHighlightedItem).prev().scrollintoview({duration:10,direction:"vertical"}),a.prevHighlightedItem=$(a.prevHighlightedItem).prev("tr")):a.prevHighlightedItem&&$(a.prevHighlightedItem).prev().scrollintoview({duration:10,direction:"vertical"})),40==b.keyCode&&(b.preventDefault(),a.prevHighlightedItem&&$(a.prevHighlightedItem).next("tr").find("td").length>0?($(a.prevHighlightedItem).css("background-color","transparent"),$(a.prevHighlightedItem).next().css("background-color","#7eced1"),$(a.prevHighlightedItem).next().scrollintoview({duration:10,direction:"vertical"}),a.prevHighlightedItem=$(a.prevHighlightedItem).next("tr")):null==a.prevHighlightedItem&&($("div.group_list").find("tr:nth-child(2)").css("background-color","#7eced1"),a.prevHighlightedItem=$("div.group_list").find("tr:nth-child(2)")))}}],link:function(b,c,d){b.setFocusToInputField(),b.prevHighlightedItem=null,b.iteration=1,a.addEventListener("mousedown",function(a){0==$(a.target).closest("div.group_list").length&&$("div.group_list").length>0&&$("div.group_list").remove()})},templateUrl:"home/components/cnvGroupsFilterList/cnvGroupsFilterExpandList.tpl.html"}}),b.module("convoApp").directive("cnvHomeCenterPanelFeedPinnedPostWidget",function(){return{restrict:"E",scope:!0,templateUrl:"home/components/cnvHomeCenterPanelFeedPinnedPostWidget/cnvHomeCenterPanelFeedPinnedPostWidget.tpl.html",controller:["$scope","Feed","homeViewStateInfo","userInfo","AppLinks",function(a,b,c,d,e){function f(){c.getState()===c.STATE_DEFAULT&&(a.pinnedFeedItems=b.getPinnedItems(),a.$broadcast("render"))}a.MINIMUM_PINS_TO_SHOW=3,a.MAXIMUM_PINS_TO_SHOW=a.MINIMUM_PINS_TO_SHOW,a.showAll=!0,a.pinnedFeedItems=b.getPinnedItems(),a.userInfo=d;var g=null;if(a.showAllPins=function(){a.MAXIMUM_PINS_TO_SHOW=a.pinnedFeedItems.length,a.showAll=!1,a.$broadcast("render")},a.showFewerPins=function(){a.MAXIMUM_PINS_TO_SHOW=a.MINIMUM_PINS_TO_SHOW,a.showAll=!0,a.$broadcast("render")},b.on("feedService:pinnedItemsUpdated",function(b){a.pinnedFeedItems=b,setTimeout(function(){a.$broadcast("render")},100)}),a.$on("homeViewStateChange",f),a.$broadcast("render"),a.$on("cnvOnboarding:setOnboardingFeedData",function(){g=a.pinnedFeedItems,a.pinnedFeedItems=null,a.$broadcast("render")}),a.$on("cnvOnboarding:removeOnboardingFeedData",function(){a.pinnedFeedItems=g,a.$broadcast("render")}),a.$on("$destroy",function(){b.off("feedService:pinnedItemsUpdated")}),a.isAdmin=d.isAdmin(),a.isAdmin){var h=e.newResourceLink("12",[{type:"9",uid:0},{type:"monitorContent",uid:0}],null,"monitorContent");a.feedPinsSettingsUrl=e.linkToUrl(h,!0)+"&tab=preferences"}}]}}),b.module("convoApp").directive("cnvHomeLeftPanel",["$rootScope","$location","$filter","$compile","$templateCache","appLoadSequenceManager","utils","config","groupSettingService",function(a,b,d,e,f,g,h,i,j){return{restrict:"E",scope:!1,link:function(a,c,h){function i(){var b=$(document).find(".network-logo-wrapper"),d=c.find(".left-panel-wrapper-slim"),e=c.find(".left-panel-wrapper-full"),f=$(document).find(".app-wrapper"),g=c.find(".private-grps-list > ul"),h=c.find(".public-grps-list > ul");g.on("mousewheel DOMMouseScroll",function(a){var b=a.originalEvent.wheelDelta||-a.originalEvent.detail,c=b>0?"up":"down",d="up"==c&&0==this.scrollTop||"down"==c&&this.scrollTop==this.scrollHeight-this.offsetHeight;d&&a.preventDefault()}),h.on("mousewheel DOMMouseScroll",function(a){var b=a.originalEvent.wheelDelta||-a.originalEvent.detail,c=b>0?"up":"down",d="up"==c&&0==this.scrollTop||"down"==c&&this.scrollTop==this.scrollHeight-this.offsetHeight;d&&a.preventDefault()}),a.$on("$destroy",function(){g.off("mousewheel DOMMouseScroll"),h.off("mousewheel DOMMouseScroll"),b=null,d=null,e=null,f=null})}function k(){var b=e(f.get(l))(a);c.empty().append(b),i()}var l="home/components/cnvHomeLeftPanel/cnvHomeLeftPanel.tpl.html";a.showFullMenu=!1,a.canCreateGroup=j.canCreateGroup(),j.registerCallback(function(b){a.canCreateGroup=b}.bind(this)),a.changeLocation=function(a){b.url(d("idToFilterUrlForApp")(a,"GROUP"))},a.showHideDirectsUnreadBubble=function(a){var b=$(".directs-unread-bubble",c);a?b.show():b.hide()},g.okToLoad(g.comps.LEFT_PANEL)?k():g.on("okToLoad"+g.comps.LEFT_PANEL,function(){k()})},controller:["$scope","Groups","AppLinks","Filters","FilterTypes","userInfo","alertsService","serverPingService","directsService","Users","User","usersGroupsListProvider","homeViewStateInfo","feedDirtyInfo","mixpanelService","onboardingService","Contacts","advSearchService","$timeout","searchService","integrationsIntroService","bannerService","whatsNewService","tagsService",function(e,f,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){function F(){e.activeFilter=null,e.filteredGroupId=null;var b=a.filterInfo;if(b.filterApplied&&b.filterLink.filter){if(1==b.filterLink.filter.filters.length){var c=b.filterLink.filter.filters[0];if(c.type==l.TO){if(e.filteredGroupId=c.value,e.groupsArray){var d=e.groupsArray.get(e.filteredGroupId);d&&d.resetUnreadCount()}c.value==e.thisUserId&&(e.activeFilter=e.mentionsFilter)}else c.type==l.IN&&(c.value==l.IN_STARRED?e.activeFilter=e.starredFilter:c.value==l.IN_DRAFTS?e.activeFilter=e.draftsFilter:c.value==l.IN_TRASH&&(e.activeFilter=e.trashFilter))}}else e.activeFilter=e.newsFeedFilter;e.activeFilter===e.newsFeedFilter&&(e.showFeedDirtyDot=!1,u.setIsDirty(!1)),e.$broadcast("render")}function G(){E.getStandardizedTags(!1).then(function(a){e.sTags.splice(0);for(var b=Object.keys(e.sTagRegions),c=0;c<b.length;c++)delete e.sTagRegions[b[c]];for(var d=Object.keys(e.sTagDistricts),c=0;c<d.length;c++)delete e.sTagDistricts[d[c]];a.forEach(function(a){e.sTags.push(a)}),e.sTags.forEach(function(a){
e.sTagRegions[a.stag_id]=a,a.children&&a.children.length&&a.children.forEach(function(a){e.sTagDistricts[a.stag_id]=a})})})["catch"](function(a){console.log(a)})}function H(){var a=f.getListableGroupsIfRelevanciesHaveBeenFilled();a?I(a):f.fillRelevanciesInListableGroups(!0).then(function(a){I(a)})}function I(a){e.groupsArray=a,ca=0,da=0,J(),e.$broadcast("render"),e.$broadcast("render:boRepeat:leftPanelGroupsList")}function J(){e.numberOfPinnedGroups=0,e.privateGroupsArray=new Backbone.Collection,e.publicGroupsArray=new Backbone.Collection;for(var a=0;a<e.groupsArray.length;a++){var b=e.groupsArray.at(a),c=b.get("id");b.get("pinned_at")&&(e.numberOfPinnedGroups+=1);var d=b.get("access");"SECRET"==d||"PRIVATE"==d?(e.privateGroupsArray.add(b),ca+=1,ca<=e.MAX_PRIVATE_GROUPS_TO_DISPLAY&&M(b,c)):"PUBLIC"==d&&(e.publicGroupsArray.add(b),da+=1,da<=e.MAX_PUBLIC_GROUPS_TO_DISPLAY&&M(b,c))}}function K(a,b){for(var c=b;c<a.length;c++){var d=a.at(c);M(d,d.id)}}function L(){v.trackEvent(v.CLICK_IN_LEFT_MENU,{Type:"Group Dropdown"})}function M(a,c){var g=[];if(e.menuOptions[c]={type:"circleLessChevron",wrapperClass:"wrapper",onMenuOpen:L,align:"right",options:g},g.push({label:"Copy link",callback:function(){h.copyToClipboard(i.CONVO_LINKS_BASE_URL+d("idToFilterUrlForApp")(c,"GROUP").slice(1))}}),g.push({isDivider:!0}),g.push({label:"Group settings",url:R(a)}),a.get("is_admin")||1==a.get("membersCanInvite")||m.isAdminMode()?g.push({label:"Invite people to this group",callback:function(){S(a)}}):g.push({label:"View members",callback:function(){var c=j.newResourceLink("9",[{uid:a.get("id"),type:"22"},{uid:"2",type:"GroupMembers"}],null,a.get("title")+" (Members)");b.url(j.linkToUrl(c,!0).slice(1))}}),m.isAdminMode()||a.isGroupAdmin(e.thisUserId)||"1"==a.get("integrationsEnabled")&&!m.isGuestUser()){var k=j.newResourceLink("9",[{uid:a.get("id"),type:"22"},{uid:"2",type:"GroupIntegrations"}],null,"Group Integrations"),l=j.linkToUrl(k);g.push({label:"Add or manage integrations",url:l,callback:function(){b.path(l.slice(1))}})}(m.isAdminMode()||a.isGroupAdmin(e.thisUserId)||"1"==a.get("membersCanPinContent"))&&g.push({label:"Pin important posts or links",callback:function(){N(a)}}),a.get("isMember")&&g.push({isDivider:!0},{label:"Notification preferences",callback:function(){V(a)}});var n={};n.callback=function(){"Show posts in my feed"==n.label?f.toggleShowHidePostsInFeed(a,0).success(function(a,b){a.type&&(n.label="Hide posts from my feed")}):f.toggleShowHidePostsInFeed(a,1).success(function(a,b){a.type&&(n.label="Show posts in my feed")})},"1"==a.get("isHidden")?n.label="Show posts in my feed":n.label="Hide posts from my feed",a.get("isMember")&&g.push(n),a.get("pinned_at")&&!m.isAdminMode()?g.push({label:"Unpin from top of my group list",callback:function(){P(c)}}):m.isAdminMode()||g.push({label:"Pin to top of my group list",callback:function(){O(c)}}),"undefined"!=typeof a.get("this_user_can_leave")&&!a.get("this_user_can_leave")||"undefined"!=typeof a.get("members_can_leave")&&!a.get("members_can_leave")||g.push({isDivider:!0},{label:"Leave group",callback:function(){T(a)}}),"ACCOUNT_ANNOUNCEMENTS"!==a.get("type")&&(m.isAdminMode()||a.get("is_admin"))&&g.push({label:"Delete group",callback:function(){U(a)}})}function N(a){var b={resource_name:function(){return""},resource_url:function(){return""},provided_desc:function(){return"Paste a link to a Convo post or an external website to pin it to the top of the group."},title:function(){return!1},btnTitle:function(){return!1},source:function(){return"no_suggestion"}},c="home/groupView/rightPanelWidgets/cnvAddPinContentModal.tpl.html",d="cnvAddPinContentModalCtrl",e=n.customModal(c,d,b);e.result.then(function(b){f.pinContentToGroup(a,b).success(function(a,c){a.type||(b.error=!0),b.is_posting=!1}),b.is_posting=!0},function(){})}function O(a){f.pinGroup(a)}function P(a){f.unpinGroup(a)}function Q(a){fa=a,e.activeFilter===e.mentionsFilter?e.resetDirectsCount():e.showHideDirectsUnreadBubble(fa>0)}function R(a){var b=j.newResourceLink("9",[{uid:a.get("id"),type:"22"},{uid:"2",type:"GroupSettings"}],null,a.get("title")+" (Settings)");return j.linkToUrl(b,!0)}function S(a){x.initContactsInviteModal({invite_via:"Invite_Dialog",include_off_domain:!0,get_details_first:!0,group:a})}function T(a){var b="Leave Group",c="Are you sure you want to leave this group? As the only group administrator, if you leave no one will be authorized to manage this group.",d="You are an admin of this group. Are you sure you want to leave it?",g="Are you sure you want to leave this group?",h="Leave group",i="Cancel";a.isThisUserIsTheOnlyGroupAdmin(e.thisUserId)?n.promptModal(b,c,function(){f.removeUserFromGroup(a.get("id"),e.thisUserId)},null,h,i,null,!0):a.get("is_admin")?n.promptModal(b,d,function(){f.removeUserFromGroup(a.get("id"),e.thisUserId)},null,h,i,null,!0):n.promptModal(b,g,function(){f.removeUserFromGroup(a.get("id"),e.thisUserId)},null,h,i,null,!0)}function U(a){var b="Delete group",c='<b>There is no undo for this action.</b><br/><br/>Are you sure you want to delete the "[groupname]" group and all content shared with this group? Deleting this group will remove all members from the group, and remove the group from the directory.<br/><br/>Posts that are shared with this group and also shared with any other group or person will continue to remain available.',d="Delete";alertCANCELText="Cancel",n.promptModal(b,c.replace("[groupname]",a.get("title")),function(){var b=f.deleteGroup(a.get("id"));C.showBanner_promise(b,"Deleting group",null,null,!1,!1)},null,d,alertCANCELText,null,!0)}function V(a){var b="home/components/groupNotificationsWidget/templates/groupNotificationsModal.tpl.html",c="groupNotificationsModalCtrl",d="group-notification-preferences",e={Group:function(){return a}};n.customModal(b,c,e,d)}function W(){var a=e.showFeedDirtyDot;return e.showFeedDirtyDot=e.activeFilter!==e.newsFeedFilter&&u.getIsDirty(),e.showFeedDirtyDot!==a}function X(){W()&&e.$broadcast("render")}function Y(a){a.showUnreadAnouncementsIndicator=a.showUnreadAnouncementsIndicator||a.showWhatsNewTooltip,e.whatsNewData=a,a.notifyAboutNewFeatures&&(e.showUnreadAnouncementsIndicator=a.showUnreadAnouncementsIndicator)}var Z=5,_=4,aa=4,ba=4;e.groupsArray=null,e.privateGroupsArray=null,e.publicGroupsArray=null,e.sTags=[],e.sTagRegions={},e.sTagDistricts={},e.sTagsExpandedRegions={},e.sTagExpandedDistricts={},e.sTagsRegionsLimit=_,e.sTagsDistrictsLimit=aa,e.sTagsStoresLimit=ba,e.menuOptions={},e.MAX_PRIVATE_GROUPS_TO_DISPLAY=Z,e.MAX_PUBLIC_GROUPS_TO_DISPLAY=Z,e.groupsCollapsed=!0,e.privateGroupsCollapsed=!0,e.publicGroupsCollapsed=!0,e.filteredGroupId=null,e.numberOfPinnedGroups=0,e.thisUserId=m.getUserId(),e.thisUserRole=m.userRole,e.isGuestUser=m.isGuestUser(),e.userInfo=m,e.showFeedDirtyDot=!1;var ca=0,da=0,ea=!1,fa=0;e.newsFeedFilter={url:"#/feed"};var ga=k.newANDFiltersChain([k.newFilter(l.TO,"me","me")]);ga.includeChats=!1,e.mentionsFilter={url:j.linkToUrl(j.newFilterLink(ga,"Mentions"),!0)},e.starredFilter={url:j.linkToUrl(j.newFilterLink(k.newANDFiltersChain([k.newFilter(l.IN,l.IN_STARRED,l.IN_STARRED)]),"Starred"),!0)},e.draftsFilter={url:j.linkToUrl(j.newFilterLink(k.newANDFiltersChain([k.newFilter(l.IN,l.IN_DRAFTS,l.IN_DRAFTS)]),"Drafts"),!0)},e.trashFilter={url:j.linkToUrl(j.newFilterLink(k.newANDFiltersChain([k.newFilter(l.IN,l.IN_TRASH,l.IN_TRASH)]),"Trash"),!0)},e.activeFilter=null,m.on("userInfo.userRoleUpdated",function(){e.thisUserRole=m.userRole,e.isGuestUser=m.isGuestUser()}),f.on("toggledShowHidePostsInFeed",function(a,b,c){if(c){var d=f.getGroup(a);d&&(d.setIsHidden(Boolean(b)),M(d,a))}}),e.expandSTagRegion=function(a,b){for(var c=Object.keys(e.sTagsExpandedRegions),d=0;d<c.length;d++)delete e.sTagsExpandedRegions[c[d]];for(var c=Object.keys(e.sTagExpandedDistricts),d=0;d<c.length;d++)delete e.sTagExpandedDistricts[c[d]];e.sTagsExpandedRegions[b]=!0,e.showLessDistricts(),e.showLessStores()},e.collapseSTagRegion=function(a,b){for(var c=Object.keys(e.sTagExpandedDistricts),d=0;d<c.length;d++)delete e.sTagExpandedDistricts[c[d]];delete e.sTagsExpandedRegions[b],e.showLessDistricts(),e.showLessStores()},e.expandSTagDistrict=function(a,b){for(var c=Object.keys(e.sTagExpandedDistricts),d=0;d<c.length;d++)delete e.sTagExpandedDistricts[c[d]];e.sTagExpandedDistricts[b]=!0,e.showLessStores()},e.collapseSTagDistrict=function(a,b){delete e.sTagExpandedDistricts[b],e.showLessStores()},e.showMoreRegions=function(){e.sTagsRegionsLimit=c},e.showLessRegions=function(){e.sTagsRegionsLimit=_},e.showMoreDistricts=function(){e.sTagsDistrictsLimit=c},e.showLessDistricts=function(){e.sTagsDistrictsLimit=aa},e.showMoreStores=function(){e.sTagsStoresLimit=c},e.showLessStores=function(){e.sTagsStoresLimit=ba},e.togglePrivateGroupsView=function(){e.privateGroupsCollapsed=!e.privateGroupsCollapsed,e.privateGroupsCollapsed?e.MAX_PRIVATE_GROUPS_TO_DISPLAY=Z:(K(e.privateGroupsArray,e.MAX_PRIVATE_GROUPS_TO_DISPLAY),e.MAX_PRIVATE_GROUPS_TO_DISPLAY=ca),e.$broadcast("render"),e.$broadcast("render:boRepeat:leftPanelGroupsList")},e.togglePublicGroupsView=function(){e.publicGroupsCollapsed=!e.publicGroupsCollapsed,e.publicGroupsCollapsed?e.MAX_PUBLIC_GROUPS_TO_DISPLAY=Z:(K(e.publicGroupsArray,e.MAX_PUBLIC_GROUPS_TO_DISPLAY),e.MAX_PUBLIC_GROUPS_TO_DISPLAY=da),e.$broadcast("render"),e.$broadcast("render:boRepeat:leftPanelGroupsList")},e.onNewsFeedFilterMouseDown=function(){e.activeFilter==e.newsFeedFilter&&a.$broadcast("pollFeedRequest",!0,"USER_ACTION: clicked news feed again"),A.clearSearch(),y.closePanelWithoutAnim()},e.createGroup=function(a,c,e){var g="home/components/createGroupWidget/createGroupModal.tpl.html",h="createGroupModalCtrl",i="group-create-details",j={createPublic:function(){return c},createPrivate:function(){return a},sourceGS:function(){return ea}},k=n.customModal(g,h,j,i);ea=e,k.result.then(function(a){f.getGroups(!0,!0).then(function(c){H(),w.checkState()?w.checkState()&&0==w.getChecklist().create_a_group_done:b.url(d("idToFilterUrlForApp")(a).slice(1))})},function(){e&&w.onboardingDismissedCallback()})},e.resetDirectsCount=function(){if(fa>0){var a=p.resetDirectsCount();a.then(function(a,b){fa=0,e.showHideDirectsUnreadBubble(!1)})}},e.openIntegrationsPage=function(){B.initIntegrationsIntroDialog()},e.openGroupsDirectory=function(){var a=j.newResourceLink("22",[{uid:"1",type:"26"},{uid:"2",type:"AllGroups"}],null,"Groups Directory (All Groups)"),c=j.linkToUrl(a,!0);b.url(c.slice(1))},e.trackClick=function(a){v.trackEvent(v.CLICK_IN_LEFT_MENU,{Type:a})},f.on("groupsUpdated",H),o.on("directsUnreadCountUpdate",Q),o.on("whatsNewDataUpdate",Y),e.whatsNewData=null,u.on("feedDirty",X),u.on("feedDirtyClear",X),e.$on("createGroupModalCtrl:InvitationModalClosed",function(){if(w.checkState()&&0==w.getChecklist().create_a_group_done){var a=w.recordAction("create_a_group_done");a.then(function(a,b){w.setLastPlayedStep("create_group"),e.$emit("cnvOnboarding:updateOnboardingChecklist",ea?!1:!0)})}}),a.$on("filterChange",F),a.$on("cnvOnboarding:openCreateGroupModal",function(){e.createGroup(!0,!1,!0)}),g.okToLoad(g.comps.LEFT_PANEL)?(H(),G(),F()):(f.fillRelevanciesInListableGroups(!0),g.on("okToLoad"+g.comps.LEFT_PANEL,function(){H(),G(),F()})),e.showWhatsNewDialog=function(){v.trackEvent(v.CLICK_WHATS_NEW_LEFT_COLUMN,{}),$(".cnv-whats-new-tooltip").remove(),e.whatsNewData&&D.markAnnouncementsAsRead(e.whatsNewData.anouncementsLastTimeStamp).then(function(){o.getUpdatesFromServer()}),e.showUnreadAnouncementsIndicator=!1;var a="home/components/cnvWhatsNewDialog/whatsNew.tpl.html",b="cnvWhatsNew",c={data:function(){return e.whatsNewData}},d="cnv-whats-new-modal";n.customModal(a,b,c,d).result.then(function(a){console.log("What's new modal shown.")},function(){console.log("error showing what's new modal")})}}]}}]),b.module("convoApp").directive("cnvHomeLeftPanelScrollHandler",[function(){return{restrict:"A",link:function(a,b,c){var d=b.find(".left-panel-wrapper-full"),e=b.find(".groupsItemsContainer"),f=null,g=function(a,b){var c=$(this).scrollTop();if(0===c&&b>0||$(this)[0].scrollHeight-c==$(this).outerHeight()&&0>b)return void a.preventDefault();if($(a.target).is(".wrapper *, .wrapper"))return void a.preventDefault();var d=$(this);e.find("ul > li > div.pull-right > .wrapper").filter(function(){return"none"==$(this).css("display")}).each(function(a,b){$(this).css("display","")}),e.find("ul > li > div.pull-right > .wrapper").filter(function(){return"block"==$(this).css("display")}).each(function(b,c){0==d.scrollTop()||f&&f==a.offsetY||($(this).css("display","none"),$(this).find(".dropdown-menu").is(":visible")&&$(this).find(".dropdown-menu").hide())}),f=a.offsetY};a.scrollTop=function(){$("#feedScroller").animate({scrollTop:0},{duration:300})},a.$on("scrollTop",function(){a.scrollTop()}),d[0].addEventListener("scroll",g,!0),a.$on("$destroy",function(){d[0].removeEventListener("scroll",g,!0)})}}}]),b.module("convoApp").directive("cnvInFeedFilterWidget",function(){return{restrict:"AE",templateUrl:"home/components/cnvInFeedFilterWidget/cnvInFeedFilterWidget.tpl.html",link:function(a,b,c){},controller:["$scope","AppLinks","FilterTypes","homeViewStateInfo","Filters","usersGroupsListProvider",function(a,b,c,d,e,f){function g(){var a=d,f=a.getState(),g=a.getHasFilter(),i=null;f===a.STATE_DEFAULT?(i={description:""},h.active=!0):f===a.STATE_GROUP?(i=a.getToFilter(),h.active=!0):f===a.STATE_USER&&(i=a.getFromFilter(),h.active=!0),h.active&&(h.filterLinkWithAll=b.linkToUrl(b.newFilterLink(e.newANDFiltersChain([i]),i.description),!0),h.filterLinkWithFiles=b.linkToUrl(b.newFilterLink(e.newANDFiltersChain([i,e.newFilter(c.HAS,e.hasFilter.ALL_FILES,e.hasFilter.ALL_FILES)]),i.description),!0),h.filterLinkWithImages=b.linkToUrl(b.newFilterLink(e.newANDFiltersChain([i,e.newFilter(c.HAS,e.hasFilter.IMAGES,e.hasFilter.IMAGES)]),i.description),!0),g&&g.description===e.hasFilter.ALL_FILES?h.activeFilter=h.FILTER_TYPE_FILES:g&&g.description===e.hasFilter.IMAGES?h.activeFilter=h.FILTER_TYPE_IMAGES:h.activeFilter=h.FILTER_TYPE_ALL)}var h=a;h.filterLinkWithAll="javascript:void(0);",h.filterLinkWithFiles="javascript:void(0);",h.filterLinkWithImages="javascript:void(0);",h.FILTER_TYPE_ALL=1,h.FILTER_TYPE_FILES=2,h.FILTER_TYPE_IMAGES=3,h.activeFilter=null,h.active=!1,h.$on("homeViewStateChange",g),g()}]}}),b.module("convoApp").controller("cnvInviteTeammatesModalCtrl",["$scope","$modalInstance","usersGroupsListProvider","$q","teammate_email","showAutoComplete","autoCompleteFieldLabelText","autoCompleteItems",function(a,b,c,d,e,f,g,h){a.title="Invite your teammates",a.inviteTo=[],a.messageTxt,a.providedTeammateEmail=e,a.showAutoComplete=f,a.autoCompleteFieldLabelText=g,a.autoCompleteItems=h,a.providedTeammateEmail&&a.inviteTo.push(a.providedTeammateEmail),a.getAutoCompleteUserItems=function(b,e){var f=d.defer();return a.showAutoComplete&&f.resolve(c.queryCustomList(a.autoCompleteItems,b,e+4)),f.promise},a.cancel=function(){b.dismiss()},a.inviteTeammates=function(){b.close({inviteTo:a.inviteTo,messageText:a.messageTxt})},a.$broadcast("render")}]),b.module("convoApp").directive("cnvLeftPanelGroupsList",["utils","groupSettingService",function(a,b){return{restrict:"AE",replace:!0,scope:!0,controller:["$scope","Groups","serverPingService",function(a,c,d){function e(){c.fillGroupsUnreadCounts(d.getGroupsUnreadCounts()).then(function(b){b&&a.$broadcast("render")})}d.on("groupsUnreadCountsUpdate",e),e(),a.canCreateGroup=b.canCreateGroup(),b.registerCallback(function(b){a.canCreateGroup=b}.bind(this)),a.resetUnreadCount=function(b){var c=a.groupsArray.get(b);c.resetUnreadCount()}}],link:function(b,c,d){var e=null,f=a.isIE()||a.isFirefox()&&!a.isOsX(),g=function(a){var b=$(this),c=$(".wrapper",b),d=b.position();c.css({top:d.top,left:d.left+(f?190:210)})};b.$on("render:boRepeat:leftPanelGroupsList",function(){e&&e.off("mouseover",g),e=c.find("li.parent"),e.on("mouseover",g)}),e=c.find("li.parent"),e.on("mouseover",g)}}}]),b.module("convoApp").controller("cnvSharePostWidgetCtrl",["$scope","$modalInstance","sharingInfo","usersGroupsListProvider","atMentionsListProvider","$q","Feed","preventProcessSharingInfo","submitAnyway","userInfo",function(a,b,d,e,f,g,h,i,j,k){function l(){var b=!0,c=[];if(j)a.sharingInfo.length||(b=!1);else for(var d=0,e=a.sharingInfo.length;e>d;++d)c.push(a.sharingInfo[d].id),a.sharingInfo[d].readonly&&(b=!1);return b||p.toString()!==c.toString()}if(a.sharingInfo=[],a.dirty=!1,a.submitAnyway=j,a.isGuest=k.isGuestUser(),i)a.sharingInfo=d.slice();else for(var m=0;m<d.length;m++)if("USER"==d[m].type){var n={type:"USER",id:d[m].published_to,label:h.getNameById(d[m].published_to),readonly:j?1===parseInt(d[m].is_at_mentioned):!0};a.sharingInfo.push(n)}else if("GROUP"==d[m].type){var o=h.getGroup(d[m].published_to),n={type:"GROUP",id:d[m].published_to,label:h.getGroupName(d[m].published_to),readonly:j?1===parseInt(d[m].is_at_mentioned):!0};n.classes="group ",o&&"PRIVATE"==o.access?n.classes+='privateGroup_icon-lightgray"':o&&"PUBLIC"==o.access?n.classes+="Icon1_PublicChannel-01-lightgray":o&&"SECRET"==o.access&&(n.classes+="privateGroup_icon-lightgray"),a.sharingInfo.push(n)}for(var p=[],m=0,q=a.sharingInfo.length;q>m;++m)p.push(a.sharingInfo[m].id);a.getShareWithDropdownItems=function(b){var d=g.defer(),h="";return a.isGuest||(h=e.LIST_NAMES.NETWORK_ON_DOMAIN_CONTACTS_LIST),d.resolve(f.queryPublishableUsersAndGroups(b,c,null,h,a.isGuest?!1:!0)),d.promise},a.onItemAddedInToField=function(b){return"ERROR"==b.type?void a.sharingInfo.splice(a.sharingInfo.length-1):void(a.dirty=l()?!0:!1)},a.onItemRemovedInToField=function(b){a.dirty=l()?!0:!1},a.onSubmit=function(){l()&&b.close(a.sharingInfo)},a.dismiss=function(){b.dismiss()},a.onCtrlOrCmdEnterPressInTextEditor=a.onSubmit,a.onEscKeyPressInToField=a.dismiss,a.dirty=l()}]),b.module("convoApp").controller("cnvWhatsNew",["$scope","$modalInstance","data","whatsNewService",function(a,b,c,d){a.title="What's new?",a.cancel=function(){b.dismiss()},a.whatsNewData=c,a.toggleNotifyMeAboutUpdates=function(b){var c=b.target,e=c.checked;a.whatsNewData.notifyAboutNewFeatures=e,d.setNotifyMeAboutUpdates(e).then(function(){})},setTimeout(function(){$("#whatsNewTextCont").load("/whats-new/web.html")},0)}]),b.module("convoApp").factory("whatsNewService",["ServerComm","$q",function(a,b){function c(c){var d={method:"changeNotifyAboutNewFeaturesSetting",data:{value:c}},e=b.defer();return a.post("announcements",d).then(function(a,b){200===a.status&&e.resolve(a.data)}),e.promise}function d(c){var d={method:"markWhatsnewTooltipShown",data:{till:c}},e=b.defer();return a.post("announcements",d).then(function(a,b){200===a.status&&e.resolve(a.data)}),e.promise}function e(c){var d={method:"markAnnouncementsAsRead",data:{till:c}},e=b.defer();return a.post("announcements",d).then(function(a,b){200===a.status&&e.resolve(a.data)}),e.promise}var f={};_.extend(f,Backbone.Events);return f.setNotifyMeAboutUpdates=c,f.markWhatsnewTooltipShown=d,f.markAnnouncementsAsRead=e,f}]),b.module("convoApp").directive("cnvCreateGroupDomManpltr",function(){return{restrict:"E",scope:!1,link:function(a,b,c){var d=a;d.domManpltrCtrl.isInitialized=!1,d.domManpltrCtrl.getGroupDesc=function(){var a=b.parent();return a.find("textArea.group-desc").val()},d.domManpltrCtrl.getGroupName=function(){var a=b.parent();return a.find("input.group-name").val()},d.domManpltrCtrl.setGroupDetails=function(){var a=b.parent();d.groupName.length>0&&a.find("input.group-name").val(d.groupName),d.groupDesc.length>0&&a.find("textArea.group-desc").val(d.groupDesc),d.GROUP_TYPE==d.GROUP_TYPE_PUBLIC?d.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED?a.find("input.group-auto-follow").attr("checked","true"):a.find("input.group-auto-follow").removeAttr("checked"):d.GROUP_EXTENDED_PROPERTIES.LIST_IN_GROUP_DIRECTORY?a.find("input.group-vis").attr("checked","true"):a.find("input.group-vis").removeAttr("checked"),d.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS?a.find("input.group-edit-settings").attr("checked","true"):a.find("input.group-edit-settings").removeAttr("checked")},d.domManpltrCtrl.showError=function(){var a=b.parent();a.find("input.group-name").attr("required","true")},d.domManpltrCtrl.setFocusToGrpNameField=function(){var a=b.parent().find("input.group-name");a.focus(),a.select()},d.domManpltrCtrl.disableNextBtn=function(){$("#crtGrpNxtBtn").attr("disabled","true")},d.domManpltrCtrl.enableNextBtn=function(){$("#crtGrpNxtBtn").removeAttr("disabled")},d.domManpltrCtrl.isInitialized=!0}}}),b.module("convoApp").controller("createGroupModalCtrl",["$scope","$modalInstance","Groups","usersGroupsListProvider","$q","Users","alertsService","config","createPublic","createPrivate","mixpanelService","sourceGS","onboardingService","$rootScope","userInfo",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){a.title="What kind of a group are you creating?",i?(a.STATE=a.CREATE_GROUP_STEP2,a.GROUP_TYPE=a.GROUP_TYPE_PUBLIC,a.updateCreateGroupState(a.CREATE_GROUP_STEP2,!1)):j?(a.STATE=a.CREATE_GROUP_STEP2,a.GROUP_TYPE=a.GROUP_TYPE_PRIVATE,a.updateCreateGroupState(a.CREATE_GROUP_STEP2,!1)):(a.STATE=a.CREATE_GROUP_STEP1,a.GROUP_TYPE=a.GROUP_TYPE_PUBLIC),a.$broadcast("render")}function q(b){var c=a;if(c.invitesCtrl){var d={};d.Via=c.invitesCtrl.contacts.invite_via,d["Scraped Master List"]=d["Personal List"]=d["Master List"]=d.Email=0,c.invitesCtrl.inputObj.inviteMessage?c.invitesCtrl.inputObj.inviteMessage==c.invitesCtrl.inputObj.originalMessage?d["Personal Message"]="Default":d["Personal Message"]="Edited":d["Personal Message"]="None";for(var e=[],f=0,h=c.invitesCtrl.addedList.length;h>f;f++){var i=c.invitesCtrl.addedList[f];e.push(i.email),"0"==i.rank?++d["Scraped Master List"]:"1"==i.rank?++d["Personal List"]:"2"==i.rank?++d["Master List"]:++d.Email}if(d["Invite To"]="Group",k.trackEvent(k.INVITE_SENT,d),b.data&&b.data.invitation_data){var j="common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",l="findContactsSplashCtrl",m={data:function(){return{response:{response:b,totalInvitesSent:a.invitesCtrl.addedList.length,invited_to:"GROUP"},requestedView:"COMPLETE"}}};g.customModal(j,l,m).result.then(function(a){console.log("invite complete."),n.$broadcast("createGroupModalCtrl:InvitationModalClosed")},function(){console.log("invite complete."),n.$broadcast("createGroupModalCtrl:InvitationModalClosed")})}else n.$broadcast("createGroupModalCtrl:InvitationModalClosed")}else n.$broadcast("createGroupModalCtrl:InvitationModalClosed")}a.isGuest=o.isGuestUser(),a.CREATE_GROUP_STEP1="cg1",a.CREATE_GROUP_STEP2="cg2",a.CREATE_GROUP_STEP3="cg3",a.CREATE_GROUP_STEP4="cg4",a.GROUP_TYPE_PUBLIC="groupTypePublic",a.GROUP_TYPE_PRIVATE="groupTypePrivate",a.domManpltrCtrl={},a.existedGroupDetails={},a.groupValidator={},a.groupValidator.groupName="",a.isNative=h.IS_NATIVE,a.isMac=h.IS_MAC,a.contacts=[],a.separatorsCount={value:0},a.GROUP_EXTENDED_PROPERTIES={},a.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_LEAVE_GROUP=!0,a.GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST=!1,a.GROUP_EXTENDED_PROPERTIES.LIST_IN_GROUP_DIRECTORY=!0,a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_LEAVE_GROUP=!0,a.GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST=!1,a.cnvModalType_invites="invites",a.cnvModalType_post_creators="post_creators",a.cnvModalType=a.cnvModalType_invites,a.toggleGroupType=function(b){a.GROUP_TYPE=b,a.$broadcast("render")},a.switchViewTo=function(b){b==a.GROUP_TYPE_PUBLIC?(a.GROUP_TYPE=a.GROUP_TYPE_PUBLIC,a.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_LEAVE_GROUP=!0,a.GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST=!1):(a.GROUP_TYPE=a.GROUP_TYPE_PRIVATE,a.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED=!1,a.GROUP_EXTENDED_PROPERTIES.LIST_IN_GROUP_DIRECTORY=!0,a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_LEAVE_GROUP=!0,a.GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST=!1),a.updateCreateGroupState(a.CREATE_GROUP_STEP2,!0)},a.updateCreateGroupState=function(b,c){a.domManpltrCtrl.isInitialized&&(a.groupName=a.domManpltrCtrl.getGroupName(),a.groupDesc=a.domManpltrCtrl.getGroupDesc()),b==a.CREATE_GROUP_STEP2?(a.STATE=a.CREATE_GROUP_STEP2,a.GROUP_TYPE===a.GROUP_TYPE_PUBLIC?a.title="Set up your public group":a.title="Set up your private group",c||(a.groupName="",a.groupDesc="",a.showGrpAlreadyExistsAlert=!1,a.GROUP_TYPE===a.GROUP_TYPE_PUBLIC?(a.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_LEAVE_GROUP=!0,a.GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST=!1):(a.GROUP_EXTENDED_PROPERTIES.LIST_IN_GROUP_DIRECTORY=!0,a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS=!1,a.GROUP_EXTENDED_PROPERTIES.CAN_LEAVE_GROUP=!0,a.GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST=!1)),a.$broadcast("render"),setTimeout(function(){a.domManpltrCtrl.isInitialized&&a.domManpltrCtrl.setGroupDetails()},1)):b==a.CREATE_GROUP_STEP3?a.showAlertIfGroupExists():b==a.CREATE_GROUP_STEP4&&a.showPostCreatorsDialog()},a.onEscKeyPressInToField=function(){console.log("onEscKeyPressInToField")},a.onItemAddedInToField=function(a){console.log("onItemAddedInToField")},a.getInviteToDropdownItems=function(a,b){var c=e.defer();return c.resolve(d.queryCustomList(d.lists[d.LIST_NAMES.USERS][0],a,b+4)),c.promise},a.toggleAutoFollowEnabled=function(){var b=!a.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED;a.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED=b,a.$broadcast("render")},a.toggleGroupVisibility=function(){var b=!a.GROUP_EXTENDED_PROPERTIES.LIST_IN_GROUP_DIRECTORY;a.GROUP_EXTENDED_PROPERTIES.LIST_IN_GROUP_DIRECTORY=b},a.toggleEditGroupSettings=function(){var b=!a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS;a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS=b},a.submit=function(){a.isCreateGroupAlreadyInProgress=!0;var d,e=a.GROUP_EXTENDED_PROPERTIES;a.GROUP_TYPE===a.GROUP_TYPE_PUBLIC?d="PUBLIC":a.GROUP_TYPE===a.GROUP_TYPE_PRIVATE&&(d=e.LIST_IN_GROUP_DIRECTORY?"PRIVATE":"SECRET",e.AUTO_FOLLOW_ENABLED=!1),a.groupName||a.groupDesc||a.domManpltrCtrl.isInitialized&&(a.groupName=a.domManpltrCtrl.getGroupName(),a.groupDesc=a.domManpltrCtrl.getGroupDesc());var h,i=[],j="";if(!a.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED&&a.invitesCtrl){for(var k=0,n=a.invitesCtrl.addedList.length;n>k;k++)h=f.getUserById(a.invitesCtrl.addedList[k].id),h?i.push(a.invitesCtrl.addedList[k].email):i.push(a.invitesCtrl.addedList[k].label);j=a.invitesCtrl.inputObj.inviteMessage}var o,p,r,s,t=m.checkState()&&l?"GS":null,u=[];if(o=e.CAN_LEAVE_GROUP?1:0,"undefined"!=typeof e.MEMBERS_CAN_POST&&1==e.MEMBERS_CAN_POST){p=0;var h;if(a.postCreatorsCtrl&&a.postCreatorsCtrl.addedList){for(var k=0,n=a.postCreatorsCtrl.addedList.length;n>k;k++)u.push(a.postCreatorsCtrl.addedList[k].email);s=a.postCreatorsCtrl.custom_message_post_creators}r=u}else p=1;c.createGroup(a.groupName,a.groupDesc,d,e.AUTO_FOLLOW_ENABLED,e.CAN_INVITE_OTHERS,i,j,t,o,p,r,s).success(function(c,d){400===c.errorCode&&"Network admin restriction for creating group"===c.message?(a.cancel(),g.alertModal("Privilege Revoked","Your group creation privilege is revoked. Please contact your network administrator for details","OK",null,null,null,null)):(b.close(c.data.group_info.group_id),q(c))}).error(function(b,c){a.cancel()}),console.log("<<<<<<<<<<<<<< GROUP CREATION DETAILS >>>>>>>>>>>>"),console.log("GROUP TYPE : "+a.GROUP_TYPE),console.log("GROUP NAME : "+a.groupName),console.log("GROUP DESC : "+a.groupDesc),console.log("AUTO FOLLOW ENABLED : "+a.GROUP_EXTENDED_PROPERTIES.AUTO_FOLLOW_ENABLED),console.log("CAN INVITE OTHERS : "+a.GROUP_EXTENDED_PROPERTIES.CAN_INVITE_OTHERS),console.log("LIST IN DIRECTORY : "+a.GROUP_EXTENDED_PROPERTIES.LIST_IN_GROUP_DIRECTORY),console.log("CAN LEAVE GROUP : "+a.GROUP_EXTENDED_PROPERTIES.CAN_LEAVE_GROUP),console.log("MEMBERS CAN LEAVE : "+a.GROUP_EXTENDED_PROPERTIES.MEMBERS_CAN_POST),console.log("USERS TO INVITE : "+i)},a.isGrpNameEmptyAndGrpNameExists=function(){return!(a.groupValidator.groupName.length&&(a.existedGroupDetails.groupName!=a.groupValidator.groupName||a.domManpltrCtrl.isInitialized))},a.joinGroup=function(d){c.reqToJoinGroup(d).success(function(c,e){"PUBLIC"==a.existedGroupDetails.groupAccess?b.close(d):a.cancel()})},a.resetGroupName=function(){a.showGrpAlreadyExistsAlert=!1,a.$broadcast("render"),a.domManpltrCtrl.isInitialized&&a.domManpltrCtrl.setFocusToGrpNameField()},a.cancel=function(){b.dismiss()},a.showAlertIfGroupExists=function(b){a.domManpltrCtrl.isInitialized&&(a.groupName=a.domManpltrCtrl.getGroupName(),a.groupDesc=a.domManpltrCtrl.getGroupDesc()),a.domManpltrCtrl.isInitialized&&a.domManpltrCtrl.disableNextBtn(),a.groupName=a.groupName.trim(),c.getGroupInfo(a.groupName).success(function(c,d){a.domManpltrCtrl.isInitialized&&a.domManpltrCtrl.enableNextBtn();for(var e,f,g,h,i,j=c.data,k=0;j&&k<j.length;k++)if("ACTIVE"===j[k].status){f=j[k].group_id,g=j[k].access,h=j[k].is_user_member,i=j[k].auto_follow_enabled,e=!0;break}if(e)a.existedGroupDetails.groupId=f,a.existedGroupDetails.groupName=a.groupName,a.existedGroupDetails.groupAccess=g,a.existedGroupDetails.is_Member=h,a.existedGroupDetails.auto_Follow_Enabled=Number(i),a.showGrpAlreadyExistsAlert=!0;else if(b)a.submit();else if(a.invitesCtrl){if(a.title="Invite teammates to "+a.groupName,a.STATE=a.CREATE_GROUP_STEP3,a.cnvModalType=a.cnvModalType_invites,a.showGrpAlreadyExistsAlert=!1,a.postCreatorsCtrl&&!a.invitesCtrl.addedList.length)for(var l=0,m=a.postCreatorsCtrl.addedList.length;m>l;l++)a.invitesCtrl.addedList=[].concat(a.postCreatorsCtrl.addedList)}else{if(a.inviteListCtrl={},a.inviteTo=[],a.title="Invite teammates to "+a.groupName,a.STATE=a.CREATE_GROUP_STEP3,a.cnvModalType=a.cnvModalType_invites,a.showGrpAlreadyExistsAlert=!1,a.invitesCtrl={},a.postCreatorsCtrl)for(var l=0,m=a.postCreatorsCtrl.addedList.length;m>l;l++)a.invitesCtrl.addedList=[].concat(a.postCreatorsCtrl.addedList);a.invitesCtrl.contacts={},a.invitesCtrl.contacts.include_off_domain=!0,a.invitesCtrl.contacts.origin="Create_Group_Dialog",a.invitesCtrl.contacts.invite_via="Create_Group_Dialog",a.invitesCtrl.contacts.new_group={name:a.groupName}}a.$broadcast("render")})},a.showPostCreatorsDialog=function(){a.domManpltrCtrl.isInitialized&&(a.groupName=a.domManpltrCtrl.getGroupName(),a.groupDesc=a.domManpltrCtrl.getGroupDesc()),a.domManpltrCtrl.isInitialized&&a.domManpltrCtrl.disableNextBtn(),a.groupName=a.groupName.trim(),c.getGroupInfo(a.groupName).success(function(b,c){a.domManpltrCtrl.isInitialized&&a.domManpltrCtrl.enableNextBtn();for(var d,e,f,g,h,i=b.data,j=0;i&&j<i.length;j++)if("ACTIVE"===i[j].status){e=i[j].group_id,f=i[j].access,g=i[j].is_user_member,h=i[j].auto_follow_enabled,d=!0;break}d||a.postCreatorsCtrl?a.postCreatorsCtrl?(a.title="Add Post Creators",a.cnvModalType=a.cnvModalType_post_creators,a.STATE=a.CREATE_GROUP_STEP4,a.showGrpAlreadyExistsAlert=!1):(a.existedGroupDetails.groupId=e,a.existedGroupDetails.groupName=a.groupName,a.existedGroupDetails.groupAccess=f,a.existedGroupDetails.is_Member=g,a.existedGroupDetails.auto_Follow_Enabled=Number(h),a.showGrpAlreadyExistsAlert=!0):(a.title="Add Post Creators",a.cnvModalType=a.cnvModalType_post_creators,a.STATE=a.CREATE_GROUP_STEP4,a.showGrpAlreadyExistsAlert=!1,a.postCreatorsCtrl={},a.postCreatorsCtrl.contacts={},a.postCreatorsCtrl.contacts.include_off_domain=!0,a.postCreatorsCtrl.contacts.origin="Create_Group_Dialog",a.postCreatorsCtrl.contacts.invite_via="Create_Group_Dialog",a.postCreatorsCtrl.contacts.new_group={name:a.groupName}),a.$broadcast("render")})},p()}]),b.module("convoApp").controller("CreateGroupWidgetCtrl",["$scope","$modal","Groups",function(a,b,c){var d="home/components/createGroupWidget/templates/dialog.tpl.html";a.openCreateGroupDialog=function(){b.open({templateUrl:d,controller:n,windowClass:"createGroupWidgetDialog"})}}]);var n=function(a,b){a.createGroupData={},a.title="Add new group",a.submitBtn=!0,
a.submitBtnText="Create Group",a.cancelBtn=!0,a.cancelBtnText="Cancel",a.headerTemplate="common/dialogs/templates/dialogHeader.tpl.html",a.bodyTemplate="home/components/createGroupWidget/templates/body.tpl.html",a.footerTemplate="common/dialogs/templates/dialogFooter.tpl.html",a.submit=function(){console.log(a.createGroupData)},a.cancel=function(){b.dismiss()}};n.$inject=["$scope","$modalInstance"],b.module("convoApp").controller("DownloadAppsModalCtrl",["$scope","$modalInstance","appsService","userInfo","config","mixpanelService","utils",function(a,b,c,d,e,f,g){a.userInfo=d,a.MODES={MOBILE:"Mobile",DESKTOP:"Desktop"},a.models={},e.IS_NATIVE?a.models.radioModel=a.MODES.MOBILE:a.models.radioModel=a.MODES.DESKTOP,a.isNative=e.IS_NATIVE,a.DesktopDownloadFlag=!1,a.MobileDownloadFlag=!1,a.mobileInstallText="Install for iOS and Android",a.HTML_APP_DOWNLOAD_URL=e.HTML_APP_DOWNLOAD_URL,a.isIE=g.isIE(),a.userPlatform=navigator.platform.toUpperCase().indexOf("MAC")>=0?"Mac":"Windows",a.desktopTabClicked=function(a){$(a.target).closest(".modal-body").find(".Mobile-upper-half, .btn-downlpad-mobile-apps").addClass("ng-hide")},a.mobileTabClicked=function(a){$(a.target).closest(".modal-body").find(".Desktop-upper-half").addClass("ng-hide")},a.sendInvitation=function(b){a.invitationSuccess=!1,a.$broadcast("render");var d=c.sendDownloadAppEmail(b);d.then(function(b){a.invitationSuccess=!0,a.$broadcast("render"),a.MobileDownloadFlag=!0}),"ios"==b?f.trackEvent(f.Clicked_Download_iOS_App,{Source:"Download Dialog in Web"}):"android"==b&&f.trackEvent(f.Clicked_Download_Android_App,{Source:"Download Dialog in Web"})},a.downloadNativeApp=function(b){$(b.target).closest(".modal-body").find(".Desktop-upper-half").addClass("ng-hide"),a.MobileDownloadFlag||(a.DesktopDownloadFlag=!0),a.mobileInstallText="Don't forget to install <br /> the mobile app.",a.models.radioModel=a.MODES.MOBILE;var c=navigator.platform.toUpperCase().indexOf("MAC")>=0?"Mac":"Windows";f.trackEvent(f.Clicked_Download_Dekstop_App,{Source:"Download Dialog in Web","App Type":c})},showHideDesktopAppButton=function(){e.IS_NATIVE?a.showDesktopAppBtn=!1:a.showDesktopAppBtn=!0},a.dismissModal=function(){b.dismiss()},showHideDesktopAppButton()}]),b.module("convoApp").controller("groupNotificationsModalCtrl",["$scope","$modalInstance","Group",function(a,b,c){a.title="Notify me when posts are shared with this group",a.cancel=function(){b.dismiss()},a.groupNotifications={},a.group=c,a.isUpdatingSettings=!1,a.initialized=!1,a.isAnySettingUpdated=function(){return _.keys(_.pick(a.groupNotifications,function(b,c,d){return d[c]!=a.group.get("notificationSettings")[c]?!0:void 0})).length>0},a.group.getNotificationSettings().then(function(b){a.groupNotifications=_.clone(b),a.initialized=!0,a.$broadcast("render")}),a.saveNotificationSettings=function(){a.group.updateGroupDetails({notificationSettings:a.groupNotifications}),a.cancel()},a.$broadcast("render")}]),b.module("convoApp").controller("resourceLikeInfoModalCtrl",["$scope","$modalInstance","$interval","modalDetails","likeDetails",function(a,b,c,d,e){function f(){"active"==a.modalDetails.state&&(a.$broadcast("render"),c.cancel(a.modalInterval))}a.title="People who like this",a.cancel=function(){b.dismiss()},a.modalDetails=d,a.likeDetails=e,a.modalInterval,"wait"==a.modalDetails.state&&(a.modalInterval=c(f,5)),a.$on("$destroy",function(){a.modalInterval&&c.cancel(a.modalInterval)})}]),b.module("convoApp").factory("resourceLikeInfoModalService",["alertsService","Likes","AppLinks",function(a,b,c){function d(a,c,d,e){var f={},g={},i={modalDetails:function(){return f},likeDetails:function(){return g}};f.state=k,f.modalId="pstMd",j(i);var m=b.getLikesDetailWithUsersInfo(a,c,d,e);m.then(function(a){g.resources=h(a.data.users,a.data.resources),f.state=l})}function e(a){var c={},d={},e={modalDetails:function(){return c},likeDetails:function(){return d}};c.state=k,c.modalId="cmmMd",j(e);var f=b.getLikesDetailWithUsersInfo(null,null,null,null,a);f.then(function(a){d.users=g(a.data),c.state=l})}function f(a,c,d){var e={},f={},h={modalDetails:function(){return e},likeDetails:function(){return f}};e.state=k,e.modalId="pstSbRscMd",j(h);var i=b.getLikesDetailWithUsersInfo(a,c,d);i.then(function(a){f.users=g(a.data),e.state=l})}function g(a){var b=[];for(var c in a)b.push(_.extend({id:c},a[c]));return b}function h(a,b){var c=[];for(var d in b)c.push({rscName:b[d].path_names[b[d].path_names.length-1],users:_.map(b[d].user_ids_who_liked,function(b){return _.extend({id:b},a[b])}),rscLink:i(b[d])});return c}function i(a){for(var b=[],d=a.path_ids.split(","),e=a.path_types,f=0;f<e.length;f++)b.push({uid:d[f],type:e[f]});var g=c.newResourceLink(a.app_instance_id,b,null,a.path_names[a.path_names.length-1]);return c.linkToUrl(g,!0)}function j(b){a.customModal(m,n,b,o,!0)}var k="wait",l="active",m="home/components/resourceLikeInfoWidget/templates/resourceLikeInfoModal.tpl.html",n="resourceLikeInfoModalCtrl",o="cnv-like-info-modal";return{openPostLikeInfoModal:d,openCommentLikeInfoModal:e,openPostSubResourceLikeInfoModal:f}}]),b.module("convoApp").controller("selectFolderModalCtrl",["$scope","$modalInstance","dropboxService","gdriveService","boxService","folderConfig","o365Service",function(a,b,c,d,e,f,g){function h(){switch(a.title="Please wait while loading folders...",a.fetchingDirectory=!0,a.isDirectoryEmpty=!1,f.provider){case"dropbox":promise=c.getDirectoryList(f.accessToken,a.path),promise.then(function(b){if(a.title=a.selectedFolder,a.directoryList=[],500==b)a.initialized=!0,a.$broadcast("render"),bannerService.showBanner("An error occured: please try again later.",!1,!1,promise);else{a.dropboxDirectoryCache[a.path]=[];for(var c=0;c<b.length;c++)a.directoryList.push(b[c]),a.dropboxDirectoryCache[a.path].push(b[c])}a.fetchingDirectory=!1,a.path!=a.rootFolder&&(a.canGoBack=!0),0==a.directoryList.length&&(a.isDirectoryEmpty=!0)});break;case"gdrive":promise=d.getFolderList(f.accessToken,a.path),promise.then(function(b){if(a.title=a.selectedFolder,a.directoryList=[],500==b)a.initialized=!0,a.$broadcast("render"),bannerService.showBanner("An error occured: please try again later.",!1,!1,promise);else{a.gdriveFolderCache[a.path+" "+a.selectedFolder]=[];for(var c=0;c<b.length;c++){var d=[];d.path=b[c].folder_id,d.name=b[c].title,a.directoryList.push(d),a.gdriveFolderCache[a.path+" "+a.selectedFolder].push(d)}}a.fetchingDirectory=!1,a.path!=a.rootFolder&&(a.canGoBack=!0),0==a.directoryList.length&&(a.isDirectoryEmpty=!0)});break;case"box":promise=e.getFolderList(f.accessToken,a.path),promise.then(function(b){if(a.title=a.selectedFolder,a.directoryList=[],500==b)a.initialized=!0,a.$broadcast("render"),bannerService.showBanner("An error occured: please try again later.",!1,!1,promise);else{a.boxFolderCache[a.path+" "+a.selectedFolder]=[];for(var c=0;c<b.length;c++){var d=[];d.path=b[c].id,d.name=b[c].name,a.directoryList.push(d),a.boxFolderCache[a.path+" "+a.selectedFolder].push(d)}}a.fetchingDirectory=!1,a.path!=a.rootFolder&&(a.canGoBack=!0),0==a.directoryList.length&&(a.isDirectoryEmpty=!0)});break;case"odrive":promise=g.getDriveFoldersList(f.accessToken,a.path),promise.then(function(b){if(a.title=a.selectedFolder,a.directoryList=[],500==b)a.initialized=!0,a.$broadcast("render"),bannerService.showBanner("An error occured: please try again later.",!1,!1,promise);else{a.odriveFolderCache[a.path+" "+a.selectedFolder]=[];for(var c=0;c<b.length;c++){var d=[];d.path=b[c].id,d.name=b[c].title,a.directoryList.push(d),a.odriveFolderCache[a.path+" "+a.selectedFolder].push(d)}}a.fetchingDirectory=!1,a.path!=a.rootFolder&&(a.canGoBack=!0),0==a.directoryList.length&&(a.isDirectoryEmpty=!0)})}}function i(){h()}switch(f.provider){case"dropbox":a.rootFolder="/";break;case"gdrive":a.rootFolder="root";break;case"box":a.rootFolder="0";break;case"odrive":a.rootFolder="root"}a.title=f.defaultFolder,a.path=a.rootFolder,a.selectedFolder=f.defaultFolder,a.pathSeperator=f.pathSeparator,a.dropboxDirectoryCache={},a.gdriveFolderCache={},a.boxFolderCache={},a.odriveFolderCache={},a.gdriveParents=[],a.boxParents=[],a.odriveParents=[],a.directoryList=[],a.isDirectoryEmpty=!1,a.fetchingDirectory=!1,a.selectButtonText="Select",a.backButtonText="Go Back",a.canGoBack=!1,a.cancel=function(){b.dismiss()},a.getChildren=function(b,c){switch(a.isDirectoryEmpty=!1,f.provider){case"dropbox":a.path+=a.path==a.rootFolder?b:a.pathSeperator+b,a.selectedFolder=b,a.path in a.dropboxDirectoryCache?(a.directoryList=[],$.each(a.dropboxDirectoryCache[a.path],function(b,c){a.directoryList.push(c)}),a.path!=a.rootFolder&&(a.canGoBack=!0),a.title=a.selectedFolder,0==a.directoryList.length&&(a.isDirectoryEmpty=!0)):h();break;case"gdrive":var d=c+" "+b;-1===$.inArray(d,a.gdriveParents)&&(a.gdriveParents[d]=a.path+" "+a.selectedFolder),a.path=c,a.selectedFolder=b,d in a.gdriveFolderCache?(a.directoryList=[],$.each(a.gdriveFolderCache[d],function(b,c){a.directoryList.push(c)}),a.path!=a.rootFolder&&(a.canGoBack=!0),a.title=a.selectedFolder,0==a.directoryList.length&&(a.isDirectoryEmpty=!0)):h();break;case"box":var d=c+" "+b;-1===$.inArray(d,a.boxParents)&&(a.boxParents[d]=a.path+" "+a.selectedFolder),a.path=c,a.selectedFolder=b,d in a.boxFolderCache?(a.directoryList=[],$.each(a.boxFolderCache[d],function(b,c){a.directoryList.push(c)}),a.path!=a.rootFolder&&(a.canGoBack=!0),a.title=a.selectedFolder,0==a.directoryList.length&&(a.isDirectoryEmpty=!0)):h();break;case"odrive":var d=c+" "+b;-1===$.inArray(d,a.odriveParents)&&(a.odriveParents[d]=a.path+" "+a.selectedFolder),a.path=c,a.selectedFolder=b,d in a.odriveFolderCache?(a.directoryList=[],$.each(a.odriveFolderCache[d],function(b,c){a.directoryList.push(c)}),a.path!=a.rootFolder&&(a.canGoBack=!0),a.title=a.selectedFolder,0==a.directoryList.length&&(a.isDirectoryEmpty=!0)):h()}},a.getParent=function(){switch(a.isDirectoryEmpty=!1,f.provider){case"dropbox":a.path=a.path.replace(a.pathSeperator+a.selectedFolder,""),""==a.path?(a.path=a.rootFolder,a.selectedFolder=a.rootFolder,a.canGoBack=!1):a.selectedFolder=a.path.substring(a.path.lastIndexOf(a.pathSeperator)+1),a.path in a.dropboxDirectoryCache?(a.directoryList=[],$.each(a.dropboxDirectoryCache[a.path],function(b,c){a.directoryList.push(c)}),a.title=a.selectedFolder,0==a.directoryList.length&&(a.isDirectoryEmpty=!0)):h();break;case"gdrive":var b=a.gdriveParents[a.path+" "+a.selectedFolder];b=b.split(" ");var c=b[0];b.shift();var d=b.join(" ");"root"==c?(a.path=a.rootFolder,a.selectedFolder=a.rootFolder,a.canGoBack=!1):(a.selectedFolder=d,a.path=c);var e=c+" "+d;e in a.gdriveFolderCache?(a.directoryList=[],$.each(a.gdriveFolderCache[e],function(b,c){a.directoryList.push(c)}),a.title=a.selectedFolder,0==a.directoryList.length&&(a.isDirectoryEmpty=!0)):h();break;case"box":var b=a.boxParents[a.path+" "+a.selectedFolder];b=b.split(" ");var c=b[0];b.shift();var d=b.join(" ");"0"==c?(a.path=a.rootFolder,a.selectedFolder=f.defaultFolder,a.canGoBack=!1):(a.selectedFolder=d,a.path=c);var e=c+" "+d;e in a.boxFolderCache?(a.directoryList=[],$.each(a.boxFolderCache[e],function(b,c){a.directoryList.push(c)}),a.title=a.selectedFolder,0==a.directoryList.length&&(a.isDirectoryEmpty=!0)):h();break;case"odrive":var b=a.odriveParents[a.path+" "+a.selectedFolder];b=b.split(" ");var c=b[0];b.shift();var d=b.join(" ");"root"==c?(a.path=a.rootFolder,a.selectedFolder=a.rootFolder,a.canGoBack=!1):(a.selectedFolder=d,a.path=c);var e=c+" "+d;e in a.odriveFolderCache?(a.directoryList=[],$.each(a.odriveFolderCache[e],function(b,c){a.directoryList.push(c)}),a.title=a.selectedFolder,0==a.directoryList.length&&(a.isDirectoryEmpty=!0)):h()}},a.selectFolder=function(){switch(f.provider){case"dropbox":b.close(a.path);break;case"gdrive":case"box":case"odrive":b.close({id:a.path,name:a.selectedFolder})}},i()}]),b.module("convoApp").controller("sharedInfoModalCtrl",["$scope","$modalInstance","sharedInfo",function(a,b,c){a.title="Shared with",a.sharedInfo=c,a.cancel=function(){b.dismiss()}}]),b.module("convoApp").controller("usagePolicyModalCtrl",["$scope","$modalInstance","usagePolicyService","bannerService","accountInfo",function(a,b,c,d,e){function f(){var b=c.getUsagePolicy();b.then(function(b){1==b.type&&-1==b.errorCode?(a.title=b.data.usage_policy_title,(null==a.title||0==a.title.length)&&(a.title="Usage Policy for "+e.getAccountName()+" network"),a.policyText=b.data.usage_policy_text,a.processingRequest=!1,a.$broadcast("render")):(a.processingRequest=!0,b.message?d.showBanner(b.message,!1,!1,null):d.showBanner("Failed to process your request please try again later or contact support",!1,!1,null))},function(){a.processingRequest=!0,d.showBanner("Failed to process your request please try again later",!1,!1,null)})}a.processingRequest=!0,a.$broadcast("render"),a.dismissModal=function(){b.dismiss()},f()}]),b.module("convoApp").directive("cnvDragDrop",["$rootScope","config",function(b,c){return{restrict:"A",scope:!0,link:function(d,e,f){$.fn.cnvDragDrop=function(b){return this.each(function(){function b(){f=$(),e.trigger("cnv-drag-end")}var e=$(this),f=$();e.on("dragenter",function(a){("Files"==a.originalEvent.dataTransfer.types[0]||"application/x-moz-file"==a.originalEvent.dataTransfer.types[0]||"public.file-url"==a.originalEvent.dataTransfer.types[0]||c.IS_NATIVE)&&(0===f.size()&&e.trigger("cnv-drag-start"),f=f.add(a.target))}),e.on("dragleave",function(a){setTimeout(function(){f=f.not(a.target),0===f.size()&&e.trigger("cnv-drag-end")},1)}),a.addEventListener("drop",b,!0),a.addEventListener("dragdrop",b,!0),d.$on("$destroy",function(){a.removeEventListener("drop",b,!0),a.removeEventListener("dragdrop",b,!0)})})},e.cnvDragDrop().on({"cnv-drag-start":function(a){return a.stopPropagation(),a.preventDefault(),console.log("drag start"),b.$broadcast("cnv-drag-start"),!1},"cnv-drag-end":function(a){return a.stopPropagation(),a.preventDefault(),console.log("drag stop"),b.$broadcast("cnv-drag-end"),!1}})}}}]),b.module("convoApp").directive("cnvHomeCenterPanelHeaderManager",[function(){return{restrict:"AE",controller:["$scope","homeViewStateInfo","$timeout",function(a,b,c){function d(){a.STATE=b.getState(),a.$$phase||a.$digest()}a.$on("homeViewStateChange",d),d()}]}}]),b.module("convoApp").controller("GroupsRightPanelCtrl",["$scope","Groups","alertsService","homeViewStateInfo","userInfo","AppLinks","accountInfo",function(a,b,c,d,e,f,g){function h(a){}function i(){var c=d.getToFilter();if(c)return(l=b.getGroup(c.value))?void l.getDetails().then(function(){if(l.get("id")==c.value){a.MAXIMUM_USERS_IN_LIST=11,a.group=l,a.groupMembers=l.get("groupMembers"),a.pinnedContents=l.get("pinnedContents"),12==a.groupMembers.length?(a.additionalGroupMembers=0,a.MAXIMUM_USERS_IN_LIST=12):a.groupMembers.length>a.MAXIMUM_USERS_IN_LIST?a.additionalGroupMembers=a.groupMembers.length-a.MAXIMUM_USERS_IN_LIST:a.additionalGroupMembers=0;var b=f.newResourceLink("9",[{uid:l.get("id"),type:"22"},{uid:"2",type:"GroupMembers"}],null,l.get("title")+" (Members)");a.groupMembersViewUrl=f.linkToUrl(b,!0),a.$broadcast("render"),a.$broadcast("refreshGroupInviteWidgetData"),clearTimeout(k),k=setTimeout(i,j)}}):void a.$broadcast("render")}a.MAXIMUM_USERS_IN_LIST=11;var j=3e4,k=null,l=null;a.$on("homeViewStateChange",function(){d.getState()==d.STATE_GROUP&&i()}),a.thisUserId=e.user_id,a.isAdminMode=e.isAdminMode(),a.shouldInviteGuestsAsFullMembers=g.shouldInviteGuestsAsFullMembers(),a.isGroupAdminOrNetworkAdminMode=function(){return l&&(l.isGroupAdmin(a.thisUserId)||a.isAdminMode)},b.on("groupModifiedByRemoteUser",h),b.on("usersInvitedToGroupByRemoteUser",h),b.on("userRemovedFromGroupByRemoteUser",h),a.$on("$destroy",function(){b.off("groupModifiedByRemoteUser",h),b.off("usersInvitedToGroupByRemoteUser",h),b.off("userRemovedFromGroupByRemoteUser",h),clearTimeout(k)}),a.addPinnedContent=function(){var d={resource_name:function(){return""},resource_url:function(){return""},provided_desc:function(){return"Paste a link to a Convo post or an external website to pin it to the top of the group."},title:function(){return!1},btnTitle:function(){return!1},source:function(){return"no_suggestion"}},e="home/groupView/rightPanelWidgets/cnvAddPinContentModal.tpl.html",f="cnvAddPinContentModalCtrl",g=c.customModal(e,f,d);g.result.then(function(c){b.pinContentToGroup(l,c).success(function(b,d){b.data.type||(c.error=!0),c.is_posting=!1,a.$broadcast("render")}),c.is_posting=!0,a.$broadcast("render")},function(){})},a.$on("reRenderGroupView",function(a){i()}),a.$on("cnvSessionRefreshed",function(a){i()}),b.getGroups()["finally"](function(){i()})}]),b.module("convoApp").directive("cnvHomeCenterPanelGroupPinnedPostWidget",["homeViewStateInfo","Groups","AppLinks","userInfo",function(a,b,c,d){return{restrict:"E",scope:!0,templateUrl:"home/groupView/centerPanelWidgets/cnvHomeCenterPanelGroupPinnedPostWidget/cnvHomeCenterPanelGroupPinnedPostWidget.tpl.html",link:function(e,f,g){function h(){if(n){e.pinnedContents=n.get("pinnedContents");var a=n.get("membersCanPinContent"),b=j();e.canEditPins=a||b,e.$broadcast("render")}}function i(c){if(e.pinnedContents=null,e.$broadcast("render"),a.getState()===a.STATE_GROUP){var d=a.getToFilter();n=b.getGroup(d.value),n&&n.getDetails().then(function(){if(n.get("id")==d.value){e.groupSettingsUrl=l(),e.pinnedContents=n.get("pinnedContents");var a=n.get("membersCanPinContent"),b=j();e.canEditPins=a||b,e.$broadcast("render"),c||n.on("Group:pinnedContentsUpdated",h)}})}}function j(){return d.isAdminMode()||k(d.getUserId())}function k(a){var b=n.get("groupAdmins");return _.keys(_.find(b,function(b){return b.user_id==a?!0:void 0})).length>0}function l(){var a=c.newResourceLink("9",[{uid:n.get("id"),type:"22"},{uid:"2",type:"GroupSettings"}],null,n.get("title")+" (Settings)"),b=c.linkToUrl(a,!0),d=b.lastIndexOf("#");return b.slice(0,d)+"#groupPinnedContent"}function m(a){b.getGroups()["finally"](function(){i(a)})}e.MAXIMUM_PINS_TO_SHOW=3,e.pinnedContents;var n;e.expand=!1,e.showAll=function(){e.MAXIMUM_PINS_TO_SHOW=e.pinnedContents.length,e.expand=!0,e.$broadcast("render")},e.editPins=function(){},e.showLess=function(){e.MAXIMUM_PINS_TO_SHOW=3,e.expand=!1,e.$broadcast("render")},e.$on("$destroy",function(){n&&n.off("Group:pinnedContentsUpdated",h)}),e.$on("homeViewStateChange",i),e.$on("cnvSessionRefreshed",function(){m(!0)}),m()}}}]),b.module("convoApp").directive("cnvHomeCenterPanelGroupHeader",function(){return{restrict:"AE",scope:!0,templateUrl:"home/groupView/cnvHomeCenterPanelGroupHeader.tpl.html",link:function(a,b,c){},controller:["$scope","homeViewStateInfo","Groups","$filter","$timeout","alertsService","userInfo","$location","alertsService","AppLinks","Users","usersGroupsListProvider","User","Contacts","bannerService","idToFilterUrlForAppFilter","utils","config","BlackListWordsService",function(a,b,c,d,e,f,g,h,f,i,j,k,l,m,n,o,p,q,r){function s(){}function t(){L.getDetails().then(function(){K&&L.get("id")==K.value&&(J.item.description=L.get("description")||null,J.item.isEditable=L.get("isEditable"),J.model.truncated=!0,z(),L.isNonMemberPrivateGroup()||L.isNonMemberPublicGroup()?L.isNonMemberPrivateGroup()?J.model.state=J.STATE_NON_MEMBER_PRIVATE_GROUP:L.isNonMemberPublicGroup()&&(J.model.state=J.STATE_NON_MEMBER_PUBLIC_GROUP):J.model.state=J.STATE_NORMAL,J.$broadcast("render"))})}function u(a){}function v(a,b,c){L&&L.get("id")===a&&c&&t()}function w(){return L&&(L.isGroupAdmin(J.thisUserId)||J.isAdminMode)}function x(d,e){if(b.getState()===b.STATE_GROUP&&(K=b.getToFilter(),d||!L||K.value!==L.get("id"))){if(L=c.getGroup(K.value),a.group=L,!L)return J.model.state=J.STATE_ERROR,void J.$broadcast("render");J.model.state=J.STATE_WAITING,J.feed_title=L.get("title"),J.groupDropdownCtrl={},e||J.$broadcast("render"),t()}}function y(a){J.model.saving=!0,J.model.error=!1,L.updateDescription(J.item.description).then(function(a){a&&1===a.type||(J.model.error=!0),J.model.state=J.STATE_NORMAL,J.model.saving=!1,J.model.truncated=!0,J.$broadcast("render")}),J.$broadcast("render")}function z(){var b=L.toJSON();if(J.groupDropdownCtrl.options=[{label:"Copy link",callback:function(){p.copyToClipboard(q.CONVO_LINKS_BASE_URL+o(L.get("id"),"GROUP").slice(1))}},{isDivider:!0},{label:"Group settings",url:E()}],w()||"1"==b.membersCanInvite?J.groupDropdownCtrl.options.push({label:"Invite people to this group",callback:C}):J.groupDropdownCtrl.options.push({label:"View members",callback:D}),w()||"1"==L.get("integrationsEnabled")&&!a.user_info.isGuestUser()&&b.membersCanSetupIntegrations){var d=i.newResourceLink("9",[{uid:L.get("id"),type:"22"},{uid:"2",type:"GroupIntegrations"}],null,"Group Integrations"),e=i.linkToUrl(d);J.groupDropdownCtrl.options.push({label:"Add or manage integrations",url:e,callback:function(){h.path(e.slice(1))}})}(g.isAdminMode()||w()||"1"==b.membersCanPinContent)&&J.groupDropdownCtrl.options.push({label:"Pin content to the top of this group",callback:G}),J.groupDropdownCtrl.options.push({isDivider:!0}),L.get("isMember")&&J.groupDropdownCtrl.options.push({label:"Notification preferences",callback:function(){F(L)}});var f={};f.callback=function(){"Show posts in my feed"==f.label?c.toggleShowHidePostsInFeed(L,0).success(function(a,b){a.type&&(f.label="Hide posts from my feed")}):c.toggleShowHidePostsInFeed(L,1).success(function(a,b){a.type&&(f.label="Show posts in my feed")})},"1"==b.hideFromFeedForThisUser&&L.get("isMember")?(f.label="Show posts in my feed",J.groupDropdownCtrl.options.push(f)):L.get("isMember")&&(f.label="Hide posts from my feed",J.groupDropdownCtrl.options.push(f)),L.get("pinned_at")||g.isAdminMode()?g.isAdminMode()||J.groupDropdownCtrl.options.push({label:"Unpin from top of my group list",callback:function(){c.unpinGroup(L.get("id")).then(function(){x(!0)})}}):J.groupDropdownCtrl.options.push({label:"Pin to top of my group list",callback:function(){c.pinGroup(L.get("id")).then(function(){x(!0)})}}),b.thisUserCanLeave&&("undefined"==typeof b.membersCanLeave||b.membersCanLeave)&&(J.groupDropdownCtrl.options.push({isDivider:!0}),J.groupDropdownCtrl.options.push({label:"Leave group",callback:A})),J.isAccountAnnouncementsGroup()||!J.isAdminMode&&!b.is_admin||J.groupDropdownCtrl.options.push({label:"Delete group",callback:B}),J.showGroupDropdown=!0,J.$broadcast("render")}function A(){var b="Leave Group",d="Are you sure you want to leave this group? As the only group administrator, if you leave no one will be authorized to manage this group.",e="You are an admin of this group. Are you sure you want to leave it?",g="Are you sure you want to leave this group?",h="Leave group",i="Cancel";L.isThisUserIsTheOnlyGroupAdmin(a.thisUserId)?f.promptModal(b,d,function(){c.removeUserFromGroup(L.get("id"),a.thisUserId)},null,h,i,null,!0):L.get("is_admin")?f.promptModal(b,e,function(){c.removeUserFromGroup(L.get("id"),a.thisUserId)},null,h,i,null,!0):f.promptModal(b,g,function(){c.removeUserFromGroup(L.get("id"),a.thisUserId)},null,h,i,null,!0)}function B(){var a="Delete group",b='<b>There is no undo for this action.</b><br/><br/>Are you sure you want to delete the "[groupname]" group and all content shared with this group? Deleting this group will remove all members from the group, and remove the group from the directory.<br/><br/>Posts that are shared with this group and also shared with any other group or person will continue to remain available.',d="Delete";alertCANCELText="Cancel",f.promptModal(a,b.replace("[groupname]",L.get("title")),function(){var a=c.deleteGroup(L.get("id"));n.showBanner_promise(a,"Deleting group",null,null,!1,!1)},null,d,alertCANCELText,null,!0)}function C(){m.initContactsInviteModal({invite_via:"Invite_Dialog",include_off_domain:!0,get_details_first:!0,group:L})}function D(){var a=i.newResourceLink("9",[{uid:L.get("id"),type:"22"},{uid:"2",type:"GroupMembers"}],null,L.get("title")+" (Members)"),b=i.linkToUrl(a,!0);h.url(b.slice(1))}function E(){var a=i.newResourceLink("9",[{uid:L.get("id"),type:"22"},{uid:"2",type:"GroupSettings"}],null,L.get("title")+" (Settings)");return i.linkToUrl(a,!0)}function F(a){var b="home/components/groupNotificationsWidget/templates/groupNotificationsModal.tpl.html",c="groupNotificationsModalCtrl",d="group-notification-preferences",e={Group:function(){return a}};f.customModal(b,c,e,d)}function G(){var b={resource_name:function(){return""},resource_url:function(){return""},provided_desc:function(){return"Paste a link to a Convo post or an external website to pin it to the top of the group."},title:function(){return!1},btnTitle:function(){return!1},source:function(){return"no_suggestion"}},d="home/groupView/rightPanelWidgets/cnvAddPinContentModal.tpl.html",e="cnvAddPinContentModalCtrl",g=f.customModal(d,e,b);g.result.then(function(b){c.pinContentToGroup(L,b).success(function(c,d){c.type||(b.error=!0),b.is_posting=!1,a.$broadcast("render")}),b.is_posting=!0,a.$broadcast("render")},function(){})}function H(){J.groupDropdownCtrl.options&&z()}function I(a){b.getState()===b.STATE_GROUP&&c.getGroups()["finally"](function(){x(a,a)})}a.cnvMemLeakHook=new s;var J=a;J.STATE_WAITING=1,J.STATE_NORMAL=2,J.STATE_SAVING=3,J.STATE_ERROR=4,J.STATE_EDIT=5,J.STATE_NON_MEMBER_PRIVATE_GROUP=6,J.STATE_NON_MEMBER_PUBLIC_GROUP=7,J.model={},J.model.state=J.STATE_WAITING,J.item={},a.user_info=g,J.thisUserId=g.user_id,J.isAdminMode=g.isAdminMode();var K,L=null;c.on("groupModifiedByRemoteUser",u),c.on("usersInvitedToGroupByRemoteUser",u),c.on("userRemovedFromGroupByRemoteUser",u),c.on("toggledShowHidePostsInFeed",v),g.on("userInfo.userRoleUpdated",H),a.$on("homeViewStateChange",x),a.$on("cnvSessionRefreshed",function(){I(!0)}),a.isGroupAdminOrNetworkAdminMode=w,a.isAccountAnnouncementsGroup=function(){return L&&"ACCOUNT_ANNOUNCEMENTS"===L.get("type")};var M={ENTER:13};J.toggle=function(){J.model.truncated=!J.model.truncated,a.$broadcast("render")},J.enableEdit=function(){J.model.state=J.STATE_EDIT,J.$broadcast("render"),e(function(){$(".feed-filter-description textarea").focus()},0)},J.onKeydown=function(a){var b=a.shiftKey||a.altKey||a.ctrlKey||a.metaKey;return b||a.keyCode!=M.ENTER||a.isPropagationStopped()?void 0:(J.initSubmit(),a.preventDefault(),a.stopPropagation(),!1)},J.initSubmit=function(){var a=!0;J.item.description=J.item.description||"",J.item.description=r.clean(J.item.description),a&&J.item.description===L.get("description")&&(J.model.state=J.STATE_NORMAL,a=!1),a&&y(),J.$broadcast("render")},J.$on("$destroy",function(){c.off("groupModifiedByRemoteUser",u),c.off("usersInvitedToGroupByRemoteUser",u),c.off("userRemovedFromGroupByRemoteUser",u),c.off("toggledShowHidePostsInFeed",v),g.off("userInfo.userRoleUpdated",H),J.model=null,K=null}),I()}]}}),b.module("convoApp").controller("cnvAddPinContentModalCtrl",["$scope","$modalInstance","$timeout","itemService","AppLinks","utils","resource_name","resource_url","provided_desc","title","btnTitle","source","config","BlackListWordsService",function(b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){var b=a||"";return b.match(/^[a-zA-Z]+:/)||(b=r+b),b}var q=b;q.data={};var r="http://";q.resolving=!1,m=m||!1,q.providedResourceName=h||"",q.providedResourceUrl=i||"",q.suggestedTitle="",q.backupProvidedResourceName=q.providedResourceName,q.hasUserTyped=!1,q.title=k||!1,q.btnTitle=l||!1,j.length>0&&(q.providedDesc=j);var s=function(a){q.resolving=!0;var c=f.parseUrl(a);c&&c.type==f.RESOURCE_LINK?(""==q.data.resource_name||"no_suggestion"==m?q.data.resource_name=decodeURIComponent(c.title):q.suggestedTitle=decodeURIComponent(c.title),q.data.app_instance_id=c.resourcePath.appInstance.uid,q.data.resource_id=c.resourcePath.hierarchy[0].uid,q.data.resource_type=c.resourcePath.hierarchy[0].type,q.resolving=!1,b.$digest()):e.getLink(a).success(function(a,b){a&&200==b&&(""==q.data.resource_name||"no_suggestion"==m?q.data.resource_name=a.title:q.suggestedTitle=a.title),q.providedResourceName=q.backupProvidedResourceName,q.resolving=!1}).error(function(){q.providedResourceName=q.backupProvidedResourceName,q.resolving=!1})},t=_.debounce(s,250);q.validateUrl=function(){var a=p(q.data.url);return q.data&&q.data.url?g.isValidUrl(a):void 0},q.setResourceUrl=function(){if(q.providedResourceUrl){var a=p(q.providedResourceUrl);q.data.url=a}},q.setResourceName=function(){q.providedResourceName&&(q.data.resource_name=q.providedResourceName)},q.setSuggestedTitle=function(){q.data.resource_name=q.suggestedTitle},q.onChange=function(){console.log("on changed"),q.hasUserTyped=!0,d(function(){var a=p(q.data.url);a&&g.isValidUrl(a)?t(a):q.data.resource_name==q.suggestedTitle&&(q.data.resource_name="")},0)},q.onPaste=function(){console.log("on paste"),d(function(){var a=p(q.data.url);a&&g.isValidUrl(a)?t(a):q.data.resource_name==q.suggestedTitle&&(q.data.resource_name="")},0)},q.onSubmit=function(){console.log("on submit"),q.data.resource_name||(q.data.resource_name=q.providedResourceName||q.data.url),q.data.resource_name=o.clean(q.data.resource_name);var a=p(q.data.url),b=f.parseUrl(a);b&&b.type==f.RESOURCE_LINK?(q.data.type="SCRYBE",q.data.app_instance_id=b.resourcePath.appInstance.uid,q.data.resource_id=b.resourcePath.hierarchy[0].uid,q.data.resource_type=b.resourcePath.hierarchy[0].type):q.data.type="WEB",q.data.url=p(q.data.url),c.close(q.data)},q.dismiss=function(){c.dismiss("cancel")},q.test=function(){if(q.data.url){var b=p(q.data.url),c=800,d=300;if(n.IS_NATIVE)g.openInBrowser(b);else{var e=a.open(b,"popUpWindow","height="+d+", width="+c+", left="+screen.width/2-c/2+", top="+screen.width/2-d/2+", resizable=yes, scrollbars=yes, toolbar=no, menubar=no, location=yes, directories=no, status=yes");a.focus&&e.focus()}return!1}},q.setResourceName(),q.setResourceUrl()}]),b.module("convoApp").directive("cnvGroupEmailSharingWidget",["utils",function(a){return{restrict:"E",replace:!0,scope:!0,templateUrl:"home/groupView/rightPanelWidgets/cnvGroupEmailSharingWidget.tpl.html",link:function(b,c,d){b.copyEmailPopup=function(){b.group&&a.copyToClipboard(b.group.get("title")+" <"+b.group.get("groupEmail")+">")}}}}]),b.module("convoApp").directive("cnvGroupIntegrationsWidget",[function(){return{restrict:"E",scope:!0,templateUrl:"home/groupView/rightPanelWidgets/cnvGroupIntegrationsWidget.tpl.html"}}]),b.module("convoApp").directive("cnvGroupInviteWidget",["utils",function(b){return{restrict:"E",scope:!0,replace:!0,templateUrl:"home/groupView/rightPanelWidgets/cnvGroupInviteWidget.tpl.html",controller:["$scope","Groups","Users","User","$timeout","accountInfo","bannerService","usersGroupsListProvider","$q","alertsService","mixpanelService","userInfo",function(a,d,e,f,g,h,i,j,k,l,m,n){function o(b){h.shouldInviteGuestsAsFullMembers()?a.placeholderText="teammate@domain.com":a.placeholderText="teammate@"+b.user_email_domain}function p(){v=[],w=[];var b;e.getPublishableUsers().then(function(c){for(var d=0;d<c.length;d++){var e=c[d],f=_.where(a.groupMembers,{user_id:e.id});b=_.extend({},e),b.user_email_id=e.email,f.length?w.push(j.createUserListItemForSpecificGroup(b,"Added",!0)):v.push(j.createUserListItemForSpecificGroup(b))}})}function q(a){var b;return b=1==a.length?A.replace("[email]",a[0].invitee_global_profile.email):2==a.length?B.replace("[email1]",a[0].invitee_global_profile.email).replace("[email2]",a[1].invitee_global_profile.email):C.replace("[email1]",a[0].invitee_global_profile.email).replace("[email2]",a[1].invitee_global_profile.email).replace("[count]",a.length-2)}function r(a){var b;return b=1==a.length?a[0].error_message?a[0].error_message:D.replace("[email]",a[0].invitee_email):2==a.length?E.replace("[email1]",a[0].invitee_email).replace("[email2]",a[1].invitee_email):F.replace("[email1]",a[0].invitee_email).replace("[email2]",a[1].invitee_email).replace("[count]",a.length-2)}function s(a){i.showBanner(q(a),!1,!1)}function t(a){i.showBanner(r(a),!1,!1)}function u(a,b){var c={inviteSuccessEmails:function(){return a},inviteFailEmails:function(){return b}};l.customModal(x,y,c,z)}a.invtTeammtCtrl={},a.invitedTo=[],a.invtTeammtCtrl.isNotShowingAutoComplete=!0;var v=[],w=[],x="components/groupInvtStatusDialog/templates/groupInvtStatusDialog.tpl.html",y="groupInvtStatusDialogCtrl",z="invt-status-modal",A="Your invitation has been sent to <b>[email]</b>.",B="Your invitation to <b>[email1]</b> and <b>[email2]</b> has been sent.",C="Your invitation to <b>[email1]</b> and <b>[email2]</b> and <b>[count] others</b> has been sent.",D="Your invitation has not been sent to <b>[email]</b>.",E="Your invitation to <b>[email1]</b> and <b>[email2]</b> has not been sent.",F="Your invitation to <b>[email1]</b> and <b>[email2]</b> and <b>[count] others</b> has not been sent.";
h.shouldInviteGuestsAsFullMembers()?a.placeholderText="teammate@domain.com":a.placeholderText="teammate@"+h.getPrimaryAccountDomain().user_email_domain,h.on("accountInfo.updated.primaryAccountDomain",o),a.inviting=!1,a.invtTeammtCtrl.inviteTeammates=function(b,c){a.inviting||(a.inviting=!0,a.$broadcast("render"),d.inviteUsersToGroupRTC(a.group,b,c,"Group Filter").success(function(a,b){if(a.type){var c=a.data.users_invited,d=a.data.users_not_invited;a.data.users_inivites_already_pending,a.data.users_invites_pending;c.length&&d.length?u(c,d):c.length?s(c):d.length&&t(d)}})["finally"](function(){a.inviting=!1,a.$broadcast("render")}))},a.invtTeammtCtrl.filterContacts=function(b){for(var c,d=[],e=0;e<b.length;e++)c=_.where(a.groupMembers,{user_email_id:b[e].email}),0==c.length&&(b[e].isChecked=!0,d.push(b[e]));return d},a.getAutoCompleteUserItemsToInvite=function(a,b){var c=k.defer(),d="",e={allowed:!1,domain_restricted:!1};n.isGuestUser()||h.shouldInviteGuestsAsFullMembers()||(d=j.LIST_NAMES.NETWORK_ON_DOMAIN_CONTACTS_LIST,e.allowed=!0);var f=j.queryCustomList(v,a,b+4,null,d,e),g=[];return a&&(g=j.queryCustomList(w,a,2)),c.resolve(f.concat(g)),c.promise},a.onTextPastedInToField=function(d){var e=b.parseEmailAddressesFromString(d);if(0===e.emails.length||1===e.numItems)return!0;for(var f=e.emails,g=[],h={},i=0;i<f.length;i++){var k=f[i].toLowerCase(),l=_.where(a.invitedTo,{email:k});0===l.length&&h[k]===c&&(g.push(k),h[k]=1)}if(g.length>0){for(var i=0;i<g.length;i++){var k=g[i],m=j.createUserListItem({email:k,name:k});m.type="CONTACT",m.classes=" user contact-as-user "+b.getRandomSmiley()+" as-content ",a.invitedTo.push(m)}a.$$phase||a.$digest()}return!1},a.invtTeammtCtrl.noContactMessage="The teammates you're trying to invite are already added to this group.",a.invtTeammtCtrl.initialized=!0,p();var G=a.$on("refreshGroupInviteWidgetData",p);a.inviteUser=function(b){if(!a.inviting){for(var c,f=a.invitedTo,g=[],h=0;f&&h<f.length;h++)c=e.getUserById(f[h].id),c?g.push(c.email):g.push(f[h].label);a.inviting||0==g.length||(a.inviting=!0,a.$broadcast("render"),d.inviteUsersToGroupRTC(a.group,g,b,"Group Filter").success(function(b,c){if(b.type){var d=b.data.users_invited,e=b.data.users_not_invited;b.data.users_inivites_already_pending,b.data.users_invites_pending;d.length&&e.length?u(d,e):d.length?s(d):e.length&&t(e),a.invitedTo=[]}a.inviting=!1,a.$broadcast("render")})["finally"](function(){a.inviting=!1,a.$broadcast("render")}),m.trackEvent(m.CLICK_ON_INVITE_FROM_NEWSFEED,{Using:"Group Newsfeed"}))}},a.$on("$destroy",function(a){G(),h.off("accountInfo.updated.primaryAccountDomain",o)})}],link:function(b,c,d){function e(c){13==c.keyCode&&a.setTimeout(function(){b.inviteUser()},0)}c.find(".to-field-cont")[0].addEventListener("keydown",e,!1),b.$on("$destroy",function(a){var b=c.find(".to-field-cont");b.length&&b[0].removeEventListener("keydown",e,!1)})}}}]),b.module("convoApp").directive("cnvGroupMembersListWidget",[function(){return{restrict:"E",scope:!0,replace:!0,templateUrl:"home/groupView/rightPanelWidgets/cnvGroupMembersListWidget.tpl.html",controller:["$scope","userInfo","Groups","$location","alertsService",function(a,b,c,d,e){a.userInfo=b,a.showBtn="joined",a.showHideBtn=function(b){a.group&&a.group.get("thisUserCanLeave")&&(a.showBtn=b,a.$broadcast("render"))},a.reqToJoinGroup=function(){var b=c.reqToJoinGroup(a.group.get("id"));b.then(function(b,c){a.reqToJoinGroupSuccessful=!0,a.$emit("reqToJoinGroupSuccessful"),a.$broadcast("render")})},a.$on("grpJoinReqSuccessful",function(){a.reqToJoinGroupSuccessful=!0}),a.leaveGroup=function(){var f="Leave Group",g="Are you sure you want to leave this group? As the only group administrator, if you leave no one will be authorized to manage this group.",h="You are an admin of this group. Are you sure you want to leave it?",i="Are you sure you want to leave this group?",j="Leave group",k="Cancel";a.group.isThisUserIsTheOnlyGroupAdmin(b.getUserId())?e.promptModal(f,g,function(){c.removeUserFromGroup(a.group.get("id"),b.getUserId()).then(function(b){a.$emit("refetchMainFeedRequest"),d.path("/feed").search({}).hash("title=News Feed")})},null,j,k,null,!0):a.group.get("is_admin")?e.promptModal(f,h,function(){c.removeUserFromGroup(a.group.get("id"),b.getUserId()).then(function(b){a.$emit("refetchMainFeedRequest"),d.path("/feed").search({}).hash("title=News Feed")})},null,j,k,null,!0):e.promptModal(f,i,function(){c.removeUserFromGroup(a.group.get("id"),b.getUserId()).then(function(b){a.$emit("refetchMainFeedRequest"),d.path("/feed").search({}).hash("title=News Feed")})},null,j,k,null,!0)}}],link:function(a,b,c){}}}]),b.module("convoApp").directive("cnvGroupPinnedPostsWidget",function(){return{restrict:"E",scope:!0,templateUrl:"home/groupView/rightPanelWidgets/cnvGroupPinnedPostsWidget.tpl.html",controller:["$scope","datetimeService","Groups",function(a,b,c){a.MINIMUM_PINS_TO_SHOW=3,a.MAXIMUM_PINS_TO_SHOW=a.MINIMUM_PINS_TO_SHOW,a.showAll=!0,a.server_now_timestamp=b.getServerTimestamp(),a.$broadcast("render"),a.showAllPins=function(){a.MAXIMUM_PINS_TO_SHOW=a.pinnedContents.length,a.showAll=!1,a.showLess=!0,a.$broadcast("render")},a.showFewerPins=function(){a.MAXIMUM_PINS_TO_SHOW=a.MINIMUM_PINS_TO_SHOW,a.showAll=!0,a.showLess=!1,a.$broadcast("render")},a.removePin=function(b){c.unpinContentFromGroup(a.group,b).success(function(b,c){b.type&&a.$broadcast("render")})},a.reRender=function(){a.$broadcast("render")}}]}}),b.module("convoApp").factory("homeViewStateInfo",["$rootScope","FilterTypes",function(a,b){function c(){return{fromFilter:null,toFilter:null,hasFilter:null,groupFilter:null,userFilter:null}}function d(){if(g!=e.ONBOARDING){g=e.STATE_DEFAULT,h=c();var d=a.filterInfo;if(!d.filterApplied||!d.filterLink.filter)return void f.$broadcast("homeViewStateChange");for(var i=d.filterLink.filter.filters,j=0;j<i.length;j++){var k=i[j];k.type==b.FROM?h.fromFilter=k:k.type==b.TO?h.toFilter=k:k.type==b.HAS&&(h.hasFilter=k)}if(h.fromFilter)g=e.STATE_USER;else if(h.toFilter){var l=h.toFilter.value;(0==l.indexOf("g_")||0==l.indexOf("grp-"))&&(g=e.STATE_GROUP)}f.$broadcast("homeViewStateChange")}}var e={};e.STATE_DEFAULT="DEFAULT",e.STATE_GROUP="GROUP",e.STATE_USER="USER",e.ONBOARDING="ONBOARDING";var f,g=e.STATE_DEFAULT,h=c();return e.init=function(a){f=a,f.$on("filterChange",d),d()},e.getState=function(){return g},e.setState=function(a){g=a,f.$broadcast("homeViewStateChange")},e.getFromFilter=function(){return h.fromFilter},e.getToFilter=function(){return h.toFilter},e.getHasFilter=function(){return h.hasFilter},e}]),b.module("convoApp").directive("cnvHomeCenterPanelSTagsHeader",function(){return{restrict:"AE",scope:!0,templateUrl:"home/tagsView/cnvHomeCenterPanelSTagsHeader.tpl.html",link:function(a,b,c){},controller:["$scope","homeViewStateInfo","Groups","$filter","$timeout","alertsService","userInfo","$location","utils","config","filterInfo","tagsService","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){}function o(){var b=document.getElementById("map-container-tags-view");if(a.isShowMapContainer){var c={center:new google.maps.LatLng(a.coords.lat,a.coords.lng),zoom:16,panControl:!1,zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1,rotateControl:!1,fullscreenControl:!1};setTimeout(function(){var a=new google.maps.Map(b,c);new google.maps.Marker({position:a.getCenter(),icon:{url:"assets/cnv-icons/source-icons/colored-svg/map-pin.svg",scaledSize:new google.maps.Size(45,45),origin:new google.maps.Point(0,0)},map:a});$("#map-container-tags-view").removeClass("hide")},30)}else $("#map-container-tags-view").addClass("hide")}function p(a,b){var c=l.getSTagData(a);return c?(b&&s(c.latitude,c.longitude),c.name):void 0}function q(){var a=t();r(a),v.$broadcast("render")}function r(a){v.feed_title=a}function s(b,c){a.coords.lat=b,a.coords.lng=c}function t(){if(k.filterApplied)for(var a=0;a<k.filterLink.filter.filters.length;a++)if("tag"==k.filterLink.filter.filters[a].type)return p(k.filterLink.filter.filters[a].description,!0);return null}function u(a){q()}a.cnvMemLeakHook=new n;var v=a;a.isShowMapContainer=!1,a.coords={},a.$on("cnvSessionRefreshed",function(){u(!0)}),a.$on("filterChange",function(){u(!0),a.toggleMapContainer(!0)}),a.toggleMapContainer=function(b){b?a.isShowMapContainer=!1:a.isShowMapContainer=!a.isShowMapContainer,o()},a.$on("$destroy",function(){}),a.cnvClickedOutsideThis=function(b){a.isShowMapContainer=!1,a.$apply()},u()}]}}),b.module("convoApp").controller("UsersRightPanelCtrl",["$scope","homeViewStateInfo","Users","userInfo","accountInfo",function(a,b,c,d,e){function f(){var a=b.getFromFilter();h=a.value,g()}function g(){c.getUserDetails(h).then(function(e){if(e&&e.user_id)a.user=e,a.thisUser=h==d.getUserId()?!0:!1;else{var f=b.getFromFilter();c.getUsers().then(function(){var b=c.findUser(f.value);b?f.value!=b.user_id&&(h=b.user_id,g()):(a.user={contact:!0,contact_email:f.value},a.$broadcast("render"))})}a.$broadcast("render")})}a.accountInfo=e;var h=null;a.$on("reRenderUserProfile",function(a){f()}),a.$on("homeViewStateChange",function(){b.getState()===b.STATE_USER&&f()}),c.getUsers()["finally"](function(){f()})}]),b.module("convoApp").controller("ProfilePictureModalCtrl",["$scope","$modalInstance","startWebcam","file",function(a,b,c,d){a.startWebcam=c,a.file=d,a.onSubmit=function(){b.close()},a.dismiss=function(){a.$broadcast("dismissModal"),b.dismiss()},a.$on("dismissModal",function(a,c){c?b.close(!0):b.dismiss(),a.preventDefault()})}]),b.module("convoApp").directive("cnvProfilePictureWidget",["profilePicService","awsService","userInfo","accountInfo","$rootScope","mixpanelService","homeViewStateInfo","onboardingService",function(b,c,d,e,f,g,h,i){return{restrict:"A",scope:!0,controller:["$scope",function(a){}],link:function(h,i,j){function k(a,c,i){var j=b.getThumbnailGenerationRequestStatus(a);j.then(function(j,k){if("SUCCESS"==j.data.status){var l=b.updateUserProfileImageIfUploaded(a,d.getUserId(),e.getAccountId());clearInterval(c),l.then(function(a,b){var c,d;a.hasOwnProperty("data")&&(c=a.data.user_profile_image_type,d=a.data.user_profile_image_version),h.isUploading=!1,h.$broadcast("render"),f.$broadcast("userProfilePictureUpdated",c,d),f.$broadcast("refreshImage"),g.trackEvent(g.Upload_Profile_Pic,{Source:i}),h.$emit("dismissModal",!0)})}})}function l(a,d,e,f,g,i,j,l){d=d.toLowerCase(),h.alerts={success:"Uploading photo..."},h.currentStep="profilePic:stepsComplete",h.$broadcast("render");var m=b.generateRequestUUID();m.then(function(m,n){var o=m.data,p=c.uploadFile(a,o+"-original."+d,"temp/requests/"+o+"/"+o+"-original."+d,e);p.then(function(c,e){var m=b.generateProfileThumbnails(o,o+"."+d,a.size,100,{x:g,y:f,width:i,height:j});h.alerts={success:"Generating thumbnails..."},h.$broadcast("render"),m.then(function(a,b){var c=setInterval(function(){k(o,c,l)},5e3)})})})}function m(){C.draggable({start:function(a,b){b.position},drag:function(a,b){var c=b.position;c.left>=50&&(b.position.left=50),c.top>=50&&(b.position.top=50),x*u- -1*b.position.left<250&&(b.position.left=-(x*u-250)),y*u- -1*b.position.top<250&&(b.position.top=-(y*u-250))}})}function n(){i.find('input[type="range"]').change(function(){u=$(this).val();var a=x*u,b=y*u;C.css("width",a).css("height",b);var c=150-a/2,d=150-b/2;C.css("left",c).css("top",d)})}function o(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}h.$broadcast("render");var p=!1,q=null,r=i.find("video")[0],s=(i.find(".step2"),0),t=0,u=1,v=200,w=200,x=0,y=0,z=0,A=null,B=null,C=i.find("#nativeUserUploadPhoto");if(h.containerWidth=v,h.containerHeight=w,h.isUploading=!1,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,h.startWebcam)h.currentStep="profilePic:enableCamera",h.$broadcast("render"),r.addEventListener("canplay",function(a){p||(actualWidth=r.videoWidth,z=r.videoHeight,x=300,y=r.videoHeight/(r.videoWidth/x),r.setAttribute("width",x),r.setAttribute("height",y),p=!0)},!1),h.initializeCam=function(){i.find('input[type="range"]').val(1),navigator.getMedia({video:!0,audio:!1},function(b){if(h.currentStep="profilePic:showVideoFeed",navigator.mozGetUserMedia)r.mozSrcObject=b;else{var c=a.URL||a.webkitURL;r.src=c.createObjectURL(b)}r.play(),q=b,h.$broadcast("render")},function(a){h.alerts={error:"Error accessing camera, please try again."},h.$broadcast("render")})},h.initializeCam();else if(h.file)switch(A=h.file,A.name.substring(A.name.lastIndexOf(".")+1).toLowerCase()){case"gif":case"jpg":case"png":case"jpeg":h.currentStep="profilePic:adjustImage",h.$broadcast("render");var D=new FileReader;D.onload=function(a){C.attr("src",a.target.result);var b=new Image;b.onload=function(){if(actualWidth=b.width,z=b.height,actualWidth<=z){var a=v/actualWidth;x=actualWidth*a,y=z*a}else{var a=w/z;x=actualWidth*a,y=z*a}C.css("width",x).css("height",y);var c=150-x/2,d=150-y/2;C.css("left",c).css("top",d),h.takePicture()},b.src=a.target.result,h.$broadcast("render")},D.readAsDataURL(A);break;default:h.alerts={error:"The file you attached is not supported."},h.$broadcast("render")}h.takePicture=function(){if(h.startWebcam){h.currentStep="profilePic:adjustImage",h.$broadcast("render"),i.find(".step2").css("width",300).css("height",300);var a=document.createElement("canvas");a.setAttribute("crossOrigin","anonymous"),a.width=x,a.height=y,a.getContext("2d").drawImage(r,0,0,x,y);var b=a.toDataURL("image/png");B=b;var c=new Image;c.onload=function(){if(actualWidth=c.width,z=c.height,actualWidth<=z){var a=v/actualWidth;x=actualWidth*a,y=z*a}else{var a=w/z;x=actualWidth*a,y=z*a}C.attr("src",c.src),C.css("width",x).css("height",y);var b=150-x/2,d=150-y/2;C.css("left",b).css("top",d),console.log(actualWidth,z,x,y)},c.src=b,q&&q.getVideoTracks().length>0&&q.getVideoTracks()[0].stop(),r.pause(),m(),n()}else m(),n()},h.cancelPicture=function(){q&&q.getVideoTracks().length>0&&q.getVideoTracks()[0].stop(),r&&r.pause(),h.$emit("dismissModal")},h.printCoordinates=function(){var a=v,b=w,c=50-C.position().left,d=50-C.position().top,e=actualWidth/(x*u)*a,f=z/(y*u)*b,g=(actualWidth/x,c*(actualWidth/(x*u))),i=d*(actualWidth/(x*u));h.isUploading=!0,h.$broadcast("render"),C.draggable("disable"),console.log(s,t,u,c,d,g,i,e,f)},h.submitPhoto=function(){var a=v,b=w,c=50-C.position().left,d=50-C.position().top,e=actualWidth/(x*u)*a,f=z/(y*u)*b,g=(actualWidth/x,c*(actualWidth/(x*u))),i=d*(actualWidth/(x*u));if(h.isUploading=!0,h.$broadcast("render"),C.draggable("disable"),h.startWebcam){var j=o(B),k="png";l(j,k,k,i,g,e,f,"Camera")}else{var k=A.name.substring(A.name.lastIndexOf(".")+1);l(A,k,A.type,i,g,e,f,"File")}},h.$on("dismissModal",function(a){q&&q.getVideoTracks().length>0&&q.getVideoTracks()[0].stop(),r&&r.pause()}),h.$on("$destroy",function(){q&&q.getVideoTracks().length>0&&q.getVideoTracks()[0].stop(),r&&r.pause()})}}}]),b.module("convoApp").directive("cnvHomeCenterPanelUserHeader",["alertsService","utils",function(a,b){return{restrict:"AE",scope:!0,templateUrl:"home/userView/cnvHomeCenterPanelUserHeader.tpl.html",link:function(c,d,e){function f(){}function g(b){var d="home/userView/centerPanelWidgets/profilePictureModal.tpl.html",e="ProfilePictureModalCtrl",f={startWebcam:function(){return!1},file:function(){return b}},g=a.customModal(d,e,f,"cnvUserProfilePictureModal",!0);g.result.then(function(a){c.$emit("userProfilePictureUpdated")})}c.cnvMemLeakHook=new f,c.openEditProfileWidget=function(a,b){a?c.showEditProfileModal=!0:c.showEditProfileModal=!1,c.$broadcast("render"),a&&b&&(d.find("#"+b)[0].select(),d.find("#"+b)[0].focus())},c.openPostBox=function(){$(".inline-insert-cont .dummy-text-area").trigger("onCustomClick")},c.openProfilePictureModal=function(){var b="components/combinedSetProfilePictureModal/combinedSetProfilePictureModal.tpl.html",c="CombinedSetProfilePictureModalCtrl",d=a.customModal(b,c,null,"combined-set-pic-modal");d.result.then(function(){})};var h=d.find("#profileImageUpload");h.on("change",function(a){this.files.length>0&&g(this.files[0])}),c.openFilePicker=function(){b.fireEvent(h[0],"click")},c.$on("$destroy",function(){h.off("change")})},controller:["$scope","homeViewStateInfo","Users","utils","userProfileService","userInfo","$timeout","chatService","alertsService","AppLinks","$location","config","webhooksService","$window","bannerService","mixpanelService","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){if(w.item.user_id==f.getUserId()){var b=function(){var a=j.newResourceLink("12",[{type:"9",uid:0},{type:"myAccountSettings",uid:0}],null,"My account settings"),b=j.linkToUrl(a);k.path(b.slice(1))},c=function(){var a=j.newResourceLink("12",[{type:"9",uid:0},{type:"notificationsSettings",uid:0}],null,"Notification Settings"),b=j.linkToUrl(a);k.path(b.slice(1))};w.dropdownCtrl.options=[{label:"Edit profile",callback:s}],f.isGuestUser()||w.dropdownCtrl.options.push({label:"Manage groups",callback:function(){var a=j.newResourceLink("22",[{uid:"1",type:"26"},{uid:"2",type:"AllGroups"}],null,"Groups Directory (All Groups)"),b=j.linkToUrl(a,!0);k.url(b.slice(1))}}),w.dropdownCtrl.options.push({label:"Notification preferences",callback:c},{isDivider:!0},{label:"Settings",callback:b}),d.isIE()||d.isSafari()||l.IS_NATIVE||w.dropdownCtrl.options.push({label:"Set Profile Picture",callback:u}),w.dropdownCtrl.options.push({label:"Upload Profile Picture",callback:a.openFilePicker})}else if("SYSTEM"!=w.item.user_type||w.item.integration_creator_id!=f.getUserId()&&!f.isAdminMode())if("SYSTEM"!==w.item.user_type){w.dropdownCtrl.options=[];var e=w.item.first_name;e||(e=w.item.user_account_email),e||(e=w.item.contact_email),e||(e=""),w.dropdownCtrl.options.push({label:"Share a post with "+e,callback:function(){a.openPostBox()}}),f.isAdminMode()||w.dropdownCtrl.options.push({label:"Start a chat with "+e,callback:t})}else w.dropdownCtrl.options=[];else w.dropdownCtrl.options=[],w.item.integration_creator_id==f.getUserId()&&w.dropdownCtrl.options.push({label:"Manage integration ",callback:function(){a.manageIntegration(w.item.webhook_id)}}),w.dropdownCtrl.options.push({label:"Remove integration ",callback:function(){a.deleteIntegration(w.item.webhook_id)}});a.$broadcast("render")}function s(){k.search("action",null),a.showEditProfileModal=!0,a.$broadcast("render")}function t(){w.item.contact?h.openChatWithEmail(w.item.contact_email,!0):h.openChatWithUserId(w.item.user_id,!0)}function u(){var b="home/userView/centerPanelWidgets/profilePictureModal.tpl.html",c="ProfilePictureModalCtrl",d={startWebcam:function(){return!0},file:function(){return null}},e=i.customModal(b,c,d,"cnvUserProfilePictureModal");e.result.then(function(b){a.$emit("userProfilePictureUpdated")})}function v(){w.dropdownCtrl.options&&r()}var w=a;a.utils=d;var x=null;a.setContent=function(d){if(b.getState()===b.STATE_USER){if(w.filter=b.getFromFilter(),w.filter.value!=x||d){w.item={},w.dropdownCtrl={},w.about_me_model={};var e=function(b){c.getUserDetails(b).then(function(b){if(b){var e=c.getUserById(w.filter.value);if(e||(e=c.findUser(w.filter.value)),b.user_id===e.user_id){w.item=b;var g=b.profile_image_note_details;g?w.profileImageLink=q("getFileResourceLinkUrl")(g.file_id,"IMAGE",6,"6",g.note_id):w.profileImageLink="",w.item.feedTitle=w.item.first_name?w.item.first_name+(w.item.last_name?" "+w.item.last_name:""):w.item.user_account_email,w.item.thisUser=b.user_id==f.getUserId(),w.item.formattedDesignation=w.item.designation?w.item.designation:"What is your job title?",w.item.about_me?w.item.formattedAboutMe=w.item.about_me:w.item.thisUser?w.item.formattedAboutMe="Your bio is a mystery.":w.item.first_name?w.item.formattedAboutMe=w.item.first_name+"'s bio is a mystery.":w.item.formattedAboutMe=w.item.user_account_email+"'s bio is a mystery.",x=b.user_id,r(),a.showUserDropdown=w.dropdownCtrl.options.length>0,"REMOVED"===b.user_status&&(a.showUserDropdown=!1),k.search().action&&"editProfile"==k.search().action&&!d&&s(),a.$broadcast("render")}}})};w.item.thisUser=w.filter.value==f.getUserId();var g=!0,h=c.getUserById(w.filter.value);h||(h=c.findUser(w.filter.value)),h?(w.item.feedTitle=(h.first_name||"")+(h.last_name&&" "+h.last_name||""),w.user_id=h.user_id,w.item.feedTitle||(w.item.feedTitle=h.email),"INVITED"===h.status&&p.trackEvent(p.FILTER_ON_INVITED)):(g=!1,w.item.contact=!0,w.item.contact_email=w.filter.description,w.item.feedTitle=w.filter.description,w.item.formattedAboutMe=w.filter.description+"'s bio is a mystery.",r(),a.showUserDropdown=!0),a.$broadcast("render"),a.$broadcast("refreshImage"),g&&e(w.user_id)}a.getUserProfile(w.filter.value!=x?w.filter.value:null)}},a.getUserProfile=function(b){e.get(b).then(function(b){200==b.errorCode&&(a.userProfile=b.data)})["catch"](function(a){console.log("Error getting user profile: ",a)})},a.toggle=function(){a.about_me_model.expand=!a.about_me_model.expand,a.$broadcast("render")},a.setProfilePictureViaWebcam=u,a.$on("openEditProfileWidget",function(b,c){a.openEditProfileWidget(!0,c)}),a.$on("reRenderUserView",function(b){a.setContent(!0)}),a.$on("homeViewStateChange",function(b){a.setContent()}),a.manageIntegration=function(a){promise=m.getIntegrationDetails(a),promise.then(function(b){if("REVOKED"==b.status)return o.showBanner("This integration has been revoked.",!1,!1,promise),!1;var c="AddIntegration";switch(b.access_level){case"zapier":var d=b.zap_id;return n.open("https://zapier.com/app/editor/"+d),!1;case"ifttt":var e=b.recipe_id;return n.open("https://ifttt.com/myrecipes/personal/"+e),!1;case"gcal":c="AddGcalIntegration";break;case"twitter":c="AddTwitterIntegration";break;case"gmail":c="AddGmailIntegration";break;case"gdrive":c="AddGdriveIntegration";break;case"dropbox":c="AddDropboxIntegration";break;case"box":c="AddBoxIntegration";break;case"facebook":c="AddFacebookIntegration";break;case"o365_mail":c="AddO365MailIntegration";break;case"o365_calendar":c="AddO365CalendarIntegration";break;case"o365_drive":c="AddO365DriveIntegration"}if("zapier"!=b.access_level&&"ifttt"!=b.access_level){var f=a+":w",g=j.newResourceLink("100",[{uid:f,type:"100"},{uid:"2",type:c}],null,"Update Integration"),h=j.linkToUrl(g,!0);k.url(h.slice(1))}})},a.deleteIntegration=function(a){promise=m.deleteIntegration(a),o.showBanner_promise(promise,"Deleting integration...","Integration deleted","This integration has already been revoked.",!1,!1,promise),promise.then(function(a){k.url("/feed")})},f.on("userInfo.userRoleUpdated",v),a.$on("$destroy",function(){f.off("userInfo.userRoleUpdated",v)}),b.getState()===b.STATE_USER&&c.getUsers()["finally"](function(){a.setContent()})}]}}]),b.module("convoApp").directive("cnvUserProfileDetailsWidget",[function(){return{restrict:"E",scope:!0,replace:!0,templateUrl:"home/userView/rightPanelWidgets/cnvUserProfileDetailsWidget.tpl.html",controller:["$scope","homeViewStateInfo","Users","Users","userProfileService","bannerService","$rootScope",function(a,b,d,e,f,g,h){var i=null;a.hasAddionalFieldsValues,a.hasAddionalValuesCount=0,a.limitAdditionalFields=5,a.userProfileCustomFields=[],f.registerCallback("profileData",function(b){a.userProfile=b.data}),a.userProfileDetails={first_name:{},last_name:{},designation:{},bio:{},location:{},phone:{},linkedin:{},twitter:{}},a.$watchGroup(["user","userProfile"],function(){a.userProfile&&(a.userProfile.fixed_fields.forEach(function(b){0==b.is_deleted&&("First name"==b.field_name?(a.userProfileDetails.first_name.field_name=b.field_name,a.userProfileDetails.first_name.field_value=b.field_value):"Last name"==b.field_name?(a.userProfileDetails.last_name.field_name=b.field_name,a.userProfileDetails.last_name.field_value=b.field_value):"Position"==b.field_name?(a.userProfileDetails.designation.field_name=b.field_name,a.userProfileDetails.designation.field_value=b.field_value):"Short bio"==b.field_name?(a.userProfileDetails.bio.field_name=b.field_name,a.userProfileDetails.bio.field_value=b.field_value):"Location"==b.field_name?(a.userProfileDetails.location.field_name=b.field_name,a.userProfileDetails.location.field_value=b.field_value):"Phone"==b.field_name?(a.userProfileDetails.phone.field_name=b.field_name,a.userProfileDetails.phone.field_value=b.field_value):"LinkedIn"==b.field_name?(a.userProfileDetails.linkedin.field_name=b.field_name,a.userProfileDetails.linkedin.field_value=b.field_value):"Twitter"==b.field_name&&(a.userProfileDetails.twitter.field_name=b.field_name,a.userProfileDetails.twitter.field_value=b.field_value))}),a.hasAddionalFieldsValues=!1,a.hasAddionalValuesCount=0,a.limitAdditionalFields=5,a.userProfileCustomFields=[],a.userProfile.custom_fields.forEach(function(b){b.field_value&&""!=b.field_value&&(a.userProfileCustomFields.push(JSON.parse(JSON.stringify(b))),a.hasAddionalFieldsValues=!0,a.hasAddionalValuesCount++)}))}),a.increasseAdditionalFieldsLimit=function(){a.limitAdditionalFields?a.limitAdditionalFields=c:a.limitAdditionalFields=5},a.followUser=function(){i=b.getFromFilter().value,a.showSpinner=!0,a.$broadcast("render"),d.followUser(i).then(function(b,c){a.showSpinner=!1,a.$emit("reRenderUserProfile"),a.$emit("userFollowed")})},a.inviteUser=function(){var d=b.getFromFilter().value,f=e.inviteUsersToNetwork([d],c,c,c,"Profile view");a.showSpinner=!0,f.then(function(b){var c=!0;a.showSpinner=!1;for(var d=b.data.data,f=d.users_not_invited,i="",j=0,k=f.length;k>j;j++)i+=f[j].error_message+"<br>",c=!1;i&&g.showBanner(i),c&&(a.user.status="INVITED",g.showBanner("Invited successfully"),e.once("usersUpdated",function(){a.$emit("reRenderUserProfile"),h.$broadcast("reRenderUserView")})),a.$broadcast("render")},function(){a.showSpinner=!1,a.$broadcast("render")}),a.$broadcast("render")},a.remindInvitationToUser=function(){var d=b.getFromFilter().value,f=e.findUser(d);if(f){var h=e.inviteUsersToNetwork([f.email],c,!0,"Profile view");a.showSpinner=!0,h.then(function(b){var c=!0;a.showSpinner=!1;for(var d=b.data.data,e=d.users_not_invited,f="",h=0,i=e.length;i>h;h++)f+=e[h].error_message+"<br>",c=!1;f&&g.showBanner(f),c&&g.showBanner("Invited successfully"),a.$broadcast("render")},function(){a.showSpinner=!1,a.$broadcast("render")}),a.$broadcast("render")}},a.unfollowUser=function(){i=b.getFromFilter().value,a.showSpinner=!0,a.$broadcast("render"),d.unfollowUser(i).then(function(b,c){a.showSpinner=!1,a.$emit("reRenderUserProfile"),a.$emit("userUnfollowed")})},a.showUnfollowBtn=function(b){b?a.unfollowBtn=!0:a.unfollowBtn=!1,a.showSpinner||a.$broadcast("render")},a.getPhoneNumbers=function(a){var b=a.split(",");return b.map(function(a){return String.prototype.trim.apply(a)})}}],link:function(b,c,d){b.showPromptForSkype=function(){a.prompt("Use Ctrl+C to copy the text below.",b.user.skype_name)},b.openEditProfileWidget=function(a){b.$emit("openEditProfileModal",a)}}}}]),b.module("convoApp").directive("cnvUserProfileDiscussionsWidget",[function(){return{restrict:"E",scope:!0,replace:!0,templateUrl:"home/userView/rightPanelWidgets/cnvUserProfileDiscussionsWidget.tpl.html"}}]),b.module("convoApp").directive("cnvUserProfileEditWidget",["utils",function(a){return{restrict:"E",scope:!0,replace:!0,templateUrl:"home/userView/rightPanelWidgets/cnvUserProfileEditWidget.tpl.html",controller:["$scope","$window","Users","utils","config","nativeCommBridge","alertsService","$rootScope","userInfo","userProfileService",function(a,b,c,d,e,f,g,h,i,j){function k(b){a.isContactInfoTab=!0,b.fixed_fields.forEach(function(b){0==b.is_deleted&&(b.meta={is_dirty:m.is_dirty,is_valid:m.is_valid,placeHolder:m.placeHolder},"First name"==b.field_name?(a.dataMap.leftSection.first_name=b,a.dataMap.leftSection.first_name.meta.placeHolder="First Name",a.firstNameOldValue=b.field_value):"Last name"==b.field_name?(a.dataMap.leftSection.last_name=b,a.dataMap.leftSection.last_name.meta.placeHolder="Last name",a.lastNameOldValue=b.field_value):"Position"==b.field_name?(a.dataMap.leftSection.designation=b,a.dataMap.leftSection.designation.meta.placeHolder="Enter your job title"):"Short bio"==b.field_name?(a.dataMap.topSection.bio=b,a.dataMap.topSection.bio.meta.placeHolder="Enter a short bio"):"Location"==b.field_name?(a.dataMap.bottomSection.fixed.location=b,a.dataMap.bottomSection.fixed.location.meta.placeHolder="Add your location"):"Phone"==b.field_name?(a.dataMap.bottomSection.fixed.phone=b,a.dataMap.bottomSection.fixed.phone.meta.placeHolder="Add phone no. with country code"):"LinkedIn"==b.field_name?(a.dataMap.bottomSection.fixed.linkedin=b,a.dataMap.bottomSection.fixed.linkedin.meta.placeHolder="linkedin.com/pub/user"):"Twitter"==b.field_name&&(a.dataMap.bottomSection.fixed.twitter=b,a.dataMap.bottomSection.fixed.twitter.meta.placeHolder="twitter.com/user"))}),a.dataMap.bottomSection.custom=[],b.custom_fields.forEach(function(b){0==b.is_deleted&&(b.meta=m,b.meta.placeHolder="Enter value",a.dataMap.bottomSection.custom.push(b))})}function l(){var b={fixed_fields:[],custom_fields:[]};for(var c in a.dataMap.leftSection)a.dataMap.leftSection.hasOwnProperty(c)&&("First name"!=a.dataMap.leftSection[c].field_name||a.dataMap.leftSection[c].field_value&&""!=a.dataMap.leftSection[c].field_value||(a.dataMap.leftSection[c].field_value=a.firstNameOldValue),"Last name"!=a.dataMap.leftSection[c].field_name||a.dataMap.leftSection[c].field_value&&""!=a.dataMap.leftSection[c].field_value||(a.dataMap.leftSection[c].field_value=a.lastNameOldValue),b.fixed_fields.push(a.dataMap.leftSection[c]));b.fixed_fields.push(a.dataMap.topSection.bio);for(var c in a.dataMap.bottomSection.fixed)a.dataMap.bottomSection.fixed.hasOwnProperty(c)&&"email"!=c&&b.fixed_fields.push(a.dataMap.bottomSection.fixed[c]);return a.dataMap.bottomSection.custom.forEach(function(a){b.custom_fields.push(a)}),b}a.utils=d,a.IS_NATIVE=e.IS_NATIVE,a.TWITTER_REGEX_PATTERN="/^https?://([wd]+.)?twitter.com$/ig",a.dataMap={leftSection:{first_name:{},last_name:{},designation:{}},topSection:{bio:{}},bottomSection:{fixed:{email:{field_name:"E-mail"},phone:{},location:{},linkedin:{},twitter:{}},custom:[]}};var m={is_dirty:!1,is_valid:!1,placeHolder:""};a.firstNameOldValue="",a.lastNameOldValue="",a.$watchGroup(["item","userProfile"],function(){a.dataMap.bottomSection.fixed.email.field_value=a.item.user_account_email,k(a.userProfile)}),a.openProfilePictureModal=function(){var b="components/combinedSetProfilePictureModal/combinedSetProfilePictureModal.tpl.html",c="CombinedSetProfilePictureModalCtrl",d=g.customModal(b,c,null,"combined-set-pic-modal");a.openEditProfileWidget(!1),d.result.then(function(){})},a.changeTab=function(b){a.isContactInfoTab=b},a.submitUserDetails=function(){a.showSpinner=!0,a.$broadcast("render"),a.dataMap?j.update(l()).then(function(b){b.errorCode>=200&&b.errorCode<300&&(a.showSpinner=!1,k(JSON.parse(JSON.stringify(b.data))),a.userProfile=JSON.parse(JSON.stringify(b.data)),a.$broadcast("render"),a.$emit("reRenderUserView"),a.$emit("root_scope:reRenderUserView"),a.openEditProfileWidget(!1),e.IS_NATIVE&&f.refreshMenulet())})["catch"](function(b){a.openEditProfileWidget(!1),g.alertModal("Error updating profile info","Profile info fields may be updated by Admin please try again.","OK"),console.log("Error update user profile: ",b)}):a.updateDetails.$invalid&&(a.showSpinner=!1,console.log("Error submitting details: "))},a.uploadDpFromEditProfileWidget=function(){a.openEditProfileWidget(!1),a.openFilePicker()},a.setDpFromEditProfileWidget=function(){a.openEditProfileWidget(!1),a.setProfilePictureViaWebcam()},a.navigateToUserSettings=function(){var a="/#/v1/"+i.getUserInfo().user_id+"/apps/12/settings/0/myAccountSettings/0";b.location.href=a}}],link:function(a,b,c){a.appendTwitterUrlOnClick=function(){},a.appendLinkedinUrlOnClick=function(){},a.editProfileKeyBindings=function(b){27==b.keyCode&&a.openEditProfileWidget(!1)};$("body").on("keydown",a.editProfileKeyBindings),a.$on("$destroy",function(){$("body").off("keydown",a.editProfileKeyBindings);
}),a.getUserProfile()}}}]),b.module("convoApp").directive("cnvUserProfileTopGroupsWidget",[function(){return{restrict:"E",scope:!0,replace:!0,templateUrl:"home/userView/rightPanelWidgets/cnvUserProfileTopGroupsWidget.tpl.html",controller:["$scope","Users","homeViewStateInfo","Groups",function(a,b,c,d){function e(){var d=b.getTopGroups(c.getFromFilter().value);d.then(function(b){a.topGroups=b,a.$broadcast("render")})}a.$on("homeViewStateChange",function(){"USER"==c.getState()&&e()}),d.on("groupsUpdated",function(){a.$broadcast("render")}),e()}]}}]),b.module("convoApp").directive("cnvInlineInsert",["utils","$compile","$templateCache","$window",function(b,d,e,f){return{restrict:"E",priority:0,scope:!0,templateUrl:"inlineInsert/cnvInlineInsert.tpl.html",link:function(c,d,e){var g=d.find(".dummy-area-cont")[0];setInterval(function(){if(!c.active){var a=g.getElementsByTagName("span")[0],b=Math.floor(8*Math.random()),d=f.messagesArray[b];a.innerHTML=d}},864e5);c.setFocusOnTagsfield=function(){d.find(".tags-field-cont tags-input .tags").trigger("click")},c.focusTagsInput=function(){setTimeout(function(){b.fireEvent(d.find(".to-field-cont tags-input .tags")[0],"click")},0)},c.pasteFromClipboard=function(){setTimeout(function(){b.fireEvent(d.find(".ql-editor")[0],"click")},0)},c.focusNoteTitle=function(){var a=d.find("#noteTitleField");a.focus()},c.hideDummyTextArea=function(){d.find(".dummy-text-area").addClass("ng-hide")},d.find(".dummy-text-area").on("onCustomClick",function(a,b,d){c.onDummyTextAreaClick(null,{noteEditorHtmlText:b,noteEditorTitle:d})}),c.scrollWindowToTop=function(){$(a).scrollTop()},c.openGiphyPopUp=function(){d.find("#iShowGiphyPopup").trigger("showGiphyPopover")},c.onDummyTextAreaUploadIconClick=function(){d.find(".file-input").trigger("click")},c.composeBoxInitData&&(c.onDummyTextAreaClick(null,{noteEditorHtmlText:c.composeBoxInitData[0],noteEditorTitle:c.composeBoxInitData[1]}),c.composeBoxInitData=null)},controller:["$scope","$q","Users","Groups","usersGroupsListProvider","userInfo","accountInfo","alertsService","mentionsHistory","popoverUtils","$interval","$rootScope","FilterTypes","hashtagsProvider","homeViewStateInfo","$injector","nativeCommBridge","$timeout","nativeHeightUpdate","draftService","config","getResourceLinkUrlFilter","bannerService","settingsService","mixpanelService","atMentionsListProvider","onboardingService","UploadService","itemService","geotaggingService","BlackListWordsService",function(d,e,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J){function K(a){Qa.inlineInsertPlaceholderText=a,Qa.cnv_mainPlaceholder=z.IS_MENULET&&"Type to create a post \nPress ^\u2318N at anytime to show this window"||a}function L(){d.postPermissions=7,d.iconCondtions={canEdit:!0,canComment:!1,canView:!1}}function M(){d.postPermissions=3,d.iconCondtions={canEdit:!1,canComment:!0,canView:!1}}function N(){d.postPermissions=1,d.iconCondtions={canEdit:!1,canComment:!1,canView:!0}}function O(a,b){for(var c=!1,d=0;d<a.length-1&&(a[d].label===b&&(c=!0),!c);d++);return c}function P(){var a,b=t.getState(),c=t.getFromFilter();c&&(Qa.active||(a=g.findUser(c.value),a?"INVITED"===a.status&&d.onDummyTextAreaClick():d.onDummyTextAreaClick()));var e=Ra;if(b===t.STATE_GROUP){var f=t.getToFilter(),i=h.getGroup(f.value);i&&(e="Share something with "+i.get("title")+".")}else b===t.STATE_USER&&(a||(a=g.findUser(c.value)),a&&(e="Share something with "+g.getUserFullName(a)+"."));K(e)}function Q(){Ma=p(ma,15e3)}function R(){p.cancel(Ma)}function S(a){var b=Qa.mode,c=!1;return b==Ga?(c=Qa.model.noteTitleText||Qa.isLocationAvailable||Qa.isLocationFetching||Qa.noteEditorCtrl.initialized&&Qa.noteEditorCtrl.getEditorText().trim().length>0,!c&&Qa.filesUploadManagerCtrl.initialized&&(Qa.filesUploadManagerCtrl.isBusy()||Qa.filesUploadManagerCtrl.getSuccessfullyProcessedFiles().length>0||a&&Qa.filesUploadManagerCtrl.getAllFiles().length>0)&&(c=!0),!c&&Qa.tagList.length&&(c=!0)):b==Ha&&(c=Qa.linkResolveCtrl.initialized),c}function T(a){Qa.toolbarActive=a}function U(a){if(Qa.scrollWindowToTop(),a=[a],Qa.active){Qa.mode!=Ga&&ha();for(var b in a)a[b].noteId=Qa.noteId;Qa.$broadcast("enqueueFile",a)}else Y(Ga,{files:a});z.IS_MENULET&&setTimeout(function(){x.updateHeight("on file select")},0),Qa.$$phase||Qa.$digest()}function V(){Qa.active&&(Qa.tagField||(Qa.tagField=!0),setTimeout(Qa.setFocusOnTagsfield,0),z.IS_MENULET&&setTimeout(x.updateHeight("on onToggleTagsField"),0))}function W(){Qa.showSpinner=!0,Qa.isLocationFetching=!0,Qa.isLocationTimeoutContinue=!0,Qa.preventLocationErrorDialog=!1,Qa.timeout=setTimeout(function(){Qa.model.location||!Qa.isLocationTimeoutContinue||Qa.preventLocationErrorDialog||(Qa.showSpinner=!1,Qa.isLocationTimeoutContinue=!1,X("Location error","Your location could not be fetched.")),Qa.preventLocationErrorDialog&&(Qa.isLocationFetching=!1)},1e4),Qa.model.location&&Qa.model.location.hasOwnProperty("lat")?(Qa.model.location=null,Qa.showSpinner=!1,Qa.isLocationTimeoutContinue=!1):I.getGeolocation(function(a,b){Qa.showSpinner=!1,clearTimeout(Qa.timeout),a?(Qa.isLocationTimeoutContinue&&!Qa.preventLocationErrorDialog&&(Qa.isLocationTimeoutContinue=!1,1!=a.code?X("Location error","Your location could not be fetched."):X("Location error","Location could not be fetched. Please grant location access from browser settings to Convo and try again.")),Qa.preventLocationErrorDialog&&(Qa.isLocationFetching=!1)):Qa.isLocationTimeoutContinue&&(Qa.model.location=b,Qa.isLocationAvailable=!0,Qa.isLocationTimeoutContinue=!1,Qa.isLocationFetching=!1,Qa.sharing&&Qa.$emit("location_fetch_complete",{}))},{timeout:1e4,enableHighAccuracy:!1})}function X(a,b){Qa.isLocationAvailable=!1,m.promptModal(a,b,function(){W()},function(){Qa.isLocationFetching=!1,Qa.sharing&&Qa.$emit("location_fetch_complete",{})},"Try Again","Cancel")}function Y(a,c){if(Qa.model={},Qa.shareWith=[],Qa.shareWithSelf=[],Qa.tagList=[],Qa.model.noteTitleText=c.noteEditorTitle||"",Ia=!1,Qa.noteSaveText="",Qa.isLocationAvailable=!1,La=null,Ka=null,ja(),z.IS_MENULET&&y.dataAvailableInLocalStorage()?ea():Z(aa),Qa.noteId=b.generateUniqueId(),c.files)for(var d in c.files)c.files[d].noteId=Qa.noteId;if(a==Ga){var e={};Qa.noteEditorCtrl={initialized:!1,initialHtmlText:c.noteEditorHtmlText||"",height:Aa,captureEvents:e,editorInitialized:ca},Qa.filesUploadManagerCtrl={initialized:!1,templateType:"inlineinsert",files:c.files||[],dontWaitForFileConversion:!1}}else if(a==Ha){var e={};Qa.linkCommentEditorCtrl={initialized:!1,initialHtmlText:c.linkCommentEditorHtmlText||"",height:Aa,editorInitialized:da},Qa.linkResolveCtrl={initialized:!1,url:c.url,source:"inline-insert"}}Qa.mode=a,Qa.active=!0,Q(),Qa.hideDummyTextArea&&Qa.hideDummyTextArea(),q.login_data.onboarding_state&&0==q.login_data.onboarding_state.used_inline_insert?Qa.Edited_Recipients=0:Qa.Edited_Recipients=1}function Z(a){h.getGroups().then(function(){g.getUsers().then(function(){a()})})}function aa(){var a=null,b=q.filterInfo;if(b.filterApplied&&b.filterLink.filter&&1==b.filterLink.filter.filters.length){var d=b.filterLink.filter.filters[0];if(d.type==r.TO||d.type==r.FROM){var a=j.getPublishableUserListItem(d.value);if(a||(a=j.getPublishableGroupListItem(d.value)),!a){var e=g.findUser(d.value);a=e?j.findUserListItem(d.value):j.getContactListItem(d.value)}}}a?Qa.shareWith.push(a):C.getGeneralSettings().then(function(a){for(i=0;i<a.sharing_options_list.length;i++){var b=null;if("GROUP"==a.sharing_options_list[i].type){var d=h.getGroup(a.sharing_options_list[i].share_to),e=d.get("member_can_post_in_this_group");(e===c||1===e)&&(b=j.getGroupListItem(a.sharing_options_list[i].share_to))}"USER"==a.sharing_options_list[i].type&&(b=j.getUserListItem(a.sharing_options_list[i].share_to)),null!=b&&Qa.shareWith.push(b)}}),z.IS_MENULET&&x.updateHeight("groupsResponse.success")}function ba(){sharingData=j.getUserListItem(k.user_id),null!=sharingData&&Qa.shareWithSelf.push(sharingData)}function ca(){z.IS_MENULET&&(Qa.noteEditorCtrl.captureEvents.on("text-change",function(a,b){x.updateHeight("text-change")}),setTimeout(function(){x.updateHeight("editor initilizaed")},400)),q.$broadcast("inlineInsertOpen")}function da(){z.IS_MENULET&&(Qa.linkCommentEditorCtrl.captureEvents.on("text-change",function(a,b){x.updateHeight("text-change")}),setTimeout(function(){x.updateHeight("editor initilizaed")},400))}function ea(){var a,b=null;a=y.getLocalStorageData(),promise=H.getNote(a[1]),promise.then(function(a){var c=a.data;if(Z(function(){if(Na=!0,+c.data.item.draft){b=c.data.mappings["mappings_"+c.data.item_id];for(var a=b.length-1;a>=0;a--){var d=null;"GROUP"==b[a].type&&(d=j.getGroupListItem(b[a].published_to)),"USER"==b[a].type&&(d=j.getUserListItem(b[a].published_to)),null!=d&&(+b[a].is_at_mentioned&&(d.readonly=!0),Qa.shareWith.push(d))}}else aa();z.IS_MENULET&&x.updateHeight("groupsResponse.success")}),+c.data.item.draft&&(Qa.noteId=c.data.item_id,La=c.revisionNo,+c.data.item.show_title&&(Qa.model.noteTitleText=c.data.item.title),Qa.mode==Ga,Qa.noteEditorCtrl.setContent(c.data.item.complete_text),c.data.files.hasOwnProperty("files_"+c.data.item_id))){files=c.data.files["files_"+c.data.item_id];for(var d=0,e=files.length;e>d;d++)Qa.filesUploadManagerCtrl.addSuccessfullyProcessedFile(files[d])}})}function fa(a,c){var d={};a==Ga?Qa.noteEditorCtrl={initialized:!1,initialHtmlText:c.noteEditorHtmlText||"",height:Aa,captureEvents:d,editorInitialized:ca}:a==Ha&&("File"==b.getFileFormat(c.url.substr(c.url.lastIndexOf(".")).slice(1))&&(c.linkCommentEditorHtmlText=""),Qa.linkCommentEditorCtrl={initialized:!1,initialHtmlText:c.linkCommentEditorHtmlText||"",height:{min:155,max:250},captureEvents:d,editorInitialized:da},Qa.linkResolveCtrl={initialized:!1,url:c.url,source:"inline-insert"},Qa.insertOptionsCtrl.textToolbar.hide(),Qa.model.location=null,Qa.isLocationAvailable=!1),Qa.mode=a,z.IS_MENULET&&x.updateHeight("Switch Mode")}function ga(a,b){var c={url:a,linkCommentEditorHtmlText:b||Qa.model.noteTitleText||""};fa(Ha,c)}function ha(){var a=Qa.linkCommentEditorCtrl.getEditorHtmlText().trim();fa(Ga,{noteEditorHtmlText:a||""})}function ia(){R(),Na=!1,Oa=!1,Qa.noteSaveText="",Qa.onRemoveLocation(),La=Ka=null,Qa.insertOptionsCtrl.textToolbar.hide(),Qa.insertOptionsCtrl.resetGiphySearchText(),Qa.active=Qa.sharing=Qa.tagField=!1,Qa.mode="",Qa.shareWith.length=0,xa&&xa.off("feedPolled",ia),z.IS_MENULET&&w(Qa.onDummyTextAreaClick,0);var a=document.activeElement;a.classList.contains("ql-ie-10")&&a.blur(),Pa.off(),Qa.filesUploadManagerCtrl=null,Qa.noteEditorCtrl.blur(),Qa.noteEditorCtrl.captureEvents&&(Qa.noteEditorCtrl.captureEvents.off(),Qa.noteEditorCtrl.captureEvents=null),Qa.noteEditorCtrl=null}function ja(){d.postPermissions=7,d.iconCondtions={canEdit:!0,canComment:!1,canView:!1}}function ka(a){S(!0)||ia()}function la(a,b){var d=!1;Qa.mode==Ga&&Qa.filesUploadManagerCtrl.initialized&&Qa.filesUploadManagerCtrl.isBusy()?d=!0:Qa.mode==Ha&&Qa.linkResolveCtrl.isBusy()&&(d=!0),d?m.promptModal("Unsaved changes","Are you sure you want to discard the unsaved changes?",function(){ia()},null,"Discard"):(!a&&ma(c,c,b),ia())}function ma(a,b,c){var d=Qa.mode,e=!1;if(d==Ga){if(e=Qa.model.noteTitleText||Qa.isLocationAvailable||Qa.noteEditorCtrl.initialized&&Qa.noteEditorCtrl.getEditorText().trim().length>0,!e&&Qa.filesUploadManagerCtrl.initialized&&Qa.filesUploadManagerCtrl.getSuccessfullyProcessedFiles().length>0&&(e=!0),!e&&Na){if(c){var f=Ka.item.type,g=Ka.item.item_id;return void H.moveToTrash(f,g)}e=!0}}else d==Ha&&(e=Qa.linkResolveCtrl.initialized);if(a||e){var h=!0;d==Ga&&(Qa.filesUploadManagerCtrl.initialized&&Qa.filesUploadManagerCtrl.isBusy()&&(h=!1),Qa.isLocationFetching&&(h=!1)),d==Ha&&(h=!1),h&&0==Qa.shareWith.length&&0===Qa.shareWithSelf.length&&ba(),h&&na(b)}}function na(a){if(Ia||Qa.sharing)return!1;var b=ra(1,a);-2===b?(Qa.noteSaveText="",Ia=!1):-1===b?(Qa.noteSaveText=Da,Ia=!1):(Ia=!0,Qa.noteSaveText=Ea)}function oa(a){Ja=a||{}}function pa(){var a=!1;return Qa.mode==Ga&&Ka&&Ka.item_id===Qa.noteId&&(a=!0),a}function qa(){if(0==Qa.shareWith.length)return void(Qa.validSharingInfo=!1);if(Ia)return void za["finally"](function(){qa()});var a=Qa.mode,b=!1;if(a==Ga){if(Qa.filesUploadManagerCtrl.initialized&&!Qa.filesUploadManagerCtrl.isBusy()){for(var c=Qa.filesUploadManagerCtrl.getSuccessfullyProcessedFiles(),d=!0,e="",f=0;f<c.length;f++){var g=c[f];if(g.status===G.FILE_STATUS_UPLOAD_FAILED||g.status===G.FILE_STATUS_CONVERSION_REQ_FAILED){d=!1,e="Some files could not be attached. Please try again.";break}}if(!d)return void m.alertModal("Convo",e,"Okay")}if(b=Qa.model.noteTitleText||Qa.noteEditorCtrl.initialized&&Qa.noteEditorCtrl.getEditorText().trim().length>0,!b&&Qa.filesUploadManagerCtrl.initialized&&(Qa.filesUploadManagerCtrl.isBusy()||Qa.filesUploadManagerCtrl.getSuccessfullyProcessedFiles().length>0)){var h=!1;if(!Qa.filesUploadManagerCtrl.isBusy()){h=!0;for(var i=Qa.filesUploadManagerCtrl.getSuccessfullyProcessedFiles(),f=0;f<i.length;f++){var j=i[f].status;if(j===G.FILE_STATUS_CONVERSION_COMPLETED||j===G.FILE_STATUS_CONVERSION_FAILED){h=!1;break}}}b=!h}}else a==Ha&&(b=Qa.linkResolveCtrl.initialized);if(b){Qa.sharing=!0;var k=!0;if(a==Ga){if(Qa.filesUploadManagerCtrl.initialized&&Qa.filesUploadManagerCtrl.isBusy()){Oa=!0;var l=Qa.$on("filesUploadManagerCtrl_allFilesProcessed",function(){l();var a=Qa.filesUploadManagerCtrl.getSuccessfullyProcessedFiles(),b=!0,c="";if(0==a.length&&(Qa.sharing=!1,b=!1,c="The files could not be attached. Please try again."),b)for(var d=0;d<a.length;d++){var e=a[d];if(e.status===G.FILE_STATUS_UPLOAD_FAILED||e.status===G.FILE_STATUS_CONVERSION_REQ_FAILED||e.status===G.FILE_STATUS_CONVERSION_FAILED){b=!1,Qa.sharing=!1,c="Some files could not be attached. Please try again.";break}}b||m.alertModal("Convo",c,"Okay",function(){Oa=!1}),b&&!Qa.isLocationFetching&&ra()});k=!1}Qa.isLocationFetching&&(Qa.$on("location_fetch_complete",function(){Qa.isLocationAvailable?ra():Qa.sharing=!1}),k=!1)}else if(a==Ha&&Qa.linkResolveCtrl.isBusy()){var n=Qa.$on("linkResolveCtrl_completed",function(){n(),o(),ra()}),o=Qa.$on("onLinkModeClose",function(){n(),o(),Qa.sharing=!1,w(qa,0)});k=!1}k&&ra()}}function ra(b,c){for(var e,f=[],h=!1,i=0;i<Qa.shareWith.length;i++){var j=!b,n=Qa.shareWith[i];"CONTACT"===n.type?(f.push({published_to:n.email,type:"USER_EMAIL"}),j=!1,b||(h=!0)):f.push({published_to:n.id,type:n.type,access_level:"ALL"}),j&&sa(n)}for(var i=0;i<Qa.shareWithSelf.length;i++){var n=Qa.shareWithSelf[i];f.push({published_to:n.id,type:n.type,access_level:"ALL"})}if(Qa.shareWithSelf=[],b||(Qa.noteSaveText="",Qa.insertOptionsCtrl.textToolbar.hide(),R()),Qa.mode==Ga){var o="";Qa.mode==Ga&&(Qa.model.noteTitleText.length>0?(Qa.model.noteTitleText=J.clean(Qa.model.noteTitleText),o=Qa.model.noteTitleText):o="");var p="",r="";Qa.noteEditorCtrl&&Qa.noteEditorCtrl.initialized&&(Qa.noteEditorCtrl.cleanNoteEditor(),p=Qa.noteEditorCtrl.getEditorText(),r=Qa.noteEditorCtrl.getEditorHtmlText());var s=Qa.model.noteTitleText||Qa.noteEditorCtrl.initialized&&Qa.noteEditorCtrl.getEditorText().trim().length>0;if(!s&&!c)return Ia=!1,Qa.sharing=!1,oa(null),-2;var u=[];if(Qa.mode==Ga&&Qa.filesUploadManagerCtrl.initialized){for(var w=Qa.filesUploadManagerCtrl.getSuccessfullyProcessedFiles(),i=0;i<w.length;i++){var x=w[i];if(x.status!==G.FILE_STATUS_CONVERSION_REQ_FAILED){var A={name:x.name,size:x.size,file_name_id:x.fileId,type:x.type,file_upload_name:x.fileUploadName};x.serverFileId&&(A.file_id=x.serverFileId),u.push(A)}}b||Qa.filesUploadManagerCtrl.haltFilesProcessing()}for(var C="",D=Qa.tagList||[],i=0,E=D.length;E>i;i++)C+=D[i].label+",";var I={noteId:Qa.noteId,title:o,bodyText:p,bodyHtmlText:r,shareWith:f,attachedFiles:u,draft:b||0,tags:C,auto_save:b||0,permissions:d.postPermissions,location:Qa.model.location};if(b){if(!(c||Na||p.trim()||u.length||Qa.isLocationAvailable))return-2;if(JSON.stringify(I)==JSON.stringify(Ja))return-1}b||Qa.noteEditorCtrl.blur(),e=H.createNote(I.noteId,I.title,I.bodyText,I.bodyHtmlText,I.shareWith,I.attachedFiles,I.draft,La||0,I.tags,I.auto_save,I.permissions,I.location,!0),oa(I)}else{var K=Qa.linkResolveCtrl.url,L=Qa.linkResolveCtrl.getData(),M=null;Qa.linkCommentEditorCtrl.initialized&&Qa.linkCommentEditorCtrl.getEditorText().trim().length>0&&(Qa.linkCommentEditorCtrl.cleanNoteEditor(),M=Qa.linkCommentEditorCtrl.getEditorHtmlText());var I={url:K,resolvedData:L,selectedIndex:L.selectedIndex,commentHtmlText:M,shareWith:f,draft:b||0,permissions:d.postPermissions};if(b&&JSON.stringify(I)==JSON.stringify(Ja))return-1;b||Qa.linkCommentEditorCtrl.blur(),e=H.createLink(I.url,I.resolvedData,I.selectedIndex,I.commentHtmlText,I.shareWith,0,null,La||0,I.permissions),oa(I)}return e.then(function(a){var a=a.data;if(a.hasOwnProperty("invite_response")){for(var c=a.invite_response,e=c.users_not_invited,i="",j=0,m=e.length;m>j;j++)i+=e[j].error_message+"<br>";if(i)return B.showBanner(i),Ia=!1,Qa.sharing=!1,void(Qa.noteSaveText=Fa)}if(Qa.mode!=Ga||Qa.noteId==a.item_id){var o=!1;if(a.item&&!a.item.draft&&a.mappings&&(o=!0),o)for(var p=a.mappings["mappings_"+a.item_id],j=0;j<p.length;j++){var r=p[j];f.push({published_to:r.id,type:r.type,access_level:"ALL"}),sa(n)}if(h){var s=t.getFromFilter();if(s){var u=g.findUser(s.value);u||g.once("usersUpdated",function(){q.$broadcast("reRenderUserProfile"),q.$broadcast("reRenderUserView")})}}if(Ka=a,Na=!0,b?(Qa.active&&(a&&a.item&&a.item.revision_no&&(La=a.item.revision_no),Qa.noteSaveText=Da),y.saveDraftToLocalStorage(a.item.type,a.item_id),Ia=!1,Pa.trigger("draft-shared")):(xa?xa.once("feedPolled",function(a){if(l.getAccountLevel()!==l.ACCOUNT_LEVELS.STARTER&&d.postPermissions.checkBitAt(3)&&q.login_data&&q.login_data.onboarding_state&&q.login_data.onboarding_state.show_post_permissions_tooltip){var b=null;if(b=q.filterInfo&&q.filterInfo.filterApplied?a.filter_feed_items:a.feed_items,b&&b.length){for(var c=null,e=0;e<b.length;e++)"ADDED"===b[e].action&&b[e].created_by===k.getUserId()&&(c=b[e]);c&&(c.enable_permissions_tooltip=!0)}}ia()}):ia(),y.removeDraftFromLocalStorage(),Qa.$emit("newPostPublishedViaAddBox"),z.IS_MENULET&&v.postShared()),F.checkState()&&0==F.getChecklist().share_a_post_done){var w=F.recordAction("share_a_post_done");w.then(function(a,b){F.setLastPlayedStep("share_post"),d.$emit("cnvOnboarding:updateOnboardingChecklist",!0)})}}},function(c){if(Ia=!1,Qa.sharing=!1,oa(null),0==z.IS_MENULET)if(b)Qa.noteSaveText=Fa;else{Qa.noteSaveText="";var d="The "+(Qa.mode===Ga?"note":"link");d+="no_net"===c.customStatus?" could not be shared because you're disconnected from the internet. Please check your connection and try again.":" could not be shared because of an unknown error. Please try again.",m.alertModal("",d),Q()}else $(a).trigger("disconnected")}),za=e,!0}function sa(a){n.addItemToHistory(a.type,a.id)}function ta(){ma(),y.removeDraftFromLocalStorage(),ia(),Qa.$digest()}function ua(){Qa.noteEditorCtrl.focus()}function va(){Qa.$emit("newPostPublishedViaAddBoxInMenulet")}function wa(){z.IS_NATIVE&&v.on("newPostShared",va)}var xa=null,ya=null;if(!z.IS_MENULET)var xa=u.get("Feed");var za,Aa=z.IS_MENULET?{min:267,max:350}:{min:115,max:250},Ba=z.IS_MENULET?3:5,Ca={ENTER:13,ESCAPE:27,SAVE:83,TAB:9},Da="Saved in Drafts",Ea="Saving Draft...",Fa="Couldn't save changes.",Ga=2,Ha=3,Ia=!1,Ja={},Ka=null,La=null,Ma=null,Na=!1,Oa=!1,Pa={};_.extend(Pa,Backbone.Events);var Qa=d,Ra=f.inlineInsertPlaceholderText;Qa.IS_NATIVE_MENULET=z.IS_MENULET||!1,Qa.maximizeButtonTarget=z.IS_NATIVE?"_self":"_blank",Qa.RICH_NOTE_MODE=Ga,Qa.LINK_MODE=Ha,Qa.insertOptionsCtrl=null,Qa.noteSaveText="",Qa.toolbarActive=!1,Qa.nativeIconColor=z.IS_MENULET&&"darkgray"||"darkgray",Qa.tagField=!1,Qa.Edited_Recipients=1,Qa.isLocationAvailable,Qa.showSpinner,Qa.starter_network=l.getAccountLevel()===l.ACCOUNT_LEVELS.STARTER,Qa.validSharingInfo=!0,Qa.active=!1,Qa.dropdownCtrl={},Qa.isGuest=k.isGuestUser(),Qa.tab.appContCtrl.appCtrl.closing=function(){ma()},function(){Qa.dropdownCtrl.options=[],Qa.dropdownCtrl.attrs=[],Qa.dropdownCtrl.attrs.push({selector:"a.dropdown-toggle",key:"tabindex",value:"-1"}),Qa.dropdownCtrl.type="inline_insert_permissions",l.getAccountLevel()!==l.ACCOUNT_LEVELS.STARTER?(Qa.dropdownCtrl.options.push({label:"Can edit and comment",icon:"cnv-icons-14 cnv-tick v-align-m",conditionalLabelIcon:!0,condition:"canEdit",callback:L}),Qa.dropdownCtrl.options.push({label:"Comment only",icon:"cnv-icons-14 cnv-tick v-align-m",conditionalLabelIcon:!0,condition:"canComment",callback:M}),Qa.dropdownCtrl.options.push({label:"View only",icon:"cnv-icons-14 cnv-tick v-align-m",conditionalLabelIcon:!0,condition:"canView",callback:N})):Qa.isGuest||Qa.dropdownCtrl.options.push({label:"Permissions (Upgrade)",icon:"cnv-icons-20 icons_Lock-white",callback:function(){q.$emit("upgrade-to-permium")}})}(),Qa.onTitleKeydown=function(a){var b=!1;(a.ctrlKey||a.metaKey)&&a.keyCode===Ca.ENTER?(Qa.onCtrlOrCmdEnterPressInTextEditor(),b=!0):(a.ctrlKey||a.metaKey)&&a.keyCode===Ca.SAVE?(Qa.onCtrlOrCmdSavePressInTextEditor(),b=!0):a.keyCode===Ca.ESCAPE?(Qa.onEscKeyPressInTextEditor(),b=!0):a.keyCode===Ca.SPACE?(Qa.onSpaceKeyPressInTextEditor(),b=!0):a.shiftKey&&a.keyCode===Ca.TAB?(Qa.focusTagsInput(),b=!0):a.keyCode===Ca.ENTER&&(Qa.noteEditorCtrl.focus(),Qa.onEnterPressInTextEditor(),b=!0),b&&(a.preventDefault(),a.stopImmediatePropagation())},Qa.onDummyTextAreaClick=function(a,b){var c=a&&$(a.target).hasClass("inlineInsertAttachmentIconWhenClosed");c?Y(Ga,b||{}):Qa.active&&S()?m.promptModal("Unsaved changes","Are you sure you want to discard the unsaved changes?",function(){ia(),setTimeout(function(){Y(Ga,b||{})},0)},null,"Discard"):Y(Ga,b||{})},Qa.onAtMentionAdded=function(a){b.findInObjectArray(Qa.shareWith,"id",a.id)||Qa.shareWith.push(a);var c=b.findInObjectArray(Qa.shareWith,"id",a.id);c&&(c.readonly=!0),z.IS_MENULET&&x.updateHeight("On AtMentionAdded"),Qa.validSharingInfo=!0},Qa.OnCommandExecuted=function(a,b){setTimeout(function(){ya=Qa.noteEditorCtrl.getSelection(),Qa.insertOptionsCtrl.setGiphySearchText(b),Qa.openGiphyPopUp()},0)},Qa.$on("giphyPopupClosed",function(){if(ya){var a=Qa.noteEditorCtrl.getSelection();a||Qa.noteEditorCtrl.setSelection(ya,"USER"),ya=null}else Qa.noteEditorCtrl.focus()}),Qa.onHashTagAdded=function(a){},Qa.onAtMentionRemoved=function(a){for(var b in Qa.shareWith)if(Qa.shareWith[b].id===a.id){"GROUP"==Qa.shareWith[b].type&&"PROFILE"==Qa.shareWith[b].grouptype?Qa.shareWith[b].readonly=!1:Qa.shareWith.splice(b,1);break}z.IS_MENULET&&x.updateHeight("atMention Removed")},Qa.onTextSelectionRemoved=function(a){for(var b=0;b<Qa.shareWith.length;b++)if(-1==a.indexOf(Qa.shareWith[b].id)){if("GROUP"==Qa.shareWith[b].type&&"PROFILE"==Qa.shareWith[b].grouptype){Qa.shareWith[b].readonly=!1;continue}Qa.shareWith[b].readonly&&(Qa.shareWith.splice(b,1),--b)}z.IS_MENULET&&x.updateHeight("Text selection removed")},Qa.onItemAddedInToField=function(a){"ERROR"===a.type?Qa.shareWith.pop():(Qa.validSharingInfo=!0,0==Qa.Edited_Recipients&&(D.trackEvent(D.Edited_Recipients_On_First_Compose_Click),Qa.Edited_Recipients=1),z.IS_MENULET&&x.updateHeight("On onItemAddedInToField"))},Qa.onItemRemovedInToField=function(a){0==Qa.Edited_Recipients&&(D.trackEvent(D.Edited_Recipients_On_First_Compose_Click),Qa.Edited_Recipients=1),z.IS_MENULET&&x.updateHeight("On onItemRemovedInToField")},Qa.onUrlAddedInNoteEditor=function(a){var c=Qa.filesUploadManagerCtrl.initialized&&(Qa.filesUploadManagerCtrl.isBusy()||Qa.filesUploadManagerCtrl.getSuccessfullyProcessedFiles().length>0);if(0==a.prev_content_length_in_editor&&!a.link.scrybe_link&&!c){var d=b.partialToFullUrl(a.link.href);ga(d,Qa.noteEditorCtrl.getHTML())}},Qa.onEscKeyPressInToField=function(){z.IS_MENULET||Qa.onBoarding_info&&Qa.onBoarding_info.preventInlineInsertCollapse||la(c,!0)},Qa.onCancelPressed=function(){la(c,!0)},Qa.onEscKeyPressInTextEditor=function(a){z.IS_MENULET||Qa.onBoarding_info&&Qa.onBoarding_info.preventInlineInsertCollapse||la(a,!0)},Qa.onSpaceKeyPressInTextEditor=function(){Qa.noteEditorCtrl&&Qa.noteEditorCtrl.initialized?Qa.noteEditorCtrl.cleanBlackListedWords():Qa.linkCommentEditorCtrl&&Qa.linkCommentEditorCtrl.initialized&&Qa.linkCommentEditorCtrl.cleanBlackListedWords()},Qa.onEnterKeyPressInTextEditor=function(){Qa.noteEditorCtrl&&Qa.noteEditorCtrl.initialized?Qa.noteEditorCtrl.enterKeyPress():Qa.linkCommentEditorCtrl&&Qa.linkCommentEditorCtrl.initialized&&Qa.linkCommentEditorCtrl.enterKeyPress()},Qa.onTabKeyPressInTextEditor=function(){Qa.noteEditorCtrl&&Qa.noteEditorCtrl.initialized?Qa.noteEditorCtrl.tabKeyPress():Qa.linkCommentEditorCtrl&&Qa.linkCommentEditorCtrl.initialized&&Qa.linkCommentEditorCtrl.tabKeyPress()},Qa.onShiftTabPressInTextEditor=function(){z.IS_MENULET||Qa.focusNoteTitle()},Qa.isClickOnEmojiPopover=function(a){return $(".custom-emoji-popover").find(a.target||a.srcElement).length>0},Qa.cnvClickedOutsideThis=function(a){!Qa.active||z.IS_MENULET||Oa||Qa.onBoarding_info&&Qa.onBoarding_info.preventInlineInsertCollapse||Qa.isClickOnEmojiPopover(a)||ka()},Qa.onCtrlOrCmdEnterPressInTextEditor=function(){qa()},Qa.onCtrlOrCmdSavePressInTextEditor=function(){ma()},Qa.onShareBtnClick=function(){qa()},Qa.isBlankPostTooltip=function(){return S()?"":"That's a blank post"},Qa.getShareWithDropdownItems=function(a,b,c){var d=e.defer(),f=[];return"@"==b?f=Qa.mode==Ha?E.queryPublishableUsersAndGroups(a,c+Ba):E.queryPublishableUsersGroupsAndCommands(a,c+Ba,E.sources.INLINE_INSERT,null,null,!1):":"==b&&(f=E.queryEmojiData(a,Ba)),d.resolve(f),d.promise},Qa.getShareWithDropdownItemsWithoutCommands=function(a,b){var c=e.defer(),d=[],f="",g=!Qa.isGuest&&!l.shouldInviteGuestsAsFullMembers();return g&&(f=j.LIST_NAMES.NETWORK_ON_DOMAIN_CONTACTS_LIST),d=E.queryPublishableUsersAndGroups(a,b+Ba,null,f,!Qa.isGuest),c.resolve(d),c.promise},Qa.getHashtagDropdownItems=function(a){var b=e.defer();return b.resolve(s.getHashtagsDropdownItems(a,Ba)),b.promise},Qa.onItemAddedInTagField=function(a){var b=Qa.tagList||[],c="",d="";if(b.length>0){var e=b.length-1;if(d=b[e].label,c=J.clean(d.substr(1,d.length)),c.length!==d.length)if(c.length>0){c="#"+c;var f=O(Qa.tagList,c);f?b.splice(e,1):b[e].label=c}else b.splice(e,1)}D.trackEvent(D.ADDED_TAGS_TO_POST,{Via:"Compose"})},Qa.onItemRemovedInTagField=function(a){},Qa.getHashtagDropdownItems=function(a){var b=e.defer();return b.resolve(s.getHashtagsDropdownItems(a,Ba)),b.promise},Qa.openWithDetailsView=function(b){var c=!1;if(Qa.preventLocationErrorDialog=!0,pa()){var d=Ka.item.type,e=(Ka.item.resource_type,Ka.item.item_id),f=Ka.item.title;b.target.href=A(d,[{type:d,uid:e,title:f}],null,f),Qa.onEscKeyPressInTextEditor(!0)}else{var g=a;z.IS_NATIVE||(g=a.open("assets/pages/loading.html","_blank"));var h=function(){var a=Ka.item.type,b=(Ka.item.resource_type,Ka.item.item_id),c=Ka.item.title,d=A(a,[{type:a,uid:b,title:c}],null,c);z.IS_NATIVE?(Qa.onEscKeyPressInTextEditor(!0),location.href=d):(g.open(d,"_self").focus(),Qa.onEscKeyPressInTextEditor(!0))};Pa.once("draft-shared",h),ma(!0,!0),Qa.noteEditorCtrl&&Qa.noteEditorCtrl.focus(),c=!0}c&&(b.stopImmediatePropagation(),b.preventDefault())},Qa.$on("homeViewStateChange",P),Qa.$on("onLinkModeClose",function(a,b){var c=b&&b.hasOwnProperty("files");ha(),c&&setTimeout(function(){Qa.$broadcast("upload_url_as_image",b.files.map(function(a){return a.upload_from="inline-insert",a}))},0)}),Qa.$on("$destroy",function(){Qa.model={},R()}),P(),Qa.onRemoveLocation=function(){Qa.model.location=null,Qa.isLocationFetching=!1,Qa.isLocationAvailable=!1,Qa.isLocationTimeoutContinue=!1,Qa.showSpinner=!1,clearTimeout(Qa.timeout)},z.IS_MENULET&&Qa.$on("fileRemovedClicked",function(a,b){x.updateHeight("on file remove clicked")}),Qa.insertOptionsCtrl={toggleToolbar:T,onFileSelected:U,toggleTagsField:V,onLocationPinClick:W},z.IS_MENULET&&(Qa.onDummyTextAreaClick(),v.on("onDummyTextAreaClick",Qa.onDummyTextAreaClick),v.on("newPostClick",ta),v.on("shareClick",Qa.onShareBtnClick),v.on("pasteFromClipboard",Qa.pasteFromClipboard),v.on("focusMenulet",ua)),z.IS_NATIVE?wa():z.on("clientTypeUpdated",wa)}]}}]),b.module("convoApp").directive("cnvInsertAddItemOptions",["utils","UploadService","nativeHeightUpdate","config","nativeCommBridge","resourcesTabsManager",function(a,b,c,d,e,f){return{restrict:"AE",templateUrl:"inlineInsert/cnvInsertAddItemOptions.tpl.html",scope:!0,link:function(g,h,i){function j(a){if(79===a.which&&a.metaKey){var b=document.getElementById(m);b.click?b.click():h.find("div input[type=file]").trigger("click"),a.stopImmediatePropagation(),a.preventDefault()}}var k=g.$eval(i.cnvInsertAddItemOptionsCtrl),l={$self:h.find(".editor-toolbar"),active:!1,toggle:function(a){if(a.preventDefault(),d.IS_MENULET){var b=$("#mainApp").height();g.toolbarActive?b-=37:b+=37,c.updateHeight("On textToolbar toogle",0,b)}g.toolbarActive?l.hide():l.show()},hide:function(){l.$self.removeClass("pressed"),k.toggleToolbar(!1)},show:function(){l.$self.addClass("pressed"),k.toggleToolbar(!0)}};g.textToolbar=l,g.isNative=d.IS_NATIVE,k.textToolbar=l,k.resetGiphySearchText=function(){g.giphyObject={searchText:"",actionType:""}},k.onTriggerFileChooser=function(){h.find("div input[type=file]").trigger("click")};var m=a.generateUniqueCharId();h.find("div input[type=file]").attr("id",m),g.uploadAcknowledgement=function(){return d.IS_MENULET?!0:f.isHomeTabSelected()?!0:!1};var n={id:"#"+m,resourceId:"inlineInsert",dropZoneId:"body",excludeZone:Array(".chatWindow",".cnv-note-editor"),pasteZoneId:"#inline-insert-files-paste-target",uploadAcknowledgement:g.uploadAcknowledgement,excludeConversionFromProgress:!1},o=b.init(n);g.fileInputContext=o.context,o.input_element.on("cnvchange",function(a,c){c&&c.event&&(c.event==b.EVENT_FILE_SELECTED?k.onFileSelected&&k.onFileSelected(c.file):k.onChange&&k.onChange(c))}),g.$on("$destroy",function(){d.IS_MENULET&&document.removeEventListener("keydown",j,!1),g.fileInputContext&&g.fileInputContext.destroy&&(g.fileInputContext.destroy(),g.fileInputContext=null)}),d.IS_MENULET&&(fileField=h.find("input[type=file]"),fileField.on("click",function(){e.overlayStatus("true")}),fileField.on("change",function(){e.overlayStatus("false")}),document.addEventListener("keydown",j,!1)),g.toggleTagsField=k.toggleTagsField,g.onLocationPinClick=k.onLocationPinClick,g.giphyObject={searchText:"",actionType:""},k.setGiphySearchText=function(a){g.giphyObject={searchText:a,actionType:"command"}}}}}]),b.module("convoApp").directive("cnvDropzone",function(){return{restrict:"E",scope:!1,templateUrl:"inlineInsert/dropzone/cnvDropzone.tpl.html",link:function(a,b,c){var d;try{d=a.$eval(c.dropzoneId)}catch(e){d=c.dropzoneId}finally{d||(d=c.dropzoneId)}$(b).find(".dropzone-target").attr("id",d)},controller:["$scope",function(a){function b(){var b="";return b=a.dropzoneCtrl&&a.dropzoneCtrl.message?a.dropzoneCtrl.message:"Drop files here"}function c(){var b="";return b=a.dropzoneCtrl&&a.dropzoneCtrl.messageClasses?a.dropzoneCtrl.messageClasses:""}a.activated=!1,a.expand=!1,a.$on("cnv-drag-start",function(d,e){a.dropzoneMessage=b(),a.messageClass=c(),a.activated=!0,a.expand=!0,a.$apply(a.expand)}),a.$on("cnv-drag-end",function(b,c){a.activated=!0,a.expand=!1,a.$apply(a.expand)}),a.$on("fileSelected",function(b,c){a.activated=!0,a.expand=!1,a.$apply(a.expand)})}]}}),b.module("convoApp").directive("cnvShareLink",function(){return{restrict:"A",templateUrl:"inlineInsert/shareLink/cnvShareLink.tpl.html",scope:{data:"=cnvLinkResolverCtrl",disableLinkEditingOptions:"@disableLinkEditingOptions"},link:function(a,b,c){var d=a;d.editTitle=function(a){if("true"!=d.disableLinkEditingOptions){d.editTitleMode=!0;var b=$(a.target).closest(".link-info");setTimeout(function(){b.find("textarea.title").focus().select()},0)}},d.editDesc=function(a){"true"!=d.disableLinkEditingOptions&&(d.editDescMode||(d.editDescMode=!0,d.shareLinktextEditorCtrl&&d.shareLinktextEditorCtrl.enable(!0)))},d.onBlur=function(a){-1!=a.target.className.indexOf("title")&&(d.editTitleMode=!1)}},controller:["$scope","itemService","nativeHeightUpdate","config","utils",function(a,b,c,d,e){function f(){
m.data.initialized=!0,m.url=e.removeTags(m.data.url),m.state=a.LINK_STATE_PROCESSING,b.getLink(a.url).success(g).error(h),"inline-insert"===m.data.source&&"File"!=e.getFileFormat(a.url.substr(a.url.lastIndexOf(".")).slice(1))?m.hideProcessingState=!0:m.hideProcessingState=!1}function g(b,f){if(m.hideProcessingState=!1,b&&200==f)if(b.hasOwnProperty("data")){var g=b.data,j={url:a.url,name:g.name,type:g.extension},k=[j];i({files:k})}else{if(!m.data.data_pre_computed&&(b.favicon_url_encoded=d.AWS_FILE_DIR_BASE+b.favicon_url_encoded,b.images_urls_encoded))for(var l=0;l<b.images_urls_encoded.length;l++)b.images_urls_encoded[l]=d.AWS_FILE_DIR_BASE+b.images_urls_encoded[l];m.state=m.LINK_RESOLVE_STATE_SUCCESS,m.data=b,m.shareLinktextEditorCtrl={initialized:!1,height:{min:"auto",max:67},prevent_focus_on_load:!0},m.data&&m.data.preview_text&&(m.shareLinktextEditorCtrl.initialHtmlText=m.data.preview_text.substring(0,140)),m.data.domain=e.getDomainNameFromUrl(m.data.url);var n=m.data.images_urls_encoded;for(var o in n)n[o]||delete n[o];if(n){var p=Object.keys(n).length;p&&(m.thumbnails=n,m.data.selectedIndex=Object.keys(n)[0],p>=2&&"true"!=m.disableLinkEditingOptions&&(m.navigation=!0,m.prevNavigation=!1))}m.$emit("cnvShareLink:renderingComplete",{title:b.title,url:b.url,previewText:b.preview_text,faviconUrl:b.favicon_url_encoded,originalThumbnailUrl:b.images_urls_encoded&&b.images_urls_encoded.length>0?b.images_urls_encoded[0]:null,domain:b.domain}),d.IS_MENULET&&c.updateHeight("cnvShareLink onLinkResolveSuccess"),m.$emit("linkResolveCtrl_completed",{})}else h()}function h(){m.hideProcessingState=!1,a.state=a.LINK_RESOLVE_STATE_FAILED,m.data={},m.data.url=a.url,m.data.domain=e.getDomainNameFromUrl(m.data.url),m.data.title=m.data.domain.toLowerCase(),m.data.favicon_url="",m.data.favicon_url_encoded="",m.data.images_urls=[],m.data.images_urls_encoded=[],m.data.preview_text="",m.$emit("linkResolveCtrl_completed",{}),d.IS_MENULET&&c.updateHeight("cnvShareLink onLinkResolveError")}function i(b){a.$emit("onLinkModeClose",b||{}),d.IS_MENULET&&c.updateHeight("cnvShareLink onRemove")}function j(a){var b=new URI(a),c=new URI(a);return c=c.resolve(b),c.toString()}function k(){var a=Object.keys(m.thumbnails),b=a.indexOf(m.data.selectedIndex);b>0&&(m.data.selectedIndex=a[--b],m.nextNavigation=!0,m.prevNavigation=!0),0>=b&&(m.prevNavigation=!1),d.IS_MENULET&&c.updateHeight("cnvShareLink onShowPrevIcon")}function l(){var a=Object.keys(m.thumbnails),b=a.indexOf(m.data.selectedIndex);b<a.length-1&&(m.data.selectedIndex=a[++b],m.nextNavigation=!0,m.prevNavigation=!0),b>=a.length-1&&(m.nextNavigation=!1),d.IS_MENULET&&c.updateHeight("cnvShareLink onShowNextIcon")}var m=a;m.LINK_STATE_PROCESSING="lspg",m.LINK_RESOLVE_STATE_SUCCESS="lrss",m.LINK_RESOLVE_STATE_FAILED="lrsf",m.remove=i,m.relativeToAbsolute=j,m.showPrevIcon=k,m.showNextIcon=l,m.navigation=!1,m.nextNavigation=!0,m.prevNavigation=!0,"true"==m.disableLinkEditingOptions?m.descPlaceholder="":m.descPlaceholder="Write some description",m.editTitleMode=!1,m.editDescMode=!1,m.data.isBusy=function(){return m.state!=m.LINK_RESOLVE_STATE_SUCCESS&&m.state!=m.LINK_RESOLVE_STATE_FAILED},m.data.getData=function(){return m.data.preview_text=m.shareLinktextEditorCtrl&&m.shareLinktextEditorCtrl.initialized&&m.shareLinktextEditorCtrl.getEditorHtmlText()||"",m.data},m.data.reloadLink=function(a){m.data.url=a,f()},m.data.data_pre_computed?g(m.data,200):f()}]}}),b.module("convoApp").factory("appearinVideoCallService",["config",function(a){var b,c={},d=function(){var a=new AppearIn;return a.isWebRtcCompatible()},e=function(){b||(b=new AppearIn);var c=b.getRandomRoomName().then(function(b){var c=b.split("/")[1],d={directLink:a.APPEARIN_VIDEO_CALL_DIRECT_LINK_PREFIX+c,roomName:c};return d});return c};return c.generateAppearinVideoCallLink=e,c.isWebRtcCompatible=d,c}]),b.module("convoApp").directive("cnvBoxFilesIntegrator",[function(){return{restrict:"A",scope:{fileInputServiceContext:"=cnvFileInputServiceContext"},controller:["$scope","utils","$filter","UploadService","nativeCommBridge","config",function(a,b,c,d,e,f){function g(e){for(var f in e){var g={};h(e[f].link,g,function(a,b,c){a&&(c.localUrl=b)}),g.name=e[f].name,g.size=e[f].bytes?e[f].bytes:1,g.fileExt=e[f].name.substr(e[f].name.lastIndexOf(".")+1).toLowerCase(),g.type=g.fileExt,g.fileId=b.generateGuid(),g.fileUploadName=g.fileId+"."+g.type,g.source=e[f].source,g.file_url=e[f].link,g.localUrl=c("getFileIconByType")(g.type,32),g.status=d.FILE_STATUS_WAITING,a.fileInputServiceContext.event_dispacher.dispach({event:d.EVENT_FILE_SELECTED,file:g}),d.fileConversionReq(a.fileInputServiceContext,g)}}function h(a,b,c){var d=new Image;d.onload=function(){c(!0,a,b)},d.onerror=function(){c(!1)},d.src=a}a.initializeBox=function(){var b="addpyhjq1e097z9o4qcg47hmvanbhj1m",c={clientId:b,linkType:"direct",multiselect:!0},d=new BoxSelect(c);d.isBrowserSupported()&&(a.$emit("showOverlay",["Box"]),f.IS_MENULET&&e.overlayStatus("true"),d.success(function(b){var c=[];for(var h in b){var i={};i.source="BOX",i.link=b[h].url,i.bytes=b[h].size,i.name=b[h].name,c.push(i)}g(c),d.unregister(d.SUCCESS_EVENT_TYPE),d.unregister(d.CANCEL_EVENT_TYPE),d=null,a.$emit("removeOverlay"),f.IS_MENULET&&e.overlayStatus("false")}),d.cancel(function(){d.unregister(d.SUCCESS_EVENT_TYPE),d.unregister(d.CANCEL_EVENT_TYPE),d=null,a.$emit("removeOverlay"),f.IS_MENULET&&e.overlayStatus("false")}),d.launchPopup())}}],link:function(a,b,c){b.bind("click",function(b){a.initializeBox()})}}}]),b.module("convoApp").directive("cnvDropBoxFilesIntegrator",[function(){return{restrict:"A",scope:{fileInputServiceContext:"=cnvFileInputServiceContext"},controller:["$scope","utils","$filter","UploadService","nativeCommBridge","config",function(a,b,c,d,e,f){function g(e){for(var f in e){var g={};h(e[f].link,g,function(a,b,c){a&&(c.localUrl=b)}),g.name=e[f].name,g.size=e[f].bytes?e[f].bytes:1,g.fileExt=e[f].name.substr(e[f].name.lastIndexOf(".")+1).toLowerCase(),g.type=g.fileExt,g.fileId=b.generateGuid(),g.fileUploadName=g.fileId+"."+g.type,g.source=e[f].source,g.file_url=e[f].link,g.localUrl=c("getFileIconByType")(g.type,32),g.status=d.FILE_STATUS_WAITING,a.fileInputServiceContext.event_dispacher.dispach({event:d.EVENT_FILE_SELECTED,file:g}),d.fileConversionReq(a.fileInputServiceContext,g)}}function h(a,b,c){var d=new Image;d.onload=function(){c(!0,a,b)},d.onerror=function(){c(!1)},d.src=a}a.initializeDropBox=function(){if(Dropbox.isBrowserSupported()){a.$emit("showOverlay",["Dropbox"]),f.IS_MENULET&&e.overlayStatus("true");var b={success:function(b){var c=[];for(var d in b){var h={};h.source="DROPBOX",h.name=b[d].name,h.link=b[d].link,h.bytes=b[d].bytes,c.push(h)}g(c),a.$emit("removeOverlay"),f.IS_MENULET&&e.overlayStatus("false")},cancel:function(){a.$emit("removeOverlay"),f.IS_MENULET&&e.overlayStatus("false")},linkType:"direct",multiselect:!0};Dropbox.choose(b)}}}],link:function(a,b,c){b.bind("click",function(b){a.initializeDropBox()})}}}]),b.module("convoApp").directive("cnvEmoji",["$http","$compile","utils","emojiDataService","$rootScope","mixpanelService","$window",function(b,c,d,e,f,g,h){function i(){return _.debounce(function(a){a.searchEmojiText&&g.trackEvent(g.SEARCH_EMOJI,{Source:a.mixpanelSource,"Search Term":a.searchEmojiText})},500)}function k(){return _.debounce(function(a){var b=$(".cnv-emoji-container");b.length>0&&e.setScrollPosition(b.scrollTop())},500)}return{scope:!0,templateUrl:"integrations/emoji/cnvEmoji.tpl.html",link:function(b,g,l){function m(){}function n(){$(".popover."+b.sourceId).length>0&&("top"===b._positionString?setTimeout(function(){$(".popover."+b.sourceId).css("top",$("#"+b.sourceId).offset().top-332+"px")},0):"bottom"===b._positionString?setTimeout(function(){$(".popover."+b.sourceId).css("top",$("#"+b.sourceId).offset().top+20.7+"px")},0):("left"===b._positionString||"right"===b._positionString)&&setTimeout(function(){$(".popover."+b.sourceId).css("top",$("#"+b.sourceId).offset().top-166+8+"px")},0))}b.cnvEmojiScope=new m;var o,p=l.cnvChatWindowIdForEmoji,q=e.getParsedEmojiData(),r=i(),s=k(),t=[],u={};b.selected=-1,b.searchingEmojis=!1,b.clearSearchButton=!1,b.mixpanelSource=p,q.then(function(a){b.emojis=a[0],b.frequent=a[1],b.categories_toolbar_append_text="",b.emoji_popover_append_text=[],b.searchedEmojis_append_text="";var d=e.GetFrequentEmojisFromServer();d.then(function(a){console.log("aa :"+a);var d=b.updateFrequentlyUsedElements(),e=c(d)(b);$(".emoji-category:contains('Frequently')").find(".emoji-list").html(e)},function(){}),b.generateFrequentlyUsed(),b.generateAllEmojis(),b.generateCategoryToolbar(),b.viewFrequentlyUsed(),b.viewAllEmojis(function(){o=$(g[0].querySelectorAll(".emoji-category"));for(var a=0,b=o.length;b>a;a++)t.push(o[a].offsetTop-52)}),b.viewCategoryToolbar(),g.find(".cnv-emoji-container").scrollTop(b.scrollPosition)},function(){}),g.find(".cnv-emoji-container").on({mousewheel:function(a,c){this.scrollTop-=c*a.deltaFactor,s(b),a.preventDefault(),a.stopPropagation()}}),"Chat"===l.cnvChatWindowIdForEmoji||$(a).on("mousewheel",n),b.generateFrequentlyUsed=function(){var a=e.getShowImageEmojiesList();for(b.frequent_append_text="",b.categories_toolbar_append_text+="<li class="+b.frequent["Frequently Used"].category+'-icon ng-click="select(0)" ng-class="{selected:0 == selected}"></li>',b.frequent_append_text+='<li class="emoji-category"> <div class="category-label">'+b.frequent["Frequently Used"].category+'</div><div class="category-label2" >'+b.frequent["Frequently Used"].category+'</div> <ul class="emoji-list">',j=0;j<b.frequent["Frequently Used"].emojisList.length;j++)d.isOsX()&&a.indexOf(b.frequent["Frequently Used"].emojisList[j].name)>=0?b.frequent_append_text+='<li class="emoji-item"><div title="'+b.frequent["Frequently Used"].emojisList[j].title+'"ng-click="onEmojiClick(\''+b.frequent["Frequently Used"].emojisList[j].unicode+"','"+b.frequent["Frequently Used"].emojisList[j].short_name+"')\"style='height:31px;'><div class='emoji_div' style='background-position: "+23*-b.frequent["Frequently Used"].emojisList[j].sheet_x+"px "+(23*-b.frequent["Frequently Used"].emojisList[j].sheet_y-1)+"px'> </div></div></li>":b.frequent_append_text+='<li class="emoji-item"><div title="'+b.frequent["Frequently Used"].emojisList[j].title+'"ng-click="onEmojiClick(\''+b.frequent["Frequently Used"].emojisList[j].unicode+"','"+b.frequent["Frequently Used"].emojisList[j].short_name+"')\"> "+b.frequent["Frequently Used"].emojisList[j].unicode+"</div></li>";b.frequent_append_text+='</ul><div class="category-label-bottom">'+b.frequent["Frequently Used"].category+"</div></li>"},b.updateFrequentlyUsedElements=function(){var a=e.getShowImageEmojiesList(),c="";for(j=0;j<b.frequent["Frequently Used"].emojisList.length;j++)c+=d.isOsX()&&a.indexOf(b.frequent["Frequently Used"].emojisList[j].name)>=0?'<li class="emoji-item"><div title="'+b.frequent["Frequently Used"].emojisList[j].title+'"ng-click="onEmojiClick(\''+b.frequent["Frequently Used"].emojisList[j].unicode+"','"+b.frequent["Frequently Used"].emojisList[j].short_name+"')\"style='height:31px;'><div class='emoji_div' style='background-position: "+23*-b.frequent["Frequently Used"].emojisList[j].sheet_x+"px "+(23*-b.frequent["Frequently Used"].emojisList[j].sheet_y-1)+"px'> </div></div></li>":'<li class="emoji-item"><div title="'+b.frequent["Frequently Used"].emojisList[j].title+'"ng-click="onEmojiClick(\''+b.frequent["Frequently Used"].emojisList[j].unicode+"','"+b.frequent["Frequently Used"].emojisList[j].short_name+"')\"> "+b.frequent["Frequently Used"].emojisList[j].unicode+"</div></li>";return c},b.viewFrequentlyUsed=function(){setTimeout(function(){var a=c(b.frequent_append_text)(b);$(g[0].querySelector(".emoji-categories-list")).append(a)},0)},b.generateAllEmojis=function(){var a=e.getEmojisHtmlFromStore();if(a)return void(b.emoji_popover_append_text=a);for(var c,f=e.getShowImageEmojiesList(),g=0;g<b.emojis.length;g++){c='<li class="emoji-category"> <div class="category-label">'+b.emojis[g].category+'</div><div class="category-label2">'+b.emojis[g].category+'</div> <ul class="emoji-list">';for(var h=0;h<b.emojis[g].emojisList.length;h++)c+=d.isOsX()&&f.indexOf(b.emojis[g].emojisList[h].name)>=0?'<li class="emoji-item"><div title="'+b.emojis[g].emojisList[h].title+'"onclick="onEmojiClick(\''+b.emojis[g].emojisList[h].unicode+"','"+b.emojis[g].emojisList[h].short_name+"')\" style='height:31px;'> <div class='emoji_div' style='background-position: "+23*-b.emojis[g].emojisList[h].sheet_x+"px "+(23*-b.emojis[g].emojisList[h].sheet_y-1)+"px'> </div></div></li>":'<li class="emoji-item"><div title="'+b.emojis[g].emojisList[h].title+'"onclick="onEmojiClick(\''+b.emojis[g].emojisList[h].unicode+"','"+b.emojis[g].emojisList[h].short_name+"')\"> "+b.emojis[g].emojisList[h].unicode+"</div></li>";c+='</ul><div class="category-label-bottom">'+b.emojis[g].category+"</div></li>",b.emoji_popover_append_text.push(c)}e.storeEmojisHtml(b.emoji_popover_append_text)},b.viewAllEmojis=function(a){setTimeout(function(){var c=$(g[0].querySelector(".emoji-categories-list"));c.append(b.emoji_popover_append_text[0]),setTimeout(function(){c.append(b.emoji_popover_append_text[1]),setTimeout(function(){c.append(b.emoji_popover_append_text[2]),setTimeout(function(){for(var d=3;d<b.emoji_popover_append_text.length;d++)c.append(b.emoji_popover_append_text[d]);a&&a()},10)},10)},10)},0)},b.generateCategoryToolbar=function(){for(var a=0;a<b.emojis.length;a++)b.categories_toolbar_append_text+="<li class="+b.emojis[a].category+'-icon ng-click="select('+(a+1)+')" ng-class="{selected:'+(a+1)+' == selected}"></li>'},b.viewCategoryToolbar=function(){var a=c(b.categories_toolbar_append_text)(b);$(g[0].querySelector(".categorires-icon-list")).append(a)},g.find(".cnv-emoji-container").on({scroll:function(a){if(!b.searchingEmojis){var c=this.scrollTop;_.each(o,function(a,d){var e=(a.querySelector(".category-label"),a.querySelector(".category-label2")),f=a.querySelector(".category-label-bottom");c+51>=a.offsetTop?(b.selected=d,f.offsetTop<=c+52?(e.style.display="none",f.style.visibility="visible"):(e.style.display="block",f.style.visibility="hidden")):c-52<=a.offsetTop&&(e.style.display="none",f.style.visibility="hidden"),c-52<f.offsetTop})}s(b),b.$$phase||b.$digest()}}),b.select=function(a){b.selected=a,console.log("clicked");var c=g.find(".cnv-emoji-container");c.animate({scrollTop:t[a]+1},400),event.stopPropagation()},b.searchChanged=function(){b.searchingEmojis=!0,b.searchEmojiText=g[0].querySelector(".cnv-emoji-search-field").value.trim(),""!=b.searchEmojiText?(b.clearSearchButton=!0,b.selected=-1):(b.clearSearchButton=!1,b.searchingEmojis=!1,b.selected=0),b.seachEmojis(b.searchEmojiText),r(b)},g.find(".cnv-emoji-search-field").on("focus",function(){var a=$(this);setTimeout(function(){a.select()},0)}).focus(),g.find(".cnv-emoji-search-field").on("mouseup",function(a){a.stopPropagation()}),g.find(".cnv-emoji-popout-inner").on("click",function(a){a.preventDefault(),a.stopPropagation()}),b.clearSearch=function(){g[0].querySelector(".cnv-emoji-search-field").value="",b.clearSearchButton=!1,b.searchingEmojis=!1,b.seachEmojis($(g[0].querySelector(".cnv-emoji-search-field").value).selector)},b.seachEmojis=function(a){u=e.searchingEmojis(a);var f=e.getShowImageEmojiesList();for(b.searchedEmojis_append_text="",b.searchedEmojis_append_text+='<li class="emoji-category"> <ul class="emoji-list">',0===u.length&&(b.searchedEmojis_append_text+='<li class="emoji-item-not-found"> No emoji found </li>'),j=0;j<u.length;j++)d.isOsX()&&f.indexOf(u[j].emoji.name)>=0?b.searchedEmojis_append_text+='<li class="emoji-item"><div title="'+u[j].emoji.title+'"ng-click="onEmojiClick(\''+u[j].emoji.unicode+"','"+u[j].emoji.short_name+"')\" style='height:31px;'><div class='emoji_div' style='background-position: "+23*-u[j].emoji.sheet_x+"px "+(23*-u[j].emoji.sheet_y-1)+"px'> </div></div></li>":b.searchedEmojis_append_text+='<li class="emoji-item"><div title="'+u[j].emoji.title+'"ng-click="onEmojiClick(\''+u[j].emoji.unicode+"','"+u[j].emoji.short_name+"')\"> "+u[j].emoji.unicode+"</div></li>";if(b.searchedEmojis_append_text+="</ul></li>",a.length>0){var h=c(b.searchedEmojis_append_text)(b);$(g[0].querySelector("#current-category-label")).html(""),$(g[0].querySelector(".emoji-categories-list")).html(""),$(g[0].querySelector(".emoji-categories-list")).append(h)}else $(g[0].querySelector(".emoji-categories-list")).html(""),b.viewFrequentlyUsed(),b.viewAllEmojis(function(){o=$(g[0].querySelectorAll(".emoji-category")),g.find(".cnv-emoji-container").trigger("scroll")}),b.searchingEmojis=!1,b.selected=0},f.$broadcast("cnvEmoji::emojiPopupOpened",g[0].id),b.$on("$destroy",function(){var b=$(".cnv-emoji-container");b.length>0&&e.setScrollPosition(b.scrollTop()),"Chat"===l.cnvChatWindowIdForEmoji||$(a).off("mousewheel",n),h.onEmojiClick=null}),h.onEmojiClick=b.onEmojiClick},controller:["$scope","$element",function(a,b){function c(){var b="";return b="noteEditorCtrl"===a.editorName?a.noteEditorCtrl:a.textEditorCtrl}a.onEmojiClick=function(b,d){g.trackEvent(g.SEND_EMOJI,{Source:a.mixpanelSource,"Emoji Type":":"+d+":"});var f=c();f&&f.initialized?(f.emoji.focus(),f.emoji.set(b)):a.commentEditorCtrl?a.commentEditorCtrl.activate(b):a.onEmojiSelected?a.onEmojiSelected(b):console.error("No editor initialized"),a.hidePopover(),a.frequent=e.updateFrequentEmojiData(d)}}]}}]),b.module("convoApp").directive("cnvEmojiPopover",["emojiDataService","$position","$rootScope","utils","mixpanelService","$window","config",function(b,c,d,e,f,g,h){return{scope:!0,replace:!0,template:function(){return"<div class='emoji-action-container' id='{{::sourceId}}'><div class='emoji-popup-btn unselected' popover-trigger=\"showEmojiPopover click\" popover-template='emojiPopover' popover-class='custom-emoji-popover {{::sourceId}}' popover-placement='{{_positionString}}' ng-class='cnvEmojiIconClass' popover-append-to-body='true'></div></div>"},link:function(i,j,k){function l(){}function m(){i.$apply(function(){i._positionString=u(j,!1)})}function n(a){var c=a.target,d=$(".popover."+i.sourceId);if(d.length>0&&!d[0].contains(c)&&!c.classList.contains("emoji-popup-btn")){var e=$(".cnv-emoji-container");e.length>0&&t&&(b.setScrollPosition(e.scrollTop()),j.find(".emoji-popup-btn").trigger("hideEmojiPopover"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.add("unselected"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("clicked"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("emoji-hover-icon-thick-"+r)),t=!1}}function o(a,c,d){"true"===i.emojiFixedOnScroll&&$(".popover."+i.sourceId).css("z-index","101"),i.sourceId===j[0].getAttribute("id")&&(i.scrollPosition=b.getScrollPosition())}i.__emoji_leak=new l;var p,q,r,s,t=!1;i.sourceId=e.generateUniqueCharId(),i.emojiPopover="integrations/emoji/cnvEmojiPopover.tpl.html",i.emojiFixedOnScroll=k.cnvEmojiFixedOnScroll,i.editorName=k.cnvEditorCtrl,"true"===i.emojiFixedOnScroll?i.mixpanelSource="Chat":i.mixpanelSource="Comment",d.positionElements=d.positionElements||c.positionElements,c.positionElements=function(a,b,e,f){return a.parent()[0].id===i.sourceId?q=u(a,!0):d.positionElements.apply(c,arguments)};b.getParsedEmojiData();i.hidePopover=function(){var a=$(".cnv-emoji-container");a.length>0&&(b.setScrollPosition(a.scrollTop()),j[0].id==i.sourceId&&(j.find(".emoji-popup-btn").trigger("hideEmojiPopover").trigger("setFocusOnHideEmojiPopover"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.add("unselected"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("clicked"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("emoji-hover-icon-thick-"+r))),t=!1},$(".emoji-popup-btn",j).hover(function(){if(!$(this)[0].classList.contains("clicked")){if(!$(this)[0].classList.contains("hover")){var a=Math.floor(10*Math.random()+1);r=a.toString(),1===r.length&&(r="0"+r)}$(this).addClass("emoji-hover-icon-thick-"+r),$(this).removeClass("unselected")}$(this).addClass("hover")},function(){$(this)[0].classList.contains("clicked")||($(this).removeClass("emoji-hover-icon-thick-"+r),$(this).addClass("unselected")),$(this).removeClass("hover")}),i.$on("miniChatWin",function(a,b){i.hidePopover()}),i.$on("maxChatWin",function(a,b){i.hidePopover()}),i.$on("closeChatEmojiPopover",function(a,b){j.parents(".chatWindow").length>0&&i.hidePopover()});var u=function(b,c){function d(a){return r>=a.top&&(a.top=r),o>=a.left&&(a.left=o),q<=a.left+l&&(a.left-=a.left+l-q+5,p=j.offset().left-a.left+8),n<=a.top+k&&(a.top-=a.top+k-n+5),a}var e,f,g,i,k,l,m,n,o,q,r,s,t,u,v,w,x,y,z;return w=function(a){return r<a.top&&o<a.left&&q>a.left+l&&n>a.top+k},g=b,y=$.extend({},g.offset(),{width:b.width(),height:b.height()}),l=352,k=332,r=$(document).scrollTop(),o=$(document).scrollLeft(),q=o+$(a).width(),n=r+$(a).height(),s={top:y.top-k,left:y.left+y.width/2-l/2},h.IS_MENULET&&(s={top:y.top-k+1,left:y.left+y.width/2-l/2}),t={top:y.top+y.height+2,left:y.left+y.width/2-l/2},u={top:y.top+y.height/2-k/2,left:y.left-l-4},v={top:y.top+y.height/2-k/2,left:y.left+y.width-5},i=w(s),m=w(t),x=w(u),z=w(v),i||m||x||z?p="50%":(s=d(s),i=w(s),i||(t=d(t),m=w(t),m||(u=d(u),x=w(u),x||(v=d(v),z=w(v))))),i?(e="top",f=s):m?(e="bottom",f=t):x?(e="left",f=u):z?(e="right",f=v):e="none",c?f:e};i.$on("cnvEventBinding::keyup::ESCAPE",function(a,c){var d=$(".popover."+i.sourceId);if(d.length>0){var e=$(".cnv-emoji-container");e.length>0&&(b.setScrollPosition(e.scrollTop()),j[0].id==i.sourceId&&(j.find(".emoji-popup-btn").trigger("hideEmojiPopover"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.add("unselected"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("clicked"),j.find(".emoji-hover-icon-thick-"+r)[0].classList.remove("emoji-hover-icon-thick-"+r),t=!1))}}),i.$on("cnvEventBinding::click",function(c,d){var e=$(".popover."+i.sourceId);if(e.length>0)if(e[0].contains(d)||j[0].contains(d)){if(d.classList.contains("emoji-popup-btn")){var g=$(".cnv-emoji-container");g.length>0&&t?(t=!1,b.setScrollPosition(g.scrollTop()),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.add("unselected"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("clicked"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("emoji-hover-icon-thick-"+r)):($(".popover.top > .arrow").css("left",p||"50%"),t=!0,f.trackEvent(f.CLICK_EMOJI_BUTTON,{Source:i.mixpanelSource}),setTimeout(function(){d.classList.contains("unselected")&&d.classList.remove("unselected"),(d.classList.contains("hover")||!d.classList.contains("emoji-hover-icon-thick-"+r))&&d.classList.add("emoji-hover-icon-thick-"+r),d.classList.add("clicked")},0));var h=$(".popover").css("left"),k=+h.slice(0,h.length-2),l=k+$(".popover").width(),m=$(a).width()-10;l>m&&$(".popover").css({left:"auto",right:"10px"})}}else{var g=$(".cnv-emoji-container");g.length>0&&t&&(b.setScrollPosition(g.scrollTop()),j[0].id==i.sourceId&&(j.find(".emoji-popup-btn").trigger("hideEmojiPopover"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.add("unselected"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("clicked"),j.find(".emoji-popup-btn.emoji-hover-icon-thick-"+r)[0].classList.remove("emoji-hover-icon-thick-"+r))),t=!1}}),$(".emoji-action-container").on("mouseenter",m),g.addEventListener("mousedown",n,!0),i.$on("$destroy",function(){var a=$(".cnv-emoji-container");a.length>0&&b.setScrollPosition(a.scrollTop()),$(".emoji-action-container").off("mouseenter",m),$(".emoji-popup-btn",j).off("mouseenter mouseleave"),t=!1,g.removeEventListener("mousedown",n,!0),s(),s=null,c.positionElements=d.positionElements}),s=d.$on("cnvEmoji::emojiPopupOpened",o)}}}]),b.module("convoApp").factory("emojiDataService",["$http","ServerComm","$q","config","mixpanelService","appTabs","utils",function(a,b,c,d,e,f,g){function h(){return M}function j(){m();var a=d.IS_MENULET?"../assets/":"assets/";k(a+"vendor/emoji-data/sheet_apple_64.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-01_36x36.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-01_36x36.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-02_36x36.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-03_36x36.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-04_36x36.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-05(2)_36x36.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-09_36x36.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-11_36x36.png"),k(a+"img/Emoji-icons/Selected/2x/selected_emoji_icons-10_36x36.png")}function k(a){N.push(l(a))}function l(a){var b=new Image;return b.src=a,b}function m(){function e(){f.success(function(a){a=r(a,"sort_order"),emojiRaw=a,z=[],B=[];var b,c,d,e={};for(b=0,c=a.length;c>b;b++)if(d=a[b],null!==d.category){if(!(d.category in e)){var f;switch(d.category){case"Frequently Used":f=1;break;case"People":f=2;break;case"Nature":f=3;break;case"Food":f=4;break;case"Celebration":f=5;break;case"Activity":f=6;break;case"Places":f=7;break;case"Symbols":f=8}e[d.category]={category:d.category,emojisList:[],categoryOrder:f},z.push(e[d.category])}if(z=r(z,"categoryOrder"),-1===d.unified.indexOf("-")){d.unicode=q(d.unified),d.name=d.name.toLowerCase(),d.name=d.name.charAt(0).toUpperCase()+d.name.slice(1);var h={name:d.name,unified:d.unified,variations:d.variations,short_name:d.short_name,short_names:d.short_names,category:d.category,sort_order:d.sort_order,unicode:d.unicode,sheet_x:d.sheet_x,sheet_y:d.sheet_y},i=h.name;_.each(h.short_names,function(a){i+=" :"+a+":"}),h.title=i;var j="";_.each(h.short_names,function(a){j=M.indexOf(h.name)>=0&&g.isOsX()?"<div class='emojiMenton'><div class='emoji_div' style='background-position: "+32*-h.sheet_x+"px "+(32*-h.sheet_y-1)+"px'> </div></div>":"<div class='emojiMenton'>"+h.unicode+"</div>",K[a]={short_name:a,emoji:h,formatteddesclabel:h.title,formattedlabel:":"+a+":",type:"EMOJI",label:":"+a+":",render:j,unicode:h.unicode}}),e[d.category].emojisList.push(h)}}if(D=!1,F=!0,I["Frequently Used"]={category:"Frequently Used",emojisList:[],categoryOrder:1},A){for(var b=0;b<A.length;b++)A[b]=A[b].substring(1,A[b].length-1);p()}B.push(z),B.push(I),C.resolve(B)})}if(D)return C.promise;if(F&&G)return C.promise;C=c.defer(),E=!0,b.getx("emoji").then(function(a){A=a.data.EMOJI_HISTORY,A&&(A=A.split(",")),G=!0,e()},function(){})["finally"](function(){E=!1});var f=a.get(d.APP_BASE_URL+"assets/vendor/emoji-data/emoji.json");return D=!0,C.promise}function n(a){var b=_.filter(K,function(b){return-1!=b.emoji.title.toLowerCase().indexOf(a.toLowerCase())});if(a.length>0){for(var c=0;c<b.length;c++){var d=b[c].emoji.title,e=new RegExp("("+a+")|(([\\s,:]|^) ("+a+"))","gi");for(match=e.exec(d),b[c].searchPriority=0;null!=match;)0===match.index&&(b[c].searchPriority=1),console.log(match.index),match=e.exec(d)}b.sort(function(a,b){return a.searchPriority>b.searchPriority?-1:a.searchPriority<b.searchPriority?1:a.formatteddesclabel<b.formatteddesclabel?-1:a.formatteddesclabel>b.formatteddesclabel?1:0})}return _.uniq(b,function(a,b){return a.emoji})}function o(a,b){b||(b=O);var c=[];if(a.length<2)return c;var d=g.getUserGroupSearchRegex(a),e=Object.keys(K);if(e.sort(),""==a&&A)for(i=0;i<A.length&&c.length!=b;i++)K[A[i]].formattedlabel="<b>:</b>"+K[A[i]].short_name+":",c.push(K[A[i]]);for(i=0;i<e.length&&c.length!=b;i++){var f=K[e[i]].short_name.substr(0,a.length);f.toLowerCase()==a.toLowerCase()&&(K[e[i]].formattedlabel="<b>:</b>"+K[e[i]].short_name.replace(d,"$1<b>$3</b>")+":",c.push(K[e[i]]))}return c}function p(){for(var a=0;a<A.length;a++)A[a]&&K[A[a].toString()]&&I["Frequently Used"].emojisList.push(K[A[a].toString()].emoji)}function q(a){var b=a.split("-").map(function(a,b){return parseInt(a,16)});return String.fromCodePoint||!function(){var a=function(){var a;try{var b={},c=Object.defineProperty;a=c(b,b,b)&&c}catch(d){}return a}(),b=String.fromCharCode,c=Math.floor,d=function(){var a,d,e=16384,f=[],g=-1,h=arguments.length;if(!h)return"";for(var i="";++g<h;){var j=Number(arguments[g]);if(!isFinite(j)||0>j||j>1114111||c(j)!=j)throw RangeError("Invalid code point: "+j);65535>=j?f.push(j):(j-=65536,a=(j>>10)+55296,d=j%1024+56320,f.push(a,d)),(g+1==h||f.length>e)&&(i+=b.apply(null,f),f.length=0)}return i};a?a(String,"fromCodePoint",{value:d,configurable:!0,writable:!0}):String.fromCodePoint=d}(),String.fromCodePoint.apply(null,b)}function r(a,b){return a.sort(function(a,c){var d=a[b],e=c[b];return e>d?-1:d>e?1:0})}function s(a){var c={method:"add",emoji:":"+a+":"},d=b.postx("emoji",c);return d.then(function(a){if(A=a.data.data.split(","),E=!1,G=!0,I["Frequently Used"]={category:"Frequently Used",emojisList:[],categoryOrder:1},A){for(var b=0;b<A.length;b++)A[b]=A[b].substring(1,A[b].length-1);p()}return f.dispatchTabsEvent2("emojiDataService::onFrequentUpdate",I),I}),I}function t(a,b){var c=jQuery.parseHTML(a),d="";if(c)for(var e=0;e<c.length;e++)c[e]=u(c[e],b),d+=c[e].outerHTML;return d}function u(a,b){for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];3==d.nodeType?d.textContent=v(d.textContent,b):d=u(d,b),a.childNodes[c]=d}return a}function v(a,b){var c=new RegExp(":[a-z_0-9]+:|(\\s)(\\(y\\)|O_O|o_o|-.-|<3|&lt;3|</3|&lt;/3|8\\)|D:|:'\\(|:&apos;\\(|:o\\)|:\\*|:\\-\\*|=\\)|=\\-\\)|:D|:\\-D|;\\)|;\\-\\)|:>|:&gt;|:\\->|:\\-&gt;|:\\||:\\-\\||:o|:\\-o|>:\\(|&gt;:\\(|>:\\-\\(|&gt;:\\-\\(|:\\)|\\(:|:-\\)|:\\(|\\):|:\\-\\(|:\\/|:\\-\\/|:\\\\|:\\-\\\\|=\\/|=\\\\|:p|:\\-p|:b|:\\-b|;p|;\\-p|;b|;\\-b)(\\s)","ig"),d="";a=" "+a+" ",a=a.replace(/\s/g,"  ");var a=a.replace(c,function(a){var b,c=!1,e=a.trim();return L[e]?(b=L[e],c=!0):b=e,b=b.substring(1,b.length-1),K[b]?(s(b),d=d+e+", ",1==c?" "+K[b].emoji.unicode+" ":K[b].emoji.unicode):a});return d.length>0&&(d=d.substring(0,d.length-2),e.trackEvent(e.Enter_Emoji_Shortcut,{Source:b,"Emoji Type":d})),a=a.replace(/\s\s/g," "),a=a.substring(1,a.length-1)}function w(){return J}function x(a){J=a,f.dispatchTabsEvent2("emojiDataService::onScrollPositionUpdate",a)}function y(){var a=b.getx("emoji").then(function(a){if(A=a.data.EMOJI_HISTORY,A&&(A=A.split(",")),E=!1,G=!0,I["Frequently Used"]={category:"Frequently Used",emojisList:[],categoryOrder:1},A){for(var b=0;b<A.length;b++)A[b]=A[b].substring(1,A[b].length-1);p()}return I},function(){})["finally"](function(){});return a}var z,A,B,C,D,E,F,G,H,I={},J=0,K={},L=[],M=[],N=[],O=5;return L["<3"]=":heart:",L["&lt;3"]=":heart:",L["</3"]=":broken_heart:",L["&lt;/3"]=":broken_heart:",L["8)"]=":sunglasses:",L["D:"]=":anguished:",L[":'("]=":cry:",L[":&apos;("]=":cry:",L[":o)"]=":monkey_face:",L[":*"]=":kissing_heart:",L[":-*"]=":kissing_heart:",L["=)"]=":blush:",L["=-)"]=":blush:",L[":D"]=":grinning:",L[":-D"]=":smiley:",L[";)"]=":wink:",L[";-)"]=":wink:",L[":>"]=":laughing:",L[":&gt;"]=":laughing:",L[":->"]=":laughing:",L[":-&gt;"]=":laughing:",L[":|"]=":neutral_face:",L[":-|"]=":neutral_face:",L[":o"]=":open_mouth:",L[":O"]=":scream:",L[":-o"]=":open_mouth:",L[":-O"]=":open_mouth:",L[">:("]=":angry:",L["&gt;:("]=":angry:",L[">:-("]=":angry:",L["&gt;:-("]=":angry:",L[":)"]=":blush:",L["(:"]=":blush:",L[":-)"]=":blush:",L.o_o=":astonished:",L.O_O=":astonished:",L[":("]=":disappointed:",L["):"]=":disappointed:",L[":-("]=":disappointed:",L[":/"]=":confused:",L[":-/"]=":confused:",L["=/"]=":confused:",L["=\\"]=":confused:",L[":\\"]=":confused:",L[":-\\"]=":confused:",L[":p"]=":stuck_out_tongue:",L[":P"]=":stuck_out_tongue:",L[":-p"]=":stuck_out_tongue:",L[":-P"]=":stuck_out_tongue:",L[":b"]=":stuck_out_tongue:",L[":-b"]=":stuck_out_tongue:",L[";p"]=":stuck_out_tongue_winking_eye:",L[";P"]=":stuck_out_tongue_winking_eye:",L[";-p"]=":stuck_out_tongue_winking_eye:",L[";-P"]=":stuck_out_tongue_winking_eye:",L[";b"]=":stuck_out_tongue_winking_eye:",L[";-b"]=":stuck_out_tongue_winking_eye:",L["(y)"]=":+1:",L["(Y)"]=":+1:",L["-.-"]=":expressionless:",M.push("White smiling face"),
M.push("White up pointing index"),M.push("Victory hand"),M.push("Black sun with rays"),M.push("Cloud"),M.push("Snowflake"),M.push("Heavy black heart"),M.push("Baseball"),M.push("Airplane"),f.addTabsEventListener2("emojiDataService::onFrequentUpdate",function(a){B&&B.length>1&&(B[1]=a,I=a)}),f.addTabsEventListener2("emojiDataService::onScrollPositionUpdate",function(a){J=a}),{getParsedEmojiData:m,updateFrequentEmojiData:s,GetFrequentEmojisFromServer:y,searchingEmojis:n,queryEmojisByShortCodes:o,replaceEmojiCodes:t,getShowImageEmojiesList:h,getScrollPosition:w,setScrollPosition:x,loadAssets:j,getEmojisHtmlFromStore:function(){return H},storeEmojisHtml:function(a){H=a}}}]),b.module("convoApp").directive("cnvGiphyPopover",["$rootScope",function(a){function b(a){return"Editor"===a}return{replace:!0,scope:{cnvChatWindowId:"=",cnvFileContext:"=",cnvGiphyInformation:"=",cnvCustomClasses:"=cnvGiphyCustomClasses"},template:function(a,b){var c="";"true"===b.cnvGiphyRelativeToBody&&"false"!==b.cnvGiphyRelativeToBodyOverride&&(c=" popover-append-to-body='true' ");var d="true"===b.cnvGiphyRelativeToBody?"":"inLineInsertGiphy";return"<div class='giphy-action-container'><div id='iShowGiphyPopup' "+c+" popover-template='giphyDirective' popover-class='custom-giphy-popover {{cnvChatWindowId}} {{::cnvCustomClasses}}' popover-placement='{{dynamicPopoverPlacement}}' popover-trigger='showGiphyPopover click' popover-animation='false' ng-class='cnvGiphyIconClass' class='"+d+"'></div></div>"},link:function(a,c,d){function e(){}function f(){}function g(b){if("top"==k){var c=b.target.getBoundingClientRect();c.top<250?a.dynamicPopoverPlacement="bottom":a.dynamicPopoverPlacement="top"}}function h(b){"INPUT"==b.tagName&&b.classList.contains("cnv-giphy-search-field")||("true"===d.cnvGiphyRelativeToBody?0===$(".popover."+a.cnvChatWindowId).find(b).length&&0===c.find(b).length&&c.find("#iShowGiphyPopup").trigger("hideGiphyPopover"):0===c.find(b).length&&c.find("#iShowGiphyPopup").trigger("hideGiphyPopover"))}function i(a,b){c.find("#iShowGiphyPopup").trigger("hideGiphyPopover")}function j(a,b){h(b)}c[0].cnvMemLeakHook=new e,a.cnvMemLeakHook=new f,a.cnvGiphyIconClass=d.cnvGiphyIconClass,a.mixpanelInfo=d.cnvGiphyMixpanelInfo,a.giphyDirective="integrations/giphy/templates/giphyDirective.tpl.html",a.dynamicPopoverPlacement=b(d.cnvGiphyMixpanelInfo)?"right":"top";var k=a.dynamicPopoverPlacement,l=c.find("#iShowGiphyPopup");l.on("showGiphyPopover",g),l.on("click",g),a.getGiphySearchText=function(b){a.cnvGiphyInformation&&(a.cnvGiphyInformation.searchText=b)};var m=a.$on("cnvEventBinding::keyup::ESCAPE",i),n=a.$on("cnvEventBinding::click",j);a.$on("cnvEventBinding::click",function(a,b){var d=$(".custom-giphy-popover");if(b.classList.contains("giphy")&&d.length>0&&(d[0].contains(b)||c[0].contains(b))){var e,f=d.find(".arrow"),g=f[0].getBoundingClientRect(),h=b.getBoundingClientRect(),i=f.parent();if(e=i.hasClass("top")||i.hasClass("bottom")?h.left-g.left:h.left+h.width-g.left,-10>e||e>10){var j=d.find(".arrow").css("left"),k=+j.slice(0,j.length-2);k+=e,d.find(".arrow").css("left",k)}}}),a.$on("$destroy",function(){l.off("showGiphyPopover",g),l.off("click",g),l=null,m(),n()})}}}]),b.module("convoApp").directive("cnvGiphy",["$http","$timeout","UploadService","utils","mixpanelService","$filter",function(b,d,e,f,g,h){function i(a){a.find(".cnv-giphy-gallary")[0].scrollLeft=0,l=a.find("img.lazy").lazyload({container:a.find(".cnv-giphy-gallary")}).each(function(a,b){b.src.indexOf("data:image/png")>-1&&(b.src=$(b).data("thumbnail"))})}function j(a,b,d){var i={};i.name="giphy.gif",i.size=b.size,i.fileExt="gif",i.type=i.fileExt,i.fileId=f.generateGuid(),i.fileUploadName=i.fileId+"."+i.type,i.localUrl=h("getFileIconByType")(i.type,32),i.source="url",i.file_url=b.downsized,i.mp_attachment_source="Giphy",i.status=e.FILE_STATUS_WAITING,i.uploadFrom="chat-window",d.event_dispacher.dispach({event:e.EVENT_FILE_SELECTED,file:i}),e.fileConversionReq(d,i),g.trackEvent(g.SEND_GIF,{Source:a.mixpanelInfo,"Search Term":(a.giphySearchText||"").trim()||c})}function k(){return _.debounce(function(a){var b=(a.giphySearchText||"").trim();b&&g.trackEvent(g.SEARCH_FOR_GIF,{Source:a.mixpanelInfo,"Search Term":b})},2e3)}var l;return{templateUrl:"integrations/giphy/templates/cnv-giphy.tpl.html",restrict:"E",replace:!0,scope:{cnvChatWindowIdForGiphy:"=",fileInputContext:"=cnvFileContextOfParentScope",rating:"=cnvGiphyRating",giphySearchText:"=cnvGiphySearchText",updateParentScope:"&cnvUpdateParentScope",mixpanelInfo:"=",giphyActionType:"=cnvGiphyActionType"},link:function(b,c){function d(){}function e(){}c[0].cnvMemLeakHook=new d,b.cnvMemLeakHook=new e;var f,h;f=k(),b.searchingGifs=!0,c.find(".cnv-spinner").show(),h={rating:b.rating||"pg",limit:20,api_key:"xTiTnI9GNUe8rosXMQ"},b.gifSelected=function(a){j(b,a,b.fileInputContext),c.remove(),b.cnvChatWindowIdForGiphy&&b.$emit("setWindInFocus",b.cnvChatWindowIdForGiphy.slice(1))},b.searchChanged=function(){b.searchingGifs=!0,c.find(".cnv-spinner").show(),f(b)},f(b),b.$watch("giphySearchText",function(a){var d,e,f,g;b.updateParentScope({giphySearchText:a}),h.q=a||"happy reactions",d="//api.giphy.com/v1/gifs/search?"+$.param(h),e="fixed_height_small",g="fixed_height_small_still",f=$.getJSON(d),f.done(function(a){b.images=a.data.map(function(a){return{original:a.images.original.url,downsized:a.images.downsized.url,src:a.images[e].url,thumbnail:a.images[g].url,size:a.images[e].size}}),b.searchingGifs=!1,c.find(".cnv-spinner").hide(),b.$digest(),i(c)})}),c.on("mouseup",function(a){a.stopPropagation()}),c.find(".cnv-giphy-gallary").on({mousewheel:function(a,b){this.scrollLeft+=a.deltaX*a.deltaFactor,a.preventDefault(),a.stopPropagation()}}),b.cnvChatWindowIdForGiphy&&$(a).on("scroll."+b.cnvChatWindowIdForGiphy+" resize."+b.cnvChatWindowIdForGiphy,function(){$(".popover").css("top",$("#"+b.cnvChatWindowIdForGiphy).find("#iShowGiphyPopup").offset().top-223+"px")}),c.find(".cnv-giphy-search-field").on("focus",function(){var a=$(this);setTimeout(function(){a.select()},0)}).focus(),g.trackEvent(g.CLICK_GIF_BUTTON,{Source:b.mixpanelInfo,"Giphy Command":"command"===b.giphyActionType?"True":"False"}),b.giphyActionType="",b.$on("$destroy",function(){b.$emit("giphyPopupClosed"),b.cnvChatWindowIdForGiphy&&$(a).off("scroll."+b.cnvChatWindowIdForGiphy+" resize."+b.cnvChatWindowIdForGiphy),l&&(l.destroy(),l=null)})}}}]),b.module("convoApp").directive("cnvGoogleDriveFilesIntegrator",["$window",function(a){return{restrict:"A",scope:{fileInputServiceContext:"=cnvFileInputServiceContext"},controller:["$scope","utils","$filter","UploadService","nativeCommBridge","config",function(b,d,e,f,g,h){function i(a){for(var c in a){var g={};j(a[c].thumbnailLink,g,function(a,b,c){a&&(c.localUrl=b)}),g.name=a[c].name,g.size=a[c].bytes?a[c].bytes:1,g.fileExt=a[c].name.substr(a[c].name.lastIndexOf(".")+1).toLowerCase(),g.type=g.fileExt,g.fileId=d.generateGuid(),g.fileUploadName=g.fileId+"."+g.type,g.source=a[c].source,g.file_url=a[c].link,g.file_access_token=a[c].fileAccessToken,g.file_preview_url=a[c].previewLink,g.localUrl=e("getFileIconByType")(g.type,32),g.status=f.FILE_STATUS_WAITING,b.fileInputServiceContext.event_dispacher.dispach({event:f.EVENT_FILE_SELECTED,file:g}),f.fileConversionReq(b.fileInputServiceContext,g)}}function j(a,b,c){var d=new Image;d.onload=function(){c(!0,a,b)},d.onerror=function(){c(!1)},d.src=a}b.initializeGoogleDrive=function(){function d(){q=!0,f()}function e(){p=!0,f()}function f(){k&&q&&p&&(l=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).addView(google.picker.ViewId.DOCS).setOAuthToken(k).setDeveloperKey(m).setCallback(j).build(),l.setVisible(!0),b.$emit("showOverlay",["Google Drive"]),h.IS_MENULET&&g.overlayStatus("true"))}function j(a){if(a[google.picker.Response.ACTION]==google.picker.Action.PICKED){var d=[],e=a[google.picker.Response.DOCUMENTS].length;for(var f in a[google.picker.Response.DOCUMENTS]){var j=a[google.picker.Response.DOCUMENTS][f][google.picker.Document.ID],m=r.client.drive.files.get({fileId:j});m.execute(function(a){var f={};a.exportLinks!=c&&a.exportLinks["application/pdf"]!=c?(f.link=a.exportLinks["application/pdf"],f.name=a.title+".pdf"):a.downloadUrl!=c&&(f.link=a.downloadUrl),f.source="GOOGLE_DRIVE",f.previewLink=a.alternateLink,f.fileAccessToken=k,f.thumbnailLink=a.thumbnailLink,a.originalFilename!=c&&(f.name=a.originalFilename),a.fileSize!=c?f.bytes=a.fileSize:f.bytes=0,d.push(f),d.length==e&&(i(d),l=null,b.$emit("removeOverlay"),h.IS_MENULET&&g.overlayStatus("false"))})}}else a[google.picker.Response.ACTION]==google.picker.Action.CANCEL&&(l=null,b.$emit("removeOverlay"),h.IS_MENULET&&g.overlayStatus("false"))}var k,l,m="AIzaSyAUhLtPqg_buEVOEtzHwHSIGabtJuIT2DY",n="275461782742-da796gpica1pgn8n3n41lq7f76taoafi.apps.googleusercontent.com",o="https://www.googleapis.com/auth/drive.readonly",p=!1,q=!1,r=a.gapi;r.load("picker",{callback:d}),r.client.load("drive","v2",e);var s=r.auth2.init({client_id:n,fetch_basic_profile:!1,scope:o}),t=s.signIn({prompt:"select_account",fetch_basic_profile:!1,scope:o});t.then(function(){var a=s.currentUser.get().getAuthResponse(!0);k=a.access_token,f()})}}],link:function(a,b,c){b.bind("click",function(){a.initializeGoogleDrive()})}}}]),b.module("convoApp").controller("integrationsIntroDialogCtrl",["$scope","$modalInstance",function(a,b){a.dialogTitle="Connect all your apps to Convo",a.closeDialog=function(){b.close()},a.browseIntegrations=function(){a.$broadcast("openIntegrationsBrowseTab")},a.manageIntegrations=function(){a.$broadcast("openIntegrationsManageTab")}}]),b.module("convoApp").directive("cnvIntegrationsIntroScreen",["integrationsIntroService",function(a){return{restrict:"E",scope:!0,templateUrl:"integrations/integrationsIntroDialog/templates/integrationsIntroScreen.tpl.html",link:function(a,b,c){function d(a){a.preventDefault(),a.stopPropagation()}function e(){var a=$("body").height(),b=$(".modal-dialog"),c=b.height(),d=a/2-c/2;b.css({"margin-top":d})}a.onSearch=_.debounce(function(b){a.searchInfo.searchText.length&&a.searchInfo.searchText!==a.lastSearchText?(a.isSearching=!0,a.lastSearchText=a.searchInfo.searchText,a.getFilteredIntegrationApps(),a.$broadcast("render")):0===a.searchInfo.searchText.length&&(a.isSearching&&(a.isSearching=!1,a.$broadcast("render")),a.lastSearchText="",a.changeView(a.SHOWCASED_INTEGRATION_APPS))},100),document.addEventListener("mousewheel",d),setTimeout(e,0),a.$on("$destroy",function(){document.removeEventListener("mousewheel",d)})},controller:["$scope",function(b){function c(){var c=a.getTopIntegrationApps();c.then(function(a){b.showcasedApps=a,b.$broadcast("render")})}function d(){b.defaultApps=a.getDefaultIntegrationApps()}function e(){g(),a.openIntegrationsDirectory()}function f(){g(),a.openIntegrationsManageDirectory()}function g(){b.closeDialog()}function h(){c(),d()}b.headerText="Convo works with 600+ apps that your team already uses.",b.detailText="Stop switching between apps, and get real time updates of everything your team is working on, all in one place.",b.showcasedIntegrationAppsLabel=a.getLabelText(),b.otherAppsNavText="Browse 600+ integrations",b.SHOWCASED_INTEGRATION_APPS=1,b.FILTERED_INTEGRATION_APPS=2,b.DEFAULT_INTEGRATION_APPS=3,b.CURRENT_VIEW=b.SHOWCASED_INTEGRATION_APPS,b.showAppLimit=4,b.searchInfo={searchText:""},b.onBrowseMoreIntegrationApps=function(){a.trackBrowseIntegrations(),e()},b.onIntegrationAppBrowse=function(b){a.trackAddIntegration(b.title),a.browseIntegrationApp(b),g()},b.onManageIntegrationApps=function(){f()},b.$on("openIntegrationsBrowseTab",function(){b.onBrowseMoreIntegrationApps()}),b.$on("openIntegrationsManageTab",function(){b.onManageIntegrationApps()}),b.changeView=function(c){(b.CURRENT_VIEW!==c||c!==b.SHOWCASED_INTEGRATION_APPS&&c!==b.DEFAULT_INTEGRATION_APPS)&&(b.CURRENT_VIEW=c,c===b.SHOWCASED_INTEGRATION_APPS?(b.showcasedIntegrationAppsLabel=a.getLabelText(),b.otherAppsNavText="Browse 600+ integrations"):c===b.FILTERED_INTEGRATION_APPS?(b.showcasedIntegrationAppsLabel=b.searchInfo.searchText,b.filteredApps.length>4?b.otherAppsNavText="View all results":b.otherAppsNavText="Browse 600+ integrations"):(b.showcasedIntegrationAppsLabel='We couldn\'t find that <img style="width: 16px;" src="assets/img/integrations/ThinkingFaceEmoji.png"></img><br/>Set up a custom integration or try finding the app you\'re looking for on these services.',b.otherAppsNavText="Browse 600+ integrations"),b.$broadcast("render"))},b.getFilteredIntegrationApps=function(){var c=a.getFilteredIntegrationApps(b.searchInfo.searchText);c.then(function(c){c.query===b.searchInfo.searchText&&(a.trackSearchIntegrations(c.query),b.isSearching=!1,b.$broadcast("render"),c.filteredIntegrationApps.length?(b.filteredApps=c.filteredIntegrationApps,b.changeView(b.FILTERED_INTEGRATION_APPS)):b.changeView(b.DEFAULT_INTEGRATION_APPS))})},h()}]}}]),b.module("convoApp").factory("integrationsIntroService",["alertsService","ServerComm","$q","AppLinks","$location","mixpanelService",function(b,c,d,e,f,g){function h(){for(var a=[],b=0;b<o.length;b++)a.push(q[o[b]]);o=a}function i(a,b){for(var c=0;c<a.length;c++)b.push(q[a[c].title.trim()])}function j(){var a=e.newResourceLink("100",[{uid:0,type:"100"}],null,"Integrations"),b=e.linkToUrl(a);f.path(b.slice(1))}function k(){var a=e.newResourceLink("100",[{uid:0,type:"100"},{uid:"2",type:"ConfiguredIntegrations"}],null,"Configured Integrations"),b=e.linkToUrl(a);f.path(b.slice(1))}var l={},m=[],n=[],o=["Incoming Webhook","Zapier","IFTTT"],p="",q={Twitter:{image:"twitter.png",title:"Twitter",description:"Get all your tweets, replies and retweets neatly organized in a Convo thread.",type:"AddTwitterIntegration",windowTitle:"Add Twitter Integration"},Gmail:{image:"gmail.png",title:"Gmail",description:"Your important email is delivered to Convo automatically, all replies are added to the thread",type:"AddGmailIntegration",windowTitle:"Add Gmail Integration"},"Office 365 - Mail":{image:"o365_mail.png",title:"Office 365 - Mail",description:"Your important email is delivered to Convo automatically, all replies are added to the thread.",type:"AddO365MailIntegration",windowTitle:"Add Office 365 - Mail Integration"},"Office 365 - Calendar":{image:"o365_calendar.png",title:"Office 365 - Calendar",description:"View your events and invites in Convo and get reminders before your event starts.",type:"AddO365CalendarIntegration",windowTitle:"Add Office 365 - Calendar Integration"},"Office 365 - OneDrive":{image:"onedrive.png",title:"Office 365 - OneDrive",description:"Enable the magic of Convo collaboration on your OneDrive files.",type:"AddO365DriveIntegration",windowTitle:"Add Office 365 - OneDrive Integration"},Dropbox:{image:"dropbox.png",title:"Dropbox",description:"Enable the magic of Convo collaboration on your Dropbox files.",type:"AddDropboxIntegration",windowTitle:"Add Dropbox Integration"},Box:{image:"box.png",title:"Box",description:"Enable the magic of Convo collaboration on your Box files.",type:"AddBoxIntegration",windowTitle:"Add Box Integration"},"Google Drive":{image:"googledrive.png",title:"Google Drive",description:"Enable the magic of Convo collaboration on your Google Drive files.",type:"AddGdriveIntegration",windowTitle:"Add Google Drive Integration"},"Google Calendar":{image:"calendar.png",title:"Google Calendar",description:"View your events and invites in Convo and get reminders before your event starts.",type:"AddGcalIntegration",windowTitle:"Add Google Calendar Integration"},Facebook:{image:"facebook.png",title:"Facebook",description:"Get all the posts published on a Facebook page in real time.",type:"AddFacebookIntegration",windowTitle:"Add Facebook Integration"},IFTTT:{image:"ifttt.png",title:"IFTTT",description:"Connect with 300+ apps using a conditional statement: if this then that.",link:"https://ifttt.com/convo"},Zapier:{image:"zapier.png",title:"Zapier",description:"Choose from 500+ applications or create your own Zapier integration.",link:"https://zapier.com/app/editor"},"Incoming Webhook":{image:"direct.png",title:"Incoming Webhook",description:"Set up a custom integration. Set up a webhook to get activity from third party apps.",type:"AddIntegration",windowTitle:"Add Webhook Integration"}},r=function(){var a="integrations/integrationsIntroDialog/templates/integrationsIntroDialog.tpl.html",c="integrationsIntroDialogCtrl";return b.customModal(a,c,null,"",!0)},s=function(){if(m.length>0){var a=d(function(a){a(m)});return a}var b=d.defer(),e={params:{filter:"top"}},f=c.get("integrations/showcase",e);return f.success(function(a,c){a.type&&(p=a.data.label_text,m=[],i(a.data.top_items,m),b.resolve(m))}),f.error(function(a,b){console.log("failed to get the top integration apps.")}),b.promise},t=function(a){var b=d.defer(),e={params:{query:a}},f=c.get("integrations/showcase",e,!0);return f.then(function(a){200===a.status&&(n=[],i(a.data,n),b.resolve({filteredIntegrationApps:n,query:a.config.params.query}))},function(a){console.log("failed to get the top integration apps.")}),b.promise},u=function(){return o},v=function(b){if("IFTTT"!==b.title&&"Zapier"!==b.title){var c=e.newResourceLink("100",[{uid:"0",type:"100"},{uid:"2",type:b.type}],null,b.windowTitle),d=e.linkToUrl(c);f.path(d.slice(1))}else a.open(b.link,"blank")},w=function(){g.trackEvent(g.BROWSE_INTEGRATIONS,{From:"Dialog"})},x=function(a){g.trackEvent(g.CLICK_ADD_INTEGRATION,{From:"Dialog",Source:a})},y=function(a){g.trackEvent(g.SEARCH_INTEGRATIONS,{From:"Dialog","Search Term":a})},z=function(){return p},A=function(){s(),h()};return l.initIntegrationsIntroDialog=r,l.getTopIntegrationApps=s,l.getFilteredIntegrationApps=t,l.getDefaultIntegrationApps=u,l.openIntegrationsDirectory=j,l.browseIntegrationApp=v,l.openIntegrationsManageDirectory=k,l.trackBrowseIntegrations=w,l.trackAddIntegration=x,l.trackSearchIntegrations=y,l.getLabelText=z,l.initialize=A,l}]),b.module("convoApp").directive("cnvSelectedUsersBox",function(){return{scope:!0,templateUrl:"invites/cnvSelectedUsersBox/cnvSelectedUsersBox.tpl.html",controller:["$scope",function(a){var b=a,c=!1;b.addedUsersDisplayLimit=10,b.cnvAddedUsers=b.addedList,b["delete"]=function(a){b.$emit("DeleteSelectedUser",a)},b.onScrolledBottom=function(a){return c?(a.preventDefault(),a.stopImmediatePropagation(),!1):(c=!0,b.addedUsersDisplayLimit=Math.min(b.addedUsersDisplayLimit+15,b.contacts.length),void setTimeout(function(){c=!1},0))}}]}}),b.module("convoApp").controller("ImportCSVContactsCtrl",["$scope","Contacts","importCSVContacts","utils",function(a,b,c,d){var e=a;e.findCSVFileContacts=function(a){d.fireEvent($(a.target).closest(".invite-CSV-contacts").find(".file-input")[0],"click")};var f=!1;e.CSVFileInputChange=function(a){function d(a){b.initContactsInviteModal({local_list:c.csvFileLoadingCompleteHandler(a.target.result),source:"csv",include_off_domain:f,origin:"Right_Column",invite_via:"Invite_Dialog"})}var e=a.files[0];if(e){var g=new FileReader;g.readAsText(e),g.onload=d}}}]),b.module("convoApp").controller("ImportGoogleContactsCtrl",["$scope","importGoogleContacts","Contacts",function(a,b,c){function d(a){g&&(g=!1,c.initContactsInviteModal({local_list:a,source:"google",include_off_domain:h,origin:"Right_Column",invite_via:"Invite_Dialog"}),e.close())}var e,f=a,g=!1;f.findGoogleContacts=function(){e=b.find(),g=!0};var h=!1;b.on("contactsReceivedFromGmail",d)}]),b.module("convoApp").controller("ImportMacContactsCtrl",["$scope","Contacts","alertsService","importMacContacts",function(a,b,c,d){var e=a;e.findMacContacts=function(a){d.initContactsInviteModal(a?a:"Right_Column")}}]),b.module("convoApp").controller("basicInviteModalCtrl",["$scope","$modalInstance","data","accountInfo","$q","Contacts","usersGroupsListProvider","utils","Users","alertsService","Groups","config","mixpanelService","userInfo",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o){var p=a;p.invitesCtrl=d,p.invitesCtrl.initialized=!1,p.isGuest=o.isGuestUser(),p.isNative=m.IS_NATIVE,p.isNative=m.IS_NATIVE,p.shouldInviteGuestsAsFullMembers=e.shouldInviteGuestsAsFullMembers(),p.isMac=m.IS_MAC,p.modalTitle="Invite teammates",d.contacts.group&&(p.modalTitle+=" to "+d.contacts.group.get("title"));var q=(m.WEBSITE_DOMAIN+"join/"+e.getPrimaryAccountDomain().account_domain).substring(8);p.inviteEmailSubject="Join me on "+e.getAccountName(),p.inviteEmailBody="Hi there,%0D%0A%0D%0ALet's use Convo to make our internal communication faster!%0D%0A%0D%0ASign up with your work email at this link: https://"+q+"%0D%0A%0D%0ATake a look around and see what others are working on. Add a question or a great idea in comments. Then share a post and get really fast feedback.%0D%0A%0D%0ATry sharing posts instead of emails - even a complicated thread is easy to consume.";var r={};p.invite=function(){r.Via=p.invitesCtrl.contacts.invite_via,r["Scraped Master List"]=r["Personal List"]=r["Master List"]=r.Email=0,p.invitesCtrl.inputObj.inviteMessage?p.invitesCtrl.inputObj.inviteMessage==p.invitesCtrl.inputObj.originalMessage?r["Personal Message"]="Default":r["Personal Message"]="Edited":r["Personal Message"]="None";for(var a=[],e=0,f=p.invitesCtrl.addedList.length;f>e;e++){var g=p.invitesCtrl.addedList[e];a.push(g.email),"0"==g.rank?++r["Scraped Master List"]:"1"==g.rank?++r["Personal List"]:"2"==g.rank?++r["Master List"]:++r.Email}d.contacts.hasOwnProperty("group")?(r["Invite To"]="Group",l.inviteUsersToGroupRTC(d.contacts.group,a,p.invitesCtrl.inputObj.inviteMessage,"Invite Dialogue").success(function(c,d){b.close({response:c,totalInvitesSent:a.length,invited_to:"GROUP"})}).error(function(a,c){b.close({response:response})})):(r["Invite To"]="Network",j.inviteUsersToNetwork(a,p.invitesCtrl.inputObj.inviteMessage,c,c,"Network").then(function(c){b.close({response:c,totalInvitesSent:a.length,invited_to:"NETWORK"})},function(a){b.close({response:a})})),n.trackEvent(n.INVITE_SENT,r)},p.dismiss=function(){b.dismiss("cancel")}}]),b.module("convoApp").directive("cnvInvites",["accountInfo",function(a){return{restrict:"EA",scope:!0,templateUrl:"invites/templates/cnvInvites.tpl.html",link:function(b,c,d){function e(a){if(!$(a.target).closest(".added-users-list-item").length){g.itemAddedIndicator=!1;for(var b=0,c=g.addedList.length;c>b;b++)g.addedList[b].highlight=!1}}function f(a){a.target.classList.contains("file-input")&&g.onCSVInputFileChange(a.target)}var g=b;g.placeholderText="name@",a.shouldInviteGuestsAsFullMembers()?g.placeholderText+="domain.com":g.placeholderText+=a.getPrimaryAccountDomain().user_email_domain,g.cnvModalType==g.cnvModalType_post_creators&&(g.placeholderText="Search");var h=c.closest(".modal-dialog")[0];document.addEventListener("click",e,!0),h.addEventListener("change",f),g.scrollToEndInAddedList=function(){var a=c.find(".addedUsers");a.animate({scrollTop:a[0].scrollHeight-a[0].clientHeight-16},{duration:250})},g.scrollToTopInAddedList=function(){c.find(".addedUsers").animate({scrollTop:0},{duration:250})},g.__nuke__=function(){document.removeEventListener("click",e,!1),h.removeEventListener("change",f)}},controller:["$scope","importCSVContacts","importGoogleContacts","utils","$q","Contacts","alertsService","Users","usersGroupsListProvider","User","userInfo","mixpanelService","$timeout","BlackListWordsService",function(d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a){var b=g.findIndexInObjectArray(z.addedList,"email",a.email);if(z.addedList.splice(b,1),a.highlight=!1,z.allSelected=!1,z.cnvModalType==z.cnvModalType_post_creators&&z.invitesCtrl&&z.invitesCtrl.addedList){var b=g.findIndexInObjectArray(z.invitesCtrl.addedList,"email",a.email);if(b>-1&&z.invitesCtrl.addedList.splice(b,1),z.invitesCtrl.canPost){var c=g.findIndexInObjectArray(z.invitesCtrl.canPost,"email",a.email);c>-1&&z.invitesCtrl.canPost.splice(c,1)}}z.addedList.length||(z.itemAddedIndicator=!1)}function s(a,c){if(D){for(var d=y.contacts.group.get("groupMembers"),e=0,f=d.length;f>e;++e){var h=g.findIndexInObjectArray(a,"email",d[e].user_email_id);-1!=h&&a.splice(h,1)}k.getPublishableUsers().then(function(a){var b=t(a,d);z.contacts.length&&(z.contacts.prepend([{separator:!0,text:"People you may know"}]),z.separatorsCount&&(z.separatorsCount.value=1)),z.contacts.prepend(b),z.noContactFound=c&&!z.contacts.length?!0:!1,z.noRecentContactFound=!z.noContactFound&&j&&z.contacts.length===j?!0:!1})}else E&&k.getPublishableUsers().then(function(a){var b=w(t(a,[]));z.contacts.length&&(z.contacts.prepend([{separator:!0,text:"People you may know"}]),z.separatorsCount.value=1),z.contacts.prepend(b),w(z.contacts),z.noContactFound=c&&!z.contacts.length?!0:!1,z.noRecentContactFound=!z.noContactFound&&j&&z.contacts.length===j?!0:!1,z.noRecentContactFound=z.noRecentContactFound&&!z.postCreatorsCtrl});a=i.limitScrapContacts(a,H);var j=z.contacts.length;z.contacts.length=0,z.separatorsCount&&(z.separatorsCount.value=0),n.isGuestUser()||b.extend(z.contacts,a),z.noContactFound=c&&!z.contacts.length?!0:!1,z.noRecentContactFound=!z.noContactFound&&j&&a.length===j?!0:!1}function t(a,b){for(var c=[],d=0,e=a.length;e>d;++d)if(!_.where(b,{user_id:a[d].user_id}).length){var f=_.extend({},a[d]);f.user_email_id=a[d].email,c.push(l.createUserListItemForSpecificGroup(f))}return c}function u(a){z.waiting=!0,i.addUserContactsAndGetAccountUserContacts(a).then(function(a){z.waiting=!1,s(a,!0),z.mode=z.contacts.length?z.VIEW_MODES.DEFAULT:z.VIEW_MODES.EMPTY},function(){alert("Couldn't get contacts, please try again!"),z.waiting=!1}),y.contacts.origin&&o.trackEvent(o.CLICK_IMPORT_CONTACTS,{Source:y.contacts.origin})}function v(a){C.close(),u({contacts:a,source:"google",include_off_domain:F})}function w(a){for(var b=n.getEmail().trim(),c=0;c<a.length;c++)a[c].separator||a[c].email.trim()!==b||(a.splice(c,1),--c);return a}function x(a,b){var c=!0;if(y.contacts.group){var d=_.where(b,{user_email_id:a});d.length>0&&(c=!1)}else if(!E)for(var e=0;e<L.length;e++)if(L[e].email===a){c=!1;break}return c}var y,z=d,A={LOCAL:"local_list",MASTER:"master_list"},B=5;y=z.cnvModalType&&z.cnvModalType==z.cnvModalType_post_creators?z.postCreatorsCtrl:z.invitesCtrl;var C=null,D=y.contacts.hasOwnProperty("group")?y.contacts.group:null,E=y.contacts.hasOwnProperty("new_group")?y.contacts.new_group:null,F=y.contacts.include_off_domain,G=!1,H=10,I={NETWORK_LEVEL:"Hi team,\n\nLet's use Convo to make our internal communication faster!\n\nTake a look around and see what others are working on. Add a question or a great idea in comments. Then share a post and get really fast feedback.\n\nTry sharing posts instead of emails - even a complicated thread is easy to consume.",GROUP_LEVEL:"Hi team,\n\nLet's organize our team communication in the "+(E?E.name:D?D.title:"")+" group.\n\nTake a look around, create posts about what you're working on and start a chat with a teammate.\n\nTry sending posts instead of emails - posts are easier to consume and will make our communication faster.\n\n"+n.getUserInfo().name,POST_CREATORS_LEVEL:"Hi team,\n\nLet's organize our team communication in the "+(E?E.name:D?D.title:"")+" group.\n\nYou can create posts in this group to share information and files with your teammates.\n\nPosts are easier to consume than emails and help get the word across much faster.\n\nGo ahead, create a post and start communicating with your team.\n\n"+n.getUserInfo().name},J={NETWORK_LEVEL:"Enter email addresses",GROUP_LEVEL:"Enter names or email addresses",POST_CREATORS_LEVEL:"Search"};if(z.cnvModalType==z.cnvModalType_post_creators&&(y.custom_message_post_creators=I.POST_CREATORS_LEVEL),z.VIEW_MODES={DEFAULT:"default",EMPTY:"empty"},z.inputObj={},z.inputObj.inviteMessage=D||E?I.GROUP_LEVEL:I.NETWORK_LEVEL,z.inputObj.originalMessage=g.copyObject(z.inputObj.inviteMessage),z.emailInputTitle=D||E?J.GROUP_LEVEL:J.NETWORK_LEVEL,z.accountInfo=a,z.itemAddedIndicator=!1,z.inviteTo=[],z.waiting=!1,z.contacts||(z.contacts=y.masterList&&y.masterList.length?[].concat(y.masterList):[]),z.cnvModalType==z.cnvModalType_post_creators?z.addedList=z.postCreatorsCtrl&&z.postCreatorsCtrl.addedList?z.postCreatorsCtrl.addedList:[]:(z.addedList=z.invitesCtrl.addedList?z.invitesCtrl.addedList:[],z.postCreatorsCtrl&&z.postCreatorsCtrl.addedList&&z.postCreatorsCtrl.addedList.forEach(function(a){g.findIndexInObjectArray(z.addedList,"email",a.email)<0&&z.addedList.unshift(a)})),y.canPost=[],z.postCreatorsCtrl&&z.postCreatorsCtrl.addedList&&(y.canPost=[].concat(z.postCreatorsCtrl.addedList)),z.widgets={},z.widgets.isEnable=!1,z.inviteListPanel=!1,z.allSelected=!1,z.noContactFound=!1,z.contactsDisplayLimit=10,z.isGuest=n.isGuestUser(),z.userCanPost=function(a){if(z.cnvModalType==z.cnvModalType_post_creators)return!1;var b=!1;return _.filter(y.canPost,function(b){return b.id==a.id}).length&&(b=!0),b},z.isSelected=function(a){var b=z.addedList;return z.cnvModalType==z.cnvModalType_post_creators&&z.postCreatorsCtrl&&(b=z.postCreatorsCtrl.addedList),g.findIndexInObjectArray(b,"email",a.email)>-1},y.contacts.hasOwnProperty(A.MASTER))z.contacts=y.contacts.master_list,z.contacts.length||(z.noContactFound=!0);else if(y.contacts.hasOwnProperty(A.LOCAL))u({contacts:y.contacts.local_list,source:y.contacts.source,include_off_domain:F});else if(!z.contacts.length){z.waiting=!0;var K=F?"getAccountUserContacts_includeOffDomain":"getAccountUserContacts";i[K]().then(function(a){y.contacts.get_details_first?y.contacts.group.getDetails().then(function(){z.waiting=!1,s(a,!1),z.mode=z.contacts.length?z.VIEW_MODES.DEFAULT:z.VIEW_MODES.EMPTY},function(){z.waiting=!1,alert("Couldn't get contacts, please try again!")}):(z.waiting=!1,s(a,!1)),z.mode=z.contacts.length?z.VIEW_MODES.DEFAULT:z.VIEW_MODES.EMPTY},function(){z.waiting=!1,alert("Couldn't get contacts, please try again!")})}z.mode=z.contacts.length?z.VIEW_MODES.DEFAULT:z.VIEW_MODES.EMPTY,z.onEscKeyPressInEmailField=function(){},z.onItemAddedInEmailField=function(a){var b=a.email,c=q.clean(a.email);if(c!==b)return void z.inviteTo.splice(0,1);for(var d=z.inviteTo.length;d--;){var c=q.clean(z.inviteTo[d].email);c!==z.inviteTo[d].email&&z.inviteTo.splice(d,1)}var e=!1;if("ERROR"===a.type);else if(a.type===i.CONTACT_TYPES.GOOGLE_CONTACT_IMPORT)z.find_googleContacts();else{if("CONTACT"===a.type||"USER"===a.type)for(var f=0,g=z.contacts.length;g>f;f++);a.highlight=z.itemAddedIndicator=!0;for(var f=0,g=z.addedList.length;g>f;f++)if(z.addedList[f].email.trim()===a.email.trim()){e=!0;break}e?console.log("TODO: Set tag in view."):(z.addedList.unshift(a),z.inviteListPanel=!0,z.mode=z.VIEW_MODES.DEFAULT,setTimeout(function(){z.scrollToTopInAddedList()},0))}z.inviteTo.splice(0,1)},z.onItemRemovedInEmailField=function(a){},z.onCtrlOrCmdEnterPressInEmailField=function(){},z.onCtrlOrCmdSavePressInEmailField=function(){},z.onEnterPressInEmailField=function(b){var d=g.parseEmailAddressesFromString(b);if(0===d.emails.length||1===d.numItems)return!0;for(var e=d.emails,f=[],h={},i=0;i<e.length;i++){var j=e[i].toLowerCase();if(!F){var k=j.slice(j.lastIndexOf("@")+1);if(!a.isAccountDomain(k))continue}h[j]===c&&(f.push(j),h[j]=1)}if(f.length>0){for(var i=0;i<f.length;i++){var j=f[i],l={label:j,formattedlabel:j,formatteddesclabel:"",type:"CONTACT",classes:"no-border cnv-smiley "+g.getRandomSmiley()+" as-bg",email:j,id:g.generateHash(j)};z.onItemAddedInEmailField(l)}z.$$phase||z.$digest()}return!1},z.toggleItemSelection=function(a,b){if(!b.separator){var c=g.findIndexInObjectArray(z.addedList,"email",b.email);if(c>-1)r(b);else if(b.highlight=z.inviteListPanel=z.itemAddedIndicator=!0,-1==c){if(z.addedList.unshift(b),b.scrap){var d=i.getScrapContact();d&&z.contacts.push(d)}for(var e=0,f=0,h=z.contacts.length;h>f;f++)z.contacts[f].separator||e++;z.addedList.length===e&&(z.allSelected=!0),setTimeout(function(){z.scrollToTopInAddedList()},0)}}},z.$on("DeleteSelectedUser",function(a,b){a.preventDefault();var c=g.findInObjectArray(z.contacts,"id",b);c&&r(c)});var L=[];k.getPublishableUsers().then(function(a){L=a}),z.getInviteToDropdownItems=function(b,c){var d=h.defer();if(-1!==b.indexOf(","))return d.resolve([]),d.promise;
var e=!F&&!a.shouldInviteGuestsAsFullMembers(),f=!1,g=!0;z.isGuest&&(f=!0,g=!1),z.cnvModalType&&z.cnvModalType_post_creators&&z.cnvModalType==z.cnvModalType_post_creators&&(f=!0,g=!1);var j=i.query(b,z.contacts,B,e,g,f),k=null;y&&y.contacts&&y.contacts.group&&(k=y.contacts.group.get("groupMembers"));for(var l=0;l<j.length;l++)"AUTO_TYPE_SUGGESTION"===j[l].extended_type&&(x(j[l].email,k)||j.splice(l,1));for(var l=0;l<j.length;l++)if(j[l].email)for(var m=l+1;m<j.length;m++)j[m].email&&j[l].email===j[m].email&&(j.splice(m,1),--m);return d.resolve(j),d.promise},z.find_googleContacts=function(){C=f.find(),C&&(C.onbeforeunload=function(){p(function(){z.waiting=!1},0)})},z.find_macContacts=function(){var a="common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",b="findContactsSplashCtrl",c={data:function(){return{include_off_domain:F}}},d=j.customModal(a,b,c);z.waiting=!0,d.result.then(function(a){z.waiting=!1,s(a.contacts,!0)},function(a){if(a.hasOwnProperty("promise"))a.promise.then(function(a){z.waiting=!1,s(a.contacts,!0)},function(){z.waiting=!1,alert("There seems to be an error reaching server. Please try again!")});else if(a.hasOwnProperty("error"))if(z.waiting=!1,"permission_denied"===a.error){var b="common/cnvInviteTeammates/templates/cnvFindContactsPermissionDenied.tpl.html",c="findContactsPermissionDenied",d="find-contacts-permission-denied",e={data:function(){return{}}};j.customModal(b,c,e,d).result.then(function(){},function(){})}else"no_contacts_found"===a.error?(z.noContactFound=z.contacts.length?!1:!0,z.noRecentContactFound=z.noContactFound?!1:!0):"exception"===a.error?console.error("Exception occurs while reading contacts from native."):alert("There seems to be an error reaching server. Please try again!");else z.waiting=!1})},z.onCSVInputFileChange=function(a){function b(){z.waiting=!1,alert("Can't read that file. Please try another CSV file.")}function c(a){var c=e.csvFileLoadingCompleteHandler(a.target.result);c.length?(z.waiting=!0,u({contacts:c,source:"csv",include_off_domain:F})):b()}var d=a.files[0];if(d)if(d.name.toLowerCase().lastIndexOf("csv")===d.name.length-3){var f=new FileReader;f.readAsText(d),f.onload=c}else b()},z.widgets.enable=function(){z.widgets.isEnable||(z.widgets.isEnable=!0)},z.selectAllItems=function(){for(var a=0,b=z.contacts.length;b>a;a++)z.contacts[a].separator||g.findIndexInObjectArray(z.addedList,"email",z.contacts[a].email)<0&&(z.addedList.unshift(z.contacts[a]),z.inviteListPanel=z.contacts[a].highlight=!0);z.allSelected=z.itemAddedIndicator=!0,setTimeout(function(){z.scrollToTopInAddedList()},0)},z.deSelectAllItems=function(){z.addedList.splice(0),z.cnvModalType!=z.cnvModalType_post_creators&&z.postCreatorsCtrl&&z.postCreatorsCtrl.addedList&&z.postCreatorsCtrl.addedList.forEach(function(a){z.addedList.unshift(a)}),z.itemAddedIndicator=z.addedList.length>0,z.allSelected=!1},z.onScrolledBottom=function(a){return G?(a.preventDefault(),a.stopImmediatePropagation(),!1):(G=!0,z.contactsDisplayLimit=Math.min(z.contactsDisplayLimit+15,z.contacts.length),void setTimeout(function(){G=!1},0))},z.dismissNoRecentContactFound=function(){z.noRecentContactFound=!1},f.on("contactsReceivedFromGmail",v),z.$on("$destroy",function(a){f.off("contactsReceivedFromGmail",v),z.__nuke__()}),z.cnvModalType&&z.cnvModalType==z.cnvModalType_post_creators?(z.postCreatorsCtrl.API={},z.postCreatorsCtrl.find_googleContacts=z.find_googleContacts,z.postCreatorsCtrl.find_macContacts=z.find_macContacts,z.postCreatorsCtrl.masterList=z.contacts,z.postCreatorsCtrl.addedList=z.addedList,z.postCreatorsCtrl.inputObj=z.inputObj,z.postCreatorsCtrl.widgets=z.widgets,z.postCreatorsCtrl.initialized=!0):(z.invitesCtrl.API={},z.invitesCtrl.find_googleContacts=z.find_googleContacts,z.invitesCtrl.find_macContacts=z.find_macContacts,z.invitesCtrl.masterList=z.contacts,z.invitesCtrl.addedList=z.addedList,z.invitesCtrl.inputObj=z.inputObj,z.invitesCtrl.widgets=z.widgets,z.invitesCtrl.initialized=!0)}]}}]),b.module("convoApp").constant("ItemsConstants",{ITEM_SHARING_INFO_UPDATED:101,ITEM_DELETED_PERMANENTLY:100,ITEM_MOVED_TO_TRASH:90,ITEM_RESTORED:91,ITEM_UPDATED:92,ITEM_TAGS_UPDATED:102,ITEM_STARRED:103,ITEM_PERMISSION_CHANGED:2050,ITEM_UPDATED_2:5}),b.module("convoApp").factory("Likes",["ServerComm","$q","rtcNotificationManager","RTCNotification","Comments","userInfo",function(a,b,c,d,e,f){c.addListener(g.rtc.PubsubEvents.NOTIFICATION_RECEIVE,function(a){var b=a.notification,a=b.data;if(b.type==d.RESOURCE_LIKE||b.type==d.RESOURCE_UNLIKE||b.type==d.COMMENT_LIKE||b.type==d.COMMENT_UNLIKE){if(b.type==d.COMMENT_LIKE||b.type==d.COMMENT_UNLIKE){var c=e.getCommentFromStore(a.conversation_uid,a.resource_id,a.app_instance_id);if(!c)return;a.like_info.like_timestamp>c.like_info.like_timestamp&&(e.updateCommentLikeInfoReceivedOnRTCNotification(c,a.like_info),b.type==d.COMMENT_LIKE?h.trigger("commentLikedByRemoteUser",a):h.trigger("commentUnlikedByRemoteUser",a))}else(b.type==d.RESOURCE_LIKE||b.type==d.RESOURCE_UNLIKE)&&(b.type==d.RESOURCE_LIKE?h.trigger("resourceLikedByRemoteUser",a):h.trigger("resourceUnlikedByRemoteUser",a));console.log("RECEIVED: RTCNotification.RESOURCE/COMMENT_LIKE/UNLIKE"),h.trigger("likeRTCChangeReceived")}});var h={likeResource:function(e,g,h,i,j,k,l,m){var n={feed_id:e,resource_id:g,app_instance_id:h,action:i,path_id:g,path_names:'["'+j+'"]',path_types:'["'+k+'"]'},o=b.defer(),p=a.postx("like",n);return p.then(function(a){var b=a.data;a.status;o.resolve(b);var e={};e.like_timestamp=b.likeTimestamp,e.likes_count=b.like_count;var j={resource_id:g,app_instance_id:h,path_ids:g};j.user={},j.user[f.user_id]=_.extend({accessible:!0},_.omit(f.getUserInfo(),"user_id")),m&&(e.sub_res_likes_count=m);var k=new d;"like"==i?(j.last_liked_by=f.user_id,e.liked_by=f.user_id,k.type=d.RESOURCE_LIKE):(j.last_unliked_by=f.user_id,e.liked_by=b.likedBy,k.type=d.RESOURCE_UNLIKE),j.like_info=e,k.data=j,c.send(k)}),o.promise},likeResourceNewApi:function(e,g,h,i,j,k){var l={method:"like",path_id:e,resource_id:g,app_instance_id:h,path_names:i,path_types:j,created_by:k},m=b.defer(),n=a.post("likes",l);return n.success(function(a,b){m.resolve(a);var i={};i.like_timestamp=a.data.like_timestamp,i.likes_count=a.data.like_count,i.liked_by=f.user_id;var j={resource_id:g,app_instance_id:h,path_ids:e,last_liked_by:f.user_id,like_info:i};j.user={},j.user[f.user_id]=_.extend({accessible:!0},_.omit(f.getUserInfo(),"user_id"));var k=new d;k.type=d.RESOURCE_LIKE,k.data=j,c.send(k),console.log("SENT: RTCNotification.RESOURCE_LIKE_OR_UNLIKE")}),m.promise},likeConversation:function(e,g,h,i){var j={conversation_id:e,action:i},k=b.defer(),l=a.postx("like",j);return l.then(function(a){var b=a.data;a.status;k.resolve(b);var j={};j.likes_count=b.like_count,j.like_timestamp=b.like_timestamp;var l={conversation_uid:e,resource_id:g,app_instance_id:h};l.user={},l.user[f.user_id]=_.extend({accessible:!0},_.omit(f.getUserInfo(),"user_id"));var m=new d;"like"==i?(j.liked_by=f.user_id,l.last_liked_by=f.user_id,j.last_liked_by=f.user_id,m.type=d.COMMENT_LIKE):(j.liked_by=b.liked_by,l.last_unliked_by=f.user_id,j.last_unliked_by=f.user_id,m.type=d.COMMENT_UNLIKE),l.like_info=j,m.data=l,c.send(m)}),k.promise},fetchLikesDetails:function(c,d,e,f,g,h){var i={};i=h?{conversation_id:h}:{feed_id:c,resource_id:d,path_id:d,app_instance_id:f,path_names:'["'+g+'"]',path_types:'["'+e+'"]'},i.action="getUsers";var j=b.defer(),k=a.post("like",i);return k.success(function(a,b){j.resolve(a)}),j.promise},getLikeInfo:function(c,d,e,f,g){var h={method:"getLikeInfo",path_id:d,resource_id:e,app_instance_id:f,include_sub_resources:g};c&&(h.feed_id=c);var i=b.defer(),j=a.post("likes",h);return j.then(function(a){i.resolve(a.data)}),i.promise},getLikesDetailWithUsersInfo:function(c,d,e,f,g){var h;h=g?{conversation_uid:g}:{path_id:c,resource_id:d,app_instance_id:e,include_sub_resources:f||null},h.method="getLikeDetails";var i=b.defer(),j=a.post("likes",h);return j.success(function(a,b){i.resolve(a)}),i.promise},unlikeResource:function(e,g,h){var i={method:"unlike",path_id:e,resource_id:g,app_instance_id:h},j=b.defer(),k=a.post("likes",i);return k.then(function(a,b){j.resolve(a);var i={};i.like_timestamp=a.data.data.like_timestamp,i.likes_count=a.data.data.like_count,i.liked_by=a.data.data.liked_by;var k={resource_id:g,app_instance_id:h,path_ids:e,last_unliked_by:f.user_id,like_info:i};k.user={},k.user[f.user_id]=_.extend({accessible:!0},_.omit(f.getUserInfo(),"user_id"));var l=new d;l.type=d.RESOURCE_UNLIKE,l.data=k,c.send(l),console.log("SENT: RTCNotification.RESOURCE_LIKE_OR_UNLIKE")}),j.promise}};return _.extend(h,Backbone.Events),h}]),b.module("convoApp").factory("loginResponseData",function(){function a(a,b){d=a,e=d.xmpp_session_token}function b(){return d}function c(){return e}var d,e,f={};return f.set=a,f.get=b,f.getXmppSessionToken=c,f}),b.module("convoApp").controller("MainCtrl",["$scope","$rootScope","accountInfo","userInfo","alertsService","resourcesTabsManager","homeViewStateInfo","Comments","Likes","rtcNotificationManager","RTCNotification","itemService","$window","$location","AppLinks","Users","Groups","ServerComm","feedDirtyInfo","nativeCommBridge","config","appTabs","chatAppContext","appStateInfo","serverPingService","mixpanelService","Feed","advSearchService","$timeout","searchService","adminService","appWebWorkerManager","pushNotificationsService","perf","appLoadSequenceManager","loader","ContactsWrapper","localStore","appsInfo","logger","$q","$http","$compile","$templateCache","whatsNewService","appFeedViewAbsentOperationsManager","ChatsViewDataManager","utils","networkSettingService","BlackListWordsService",function(d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,aa,ba){function ca(){var a=Q.getAppMainService(Q.NOTES_APP);a.on("noteFileDeleted",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: note file deleted"),ga()}),a.on("noteRevertedToRevision",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: note reverted to revision"),ga()})}function da(a,b){var c=u.getGroup(a);c&&"PUBLIC"!=c.get("access")||(d.$broadcast("reRenderGroupView"),d.$broadcast("forcePollFeedRequest"),(!j.isHomeTabSelected()||e.filterInfo.filterApplied&&e.filterInfo.filterLink.filter)&&d.$broadcast("refetchMainFeedRequest"))}function ea(a,b){var c=j.isHomeTabSelected(),f=k.getState()===k.STATE_GROUP&&k.getToFilter().value===a;j.isGroupSettingsTabSelected(a)?(j.closeTab(j.getSelectedTab(),!0),b?(f&&(r.path("/feed").search({}).hash(""),e.$$phase||e.$digest()),h.isAdminMode()||d.$broadcast("cnvFeed.removeFeedItemsSharedWithGroups",[a])):(f&&r.path("/feed").search({}).hash(""),h.isAdminMode()||d.$broadcast("cnvFeed.removeFeedItemsSharedWithGroups",[a]))):b?(f&&(c?r.path("/feed").search({}).hash(""):d.$broadcast("cnvFeed.clearFilter")),h.isAdminMode()||d.$broadcast("cnvFeed.removeFeedItemsSharedWithGroups",[a])):(f&&(c?r.path("/feed").search({}).hash(""):d.$broadcast("cnvFeed.clearFilter")),h.isAdminMode()||d.$broadcast("cnvFeed.removeFeedItemsSharedWithGroups",[a]))}function fa(){var a=h.getUserId(),b=t.getUser(a),c=b.profile_image_type,d=b.profile_image_version;h.updateUserProfileImageTypeAndVersion(c,d),E.updateUserProfileImageInfo(a,c,d),e.$broadcast("refreshImage"),t.off("usersUpdated",fa)}function ga(){var a=new o;a.type=o.UPDATE_FEED,n.send(a),console.log("SENT: RTCNotification.UPDATE_FEED")}function ha(){var a=s.newResourceLink("13",[{uid:0,type:"11"}],null,"Team Directory");return s.linkToUrl(a,!0)}function ia(){var a=s.newResourceLink("100",[{uid:0,type:"100"},{uid:"2",type:"ConfiguredIntegrations"}],null,"Configured Integrations");return s.linkToUrl(a,!0)}function ja(){var a=s.newResourceLink("12",[{type:"9",uid:0},{type:"networkInformation",uid:0}],null,"Network Information");return s.linkToUrl(a,!0)}function ka(a){var b;if(a.showUnreadAnouncementsIndicator=a.showUnreadAnouncementsIndicator||a.showWhatsNewTooltip,a.isClientVersionLatest){if(a.notifyAboutNewFeatures){if(d.showWhatsNewTooltip!=a.showWhatsNewTooltip){if(d.showWhatsNewTooltip=a.showWhatsNewTooltip,d.showWhatsNewTooltip){W.markWhatsnewTooltipShown(a.anouncementsLastTimeStamp).then(function(){});var c=$(".network-logo-wrapper"),f="onboarding/templates/cnvWhatsNewTooltip.tpl.html",g=V.get(f),h=U(g);c.append(h(d.$new())),c.addClass("cnv-onboarding-clickable")}setTimeout(function(){var a=$(".cnv-whats-new-tooltip");a&&a.length>0&&a.fadeOut(function(){a.remove()})},1e4),b=!0}if(d.showUnreadAnouncementsIndicator!=a.showUnreadAnouncementsIndicator){d.showUnreadAnouncementsIndicator=a.showUnreadAnouncementsIndicator;var i=Ha.indexOf(Oa);-1!==i&&(Ha[i].showIndicator=d.showUnreadAnouncementsIndicator),b=!0}}}else if(!Ga){Ga=!0;var c=$("body"),f="onboarding/templates/cnvUpdateAppTooltip.tpl.html",g=V.get(f),h=U(g);c.append(h(d.$new())),c.addClass("cnv-onboarding-clickable"),b=!0}d.whatsNewData=a,b&&!e.$$phase&&e.$digest()}function la(a,b){for(var d,e,f=0,g=a.length;g>f;f++)d=a[f],e={label:d.accountName+(d.isCompanyAccount?" (my company)":""),conditionalLabelIcon:!0,icon:"cnv-icons-20 check-lightgray"},d.isLoggedIntoAccount?(e.isNotHoverable=!0,e.condition="isLoggedIntoAccount"):(e.callback=Da,e.callbackParam=d.accountId),b!==c?(Ha.splice(b,0,e),b=Ha.indexOf(e)+1):Ha.push(e);return e}function ma(a){$("#mainCont").addClass("network-alert-displayed"),d.$broadcast("cnvNetworkAlert.showAlert",a),e.networkAlertDisplayed=!0,Pa=!0}function na(){$("#mainCont").removeClass("network-alert-displayed"),e.networkAlertDisplayed=!1,Pa=!1}function oa(a){d.$broadcast("cnvNetworkAlert.showAlert",a)}function pa(){j.isFullViewChatOpen()||(d.$broadcast("reFetchFeed"),r.url("/feed"))}function qa(){if(za(),B.setSigningOut(),d.destroyAppView(),z.disposeThisTab(),q.Intercom("shutdown"),P.clear(),y.IS_NATIVE)x.logoutApp(),q.location.href=y.LOGOUT_URL;else{var a=J.unRegisterPushNotificationsServiceWebWorkerOnSignout(),b=K.getPushSubscriptionId();a?a.then(function(){b&&b.length>0?q.location.href=y.LOGOUT_URL+"&registration_id="+b:q.location.href=y.LOGOUT_URL}):b&&b.length>0?q.location.href=y.LOGOUT_URL+"&registration_id="+b:q.location.href=y.LOGOUT_URL}}function ra(){D.trackEvent(D.SIGN_OUT_CLICK,null,!0),setTimeout(function(){z.dispatchTabsEvent2("userSignOutClickInTab",null,!0),qa()},10)}function sa(){function a(){T.get(y.LOGIN_URL+"?is_ajax=1",{timeout:3e4}).then(function(a){b.resolve(a.data)},function(b){401==b.status?q.location.reload(!1):setTimeout(a,1e3)})}var b=S.defer();return a(),b.promise}function ta(a){for(var b,c=f.getAccountLevel(),d=h.userRole,e=a.account_id,g=a.user_accounts,i=0;i<g.length;i++)if(g[i].account_id===e){b=g[i];break}return b.account_level!==c||b.user_role!==d?!0:!1}function ua(a){d.$emit("MainCtrl.handleRefreshSessionResponseData",a)}function va(){sa().then(function(a){ta(a)?xa(!1):(v.stopBlockingRequests(),v.setSessionExpired(!1),ua(a),B.setRefreshingOnSessionExpired(!1))})}function wa(a){v.startBlockingRequests(),a?Aa(c,va):va()}function xa(a){za(),d.destroyAppView(),a?(console.error("tag:apptabs: reload app after delay or on app focus"),Aa(c,function(){console.log("tag:apptabs: reloading app after delay or on app focus"),z.disposeThisTab(),ya(!1)})):(z.disposeThisTab(),ya(!1))}function ya(a){Fa=!0,q.location.reload(a)}function za(){v.startBlockingRequests(),n.disconnect(),A.disconnect(),z.disposeLastActiveTabManagementProcess()}function Aa(a,b){function c(){console.error("tag:apptabs: MainCtrl.onAfterDelayOrAppFocus: on app focus",(new Date).toString()),clearTimeout(e),B.off("appFocus",c),b()}var d=8;d+=Math.ceil(25*Math.random()),B.on("appFocus",c);var e=setTimeout(function(){console.error("tag:apptabs: MainCtrl.onAfterDelayOrAppFocus: on delay timeout. delay: "+d+"s",(new Date).toString()),B.off("appFocus",c),b()},1e3*d)}function Ba(a){i.alertModal("Get the latest Convo","A new version of Convo is available now.<br><br>Every update of Convo includes improvement for speed and reliability.","Get it now",function(){z.dispatchTabsEvent2("appUpdateAvailableAlertClickedInTab",a,!0),B.setRefreshingOnAppUpdateAvailable(),xa()},!0,!0)}function Ca(a,b){za(),B.setSwitchingNetwork(),d.destroyAppView(),z.disposeThisTab();var c=y.LOGIN_URL+"?a="+encodeURIComponent(a);b&&(c+="&redirect="+encodeURIComponent(b)),q.location.href=c}function Da(a,b,c){D.trackEvent(D.CLICK_IN_LEFT_MENU,{Type:"Network Switch"},!0),console.log("switch to network: "+c),z.dispatchTabsEvent2("switchToNetworkClickInTab",c,!0),Ca(c)}function Ea(){B.setRefreshingOnUserRemovedFromNetwork(),qa()}L.recordMeasure("MainCtrl begin");var Fa=!1;d.account_info=f,d.onBoarding_info={},d.onBoarding_info.active=!0,d.onBoarding_info.preventInlineInsertCollapse=!1,d.user_info=h,d.showCompactChat=aa.getChatStatus(),d.showGiphy=aa.getGiphyStatus(),d.isAccountBlocked=aa.isAccountBlocked(),1===d.isAccountBlocked&&(d.showCompactChat=!1),k.init(d),j.init(d),ba.getBlackListWordsList(),d.$on("resourceLinkChange",function(a,b){j.openResource(b)}),d.$on("filterChange",function(a){j.switchToHomeTab(function(b){b||a.preventDefault()},function(){a.preventDefault()})}),d.$on("goHome",function(a){if(j.isHomeTabSelected()){var b=d.filterInfo;b.filterApplied&&b.filterLink.filter?r.path("/feed").search({}).hash("title=My Feed"):d.$broadcast("pollFeedRequest",!1,"USER_ACTION: goHome"),$(q).scrollTop(0)}else j.selectHomeTab()}),d.$on("networkLogoClicked",function(a,b){var c=b;if(c.ctrlKey||c.metaKey||j.isHomeTabSelected()||j.signalHomeTabToScrollToTopUponActivation(),j.isFullViewChatOpen()&&(e.fullViewChatItem=Y.getSelectedItem()),c.ctrlKey||c.metaKey||!j.isHomeTabSelected())return!0;var f=d.filterInfo;f.filterApplied&&f.filterLink.filter||(d.$broadcast("pollFeedRequest",!1,"USER_ACTION: networkLogoClicked"),$("#feedScroller").animate({scrollTop:0},{duration:400})),H.clearSearch(),F.closePanelWithoutAnim()}),d.$on("videoPlayback:MinimizeVideo",function(){d.$broadcast("videoPlayback:MinimizeVideoIfFullScreen")}),d.$on("hideCompactChat",function(){d.showCompactChat=!1,d.$$phase||d.$digest()}),d.$on("showCompactChat",function(){d.showCompactChat=!0,d.$$phase||d.$digest()}),d.$on("refreshFeed",function(a,b,c){d.$broadcast("pollFeedRequest",b,c)}),d.$on("refetchMainFeedRequest",function(){d.$broadcast("refetchMainFeed")}),l.on("commentRTCChangeReceived",function(){d.$broadcast("pollFeedRequest",!1,"RTC: comment")}),l.on("commentAdded",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: comment added")}),l.on("commentUpdated",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: comment updated")}),l.on("commentDeleted",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: comment deleted")}),m.on("likeRTCChangeReceived",function(){d.$broadcast("pollFeedRequest",!1,"RTC: like")}),m.on("resourceLikedUnliked",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: like/unlike")}),p.on("itemMovedToTrash",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item trashed"),ga()}),p.on("itemRestored",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item restored"),ga()}),p.on("itemDeletedPermanently",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item deleted permanently"),ga()}),p.on("itemSharingInfoUpdated",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item sharing info updated"),ga()}),p.on("itemTagsUpdated",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item tags updated"),ga()}),p.on("itemStarred",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item starred")}),p.on("itemUnstarred",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item unstarred")}),p.on("itemPermissionChanged",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item permissions updated"),ga()}),p.on("itemPermissionChangedByRemoteUser",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: item permissions updated by remote user")}),Q.isAppRegistered(Q.NOTES_APP)?ca():Q.once(Q.NOTES_APP+"Registered",ca),u.on("userRemovedFromGroupByRemoteUser",function(a,b){b===h.getUserId()&&ea(a,!0)}),u.on("userRemovedFromGroup",function(a,b){b===h.getUserId()&&ea(a,!1)}),u.on("groupJoinReqSentByRemoteUser",function(a,b){b===h.getUserId()&&da(a,!0)}),u.on("groupJoinReqSent",function(a,b){b===h.getUserId()&&da(a,!1)}),u.on("groupDeletedByRemoteUser",function(a){ea(a,!0)}),u.on("groupDeleted",function(a){ea(a,!1)}),u.on("groupsDeletedOrUserRemovedFrom",function(a){for(var b=0;b<a.length;b++)ea(a[b],!0)}),u.on("toggledShowHidePostsInFeed",function(a,b,c){d.$broadcast("refetchMainFeedRequest")}),t.on("userInvitedToNetwork",function(){d.$broadcast("pollFeedRequest",!1,"FORCE: someone invited to network from this user.")}),O.on("contactsSubmittedOnServer",function(){d.$broadcast("pollFeedRequest",!1)}),d.$on("newPostPublishedViaAddBox",function(){ga()}),d.$on("newPostPublishedViaAddBoxInMenulet",function(){ga()}),d.$on("notesApp:noteTextEdited",function(){console.log("EVENT: notesApp:noteTextEdited"),d.$broadcast("pollFeedRequest",!1,"FORCE: note text edited"),ga()}),d.$on("userFollowed",function(){d.$broadcast("reFetchFeed")}),d.$on("refetchFeed",function(){d.$broadcast("reFetchFeed")}),d.$on("userUnfollowed",function(){d.$broadcast("reFetchFeed")}),d.$on("openComposeBox",function(a,b){d.composeBoxInitData=b,j.isHomeTabSelected()||(j.signalHomeTabToScrollToTopUponActivation(),r.url("/#/feed")),setTimeout(function(){$(".dummy-text-area").trigger("onCustomClick",b)},0)}),d.$on("userProfilePictureUpdated",function(a,b,e){b!==c&&e!==c&&(h.updateUserProfileImageTypeAndVersion(b,e),E.updateUserProfileImageInfo(h.getUserId(),b,e)),d.$broadcast("pollFeedRequest",!1,"FORCE: user profile pic updated"),t.on("usersUpdated",fa)}),n.addListener(g.rtc.PubsubEvents.NOTIFICATION_RECEIVE,function(a){var b=a.notification;b.type==o.UPDATE_FEED&&(console.log("RECEIVED: RTCNotification.UPDATE_FEED"),d.$broadcast("pollFeedRequest",!1,"RTC: update feed"),X.pollFeed())}),Notify.needsPermission()&&Notify.requestPermission(),q.com_convo.homeAppLoadedInitially?d.$on("cnvFeed::firstFeedRenderStart",function(){L.recordEvent(L.EVENT__FEED_RENDER_START),M.recordLoad(M.comps.FEED_RENDER_START),setTimeout(function(){N.preloadScripts(),N.preloadStyles()},1e3)}):(setTimeout(function(){M.loadCompsUnrelatedToFeed(),setTimeout(function(){N.preloadScripts(),N.preloadStyles()},1e3)},0),d.$on("cnvFeed::firstFeedRenderStart",function(){L.recordEvent(L.EVENT__FEED_RENDER_START),M.recordLoad(M.comps.FEED_RENDER_START)}),X.init()),d.showNotificationDropdown=!1,d.dropdownCtrl={},d.dropdownCtrl.type="header-network-menu",d.isLoggedIntoAccountCondition={isLoggedIntoAccount:!0},d.showSlimNetworkMenuDropdown=function(){return j.isHomeTabSelected()},C.on("whatsNewDataUpdate",ka),d.whatsNewData=null;var Ga=!1;d.$on("cnvDropdownToggled",function(a,b){var c=$(".cnv-whats-new-tooltip");c&&c.length>0&&c.remove()}),d.closeGetUpdateTooltip=function(){D.trackEvent(D.DISMISS_APP_UPDATE_BANNER,{}),$(".cnv-get-update-tooltip").remove()},d.reloadAppForUpdate=function(){var b=setTimeout(function(){a.location.reload(!0)},5e3);D.trackEvent(D.CLICK_APP_UPDATE_BANNER_RELOAD,{},!0,function(){clearTimeout(b),a.location.reload(!0)},function(c,d,e){clearTimeout(b),a.location.reload(!0)})};var Ha=[],Ia={label:"Network settings",callback:function(){D.trackEvent(D.CLICK_ON_NETWORK_SETTINGS,{}),q.location.href=ja()}};h.on("userInfo.userRoleUpdated",function(){var a=Ha.indexOf(Ia);h.isGuestUser()||!h.isAdmin()&&"STARTER"!==f.getAccountLevel()?a>-1&&Ha.splice(a,1):Ha.push(Ia);var b=Ha.indexOf(Ja);-1!==b||h.isGuestUser()||!h.isAdmin()&&"STARTER"!==f.getAccountLevel()?b>-1&&Ha.splice(b,1):Ha.splice(Ha.indexOf(Ka),0,Ja)}),h.isGuestUser()||!h.isAdmin()&&"STARTER"!==f.getAccountLevel()||Ha.push(Ia),Ha.push({label:"Manage integrations",url:ia()}),d.user_info.userRole!=d.user_info.USER_ROLE_GUEST&&Ha.push({label:"Team directory",url:ha()});var Ja={label:"Change Network Logo",url:ja()},Ka={isDivider:!0};h.isGuestUser()||!h.isAdmin()&&"STARTER"!==f.getAccountLevel()?Ha.push(Ka):(Ha.push(Ja),Ha.push(Ka));var La={label:"SWITCH NETWORKS",isNotHoverable:!0},Ma={isDivider:!0};f.on("accountInfo.updated.allUserAccounts",function(){var a=f.getUserAccountsListForNetworkSwitchingMenu(),b=Ha.indexOf(La),c=Ha.indexOf(Ma);if(a.length<=1){var d=c-b+1;-1!==b&&Ha.splice(b,d)}else{Ha.splice(b+1,c-b-1),-1===b&&Ha.splice(Ka,0,La);var e=la(a,b+1);-1===c&&Ha.splice(e,0,Ma)}});var Na=f.getUserAccountsListForNetworkSwitchingMenu();Na.length>=2&&(Ha.push(La),la(Na),Ha.push(Ma)),Ha.push({label:"Get apps",callback:function(){D.trackEvent(D.CLICK_ON_GET_APPS_MENU_ITEM,{});var a="home/components/downloadAppsModal/downloadAppsModal.tpl.html",b="DownloadAppsModalCtrl";i.customModal(a,b,null,"download-apps-modal-wrapper")}}),h.isGuestUser()||f.shouldInviteGuestsAsFullMembers()||Ha.push({label:"Get shareable invite link",callback:function(){D.trackEvent(D.CLICK_ON_GET_SHAREABLE_LINK_MENU_ITEM,{});var a="common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",b="findContactsSplashCtrl",c={data:function(){return{requestedView:"VANITY_URL"}}};i.customModal(a,b,c).result.then(function(a){console.log("invite complete.")},function(){console.log("invite complete.")})}}),d.showWhatsNewDialog=function(a){a?D.trackEvent(D.CLICK_WHATS_NEW_MENU_ITEM,{}):D.trackEvent(D.CLICK_WHATS_NEW_TOOL_TIP,{}),$(".cnv-whats-new-tooltip").remove(),W.markAnnouncementsAsRead(d.whatsNewData.anouncementsLastTimeStamp).then(function(){C.getUpdatesFromServer()}),d.showUnreadAnouncementsIndicator=!1,d.showWhatsNewTooltip=!1;var b=Ha.indexOf(Oa);-1!==b&&(Ha[b].showIndicator=!1);var c="home/components/cnvWhatsNewDialog/whatsNew.tpl.html",e="cnvWhatsNew",f={data:function(){return d.whatsNewData}},g="cnv-whats-new-modal";i.customModal(c,e,f,g).result.then(function(a){console.log("invite complete.")},function(){console.log("invite complete.")})};var Oa={label:"What's new","class":"whats-new-menu-item active",icon:"cnv-icons-16 whatsNewIcon-white whatsNewIcon-white-style",callback:function(){d.showWhatsNewDialog(!0)}};Ha.push(Oa),Ha.push({label:"Contact support",url:"mailto:support@convo.com",callback:function(){D.trackEvent(D.CLICK_ON_CONTACT_SUPPORT_MENU_ITEM,{})}}),Ha.push({label:"Sign out",callback:ra}),d.dropdownCtrl.options=Ha,d.dropdownCtrlSlim=_.clone(d.dropdownCtrl),d.dropdownCtrlSlim.type="header-network-menu-slim",e.attachMixpanelSuperProperties=function(a){var d={UsedJSHeapSize:-1,TotalJSHeapSize:-1,JsHeapSizeLimit:-1},e=L.getMemoryUsageNumbers();e&&e.usedJSHeapSize!==c&&(d.UsedJSHeapSize=e.usedJSHeapSize,d.TotalJSHeapSize=e.totalJSHeapSize,d.JsHeapSizeLimit=e.jsHeapSizeLimit);var f,g=z.getNumBrowserTabsOpen(),h=Math.ceil((Date.now()-z.getThisTabInitTS())/1e3/60);if(j.isHomeTabSelected())f=E.getIsFeedScrolledMoreThanOneFeedItem()?"Feed Scrolled":"Feed Top";else{var i=j.getSelectedTab();f=Q.getAppInfoByAppInstanceId(i.appInstanceId).title}return b.extend(a,{"SP UsedJSHeapSize":d.UsedJSHeapSize,"SP TotalJSHeapSize":d.TotalJSHeapSize,"SP JsHeapSizeLimit":d.JsHeapSizeLimit,"SP Num Tabs":g,"SP Tab Life":h,"SP View State":f,"SP App Version":y.APP_VERSION}),a};var Pa=!1;d.$on("cnvNetworkAlert.alertDismissed",function(){na()}),d.$on("cnvNetworkAlert.linkInTextClicked",function(a,b){b&&-1!==b.indexOf("upgradeNetwork")&&d.$broadcast("cnvNetworkAlert.dismissAlert")}),C.on("limitsBannerDataUpdate",function(a){a&&(1==a.show?Pa?oa(a):ma(a):Pa&&(na(),d.$broadcast("cnvNetworkAlert.hideAlert")))});var Qa=e.login_data.onboarding_state.limits_banner_data;Qa&&1==Qa.show&&setTimeout(function(){ma(Qa)},0),w.setIsDirty(!1),d.$on("feedUpdatesFromOtherUsersReceived",function(){w.setIsDirty(!0)}),j.on("homeTabSelected",function(){w.setIsDirty(!1)}),j.on("homeTabUnselected",function(){d.$broadcast("clearFeedSearchBarText")}),j.on("homeTabLoaded",function(){X.halt()}),x.on("nativeCommBridge::switchedToCompactSize",function(){d.$broadcast("MainCtrl::appSwitchedToCompactSize")}),x.on("nativeCommBridge::switchedToDefaultSize",function(){d.$broadcast("MainCtrl::appSwitchedToDefaultSize")}),v.on("callAwaitingFirstFeedFetchCallResolution",function(a){R.logToServer("serverComm.callAwaitingFirstFeedFetchCallResolution: "+a,R.INFO)}),v.on("requestFailed",function(a){L.recordCounter("numFailedServerRequests"),L.recordLog("FailedServerRequest: "+a)}),I.on("refetchFeedOnAdminModeSwitched",pa),z.addTabsEventListener2("closeChatWindow",function(){d.$broadcast("closeChatEmojiPopover");var a=Z.createEvent("recalculateAutocompletePosition");document.dispatchEvent(a)}),x.on("logout",qa),z.addTabsEventListener2("userSignOutClickInTab",qa),d.$on("userSignOutClick",ra),q.addEventListener("unload",function(){z.disposeThisTab(),Fa=!1}),v.on("sessionExpired",function(){console.error("session expired",(new Date).toString()),B.getRefreshingOnSessionExpired()||B.getAppUpdateAvailable()||(B.setRefreshingOnSessionExpired(!0),z.dispatchTabsEvent2("sessionExpiredInTab",null,!0),wa())}),z.addTabsEventListener2("sessionExpiredInTab",function(){console.error("session expired received from other tab",(new Date).toString()),B.getRefreshingOnSessionExpired()||B.getAppUpdateAvailable()||(B.setRefreshingOnSessionExpired(!0),wa(!0))}),v.on("appUpdateAvailable",function(a){B.getAppUpdateAvailable()||(B.setAppUpdateAvailable(),z.dispatchTabsEvent2("appUpdateAvailableInTab",a,!0),za(),Ba(a))}),z.addTabsEventListener2("appUpdateAvailableInTab",function(a){B.getAppUpdateAvailable()||a<=y.APP_VERSION||(B.setAppUpdateAvailable(),za(),Ba(a))}),z.addTabsEventListener2("appUpdateAvailableAlertClickedInTab",function(a){a>y.APP_VERSION&&(B.setRefreshingOnAppUpdateAvailable(),xa(!0))}),d.$on("AppCtrl.switchNetwork",function(a,b,c){z.dispatchTabsEvent2("switchToNetworkClickInTab",b,!0),Ca(b,c)}),z.addTabsEventListener2("switchToNetworkClickInTab",function(a){console.log("switch to network received from other tab: "+a),Ca(a)}),d.$on("cnvPremiumUpgrade:upgradedToPremium",function(a,b){z.dispatchTabsEvent2("upgradedToPremiumRefreshAllTabs",null,!0),B.setRefreshingOnUpgradedToPremium(),xa()}),z.addTabsEventListener2("upgradedToPremiumRefreshAllTabs",function(){B.setRefreshingOnUpgradedToPremium(),xa(!0)}),t.on("userRemovedFromNetwork",function(a){a===h.getUserId()&&(console.error("this user removed from network"),Ea())}),t.on("userRemovedFromNetworkByRemoteUser",function(a){a===h.getUserId()&&(console.error("this user removed from network by remote user"),Ea())}),C.on("networkNoLongerAccessibleToUser",function(){Ea()}),z.addTabsEventListener2("reload",function(){location.reload()})}]),b.module("convoApp").factory("appFeedViewAbsentOperationsManager",["serverPingService","appTabs","Likes","Comments","connectivity","Feed","appStateInfo","Groups",function(a,b,c,d,e,f,g,h){function i(){b.isThisTabLastActiveTab()?(p=setInterval(m,r),d.on("commentRTCChangeReceived",m),c.on("likeRTCChangeReceived",m),e.on("up",m)):q=setInterval(m,s),b.on("thisTabLastActiveChanged",j),b.on("onTabFocus_alreadySetAsLastActiveTab",m),g.on("appActivate",m),f.fetchFeed(0,1),h.fillRelevanciesInListableGroups(!1),t=!0}function j(a){a?(p=setInterval(m,r),d.on("commentRTCChangeReceived",m),c.on("likeRTCChangeReceived",m),e.on("up",m),clearInterval(q),l()):(clearInterval(p),d.off("commentRTCChangeReceived",m),c.off("likeRTCChangeReceived",m),e.off("up",m),q=setInterval(m,s))}function k(){setTimeout(l,2e3)}function l(){a.getUpdatesFromServer()}function m(){v||(v=!0,f.pollFeed(u).then(function(a){v=!1,a=a.data,u=a.last_feed_poll_timestamp,k()},function(){v=!1}))}function n(){clearInterval(p),clearInterval(q),d.off("commentRTCChangeReceived",m),c.off("likeRTCChangeReceived",m),e.off("up",m),b.off("thisTabLastActiveChanged",j),b.off("onTabFocus_alreadySetAsLastActiveTab",m),g.off("appActivate",m),t=!1}var o={};_.extend(o,Backbone.Events);var p,q,r=6e4,s=9e5,t=!1,u=null,v=!1;return o.init=i,o.halt=n,o.pollFeed=function(){t&&b.isThisTabLastActiveTab()&&m()},o.reFetchFeedOnSessionRefresh=function(){t&&f.fetchFeed(0,1)},o}]),b.module("convoApp").directive("cnvMainHeaderPanel",["resourcesTabsManager","alertsService","AppLinks","$location","$rootScope","onboardingService","userInfo","adminService","bannerService","$compile","$templateCache","appLoadSequenceManager",function(b,c,d,e,f,g,h,i,j,k,l,m){
return{restrict:"AE",scope:!0,link:function(n,o,p){function q(a){var b="home/userView/centerPanelWidgets/profilePictureModal.tpl.html",d="ProfilePictureModalCtrl",e={startWebcam:function(){return!1},file:function(){return a}},f=c.customModal(b,d,e,"cnvUserProfilePictureModal",!0);f.result.then(function(a){n.$emit("userProfilePictureUpdated")})}function r(){u=[],u.push({label:n.user_info.first_name+" "+n.user_info.last_name,subtext:n.user_info.email,callback:n.openUserProfile,escapeAngularBindings:!0},{label:"Edit profile",callback:n.editUserProfile},{isDivider:!0},{label:"Change your photo",callback:n.openCombinedSetProfilePictureModal},{label:"Notification preferences",callback:function(){var a=d.newResourceLink("12",[{type:"9",uid:0},{type:"notificationsSettings",uid:0}],null,"Notification Settings"),b=d.linkToUrl(a,!0);e.url(b.slice(1))}},{isDivider:!0}),u.push({label:"Settings",callback:function(){var a=d.newResourceLink("12",[{type:"9",uid:0},{type:"myAccountSettings",uid:0}],null,"My account settings"),b=d.linkToUrl(a,!0);e.url(b.slice(1))}}),h.isAdmin()&&h.isAdminMode()?u.push({label:"Exit admin mode",callback:n.exitAdminMode}):h.isAdmin()&&u.push({label:"Enter admin mode",callback:n.enterAdminMode}),u.push({label:"Sign Out",callback:n.logoutUser}),n.userMenuDropdownCtrl.options=u}function s(){var c="main/templates/header/mainHeaderPanel.tpl.html",d=k(l.get(c))(n);o.empty().append(d),B=o.find(".network-logo-wrapper"),a.setTimeout(function(){t=o.find(".network-logo-container .name"),b.isHomeTabSelected()||b.isSettingTabSelected()||z()},0),C=o.find("#headerDpUploadInput"),C.on("change",function(a){this.files.length>0&&q(this.files[0])}),r()}n.isAdminMode=h.isAdminMode(),n.userMenuDropdownCtrl={type:"c2c2c2-png"},n.userMenuDropdownCtrl.options=[],n.onboardingStateActive=g.checkState();var t,u=n.userMenuDropdownCtrl.options,v=".floating-panel-wrapper",w=".menu-icon",x=function(){B&&B.removeAttr("style"),t&&t.removeAttr("style")},y=function(){B&&B.removeAttr("style"),t&&t.removeAttr("style")},z=function(){B&&(B.css("background","#fff"),B.css("border-bottom","1px solid #e5e5e5")),t&&t.css("color","#2b2b2b")};n.openDpFilePicker=function(){C.click()},n.openCombinedSetProfilePictureModal=function(){var a="components/combinedSetProfilePictureModal/combinedSetProfilePictureModal.tpl.html",b="CombinedSetProfilePictureModalCtrl",d=c.customModal(a,b,null,"combined-set-pic-modal");d.result.then(function(){n.$emit("userProfilePictureUpdated")})},n.enterAdminMode=function(){var a=i.switchToAdminMode();j.showBanner_promise(a,"Switching to Admin Mode","Switched to Admin Mode","Error Switching to Admin Mode. Please try again.",!1,!1),a.then(function(a){e.url("/feed"),n.$emit("refetchFeed")})},n.exitAdminMode=function(){var a=i.exitAdminMode();j.showBanner_promise(a,"Exiting Admin Mode",null,"Error exiting admin mode. Please try again.",!1,!1),a.then(function(a){e.url("/feed"),n.$emit("refetchFeed")})},n.toggleDropdown=function(a){var b=$(a.target).closest(".user-menu-dropdown-widget");b&&0!=b.length||setTimeout(function(){o.find(".user-menu-dropdown-widget .dropdown-toggle").trigger("click")},0)},b.on("homeTabSelected",x),b.on("settingTabSelected",y),b.on("homeTabUnselected",z),n.user_info.on("userAccountEmailUpdated",r),f.$on("root_scope:reRenderUserView",function(a){a.preventDefault(),r()}),n.$on("reRenderUserView",function(a){r(),n.$broadcast("refreshImage")}),h.on("userInfo.adminModeChanged",function(){n.isAdminMode=h.isAdminMode(),r()}),f.$on("cnvHomeLeftPanel:fullMenuVisible",function(){}),f.$on("cnvHomeLeftPanel:fullMenuHidden",function(){});var A=function(a){var b=o.find(v),c=o.find(w);b.is(a.target)||0!==b.has(a.target).length||c.is(a.target)||0!==c.has(a.target).length||(n.showFloatingColumn=!1,n.$$phase||n.$digest(),$(document).off("mouseup",A))};n.toggleFloatingColumn=function(){n.showFloatingColumn=!n.showFloatingColumn,n.showFloatingColumn?$(document).on("mouseup",A):$(document).off("mouseup",A)},n.$on("showHideHeaderFloatingColumn",function(a,b){n.showFloatingColumn=b,n.$$phase||n.$digest(),n.showFloatingColumn&&$(document).on("mouseup",A)}),n.$on("$destroy",function(){C.off("change")});var B=null,C=null;m.okToLoad(m.comps.HEADER_PANEL)?s():m.on("okToLoad"+m.comps.HEADER_PANEL,function(){s(),n.$digest()})},controller:["$scope","$filter","$location","AppLinks","Filters","FilterTypes","$window","$rootScope","homeViewStateInfo",function(a,b,c,d,e,f,h,i,j){a.showFloatingColumn=!1,a.openUserProfile=function(a){var b={url:d.linkToUrl(d.newFilterLink(e.newANDFiltersChain([e.newFilter(f.FROM,"me","me")]),"User Profile"),!0)};c.url(decodeURIComponent(b.url.slice(1)))},a.editUserProfile=function(){var a={url:d.linkToUrl(d.newFilterLink(e.newANDFiltersChain([e.newFilter(f.FROM,"me","me")]),"User Profile"),!0)};c.url(decodeURIComponent(a.url.slice(1))).search("action","editProfile"),i.$broadcast("openEditProfileWidget")},a.logoutUser=function(){a.$emit("userSignOutClick")},a.viewState=j.getState(),a.$on("homeViewStateChange",function(){a.viewState=j.getState()}),g.on("cnvOnboarding:stateChange",function(){a.onboardingStateActive=g.checkState()})}]}}]),b.module("convoApp").directive("cnvInAppNotificationsDropdown",["$rootScope",function(b){return{restrict:"E",scope:!0,templateUrl:"main/components/cnvInAppNotificationsDropdown/cnvInAppNotificationsDropdown.tpl.html",controller:["$scope","InAppNotifications","$filter","datetimeService","serverPingService","settingsService","appTabs","config","mixpanelService",function(b,d,e,f,g,h,i,j,k){function l(a){var b,c,d;a.pathTypes&&(b=JSON.parse(a.pathTypes)),a.pathIds&&(c=a.pathIds.split(",")),a.pathNames&&(d=JSON.parse(a.pathNames));var f=[];if(b&&c)for(var g=0;g<b.length;g++)f.push({uid:c[g],type:b[g],title:d[g]});a.actionBy=a.actionBy.split(",");var h=e("inAppNotificationsTemplate")(a,f);return{template:h,original:a,uniqueId:a.notificationId+a.timestamp,timestamp:a.timestamp,updateTimestamp:a.updateTimestamp,isDeleted:a.isDeleted}}function m(){var d=g.getIpnUnreadCount(),e=parseInt(d.update_timestamp),f=d.count?d.count:0,k=f!=b.sharedNotificationsContext.unreadNotificationsCount,l=f>b.sharedNotificationsContext.unreadNotificationsCount,m=k;if(e!=q&&(q=e,m=!0),b.sharedNotificationsContext.unreadNotificationsCount=f,b.showNotificationDropdown&&(b.sharedNotificationsContext.unreadNotificationsCount>0||m)?(b.updateNotificationsTimeSeparators(),b.getLatestUnreadNotifications(!1,e)):m&&(0==b.notifications.length?b.getNotifications(c,!0,!0):b.getLatestUnreadNotifications(!0,e)),l){if(h.isBitONOFF(h.isSoundEnabled(),h.DESKTOP)&&q>t&&a.Audio){var n=new Audio("assets/sounds/inApp_audio."+(j.IS_NATIVE?"wav":"mp3"));n.play()}b.ipnUnreadCountIncremented&&b.ipnUnreadCountIncremented()}i.dispatchTabsEvent2("ipnUnreadCountUpdateReceivedInTab",q),t=0}function n(a){i.isThisTabLastActiveTab()||(t=a)}function o(){if(b.notifications.length){var a=d.markAllAsViewed(b.notifications[0].original.timestamp);a.then(function(){b.sharedNotificationsContext.unreadNotificationsCount=0,b.$broadcast("render")})}}var p,q,r=!1,s=!1,t=0;b.sharedNotificationsContext=d.getSharedNotificationsContext(),b.notifications=b.sharedNotificationsContext.notifications,b.server_now_timestamp=f.getServerTimestamp(),b.showSpinner=!1,b.getNotifications=function(a,c,e){if(!(r||"-1"===a&&s)){r=!0,b.showSpinner=!0,b.$broadcast("render");var f=d.getNotifications(a,c);f.then(function(f,g){for(var h=f.data.notifications,i=0;i<h.length;i++){for(var j=h[i],k=j.notificationId,m=-1,n=b.notifications.length,p=!1,t=0;n>t;t++)if(b.notifications[t].original.notificationId==k){m=t,p=!0;break}j.isDeleted?p&&b.notifications.splice(m,1):p||d.getNotificationTemplate(j)&&b.notifications.push(l(j))}c&&!e&&o(),"-1"!==a||f.data.more_available||(s=!0),c&&(q=d.getMaxUpdateTimestamp()),r=!1,b.showSpinner=!1,b.$broadcast("render"),b.checkIfThereAnyUnreadNotification()},function(){r=!1})}},b.markAsRead=function(a){var c=d.markAsRead(a);c.then(function(c,d){for(var e=0;e<b.notifications.length;e++)if(b.notifications[e].original.notificationId==a){b.notifications[e].original.isRead=1,b.$broadcast("render");break}b.checkIfThereAnyUnreadNotification()}),b.showHideDropdown()},b.markAllAsRead=function(){var a=d.markAllAsRead();a.then(function(a,c){for(var d=0;d<b.notifications.length;d++)b.notifications[d].original.isRead=1;b.showMarkAllAsReadLink=!1,k.trackEvent(k.CLICK_MARK_ALL_AS_READ),b.$broadcast("render")})},b.checkIfThereAnyUnreadNotification=function(a){b.showMarkAllAsReadLink=!1;for(var c=0;c<b.notifications.length;c++)if(0==b.notifications[c].original.isRead){b.showMarkAllAsReadLink=!0;break}a||b.$broadcast("render")},b.getLatestUnreadNotifications=function(a,c){if(!r){r=!0;var e=d.getNotifications("1",!1);e.then(function(e,f){var g=e.data.notifications;if(e.type&&g.length>0){c&&d.useUpdateTimestampReceivedInUpdatesCallIfGreaterThanSelfMaintainedOne(c);var h={},i=!1;_.each(b.notifications,function(a){h[a.original.notificationId]=a});for(var j=g.length-1;j>=0;j--){var k=g[j],m=h[k.notificationId];if(m){if(k.timestamp>m.original.timestamp||k.updateTimestamp>m.original.updateTimestamp){var n=b.notifications.indexOf(m);if(b.notifications.splice(n,1),!k.isDeleted){var p=0;k.timestamp===m.original.timestamp&&(p=n);var q=l(k);h[q.original.notificationId]=q,b.notifications.splice(p,0,q)}i=!0}}else k.isDeleted||d.getNotificationTemplate(k)&&b.notifications.splice(0,0,l(k))}b.sharedNotificationsContext.canPurgeNotificationsData()&&(d.purgeNotificationsData(),s=!1),i&&(b.$$phase||b.$digest()),b.checkIfThereAnyUnreadNotification()}a||o(),r=!1},function(){r=!1})}},b.updateNotificationsTimeSeparators=function(){if(b.notifications.length&&b.notifications[0].template.timeSeparator!=e("dateSeparatorFromCurrentTimeByDayMonthOrYear")(b.notifications[0].original.timestamp))for(var a=0;a<b.notifications.length;a++)b.notifications[a].template.timeSeparator=e("dateSeparatorFromCurrentTimeByDayMonthOrYear")(b.notifications[a].original.timestamp)},b.getUpdatedServerNowTimeStamp=function(){b.server_now_timestamp=f.getServerTimestamp(),b.$broadcast("render_date")},p=setInterval(function(){b.showNotificationDropdown&&b.getUpdatedServerNowTimeStamp()},6e4),b.purgeOlderNotifications=function(){b.sharedNotificationsContext.canPurgeNotificationsData()&&(d.purgeNotificationsData(),s=!1,b.showNotificationDropdown&&(b.$$phase||b.$digest(),b.$broadcast("render")))},i.addTabsEventListener2("ipnUnreadCountUpdateReceivedInTab",n),g.on("ipnUnreadCountUpdate",m),m(),b.trackOpenEvent=function(a){k.trackEvent(k.CLICK_NAVIGATION_CENTER,{Via:a})},b.$on("$destroy",function(){g.off("ipnUnreadCountUpdate",m),i.removeTabsEventListener2("ipnUnreadCountUpdateReceivedInTab",n),clearInterval(p)})}],link:function(a,d,e){function f(b){a.showNotificationDropdown&&!d.is(b.target)&&0==d.has(b.target).length&&a.showHideDropdown()}var g,h,i,j,k=d.find(".scrollable"),l=d.find(".scrollable").children(),m=d.find(".docked-date-separator"),n=$(d).find(".badge");a.ipnUnreadCountIncremented=function(){n.addClass("badge-pulse"),j=setTimeout(function(){n.removeClass("badge-pulse")},500)},a.showHideDropdown=function(){if(a.showNotificationDropdown=!a.showNotificationDropdown,a.showNotificationDropdown){a.updateNotificationsTimeSeparators(),0==a.notifications.length?a.getNotifications(c,!0,!1):a.getLatestUnreadNotifications(),a.checkIfThereAnyUnreadNotification(!0);var e;a.tab&&a.tab.resourceLink?1==a.tab.resourceLink.resourcePath.hierarchy.length?e="Post Viewer":2==a.tab.resourceLink.resourcePath.hierarchy.length&&(e="Image Viewer"):e="Newsfeed",a.trackOpenEvent(e),a.$broadcast("render"),a.sharedNotificationsContext.scrollYPosition>0&&a.scrollToPosition(a.sharedNotificationsContext.scrollYPosition),a.$emit("refreshFeed"),setTimeout(function(){k=d.find(".scrollable"),l=d.find(".scrollable").children(),m=d.find(".docked-date-separator"),$(document).off("mousedown",f).on("mousedown",f),k.off("scroll",p).on("scroll",p),b.notificationDropdownScrollPos&&k.scrollTop(b.notificationDropdownScrollPos)},1),a.getUpdatedServerNowTimeStamp()}else b.notificationDropdownScrollPos=k.scrollTop(),$(document).off("mousedown",f),k.off("scroll",p),k=null,l=null,m=null;a.$$phase||a.$digest()};var o,p=function(b){o&&clearTimeout(o),o=setTimeout(function(){g=k.find(".date-separator");for(var b=0;b<g.length;b++){if(!(g[b].offsetTop+20-k.scrollTop()<0)){0==b&&(h=null);break}h=$(g[b])}h?m[0].innerText=h[0].innerText:m[0].innerText=a.notifications[0].template.timeSeparator;var c=k.scrollTop(),d=l.parent().height(),e=l.parent()[0].scrollHeight;a.sharedNotificationsContext.scrollYPosition=c,c+d>e-80&&a.getNotifications("-1",!1,!1),a.sharedNotificationsContext.canPurgeNotificationsData()&&a.purgeOlderNotifications()},50)};a.scrollToPosition=function(a){k&&k.scrollTop()!=a&&setTimeout(function(){k.scrollTop(a)},0)},a.$on("$destroy",function(){n=null,clearTimeout(j),$(document).off("mousedown",f),k&&k.off("scroll",p),i&&clearTimeout(i)})}}}]),b.module("convoApp").filter("inAppNotificationsActionIconClassFilter",function(){return function(a){var b=" cnv-icons-15",c="icons_Comments-darkgray"+b,d="icons2_Like-darkgray"+b,e="icons2_mention-darkgray"+b,f="icons2_Compose-darkgray"+b,g="follow-icon",h="icons_Group_Icon-darkgray"+b,i="icons_Post-darkgray"+b;return"COMMENTED"==a.action||"COMMENT_UPDATED"==a.action?"TAGGED"==a.relationship?e:c:"LIKE"==a.action?d:"UPDATED"==a.action?"DIRECTED"==a.relationship?i:"TAGGED"==a.relationship?e:f:"AT_MENTIONED"==a.action?e:"FOLLOW"==a.action?g:"GROUP_SHARED"==a.action?h:"ADDED"==a.action?"TAGGED"==a.relationship||2==a.version&&"DIRECTED"==a.relationship?e:i:void 0}}),b.module("convoApp").factory("InAppNotifications",["ServerComm","$q","config","$rootScope",function(a,b,d,e){function f(){v=!0,g(),E.trigger("initialized")}function g(c){if(!c&&(C||D))return s.promise;s=b.defer(),D=!1,C=!0;var d={method:"getTemplatesForInProductNotifications"},e=a.postx("notifications",d);return e.then(function(a){for(var b=0;b<a.data.data.length;b++){var c=a.data.data[b];w[c.action+"-"+c.relationship+"-"+c.version]=c}D=!0,C=!1,s.resolve(a.data)},function(a){C=!1,s.reject(a.data)}),s.promise}function h(d,e,f){function h(b){g(b).then(function(){var c;e?c={count:f}:"1"===d?c={direction:d,cmin:y,cmax:E.getMaxUpdateTimestamp()}:"-1"===d&&(c={direction:d,count:f,cmin:y,cmax:E.getMaxUpdateTimestamp()}),a.getx("notifications?"+$.param(c)).then(function(a){var c=a.data.data.notifications;!b&&j(c)?h(!0):(i(c),B=!1,r.resolve(a.data))},function(a){B=!1,r.reject(a.data)})},function(a){B=!1,r.reject(a)})}return B?r.promise:(B=!0,r=b.defer(),f===c&&(f=t),h(!1),r.promise)}function i(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e=parseInt(d.updateTimestamp);(!x||e>x)&&(x=e);var f=parseInt(d.timestamp);d.isDeleted||y&&!(y>f)||(y=f)}}function j(a){for(var b=a.length,c=0;b>c;c++)if(!E.getNotificationTemplate(a[c]))return!0;return!1}function k(c){var d={method:"markNotificationAsRead",notification_id:c},e=a.post("notifications",d),f=b.defer();return e.success(function(a,b){f.resolve(a)}),f.promise}function l(){var c={method:"markMultipleNotificationsAsRead"},d=a.post("notifications",c),e=b.defer();return d.success(function(a,b){e.resolve(a)}),e.promise}function m(b){var c={method:"markAllNotificationsAsArchivedCreatedBeforeSpecifiedTimestamp",timestamp:b};return a.post("notifications",c)}function n(){return w?w:void 0}function o(){return A}function p(){if(d.IS_NATIVE){console.log("Should call once.");var a=null;Object.defineProperty(A,"unreadNotificationsCount",{set:function(b){a!==b&&(a=b,E.trigger("unreadNotificationsCountChanged",{value:a}))},get:function(){return a}})}}function q(){if(A.canPurgeNotificationsData()){var a=A.notifications,b=a.length-u;a.splice(u,b),x=0,y=0,i(a)}}var r,s,t=20,u=50,v=!1,w={},x=0,y=0,z=0,A={notifications:[],unreadNotificationsCount:0,scrollYPosition:0,canPurgeNotificationsData:function(){return 0==this.scrollYPosition&&this.notifications.length>u}},B=!1,C=!1,D=!1,E={};return _.extend(E,Backbone.Events),d.on("clientTypeUpdated",p),E.initialize=f,E.getTemplatesFromServer=g,E.getNotifications=h,E.getTemplates=n,E.markAsRead=k,E.markAllAsRead=l,E.markAllAsViewed=m,E.getSharedNotificationsContext=o,E.purgeNotificationsData=q,E.getMaxUpdateTimestamp=function(){return z&&z>x?z:x},E.getMinTimestamp=function(){return y},E.useUpdateTimestampReceivedInUpdatesCallIfGreaterThanSelfMaintainedOne=function(a){z=a},E.getNotificationTemplate=function(a){return w[a.action+"-"+a.relationship+"-"+a.version]},E}]),b.module("convoApp").filter("inAppNotificationsTemplate",["InAppNotifications","AppLinks","$filter","$sce",function(a,b,d,e){function f(a){var b=document.createElement("div");return b.innerHTML=a.replace(/<p>/g,"").replace(/<\/p>/g," "),b.textContent||b.innertText||""}function g(a,c,d,e){var f=b.newResourceLink(a,c,d,e);return b.linkToUrl(f,!0)}function h(a){var b;try{b=e.getTrustedHtml(a)}catch(c){b=a}return b=_.escape(d("limitText")(f(b),160))}return function(b,e){function f(a){var c;if("FROM"==a)c="FOLLOW"==b.action?i.length>2?"<b>"+_.escape(i[0].name)+"</b>, <b>"+_.escape(i[1].name)+"</b> and <b>"+(i.length-2).toString()+(i.length>3?" others":" other")+"</b>":2==i.length?"<b>"+_.escape(i[0].name)+"</b> and <b>"+_.escape(i[1].name)+"</b>":"<b>"+_.escape(i[0].name)+"</b>":i.length>2?"<b>"+_.escape(i[0].name)+"</b>, <b>"+_.escape(i[1].name)+"</b> and <b>"+(i.length-2).toString()+(i.length>3?" others":" other")+"</b>":2==i.length?"<b>"+_.escape(i[0].name)+"</b> and <b>"+_.escape(i[1].name)+"</b>":"<b>"+_.escape(i[0].name)+"</b>";else if("DETAILS"==a){if(c="",null!=b.description&&b.description.length){var d=h(b.description);c="<span class='detail'>"+d+"</span>"}}else c=_.escape(b[a]),("OWNER"===a||"DUE_ON"===a)&&(c="<b>"+c+"</b>");return c}var i=_.toArray(b.actionByUsers),j={};j.text=a.getNotificationTemplate(b).template;for(var k=/[\[]<<([^\]]*)>>[\]]/g;;){var l=k.exec(j.text);if(null==l)break;j.text=j.text.replace(l[0],l[1])}for(var m=/\{([^\}]*)\}/g,n=[];;){var l=m.exec(j.text);if(null==l)break;n.push(l[1])}for(var o=0;o<n.length;o++){var p=f(n[o]);if(j.text=j.text.replace("{"+n[o]+"}",p),"DETAILS"==n[o]&&""==p){j.text=j.text.trim();var q=j.text.length;":"==j.text[q-1]&&(j.text=j.text.substr(0,q-1),j.text+=".")}}var r,s,t;if("LIKE"==b.action)if("IMAGE"==b.relationship)try{s={preview_name:JSON.parse(JSON.parse(b.data)),noteId:b.pathIds.split(",")[0]}}catch(u){s=c}else if("PROFILE_IMAGE"==b.relationship)try{r=JSON.parse(JSON.parse(b.data))}catch(u){r=c}else"COMMENT"==b.relationship&&b.thumbnail_name&&(t={preview_name:b.thumbnail_name,itemId:b.pathIds.split(",")[0]});("COMMENTED"==b.action||"COMMENT_UPDATED"==b.action||"AT_MENTIONED"==b.action)&&b.thumbnail_name&&(t={preview_name:b.thumbnail_name,itemId:b.pathIds.split(",")[0]}),j.actionRelationship={action:b.action,relationship:b.relationship,version:b.version},j.latestActionByUser=i[0],j.pImageLikeData=r,j.imageLikeData=s,j.commentImageData=t;var v;return v="FOLLOW"==b.action?d("idToFilterUrl")(Object.keys(b.actionByUsers)[0],"USER"):b.resourceLink?"null"===b.resourceLink?"javascript:void(0)":"#"+b.resourceLink:g(b.appInstanceId,e,b.conversationUid||null,e[e.length-1].title),j.link=v,j.timeSeparator=d("dateSeparatorFromCurrentTimeByDayMonthOrYear")(b.timestamp),j}}]),b.module("convoApp").directive("cnvNetworkLogoAndName",["accountInfo","utils",function(a,b){return{restrict:"E",scope:!0,link:function(b,c,d){function e(){b.networkLogo,b.accountInfo=a,b.networkLogo=a.getAccountImageUrl(),b.$broadcast("render")}b.showFullMenu=!1,a.on("accountImageVersionUpdated",e),a.on("accountNameUpdated",e),e(),b.$on("$destroy",function(){a.off("accountImageVersionUpdated",e),a.off("accountNameUpdated",e)})}}}]),b.module("convoApp").directive("cnvUserInfoMenu",function(){return{restrict:"E",template:'<div cnv-clicked-outside-this="cnvClickedOutsideThis()" ng-click="toggleDetailPanel()" ><cnv-user-profile-image user-id="userData.user_id" width="60" height="60" full-name="userData.first_name | concatWithSpace: userData.last_name" profile-type="userData.profile_image_type" profile-version="userData.profile_image_version"></cnv-user-profile-image><div class="user_info" ng-show="show"><span>{{userData.first_name}} {{userData.last_name}}</span></br><span>{{userData.email}}</span></br><a href="{{userData.user_id | idToFilterUrl:\'USER\'}}">View Profile</a></br><a href="javascript:void(0)">Edit Profile</a></br><a href="#/logout">Sign Out</a></div></div>',scope:{userData:"=userInfo"},link:function(a,b,c){a.show=!1,a.toggleDetailPanel=function(){a.show=!a.show},a.cnvClickedOutsideThis=function(){a.show=!1}}}}),b.module("convoApp").directive("cnvPremiumUpgradeBtn",["$location","alertsService","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"main/components/premiumUpgradeBtn/cnvPremiumUpgradeBtn.tpl.html",scope:!0,link:function(d,e,f){d.openToolTipOrGoToPremiumUpgrade=function(){c.$broadcast("premiumUpgradeOpened"),a.url(d.cnvPremiumUpgradeBtn.premiumUpgradeUrl.slice(1))},d.openContactSalesModal=function(){var a="premiumUpgrade/contactSalesModal/contactSalesModal.tpl.html",c="ContactSalesModalCtrl";b.customModal(a,c,null,"contact-sales-modal")}},controller:["$scope","userInfo","accountInfo","AppLinks",function(a,b,c,d){function e(){var a=d.newResourceLink("19",[{type:"17",uid:0}],null,"Upgrade");return d.linkToUrl(a,!0)}a.cnvPremiumUpgradeBtn={firstName:"",accountName:"",label:"",showState:"",loadDirective:!0,premiumUpgradeUrl:""};var f=c.getAccountLevel(),g=b.isGuestUser();b.isAdmin();g||"STARTER"!=f?a.cnvPremiumUpgradeBtn.loadDirective=!1:(a.cnvPremiumUpgradeBtn.firstName=b.getUserInfo().name.split(" ")[0],a.cnvPremiumUpgradeBtn.accountName=c.getAccountName(),a.cnvPremiumUpgradeBtn.premiumUpgradeUrl=e(),a.cnvPremiumUpgradeBtn.showState="PREMIUM",a.cnvPremiumUpgradeBtn.label="Upgrade",a.$parent.$broadcast("cnvPremiumUpgradeBtn:addClassToSearchBar",{"class":"upgrade"}))}]}}]),b.module("convoApp").factory("resourcesTabsManager",["$location","AppLinks","$window","alertsService","appStateInfo","utils","$templateCache","$compile","appTitleManager","appTabs","$rootScope",function(b,d,e,f,g,h,i,j,k,l,m){function n(c){if(Q=c,U=$("#mainCont"),T=[],Q.$on("$locationChangeStart",p),e.addEventListener("beforeunload",q),e.addEventListener("unload",r),Q.$on("closeTab",function(a,b){B(b,!0)}),Q.$on("goBackInHistory",function(a,c){var d=null;T.length>1&&(d=T[T.length-2].url),d?b.url(d.slice(1)):B(c,!0)}),Q.$on("gotoParentResourceInHistory",function(b,c){var e=null,f=c.appInstanceId,g=c.resourceId,h=c.resourceLink.resourcePath.hierarchy.length-1;if(1==c.resourceLink.resourcePath.hierarchy.length&&c.resourceLink.commentFileId&&(h=1),1===h)for(var i=T.length,j=i-2;j>=0;j--){var k=T[j].resourceLink;if(!k)break;if(!T[j].resourceLink.commentFileId){if(k.resourcePath.appInstance.uid!==f||k.resourcePath.hierarchy[0].uid!==g)break;if(k.resourcePath.hierarchy.length-1===0){var l=$.extend(!0,{},T[j].resourceLink);l.collaborationInfo=null,e=d.linkToUrl(l,!0);break}}}null===e?B(c,!0):a.location.hash=e}),Q.$on("gotoPreviousResourceInHistory",function(a,c){for(var e=null,f=c.appInstanceId,g=c.resourceId,h=T.length,i=h-2;i>=0;i--){var j=T[i].resourceLink;if(!j)break;if(j.resourcePath.appInstance.uid!==f||j.resourcePath.hierarchy[0].uid!==g){var k=$.extend(!0,{},T[i].resourceLink);k.collaborationInfo=null,e=d.linkToUrl(k,!0);break}}null===e?B(c,!0):b.url(e.slice(1))}),Q.$on("requestFullViewForApp",function(a,b){b.fullViewRequested=!0}),Q.$on("unrequestFullViewForApp",function(a,b){b.fullViewRequested=!1}),R=[],Q.tabs=R,e.com_convo.homeAppLoadedInitially)V=w(),R.push(V),V.domElement=$($(".cnv-app-cont")[0]),V.appTemplateAppended=!0,X=!0,s(V);else if(X=!1,W=e.com_convo.homeAppTpl,"chats"===e.com_convo.initialLink.app){var f=b.path(),g=b.search(),h=b.hash(),i=d.urlToLink(f,g,h),j=i.resourcePath.appInstance.uid,k=i.resourcePath.hierarchy[0],l=k.type,m=k.uid,n=v(i,j,l,m,"#"+decodeURI(b.url()));R.push(n),s(n),n.domElement=$($("#fullViewChatAppCont")[0]),n.appTemplateAppended=!0,Y=!0}}function o(){return X?!1:(V=w(),R.push(V),N(),W=null,X=!0,Z.trigger("homeTabLoaded"),!0)}function p(a){var c=Q.locationAppLink;if(c&&("show_feed"===c.action||c.resourcePath&&"101"==c.resourcePath.appInstance.uid?$("body").css({"overflow-y":"hidden"}):$("body").css({"overflow-y":"auto"}),null!=S&&!D()&&(c.type===d.FILTER_LINK||c.type===d.RESOURCE_LINK&&!K(c)||c.type===d.ACTION_LINK&&"show_feed"===c.action))){var e=!0;!S.okToCloseChecked&&S.appContCtrl.initialized&&S.appContCtrl.okToClose&&(e=S.appContCtrl.okToClose(!1),S.okToCloseChecked=!0),"object"==typeof e&&e.promptMessage&&(a.preventDefault(),f.promptModal(e.promptTitle?e.promptTitle:"",e.promptMessage,function(){e.promptOkCallback&&e.promptOkCallback(),b.url(d.linkToUrl(c,!0).slice(1))},function(){S.okToCloseChecked=!1,e.promptCancelCallback&&e.promptCancelCallback()},e.promptOkBtnLabel?e.promptOkBtnLabel:"Ok",e.promptCancelBtnLabel?e.promptCancelBtnLabel:"Cancel",null,!1,e.onlyDismissModalOnCloseBtn))}}function q(b){if(g.getIsForceRefreshing()||g.getSigningOut()||g.getSwitchingNetwork())return void $(a).scrollTop(0);var c=!0;return S.appContCtrl.initialized&&S.appContCtrl.okToClose&&(c=S.appContCtrl.okToClose(!0)),"object"==typeof c&&c.promptMessage?((b||e.event).returnValue=c.promptMessage,c.promptMessage):void $(a).scrollTop(0)}function r(a){S.appContCtrl.initialized&&S.appContCtrl.closing&&S.appContCtrl.closing()}function s(a){if(T.push({resourceLink:a.resourceLink,url:a.url}),a!=S){if(S&&(S.selected=!1,S.domElement&&S.domElement.hide(),S.appContCtrl&&S.appContCtrl.initialized&&S.appContCtrl.deactivated()),a.selected=!0,a.domElement&&a.domElement.show(),S=a,S.appContCtrl.initialized){var b={};S.signalTabToScrollToTopUponActivation&&(b.scrollToTop=!0,S.signalTabToScrollToTopUponActivation=!1),S.appContCtrl.activated(b.scrollToTop)}Q.selectedTab=S,D()?(Z.trigger("homeTabSelected"),U.addClass("home-view")):(Z.trigger("homeTabUnselected"),U.removeClass("home-view")),E()&&Z.trigger("settingTabSelected")}}function t(a,b,c){return"101"!=a?a+"_"+b+"_"+c:a+"_"+b}function u(a,b,c){var d=t(a,b,c),e=$.grep(R,function(a){return a.id==d});return 0==e.length?null:1==e.length?e[0]:null}function v(a,e,f,g,h){var i={id:t(e,f,g),appInstanceId:e,resourceType:f,resourceId:g,resourceLink:a,title:a.resourcePath.appInstance.title||"[Unknown]",url:h,appContCtrl:{initialized:!1},selected:!1,fixed:!1,fullViewRequested:!1,domElement:c,scope:c,appTemplateAppended:!1},j=d.urlParamsStrToObj(b.hash()||"");return j.hasOwnProperty("local_details_object")&&(i.localDetailsObject=JSON.parse(j.local_details_object)),i}function w(){var a="#/feed";return Q.filterInfo.filterApplied&&(a="#"+decodeURI(b.url())),{id:"home",appInstanceId:"home",title:"Home",url:a,templateUrl:"home/home.tpl.html",appContCtrl:{initialized:!1},selected:!0,fixed:!0,domElement:c,scope:c,appTemplateAppended:!1}}function x(a,c){k.setAppFavicon(),z(!1,function(){o();var c="#"+decodeURI(b.url()),d=c!=V.url;V.url=c,s(V),a&&a(d)},function(){c&&c()})}function y(a){if(Y)return void(Y=!1);var a=a,c=a.resourcePath.appInstance.uid,d=a.resourcePath.hierarchy[0],e=d.type,f=d.uid,g=u(c,e,f);if(g){var h="#"+decodeURI(b.url()),i=h!=g.url;g.resourceLink=a,g.url=h,s(g),g.appContCtrl.initialized&&g.appContCtrl.navigate&&g.appContCtrl.navigate(i)}else z(!1,function(){g=v(a,c,e,f,"#"+decodeURI(b.url())),R.push(g),s(g),101==c?O(g):M(g,!1)})}function z(a,b,c){if(0===R.length||1===R.length&&R[0]===V)return void(b&&b());var d=0;R[d]===V&&(d=1),B(R[d],a,function(){z(a,b,c)},c)}function A(a,b){B(a,!0,null,null,b)}function B(a,b,c,d,e){var g=a.appContCtrl,h=!0;if(!e&&!a.okToCloseChecked&&g.initialized&&g.okToClose){var i=g.okToClose(!1);"object"==typeof i&&i.promptMessage&&(h=!1,f.promptModal(i.promptTitle?i.promptTitle:"",i.promptMessage,function(){i.promptOkCallback&&i.promptOkCallback(),C(a,b),c&&c()},function(){a.okToCloseChecked=!1,i.promptCancelCallback&&i.promptCancelCallback(),d&&d()},i.promptOkBtnLabel?i.promptOkBtnLabel:"Ok",i.promptCancelBtnLabel?i.promptCancelBtnLabel:"Cancel",null,!1,i.onlyDismissModalOnCloseBtn))}h&&(C(a,b),c&&c())}function C(a,c){var d=a.appContCtrl;d.initialized&&d.closing&&d.closing();var e=R.indexOf(a);if(R.splice(e,1),P(a),console.log("__: resourceTabsManager: closeTabs total-tabs: "+R.length),c&&a==S&&(S=null,R.length>0)){var f=e;f==R.length&&f--,b.url(R[f].url.slice(1)),m.$$phase||m.$digest()}}function D(){return X&&S===V}function E(){return"12"==S.appInstanceId}function F(a){return"9"==S.appInstanceId&&S.resourceId===a}function G(){D()||B(S,!0)}function H(){return S}function I(){if(S){if("101"==S.appInstanceId)return"FULL_VIEW_CHAT"}else{var a=b.path(),c=b.search(),e=b.hash(),f=d.urlToLink(a,c,e,"");if(f&&f.type==d.RESOURCE_LINK&&"101"==f.resourcePath.appInstance.uid)return"FULL_VIEW_CHAT"}return""}function J(){return S?"101"==S.appInstanceId:!1}function K(a){if(null==S)return!1;var b=a.resourcePath.hierarchy[0];return a.resourcePath.appInstance.uid==S.appInstanceId&&b.type==S.resourceType&&b.uid==S.resourceId}function L(){X&&(V.signalTabToScrollToTopUponActivation=!0)}function M(a,b){var c='<cnv-app-cont class="cnv-app-cont">';b&&(c+=i.get(a.templateUrl),a.appTemplateAppended=!0),c+="</cnv-app-cont>",a.domElement=j(c)(Q),$("#mainCont").append(a.domElement)}function N(){V.appTemplateAppended=!0,V.domElement=j(W)(Q),$("#insertAppsAfterThis").after(V.domElement)}function O(a){a.appTemplateAppended=!0,a.domElement=j(e.com_convo.fullViewChatAppTpl)(Q),$("#insertAppsAfterThis").after(a.domElement)}function P(a){a.domElement.remove(),a.scope.$destroy(),a.domElement=null}var Q,R,S,T,U,V,W,X=!1,Y=!1,Z={init:n,closeTab:A,switchToHomeTab:x,openResource:y,isHomeTabSelected:D,isSettingTabSelected:E,isGroupSettingsTabSelected:F,selectHomeTab:G,getSelectedTab:H,signalHomeTabToScrollToTopUponActivation:L,isFullViewChatOpen:J};return l.setLastActiveTabViewGetterMethod(I),_.extend(Z,Backbone.Events),Z}]),b.module("convoApp").controller("MainHeaderRightColumnCtrl",["$scope","$filter","$location","AppLinks","Filters","FilterTypes",function(a,b,c,d,e,f){}]),b.module("convoApp").directive("cnvMultiFactorAuthManager",["localStore",function(a){return{restrict:"E",scope:!0,templateUrl:"mfa/templates/cnvMultiFactorAuthManager.tpl.html",link:function(a,b,c){},controller:["$scope","$location","$rootScope","alertsService","config","appTabs",function(b,c,d,e,f,g){function h(b){var d="";if(b)d=b;else{var e=c.search();d=e.redirect_url?e.redirect_url:f.APP_BASE_URL}k&&g.dispatchTabsEvent2("reload"),a.writeDataGlobal("app_startup_banner","2FA enabled. Stay safe!"),location.href=d}function i(a,b){var c="components/authCodesModal/cnvAuthCodes.tpl.html",d="cnvAuthCodesModalCtrl",f={backup_codes:function(){return a},account_name:function(){return b}};e.customModal(c,d,f,"backup-codes",!0).result.then(function(a){console.log("invite complete.")},function(){console.log("invite complete.")})}var j=b,k=!1;j.VIEWS={VIEW_TYPE_AVAILABLE_OPTIONS:"options",VIEW_TYPE_AUTH_WITH_PHONE:"sms_auth",VIEW_TYPE_AUTH_WITH_AUTHENTICATOR_APP:"authenticator_app",VIEW_TYPE_AUTH_SUCCESS:"auth_success"},j.$on("request_view:authenticator_app",function(a,b){if(a.stopPropagation(),b&&b["default"]){var d=c.search();d.view=j.VIEWS.VIEW_TYPE_AUTH_WITH_AUTHENTICATOR_APP,d["default"]=1,c.search(d)}else{var d=c.search();d.view=j.VIEWS.VIEW_TYPE_AUTH_WITH_AUTHENTICATOR_APP,d["default"]=0,c.search(d)}}),j.$on("request_view:sms_auth",function(a,b){if(a.stopPropagation(),b&&b["default"]){var d=c.search();d.view=j.VIEWS.VIEW_TYPE_AUTH_WITH_PHONE,d["default"]=1,c.search(d)}else{var d=c.search();d.view=j.VIEWS.VIEW_TYPE_AUTH_WITH_PHONE,d["default"]=0,c.search(d)}}),j.$on("request_view:auth_success",function(a,b){a.stopPropagation(),d.auth_path_complete_statue.AUTH_APP||d.auth_path_complete_statue.SMS||j.currentlySelected!==j.VIEWS.VIEW_TYPE_AUTH_WITH_AUTHENTICATOR_APP&&j.currentlySelected!==j.VIEWS.VIEW_TYPE_AUTH_WITH_PHONE||b&&b.backup_codes&&i(b.backup_codes,b.account_name);var e=c.search(),g="",l="",m="";
if(b.network_switched&&(k=!0),b.redirect_url&&(g=b.redirect_url),e.redirect_url&&(l=e.redirect_url),g){if(m=g,l){var n=l.split("&redirect_url=");l=n[n.length-1],g!=l&&(m+="&redirect_url="+l)}}else m=l?l:f.APP_BASE_URL;j.currentlySelected===j.VIEWS.VIEW_TYPE_AUTH_WITH_AUTHENTICATOR_APP?d.auth_path_complete_statue.AUTH_APP=!0:j.currentlySelected===j.VIEWS.VIEW_TYPE_AUTH_WITH_PHONE&&(d.auth_path_complete_statue.SMS=!0),d.auth_path_complete_statue.SMS&&d.auth_path_complete_statue.AUTH_APP?h(m):(e.view=j.VIEWS.VIEW_TYPE_AUTH_SUCCESS,e.redirect_url=m,c.search(e))}),j.$on("auth_success:navigate_to_app",function(){event.stopPropagation(),h()}),d.$on("set_view",function(a,b){a.stopPropagation(),b.view&&(j.currentlySelected=b.view)})}]}}]),b.module("convoApp").directive("cnvAddAuthenticatorApp",[function(){return{restrict:"E",scope:!0,templateUrl:"mfa/templates/cnvAddAuthenticatorApp.tpl.html",link:function(a,b,c){var d=a;d.blurQRVerificationInput=function(){b.find("#qr-verification-input").blur()},d.focusQRVerificationInput=function(){b.find("#qr-verification-input").focus()},d.hideSpinnerImmediately=function(){b.find(".cnv-spinner").hide()}},controller:["$scope","ServerComm","$rootScope","bannerService","$q","$location",function(a,b,c,d,e,f){function g(a,c){var e=f.search().account_id||"",g={method:"verifyCode",data:{auth_method:"AUTH_APP",verification_code:a,is_default:c,account_id:e}};l||(l=Date.now()/1e3|0),j.verification_code_processing=!0,b.post("mfa",g).success(function(a){k++,1==a.type?j.$emit("request_view:auth_success",a.data||{}):(Date.now()/1e3|0)-l<120&&k>=10?d.showBanner("Login is disabled. Try again in 1 minute.",!1,!1,!1,6e4,function(){j.focusQRVerificationInput(),j.verification_code_processing=!1,l=Date.now()/1e3|0,k=0,j.$digest()}):(j.verification_code_error=a.message?a.message:"Invalid code",j.focusQRVerificationInput(),j.verification_code_processing=!1)}).error(function(a){j.verification_code_error=a&&a.message?a.message:"Invalid code",j.focusQRVerificationInput(),j.verification_code_processing=!1})}function h(a){var b=e.defer();a||b.resolve({qr_code:""});var c=document.createElement("canvas"),d=document.createElement("img");return d.src=a,setTimeout(function(){var a=d.width,e=d.height;c.width=a,c.height=e,ctx=c.getContext("2d"),ctx.drawImage(d,0,0);for(var f=ctx.getImageData(0,0,a,e),g=f.data,h=[4,126,179],i=0,j=g.length;j>i;i+=4)0===g[i]&&(g[i]=h[0],g[i+1]=h[1],g[i+2]=h[2]);ctx.putImageData(f,0,0),b.resolve({qr_code:c.toDataURL("image/png")})},100),b.promise}function i(){var a={method:"getSecretAndQRCode"};b.post("mfa",a).success(function(a){j.secretAndQRCode=a.data,h(j.secretAndQRCode.qr_code).then(function(a){j.secretAndQRCode.qr_code=a.qr_code,j.hideSpinnerImmediately(),j.view_enabled=!0}),j.blurQRVerificationInput(),setTimeout(j.focusQRVerificationInput,0)}).error(function(a){setTimeout(i,3e3)})}var j=a,k=0,l=0;j.model={},j.model.verification_code_input="",j.bcDetailsEnabled=!1,j.submit=function(){if(j.model.verification_code_input&&6===j.model.verification_code_input.length){var a=c.url_search_part["default"]?1:0;j.verification_code_error="",j.blurQRVerificationInput(),g(j.model.verification_code_input,a)}else j.verification_code_error="Invalid code",j.focusQRVerificationInput()},j.showBarCodeDetails=function(){j.bcDetailsEnabled=!0},j.view_enabled=!1,j.secretAndQRCode=null,i()}]}}]),b.module("convoApp").directive("cnvAddSmsAuth",["ServerComm","bannerService","$rootScope",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"mfa/templates/cnvAddSmsAuth.tpl.html",link:function(e,f,g){function h(a){var b={allowDropdown:!0,autoFormat:!0,autoPlaceholder:!0,nationalMode:!1,defaultCountry:"auto",initialCountry:"auto",dropdownContainer:$("body"),geoIpLookup:function(a){$.get("https://freegeoip.net/json/",function(){},"jsonp").always(function(b){var c=b&&b.country_code?b.country_code:"";a(c)})}};$("#phone-input").intlTelInput(b)}var i=e,j={0:"Is Possible",1:"Invalid country code",2:"Too short",3:"Too long",4:"Not a phone number"},k="";setTimeout(function(){$("#phone-input").intlTelInput?h():a.addEventListener("cnv-intl-tel-input-libs-loaded",h,!1)},0),i.blurPhoneInput=function(){f.find("#phone-input").blur()},i.focusPhoneInput=function(){f.find("#phone-input").focus()},i.blurSmsVerificationInput=function(){f.find("#sms-verification-input").blur()},i.focusSmsVerificationInput=function(){f.find("#sms-verification-input").focus()},i.reSubmitContact=function(){var a={method:"resendVerificationCode",data:{phone_number:k}};b.post("mfa",a).success(function(a){1==a.type&&c.showBanner("Verification code sent to "+k)}).error(function(a){})},i.submitContact=function(){var a=$("#phone-input").intlTelInput("getNumber");if(a)if($("#phone-input").intlTelInput("isValidNumber"))i.blurPhoneInput(),i.sendSMS(a),k=a,i.error="";else{i.focusPhoneInput();var b=$("#phone-input").intlTelInput("getValidationError");b&&j.hasOwnProperty(b)?i.error=j[b]:i.error="please make sure you've entered the correct contact number"}},i.backToSubmitContact=function(){i.CURRENT_STEP=i.STEPS.STEP_CONTACT,i.contact_processing=!1,setTimeout(function(){h()},0)},i.submit=function(){if(i.model.sms_bar_code)if(6===i.model.sms_bar_code.length){var a=d.url_search_part["default"]?1:0;i.verification_code_error="",i.blurSmsVerificationInput(),i.submitSMSBarCode(i.model.sms_bar_code,a)}else i.verification_code_error="Invalid code"},i.$on("$destroy",function(){var b=$("#phone-input");a.removeEventListener("cnv-intl-tel-input-libs-loaded",h,!1),b.intlTelInput&&b.intlTelInput("destroy")})},controller:["$scope","$location",function(a,d){var e=a,f=0,g=0;e.model={},e.model.sms_bar_code="",e.STEPS={STEP_CONTACT:"step_contact",STEP_CONTACT_VERIFICATION:"step_contact_verification"},e.sendSMS=function(a){var c={method:"sendVerificationCodeToPhoneNumber",data:{phone_number:a}};e.contact_processing=!0,b.post("mfa",c).success(function(b){1==b.type?(e.CURRENT_STEP=e.STEPS.STEP_CONTACT_VERIFICATION,e.contact=a):(e.contact_processing=!1,e.focusPhoneInput())}).error(function(a){e.contact_processing=!1,e.focusPhoneInput()})},e.submitSMSBarCode=function(a,h){var i=d.search().account_id||"",j={method:"verifyCode",data:{auth_method:"SMS",verification_code:a,is_default:h,account_id:i}};g||(g=Date.now()/1e3|0),e.verification_code_processing=!0,b.post("mfa",j).success(function(a){f++,1==a.type?e.$emit("request_view:auth_success",a.data||{}):(Date.now()/1e3|0)-g<120&&f>=10?c.showBanner("Login is disabled. Try again in 1 minute.",!1,!1,!1,6e4,function(){e.verification_code_processing=!1,e.focusSmsVerificationInput(),g=Date.now()/1e3|0,f=0,e.$digest()}):(e.focusSmsVerificationInput(),e.verification_code_processing=!1,e.verification_code_error=a.message?a.message:"Invalid code")}).error(function(a){e.focusSmsVerificationInput(),e.verification_code_processing=!1,e.verification_code_error=a&&a.message?a.message:"Invalid code"})},e.CURRENT_STEP=e.STEPS.STEP_CONTACT}]}}]),b.module("convoApp").directive("cnvMultiFactorAuthOptions",[function(){return{restrict:"E",scope:!0,templateUrl:"mfa/templates/cnvMultiFactorAuthOptions.tpl.html",link:function(a,b,c){},controller:["$scope",function(a){var b=a;b.authUsingAuthenticatorApp=function(){b.$emit("request_view:authenticator_app",{"default":1})},b.authUsingSMSTextMessage=function(){b.$emit("request_view:sms_auth",{"default":1})}}]}}]),b.module("convoApp").directive("cnvMultiFactorAuthSuccess",[function(){return{restrict:"E",scope:!0,templateUrl:"mfa/templates/cnvMultiFactorAuthSuccess.tpl.html",link:function(a,b,c){},controller:["$scope","$rootScope","config","$location",function(a,b,c,d){var e=a;e.config=c,e.authUsingAuthenticatorApp=function(){e.$emit("request_view:authenticator_app")},e.authUsingSMSTextMessage=function(){e.$emit("request_view:sms_auth")},e.skip=function(){e.$emit("auth_success:navigate_to_app")}}]}}]),b.module("convoApp").factory("desktopNotificationsService",["Users","userInfo","userIdToImgUrlFilter","userIdToImgUrlForFeedFilter","utils","UserProfileImage","FeedActionTypes","appStateInfo","AppLinks","config","chatService","serverPingService","nativeCommBridge","$window","Feed","$filter","appTabs","settingsService","linksClickHistory",function(b,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){function w(a){if(m.IS_NATIVE){if(!u.isDesktopNotificationEnabled())return!1}else{var b=u.isDesktopNotificationEnabled(),c=Notify.needsPermission(),d=t.isThisTabLastActiveTab(),e=k.appHasFocus(),f=k.isAppInShortIdle2State(),g=k.isAppActivated();if(!b||c||!d||e&&!f&&g)return!1}if(a==U)return!0;if(a==V){if(u.isBitONOFF(u.getIncomingChatSetting(),u.DESKTOP))return!0}else if(a==W){if(u.isBitONOFF(u.getUserStatusSetting(),u.DESKTOP))return!0}else{if(a==X)return!0;if(a==Y){if(u.isBitONOFF(u.getStartFollowingSetting(),u.DESKTOP))return!0}else if(a==Z){if(u.isBitONOFF(u.getGroupSharedSetting(),u.DESKTOP))return!0}else if(a==$&&u.isBitONOFF(u.getGroupJoinReqSetting(),u.DESKTOP))return!0}return!1}function x(a,b,c,d,e){var f=ba.toString();if(ca[f]={tag:f,type:a,data:e},m.IS_NATIVE){var g=d.split("/",6).join("/")+"/",i=d.replace(g,m.AWS_FILE_DIR_BASE_FOR_NO_AUTH);p.deliverNotification(JSON.stringify({tag:f,title:b,body:c,icon:i}))}else{var j={};j.body=s("limitText")(s("unescape")(h.htmlToPlaintext(c.replace(/<\/div>|<br>/g," "))),da+ea),j.icon=d,j.timeout=aa,j.tag=f,j.notifyShow=Q,j.notifyClose=R,j.notifyClick=S,j.notifyError=T;var k=new Notify(b,j);k.show()}ba++}function y(){return m.IS_NATIVE&&m.IS_WINDOWS?i.PROFILE_IMAGE_SIZE_64x64:i.PROFILE_IMAGE_SIZE_184x184}function z(a){return m.IS_NATIVE&&m.IS_WINDOWS&&(null==fa&&(fa=h.windowsOSVersion()),7==fa)?"https://s3.amazonaws.com/scrybe-web-assets/20170302/NotifIcon.png":e(a,y())}function A(a){if((a.feed_items&&0!==a.feed_items.length||a.feed_items_hidden_groups)&&w(U)){var b=[];a.feed_items&&(b=b.concat(a.feed_items)),a.feed_items_hidden_groups&&(b=b.concat(a.feed_items_hidden_groups));for(var c=I(b),d=0;d<c.length;d++)x(U,c[d].title,c[d].body,c[d].icon,c[d].data)}}function B(){if(w(X))for(var a=K(o.getLikeNotifications()),b=0;b<a.length;b++)x(X,a[b].title,a[b].body,a[b].icon,a[b].data)}function C(){var a=o.getUserStartedFollowAndGroupSharedAndGroupJoinReqNotifications(),b=_.where(a,{action:"FOLLOW"}),c=_.where(a,{action:"GROUP_SHARED"}),d=_.where(a,{action:"REQUESTED_GROUP_ACCESS"});D(b),F(c),E(d)}function D(a){if(w(Y))for(var b=L(a),c=0;c<b.length;c++)x(Y,b[c].title,b[c].body,b[c].icon,b[c].data)}function E(a){if(w($))for(var b=N(a),c=0;c<b.length;c++)x($,b[c].title,b[c].body,b[c].icon,b[c].data)}function F(a){if(w(Z))for(var b=M(a),c=0;c<b.length;c++)x(Z,b[c].title,b[c].body,b[c].icon,b[c].data)}function G(a){if(w(V)){var b=a.messages[a.messages.length-1],c=a.participants[b.senderId];if(c.userId!=d.user_id&&!a.isMuted&&b.type==g.chatsdk.MessageType.MESSAGE){var e=b.messageText,f=z(c.userId),h=c.name+" sent a chat";x(V,h,e,f,a)}}}function H(a){if(w(W))for(var b=P(a),c=0;c<b.length;c++)x(W,b[c].title,b[c].body,b[c].icon,b[c].data)}function I(a){for(var b,c,e,f,g,h,i,k,m,n,o,p,q,t,u,v,w,x,y=[],A=!1,B=0;B<a.length;B++)if(b=a[B],!(4!=b.app_instance_id&&6!=b.app_instance_id||b.deleted||1!=b.notify||b.action!=j.ADDED&&b.action!=j.UPDATED&&b.action!=j.DISCUSSION)){if(J(b))continue;if(u=b.app_instance_id,k=b.hierarchy[0].title,x=b.data,b.action==j.ADDED||b.action==j.UPDATED)g=b.updated_by,h=r.getUserName(b.updated_by),i=b.created_by,c=b.action==j.ADDED?h+" shared a post":i==d.user_id?h+" updated your post":h+" updated a post",parseInt(x.show_title)?e=""!=b.details?s("limitText")(k,da)+"\n\n"+b.details:k:x.hasOwnProperty("show_title")?e=b.details:(4==b.app_instance_id||-1!=x.note_type.indexOf("IMAGES"))&&(e=""!=b.details?s("limitText")(k,da)+"\n\n"+b.details:k),f=z(g),v=l.newResourceLink(u,b.hierarchy,null,s("limitText")(k,da));else if(b.action==j.DISCUSSION){o=b.timestamp,n=b.conversations;for(var C=0;C<n.length;C++)if(n[C].update_timestamp==o&&2!=n[C].update_kind){m=n[C];break}if(p=m.from_user,q=r.getUserName(m.from_user),0==m.update_kind||3==m.update_kind)if(b.created_by==d.user_id)c=q+" commented on your post";else{t=b.sharing_info;for(var D=0;D<t.length;D++)if(t[D].published_to==d.user_id){A=!0;break}c=A?q+" commented on a post you are mentioned in":q+" commented on a post"}else 1==m.update_kind&&(c=q+" edited a comment");m.comment_text&&0!==m.comment_text.length?e=m.files&&m.files.length>0?m.comment_text+" "+m.files[0].name:m.comment_text:m.files&&m.files.length>0&&(e=m.files[0].name),f=z(p),v=l.newResourceLink(u,b.hierarchy,m.uid,s("limitText")(k,da))}w=l.linkToUrl(v,!0),y.push({title:c,body:e,icon:f,data:w})}return y}function J(a){var b;if(a.action==j.ADDED||a.action==j.UPDATED)b=a.updated_by;else if(a.action==j.DISCUSSION){for(var c,e=a.timestamp,f=a.conversations,g=0;g<f.length;g++)if(f[g].update_timestamp==e){c=f[g];break}b=c.from_user}return b==d.user_id?!0:!1}function K(a){var b,c,d,e,f,g,h,i,j,k,m,n,o,p,q,r,t,u,v,w,x,y,A,B,C=[];if(!a)return C;for(var D=0;D<a.length;D++)(6==a[D].app_instance_id||4==a[D].app_instance_id)&&(h=JSON.parse(a[D].app_instance_id),f=a[D].last_liked_by,e=a[D].last_liked_by_name,g=JSON.parse(a[D].like_count),i=a[D].path_ids.split(","),j=JSON.parse(a[D].path_types),k=JSON.parse(a[D].path_names),b=e,g>1&&(b+=" +"+(g-1)),a[D].hasOwnProperty("conversation_uid")?(t=JSON.parse(a[D].path_names),A=t[t.length-1],B=JSON.parse(a[D].collaboration_info),b+=" liked your comment",a[D].comments&&0!==a[D].comments.length?c=B&&B.files&&B.files.length>0?a[D].comments+" "+B.files[0].name:a[D].comments:B&&B.files&&B.files.length>0&&(c=B.files[0].name),m=JSON.parse(a[D].path_created_by),n=JSON.parse(a[D].path_versions),o=O(i,j,k,m,n),p=l.newResourceLink(h,o,a[D].conversation_uid,A)):(r=JSON.parse(a[D].path_types),t=JSON.parse(a[D].path_names),u=t[0],v=r.length>1,v?(w=r[r.length-1],x=t[t.length-1],"images"==w||"IMAGE"==w?b+=13==a[D].system_item_type?" liked your profile photo":" liked your image":"files"==w&&(b+=" liked your file"),c=x,A=x):(b+=" liked your post",y=JSON.parse(a[D].custom_properties),parseInt(y.show_title)?c=""!=a[D].description?s("limitText")(u,da)+"\n\n"+a[D].description:u:y.hasOwnProperty("show_title")?c=a[D].description:(4==h||-1!=y.note_type.indexOf("IMAGES"))&&(c=""!=a[D].description?s("limitText")(u,da)+"\n\n"+a[D].description:u),A=u),o=O(i,j,k),p=l.newResourceLink(h,o,null,A)),q=l.linkToUrl(p,!0),d=z(f),C.push({title:b,body:c,icon:d,data:q}));return C}function L(a){for(var b,c,d,e,f,g,h=[],i=0;i<a.length;i++){f=a[i].actionBy.split(",");for(var j=0;j<f.length;j++)g=a[i].actionByUsers[f[j]].name,b=g+" followed you",c=g+" now follows your updates",d=z(f[j]),e=s("idToFilterUrl")(f[j],"USER"),h.push({title:b,body:c,icon:d,data:e})}return h}function M(a){for(var b,c,d,e,f,g,h=[],i=0;i<a.length;i++)f=a[i].actionBy,g=a[i].actionByUsers[f].name,b=g+" added you to a group",c=a[i].description,d=z(f),e=s("idToFilterUrl")(a[i].pathIds,"GROUP"),h.push({title:b,body:c,icon:d,data:e});return h}function N(a){for(var b,c,d,e,f,g,h=[],i=0;i<a.length;i++){f=a[i].actionBy.split(",");for(var j=0;j<f.length;j++)g=a[i].actionByUsers[f[j]].name,b=g+" sent a request to join "+a[i].GROUP,c="",d=z(f[j]),e=l.linkToUrl(l.newResourceLink("9",[{uid:a[i].pathIds,type:"22"},{uid:"2",type:"GroupRequests"}],null,a[j].GROUP+" (Requests)"),!0),h.push({title:b,body:c,icon:d,data:e})}return h}function O(a,b,d,e,f){for(var g=[],h=a.length,i=0;h>i;i++)e===c&&f===c?g.push({uid:a[i],type:b[i],title:d[i]}):g.push({uid:a[i],type:b[i],title:d[i],createdBy:e[i],version:f[i]});return g}function P(a){for(var b,c,e=[],f="",h=0;h<a.length;h++)!a[h].isAccessible||a[h].userId==d.user_id||a[h].presenceStatus!=g.chatsdk.UserStatus.AVAILABLE&&a[h].presenceStatus!=g.chatsdk.UserStatus.UNAVAILABLE||(b=a[h].presenceStatus==g.chatsdk.UserStatus.AVAILABLE?a[h].firstName+" "+a[h].lastName+" is online":a[h].firstName+" "+a[h].lastName+" is offline",c=z(a[h].userId),e.push({title:b,body:f,icon:c,data:a[h]}));return e}function Q(a){}function R(a){m.IS_NATIVE&&m.IS_WINDOWS?delete ca[JSON.parse(a).tag]:m.IS_NATIVE||delete ca[a.currentTarget.tag]}function S(b){a.focus();var c,d;c=m.IS_NATIVE?ca[JSON.parse(b).tag]:ca[b.currentTarget.tag],d=c.data,c.type==U||c.type==X||c.type==Y||c.type==Z||c.type==$?(v.push(d,"open-in-compact-view"),q.location.href=d):c.type==V?ga.trigger("CHAT_NOTIFICATION_CLICKED",d):c.type==W&&ga.trigger("USER_STATUS_NOTIFICATION_CLICKED",d)}function T(a){}var U=1,V=2,W=3,X=4,Y=5,Z=6,$=7,aa=8,ba=0,ca={},da=45,ea=250,fa=null;r.on("feedPolled",A),o.on("likeNotificationsUpdate",B),o.on("userStartedFollowAndGroupSharedAndGroupJoinReqNotificationsUpdate",C),p.on("onDesktopNotificationClick",S),p.on("onDesktopNotificationClose",R);var ga={showChatNotification:G,showUserStatusNotifications:H};return _.extend(ga,Backbone.Events),ga}]),b.module("convoApp").factory("pushNotificationsService",["userInfo","appIndexedDBManager","accountInfo","config","utils","$q",function(a,b,c,d,e,f){function g(){return d.IS_NATIVE?!1:e.isChrome()?!0:!1}function h(){b.writePushSubscriptionDetails({pushSubscriptionId:"",convoToken:"",userId:a.getUserId(),accountId:c.getAccountId()})}function i(a){k=a?a.pushSubscriptionId:"",l.resolve()}function j(){return l=f.defer(),b.readPushSubscriptionDetails(i),l.promise}var k,l,m={},n=function(){return k},o=function(a){if(g()){var b=j();b.then(function(){h()})}};return m.getPushSubscriptionId=n,m.initialize=o,m}]),b.module("convoApp").directive("cnvOnboardingDownloadAppsAdvert",["config","ServerComm","utils","onboardingService","mixpanelService",function(a,b,c,d,e){return{restrict:"E",replace:!0,templateUrl:"onboarding/cnvOnboardingDownloadAppsAdvert/cnvOnboardingDownloadAppsAdvert.tpl.html",link:function(b,f,g){b.config=a,b.platform=navigator.platform.slice(0,3).toLowerCase(),b.downloadNativeApp=function(){c.download([{path:a.HTML_APP_DOWNLOAD_URL,name:"Download App"}],!0,!0)},b.markDownloadApp=function(){d.markDownloadedAppFromAdvert(),b.$emit("cnvOnboarding:updateOnboardingChecklist",!0)},b.dismissAdvert=function(){f.addClass("dismiss"),setTimeout(function(){f.remove(),b.$emit("cnvOnboarding:startPilotIntro")},500)},b.dismissAdvertWithDelay=function(){setTimeout(b.dismissAdvert,1e3)},b.logDismissInMixpanel=function(){e.trackEvent(e.EXITS_AD_IN_BROWSER)},b.logDownloadInMixpanel=function(){e.trackEvent(e.CLICK_DOWNLOAD_APP)},b.$on("$destroy",function(){f=null})}}}]),b.module("convoApp").directive("cnvOnboardingHomeLeft",["homeViewStateInfo",function(a){return{restrict:"A",scope:!0,link:function(a,b,c){function d(){}d()},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvOnboardingChecklist",["$rootScope","groupSettingService",function(a,b){return{restrict:"E",scope:!0,replace:!0,templateUrl:"onboarding/cnvOnboardingHomeRight/cnvOnboardingChecklist.tpl.html",link:function(c,d,e){function f(b){c.checklist=a.login_data.onboarding_state.onboarding_checklist,c.showCreateAGroupInChecklist=a.login_data.onboarding_state.show_create_a_group_in_checklist&&c.canCreateGroup,g(null,c.checklist)}function g(b,d){c.showCreateAGroupInChecklist=a.login_data.onboarding_state.show_create_a_group_in_checklist&&c.canCreateGroup,c.checklistProgress=h;for(var e=Object.keys(d),f=0;f<e.length;f++)c.userInfo.isGuestUser()||"onboarding_dismissed"==e[f]||"0"==d[e[f]]&&(c.showCreateAGroupInChecklist||"create_a_group_done"!==e[f])?"onboarding_dismissed"!=e[f]&&"0"!=d[e[f]]&&i.hasOwnProperty(e[f])&&(c.checklistProgress+=30):(c.checklistProgress==h&&(c.checklistProgress=0),c.showCreateAGroupInChecklist?c.checklistProgress+=20:"create_a_group_done"!==e[f]&&(c.checklistProgress+=25));setTimeout(function(){c.checklist=d,c.$digest()},400)}var h=c.userInfo.isGuestUser()?10:1,i={learn_my_feed_done:!0,share_a_post_done:!0,downloaded_apps:!0};c.checklistProgress=h,c.canCreateGroup=b.canCreateGroup(),b.registerCallback(function(a){c.canCreateGroup=a}.bind(this)),c.$on("cnvOnboarding:initializeChecklist",g),c.$on("cnvSessionRefreshed",function(){f(!0)}),f()},controller:["$scope","userInfo","accountInfo","alertsService","Users","bannerService","config","Contacts","$rootScope",function(a,b,c,d,e,f,g,h,i){a.userInfo=b,a.config=g,a.inviteContacts=function(){h.initContactsInviteModal({include_off_domain:!1,invite_via:"Invite_Dialog",origin:"Right_Column"}),i.$broadcast("cnvOnboardingTooltips:clearTooltips")},a.shouldInviteGuestsAsFullMembers=c.shouldInviteGuestsAsFullMembers(),a.onShareableLinkClick=function(){var a="common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",b="findContactsSplashCtrl",c={data:function(){return{requestedView:"VANITY_URL"}}};d.customModal(a,b,c)}}]}}]),b.module("convoApp").directive("cnvOnboardingMainHeader",["homeViewStateInfo",function(a){return{restrict:"A",scope:!0,link:function(a,b,c){function d(){}d()},controller:["$scope","homeViewStateInfo","$location",function(a,b,c){a.skipTour=function(){}}]}}]),b.module("convoApp").directive("cnvOnboardingPilotIntro",["$rootScope","$templateCache","$compile","mixpanelService","onboardingService",function(b,c,d,e,f){return{restrict:"A",scope:!1,link:function(b,g,h){function i(){var a=d(c.get(m));g.append(a(b)),o=g.find(n)}function j(c){o||(o=g.find(n)),c&&p&&(clearTimeout(p),f.recordAction("onboarding_dismissed"),e.trackEvent(e.X_OUT_GETTING_STARTED,{Type:"Learn about feed",Trigger:"Click"})),o.addClass("remove-anim"),a.setTimeout(function(){o.remove(),o=null,c?b.$emit("cnvOnboarding:cnvPilotIntroDismissed"):b.$emit("cnvOnboarding:cnvPilotIntroComplete",!0,!0)},1e3)}function k(b){var c=g.find(".bottom-text > span").first();return-1==b?(c.html("Starting in "+b+" seconds..."),void j()):void(p=a.setTimeout(function(){c.html("Starting in "+b+" seconds..."),k(b-1)},1e3))}function l(){i(),k(b.countdownTimerStart)}var m="onboarding/cnvOnboardingPilotIntro/cnvOnboardingPilotIntro.tpl.html",n=".cnv-pilot-intro-wrapper",o=null,p=null;b.countdownTimerStart=5,b.completeIntroStep=j,b.$on("cnvOnboarding:startCnvPilotIntro",l),b.$on("$destroy",function(){o=null})},controller:["$scope",function(a){}]}}]),b.module("convoApp").directive("cnvDemoPost",["accountInfo","$timeout","config",function(b,d,e){return{restrict:"E",scope:!1,replace:!0,link:function(f,g,h){function i(){var a,b=document.createElement("fakeelement"),d={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in d)if(b.style[a]!==c)return d[a]}function j(){o[0].className=o[0].className+" gifsRealFast",o[0].style.webkitTransform="translateX("+n+"px)",o[0].style.MozTransform="translateX("+n+"px)",o[0].style.transform="translateX("+n+"px)",d(function(){f.selectingGif=!1,f.allowSharing=!0},0)}function k(){setTimeout(function(){f.selectedGif=f.onboarding.getting_started_post_image_id,f.selectGif("#gifHoldergif"+f.selectedGif,!0),g.find(".box")[0].style.opacity=1},0);for(var c=f.onboarding.getting_started_post_image_id_range_start;c<=f.onboarding.getting_started_post_image_id_range_end;c++)f.gifs.push({url:e.AWS_FILE_DIR_BASE+f.onboarding.getting_started_post_image_directory+"/"+c+".gif",id:"gif"+c,bareId:c});accountName=b.getAccountName(),f.postBody="Hello team! Sharing my first post on Convo - comment or like below. <a href='javascript:void()' class='cnv-hashtag'>#GettingStarted</a>",a.addEventListener("scroll",f.disableScroll),f.commentEditorCtrl.initialized?l():f.commentEditorCtrl.on("initialized",l)}function l(){f.commentEditorCtrl.activate(f.postBody),setTimeout(function(){f.postBodyOrigional=f.commentEditorCtrl.getContent().trim()},0)}var m=0,n=0,o=g.find(".gifsReal");f.selectGif=function(a,b){var c=g.find(a).offset(),e=g.find(".gifsContainer").offset(),h=(o.offset(),0);h=e.left-c.left+40>0?30:-30,n=m+(e.left-c.left),m=n,d(function(){f.selectingGif=!0},0),console.log(a+": "+n),b?(o[0].className="gifsReal noanimation",j()):o[0].className="gifsReal",o[0].style.webkitTransform="translateX("+(n+h)+"px)",o[0].style.transform="translateX("+(n+h)+"px)",o[0].style.MozTransform="translateX("+(n+h)+"px)";var k=i();k&&$(o).on(k,j),b&&j(),f.$broadcast("render")},f.disableScroll=function(){a.scrollTo(0,0)},k()},templateUrl:"onboarding/templates/cnvDemoPost.tpl.html",controller:["$rootScope","$scope","ServerComm","userInfo","mixpanelService","onboardingService",function(b,c,d,e,f,g){c.allowSharing=!0,c.shareBtnText="Share this post",c.selectingGif=!1,c.gifs=[],c.postBody=null,c.postBodyOrigional=null,c.selectedGif=null;c.user=e.getUserInfo(),c.commentEditorCtrl={initialized:!1,height:{min:30,max:50}},_.extend(c.commentEditorCtrl,Backbone.Events),c.selectRandomGif=function(){f.trackEvent(f.TRY_ANOTHER_CLICKED),c.selectedGif<c.onboarding.getting_started_post_image_id_range_end?c.selectedGif+=1:c.selectedGif>=c.onboarding.getting_started_post_image_id_range_end&&(c.selectedGif=c.onboarding.getting_started_post_image_id_range_start),c.selectGif("#gifHoldergif"+c.selectedGif)},c.share=function(){c.allowSharing=!1,c.shareBtnText="Sharing...",c.commentEditorCtrl.getContent().trim()!=c.postBodyOrigional&&f.trackEvent(f.Edit_Welcome_Gif_Post),f.trackEvent(f.Share_Welcome_Gif_Post),c.sharePost()},c.close=function(){a.removeEventListener("scroll",c.disableScroll),c.finished(c.stages.cnvDemoPost),c.removeDemoPostWidget()},c.sharePost=function(){if(c.commentEditorCtrl.initialized&&""!=c.commentEditorCtrl.getContent().trim()){var e={method:"createGettingStartedPost",image_id:c.selectedGif,body:c.commentEditorCtrl.getHtmlContent()},f=d.post("onboarding",e);f.then(function(d){c.shareBtnText="Post shared!",c.demoPostAdded=!0,a.removeEventListener("scroll",c.disableScroll),b.$broadcast("pollFeedRequest"),c.finished(c.stages.cnvDemoPost),c.removeDemoPostWidget();var e=g.recordAction("share_a_post_done");e.then(function(a,b){c.demoPostSharingSuccessful()})})}}}]}}]),b.module("convoApp").directive("cnvHomeOnboarding",["$timeout","utils","Groups","$compile","$rootScope",function(b,c,d,e,f){return{restrict:"AE",scope:!0,templateUrl:"onboarding/templates/cnvHomeOnboarding.tpl.html",link:function(c,d,g){function h(){document.querySelector(".header-bar-container");o._chatMainListIcon={"class":"top",statement:"Chat with your&#xa;teammates",origional:document.querySelector("#chatUserListMainWindow .chatUserListHeader .chatsIcon"),clone:document.querySelector("#chatUserListMainWindow .chatUserListHeader .chatsIcon").cloneNode(!0)},document.querySelector(".feed-right-panel-wrapper .invite-widget-form-btn")&&(o._homeRightPanelInviteButtton={"class":"bottom",statement:"Invite new teammates",origional:document.querySelector(".feed-right-panel-wrapper .invite-widget-form-btn"),clone:document.querySelector(".feed-right-panel-wrapper .invite-widget-form-btn").cloneNode(!0),"hide-clone":!0,"use-width":!0,"center-text":"Invite"}),o._homeHeaderIconsMenu={"class":"left",statement:"Invite new teammates",origional:document.querySelector(".onboarding_menu"),clone:document.querySelector(".onboarding_menu").cloneNode(!0),"hide-clone":!0,"use-width":!0},m=Object.keys(o);for(var a,b,c=0,d=m.length;d>c;++c){if(console.log(m[c]),b=o[m[c]].clone,a=o[m[c]].origional.getBoundingClientRect(),n.appendChild(b),$(b).wrap("<div data-message='"+o[m[c]].statement+"' class='icon-wrapper "+o[m[c]]["class"]+"'></div>"),0===a.top&&0===a.bottom?(b.style.position="fixed",b.style.top="-10000px",b.style.left=a.left+"px"):(b.style.position="fixed",b.style.top=a.top+"px",b.style.left=a.left+"px"),o[m[c]].hasOwnProperty("use-width")&&(b.style.width=a.width+"px"),o[m[c]].hasOwnProperty("hide-clone")&&(b.style.visibility="hidden"),o[m[c]].hasOwnProperty("center-text")){var e=document.createElement("div");e.className="innerContent",e.innerHTML=o[m[c]]["center-text"],b.parentNode.appendChild(e)}o[m[c]].hasOwnProperty("color")&&(b.style.color=o[m[c]].color),function(a){setTimeout(function(){var b=o[m[a]].clone.getBoundingClientRect();o[m[a]].clone.parentNode.style.top=b.top-10+"px",o[m[a]].clone.parentNode.style.left=b.left-10+"px",o[m[a]].clone.parentNode.style.width=b.width+20+"px",o[m[a]].clone.parentNode.style.height=b.height+20+"px"},0)}(c)}j()}function i(){o=[],o._inlineInsert={"class":"bottom",statement:"This is the compose box",origional:document.querySelector("#inline-insert-files-paste-target"),clone:document.querySelector("#inline-insert-files-paste-target").cloneNode(!0),"use-width":!0},m=Object.keys(o);for(var a,b,d=0,f=m.length;f>d;++d){b=o[m[d]].clone,a=o[m[d]].origional.getBoundingClientRect();var g=document.createElement("div");g.setAttribute("ng-click","done()"),g.setAttribute("class","icon-wrapper bgwhite bigTitle "+o[m[d]]["class"]),g.style.cursor="pointer",g=e(g)(c),$(g).append(b),$(n).append(g),b.parentNode.o,b.style.position="fixed",b.style.top=a.top+"px",b.style.left=a.left+"px",o[m[d]].hasOwnProperty("use-width")&&(b.style.width=a.width+"px"),o[m[d]].hasOwnProperty("hide-clone")&&(b.style.visibility="hidden"),o[m[d]].hasOwnProperty("color")&&(b.style.color=o[m[d]].color),function(a){setTimeout(function(){var b=o[m[a]].clone.getBoundingClientRect();o[m[a]].clone.parentNode.style.top=b.top+"px",o[m[a]].clone.parentNode.style.left=b.left+"px",o[m[a]].clone.parentNode.style.width=b.width+"px",o[m[a]].clone.parentNode.style.height=b.height+"px",o[m[a]].clone.parentNode.setAttribute("data-message",o[m[a]].statement)},0)}(d)}setTimeout(function(){var a=document.createElement("div");a.innerHTML='<button class="btn btn-primary btn-block" ng-click="done()">Let\'s share a quick post!</button>',a.id="step2Btn";var b=o._inlineInsert.clone,d=b.getBoundingClientRect();$(n).append(e(a)(c)),a.style.position="fixed",a.style.width="250px",a.style.top=d.bottom+140+"px",a.style.left=d.left+b.offsetWidth/2-a.offsetWidth/2+"px"},0)}function j(a){if(1==c.step){var b=document.querySelector(".on-boarding-public-private-group-placeholder-in-panel"),d=document.querySelector(".on-boarding-public-private-group-placeholder-in-panel").cloneNode(!0),e=b.getBoundingClientRect();p.elem=b,p.cloneElem=d;var f=d.querySelector(".on-boarding-public-group-placeholder-in-panel").cloneNode(!0),g=d.querySelector(".on-boarding-private-group-placeholder-in-panel").cloneNode(!0);f.style.display="block",g.style.display="block",g.className="cnv-icons-40 privateGroup_icon-white on-boarding-private-group-placeholder-in-panel",f.className="cnv-icons-40 Icon1_PublicChannel-01-white on-boarding-public-group-placeholder-in-panel",p.publicLabel=f,p.privateLabel=g,d.innerHTML="",d.appendChild(g),d.appendChild($("<span class='private-group-label'>Private Groups</span>")[0]),d.appendChild(f),d.appendChild($("<span class='public-group-label'>Public Groups</span>")[0]),n.appendChild(d),$(d).wrap("<div class='icon-wrapper top topSmall' data-message='Create private or&#xa;public groups'></div>"),d.style.position="fixed",d.style.top=e.top+"px",d.style.left=e.left+"px",d.parentNode.style.top=e.top-10+"px",d.parentNode.style.left=e.left-10+"px",d.parentNode.style.width=e.width+20+"px",d.parentNode.style.height="320px"}}function k(){for(var a,b,d=0,e=m.length;e>d;++d)b=o[m[d]].clone,a=o[m[d]].origional.getBoundingClientRect(),null!=b.parentNode&&(0===a.top&&0===a.bottom?(b.style.position="fixed",b.style.top="-10000px",b.style.left=a.left+"px"):(b.style.position="fixed",b.style.top=a.top+"px",b.style.left=a.left+"px"),o[m[d]].hasOwnProperty("use-width")&&(b.style.width=a.width+"px"),o[m[d]].hasOwnProperty("hide-clone")&&(b.style.visibility="hidden"),o[m[d]].hasOwnProperty("color")&&(b.style.color=o[m[d]].color),function(a){var b,d,e=o[m[a]].clone.getBoundingClientRect();2==c.step?(b=0,d=0):(b=10,d=20),o[m[a]].clone.parentNode.style.top=e.top-b+"px",o[m[a]].clone.parentNode.style.left=e.left-b+"px",o[m[a]].clone.parentNode.style.width=e.width+d+"px",o[m[a]].clone.parentNode.style.height=e.height+d+"px"}(d));if(1==c.step){if(null!=p.elem){var b=p.elem;a=b.getBoundingClientRect(),cloneElem=p.cloneElem;p.publicLabel,p.privateLabel;cloneElem.style.position="fixed",cloneElem.style.top=a.top+"px",cloneElem.style.left=a.left+"px",cloneElem.parentNode.style.top=a.top-10+"px",cloneElem.parentNode.style.left=a.left-10+"px",cloneElem.parentNode.style.width=a.width+20+"px",
cloneElem.parentNode.style.height="320px"}}else if(2==c.step){var f=document.querySelector("#step2Btn");if(f){var g=o._inlineInsert.clone,a=g.getBoundingClientRect();f.style.position="fixed",f.style.width="250px",f.style.top=a.bottom+150+"px",f.style.left=a.left+g.offsetWidth/2-f.offsetWidth/2+"px"}}}function l(){a.scrollTo(0,0)}var m,n=d[0].querySelector(".home-dim-overlay"),o={},p={};b(h,0),a.addEventListener("resize",k),a.addEventListener("scroll",l),f.$on("filterChange",function(){setTimeout(k,0)}),c["continue"]=function(){n.innerHTML="",c.step=2,i()},c.done=function(){a.removeEventListener("resize",k),a.removeEventListener("scroll",l),c.finished(c.stages.cnvHomeOnboarding)}},controller:["$scope",function(a){a.active=!0,a.step=1}]}}]),b.module("convoApp").directive("cnvOnboardingManager",["config","$timeout","utils","Groups","$compile","$rootScope","onboardingService","Feed","Comments","homeViewStateInfo","userInfo","$templateCache","bannerService","mixpanelService","resourcesTabsManager","AppLinks","$location","filterInfo",function(b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){return{restrict:"AE",scope:!1,templateUrl:"onboarding/templates/cnvOnBoardingManager.tpl.html",link:function(d,e,l){function u(){var a=s.path(),b=s.search(),c=s.hash(),d=r.urlToLink(a,b,c,"");if(d){if(d.type==r.RESOURCE_LINK&&d.resourcePath.hierarchy&&d.resourcePath.hierarchy.length>0)return!1;if(d.type==r.FILTER_LINK)return!1}return!0}function v(){if(d.onboarding&&d.onboarding.onboarding_checklist){var c=d.onboarding.onboarding_checklist;if(i.setChecklist(c),u()||(S=!0,T=d.$on("filterChange",function(a){t.filterApplied||Q()})),S)return void(U||1!=d.onboarding.first_login||b.IS_NATIVE||(C(),U=!0));var e=m.isGuestUser(),g=f.getListableGroups(!0),h=g.length<10;return d.onboarding.show_create_a_group_in_checklist=h,w(c),a.setTimeout(d.loadOnboardingTooltips,0),a.setTimeout(y,0),0===g.length&&f.getListableGroups()["finally"](function(){g=f.getListableGroups(!0),h=g.length<10,d.onboarding.show_create_a_group_in_checklist!==h&&(d.onboarding.show_create_a_group_in_checklist=h,w(c),y())}),U||1!=d.onboarding.first_login||b.IS_NATIVE?void(0==c.onboarding_dismissed&&(0==c.learn_my_feed_done?a.setTimeout(function(){D(null,!0)},0):0!=c.create_a_group_done||e?0==c.share_a_post_done?a.setTimeout(function(){I(null,!0)},3e3):0!=c.connect_to_other_tools_done||e||a.setTimeout(function(){K(null,!0)},3e3):a.setTimeout(function(){H(null,!0)},3e3))):(C(),void(U=!0))}}function w(a,b){var c=Object.keys(a);if(m.isGuestUser()){if(0==a.learn_my_feed_done||0==a.share_a_post_done||0==a.downloaded_apps)return b||i.changeState(!0),!0}else for(var e=0;e<c.length;e++)if("onboarding_dismissed"!=c[e]&&"0"==a[c[e]]&&(d.onboarding.show_create_a_group_in_checklist||"create_a_group_done"!==c[e]))return b||i.changeState(!0),!0;return!1}function x(b,c){if(!S){var e=i.getOnboardingState();e.then(function(b,e){d.onboarding.onboarding_checklist=b.data.onboarding_checklist,d.$broadcast("cnvOnboarding:initializeChecklist",d.onboarding.onboarding_checklist),c?w(i.getChecklist())||a.setTimeout(function(){A(),d.$$phase||d.$digest()},2e3):a.setTimeout(z,1e3)})}}function y(){d.$broadcast("cnvOnboarding:initializeChecklist",d.onboarding.onboarding_checklist)}function z(){function a(){var a=i.getLastPlayedStep(),d=0,e=["learn_my_feed_done","create_a_group_done","share_a_post_done","connect_to_other_tools_done","downloaded_apps"];switch(a){case"learn_my_feed":d=0;break;case"create_group":d=1;break;case"share_post":d=2;break;case"integrations":d=3;break;case"download_apps":d=4}for(var f=d;f<e.length;f++){if(c&&0==b[e[f]]&&("share_a_post_done"==e[f]||"downloaded_apps"==e[f]))return e[f];if(!c&&0==b[e[f]])return e[f]}}var b=i.getChecklist(),c=(Object.keys(b),m.isGuestUser());i.getLastPlayedStep();if(w(b,!0)){var e=a();switch(e){case"learn_my_feed_done":E(null,!0);break;case"create_a_group_done":H(null,!0);break;case"share_a_post_done":I(null,!0);break;case"connect_to_other_tools_done":K(null,!0);break;case"downloaded_apps":J(null,!0)}}else A(),d.$$phase||d.$digest()}function A(){P(),i.changeState(!1)}function B(){Y=!0,d.$broadcast("cnvOnboarding:removeOnboardingFeedData"),i.convoPilotIntroDismissed()}function C(){e.append(g("<cnv-onboarding-download-apps-advert></cnv-onboarding-download-apps-advert>")(d.$new()))}function D(a,b){S||(N("Learn about Feed",b?"Auto":"Click"),d.$broadcast("cnvOnboarding:startCnvPilotIntro"),d.$broadcast("cnvOnboarding:setOnboardingFeedData"))}function E(b,c,e){d.$broadcast("cnvOnboarding:setOnboardingFeedData"),d.$broadcast("cnvOnboarding:showOverlay",!0),d.$broadcast("cnvOnboardingTooltips:clearTooltips"),i.setLastPlayedStep("learn_my_feed"),i.feedOnboardingStatus(!0),e||N("Learn about Feed",c?"Auto":"Click"),P(!0);var f=i.createFirstPilotPost();f.then(function(b,c){if(b.hasOwnProperty("data")){for(var e in b.data.users){var f={};f[e]=b.data.users[e],j.setUsers(f)}V=b.data.feed_items[0],k.updateCommentsDataReceivedInFeedFetch(V.resource_id,V.app_instance_id,V.conversations_count,V.conversations),d.$broadcast("cnvOnboarding:addFeedItems",b.data.feed_items),a.setTimeout(function(){$(".feed-cont").addClass("onboarding-feed-items"),d.$broadcast("cnvOnboarding:disableClicksOnFeedItems")},0),R=a.setTimeout(function(){var b=i.createSecondPilotPost();b.then(function(b,c){if(b.hasOwnProperty("data")){for(var e in b.data.users){var f={};f[e]=b.data.users[e],j.setUsers(f)}W=b.data.feed_items[0],d.$broadcast("cnvOnboarding:addFeedItems",b.data.feed_items),a.setTimeout(function(){$("#"+V.feed_id).css("top","117px"),d.$broadcast("cnvOnboarding:disableClicksOnFeedItems"),a.setTimeout(function(){$(".feed-cont").removeClass("onboarding-feed-items")},1e3)},0),k.updateCommentsDataReceivedInFeedFetch(W.resource_id,W.app_instance_id,W.conversations_count,W.conversations),R=a.setTimeout(function(){d.$broadcast("cnvOnboarding:showAddCommentTooltip",W.feed_id),d.$broadcast("cnvOnboarding:disableClicksOnFeedItems")},4e3)}},function(){$(".feed-cont").removeClass("onboarding-feed-items"),M()})},4e3)}},M)}function F(){R=a.setTimeout(function(){var b=i.createFirstPilotComment(W.feed_id);b.then(function(b,c){b.data&&(d.$emit("refreshFeed"),d.$broadcast("cnvOnboarding:incrementConversationsCount",W.feed_id),X=b.data.uid,d.$$phase||h.$digest(),R=a.setTimeout(function(){d.$broadcast("cnvOnboarding:highlightTextAndShowTooltip",b.data.uid)},4e3))},M)},1e3)}function G(b,c){R=a.setTimeout(function(){k.markCommentsAsPosted(W.app_instance_id,W.resource_id),d.$broadcast("cnvComment:removeCommentAnimFlags",W.feed_id);var b=i.createSecondPilotComment(W.feed_id,c);b.then(function(b,c){b.data&&(d.$emit("refreshFeed"),d.$broadcast("cnvOnboarding:incrementConversationsCount",W.feed_id),d.$$phase||h.$digest(),a.setTimeout(function(){d.$broadcast("render")},1e3),R=a.setTimeout(function(){k.markCommentsAsRead(W.app_instance_id,W.resource_id),d.$broadcast("cnvOnboarding:removeOnboardingFeedData"),d.$broadcast("render"),d.$broadcast("cnvOnboarding:hideOverlay"),d.$broadcast("cnvOnboarding:enableClicksOnFeedItems"),P(!1,!0),a.setTimeout(function(){x()},4e3),i.feedOnboardingStatus(!1)},4e3))},M)},2e3)}function H(a,b){i.setLastPlayedStep("create_group"),N("Create a group",b?"Auto":"Click"),d.$broadcast("showHideHeaderFloatingColumn",!0),d.$broadcast("cnvOnboardingTooltips:createGroupTooltip:2")}function I(a,b){i.setLastPlayedStep("share_post"),N("Share a post",b?"Auto":"Click"),d.$broadcast("showHideHeaderFloatingColumn",!0),a?(d.$broadcast("cnvOnboardingTooltips:clearTooltips"),d.loadDemoPostWidget()):d.$broadcast("cnvOnboardingTooltips:sharePostTooltip")}function J(a,b){i.setLastPlayedStep("download_apps"),N("Download apps",b?"Auto":"Click"),d.$broadcast("cnvOnboardingTooltips:showDownloadAppsModal")}function K(a,b){i.setLastPlayedStep("integrations"),N("Connect to other tools",b?"Auto":"Click"),d.$broadcast("showHideHeaderFloatingColumn",!0),a?d.$broadcast("cnvOnboardingTooltips:openSetupIntegrations"):d.$broadcast("cnvOnboardingTooltips:showIntegrationsTooltip")}function L(){0!=i.getChecklist().connect_to_other_tools_done||m.isGuestUser()?0==i.getChecklist().downloaded_apps?J(null,!0):i.onboardingDismissedCallback():K(null,!0)}function M(){o.showBanner('There seems to be something wrong with your internet connection. <a href="javascript:void(0)">Click here</a> to dismiss this tour for now.<br />You can resume this tour at any time by selecting an option from <strong>Explore Convo</strong> checklist.',!0,!1,d.dismissOnboardingBecauseOfNetworkFailure)}function N(a,b){p.trackEvent(p.GETTING_STARTED_STEP_LAUNCH,{Type:a,Trigger:b})}function O(){if(0==i.getChecklist().connect_to_other_tools_done){var a=i.recordAction("connect_to_other_tools_done");a.then(function(){x(c,!0)})}}function P(a,b){if(a){var c="onboarding/templates/cnvOnboardingDismissBanner.tpl.html",f=g(n.get(c));e.append(f(d))}else e.find(".onboarding-dismiss-banner").remove(),b||(i.recordAction("onboarding_dismissed"),p.trackEvent(p.X_OUT_GETTING_STARTED,{Type:"Learn about feed",Trigger:"Click"}))}function Q(){S&&(S=!1,x(null,!0),setTimeout(function(){T&&T(),v()},1e3))}var R,S=!1,T=null,U=!1;d.loadHomeOnboarding=function(){d.childScopes[d.onBoardingStage]=d.$new();var a=g("<div id='onboardingStage"+d.onBoardingStage+"'><cnv-home-onboarding ></cnv-home-onboarding></div>")(d.childScopes[d.onBoardingStage]);$(e[0].querySelector("div")).append(a)},d.loadDemoPostWidget=function(){var a=2;d.childScopes[a]=d.$new();var b=g("<div id='onboardingStage"+a+"'><cnv-demo-post></cnv-demo-post></div>")(d.childScopes[a]);$(e[0].querySelector("div")).append(b)},d.loadOnboardingTooltips=function(){d.childScopes[d.onBoardingStage]=d.$new();var a=g("<div id='onboardingStage"+d.onBoardingStage+"'><cnv-onboarding-tooltips></cnv-onboarding-tooltips></div>")(d.childScopes[d.onBoardingStage]);$(e[0].querySelector("div")).append(a)},d.finished=function(a){d.demoPostAdded=d.childScopes[a].demoPostAdded,d.childScopes[a].$destroy();var b=e[0].querySelector("#onboardingStage"+a);b.innerHTML="",2!=a||d.demoPostAdded||1!=i.getChecklist().onboarding_dismissed||i.onboardingDismissedCallback()},d.removeDemoPostWidget=function(a){e.find("#onboardingStage2").remove()},d.demoPostSharingSuccessful=function(){0==d.onboarding.uploaded_profile_pic?(x(null,!0),a.setTimeout(function(){d.$broadcast("cnvOnboardingTooltips:showProfilePicTooltip")},2e3)):x()},v();var V=null,W=null,X=null,Y=!1;d.onDismissOnboardingClick=function(){P(),R&&a.clearTimeout(R),$(".feed-cont").removeClass("onboarding-feed-items"),i.feedOnboardingStatus(!1),d.$broadcast("cnvOnboarding:removeOnboardingFeedData"),d.$broadcast("cnvComment:removeHighlightTextAndShowTooltip",X),d.$broadcast("cnvOnboarding:hideOverlay"),d.$broadcast("cnvOnboarding:enableClicksOnFeedItems")},d.dismissOnboardingBecauseOfNetworkFailure=function(){d.$broadcast("cnvOnboarding:removeOnboardingFeedData"),d.$broadcast("cnvComment:removeHighlightTextAndShowTooltip",X),d.$broadcast("cnvOnboarding:hideOverlay"),d.$broadcast("cnvOnboarding:enableClicksOnFeedItems")},q.on("homeTabUnselected",function(){d.$broadcast("cnvOnboardingTooltips:clearTooltips")}),i.on("cnvOnboarding:updateOnboardingChecklist",x),d.$on("cnvOnboarding:updateOnboardingChecklist",x),d.$on("cnvOnboarding:cnvPilotIntroComplete",E),d.$on("cnvOnboarding:cnvPilotFetchFirstComment",F),d.$on("cnvOnboarding:cnvPilotFetchSecondComment",G),d.$on("cnvOnboarding:startPilotIntro",D),d.$on("cnvOnboarding:openSharePostWidget",d.loadDemoPostWidget),d.$on("cnvOnboarding:cnvPilotIntroDismissed",B),d.$on("cnvOnboarding:uploadProfileTooltipFromFeedDismissed",L),d.$on("cnvOnboarding:integrationsDialogDisplayed",O),d.$on("cnvOnboarding:startFeedOnboarding",E),d.$on("cnvOnboarding:startCreateGroupOnboarding",H),d.$on("cnvOnboarding:startSharePostOnboarding",I),d.$on("cnvOnboarding:startDownloadAppsOnboarding",J),d.$on("cnvOnboarding:startIntegrationsOnboarding",K)},controller:["$scope","$window",function(a,b){a.onBoardingStage=0,a.childScopes=[],a.stages={initial:0,cnvHomeOnboarding:1,cnvDemoPost:2,cnvOnboardingTooltips:3},a.demoPostAdded=!1;var c=function(){a.onboarding=h.login_data.onboarding_state};b.com_convo.sessionData&&b.com_convo.sessionData.signInResponseData?c():b.document.body.addEventListener("loginDataRecieved",function(){c()}),a.proceedToNextStage=function(){a.onBoardingStage==a.stages.initial?(a.onBoardingStage=a.stages.cnvHomeOnboarding,a.loadHomeOnboarding()):a.onBoardingStage==a.stages.cnvHomeOnboarding?(a.onBoardingStage=a.stages.cnvDemoPost,a.loadDemoPostWidget()):a.onBoardingStage==a.stages.cnvDemoPost&&(a.onBoardingStage=a.stages.cnvOnboardingTooltips,a.loadOnboardingTooltips())},a.firstLoginSequence=function(){a.proceedToNextStage()},a.secondLoginSequence=function(){a.onBoardingStage=a.stages.cnvDemoPost,a.proceedToNextStage()}}]}}]),b.module("convoApp").directive("cnvOnboardingOverlay",[function(){return{restrict:"C",link:function(b,c,d){function e(a,b){c.append(g),k=c.find(h),b||k.addClass(i),k.css("position","absolute").css("left",0).css("top",0).css("right",0).css("bottom",0),k.css("background","white").css("opacity",.85)}function f(b,d){k?(d||k.addClass(j),a.setTimeout(function(){k.remove()},1e3)):c.find(h).remove()}var g='<div class="cnv-onboarding-overlay-div"></div>',h=".cnv-onboarding-overlay-div",i="anim-in",j="anim-out",k=null;b.$on("cnvOnboarding:showOverlay",e),b.$on("cnvOnboarding:hideOverlay",f)}}}]),b.module("convoApp").directive("cnvOnboardingTooltips",["$timeout","utils","Groups","$compile","alertsService","$rootScope","localStore","onboardingService",function(b,c,d,e,f,g,h,i){return{restrict:"AE",scope:!0,templateUrl:"onboarding/templates/cnvOnboardingTooltips.tpl.html",link:function(b,d,h){function j(){for(var a,c,d,e=0,f=m.length;f>e;++e)c=m[e].elem,d=m[e].mainElement,a=d.getBoundingClientRect(),0!==a.top||0!==a.bottom?"left"==m[e].position?(c.style.top=a.top+d.offsetHeight/2-c.offsetHeight/2+"px",c.style.left=a.left-c.offsetWidth-25+"px"):"bottom"==m[e].position?(c.style.top=a.bottom+20+"px",c.style.left=a.left+d.offsetWidth/2-c.offsetWidth/2+"px"):"bottom-left"==m[e].position?(c.style.top=a.bottom+30+"px",c.style.left=a.left-c.offsetWidth+39+"px"):"top"==m[e].position?(c.style.top=a.top-c.offsetHeight-15+"px",c.style.left=a.left+d.offsetWidth/2-c.offsetWidth/2+"px"):"bottom-left-middle"==m[e].position?(c.style.top=a.bottom+10+"px",c.style.left=a.left-c.offsetWidth/2+50+"px"):"left-top"==m[e].position?(c.style.top=a.top+d.offsetHeight/2-32+"px",c.style.left=a.left-c.offsetWidth-25+"px"):"right-top"==m[e].position?(c.style.top=a.top+d.offsetHeight-42+"px",c.style.left=a.left+d.offsetWidth+30+"px"):"right-bottom"==b.tooltips[b.currentTooltip].position&&(c.style.top=a.top-(c.offsetHeight-42)+"px",c.style.left=a.left+d.offsetWidth+30+"px"):n(c)}function k(a){var c="home/userView/centerPanelWidgets/profilePictureModal.tpl.html",d="ProfilePictureModalCtrl",e={startWebcam:function(){return!1},file:function(){return a}},g=f.customModal(c,d,e,"cnvUserProfilePictureModal",!0);g.result.then(function(a){b.$emit("userProfilePictureUpdated"),b.ProfileUploadTooltip_next()},function(){b.ProfileUploadTooltip_next()})}function l(){b.onboarding&&(1==b.onboarding.first_login?0==b.onboarding.uploaded_profile_pic:1==b.onboarding.second_login&&1==i.getChecklist().learn_my_feed_done&&0==i.getChecklist().downloaded_apps&&b.openDownloadAppsModal(),1==b.onboarding.onboarding_checklist.share_a_post_done&&!b.onboarding.uploaded_profile_pic,b.showTooltip())}var m=(d[0].querySelector(".home-dim-overlay"),[]);b.windowEventsAttached=!1,b.activeTooltips=m,b["continue"]=function(){b.finished(b.stages.cnvHomeOnboarding)},b.closeTooltip=function(a,c,d){b.windowEventsAttached&&(b.detachWindowEvents(),b.windowEventsAttached=!1),b.showingTooltips=!1,b.toggleInlineInsertArea(!1);var e=$(a.target).closest(".onboardingToolTips"),f=e[0].id.split("_"),g=f[1];b.tooltips[g].elem.remove(),"function"==typeof b[c]?b[c](d):b.showTooltip()};var n=function(a){a.remove()};b.showTooltip=function(){if(0!=b.tooltips.length&&1!=b.showingTooltips){if(null==b.currentTooltip)b.currentTooltip=0;else{if(!(b.tooltips.length>b.currentTooltip+1))return;b.currentTooltip+=1}var a="onboardingId_"+b.currentTooltip;if(b.tooltips[b.currentTooltip].freezInlineInsert&&b.toggleInlineInsertArea(!0),b.showingTooltips=!0,elem=document.createElement("div"),elem.setAttribute("id",a),elem.innerHTML=b.tooltips[b.currentTooltip].content,mainElement=$(document).find("."+b.tooltips[b.currentTooltip]["class"]).filter(":visible")[0],!mainElement)return void b.showTooltip();if(rect=mainElement.getBoundingClientRect(),0===rect.top&&0===rect.bottom)return void b.showTooltip();b.windowEventsAttached||(b.attachWindowEvents(),b.windowEventsAttached=!0),elem.style.opacity=0;var c=e(elem)(b);b.tooltips[b.currentTooltip].elem=c,d.append(c),elem.style.position="fixed",elem.style.width=b.tooltips[b.currentTooltip].width+"px",b.tooltips[b.currentTooltip].height&&(elem.style.height=b.tooltips[b.currentTooltip].height+"px"),b.tooltips[b.currentTooltip].zIndex&&(elem.style.zIndex=b.tooltips[b.currentTooltip].zIndex),"left"==b.tooltips[b.currentTooltip].position?(elem.setAttribute("class","onboardingToolTips left"),elem.style.top=rect.top+mainElement.offsetHeight/2-elem.offsetHeight/2+"px",elem.style.left=rect.left-elem.offsetWidth-25+"px"):"bottom"==b.tooltips[b.currentTooltip].position?(elem.setAttribute("class","onboardingToolTips bottom"),elem.style.top=rect.bottom+20+"px",elem.style.left=rect.left+mainElement.offsetWidth/2-elem.offsetWidth/2+"px"):"bottom-left"==b.tooltips[b.currentTooltip].position?(elem.setAttribute("class","onboardingToolTips bottom-left"),elem.style.top=rect.bottom+30+"px",elem.style.left=rect.left-elem.offsetWidth+39+"px"):"top"==b.tooltips[b.currentTooltip].position?(elem.setAttribute("class","onboardingToolTips top"),elem.style.top=rect.top-elem.offsetHeight-15+"px",elem.style.left=rect.left+mainElement.offsetWidth/2-elem.offsetWidth/2+"px"):"bottom-left-middle"==b.tooltips[b.currentTooltip].position?(elem.setAttribute("class","onboardingToolTips bottom"),elem.style.top=rect.bottom+10+"px",elem.style.left=rect.left-elem.offsetWidth/2+50+"px"):"left-top"==b.tooltips[b.currentTooltip].position?(elem.setAttribute("class","onboardingToolTips left-top"),elem.style.top=rect.top+mainElement.offsetHeight/2-32+"px",elem.style.left=rect.left-elem.offsetWidth-25+"px"):"right-top"==b.tooltips[b.currentTooltip].position?(elem.setAttribute("class","onboardingToolTips right-top"),elem.style.top=rect.top+mainElement.offsetHeight-42+"px",elem.style.left=rect.left+mainElement.offsetWidth+30+"px"):"right-bottom"==b.tooltips[b.currentTooltip].position&&(elem.setAttribute("class","onboardingToolTips right-bottom"),elem.style.top=rect.top-(elem.offsetHeight-42)+"px",elem.style.left=rect.left+mainElement.offsetWidth+30+"px"),m.push({mainElement:mainElement,elem:elem,position:b.tooltips[b.currentTooltip].position}),setTimeout(function(){elem.style.opacity=1},0)}},b.clearTooltips=function(){for(var a=0,c=m.length;c>a;++a)m[a].elem.style.opacity=0,$(m[a].elem).css("pointer-events","none");b.showingTooltips=!1},b.attachWindowEvents=function(){a.addEventListener("resize",j),a.addEventListener("scroll",j),a.addEventListener("mousewheel",j),a.addEventListener("mouseup",j)},b.detachWindowEvents=function(){a.removeEventListener("resize",j),a.removeEventListener("scroll",j),a.removeEventListener("mousewheel",j),a.removeEventListener("mouseup",j)},g.$on("filterChange",function(){setTimeout(j,0)});var o=d.find("#profileImageUpload_onboarding");o.on("change",function(a){this.files.length>0&&k(this.files[0])}),b.openFilePicker=function(){c.fireEvent(o[0],"click")},b.isElemInDOM=function(a){var b=document.querySelector("."+a);return b?(rect=b.getBoundingClientRect(),0===rect.top&&0===rect.bottom?!1:!0):!1},b.getItemPosition=function(a){var b=document.querySelector("."+a);return b?(rect=b.getBoundingClientRect(),rect):!1},setTimeout(function(){l()},5e3),b.$on("cnvOnboardingTooltips:clearTooltips",b.clearTooltips),i.isOnboardingStepsCompleted()||1===i.getChecklist().onboarding_dismissed?b.showUpgradeToolTip():i.on("cnvOnboarding:showUpgradeTooltip",b.showUpgradeToolTip)},controller:["$scope","ServerComm","config","AppLinks","mixpanelService","settingsService","$location","$rootScope","userInfo","accountInfo","onboardingService","integrationsIntroService","filterInfo",function(c,d,e,g,h,i,j,k,l,m,n,o,p){function q(a){for(var b=0;b<c.tooltips.length;b++)if(c.tooltips[b]["class"]==a)return!0;return!1}function r(){var a={method:"recordAction",action:"inline_insert_giphy_on_boarding_done"};d.post("onboarding",a)}function s(){var a={method:"recordAction",action:"video_playback_tooltip_shown"};d.post("onboarding",a);c.onboarding.video_playback_tooltip_shown=1}function t(a){a&&c.onboarding.show_sharing_options_tooltip?i.getGeneralSettings().then(function(a){if(a.groups[a.sharing_options_list[0].share_to].sub_type)c.pushGeneralGroupTooltip();else{var b=a.groups[a.sharing_options_list[0].share_to].title;c.pushCustomGroupTooltip(b)}c.showTooltip()}):(c.pushGroupChangedTooltip(),c.showTooltip())}function u(){return $(document).find(".left-panel-wrapper-slim").is(":visible")}c.active=!0,c.showingInlineInsertTooltips=!1,c.showingTooltips=!1,c.tooltips=[],c.currentTooltip=null;var v=g;navigator.platform.toUpperCase().indexOf("MAC")>=0&&!e.IS_NATIVE?c.showDesktopAppTooltip=!0:c.showDesktopAppTooltip=!1,c.toggleInlineInsertArea=function(a){c.onBoarding_info.preventInlineInsertCollapse=a,c.showingInlineInsertTooltips=a},c.pushDownloadTooltip=function(){if(c.isElemInDOM("downloadDesktopApp")){if(c.showDesktopAppTooltip){var a=c.getItemPosition("downloadDesktopApp");document.querySelector(".downloadDesktopApp");a.top<200?c.tooltips.push({"class":"downloadDesktopApp",position:"left-top",content:"<div class='heading'>Get Convo for Desktop!<button type='button' class='close pull-right' ng-click='closeTooltip($event, \"showDownloadTooltip_quit\")'>\xd7</button></div><div class='downloadBtnHolder btn-holder' ng-click='closeTooltip($event, \"downloadNativeApp\")'><a class='downloadBtnOffsets btn btn-primary center' href='' >Download now</a><br /><br /><img src='assets/img/onBoarding/macbook.png'></div><div style='text-align:center'><div><div class='content'>Get Convo for Desktop for even more features. Quickly post from the menu bar, get notifications in your system Notification Center, and launch Convo from your dock.</div>",width:390,height:350}):c.tooltips.push({"class":"downloadDesktopApp",position:"left",content:"<div class='heading'>Get Convo for Desktop!<button type='button' class='close pull-right' ng-click='closeTooltip($event, \"showDownloadTooltip_quit\")'>\xd7</button></div><div class='downloadBtnHolder btn-holder' ng-click='closeTooltip($event, \"downloadNativeApp\")'><a class='downloadBtnOffsets btn btn-primary center' href='' >Download now</a><br /><br /><img src='assets/img/onBoarding/macbook.png'></div><div style='text-align:center'><div><div class='content'>Get Convo for Desktop for even more features. Quickly post from the menu bar, get notifications in your system Notification Center, and launch Convo from your dock.</div>",width:390,height:350})}}else c.openDownloadAppsModal()},c.pushProfileUploadTooltipHeader=function(){c.tooltips.push({"class":"profilePictureHeader",position:"bottom-left",content:"<div class=' blue-content'>Your posts would look much nicer with a profile picture.</div><div class='paddingTop10'><a class='btn btn-primary width190' ng-click='closeTooltip($event, \"openProfilePictureModal\", \"Profile Menu\")' >Add a profile photo</a> <a class='marginLeft15 skip' ng-click='closeTooltip($event, \"ProfileUploadTooltip_next\")'>Maybe later</a></div>",width:340,height:140,zIndex:111})},c.pushProfileUploadTooltip=function(){for(var a=0,b=c.activeTooltips.length;b>a;++a){var d=$(c.activeTooltips[a].elem);if(d.is(":visible")&&0!=d.css("opacity"))return}c.tooltips.push({"class":"dp-wrapper",position:"bottom",content:"<div class=' blue-content'>Awesome post! It would look even nicer with a profile photo.</div><div class='paddingTop10'><a class='btn btn-primary width190' ng-click='closeTooltip($event, \"openProfilePictureModal\", \"Feed Item\")'  >Add a profile photo</a> <a ' class=' marginLeft15 skip' ng-click='uploadProfileTooltipFromFeedDismissed()'>Maybe later</a></div>",width:340,height:140,zIndex:6}),c.showTooltip()},c.ProfileUploadTooltip_next=function(){c.onboarding&&1==c.onboarding.second_login?c.openDownloadAppsModal():c.showTooltip()},c.openDownloadAppsModal=function(){c.clearTooltips();var a="home/components/downloadAppsModal/downloadAppsModal.tpl.html",b="DownloadAppsModalCtrl",d=f.customModal(a,b,null,"download-apps-modal-wrapper");d.result.then(function(){c.tooltips.length>0?c.showTooltip():n.onboardingDismissedCallback()},function(){n.onboardingDismissedCallback()})},c.downloadNativeApp=function(){var b=navigator.platform.toUpperCase().indexOf("MAC")>=0?"Mac":"Windows";h.trackEvent(h.Clicked_Download_Dekstop_App,{Source:"Download Tooltip in Web","App Type":b}),a.open(e.HTML_APP_DOWNLOAD_URL),c.showTooltip()},c.openSettings=function(){c.toggleInlineInsertArea(!1);var b=g.newResourceLink("12",[{type:"9",uid:0},{type:"customizeFeedSettings",uid:0}],null,"Customize Feed"),d=g.linkToUrl(b,!0);a.location.href=d},c.openProfilePictureModal=function(a){h.trackEvent(h.Click_Add_Profile_Photo_Tooltip,{type:a});var b="components/combinedSetProfilePictureModal/combinedSetProfilePictureModal.tpl.html",d="CombinedSetProfilePictureModalCtrl",e=f.customModal(b,d,null,"combined-set-pic-modal");e.result.then(function(){n.checkState()&&k.$broadcast("cnvOnboarding:updateOnboardingChecklist"),c.showTooltip()},function(){n.checkState()&&k.$broadcast("cnvOnboarding:updateOnboardingChecklist"),c.showTooltip()})},c.pushGeneralGroupTooltip=function(){var a=m.getPrimaryAccountDomain();c.tooltips.push({freezInlineInsert:!0,"class":"tag-item",position:"bottom",content:"<div class=' blue-content'><p class='heading center'>Choose who sees this post</p><p>Add a group or teammate.</p><p>You can also add a "+a.user_email_domain+" email address for someone who isn't here yet.</p><p class='content'>The default recipient is set to <strong>Everyone</strong>, a company-wide group. <a ng-click='closeTooltip($event,\"openSettings\")' href=''>Change default</a>.</p></div><div class='paddingTop10 center'><a class='btn btn-primary width190' ng-click='closeTooltip($event)'>Got it!</a></div>",width:328,zIndex:111})},c.pushGroupChangedTooltip=function(){c.onboarding.show_sharing_options_changed_tooltip&&!q("tag-item")&&c.tooltips.push({freezInlineInsert:!0,"class":"tag-item",position:"bottom",content:"<div class=' blue-content'><p>We created a couple of new groups for you: <br />- <strong>Everyone</strong> for company-wide communication<br />- <strong>Misc</strong> for non-work-related, fun stuff</p><p>Your default group is now the <strong>Everyone</strong> group, but you can change this in <a ng-click='closeTooltip($event,\"openSettings\")' href=''>settings</a>.</p></div><div class='paddingTop10 center'><a class='btn btn-primary width190' ng-click='closeTooltip($event, \"pushGroupChangedTooltip_callback\")'>Got it!</a></div>",width:337,zIndex:111})},c.pushCustomGroupTooltip=function(a){c.tooltips.push({freezInlineInsert:!0,"class":"tag-item",position:"bottom",content:"<div class=' blue-content'><p>This is where you specify who will see this post. Add a group or teammate's name here.</p> <p>By default, new posts go to the <strong>"+_.escape(a)+"</strong> group.</p> <p>You can change this default in <a ng-click='closeTooltip($event,\"openSettings\")' href=''>settings</a>.</p></div><div class='paddingTop10 center'><a class='btn btn-primary width190' ng-click='closeTooltip($event)'>Got it!</a></div>",width:328,zIndex:111})},c.pushGroupChangedTooltip_callback=function(){c.onboarding.show_sharing_options_changed_tooltip=!1,c.showTooltip()},c.callbackOfGiphyTooltipForInlineInsert=function(){r(),c.showTooltip()},c.callbackOfVideoPlaybackTooltipForInlineInsert=function(){s(),c.showTooltip()},c.showIntegrationsTooltip=function(){c.clearTooltips(),c.tooltips.push({"class":"onboarding-integrations-tooltip",position:"left-top",content:"<div class=' blue-content'><i class='cnv-icons-10 icons2_Close-lightgray' ng-mousedown='closeTooltip($event);dismissPilotTooltips(\"Connect to other tools\")'></i>Get notifications from all the tools you use for your daily work, all in one place.<br /><br />Connect your email, calendar, social media and more.</div><div class='paddingTop20 center'><a class='btn btn-primary width190' ng-mousedown='closeTooltip($event, \"setupIntegration\")'>Set up an integration</a></div>",width:340,height:197,zIndex:111}),c.showTooltip()},c.showUpgradeToolTip=function(){0==c.onboarding.upgrade_now_tooltip_shown&&b(function(){var a=l.getUserInfo().name.split(" ")[0],b=m.getAccountName();c.clearTooltips(),c.tooltips.push({"class":"onboarding-upgrade-to-premium-tooltip",position:"bottom",content:"<div class='blue-content'><i class='cnv-icons-10 icons2_Close-lightgray' ng-click='closeTooltip($event);'></i>Hey <span>"+a+"</span>, want to take control of the <span>"+b+"</span> network?<br/><br/>Upgrade to get advanced admin controls, enhanced security with at-rest encryption and unlimited users and groups.<div class='paddingTop20 center'><a class='btn btn-primary width190' ng-click='closeTooltip($event, \"openPremiumUpgrade\")'>Upgrade Now</a></div></div>",width:320,zIndex:113}),c.showTooltip(),n.recordAction("upgrade_now_tooltip_shown"),c.onboarding.upgrade_now_tooltip_shown=1},1e3)},c.createGroupTooltip2=function(){c.clearTooltips(),c.tooltips.push({"class":u()?"onboarding-add-group-tooltip-slim":"onboarding-add-group-tooltip",position:"right-top",content:"<div class='blue-content'><i class='cnv-icons-10 icons2_Close-lightgray' ng-click='closeTooltip($event);dismissPilotTooltips(\"Create a group\")'></i><strong>Groups</strong> are great for organizing discussions by team, project, or topic.<br /><br />You can control who can access your groups.<div class='paddingTop20 center'><a class='btn btn-primary width190' ng-click='closeTooltip($event, \"createGroup\")'>Create a new group</a></div>",width:330,height:180,zIndex:111}),c.showTooltip()},c.sharePostTooltip=function(){c.clearTooltips();var a;a=l.isGuestUser()?"<div class='blue-content'><i class='cnv-icons-10 icons2_Close-lightgray' ng-mousedown='closeTooltip($event);dismissPilotTooltips(\"Share a post\")'></i>Great! You've seen your news feed in action.<br /><br />Go ahead and share a quick post to say hello to your group.</div><div class='paddingTop20 center'><a class='btn btn-primary width190' ng-mousedown='closeTooltip($event, \"sharePost\")'>Let's do this!</a></div>":"<div class='blue-content'><i class='cnv-icons-10 icons2_Close-lightgray' ng-mousedown='closeTooltip($event);dismissPilotTooltips(\"Share a post\")'></i>You've learned to create groups and invite your teammates.<br />It would be awesome if you shared a quick welcome post for them.</div><div class='paddingTop20 center'><a class='btn btn-primary width190' ng-mousedown='closeTooltip($event, \"sharePost\")'>Let's do this!</a></div>",c.tooltips.push({"class":"onboarding-share-post-tooltip",position:"left-top",content:a,width:330,height:180,zIndex:111}),c.showTooltip()},c.showEmptyRecentSearchTooltip=function(){c.clearTooltips(),c.tooltips.push({"class":"top-search-wrapper",position:"bottom",content:"<div class=' blue-content'><i class='cnv-icons-10 icons2_Close-lightgray' ng-mousedown='closeTooltip($event);'></i>Narrow your search with these handy operators:<br /><span class='tag-badge'>has:</span> Search for attachments<br /><span class='tag-badge'>tag:</span> Discover posts by tag:launch<br /><span class='tag-badge'>is:</span> View specific post types, e.g. is:link<br />Or click <i class='cnv-icons-15 icons2_Dropdown-lightgray'></i> for advanced search options</div><div class='paddingTop20 center'><a class='btn btn-primary width190' ng-mousedown='closeTooltip($event);'>Got it</a></div>",
width:340,height:223,zIndex:111}),c.showTooltip()},c.createGroup=function(){k.$broadcast("cnvOnboarding:openCreateGroupModal"),c.clearTooltips()},c.sharePost=function(){c.$emit("cnvOnboarding:openSharePostWidget"),c.clearTooltips()},c.setupIntegration=function(){c.clearTooltips(),o.initIntegrationsIntroDialog(),c.$emit("cnvOnboarding:integrationsDialogDisplayed")},c.openPremiumUpgrade=function(){var a=g.newResourceLink("19",[{type:"17",uid:0}],null,"Upgrade"),b=g.linkToUrl(a,!0);j.url(b.slice(1))},c.uploadProfileTooltipFromFeedDismissed=function(){c.clearTooltips(),c.$emit("cnvOnboarding:uploadProfileTooltipFromFeedDismissed")},c.dismissPilotTooltips=function(a){n.recordAction("onboarding_dismissed"),h.trackEvent(h.X_OUT_GETTING_STARTED,{Type:a,Trigger:"Click"})},c.$on("inlineInsertOpen",function(){if(c.onboarding&&(!c.onboarding.video_playback_tooltip_shown||c.onboarding.show_sharing_options_tooltip||c.onboarding.show_sharing_options_changed_tooltip||!c.onboarding.inline_insert_controls_on_boarding_done||!c.onboarding.inline_insert_giphy_on_boarding_done)){c.clearTooltips();var a=!p.filterApplied;if(b(function(){t(a),a&&(c.onboarding.show_sharing_options_tooltip=!1)},500),a&&(c.onboarding.show_sharing_options_tooltip||c.onboarding.show_sharing_options_changed_tooltip)){var e={method:"recordAction",action:"sharing_options_tooltip_shown"};d.post("onboarding",e)}}}),c.$on("$locationChangeStart",function(a){var b=j.path(),d=j.search(),e=j.hash(),f=v.urlToLink(b,d,e);f&&f.resourcePath&&(c.toggleInlineInsertArea(!1),c.showingTooltips=!1)}),c.$on("premiumUpgradeOpened",function(){c.clearTooltips()}),c.$on("cnvOnboardingTooltips:openSetupIntegrations",c.setupIntegration),c.$on("cnvOnboardingTooltips:showDownloadAppsModal",c.openDownloadAppsModal),c.$on("cnvOnboardingTooltips:createGroupTooltip:2",c.createGroupTooltip2),c.$on("cnvOnboardingTooltips:showProfilePicTooltip",c.pushProfileUploadTooltip),c.$on("cnvOnboardingTooltips:sharePostTooltip",c.sharePostTooltip),c.$on("cnvOnboardingTooltips:showIntegrationsTooltip",c.showIntegrationsTooltip),c.$on("cnvOnboardingTooltips:showEmptyRecentSearchTooltip",c.showEmptyRecentSearchTooltip)}]}}]),b.module("convoApp").factory("onboardingService",["ServerComm","$q","homeViewStateInfo","mixpanelService",function(a,b,c,d){function e(){var c={method:"createFirstPilotPost"},d=a.postx("onboarding",c),e=b.defer();return d.then(function(a,b){e.resolve(a.data)},function(a,b){e.reject(a.data)}),e.promise}function f(){var c={method:"createSecondPilotPost"},d=a.postx("onboarding",c),e=b.defer();return d.then(function(a,b){e.resolve(a.data)},function(a,b){e.reject(a.data)}),e.promise}function g(c){var d={method:"createFirstPilotComment",feed_id:c},e=a.postx("onboarding",d),f=b.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}function h(c,d){var e={method:"createSecondPilotComment",feed_id:c,replied_to_comment_id:d},f=a.postx("onboarding",e),g=b.defer();return f.then(function(a,b){g.resolve(a.data)},function(a,b){g.reject(a.data)}),g.promise}function i(){if(!y)return!1;for(var a in y)if("onboarding_dismissed"!==a&&0===y[a])return!1;return!0}function j(){var c=a.getx("onboarding"),d=b.defer();return c.then(function(a,b){y=a.data.data.onboarding_checklist,B&&(y.downloaded_apps=1),d.resolve(a.data)}),d.promise}function k(){x.trigger("cnvOnboarding:showUpgradeTooltip")}function l(c){var d={method:"recordAction",action:c},e=a.postx("onboarding",d),f=b.defer();return e.then(function(a,b){"onboarding_dismissed"===c&&(y.onboarding_dismissed=1,k()),f.resolve(a.data)}),f.promise}function m(a){if(z){var b=x.recordAction("connect_to_other_tools_done");b.then(function(b,c){x.trigger("cnvOnboarding:updateOnboardingChecklist"),a&&("Webhooks"===a?d.trackEvent(d.ADD_INTEGRATION,{Source:"Webhook",Via:"Webhook",From:"GS"}):d.trackEvent(d.ADD_INTEGRATION,{Source:a,Via:"Direct",From:"GS"}))})}}function n(a){y=a}function o(){return y}function p(a){a&&(C=!1),z=a,x.trigger("cnvOnboarding:stateChange")}function q(){return z}function r(){return A}function s(){B=!0}function t(a){A=a}function u(a){C=a,x.trigger("cnvOnboarding:feedOnboardingStateChange")}function v(){return C}function w(){x.trigger("cnvOnboarding:cnvPilotIntroDismissed")}var x={},y=null,z=!1,A="learn_my_feed",B=!1,C=!1;({defer:b.defer(),status:!1});return _.extend(x,Backbone.Events),x.createFirstPilotPost=e,x.createSecondPilotPost=f,x.createFirstPilotComment=g,x.createSecondPilotComment=h,x.getOnboardingState=j,x.recordAction=l,x.markIntegrationsAsDone=m,x.setChecklist=n,x.getChecklist=o,x.changeState=p,x.checkState=q,x.getLastPlayedStep=r,x.setLastPlayedStep=t,x.markDownloadedAppFromAdvert=s,x.feedOnboardingStatus=u,x.getFeedOnboardingState=v,x.onboardingDismissedCallback=k,x.isOnboardingStepsCompleted=i,x.convoPilotIntroDismissed=w,x}]),b.module("convoApp").factory("relevanciesService",["ServerComm","$rootScope","$q","localStore","userInfo",function(a,b,c,d,e){function f(){return n}function g(){if(o){var a=d.readData(f());return a&&(a.version===m?(a=a.data,p=c(function(b){b(a)})):d.clearData(f())),o=!1,p}return p}function h(c,e,h){var n=g();if(!j&&(!k||e)){var o={authToken:b.login_data.xmpp_session_token,userID:b.login_data.user.user_id,accountID:b.login_data.account_id,groupIDs:c.join()};a.postx("analytics/relevancies",o).then(function(a){l.resolve(a.data),p&&h&&i.trigger("relevanciesFetched"),p=null,d.writeData(f(),a.data,m)||d.writeData(f(),"",m)})}return n?n:l.promise}var i={};_.extend(i,Backbone.Events);var j,k,l=c.defer(),m=1,n="USR_GRP_RELEVANCIES",o=!0,p=null;return i.getRelevancies=h,i.getRelevanciesPromise=function(){var a=g();return a?a:l.promise},i}]),a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.Constants={XMLNS:{SUBSCRIBE:"convo:pubsub:subscribe",UNSUBSCRIBE:"convo:pubsub:unsubscribe",REMOVE_NODE:"convo:pubsub:node:delete",REMOVE_ITEM:"convo:pubsub:item:delete",PUBLISH:"convo:pubsub:item:publish",FETCH_ITEMS:"convo:pubsub:item:get"},TAG:{CONVO_PUBSUB:"convo-pubsub",NODE_CONFIG:"node-config",RANGE:"range",ITEMS:"items",ITEM:"item",BODY:"body"}},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.Notification=function(){this.type,this.data=null,this.format="json"},g.rtc.Notification.COMMENT_ADDED=1,g.rtc.Notification.COMMENT_UPDATED=8,g.rtc.Notification.COMMENT_DELETED=128,g.rtc.Notification.UPDATE_FEED=2,g.rtc.Notification.FEED_SHARING_INFO_UPDATED=48,g.rtc.Notification.ACCOUNT_DATA_CHANGED=4,g.rtc.Notification.ACCOUNT_DATA_CHANGED_WEB=4194304,g.rtc.Notification.USER_SETTINGS_UPDATED=5242880,g.rtc.Notification.USER_GROUP_SETTINGS_UPDATED=6291456,g.rtc.Notification.REMINDERS_DATA_CHANGED=16,g.rtc.Notification.UP_COMMING_DATA_CHANGED=32,g.rtc.Notification.COMMENT_LIKE=256,g.rtc.Notification.COMMENT_UNLIKE=512,g.rtc.Notification.RESOURCE_LIKE=1024,g.rtc.Notification.RESOURCE_UNLIKE=2048,g.rtc.Notification.COMMENT_LIKE_OR_UNLIKE=64,g.rtc.Notification.RESOURCE_LIKE_OR_UNLIKE=80,b.module("convoApp").factory("RTCNotification",[function(){return g.rtc.Notification}]),a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.PubsubEvents={SYNCHRONIZATION_CHANGE:"synchronizationChange",RECONNECT:"reconnect",ITEM_RECEIVE:"itemReceive",ITEM_RETRACT:"itemRetract",UNSUBSCRIBED:"unsubscribed",REMOVED:"removed",PROPERTY_ADD:"propertyAdd",PROPERTY_CHANGE:"propertyChange",PROPERTY_REMOVE:"propertyRemove",ACQUIRE_LOCK_RESULT:"acquireLockResult",RESOURCE_LOCKED:"resourceLocked",RESOURCE_RELEASED:"resourceReleased",CHANGE_RECEIVED:"changeReceived",NOTIFICATION_RECEIVE:"notificationReceive"},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.RTCFactory=function(){var a=null,b=null,d={};return{init:function(c,d){b=c,a=d},getRTCManager:function(e,f){if(d[e]!==c)return d[e].numClients++,d[e].instance;if(!b||!a)throw new Error("RTCFactory not initialized");var h=new g.rtc.RTCommuncationManager(f,e,b,a);return d[e]={instance:h,numClients:1},h},releaseRTCManager:function(a){d[a].numClients--,0===d[a].numClients&&(d[a].instance.disconnect(),delete d[a])},createNotificationManager:function(c){if(!b||!a)throw new Error("RTCFactory not initialized");return new g.rtc.RTCNotificationManager(c,b,a)}}}(),b.module("convoApp").factory("rtcNotificationManager",[function(){return g.rtc.RTCFactory.createNotificationManager("")}]),a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.PubsubManager=function(a,b){var c=g.rtc.Constants,d={},e=b,f=a,h=this;e.addListener(g.chatsdk.ChatEvents.CONNECTED,function(){e.addHandler(h.onMessageReceived,null,"message","normal")}),this.subscribe=function(a,b,e){d[a.sharedID]=a,this.sendPubsubIQ("set",[a.nodeConfiguration],a.sharedID,c.XMLNS.SUBSCRIBE,b,e)},this.unsubscribe=function(a,b,d){this.sendPubsubIQ("set",[],a.sharedID,c.XMLNS.UNSUBSCRIBE,b,d)},this.remove=function(a,b,d){this.sendPubsubIQ("set",[],a.sharedID,c.XMLNS.REMOVE_NODE,b,d)},this.publishItem=function(a,b,d,e){d||(d=this.onItemPublished),this.sendPubsubIQ("set",[a],b.sharedID,c.XMLNS.PUBLISH,d,e)},this.removeItem=function(a,b,d,e){var f=new g.rtc.MessageItem(a);d||(d=this.onItemRemoved),this.sendPubsubIQ("set",[f],b.sharedID,c.XMLNS.REMOVE_ITEM,d,e)},this.fetchAllItems=function(a,b,d){var e=new g.rtc.RangeElement(0,a.nodeConfiguration.MAX_PERSIST_TEIMS);this.sendPubsubIQ("get",[e],a.sharedID,c.XMLNS.FETCH_ITEMS,b,d)},this.getPubSubJid=function(){return this._convoChatJid||(this._convoChatJid="convopubsub@"+f.getDomain()),this._convoChatJid},this.sendPubsubIQ=function(a,b,d,e,i,j){var k=g.chatsdk.ChatUtils.generateUniqueId(),l=$iq({to:h.getPubSubJid(),type:a,id:k});l.c(c.TAG.CONVO_PUBSUB,{node_id:d,xmlns:e}),b&&b.length&&b.forEach(function(a){"function"==typeof a.serialize?l.cnode(a.serialize()).up():console.warn("item is not serializable")}),f.sendIQ(l,k,!0,i,j)},this.onMessageReceived=function(a){try{var b=$(a).find(c.TAG.CONVO_PUBSUB);if(b.length){var e=(new g.rtc.MessageItem).deserialize(b.find(c.TAG.ITEM)[0]),f=h.parseNodeId(b.attr("node_id")),i=d[f];b.attr("xmlns")===c.XMLNS.PUBLISH?i&&i.messageItemsReceived([e]):b.attr("xmlns")===c.XMLNS.REMOVE_ITEM&&i&&i.retractIDsReceived(f,[e.itemID])}}catch(j){console.error(j.stack)}return!0},this.parseNodeId=function(a){return a?a:null},this.onItemPublished=function(a){var b=$(a).find(c.TAG.CONVO_PUBSUB);if(b.length){var e=(new g.rtc.MessageItem).deserialize(b.find(c.TAG.ITEM)[0]),f=d[b.attr("node_id")];f&&f.messageItemsReceived([e])}},this.onItemRemoved=function(a){var b=$(a).find(c.TAG.CONVO_PUBSUB);if(b){var e=(new g.rtc.MessageItem).deserialize(b.find(c.TAG.ITEM)[0]),f=b.attr("node_id"),h=d[f];h&&h.retractIDsReceived(f,[e.itemID])}}},g.rtc.RangeElement=function(a,b){this.fromIndex=a,this.toIndex=b},g.rtc.RangeElement.prototype.serialize=function(){return $build(g.rtc.Constants.TAG.RANGE,{from_index:this.fromIndex,to_index:this.toIndex}).tree()},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.RTCommuncationManager=function(a,b,c,d){g.chatsdk.EventDispatcher.call(this),this.Events=g.chatsdk.ChatEvents,this.PSEvents=g.rtc.PubsubEvents,this._RTC=g.rtc,this.Util=g.chatsdk.ChatUtils,this.timestampManager=d,this._xmppCallsManager=c;var e=this;this.presence=new this._RTC.SharedObject(b+"_presence_web",null,this.timestampManager,this._xmppCallsManager),this.presence.addListener(this.PSEvents.SYNCHRONIZATION_CHANGE,function(a){e.onPresenceSyncChange(a)});var f=new this._RTC.NodeConfiguration;f.maxPersistItems=1,this.locksModel=new this._RTC.SharedObject(b+"_locks",f,this.timestampManager,this._xmppCallsManager),this.locksModel.addListener(this.PSEvents.PROPERTY_ADD,function(a){e.onLocksPropertyAdd(a)}),this.locksModel.addListener(this.PSEvents.PROPERTY_CHANGE,function(a){e.onLocksPropertyChange(a)}),this.locksModel.addListener(this.PSEvents.PROPERTY_REMOVE,function(a){e.onLocksPropertyRemove(a)}),this.locksModel.addListener(this.PSEvents.SYNCHRONIZATION_CHANGE,function(a){e.onLocksSyncChange(a)});var h=new this._RTC.NodeConfiguration;h.maxPersistItems=0,this.changesNode=new this._RTC.Node(b+"_changes_web",h,this._xmppCallsManager),this.changesNode.addListener(this.PSEvents.SYNCHRONIZATION_CHANGE,function(a){e.onSyncChange(a)}),this.changesNode.addListener(this.PSEvents.ITEM_RECEIVE,function(a){e.onItemReceive(a)}),this.changesNodeAir=new this._RTC.Node(b+"_changes",h,this._xmppCallsManager),this.changesNodeAir.addListener(this.PSEvents.ITEM_RECEIVE,function(a){e.changesNodeAir.unsubscribe()})},g.rtc.RTCommuncationManager.prototype=new g.chatsdk.EventDispatcher,g.rtc.RTCommuncationManager.prototype.constructor=g.rtc.RTCommuncationManager,g.rtc.RTCommuncationManager.prototype.connect=function(){this.subscribeAll()},g.rtc.RTCommuncationManager.prototype.disconnect=function(){var a=this._xmppCallsManager.getJid();this.presence.isSynchronized()&&this.presence.hasProperty(a)&&this.presence.removeProperty(a),this.changesNode.isSynchronized?(this.locksModel.close(),this.presence.close(),this.changesNode.unsubscribe()):(this.locksModel.cancelSubscription(),this.presence.cancelSubscription(),this.changesNode.cancelSubscription())},g.rtc.RTCommuncationManager.prototype.isConnected=function(){return this.changesNode.isSynchronized&&this.presence.isSynchronized()&&this.locksModel.isSynchronized()},g.rtc.RTCommuncationManager.prototype.canIsendChange=function(){if(this.isConnected()){var a=this.presence.values,b=this._xmppCallsManager.getJid();for(var c in a)if(c!=b)return!0}return!1},g.rtc.RTCommuncationManager.prototype.sendChange=function(a){if(this.changesNode.isSynchronized){var b=new this._RTC.MessageItem(this.Util.generateUniqueId(),this._xmppCallsManager.getJid(),this.timestampManager.UTCTimestamp(),a);this.changesNode.publishItem(b)}},g.rtc.RTCommuncationManager.prototype.acquireLock=function(a){if(this.locksModel.isSynchronized()){var b=this._xmppCallsManager.getJid();if(this.locksModel.hasProperty(a)){var c=this.locksModel.getProperty(a),d=this.Util.makeUserIdFromJid(c),e=new this._RTC.Lock;e.absoluteItemID=a,e.userId=d,c!=b?e.status=this._RTC.LockStatus.FAILURE:e.status=this._RTC.LockStatus.SUCCESS,this.dispatch(this.PSEvents.ACQUIRE_LOCK_RESULT,{data:e})}else this.locksModel.setProperty(a,b)}},g.rtc.RTCommuncationManager.prototype.sendEditComplete=function(a){this.changesNodeAir.subscribe();var b=new this._RTC.MessageItem(this.Util.generateUniqueId(),this._xmppCallsManager.getJid(),this.timestampManager.UTCTimestamp(),{type:5,itemId:a});this.changesNodeAir.publishItem(b)},g.rtc.RTCommuncationManager.prototype.releaseLock=function(a,b){if(this.locksModel.isSynchronized()&&this.locksModel.hasProperty(a)){var c=this._xmppCallsManager.getJid(),d=this.locksModel.getProperty(a);(d==c||b)&&(this.locksModel.removeProperty(a),this.sendEditComplete(a))}},g.rtc.RTCommuncationManager.prototype.queryLock=function(a){var b;if(this.locksModel.isSynchronized()){b=new this._RTC.Lock;var c=this._xmppCallsManager.getJid();if(this.locksModel.hasProperty(a)){var d=this.locksModel.getProperty(a),e=this.Util.makeUserIdFromJid(d);b.absoluteItemID=a,b.userId=e,d!=c?b.status=this._RTC.LockStatus.IN_USE:b.status=this._RTC.LockStatus.SUCCESS}else b.userId=this.Util.makeUserIdFromJid(c),b.status=this._RTC.LockStatus.FREE}return b},g.rtc.RTCommuncationManager.prototype.subscribeAll=function(){this.changesNode.subscribe(),this.presence.subscribe(),this.locksModel.subscribe()},g.rtc.RTCommuncationManager.prototype.onSyncChange=function(a){this.changesNode.isSynchronized?this.checkAllSynced():this.dispatch(this.Events.DISCONNECTED)},g.rtc.RTCommuncationManager.prototype.checkAllSynced=function(){this.changesNode.isSynchronized&&this.locksModel.isSynchronized()&&this.presence.isSynchronized()&&this.dispatch(this.Events.CONNECTED)},g.rtc.RTCommuncationManager.prototype.onItemReceive=function(a){var b=a.data;b.publisherID!=this._xmppCallsManager.getJid()&&this.dispatch(this.PSEvents.CHANGE_RECEIVED,{data:b.body})},g.rtc.RTCommuncationManager.prototype.onPresenceSyncChange=function(a){if(this.checkAllSynced(),this.presence.isSynchronized()){var b=this._xmppCallsManager.getJid();this.presence.hasProperty(b)||this.presence.setProperty(b,!0)}},g.rtc.RTCommuncationManager.prototype.onLocksPropertyAdd=function(a){var b=new this._RTC.Lock;b.absoluteItemID=a.propertyName;var c=this._xmppCallsManager.getJid(),d=a.value,e=this.Util.makeUserIdFromJid(d);d==c?(b.userId=this.Util.makeUserIdFromJid(c),d==c?b.status=this._RTC.LockStatus.SUCCESS:b.status=this._RTC.LockStatus.FAILURE,this.dispatch(this.PSEvents.ACQUIRE_LOCK_RESULT,{data:b})):(b.userId=e,b.status=this._RTC.LockStatus.IN_USE,this.dispatch(this.PSEvents.RESOURCE_LOCKED,{data:b}))},g.rtc.RTCommuncationManager.prototype.onLocksPropertyChange=function(a){var b=new this._RTC.Lock;b.absoluteItemID=a.propertyName;var c=a.value,d=this._xmppCallsManager.getJid();b.userId=this.Util.makeUserIdFromJid(c),c==d?(b.status=this._RTC.LockStatus.SUCCESS,this.dispatch(this.PSEvents.ACQUIRE_LOCK_RESULT,{data:b})):(b.status=this._RTC.LockStatus.IN_USE,this.dispatch(this.PSEvents.RESOURCE_LOCKED,{data:b}))},g.rtc.RTCommuncationManager.prototype.onLocksPropertyRemove=function(a){var b=a.value,c=this.Util.makeUserIdFromJid(b),d=new this._RTC.Lock;d.absoluteItemID=a.propertyName,d.userId=c,d.status=this._RTC.LockStatus.FREE,this.dispatch(this.PSEvents.RESOURCE_RELEASED,{data:d})},g.rtc.RTCommuncationManager.prototype.onLocksSyncChange=function(a){this.checkAllSynced()},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.RTCNotificationManager=function(a,b,c){function d(a){var b=a.data;b&&b.body&&b.publisherID&&b.publisherID!=k.getJid()&&m.dispatch(j.NOTIFICATION_RECEIVE,{notification:b.body})}function e(a){o.isSynchronized?m.dispatch(i.CONNECTED):m.dispatch(i.DISCONNECTED)}g.chatsdk.EventDispatcher.call(this);var f=g.rtc,h=g.chatsdk.ChatUtils,i=g.chatsdk.ChatEvents,j=f.PubsubEvents,k=b,l=c,m=this,n=new f.NodeConfiguration,o=new f.Node(a+"notificaitons",n,k);o.addListener(j.ITEM_RECEIVE,d),o.addListener(j.SYNCHRONIZATION_CHANGE,e),this.connect=function(){o.subscribe()},this.disconnect=function(){o.unsubscribe()},this.send=function(a){if(o.isSynchronized){var b=new f.MessageItem(h.generateUniqueId(),k.getJid(),l.UTCTimestamp(),a);o.publishItem(b)}},this.isConnected=function(){return o.isSynchronized}},g.rtc.RTCNotificationManager.prototype=new g.chatsdk.EventDispatcher,g.rtc.RTCNotificationManager.prototype.constructor=g.rtc.RTCNotificationManager,a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.Lock=function(){this.sectionID,this.absoluteItemID,this.status,this.userId,this.scrybeID},g.rtc.LockStatus={SUCCESS:1,FAILURE:10,IN_USE:20,FREE:30},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.MessageItem=function(a,b,c,d){this.format="json",this.itemID=a,this.publisherID=b,this.timestamp=c,this.body=d},g.rtc.MessageItem.prototype.serialize=function(){var a=g.rtc.Constants.TAG,b={id:this.itemID};this.publisherID&&(b.publisher_id=this.publisherID),this.timestamp&&(b.timestamp=this.timestamp),this.format&&(b.format=this.format);var c=$build(a.ITEM,b);if(this.body){var d=JSON.stringify(this.body),e=pako.deflate(d,{to:"string"});e=btoa(e),c.c(a.BODY).t(e)}return c.tree()},g.rtc.MessageItem.prototype.deserialize=function(a){if(!a)return null;var b=g.rtc.Constants.TAG,c=$(a);this.itemID=c.attr("id"),c.attr("publisher_id")&&(this.publisherID=c.attr("publisher_id")),c.attr("timestamp")&&(this.timestamp=parseInt(c.attr("timestamp"))),c.attr("format")?this.format=c.attr("format"):this.format=null;var d=c.find(b.BODY);if("json"===this.format&&d.length){var e=atob(d.text());e=pako.inflate(e,{to:"string"}),this.body=JSON.parse(e)}return this},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.Node=function(a,b,c){g.chatsdk.EventDispatcher.call(this),this.Events=g.chatsdk.ChatEvents,this.PSEvents=g.rtc.PubsubEvents,this._RTC=g.rtc,this.subscribeCall=null,this.subscribed=!1,this.subscribeInProgress=!1,this.isSynchronized=!1,this.PUBLISH_ITEMS_QUEUE_SIZE=20,this.sharedID=a,this.nodeConfiguration=b,this.itemsReceivedBeforeSync=[],this.publishedItemsQueue=[],this._isRemoved=!1,this._xmppCallsManager=c,this.isUnsubscribed=!1;var d=this;this.onSessionConnected=function(){d.subscribed&&(d.isSynchronized||d.subscribeInProgress||d.subscribeCall||(d.dispatch(d.PSEvents.RECONNECT),d.subscribe()))},this.unsubscribed=function(a){d.dispatch(d.PSEvents.UNSUBSCRIBED)},this.onNodeRemoved=function(a){d.dispatch(d.PSEvents.REMOVED)},this.onSessionDisconnected=function(){d.isSynchronized&&d.subscribed&&(d.subscribeInProgress=!1,d.setIsSynchronized(!1))},this._xmppCallsManager.addListener(this.Events.CONNECTED,this.onSessionConnected),this._xmppCallsManager.addListener(this.Events.DISCONNECTED,this.onSessionDisconnected)},g.rtc.Node.prototype=new g.chatsdk.EventDispatcher,g.rtc.Node.prototype.constructor=g.rtc.Node,g.rtc.Node.prototype.subscribe=function(){if(!(this.subscribeInProgress||this.isSynchronized||this.subscribeCall)){if(this.subscribeInProgress=!0,!this.sharedID)return void console.error("Node.sharedID is not set");var a=this;this.subscribeCall=new this._RTC.SubscribeNode(this,function(){a.onNodeSubscribed()},null,this._xmppCallsManager),this.subscribeCall.execute()}},g.rtc.Node.prototype.cancelSubscription=function(){this.subscribeInProgress&&(this.subscribeInProgress=!1,this.subscribeCall&&(this.subscribeCall.cancel(),this.subscribeCall=null),this.setIsSynchronized(!1))},g.rtc.Node.prototype.publishItem=function(a){return this.isSubscribeInProgress()?void this.queuePublishedMessages(a):void(this.validated()&&this._xmppCallsManager.publishItem(a,this,null,null))},g.rtc.Node.prototype.retractItem=function(a){return this.isSubscribeInProgress()?void this.removeMessageItemFromQueue(a):void(this.validated()&&this._xmppCallsManager.removeItem(a,this,null,null))},g.rtc.Node.prototype.unsubscribe=function(){this.isUnsubscribed||(this._xmppCallsManager.unsubscribe(this,this.unsubscribed,null),this._xmppCallsManager.removeListener(this.Events.CONNECTED,this.onSessionConnected),this._xmppCallsManager.removeListener(this.Events.DISCONNECTED,this.onSessionDisconnected),this.subscribed=this.isSynchronized=!1,this.isUnsubscribed=!0)},g.rtc.Node.prototype.remove=function(){this._xmppCallsManager.remove(this,this.onNodeRemoved,null),this.isSynchronized=!1,this._isRemoved=!0},g.rtc.Node.prototype.isUnsubscribed=function(){return this.isUnsubscribed},g.rtc.Node.prototype.isRemoved=function(){return this._isRemoved},g.rtc.Node.prototype.validated=function(){return this._isRemoved?(console.error("Node "+sharedID+" is removed from the service"),!1):this.isUnsubscribed?(console.error("User has unsubscribed from node = "+sharedID),!1):this.isSynchronized?!0:(console.error("Node "+sharedID+" is not Syncronized"),!1)},g.rtc.Node.prototype.onNodeSubscribed=function(){this.subscribeCall&&(this.subscribeCall.cancel(),this.subscribeCall=null),this.subscribed=!0,this.isUnsubscribed=!1,this.subscribeInProgress=!1,this.setIsSynchronized(!0),this.processPublishedQueue()},g.rtc.Node.prototype.setIsSynchronized=function(a){this.isSynchronized=a,this.itemsReceivedBeforeSync.length&&(this.isSynchronized?(this.processReceivedMessageItems(this.itemsReceivedBeforeSync),this.itemsReceivedBeforeSync=[]):this.itemsReceivedBeforeSync=[]),this.dispatch(this.PSEvents.SYNCHRONIZATION_CHANGE)},g.rtc.Node.prototype.messageItemsReceived=function(a){return this.isSynchronized?void this.processReceivedMessageItems(a):void(this.itemsReceivedBeforeSync=this.itemsReceivedBeforeSync.concat(a))},g.rtc.Node.prototype.retractIDsReceived=function(a,b){this.isSynchronized&&a==this.sharedID&&b.length&&b.forEach(function(a){this.dispatch(this.PSEvents.ITEM_RETRACT,{nodeID:this.sharedID,data:a})},this)},g.rtc.Node.prototype.processReceivedMessageItems=function(a){a.forEach(function(a){a.nodeID=this.sharedID,this.dispatch(this.PSEvents.ITEM_RECEIVE,{data:a})},this)},g.rtc.Node.prototype.queuePublishedMessages=function(a){this.publishedItemsQueue.push(a),this.publishedItemsQueue.length>this.PUBLISH_ITEMS_QUEUE_SIZE&&this.publishedItemsQueue.shift()},g.rtc.Node.prototype.removeMessageItemFromQueue=function(a){for(var b,c=this.publishedItemsQueue.length,d=0;c>d;d++)if(b=this.publishedItemsQueue[d],b.itemID==a){this.publishedItemsQueue.splice(d,1);break}},g.rtc.Node.prototype.processPublishedQueue=function(){var a=this;this.publishedItemsQueue.forEach(function(b){a.publishItem(b)},this),this.publishedItemsQueue=[]},g.rtc.Node.prototype.isSubscribeInProgress=function(){return this.subscribeInProgress||this.subscribed&&!this._xmppCallsManager.isConnected()},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.NodeConfiguration=function(a,b,c,d){this.MAX_PERSIST_TEIMS=1e4,this.maxPersistItems=a?a:0,this.deleteItemsOnUserOffline=b!==!1,this.unsubscribeUserOnOffline=c!==!1,this.deleteNodeOnLastUnsubscribe=d!==!1},g.rtc.NodeConfiguration.prototype.toJSON=function(){return{max_persist_items:this.maxPersistItems,delete_items_on_user_offline:this.deleteItemsOnUserOffline?"yes":"no",unsubscribe_user_on_offline:this.unsubscribeUserOnOffline?"yes":"no",delete_node_on_last_unsubscribe:this.deleteNodeOnLastUnsubscribe?"yes":"no"}},g.rtc.NodeConfiguration.prototype.serialize=function(){return $build(g.rtc.Constants.TAG.NODE_CONFIG,this.toJSON()).tree()},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.SharedObject=function(a,b,c,d){if(g.chatsdk.EventDispatcher.call(this),!a)return void console.error("SharedID is not set");this._RTC=g.rtc,this._PSEvents=g.rtc.PubsubEvents,this._timestampManager=c,this._xmppCallsManager=d,b||(b=new this._RTC.NodeConfiguration,b.maxPersistItems=b.MAX_PERSIST_TEIMS),this._sharedID=null;var e=this;this._onReconnect=function(a){e._sharedObject={},e.dispatch(e._PSEvents.RECONNECT,a)},this._onItemReceive=function(a){var b=a.data,c=e._sharedObject.hasOwnProperty(b.itemID),d=c?e._PSEvents.PROPERTY_CHANGE:e._PSEvents.PROPERTY_ADD;e._sharedObject[b.itemID]=b.body,e.dispatch(d,{propertyName:b.itemID,value:b.body})},this._onItemRetract=function(a){var b=a.data;if(e._sharedObject.hasOwnProperty(b)){var c=e._sharedObject[b];delete e._sharedObject[b],e.dispatch(e._PSEvents.PROPERTY_REMOVE,{propertyName:b,value:c})}},this._onNodeSyncChange=function(a){e.dispatch(e._PSEvents.SYNCHRONIZATION_CHANGE,a)},this.node=new this._RTC.Node(a,b,this._xmppCallsManager),this.node.addListener(this._PSEvents.RECONNECT,this._onReconnect),this.node.addListener(this._PSEvents.ITEM_RETRACT,this._onItemRetract),this.node.addListener(this._PSEvents.ITEM_RECEIVE,this._onItemReceive),this.node.addListener(this._PSEvents.SYNCHRONIZATION_CHANGE,this._onNodeSyncChange),this._sharedObject={}},g.rtc.SharedObject.prototype=new g.chatsdk.EventDispatcher,g.rtc.SharedObject.prototype.constructor=g.rtc.SharedObject,g.rtc.SharedObject.prototype.subscribe=function(){this.node.subscribe()},g.rtc.SharedObject.prototype.close=function(){this.node.isSynchronized&&(this.node.unsubscribe(),this.node.removeListener(this._PSEvents.RECONNECT,this._onReconnect),this.node.removeListener(this._PSEvents.ITEM_RETRACT,this._onItemRetract),this.node.removeListener(this._PSEvents.ITEM_RECEIVE,this._onItemReceive),this.node.removeListener(this._PSEvents.SYNCHRONIZATION_CHANGE,this._onNodeSyncChange))},g.rtc.SharedObject.prototype.isSynchronized=function(){return this.node.isSynchronized},g.rtc.SharedObject.prototype.cancelSubscription=function(){return this.node.cancelSubscription()},g.rtc.SharedObject.prototype.setProperty=function(a,b){if(this.node.isSynchronized){var c=new this._RTC.MessageItem(a,this._xmppCallsManager.getJid(),this._timestampManager.UTCTimestamp(),b);this.node.publishItem(c)}else this.throwNotSynchronized()},g.rtc.SharedObject.prototype.getProperty=function(a){return this._sharedObject[a]},g.rtc.SharedObject.prototype.hasProperty=function(a){return this._sharedObject.hasOwnProperty(a)},g.rtc.SharedObject.prototype.removeProperty=function(a){this.node.isSynchronized?this.node.retractItem(a):this.throwNotSynchronized()},g.rtc.SharedObject.prototype.isEmpty=function(){for(var a in this._sharedObject)return!1;return!0},g.rtc.SharedObject.prototype.removeAll=function(){for(var a in this._sharedObject)this.removeProperty(a)},g.rtc.SharedObject.prototype.values=function(){return this._sharedObject},g.rtc.SharedObject.prototype.throwNotSynchronized=function(){throw new Error("SharedObject "+_sharedID+" is not synchrionzed ")},a.com_convo=a.com_convo||{};var g=a.com_convo;g.rtc=g.rtc||{},g.rtc.SubscribeNode=function(a,b,c,d){this.canceled=!1,this.tries=0,this.MAX_TRIES=2,this.node=a,this.resultCallback=b,this.errorCallback=c,this.xmppCallsManager=d;var e=this;this.onSessionManagerConnected=function(a){e.xmppCallsManager.removeListener(g.chatsdk.ChatEvents.CONNECTED,e.onSessionManagerConnected),e.canceled||e.subscribe()}},g.rtc.SubscribeNode.prototype.cancel=function(){this.canceled=!0},g.rtc.SubscribeNode.prototype.execute=function(){this.canceled||(this.xmppCallsManager.isConnected()?this.subscribe():this.xmppCallsManager.addListener(g.chatsdk.ChatEvents.CONNECTED,this.onSessionManagerConnected))},g.rtc.SubscribeNode.prototype.subscribed=function(){this.resultCallback&&this.resultCallback()},g.rtc.SubscribeNode.prototype.subscribe=function(){if(!this.canceled){var a=this;this.xmppCallsManager.subscribe(this.node,function(b){a.onSubscribeResult(b)},function(a){this.onSubscribeError(a)})}},g.rtc.SubscribeNode.prototype.onSubscribeResult=function(a){if(!this.canceled){var b=g.rtc,c=b.Constants.TAG,d=$(a).find(c.CONVO_PUBSUB),e=[];d.each(function(){var a=$(this);a.find(c.ITEM).each(function(){var a=new b.MessageItem;a.deserialize(this),e.push(a)})}),e.length&&this.node.messageItemsReceived(e),this.subscribed()}},g.rtc.SubscribeNode.prototype.onSubscribeError=function(a){this.tries<this.MAX_TRIES?(++this.tries,this.execute()):console.error("onSubscribeError = "+a.getNode().toString())},b.module("convoApp").factory("advSearchService",[function(){function a(){i?b():d()}function b(a){i&&(i=!1,h.trigger("cnvAdvSearch:panelClose",a))}function c(){b(!0)}function d(){i||(i=!0,h.trigger("cnvAdvSearch:panelOpen"))}function e(a){j=a,h.trigger("cnvAdvSearch:updateFilters",j)}function f(a){j=a,h.trigger("cnvAdvSearch:applyFilters",j)}function g(a,b){h.hasOwnProperty(a)&&(h[a]=b)}var h={panelOpen:!1,includeChats:!0,includeDrafts:!1},i=!1,j=null;return _.extend(h,Backbone.Events),h.togglePanel=a,h.updateFilters=e,h.applyFilters=f,h.setMoreOption=g,h.openPanel=d,h.closePanel=b,h.closePanelWithoutAnim=c,h}]),b.module("convoApp").directive("cnvAdvancedSearch",["advSearchService","Users","User","usersGroupsListProvider","Filters","Group","Groups","$window","Feed","$timeout","utils","$compile","$templateCache","appLoadSequenceManager","networkSettingService",function(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return{restrict:"E",replace:!0,scope:!0,link:function(e,h,l){function q(){l.hasOwnProperty("type")&&"feed"===l.type&&x.addClass("feed-view"),k.setFetchOptions("includeChats",e.moreOptions.includeChats&&!!e.isChatEnabled),e.$broadcast("render")}function r(a){e.getAutoCompleteItems();var b=x.find(".bar-wrapper");a="SAFARI"===z?!0:a,x.removeClass("collapse-bar"),x.removeClass("collapse-bar-static"),b.removeClass("collapse-bar"),b.removeClass("collapse-bar-static"),x.css("overflow","visible"),a?(b.css("overflow","visible"),x.addClass("expand-bar-static"),b.addClass("expand-bar-static"),x.removeClass("expand-bar"),b.removeClass("expand-bar"),b=null):(x.addClass("expand-bar"),b.addClass("expand-bar"),y&&j.clearInterval(y),y=j.setTimeout(function(){b.css("overflow","visible"),x.addClass("expand-bar-static"),b.addClass("expand-bar-static"),x.removeClass("expand-bar"),b.removeClass("expand-bar"),b=null},250))}function s(a){var b=x.find(".bar-wrapper");a="SAFARI"===z?!0:a,x.removeClass("expand-bar"),x.removeClass("expand-bar-static"),b.removeClass("expand-bar"),b.removeClass("expand-bar-static"),b.css("overflow","hidden"),a?(x.css("overflow","hidden"),
x.addClass("collapse-bar-static"),b.addClass("collapse-bar-static"),x.removeClass("collapse-bar"),b.removeClass("collapse-bar")):(x.addClass("collapse-bar"),b.addClass("collapse-bar"),y&&j.clearInterval(y),y=j.setTimeout(function(){x.css("overflow","hidden"),b.css("overflow","hidden"),x.addClass("collapse-bar-static"),b.addClass("collapse-bar-static"),x.removeClass("collapse-bar"),b.removeClass("collapse-bar")},250)),e.closeFilterDropdown(null)}function t(a){if(e.filters={from:[],to:[],to_date:[],has:[],is:[],"in":[],discussions:[]},a)for(var b=0;b<a.length;b++)e.filters.hasOwnProperty(a[b].type)?e.filters[a[b].type].push(a[b]):(e.filters[a[b].type]=[],e.filters[a[b].type].push(a[b]));var c;e.fromUsers=[],e.toUsers=[],e.filters.from.length>0&&(c=d.getUserById(e.filters.from[0].value),c&&e.fromUsers.push(f.createUserListItemForSpecificGroup(c))),e.filters.to.length>0&&(g.isGroupFilter(e.filters.to[0])?e.toUsers.push(f.getGroupListItem(e.filters.to[0].value)):(c=d.getUserById(e.filters.to[0].value),e.toUsers.push(f.createUserListItemForSpecificGroup(c)))),0===e.filters.to_date.length&&(e.dateOptions.model=null),e.$broadcast("render")}function u(a){a&&0===$(a.target).closest(".filter-dropdown").length&&(e.activeFilterDropdown=null,b.element(j).off("click",u),e.$broadcast("render"))}function v(){var a="search/cnvAdvancedSearch/cnvAdvancedSearch.tpl.html",b=n(o.get(a))(e);h.empty().replaceWith(b),x=b,q()}var w={from:[],to:[],to_date:[],has:[],is:[],"in":[],discussions:[]},x=null,y=null,z=m.whichBrowser();e.filters=_.clone(w),e.appliedPostFilter="all_posts",e.usersService=d,e.toggleBar=c.togglePanel,e.moreOptions={includeChats:!0,includeDrafts:!1},e.openFilterDropdown=function(c,d){c&&$(c.target).closest(".filter-dropdown").length>0||(e.activeFilterDropdown===d?(e.activeFilterDropdown=null,b.element(j).off("click",u)):(e.activeFilterDropdown=d,c&&c.stopPropagation(),e.opened=!1,b.element(j).on("click",u)),a.setTimeout(function(){x.find(".add-more-placeholder").trigger("click")},0),e.$broadcast("render"))},e.closeFilterDropdown=function(a){a&&a.stopPropagation(),e.activeFilterDropdown=null,b.element(j).off("click",u),e.$broadcast("render")},e.getFullName=function(a){var b=d.getUserById(a);if(b)return b.first_name+" "+b.last_name;var c=i.getGroup(a);return c?i.getGroupName(a):"Anyone"},e.getPostFilterTitle=function(){var a="";return(e.filters.has.length>0||e.filters.discussions.length>0)&&(a+="Has: ",e.filters.discussions.length>0&&(a="Comments: any"+(e.filters.has.length>0?", Has: ":" ")),e.filters.has.length>0&&(a+=e.filters.has[0].description+" ")),e.filters.is.length>0&&(e.filters.has.length>0&&(a+="and "),a+="Is: "+e.filters.is[0].description),""===a?"All posts":a},c.on("cnvAdvSearch:panelClose",s),c.on("cnvAdvSearch:panelOpen",r),c.on("cnvAdvSearch:updateFilters",t),e.$on("$destroy",function(){b.element(j).off("click",u),c.off("cnvAdvSearch:panelClose",s),c.off("cnvAdvSearch:panelOpen",r),c.off("cnvAdvSearch:updateFilters",t),x=null}),p.okToLoad(p.comps.ADVANCE_SEARCH_VIEW)?v():p.on("okToLoad"+p.comps.ADVANCE_SEARCH_VIEW,function(){v()})},controller:["$scope","Users","usersGroupsListProvider","User","$q","advSearchService","Filters","FilterTypes","Groups","atMentionsListProvider","$rootScope",function(b,c,d,e,f,g,h,i,j,l,m){function n(){var a=m.filterInfo;if(a.filterApplied){for(var c,d,e=a.filterLink.filter.filters,f=a.filterLink.title,h=0;h<e.length;h++){var i=e[h];if("text"==i.type){d=!0;break}("from"==i.type||"Mentions"==f)&&(c=!0)}d&&(s||(b.moreOptions.includeChats=!!b.isChatEnabled,k.setFetchOptions("includeChats",!!b.isChatEnabled),s=!0)),c&&(s||t||(b.moreOptions.includeChats=!1,k.setFetchOptions("includeChats",!1),t=!0))}else a.filterLink||(s=!1,t=!1,g.closePanelWithoutAnim())}function o(){}b.toUsers=[],b.fromUsers=[],b.isChatEnabled=q.getChatStatus();var r=!1,s=!1,t=!1;b.getAutoCompleteItems=function(){r||(r=!0,b.fromUsersSourceList=[],b.toUsersSourceList=[],c.getUsers().then(function(a){for(var c=[],e=0;e<a.length;e++){var f=_.extend({},a[e]);f.user_email_id=a[e].email,b.fromUsersSourceList.push(d.createUserListItemForSpecificGroup(f)),c.push(d.createUserListItemForSpecificGroup(f))}j.getSearchableGroups().then(function(a){a.forEach(function(a){c.push({type:i.GROUP,value:a.get("title"),label:a.get("title"),id:a.get("id"),access:a.get("access"),desclabel:"Group",formatteddesclabel:"Group",classes:"PUBLIC"==a.get("access")?"Icon1_PublicChannel-01-blue":"privateGroup_icon-blue"})}),b.toUsersSourceList=c})}))},b.getAutoCompleteUserItemsForFrom=function(a,b){var c=f.defer(),d=l.queryPublishableUsers(a,b+4);return c.resolve(d),c.promise},b.getAutoCompleteUserItemsForTo=function(a,b){var c=f.defer(),d=l.queryPublishableUsersAndGroups(a,b+4);return c.resolve(d),c.promise},b.onItemAddedInFromField=function(c){b.fromUsers=[],b.fromUsers.push(c),b.filters.from[0]={description:c.desclabel,type:"from",value:c.id},a.setTimeout(function(){b.activeFilterDropdown=null,b.$broadcast("render"),b.applyFilters()},0)},b.onItemRemovedFromField=function(a){b.fromUsers=[],b.filters.from=[],b.applyFilters()},b.onItemAddedInToField=function(c){b.toUsers=[],b.toUsers.push(c),b.filters.to[0]={description:c.id,type:"to",value:c.id},a.setTimeout(function(){b.activeFilterDropdown=null,b.$broadcast("render"),b.applyFilters()},0)},b.onItemRemovedToField=function(a){b.toUsers=[],b.filters.to=[],b.applyFilters()},b.applyFilters=function(a){a&&a.stopPropagation();var c=[];b.filters.from.length>0&&c.push(b.filters.from[0]),b.filters.to.length>0&&c.push(b.filters.to[0]),b.filters.has.length>0&&c.push(b.filters.has[0]),b.filters.is.length>0&&c.push(b.filters.is[0]),b.filters.to_date.length>0&&c.push(b.filters.to_date[0]),b.filters["in"].length>0&&c.push(b.filters["in"][0]),b.filters.discussions.length>0&&c.push(b.filters.discussions[0]),g.applyFilters(c)},b.applyPostFilter=function(a,c){if(a&&a.stopPropagation(),c===h.hasFilter.ALL_FILES||c===h.hasFilter.IMAGES||c===h.hasFilter.PDF_VALUE||c===h.hasFilter.WORD_DOCS_VALUE||c===h.hasFilter.SLIDE_SHOWS_VALUE||c===h.hasFilter.EXCEL_SHEETS_VALUE||c===h.hasFilter.VIDEOS||c===h.hasFilter.AUDIOS){var d=h.newHasFilter(c);b.filters.has[0]&&b.filters.has[0].description==d.description?b.filters.has=[]:(b.filters.has[0]=d,b.filters.is.length>0&&("link"===b.filters.is[0].description||"chat"===b.filters.is[0].description)&&(b.filters.is=[]))}else if("link"===c||"chat"===c){var d=h.newFilter("is","link"===c?4:10,c);b.filters.is[0]&&b.filters.is[0].description==d.description?b.filters.is=[]:(b.filters.is[0]=d,b.filters.has=[],"chat"===c&&b.filters.discussions.length>0&&(b.filters.discussions=[]))}else if(c===i.IN_DRAFTS||c===i.IN_TRASH){var d=h.newFilter("in",c,c);b.filters["in"].length>0&&b.filters["in"][0].description==c?b.filters["in"]=[]:b.filters["in"][0]=d}else if("all_posts"===c)b.filters.has=[],b.filters.is=[],b.filters.discussions=[];else if("include_chats"===c)b.filters["in"]=[];else if(c===i.COMMENTS)if(b.filters.discussions.length>0)b.filters.discussions=[];else{var d=h.newFilter(i.DISCUSSIONS,i.ANY_VALUE,i.ANY_VALUE);b.filters.discussions.push(d),b.filters.is.length>0&&"chat"===b.filters.is[0].description&&(b.filters.is=[])}b.closeFilterDropdown(),b.applyFilters(),b.$broadcast("render")},b.applyMoreOptions=function(a,c,d){"includeChatsCbox"===a.target.id&&(a&&a.stopPropagation(),b.moreOptions.hasOwnProperty(c)&&(d||(b.moreOptions[c]=!b.moreOptions[c]),g.setMoreOption(c,b.moreOptions[c]),k.setFetchOptions("includeChats",b.moreOptions.includeChats)),b.applyFilters(),b.$broadcast("render"),b.$emit("refetchFeed"))},b.open=function(a){a.preventDefault(),a.stopPropagation(),b.opened=!b.opened,b.opened&&b.closeFilterDropdown()},b.dateOptions={formats:["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],formatYear:"yy",startingDay:1,model:null,showButtonBar:!1,maxDate:(new Date).getTime()},b.$watch("dateOptions.model",function(){b.dateOptions.model&&(b.dateOptions.model.setHours(23,59,59),b.filters.to_date=[h.newFilter("to_date",b.dateOptions.model.getTime(),b.dateOptions.model.getTime())],b.applyFilters())}),b.$on("filterChange",n),p.okToLoad(p.comps.ADVANCE_SEARCH_VIEW)?o():p.on("okToLoad"+p.comps.ADVANCE_SEARCH_VIEW,function(){o()})}]}}]),b.module("convoApp").directive("cnvFeedSearchBar",["AppLinks","$location","FiltersQueryTransformer","FilterTypes","FeedSearchAutoCompleteUtils","Groups","Users","Filters","userImgUrlFilter","UserProfileImage","$q","mixpanelService","advSearchService","feedToggleService","recentSearchService","Feed","$filter","chatService","datetimeService","tagsService","$timeout","hashtagsProvider","$rootScope","$window","userInfo","searchService","ContactsWrapper","utils","config","accountInfo","appsInfo","appLoadSequenceManager","networkSettingService","BlackListWordsService",function(a,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J){return{restrict:"A",scope:!0,link:function(k,m,v){function w(){xa=!0}function y(){xa&&(H(),xa=!1)}function H(){if(!ya){ya=!0;var a=0,b=[],c={},d=!1;0===va.length?(b=va,c=wa):d=!0,i.getSearchableUsers().then(function(e){var g=[],k=[],m=[],n=null,o=null,p=!0,q=!1,r=!1;descLabel=null,imgUrl=null,descLabelIsEmail=!0;for(var s=0;s<e.length;s++){n=e[s],o=i.getUserFullName(n),imgUrl=i.getUserImage(n,l.PROFILE_IMAGE_SIZE_64x64),p=!0,q=!1,r=!1,descLabel=n.email,descLabelIsEmail=!0,"REMOVED"===n.status?q=!0:"INVITED"===n.status&&(r=!0,descLabel="",descLabelIsEmail=!1),n.extra_info&&(descLabel=n.extra_info,descLabelIsEmail=!1,p=!1);var t={type:f.USER,value:n.email,label:o,labelisemail:n.nameIsEmail,id:n.user_id,imgurl:imgUrl,desclabel:descLabel,formatteddesclabel:descLabel,desclabelisemail:descLabelIsEmail,doquerydesc:p,removed:q,invited:r};r?(t.subtype=oa,g.push(t)):q?(t.subtype=pa,k.push(t)):b.push(t)}c[f.USER]={start_index:a,num_items:b.length},a+=b.length,c[oa]={start_index:a,num_items:g.length},a+=g.length,c[pa]={start_index:a,num_items:k.length},a+=k.length,b=b.concat(g,k),d||(va=b),C.getContacts(C.CONTACT_LIST_TYPES.ON_DOMAIN).then(function(e){if(e&&e.length){for(var g=0,i=e.length;i>g;g++)e[g].classes="user contact-as-user "+D.getRandomSmiley()+" as-content ",e[g].value=e[g].email,m.push(e[g]);c[qa]={start_index:a,num_items:m.length},a+=m.length,b=b.concat(m),d||(va=b)}h.getSearchableGroups().then(function(e){e.forEach(function(a){b.push({type:f.GROUP,value:a.get("title"),label:a.get("title"),access:a.get("access"),desclabel:"Group",formatteddesclabel:"Group",classes:"PUBLIC"==a.get("access")?"Icon1_PublicChannel-01-blue":"privateGroup_icon-blue"})}),c[f.GROUP]={start_index:a,num_items:e.length},a+=e.length,b.push({type:f.IS,value:"message",label:"message",classes:"icons2_Chats-blue"},{type:f.IS,value:"link",label:"link",classes:"icons_Links-blue"}),I.getChatStatus()&&b.push({type:f.IS,value:"chat",label:"chat",classes:"icons2_Chats-blue"}),c[f.IS]={start_index:a,num_items:I.getChatStatus()?3:2},a+=I.getChatStatus()?3:2,b.push({type:f.IN,value:f.IN_DRAFTS,label:f.IN_DRAFTS,classes:"icons_Drafts-blue"},{type:f.IN,value:f.IN_TRASH,label:f.IN_TRASH,classes:"icons2_Trash-blue"},{type:f.IN,value:f.IN_STARRED,label:f.IN_STARRED,classes:"icons_Star-blue"}),c[f.IN]={start_index:a,num_items:3},a+=3;var g=j.hasFilter;b.push({type:f.HAS,value:g.ALL_FILES,label:"All files",classes:"icons_File_Plain-blue"},{type:f.HAS,value:g.OFFICE_FILES,label:g.OFFICE_FILES,classes:"fileplainsmall-blue"},{type:f.HAS,value:g.IMAGES,label:g.IMAGES,classes:"imagelarge-blue"},{type:f.HAS,value:g.VIDEOS,label:g.VIDEOS,classes:"videolarge-blue"},{type:f.HAS,value:g.AUDIOS,label:g.AUDIOS,classes:"videolarge-blue"},{type:f.HAS,value:g.WORD_DOCS_VALUE,label:g.WORD_DOCS,classes:"doclarge-blue"},{type:f.HAS,value:g.EXCEL_SHEETS_VALUE,label:g.EXCEL_SHEETS,classes:"Icon2__XLSlarge-blue"},{type:f.HAS,value:g.SLIDE_SHOWS_VALUE,label:g.SLIDE_SHOWS,classes:"pptlarge-blue"},{type:f.HAS,value:g.PDF_VALUE,label:g.PDF,classes:"pdflarge-blue"},{type:f.HAS,value:g.PHOTOSHOP_VALUE,label:g.PHOTOSHOP,classes:"psdlarge-blue"}),c[f.HAS]={start_index:a,num_items:10},a+=10,d&&(va=b,wa=c),ya=!1},function(){d&&(va=b,wa=c),ya=!1,w()})},function(){d&&(va=b,wa=c),ya=!1,w()})},function(){d&&(va=b,wa=c),ya=!1,w()})}}function K(a){var b=a,c=b.split(" ");if(1===c.length)return a;for(var d="",e=0;e<c.length;e++)d+=c.slice(e).join(" ")+"|";return d.slice(0,-1)}function L(){y();var a=[];ta&&ta!=f.WORDS?ta==f.FROM||ta==f.USER||ta==f.DISCUSSIONS||ta==f.COMMENTS?a.push(f.USER,oa,pa):ta==f.TO?a.push(f.USER,f.GROUP,oa,pa):(ta==f.IS||ta==f.IN||ta==f.HAS)&&a.push(ta):a.push(f.USER,f.GROUP,oa,pa,qa,f.IS,f.IN,f.HAS);var b,c=[],d=[],e=0;ua&&(b=new RegExp("(([\\s,<>():.])|^)("+K(O(ua))+")","gi"));for(var g=0;g<a.length;g++){var h=wa[a[g]];if(h&&0!==h.num_items){for(var i,j,k=h.start_index,l=k+h.num_items-1,m=k;l>=m;m++)if(ua){i=null,j=null;var n=va[m].label,o=n.replace(b,"$1b1%b1_1$3b2%b2_2");if(va[m].labelisemail){var p=n.indexOf("@");-1!==p&&o.indexOf("b1%b1_1")>p&&(o=n)}o!==n&&(i=o.slice(o.indexOf("b1%b1_1")+7,o.indexOf("b2%b2_2")),j=n);var q=va[m].desclabel;if(va[m].doquerydesc){if(n=va[m].desclabel,q=n.replace(b,"$1b1%b1_1$3b2%b2_2"),va[m].desclabelisemail){var p=n.indexOf("@");-1!==p&&q.indexOf("b1%b1_1")>p&&(q=n)}i||q===n||(i=q.slice(q.indexOf("b1%b1_1")+7,q.indexOf("b2%b2_2")),j=n)}(o!=va[m].label||q&&q!=va[m].desclabel)&&(va[m].formattedlabel=o,va[m].type==f.USER||va[m].type==f.GROUP?va[m].formatteddesclabel=q:va[m].formatteddesclabel="",va[m].matchStartIndex=ua.indexOf(i.toLowerCase()),va[m].matchStartIndexInSearchedString=j.indexOf(i),d.push(va[m]),e++)}else if(va[m].formattedlabel=va[m].label,c.push(va[m]),e++,e===ma)break;if(!ua&&e===ma)break}}return d.sort(function(a,b){var c=a.label.toLowerCase(),d=b.label.toLowerCase(),e=a.matchStartIndexInSearchedString+a.matchStartIndex,g=b.matchStartIndexInSearchedString+b.matchStartIndex,h=a.type!==f.USER||a.subtype?2:1,i=b.type!==f.USER||b.subtype?2:1;return i>h?-1:h>i?1:(h=1,i=1,a.subtype&&(h=a.subtype===oa?2:3),b.subtype&&(i=b.subtype===oa?2:3),i>h?-1:h>i?1:g>e?-1:e>g?1:d>c?-1:c>d?1:0)}),c.push.apply(c,d),ua&&(c=c.slice(0,ma)),c}function M(c){var g=null,h=null;k.feed_search_text.length>0&&(k.feed_search_text=J.clean(k.feed_search_text));try{g=e.queryToFilters(k.feed_search_text),h=e.filtersToQuery(g,!0,!0)}catch(i){return g=null,h=null,void N("That's an invalid search format. Try using the advanced search options.")}if(N(!1),g&&0!=g.length){var l=b.copy(g);if(c){var m=j.newFilter(f.STAG,"stag=true","stag=true");g.push(m)}if(j.hasAnyPostDisplayOptionFilter(g)){for(var n=0;n<g.length;n++)if(g[n].type===f.POST_DISPLAY_OPTION){var p=r.getPostDisplayOption();g[n].value=p,g[n].description=p,l.slice(n,1)}}else{var p=r.getPostDisplayOption(),s=j.newFilter(f.POST_DISPLAY_OPTION,p,p);g.push(s)}var t=e.filtersToQuery(g),u=a.getFilterUrlForFilterStr(t);if(o.openPanel(),!A.isAdminMode()){var v=q.saveSearch(q.FILTER_CONST,b.toJson(j.newANDFiltersChain(l,"")),h,null,za&&Aa?Aa:null);v.then(function(a,b){W(!0),Aa=a.data.id,za=!0})}u=u.replace(/%3A/g,":"),d.url()==u?k.$emit("refreshFeed",!0,"USER_ACTION: submit feed search text again"):d.url(u)}else d.url("/feed")}function N(a){if(a!==k.searchQueryInvalid){k.searchQueryInvalid=a;var b;b=a?"showTooltip":"hideTooltip",setTimeout(function(){$("#feed_search_input").trigger(b)},0)}}function O(a){return a.replace(new RegExp("([{}()^$&.*?/+|[\\\\]|]|-)","g"),"\\$1")}function P(a){var b=new Date(parseInt(a));return b.setHours(23,0,0),b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()}function Q(c){for(var d=b.fromJson(c.data),e={},g={},k="",l=0;l<d.filters.length;l++){g.hasOwnProperty(d.filters[l].type)||(g[d.filters[l].type]=[]),g[d.filters[l].type].push(d.filters[l]);var m=d.filters[l].value;if("text"!==d.filters[l].type)if("to"===d.filters[l].type&&j.isGroupFilter(d.filters[l]))1!==d.filters.length?k+=d.filters[l].type+": "+h.getGroupName(d.filters[l].value)+" ":(e.formattedlabel=h.getGroupName(d.filters[l].value),e.formatteddesclabel="Group",k+=h.getGroupName(d.filters[l].value)+" ");else if("to"===d.filters[l].type||"from"===d.filters[l].type){var n=i.getUserById(d.filters[l].value);if(n||(n=i.findUser(d.filters[l].value)),"from"===d.filters[l].type&&1===d.filters.length){var o=!1,p=!1,q=!0,r="",s="",t=!1,u=!1;if(n)n.first_name?(r=n.first_name+" "+n.last_name+" ",s=n.email,u=!0):(r=n.email,s="",t=!0),"REMOVED"===n.status?o=!0:"INVITED"===n.status&&(p=!0,q=!1,d.filters[l].value=n.user_id,t=!0,u=!1),q&&n.extra_info&&(s=n.extra_info,q=!1,u=!1);else{e.contact=!0,r=d.filters[l].description,s="",q=!1,t=!0,d.filters[l].value=d.filters[l].description;var v=a.newFilterLink({filters:d.filters},d.filters[l].value);e.filter_link=a.linkToUrl(v),e.imgurl="assets/img/smilies/smiley-05.svg"}e.formattedlabel=r,e.formatteddesclabel=s,e.doquerydesc=q,e.removed=o,e.invited=p,e.labelisemail=t,e.desclabelisemail=u,k+=r}else k+=n?d.filters[l].type+": "+n.first_name+" "+n.last_name+" ":d.filters[l].type+": "+d.filters[l].description}else if(d.filters[l].type===f.TO_DATE)k+="date: "+P(d.filters[l].value)+" ";else if(d.filters[l].type===f.DISCUSSIONS)if("any"===d.filters[l].value)k+="comments: any ";else{var n=i.getUserById(d.filters[l].value);k+="comments: "+n.first_name+" "+n.last_name+" "}else k+=d.filters[l].type==f.HAS?m===j.hasFilter.ALL_FILES_VALUE?"has: "+j.hasFilter.ALL_FILES+" ":m===j.hasFilter.IMAGES_VALUE?"has: "+j.hasFilter.IMAGES+" ":m===j.hasFilter.AUDIOS_VALUE?"has: "+j.hasFilter.AUDIOS+" ":m===j.hasFilter.WORD_DOCS_VALUE?"has: "+j.hasFilter.WORD_DOCS+" ":m===j.hasFilter.EXCEL_SHEETS_VALUE?"has: "+j.hasFilter.EXCEL_SHEETS+" ":m===j.hasFilter.SLIDE_SHOWS_VALUE?"has: "+j.hasFilter.SLIDE_SHOWS+" ":m===j.hasFilter.OFFICE_FILES_VALUE?"has: "+j.hasFilter.OFFICE_FILES+" ":"has: "+m+" ":d.filters[l].type===f.IS?10==m?d.filters[l].type+": chat ":4==m?d.filters[l].type+": link ":d.filters[l].type+": "+d.filters[l].value+" ":d.filters[l].type+": "+d.filters[l].value+" "}if(e.type="recentSearches",e.value=c.text.replace(/\+/g," "),e.json=c.data,e.itemType=c.type,e.text=c.text,g.hasOwnProperty("from")&&1===d.filters.length)e.id=g.from?g.from[0].value:g.to[0].value;else if(g.hasOwnProperty("to")&&g.to.length>0&&j.isGroupFilter(g.to[0])&&1===d.filters.length){var w=h.getGroup(g.to[0].value);w?e.classes="PUBLIC"==w.get("access")?"Icon1_PublicChannel-01-blue":"privateGroup_icon-blue":e.ignore=!0}else e.classes="no-border icons2_Search-lightgray";return g.hasOwnProperty("text")&&g.text.length>0?(e.formattedlabel=g.text[0].value[0].replace(/\+/g," "),e.formatteddesclabel=k):e.formattedlabel=k.replace(/\+/g," "),e}function R(a){k.recent_search_dropdown_items=[];for(var c=0;c<(a.length>10?10:a.length);c++)if(a[c].type===q.SUGGESTION_CONST){var d=ea(b.fromJson(a[c].data));d.text=a[c].text,k.recent_search_dropdown_items.push(d)}else{var e=Q(a[c]);e.ignore||k.recent_search_dropdown_items.push(e)}}function S(){k.showRecentDropdownTooltip=!0,m.find(".onboardingToolTips").show(),$(z.document).on("click",function(a){var b=m.find(a.target).length>0;b||k.$apply(function(){T()})})}function T(){k.showRecentDropdownTooltip=!1,m.find(".onboardingToolTips").hide(),$(z.document).off("click")}function U(){k.state.showTrendingTag=!0,k.state.trendingTagItems.splice(0),$(z.document).on("click",function(a){var b=m.find(a.target).length>0||$(a.target).parents(".trending-tags-section").length;b||k.$apply(function(){V(!0)})})}function V(a){a&&(k.state.showTrendingTag=!1),k.state.trendingTagItems.splice(0),$(z.document).off("click"),k.state.showTrendingFilter=!1}function W(a){h.getGroups().then(function(){q.getSearches().then(function(b,c){var d=b.data;return 0===d.length&&!a&&m.find("#feed_search_input").is(":focus")&&0===k.feed_search_text.length&&S(),0===d.length||k.state.show_feed_search_dropdown&&!a?(k.state.show_recent_search_dropdown=!1,void(k.recent_search_dropdown_items=[])):(R(d),void(a||k.state.show_recent_search_dropdown||!m.find("#feed_search_input").is(":focus")||0!==k.feed_search_text.length||(k.state.show_recent_search_dropdown=!0,k.$$phase||k.$digest())))})})}function X(a){y(),k.state.show_feed_search_dropdown||(k.recent_search_dropdown_items.length>0&&0===k.feed_search_text.length&&(k.state.show_recent_search_dropdown=!0,k.$$phase||k.$digest()),W())}function Y(){var a=k.filterInfo;return a.filterApplied&&a.filterLink.title?a.filterLink.title.indexOf("stag=true")>=0:!1}function Z(){var a=Y(),b=k.filterInfo;if(b.filterApplied&&b.filterLink.filter){if(j.hasAnyPostDisplayOptionFilter(b.filterLink.filter.filters))for(var c=0;c<b.filterLink.filter.filters.length;c++)b.filterLink.filter.filters[c].type===f.POST_DISPLAY_OPTION&&(r.setPostDisplayOption(b.filterLink.filter.filters[c].value),b.filterLink.filter.filters.splice(c,1));j.hasAnyPostFilter(b.filterLink.filter.filters)||a?k.feed_search_text=e.filtersToQuery(b.filterLink.filter.filters.filter(function(a){return a.type==f.TAG}),!0,!0):k.feed_search_text=e.filtersToQuery(b.filterLink.filter.filters,!0,!0).replace(/\+/g," "),o.updateFilters(b.filterLink.filter.filters)}else k.feed_search_text="",o.updateFilters(null);N(!1)}function aa(a,b){var c={};c.chatId=a.chat_message.chat_id,c.data={chatType:a.chat_message.chat_type,from_sequence_number:a.chat_message.from_seq_number,to_sequence_number:a.chat_message.to_seq_number,msg_id:a.chat_message.msg_id,seq_no:a.chat_message.seq_no,version:1},c.chatType=function(){return"groupchat"==a.chat_message.chat_type?2:1}(),c.messageInfo=null,a.chat_message.hasOwnProperty("search_match")&&a.chat_message.search_match?(r.fetchChat(c.chatId,b).then(function(a){t.searchResults(a.data)}),t.openSearchedChat(c.chatId,c.chatType,a.body,c.data,[],!0)):t.openChatFromId(c.chatId,c.chatType,null,[],!0)}function ba(a){var c=b.fromJson(a.json),e=c.resource_link;c.body.length>200&&(c.body=c.body.substring(0,200));var f=c.searchedText||a.text||null;if(delete c.searchedText,!A.isAdminMode()){var g=q.saveSearch(q.SUGGESTION_CONST,b.toJson(c),f,null,null);g.then(function(a,b){W(!0)})}if("25"===c.resource_type){if(c.matching_files&&c.matching_files.file_format){var h=c.matching_files;e=s("getFileResourceLinkUrl")(h.file_id,h.file_format,"6","6",c.chat_message.chat_id,h.file_name,"21"),d.url(e.slice(1))}aa(c,f)}else d.url(e)}function ca(c){var f=c.filter_link;if(!A.isAdminMode()){var g=a.parseUrl(E.APP_DOMAIN+f),h=e.filtersToQuery(g.filter.filters,!0,!0).replace(/\+/g," ");k.feed_search_text=h;var i=q.saveSearch(q.FILTER_CONST,b.toJson(j.newANDFiltersChain(g.filter.filters,"")),h,null,null);i.then(function(a,b){W(!0)})}n.trackEvent(n.FILTER_ON_IMPORTED),d.url(f.substr(1))}function da(a,b){a.secondaryIconClass="secondary-icon cnv-icons-file-with-border"+(1===Ca?" one-x":""),a.fileMatch=!0,Ba?(a.formatteddesclabel=b.file_name,a.seclink="Pro: Search inside file",a.seclinkurl=k.upgradeAppUrl):b.is_content_match?(a.formatteddesclabel=b.search_fragment||b.file_name,a.desclabeltail="(1 of "+b.total_word_occurrences+")"):a.formatteddesclabel=b.file_name}function ea(a){var d={};if("6"===a.resource_type){d.label=_.escape(a.title),d.id=a.user_id,d.type="POST",d.value=_.escape(a.title),d.formatteddesclabel=a.body,d.formattedlabel=a.title;var e=a.post_match,f=a.comment_match,g=a.matching_files!==c,h=a.matching_conversation_files!==c;e?d.secondaryIconClass="secondary-icon cnv-icons-post-with-border"+(1===Ca?" one-x":""):g?da(d,a.matching_files):f?d.secondaryIconClass="secondary-icon cnv-icons-comment-with-border"+(1===Ca?" one-x":""):h&&da(d,a.matching_conversation_files)}else if("4"===a.resource_type){d.label=_.escape(a.title),d.detail=_.escape(a.body),d.id=a.user_id,d.type="LINK",d.formatteddesclabel=a.body,d.formattedlabel=a.title;var e=a.post_match,f=a.comment_match,h=a.matching_conversation_files!==c;e?d.secondaryIconClass="secondary-icon cnv-icons-link-with-border"+(1===Ca?" one-x":""):f?d.secondaryIconClass="secondary-icon cnv-icons-comment-with-border"+(1===Ca?" one-x":""):h&&da(d,a.matching_conversation_files)}else"25"===a.resource_type?(d.id=a.user_id,d.type="CHAT",d.value=_.escape(a.title),d.detail=a.body,d.label=a.title,d.formattedlabel=a.title,d.formatteddesclabel=a.body,d.secondaryIconClass="secondary-icon cnv-icons-chats-with-border"+(1===Ca?" one-x":""),a.matching_files&&da(d,a.matching_files)):d={classes:a.user_id?null:"icons2_Search-blue",label:_.escape(a.title),type:a.user_id?"USER":q.SUGGESTION_CONST,value:_.escape(a.title),formatteddesclabel:"",formattedlabel:a.title};return d.id&&(d.imgurl=i.getUserImage(a,l.PROFILE_IMAGE_SIZE_64x64)),d.itemType=q.SUGGESTION_CONST,d.json=b.toJson(a),d.labelbadge=s("dateAgo")(a.timestamp,u.getServerTimestamp(),!0,!0,!0,!0,"shortDate"),d.dontEscapeDescLabelHtmlXSS=!0,d}function fa(a,b){for(var c=0;c<k.feed_search_dropdown_items.length;c++){var d=k.feed_search_dropdown_items[c];d.hasOwnProperty("itemType")&&d.itemType===q.SUGGESTION_CONST&&(k.feed_search_dropdown_items.splice(c,1),c--)}var e=Math.min(ma-k.feed_search_dropdown_items.length,a.length);if(e>0){for(var c=0;e>c;c++)k.feed_search_dropdown_items.push(ea(a[c]));k.showSearchSuggestionsHeader=Ba&&b,k.$$phase||k.$digest()}}function ga(){var a=null;try{a=e.queryToFilters(k.feed_search_text)}catch(b){if(!a)return}for(var c=0;c<a.length;c++)a[c]&&a[c].hasOwnProperty("value")&&"object"==typeof a[c].value&&(a[c].value=a[c].value[0]);var d=j.getSearchWordsIfHasWordSearchFilter(a),f=r.getFeedSearchSuggestions(0,j.newANDFiltersChain(a,""),na,!0,d);f.then(function(a,b){var c=a.data;if(c.hasOwnProperty("suggestions")&&c.suggestions.length>0){for(var d=0;d<c.suggestions.length;d++)c.suggestions[d].searchedText=c.searchedText;fa(c.suggestions,c.has_matches_in_file_content)}})}function ha(a){for(var b=0;b<k.feed_search_dropdown_items.length;b++){var c=k.feed_search_dropdown_items[b];c.hasOwnProperty("itemType")&&c.itemType===f.TAG&&(k.feed_search_dropdown_items.splice(b,1),b--)}if(0!==a.length){var d=Math.min(ma,a.length);if(d>0){for(var b=0;d>b;b++)k.feed_search_dropdown_items.push({classes:"no-border icon_tag-01-01-darkgray",label:a[b].label,type:f.TAG,value:a[b].label,formatteddesclabel:"",formattedlabel:a[b].formattedlabel,itemType:f.TAG,stag:a[b].stag});if(k.feed_search_dropdown_items.length>ma)for(var e=k.feed_search_dropdown_items.length-ma,b=0;e>b;b++)k.feed_search_dropdown_items.splice(ma,1);k.$$phase||k.$digest()}}}function ia(a){if(a&&a.length){k.state.showTrendingTag=!1;var b=x.getHashtagsDropdownItems("#"+a);b.then(function(a,b){ha(a)})}else{var c=k.state.trendingFilterOption||k.state.trendingFiltersList.week,b=x.getTrendingHashtags("#",10,c);k.state.show_feed_search_dropdown=!1,k.state.show_recent_search_dropdown=!1,k.showSearchSuggestionsHeader=!1,k.state.showTrendingSpinner=!0,b.then(function(a){a.data&&(k.state.showTrendingSpinner=!1,"#"==k.feed_search_text&&(k.state.show_feed_search_dropdown=!1,k.state.show_recent_search_dropdown=!1,U(),a.data.forEach(function(a){k.state.trendingTagItems.push(a)})))})}}function ja(){m.find(".dropdown-ico-wrapper").addClass("rotate-icons")}function ka(){m.find(".dropdown-ico-wrapper").removeClass("rotate-icons")}function la(a){var b=$(a.target);191!==a.keyCode||b.is(":input")||b.hasClass("ql-editor")||(a.preventDefault(),m.find("#feed_search_input").focus())}var ma=10,na=10,oa="INVITED_USER",pa="REMOVED_USER",qa="NETWORK_ON_DOMAIN_CONTACT",ra=_.debounce(ga,1e3),sa=D.debounce_firstImmediate(ia,750),ta="",ua="",va=[],wa={},xa=!0,ya=!1,za=!1,Aa=null,Ba=F.isStarterNetwork(),Ca=z.devicePixelRatio>=2?2:1;k.feed_search_text="",k.state={show_feed_search_dropdown:!1,show_recent_search_dropdown:!1},k.feed_search_dropdown_items=[],k.recent_search_dropdown_items=[],k.searchQueryInvalid=!1,k.state.showTrendingTag=!1,k.state.showTrendingFilter=!1,k.state.trendingTagItems=[],k.state.trendingFiltersList={today:"today",week:"week",month:"month"},k.state.trendingFilterOption="week",k.state.showTrendingSpinner=!1,k.showSearchSuggestionsHeader=!1,Ba&&(k.upgradeAppUrl=G.getPremiumUpgradeAppUrl()),h.on("groupsUpdated",w),C.on("network_contacts_updated",w),k.onFeedRecentSearchDropdownItemSelected=function(c){if(k.state.show_recent_search_dropdown=!1,"recentSearchesNA"!=c.type)if(c.itemType===q.SUGGESTION_CONST)ba(c);else{var f=e.filtersToQuery(b.fromJson(c.json).filters),g=a.getFilterUrlForFilterStr(f);g=g.replace(/%3A/g,":"),d.url()==g?k.$emit("refreshFeed",!0,"USER_ACTION: submit feed search text again"):d.url(g)}},k.onFeedSearchFormSubmit=function(){k.state.show_feed_search_dropdown=!1,k.state.show_recent_search_dropdown=!1,k.showSearchSuggestionsHeader=!1,M()},k.onFeedSearchInputChange=function(){N(!1),T(),V("#"==k.feed_search_text?!1:!0),za&&Aa&&0===k.feed_search_text.length&&(za=!1,Aa=null);var a=$("#feed_search_input").getCursorPosition(),b=k.feed_search_text.slice(0,a).replace(/ *$/g,""),c=g.getType(b),d=b.slice(g.searchForKey(b)).trim().toLowerCase();c!=ta||d!=ua||"#"==k.feed_search_text?(ta=c,ua=d,k.feed_search_text.length>0?(k.feed_search_dropdown_items=L(),ta===f.TAG&&sa(ua),ra(),"#"==k.feed_search_text?k.state.show_feed_search_dropdown=!1:k.state.show_feed_search_dropdown=!0,k.state.show_recent_search_dropdown=!1):(k.feed_search_dropdown_items=[],k.state.show_feed_search_dropdown=!1,k.showSearchSuggestionsHeader=!1)):d===ua&&c===ta&&k.feed_search_text.length>0&&(k.state.show_feed_search_dropdown=!0)},k.onFeedSearchDropdownItemSelected=function(a,b){if(k.state.show_feed_search_dropdown=!1,k.showSearchSuggestionsHeader=!1,V(!0),a.hasOwnProperty("itemType")&&a.itemType===q.SUGGESTION_CONST)return void ba(a);if(a.hasOwnProperty("type")&&"CONTACT"===a.type)return void ca(a);var c,d,e=$("#feed_search_input").getCursorPosition(),h=k.feed_search_text.slice(0,e),i=g.getType(h),j=!1;a.type==f.USER?(c=i==f.TO?f.TO+':"'+a.value+'"':i==f.COMMENTS?f.COMMENTS+':"'+a.value+'"':i==f.DISCUSSIONS?f.DISCUSSIONS+':"'+a.value+'"':f.FROM+':"'+a.value+'"',d="User"):a.type==f.GROUP?(c=f.TO+':"'+a.value+'"',d="Group"):a.type==f.IS?(c=f.IS+':"'+a.value+'"',d=a.value,j=!0):a.type==f.FILENAME?c=f.FILENAME+":"+a.value:a.type==f.IN?(c=f.IN+":"+a.value,d=a.value):a.type==f.HAS?(c=f.HAS+':"'+a.value+'"',d=a.label,j=!0):a.type===f.TAG?(c=a.value,d=a.label):(c="#"+a.name,d=a.name);var l=g.getSearchStart(h)+(a.matchStartIndex?a.matchStartIndex:0);l>=0&&e>0?k.feed_search_text=h.slice(0,l)+" "+c+" "+k.feed_search_text.slice(e):k.feed_search_text=c,b||M(a.stag),d&&(n.trackEvent(n.USER_FILTERED_SEARCH,{Type:d}),j&&n.trackEvent(n.USER_FILTERED_BY_POST_TYPE,{Type:d}))},k.toggleAdvancedSearch=function(){o.togglePanel()},k.applyAdvSearchFilters=function(a){for(var b=e.queryToFilters(k.feed_search_text),c=0;c<b.length;c++)if(b[c].hasOwnProperty("type")&&"text"===b[c].type){a.push(b[c]);break}k.feed_search_text=e.filtersToQuery(a,!0,!0),M()},k.clearRecentSearches=function(a){a&&a.stopPropagation(),q.clearSearches(),k.recent_search_dropdown_items=[],k.state.show_recent_search_dropdown=!1},k.closeRecentSearchTooltip=function(a){a&&(a.stopPropagation(),a.preventDefault()),T(),k.$$phase||k.$digest()},o.on("cnvAdvSearch:applyFilters",k.applyAdvSearchFilters),p.on("cnvFeedToggleSearch:applyFilters",k.applyFeedToggleFilter),o.on("cnvAdvSearch:panelOpen",ja),o.on("cnvAdvSearch:panelClose",ka),B.on("searchService:clearSearch",function(){k.feed_search_text=""}),k.changeTrendingFilterOption=function(a,b){k.state.trendingFilterOption=b,k.state.showTrendingFilter=!1,a.preventDefault(),ua=" ",k.onFeedSearchInputChange()},k.toggleTrendingFilter=function(){k.state.showTrendingFilter=!k.state.showTrendingFilter,k.state.showTrendingFilter?$(z.document).on("click",function(a){var b=!$(a.target).parents(".trending-filter-container").length;b&&(k.state.showTrendingFilter=!1,k.$apply())}):$(z.document).off("click")},k.$on("clearFeedSearchBarText",function(){k.feed_search_text="",o.updateFilters(null)}),k.$watch("feed_search_text",function(){za&&Aa&&0===k.feed_search_text.length&&(za=!1,Aa=null)}),k.$on("filterChange",Z),m.find("#feed_search_input").on("focus",X),$(z.document.body).on("keydown",la),Z(),W(!0),k.$on("$destroy",function(){$(z.document).off("click"),m.find("#feed_search_input").off("focus",X),o.off("cnvAdvSearch:applyFilters",k.applyAdvSearchFilters),
p.off("cnvFeedToggleSearch:applyFilters",k.applyFeedToggleFilter),B.off("searchService:clearSearch")})},controller:["$scope","userInfo",function(a,b){a.$on("cnvPremiumUpgradeBtn:addClassToSearchBar",function(b,c){"upgrade"===c["class"]?a.addUpgradeClass=!0:a.addEnterpriseClass=!0}),b.on("userInfo.adminModeChanged",function(b){b?a.addAdminModeClass=!0:a.addAdminModeClass=!1}),a.$on("$destroy",function(){b.off("userInfo.adminModeChanged")})}]}}]),b.module("convoApp").directive("cnvFeedToggleSearch",["feedToggleService","Users","User","Filters","$window","Feed","$timeout","utils","$compile","$templateCache","appLoadSequenceManager","networkSettingService",function(c,d,e,f,g,h,i,j,k,l,m,n){return{restrict:"E",replace:!0,scope:!0,link:function(d,e,f){function h(){f.hasOwnProperty("type")&&"feed"===f.type&&q.addClass("feed-view"),d.$broadcast("render")}function i(a){if(d.filters={order_type:[]},a)for(var b=0;b<a.length;b++)d.filters.hasOwnProperty(a[b].type)?d.filters[a[b].type].push(a[b]):(d.filters[a[b].type]=[],d.filters[a[b].type].push(a[b]));d.$broadcast("render")}function n(a){a&&0===$(a.target).closest(".filter-dropdown").length&&(d.activeFilterDropdown=null,b.element(g).off("click",n),d.$broadcast("render"))}function o(){var a="search/cnvFeedToggleBar/cnvFeedToggleSearch.tpl.html",b=k(l.get(a))(d);e.empty().replaceWith(b),q=b,h()}var p={order_type:[]},q=null;j.whichBrowser();d.filters=_.clone(p),d.appliedPostFilter="latestActivity",d.toggleBar=c.togglePanel,d.openFilterDropdown=function(c,e){c&&$(c.target).closest(".filter-dropdown").length>0||(d.activeFilterDropdown===e?(d.activeFilterDropdown=null,b.element(g).off("click",n)):(d.activeFilterDropdown=e,c&&c.stopPropagation(),d.opened=!1,b.element(g).on("click",n)),a.setTimeout(function(){q.find(".add-more-placeholder").trigger("click")},0),d.$broadcast("render"))},d.closeFilterDropdown=function(a){a&&a.stopPropagation(),d.activeFilterDropdown=null,b.element(g).off("click",n),d.$broadcast("render")},c.on("cnvFeedToggleSearch:updateFilters",i),d.$on("$destroy",function(){b.element(g).off("click",n),c.off("cnvFeedToggleSearch:updateFilters",i),q=null}),m.okToLoad(m.comps.FEED_TOGGLE)?o():m.on("okToLoad"+m.comps.FEED_TOGGLE,function(){o()})},controller:["$scope","Users","usersGroupsListProvider","User","$q","feedToggleService","Filters","FilterTypes","Groups","atMentionsListProvider","$rootScope",function(a,b,c,d,e,f,g,i,j,k,l){function n(){var a=l.filterInfo;if(a.filterApplied)for(var b,c,d=a.filterLink.filter.filters,e=a.filterLink.title,g=0;g<d.length;g++){var h=d[g];if("text"==h.type){c=!0;break}("from"==h.type||"Mentions"==e)&&(b=!0)}else a.filterLink||(p=!1,q=!1,f.closePanelWithoutAnim())}function o(){}var p=!1,q=!1;a.applyFilters=function(b){b&&b.stopPropagation();var c=[];a.filters.order_type.length>0&&(c.push(a.filters.order_type[0]),h.setPostDisplayOption(a.filters.order_type[0])),f.applyFilters(c)},a.applyPostFilter=function(b,c,d){if(b&&b.stopPropagation(),"latestActivity"===c||"latestPost"===c){var e=g.newFilter("order_type",c,d);a.filters.order_type.length>0&&a.filters.order_type[0].value==c?(a.filters.order_type=[],h.setPostDisplayOption(a.filters.order_type[0])):(a.filters.order_type[0]=e,h.setPostDisplayOption(a.filters.order_type[0]))}a.closeFilterDropdown(),a.applyFilters(),a.$broadcast("render")},a.getPostFilterTitle=function(){var b="Sort: ";if(a.filters.order_type.length>0)b+="latestActivity"===h.getPostDisplayOption()?"Latest activity":"Latest post";else{var c=g.newFilter("order_type","latestActivity","Latest activity");a.filters.order_type[0]=c,b+=a.filters.order_type[0].description+" "}return b},a.showPostDisplayOptionText=function(){return"latestActivity"===h.getPostDisplayOption()?!0:!1},a.$on("filterChange",n),m.okToLoad(m.comps.FEED_TOGGLE)?o():m.on("okToLoad"+m.comps.FEED_TOGGLE,function(){o()})}]}}]),b.module("convoApp").factory("feedToggleService",[function(){function a(){h?b():d()}function b(a){h&&(h=!1,g.trigger("cnvFeedToggleSearch:panelClose",a))}function c(){b(!0)}function d(){h||(h=!0,g.trigger("cnvFeedToggleSearch:panelOpen"))}function e(a){i=a,g.trigger("cnvFeedToggleSearch:updateFilters",i)}function f(a){i=a,g.trigger("cnvFeedToggleSearch:applyFilters",i)}var g={panelOpen:!1,includeChats:!0,includeDrafts:!1},h=!1,i=null;return _.extend(g,Backbone.Events),g.togglePanel=a,g.updateFilters=e,g.applyFilters=f,g.openPanel=d,g.closePanel=b,g.closePanelWithoutAnim=c,g}]),b.module("convoApp").factory("FiltersQueryTransformer",["FilterTypes","QueryParser","userInfo","Groups","Users","Filters","networkSettingService",function(a,b,c,d,e,f,g){function h(b){return b==a.ANY_VALUE?(filter={},filter.type=a.DISCUSSIONS,filter.value=a.ANY_VALUE,filter.description=a.ANY_VALUE,filter):b==a.NONE_VALUE?(filter={},filter.type=a.DISCUSSIONS,filter.value=a.NONE_VALUE,filter.description=a.NONE_VALUE,filter):"me"==b?(filter={},filter.type=a.DISCUSSIONS,filter.value=c.user_id,filter.description=c.email,filter):(user=e.findUser_onUserIdFirst(b),user||-1==b.indexOf("(")||(b=b.slice(b.indexOf("(")+1,b.indexOf(")")),user=e.findUser(b)),user?(filter={},filter.type=a.DISCUSSIONS,filter.value=user.user_id,filter.description=user.email,filter):void 0)}function i(b){var g=[];if(!b)return g;var i=null,j=null,k=null,l="",m=b[a.POST_DISPLAY_OPTION];null!=m&&m.length>0&&(l=m[0],i={},i.type=a.POST_DISPLAY_OPTION,i.value=l,i.description=l,g.push(i));var m=b[a.TO];if(null!=m&&m.length>0){l=m[0];var n=!1;if("me"==l)n=!0;else if("all"==l)return[];n||(k=d.findGroupHavingName(l),k||(k=d.getGroup(l)),k&&(i={},i.type=a.TO,i.value=k.get("id"),i.description=k.get("title"),g.push(i))),(n||!k)&&(n?(i={},i.type=a.TO,i.value=c.user_id,i.description=c.email,g.push(i)):(j=e.findUser_onUserIdFirst(l),j||-1==l.indexOf("(")||(l=l.slice(l.indexOf("(")+1,l.indexOf(")")),j=e.findUser(l)),j?(i={},i.type=a.TO,i.value=j.user_id,i.description=j.email,g.push(i)):(i={},i.type=a.TO,i.value=l,i.description=l,g.push(i))))}if(m=b[a.FROM],null!=m&&m.length>0){if(l=m[0],l=$.trim(l),"everyone"==l||"all"==l)return[];"me"==l?(i={},i.type=a.FROM,i.value=c.user_id,i.description=c.email,g.push(i)):(j=e.findUser_onUserIdFirst(l),j||-1==l.indexOf("(")||(l=l.slice(l.indexOf("(")+1,l.indexOf(")")),j=e.findUser(l)),j?(i={},i.type=a.FROM,i.value=j.user_id,i.description=j.email,g.push(i)):(i={},i.type=a.FROM,i.value=l,i.description=l,g.push(i)))}if(m=b[a.DISCUSSIONS],null!=m&&m.length>0&&(l=m[0],l=$.trim(l),g.push(h(l))),m=b[a.COMMENTS],null!=m&&m.length>0&&(l=m[0],l=$.trim(l),g.push(h(l))),m=b[a.IN],null!=m&&m.length>0){if(l=m[0],l=$.trim(l),"everything"==l||"all"==l)return[];l==a.IN_DRAFTS?(i={},i.type=a.IN,i.value=a.IN_DRAFTS,i.description=a.IN_DRAFTS,g.push(i)):l==a.IN_TRASH?(i={},i.type=a.IN,i.value=a.IN_TRASH,i.description=a.IN_TRASH,g.push(i)):l==a.IN_STARRED&&(i={},i.type=a.IN,i.description=a.IN_STARRED,i.value=a.IN_STARRED,g.push(i))}if(m=b[a.IS],null!=m&&m.length>0){if(l=m[0],l=$.trim(l.toLowerCase()),"everything"==l||"all"==l)return[];if(l==a.IS_SYSTEM_MESSAGE)i={},i.type=a.DATA_TYPE,i.value=a.IS_SYSTEM_MESSAGE,i.description=a.IS_SYSTEM_MESSAGE,g.push(i);else{"note"==l&&(l="message");var o=null;"message"==l?o={type_id:6,short_name:"message"}:"link"==l?o={type_id:4,short_name:"link"}:"chat"==l&&(o={type_id:10,short_name:"chat"}),o&&(i={},i.type=a.DATA_TYPE,i.value=o.type_id+"",i.description=o.short_name,g.push(i))}}if(m=b[a.HAS],null!=m&&m.length>0&&(l=m[0],i=f.newHasFilter(l),g.push(i)),m=b[a.FILENAME],null!=m&&m.length>0&&(l=$.trim(m[0].toLowerCase()),l.length>0&&(i={},i.type=a.FILENAME,i.value=l,i.description=l,g.push(i))),m=b[a.LIKE],null!=m&&m.length>0&&(l=$.trim(m[0]),l==a.ANY_VALUE&&(i={},i.type=a.LIKE,i.value=a.ANY_VALUE,i.description=a.ANY_VALUE,g.push(i))),m=b[a.TAG],null!=m&&m.length>0&&g.push(f.newFilter(a.TAG,m,m.join("+"))),m=b[a.TAGS],null!=m&&m.length>0&&g.push(f.newFilter(a.TAG,m,m.join("+"))),m=b[a.POST],null!=m&&m.length>0){l=m[0];var p=l.replace(/__c__/g,":").replace(/__q__/g,'"').replace(/__m__/g,",");g.push(f.newFilter(a.POST,p,p))}if(m=b[a.FROM_DATE],null!=m&&m.length>0&&(l=$.trim(m[0]),g.push(f.newFilter(a.FROM_DATE,l,l))),m=b[a.TO_DATE],null!=m&&m.length>0&&(l=$.trim(m[0]),g.push(f.newFilter(a.TO_DATE,l,l))),m=b[a.DATE],null!=m&&m.length>0){l=$.trim(m[0]);var q=new Date(Date.parse(l));q.setHours(23,59,59),g.push(f.newFilter(a.TO_DATE,q.getTime(),q.getTime()))}return m=b.words,null!=m&&m.length>0&&g.push(f.newFilter(a.TEXT,m,m.join("+"))),g}function j(a){var b=new Date(parseInt(a));if(isNaN(b))throw{message:"Error parsing date, please use the correct format i.e. mm/dd/yyyy",errorCode:500};return b.setHours(23,59,59),b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()}function k(b,c,d){for(var e="",f=0;f<b.length;f++){var h=b[f];if(!h)throw{message:"That's an invalid search format. Try using the advanced search options.",errorCode:500};var i="";switch(h.type){case a.TAG:i=("#"!=h.description.charAt(0)?"#":"")+h.description.replace(/(["\\])/gm,"\\$1");break;case a.STAG:i=h.description;break;case a.TO:case a.HAS:case a.LIKE:i=h.type+':"'+h.description.replace(/(["\\])/gm,"\\$1")+'"';break;case a.FROM:i=h.type+':"'+h.description.replace(/(["\\])/gm,"\\$1")+'"';break;case a.DATA_TYPE:case a.IN:case a.FILENAME:case a.FROM_DATE:if("chat"==h.description&&!g.getChatStatus())break;i=h.type+":"+h.description;break;case a.TO_DATE:i=c?"date:"+j(h.description):h.type+":"+h.description;break;case a.TEXT:i=h.description;break;case a.POST:var k=h.value,l=k.replace(/:/g,"__c__").replace(/"/g,"__q__").replace(/,/g,"__m__");i=h.type+":"+l;break;case a.POST_DISPLAY_OPTION:i=h.type+':"'+h.value.replace(/(["\\])/gm,"\\$1")+'"';break;case a.DISCUSSIONS:if(d){i=a.COMMENTS+':"'+h.description.replace(/(["\\])/gm,"\\$1")+'"';break}i=h.type+':"'+h.description.replace(/(["\\])/gm,"\\$1")+'"'}i&&(e+=" "+i)}return e&&(e=e.slice(1)),e}var l={};return l.queryToFilters=function(c){return i(b.parse(c,a.ALL_TYPES))},l.filtersToQuery=function(a,b,c){return k(a,b,c)},l}]),b.module("convoApp").factory("QueryParser",[function(){function a(a,e){for(var o=null,p=null,q=[],r=0,s=null,t=[];null!=(o=b(a,r));)q.push(o),r=o.endIndex+1,null==s?j(o)?f(a,o,A.INVALID_FV_SEP_POSITION):i(o)?f(a,o,A.INVALID_OPERATOR_POSITION):g(o)&&"#"===o.value?(s={type:x},s.field="tag"):(s={type:w},s.value=d(o,!0)):k(s)||n(s)?j(o)?k(s)?(s.type=x,s.field=s.value,s.value=null,e.indexOf(s.field)<0&&f(a,p,A.INVALID_FIELD)):f(a,o,A.INVALID_FV_SEP_POSITION):i(o)?(s.type=y,s.value+=d(o,!0)):g(o)?(t.push(s),"#"===o.value?(s={type:x},s.field="tag"):(s={type:w},s.value=d(o,!0))):(s.value+="+"+d(o,!0),s.type=z):l(s)?h(o)?(s.value=d(o,!1),t.push(s),s=null):f(a,o,A.SYNTAX_ERROR,"Value expected for a 'field:value' combination."):m(s)&&(h(o)?(s.value+=d(o,!0),s.type=z):f(a,o,A.SYNTAX_ERROR,"Value expected here for operator.")),p=o;return null!=s&&(k(s)||n(s)?t.push(s):m(s)?f(a,p,A.SYNTAX_ERROR,"Value not specified for operator."):l(s)?f(a,p,A.SYNTAX_ERROR,"Value not specified for field."):f(a,p,A.SYNTAX_ERROR)),c(t,e)}function b(a,b){var c=a.length,d="",f="",g="",h="",i={type:s},j=!1,k=!1,l=b,m=!1;for(i.startIndex=b;c>l&&!m;)d=a.charAt(l),k?(h+=d,k=!1):p.indexOf(d)>=0?k=!0:o.indexOf(d)>=0&&(!j||d==g)?j?(e(i,h),i.endIndex=l,i.isQuoted=!0,m=!0):(j=!0,g="'"==d?"'":"["==d?"]":'"'):j?h+=d:(" "!=d||d!=f&&0!=h.length)&&(j||((d==q||" "==d||"#"===d||r.indexOf(d)>=0)&&h.length>0?(e(i,h),i.endIndex=l-1,d==q&&(i.type=t),m=!0):d==q||"#"===d||r.indexOf(d)>=0?(h+=d,e(i,h),i.endIndex=l,"#"===d&&(i.type=t),m=!0):h+=d)),m||(l++,f=d);return l==c&&h.length>0&&(e(i,h),i.endIndex=l-1),i.value&&i.value.length>0?i:null}function c(a,b){if(null==b)return null;var c={},d=0;for(d=0;d<b.length;d++)c[b[d]]=[];if(c.words=[],null!=a&&a.length>0){var e=null;for(d=0;d<a.length;d++)e=a[d],l(e)?c[e.field].push(e.value):c.words.push(e.value)}return c}function d(a,b){var c=$.trim(a.value);return i(a)?"or"==a.value?c=",":"and"==a.value&&(c="+"):a.isQuoted&&b&&(c='"'+c+'"'),c}function e(a,b){a.value=b,r.indexOf(b)>=0?a.type=u:b==q&&(a.type=v)}function f(a,b,c,d){var e={message:d,errorCode:c};if(e.index=b.startIndex+1,!d)switch(c){case A.INVALID_FIELD:e.message="Invalid field name '"+b.value+"'";break;case A.INVALID_FV_SEP_POSITION:e.message="Field value separator ':' is not allowed here.";break;case A.INVALID_OPERATOR_POSITION:e.message="Operator '"+b.value+"' is not allowed here.";break;case A.SYNTAX_ERROR:e.message="Syntax error.";break;case A.UNKNOWN:e.message="Problem occured while parsing query."}throw e}function g(a){return a.type==t}function h(a){return a.type==s}function i(a){return a.type==u}function j(a){return a.type==v}function k(a){return a.type==w}function l(a){return a.type==x}function m(a){return a.type==y}function n(a){return a.type==z}var o="\"'[",p="\\",q=":",r=["+",",","OR","AND"],s=0,t=1,u=2,v=3,w=1,x=2,y=3,z=4,A={UNKNOWN:-1,INVALID_FIELD:1,INVALID_FV_SEP_POSITION:2,INVALID_OPERATOR_POSITION:3,SYNTAX_ERROR:100},B={};return B.parse=function(b,c){return a(b,c)},B}]),b.module("convoApp").factory("recentSearchService",["ServerComm","$q",function(a,b){function c(c,d,e,f,g){var h={method:"add",data:{type:c,data:d,text:e,hash:f,remove:g}},i=a.postx("recentsearches",h),j=b.defer();return i.then(function(a,b){j.resolve(a.data)},function(a,b){j.reject(a.data)}),j.promise}function d(){var c=a.getx("recentsearches"),d=b.defer();return c.then(function(a,b){d.resolve(a.data)},function(a,b){d.reject(a.data)}),d.promise}function e(c){var d={method:"clear",data:c?{id:c}:null},e=a.postx("recentsearches",d),f=b.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}var f={};return f.SUGGESTION_CONST="SUGGESTION",f.FILTER_CONST="FILTERS_LIST",f.saveSearch=c,f.getSearches=d,f.clearSearches=e,f}]),b.module("convoApp").factory("HtmlTextSearcher",function(){function a(){function a(){return k.length||(k=$(d)),k}function b(a){g.length&&(i+="next"===a?1:-1,0>i?i=g.length-1:i===g.length&&(i=0),j.events.trigger("searchComplete",{numMatches:g.length,currentMatchIndex:i}),c())}function c(){if(g.length){h.removeClass(l);var a=g[i],b=a.$elements,c=$(b[0]);b.addClass(l);var d=c.offset().top,j=f,k=e.scrollTop(),m=e.height();j>d?e.scrollTop(k-(j-d)-50):d+50>j+m&&e.scrollTop(k+(d-(j+m))+50)}}var d,e,f,g,h,i,j=this,k=[],l="text-search-match-current";this.initialize=function(a,b){d=a,e=b,f=e.offset().top},this.events={},_.extend(this.events,Backbone.Events),this.searchTextChange=function(b){a().unmark().mark(b,{separateWordSearch:!1,element:"span",className:"text-search-match",acrossElements:!0,done:function(){g=[];var b=a().find(".text-search-match");h=b;for(var d,e=0;e<b.length;e++){var k=$(b[e]);k.attr("data-match-id")!==d?(g.push({$elements:k}),d=k.attr("data-match-id")):g[g.length-1].$elements=g[g.length-1].$elements.add(k)}i=-1;for(var e=0;e<g.length;e++){var l=$(g[e].$elements[0]),m=l.offset().top;if(m>f){i=e;break}}-1===i&&(i=0),j.events.trigger("searchComplete",{numMatches:g.length,currentMatchIndex:i}),c()}})},this.searchNext=function(){b("next")},this.searchPrev=function(){b("prev")},this.clearSearch=function(){a().unmark()}}return a}),b.module("convoApp").directive("cnvTextSearchControl",["$location","appsInfo",function(a,b){return{restrict:"AE",scope:!0,templateUrl:"search/textSearch/cnvTextSearchControl/cnvTextSearchControl.tpl.html",link:function(c,d,e){function f(){d.show(),n||p.focus()}function g(){d.hide(),m.clearSearch(),c.numMatches=-1,c.currentMatchIndex=-1}function h(){c.numMatches=-1,c.currentMatchIndex=-1,c.currentMatchDisplayText="",p&&p.val("")}function i(a,b){n||b.preventDefault(),f()}function j(){m.searchNext()}function k(){m.searchPrev()}function l(){c.$$phase||c.$digest()}var m=c[e.searcher],n=!1;e.mode&&"proOnly"===c[e.mode]&&(n=!0);var o;c.numMatches=-1,c.currentMatchIndex=-1;var p,q,r,s,t,u=$("div[data-search='close']");if(n){c.disabled=!0,d.append("<div style='position:relative; top:18px; width:305px'><div class='onboardingToolTips bottom'><div class='blue-content'><i id='tooltip-close-btn' class='cnv-icons-10 icons2_Close-lightgray'></i>Pro: Search inside files.<br><br>Find what you're looking for within a file, in the file viewer, or through the search box.<div class='paddingTop20 center'><a id='tooltip-upgrade-now-btn' class='btn btn-primary width190'>Upgrade Now</a></div></div></div></div>");var q=$("#tooltip-close-btn",d),r=$("#tooltip-upgrade-now-btn",d)}else var p=$("input[type='search']"),s=$("div[data-search='prev']"),t=$("div[data-search='next']");g(),c.$on("keyboardShortcut.cmdOrCtrlF",i),n?(q.on("click",g),r.on("click",function(){g(),a.url(b.getPremiumUpgradeAppUrl().slice(1))})):(p.on("input",function(){o=this.value,m.searchTextChange(o)}),p.on("keydown",function(a){27===a.which?g():13===a.which&&j()}),t.on("click",function(){j()}),s.on("click",function(){k()}),m.events.on("searchComplete",function(a){c.numMatches=a.numMatches,c.currentMatchIndex=a.currentMatchIndex,c.numMatches>=0&&o?c.currentMatchIndex>-1?c.currentMatchDisplayText=(0===c.numMatches?"0":c.currentMatchIndex+1)+" of "+c.numMatches:c.currentMatchDisplayText=c.numMatches+"":c.currentMatchDisplayText="",l()})),m.events.on("open",f),m.events.on("close",g),m.events.on("clear",h),u.on("click",function(){g()}),c.$on("$destroy",function(){n?(q.off("click"),r.off("click")):(p.off("input keydown"),t.off("click"),s.off("click"),m.events.off("searchComplete")),m.events.off("open"),m.events.off("close"),m.events.off("clear"),u.off("click")})},controller:[function(){}]}}]),b.module("convoApp").factory("adminGroupSettingService",["ServerComm","$q",function(a,b){function c(c,d){var e={method:"updateNetworkGroupCreators",data:{specific_members_create_group:c,group_creator_members:d}},f=a.put("admin/accounts/groups",e),g=b.defer();return f.then(function(a,b){g.resolve(a.data)},function(a,b){g.reject(a.data)}),g.promise}function d(){var c={method:"readNetworkGroupCreators"},d=a.get("admin/accounts/groups",{params:c}),e=b.defer();return d.then(function(a,b){e.resolve(a.data)},function(a,b){e.reject(a.data)}),e.promise}var e={};return e.manageGroupSettings=c,e.getGroupSettings=d,e}]),b.module("convoApp").factory("adminService",["ServerComm","$q","accountInfo","userInfo","loginResponseData","Groups","Users","appTabs","Comments",function(a,b,c,d,e,f,g,h,i){function j(){var c=a.getx("admin/info"),d=b.defer();return c.then(function(a,b){d.resolve(a.data)},function(a,b){d.reject(a.data)}),d.promise}function k(){var c=a.getx("admin/users/general"),d=b.defer();return c.then(function(a,b){d.resolve(a.data)},function(a,b){d.reject(a.data)}),d.promise}function l(c,d){var e={purpose:c,filter:d},f=a.get("admin/users",{params:e}),g=b.defer();return f.then(function(a,b){g.resolve(a.data)},function(a,b){g.reject(a.data)}),g.promise}function m(c){var d={method:c?"switchToAdminMode":"exitAdminMode"},e=a.postx("admin/monitor-content/general",d),f=b.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}function n(f){var g={authToken:e.getXmppSessionToken(),userID:d.getUserId(),accountID:c.getAccountId(),method:f?"switchToAdminMode":"exitAdminMode"},h=a.postx("feed/admin/monitor-content/general",g),i=b.defer();return h.then(function(a,b){i.resolve(a)},function(a,b){i.reject(a)}),i.promise}function o(c){var d={method:"grantAdminPrivileges",data:{user_id:c}},e=a.postx("admin/info",d),f=b.defer();return e.then(function(a){f.resolve(a)},function(a){f.reject(a)}),f.promise}function p(c){var d={method:"revokeAdminPrivileges",data:{user_id:c}},e=a.postx("admin/info",d),f=b.defer();return e.then(function(a){f.resolve(a)},function(a){f.reject(a)}),f.promise}function q(c,d){var e={method:"transferAccountOwnership",data:{user_id:c,password:d}},f=a.post("admin/users/privileges",e),g=b.defer();return f.then(function(a,b){g.resolve(a.data)},function(a,b){g.reject(a.data)}),g.promise}function r(c){var d={method:"setAutoFollowTeammatesWhenTheyJoinNetworks",data:{value:c}},e=a.post("admin/users/general",d),f=b.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}function s(c){var d={method:"setAccountUsersCap",data:{value:c}},e=a.post("admin/users/general",d),f=b.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}function t(){var c=a.getx("admin/security/ip"),d=b.defer();return c.then(function(a,b){d.resolve(a.data)},function(a,b){d.reject(a.data)}),d.promise}function u(c,d){var e={method:"addIPRange",data:{from:c,to:d}},f=a.postx("admin/security/ip",e),g=b.defer();return f.then(function(a,b){g.resolve(a.data)},function(a,b){g.reject(a.data)}),g.promise}function v(c,d){var e={method:"removeIPRange",data:{from:c,to:d}},f=a.postx("admin/security/ip",e),g=b.defer();return f.then(function(a,b){g.resolve(a.data)},function(a,b){g.reject(a.data)}),g.promise}function w(c){var d={method:"blockEmailOrDomain",data:{value:c}},e=a.postx("admin/users/disable",d),f=b.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}function x(c){var d={method:"unblockEmailOrDomain",data:{value:c}},e=a.postx("admin/users/disable",d),f=b.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}function y(){var c=a.getx("admin/users/disable"),d=b.defer();return c.then(function(a,b){d.resolve(a.data)},function(a,b){d.reject(a.data)}),d.promise}function z(a){var c=b.defer();return b.all([m(!0),n(!0)])["finally"](function(e){b.all([f.getGroupsFromServer(),g.getUsersFromServer()])["finally"](function(b,e){d.setAdminMode(!0),a?J.trigger("refetchFeedOnAdminModeSwitched"):h.dispatchTabsEvent2("switchAdminMode",{isAdminModeOn:!0}),c.resolve()})}),c.promise}function A(a){var c=b.defer();return b.all([m(!1),n(!1)])["finally"](function(){b.all([f.getGroupsFromServer(),g.getUsersFromServer()])["finally"](function(){d.setAdminMode(!1),i.clearCommentsStore(),a?J.trigger("refetchFeedOnAdminModeSwitched"):h.dispatchTabsEvent2("switchAdminMode",{isAdminModeOn:!1}),c.resolve()})}),c.promise}function B(){var c=a.getx("admin/monitor-content/general?method=getPinnedItemsList"),d=b.defer();return c.then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise}function C(c,d){var e={method:d?"updatePinnedItem":"pin",data:{resource_name:c.resource_name,url:c.url,type:c.type}};"SCRYBE"===c.type&&(e.data.app_instance_id=c.app_instance_id,e.data.resource_type=c.resource_type,e.data.resource_id=c.resource_id),d&&(e.data.id=d);var f=a.postx("admin/monitor-content/general",e),g=b.defer();return f.then(function(a){g.resolve(a.data)},function(a){g.reject(a)}),g.promise}function D(c){var d={method:"unpin",data:{id:c}},e=a.postx("admin/monitor-content/general",d),f=b.defer();return e.then(function(a){f.resolve(a.data)},function(a){f.reject(a)}),f.promise}function E(c){var d={method:"setPasswordPolicy",data:c},e=a.postx("admin/security/password-policy",d),f=b.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}function F(){var c=a.getx("admin/security/password-policy"),d=b.defer();return c.then(function(a,b){d.resolve(a.data)},function(a,b){d.reject(a.data)}),d.promise}function G(c){var d={method:"resetPasswordOfUser",data:{user_id:c.userId,password:c.password,send_email:c.sendEmail,force_password_reset:c.forcePasswordReset}},e=a.postx("admin/security/password-policy",d),f=b.defer();return e.then(function(a){f.resolve(a.data)},function(a){f.reject(a.data)}),f.promise}function H(c){var d={method:"forcePasswordResetForAccountUsers",data:{excluded_users:c.excludedUsers}},e=a.postx("admin/security/password-policy",d),f=b.defer();return e.then(function(a){f.resolve(a.data)},function(a){f.reject(a.data)}),f.promise}function I(a){h.isThisTabLastActiveTab()||(a.isAdminModeOn?z(!0):A(!0))}var J={};return _.extend(J,Backbone.Events),h.addTabsEventListener2("switchAdminMode",I),J.getInfo=j,J.getUsers=l,J.transferOwnership=q,J.autoFollowTeammates=r,J.changeNetworkCap=s,J.getGeneralUsersInfo=k,J.getIPRanges=t,J.addIPRange=u,J.removeIPRange=v,J.blockEmailOrDomain=w,J.unblockEmailOrDomain=x,J.getBlockedEmailsOrDomains=y,J.switchToAdminMode=z,J.exitAdminMode=A,J.makeAdmin=o,J.removeAdmin=p,J.getFeedPinItems=B,J.pinContentToFeed=C,J.unpinItemFromFeed=D,J.savePasswordPolicy=E,J.getPasswordPolicy=F,J.resetUserPassword=G,J.forcePasswordResetForAllUsersExcluding=H,J}]),b.module("convoApp").factory("appLoadSequenceManager",[function(){function a(a,b){a===h.FEED_RENDER_START?l[h.FEED_RENDER_START]||(l[h.FEED_RENDER_START]=!0,g.trigger("loaded"+h.FEED_RENDER_START),n=setInterval(function(){if(i.length)for(;i.length;)c(i.shift());else j.length?c(j.shift()):k.length?c(k.shift()):(clearInterval(n),n=null)},100)):m[a]||(b?c(a):setTimeout(function(){c(a)},200))}function b(){c(h.CHAT_APP),c(h.ADVANCE_SEARCH_VIEW),c(h.FEED_TOGGLE)}function c(a){m[a]||(m[a]=!0,g.trigger("okToLoad"+a))}function d(a){return m[a]}function e(a){return l[a]}function f(a){"feed"!==a&&c(h.HEADER_PANEL)}var g={};_.extend(g,Backbone.Events);var h={FEED_RENDER_START:0,LEFT_PANEL:1,RIGHT_PANEL:2,CHAT_APP:3,HEADER_PANEL:4,ADVANCE_SEARCH_VIEW:5,FEED_TOGGLE:6},i=[];i.push(h.HEADER_PANEL),i.push(h.LEFT_PANEL),i.push(h.RIGHT_PANEL);var j=[],k=[];k.push(h.CHAT_APP),k.push(h.ADVANCE_SEARCH_VIEW),k.push(h.FEED_TOGGLE);var l={},m={},n=null;return g.init=f,g.comps=h,g.okToLoad=d,g.recordLoad=a,g.isLoaded=e,g.loadCompsUnrelatedToFeed=b,g}]),b.module("convoApp").factory("appStateInfo",["config","nativeCommBridgeCDPreventer",function(b,c){function d(){P=ifvisible.now(),Q=P,e(),b.IS_NATIVE&&(T=c.isNativeSystemActive(),-1===T||T||k())}function e(){la||(document.addEventListener("mousemove",f,!1),document.addEventListener("keyup",g,!1),a.addEventListener("scroll",h,!1),la=!0),ia||(ia=setInterval(i,Y))}function f(a){(ja!==a.clientX||ka!==a.clientY)&&(ja=a.clientX,ka=a.clientY,j())}function g(){j()}function h(){j()}function i(){ma+=Y,ma>=U&&(Z||(Z=!0,$=!0,O.trigger("appShortIdle")),ma>=V&&O.trigger("appNoteEditLockIdle"),b.IS_NATIVE&&-1!==T||ma>=W&&!aa&&(e(),k()))}function j(){ma=0,P&&(aa||Z)&&(aa=!1,Z=!1,$=!1,O.trigger("appActive"))}function k(){aa=!0,O.trigger("appLongIdle"),e()}function l(){j()}function m(){return P}function n(){return Q}function o(){return Z}function p(){return $}function q(){return aa}function r(){return R||a.innerWidth<=X}function s(a){ba=a}function t(){return ba}function u(){ca=!0}function v(){return ca}function w(){da=!0}function x(){return da}function y(){ea=!0}function z(){return ea}function A(){fa=!0}function B(){return fa}function C(){ga=!0}function D(){return ga}function E(){ha=!0}function F(){return ha}function G(){return ba||da||ga}function H(b){return a.innerWidth<=b}function I(a){S=a}function J(){return S}function K(){aa&&l()}function L(){aa||k()}function M(){var a=(new Date).getTime();a-qa>6e3&&(pa=a),qa=a,oa=setTimeout(M,3e3)}function N(){return clearTimeout(oa),M(),(new Date).getTime()-pa}var O={};_.extend(O,Backbone.Events);var P,Q,R,S,T,U=6e4,V=6e5,W=3e5,X=969,Y=3e4,Z=!1,$=!1,aa=!1,ba=!1,ca=!1,da=!1,ea=!1,fa=!1,ga=!1,ha=!1;ifvisible.on("focus",function(){P||(P=!0,$=!1,O.trigger("appFocus"))}),ifvisible.on("blur",function(){P&&(P=!1,O.trigger("appBlur"))}),ifvisible.on("activate",function(){Q||(Q=!0,O.trigger("appActivate"))}),ifvisible.on("deActivate",function(){Q&&(Q=!1,e(),O.trigger("appDeactivate"))});var ia,ja,ka,la=!1,ma=0,na=function(a){X>=a?R||(R=!0,O.trigger("appSwitchedToCompactView")):R&&(R=!1,O.trigger("appSwitchedToNormalView"))};O.on("windowResized",na),c.on("nativeSystemActivated",K),c.on("nativeSystemIdled",L);var oa,pa=(new Date).getTime(),qa=pa;return M(),O.initialize=d,O.appHasFocus=m,O.isAppActivated=n,O.isAppInShortIdleState=o,O.isAppInShortIdle2State=p,O.isAppInLongIdleState=q,O.isAppInCompactView=r,O.setRefreshingOnSessionExpired=s,O.getRefreshingOnSessionExpired=t,O.setAppUpdateAvailable=u,O.getAppUpdateAvailable=v,O.setRefreshingOnAppUpdateAvailable=w,O.getRefreshingOnAppUpdateAvailable=x,O.setRefreshingOnUpgradedToPremium=y,O.getRefreshingOnUpgradedToPremium=z,O.setSigningOut=A,O.getSigningOut=B,O.setRefreshingOnUserRemovedFromNetwork=C,O.getRefreshingOnUserRemovedFromNetwork=D,O.setSwitchingNetwork=E,O.getSwitchingNetwork=F,O.isAppInCompactViewModeWithGivenWidth=H,O.setScaledCompactWidth=I,O.getScaledCompactWidth=J,O.getIsForceRefreshing=G,O.getJavaScriptLastExecTime=N,O}]),b.module("convoApp").factory("appTabs",["localStore","appStateInfo","config","perf","logger",function(b,d,e,f,g){function h(b){ea||(ha=b,ka=Date.now(),d.on("appFocus",j),d.on("appBlur",k),d.on("appActivate",l),d.on("appDeactivate",m),d.on("appShortIdle",n),d.on("appActive",o),a.addEventListener("storage",ca,!1),da.on(Y(ha),X),da.on(wa,B),ia=setInterval(I,5e3),ja=setTimeout(S,60*(5+Math.ceil(20*Math.random()))*1e3),r(ha),i())}function i(){var a=d.appHasFocus();(a||e.IS_NATIVE)&&(A(ha),za=!0),a?u(ha):F(),ea=!0}function j(){A(ha),u(ha),z(),G(),za?da.trigger("onTabFocus_alreadySetAsLastActiveTab"):(za=!0,da.trigger("thisTabLastActiveChanged",!0))}function k(){v()}function l(){K()&&w(ha)}function m(){K()&&x()}function n(){K()&&y(ha)}function o(){K()&&z()}function p(){ga||(G(),d.off("appFocus",j),d.off("appBlur",k),da.off(wa,B),clearInterval(ia),clearTimeout(ja),ga=!0)}function q(){fa||(s(ha),fa=!0)}function r(a){var b=C(),c=b.indexOf(a);-1!==c&&b.splice(c,1),b.push(a),$(na,b)}function s(a){var b=C(),c=b.indexOf(a);-1!==c&&(b.splice(c,1),$(na,b))}function t(a){var b=C();if(0===a.length)return b;var c=_.difference(b,a);return $(na,c),c}function u(a){$(qa,a)}function v(){$(qa,c)}function w(a){$(ra,a)}function x(){$(ra,c)}function y(a){$(sa,a)}function z(){$(sa,c)}function A(a){ha===a&&G(),$(oa,a);var b="";la&&(b=la()),$(pa,b);var c={version:ta,lastActiveTabId:a,sourceTabId:ha};ba(wa,c)}function B(a){a.version===ta&&za&&(Aa=!0)}function C(){var a=Z(na);return"[object Array]"!==Object.prototype.toString.call(a)&&(a=[]),a}function D(){return C().length}function E(){var a=C();if(0===a.length)return-1;for(var b=0;b<a.length;b++)if(a[b]===ha)return b;return-1}function F(){Ba||(document.addEventListener("mousemove",H,!1),Ba=!0)}function G(){Ba&&(document.removeEventListener("mousemove",H,!1),Ba=!1)}function H(){A(ha),G(),za||(za=!0,da.trigger("thisTabLastActiveChanged",!0))}function I(){N(function(a){ga||(Aa=!1,a!==za&&(za=a,da.trigger("thisTabLastActiveChanged",za)),za?G():F())})}function J(){for(var a,b=C(),c=Z(qa),d=0;d<b.length;d++)if(a=b[d],a===c)return!0;return!1}function K(){var a=Z(qa);return a===ha}function L(){var a=Z(ra);return a?!0:!1}function M(){var a=Z(sa);return a?!0:!1}function N(a){return e.IS_NATIVE?void a(!0):void O(function(b){a(b===ha)})}function O(a){var b=Z(oa);return b===ha?void a(ha):void(b?V(b,function(c){return c?void a(b):ga?void a(-1):void Q(function(b){a(b)})}):Q(function(b){a(b)}))}function P(){return Z(pa)}function Q(a){var b=C();return 0===b.length?(r(ha),A(ha),void a(ha)):void R(function(b){return ga?void a(-1):void(b!==ya?(A(b),a(b)):(r(ha),A(ha),a(ha)))},b,b.length-1)}function R(a,b,c){return-1===c?void a(ya):void V(b[c],function(d){if(d)a(b[c]);else{if(ga)return void a(ya);R(a,b,--c)}})}function S(){T(),ja=setTimeout(S,60*(30+Math.ceil(20*Math.random()))*1e3)}function T(){var a=C();0!==a.length&&U(a,a.length-1,[],function(a){var b=t(a);e.IS_NATIVE||e.IS_MENULET||(Ca=b.length)})}function U(a,b,c,d){return-1===b?void d(c):void V(a[b],function(e){ga||(e||c.push(a[b]),U(a,--b,c,d))})}function V(a,b){return a===ha?void b(!0):void W(a,"areYouAlive",null,function(a){b(a!==xa)})}function W(a,b,c,d){if(d){var e=function(c){c.sourceTabId===a&&c.functionName==="response:"+b&&(da.off("_internal__functionCalledByOtherTab",e),clearTimeout(f),d(c.data))};da.on("_internal__functionCalledByOtherTab",e);var f=setTimeout(function(){da.off("_internal__functionCalledByOtherTab",e),d(xa)},2e3)}var c={version:ta,targetTabId:a,functionName:b,data:c,sourceTabId:ha};ba(Y(a),c)}function X(a){a.version===ta&&a.sourceTabId!==ha&&a.targetTabId===ha&&("areYouAlive"===a.functionName&&W(a.sourceTabId,"response:areYouAlive",null),da.trigger("_internal__functionCalledByOtherTab",a));
}function Y(a){return va+"_"+a}function Z(a){var c=b.readData(a);return c&&c.version===ma?c.data:null}function $(a,c){f.recordCounter("numIntercomLSWrites"),b.writeData(a,c,ma)}function aa(a){b.clearData(a)}function ba(a,b){var c={};c.eventData=b,c.dirtyTag=ha+"_"+Da,Da++,$(a,c),setTimeout(function(){aa(a)},20)}function ca(b){b=b||a.event;var c=b.key.indexOf(ua);if(b.newValue&&-1!==c){var d=JSON.parse(b.newValue);if(d.version===ma){f.recordCounter("numIntercomLSEvents");var e=b.key.slice(c);f.recordLog("appTabs_event: "+e),da.trigger(e,d.data.eventData)}}}var da={};_.extend(da,Backbone.Events);var ea,fa,ga,ha,ia,ja,ka,la,ma=5,na="appTabs_tabs",oa="appTabs_lastActiveTab",pa="appTabs_lastActiveTabView",qa="appTabs_currentActiveTab",ra="appTabs_currentActiveTabIsActivated",sa="appTabs_currentActiveTabIsIdle",ta=3,ua="appTabs_intercom_",va=ua+"functionCall",wa=ua+"lastActiveTabChange",xa="NO_RESPONSE",ya="NONE",za=!1,Aa=!1,Ba=!1,Ca=e.IS_NATIVE||e.IS_MENULET?1:-1,Da=0;return da.dispatchTabsEvent2=function(a,b){ba(ua+a,b)},da.addTabsEventListener2=function(a,b){da.on(ua+a,b)},da.removeTabsEventListener2=function(a,b){da.off(ua+a,b)},da.initializeThisTab=h,da.disposeLastActiveTabManagementProcess=p,da.disposeThisTab=q,da.getThisTabIdx=E,da.isThisTabLastActiveTab=function(){return Aa?!1:za},da.checkIsThereAnyActiveTab=J,da.checkIsCurrentActiveTabIsActivated=L,da.checkIsCurrentActiveTabIsIdle=M,da.getNumTabs=D,da.getThisTabInitTS=function(){return ka},da.getNumBrowserTabsOpen=function(){return Ca},da.getLastActiveTabView=P,da.setLastActiveTabViewGetterMethod=function(a){la=a},da}]),b.module("convoApp").factory("appTitleManager",["appStateInfo","appTabs","utils",function(b,c,d){function e(){if(c.checkIsCurrentActiveTabIsIdle())return!0;var a=b.appHasFocus(),d=b.isAppActivated();if(a&&!d)return!0;var e=c.checkIsThereAnyActiveTab()&&c.checkIsCurrentActiveTabIsActivated();return a||e?!1:!0}function f(b){if(b&&e()){var c;_.contains(r,b)?c=_.indexOf(r,b):(r.push(b),c=r.length-1),a.document.title=r[c++],o&&clearInterval(o),o=setInterval(function(){e()?c<r.length?(a.document.title=r[c],c++):(a.document.title=p,c=0,0==r.length&&k()):k()},q)}}function g(a,b){if(t||(t=$("head").find("link[rel='shortcut icon']")),!d.isEdge()&&!d.isIE()&&a&&a.length)if(0==t.length){var c=document.querySelector("link[rel*='icon']")||document.createElement("link");c.type="image/x-icon",c.rel="shortcut icon",c.href=a,document.getElementsByTagName("head")[0].appendChild(c)}else t.attr("href",a);else t.length>0&&t.attr("href",s)}function h(a){var b="postDisplayOption",c=[];c=a.split(" ");var d=!1;for(var e in c)if(0===c[e].indexOf(b)&&(c.splice(e,1),d=!0),d)break;return 0===c.length?"My Feed":c.join(" ")}function i(b){var c;try{c=decodeURIComponent(b),c=h(c)}catch(d){c=b}b&&(p=c+" - Convo",a.document.title=p)}function j(){k(),c.dispatchTabsEvent2("tabInFocus")}function k(){o&&clearInterval(o),r=[],a.document.title=p}function l(a){for(var b=0;b<a.length;b++)r.splice(_.indexOf(r,a[b]),1)}function m(a){for(var b=0;b<a.length;b++)f(a[b])}function n(){g(),p=a.document.title}var o,p,q=1e3,r=[],s="/favicon.ico";b.on("appFocus",j),c.addTabsEventListener2("tabInFocus",k);var t;return{initialize:n,setAppTitle:i,toggleAppTitleWith:f,toggleAppTitleWithTitles:m,setAppFavicon:g,clearToggleTitle:l}}]),b.module("convoApp").factory("appsService",["ServerComm","$q",function(a,b){function c(c){var d={method:"sendDownloadAppEmail",receiving_client:c},e=a.post("apps",d),f=b.defer();return e.success(function(a,b){f.resolve(a)}),f.promise}var d={};return d.sendDownloadAppEmail=c,d}]),b.module("convoApp").factory("atMentionsListProvider",["usersGroupsListProvider","convoCommandsListProvider","emojiDataService",function(a,b,c){function d(c,d,e,f,g,h){d=d||k;var i=[];return i=b.queryAvailableCommands(c,d,e),i=i.concat(a.getPublishableGroupsAndUsersOrPreviousHistory(c,d-i.length,f,g,h))}function e(b,c,d,e,f){c=c||k;var g=[];return g=a.getPublishableGroupsAndUsersOrPreviousHistory(b,c-g.length,d,e,f)}function f(b,c){c=c||k;var d=[];return d=a.getPublishableUsersOrPreviousHistory(b,c-d.length)}function g(b){return a.getPublishableUsersListItemsFromUserIds(b)}function h(a,c,d){c=c||k;var e=[];return e=b.queryAvailableCommands(a,c,d)}function i(a,b){b=b||k;var d=[];return d=c.queryEmojisByShortCodes(a,b)}function j(b,c,d,e,f){c=c||k;var g=[];return g=a.queryPublishableGroups(b,c-g.length,d,e,f)}var k=5;return{queryPublishableUsersGroupsAndCommands:d,queryPublishableUsersAndGroups:e,queryAvailableCommands:h,queryEmojiData:i,queryPublishableUsers:f,sources:{CHAT:"chat",INLINE_INSERT:"inlineInsert",COMMENT:"comment"},getPublishableUsersListItemsFromUserIds:g,queryPublishableGroups:j}}]),b.module("convoApp").factory("audioService",function(){var a={};return _.extend(a,Backbone.Events),a}),b.module("convoApp").factory("awsService",["$http",function(a){function d(a){i=a,j="http"+(i.https_uploads?"s":"")+"://"+i.bucket_name+".s3.amazonaws.com/"}function e(){return i}function f(){return j}function g(d,e){var f=new FormData;f.append("AWSAccessKeyId",i.access_key),f.append("acl","private"),f.append("policy",i.s3_policy),f.append("Filename",e),f.append("signature",i.s3_signature),f.append("success_action_status","201"),f.append("Content-Type","image/png"),f.append("key",e),f.append("x-amz-server-side-encryption","AES256"),f.append("file",d);var g=a.post(j,f,{transformRequest:b.identity,headers:{"Content-Type":c}});return g}function h(d,e,f,g){var h=new FormData;h.append("AWSAccessKeyId",i.access_key),h.append("acl","private"),h.append("policy",i.s3_policy),h.append("Filename",e),h.append("signature",i.s3_signature),h.append("success_action_status","201"),h.append("Content-Type",g),h.append("key",f),h.append("x-amz-server-side-encryption","AES256"),h.append("file",d);var k=a.post(j,h,{transformRequest:b.identity,headers:{"Content-Type":c}});return k}var i,j;return{setAwsData:d,getAwsData:e,getS3BucketUrl:f,uploadSnippetImage:g,uploadFile:h}}]),b.module("convoApp").factory("billingService",["ServerComm","$q","accountInfo","userInfo",function(a,b,c,d){function e(){var c={method:"getSubscriptionIfUserCanUpgradeAccount"},d=a.get("billing",{params:c}),e=b.defer();return d.then(function(a,b){e.resolve(a.data)},function(a,b){e.reject(a.data)}),e.promise}function f(){var c={method:"getUpdatePaymentPageUrl"},d=a.get("billing",{params:c}),e=b.defer();return d.then(function(a,b){e.resolve(a.data)},function(a,b){e.reject(a.data)}),e.promise}function g(){var c={method:"getNumActivatedUsers"},d=a.get("billing",{params:c}),e=b.defer();return d.then(function(a,b){e.resolve(a.data)},function(a,b){e.reject(a.data)}),e.promise}function h(c){var d={method:"fetchTransactionsForSubscription",sub_id:c},e=a.get("billing",{params:d}),f=b.defer();return e.then(function(a){f.resolve(a.data)},function(a){f.reject(a.data)}),f.promise}var i={};return _.extend(i,Backbone.Events),i.getBillingInfo=e,i.getUpdatePaymentUrl=f,i.getActivatedUsersNum=g,i.getBillingHistory=h,i}]),b.module("convoApp").factory("boxService",["ServerComm","$q",function(a,b){var c={createBoxIntegration:function(c,d,e,f,g,h,i,j,k){var l=b.defer(),m={account_id:c,creator_id:d,display_name:e,action_type:f,access_level:g,recipients:h,profile_image_info:i,folder_id:j,token_id:k};return a.post("integrations/box",m).success(function(a,b){l.resolve(a)}),l.promise},getUserInfo:function(c){var d=b.defer(),e={op:"token_id",user_id:c,version:"1.1"};return a.get("integrations/box?op=token_id&user_id="+c+"&version=1.1",e).success(function(a,b){d.resolve(a)}),d.promise},deleteAuthorization:function(c){var d=(b.defer(),{token_id:c,target:"authorization"});return a.deletex("integrations/box",d)},deleteIntegration:function(c){var d=(b.defer(),{webhook_id:c,target:"webhook"});return a.deletex("integrations/box",d)},getIntegrationDetails:function(c){var d=b.defer(),e={op:"integrations_details",webhook_id:c};return a.get("integrations/box?webhook_id="+c+"&op=integrations_details",e).success(function(a,b){d.resolve(a)}),d.promise},getFolderList:function(c,d){var e=b.defer(),f={op:"folder_list",token_id:c,folder_id:d};return a.get("integrations/box?token_id="+c+"&folder_id="+d+"&op=folder_list",f).success(function(a,b){e.resolve(a)}),e.promise},updateIntegration:function(c,d,e,f,g,h,i){var j=b.defer(),k={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g,folder_id:h,token_id:i};return a.put("integrations/box",k).success(function(a,b){j.resolve(a)}),j.promise}};return c}]),b.module("convoApp").factory("ContactsWrapper",[function(){var a={};return _.extend(a,Backbone.Events),a}]),b.module("convoApp").factory("Contacts",["ContactsWrapper","accountInfo","utils","$q","alertsService","ServerComm","FilterTypes","usersGroupsListProvider","mixpanelService","userInfo","localStore",function(a,b,d,e,f,g,h,i,j,k,l){function m(a){r(a.contacts_revision)}function n(a){for(var b=0;b<a.length;b++){var c=a[b];c.label=c.email,c.labelisemail=!0,c.email=c.email,c.desclabel="",c.id=b.toString()+d.generateHash(c.email),c.type="CONTACT",c.filter_link=o(c.email),c.classes=L+d.getRandomSmiley()+" as-bg"}return a}function o(a){var c="#/v1/"+b.getAccountId()+"/feed?q=",d=a;return c+=encodeURIComponent('from:"'+a+'"')+"#title="+encodeURIComponent(d).replace(/'/g,"%27")}function p(a){for(var b=0;b<a.length;b++)"1"==a[b].join_status&&(a.splice(b,1),--b);return a}function q(a){if(a)for(var c=b.getAccountDomains(),d=(b.getAccountId(),0),e=c.length;e>d;d++)if(0==c[d].user_email_domain.indexOf(a))return d;return-1}function r(b){return G===c?void(G=b):void(G!=b&&(console.log("KH: triggering accountContactsRevisionNoChanged event: old/new rev numbers: "+G+"/"+b),G=b,t(!0).then(function(){a.trigger("network_contacts_updated")})))}function s(b){var c=e.defer();return g.post("usercontacts",{method:"addUserContacts",src:b.src,contacts:b.contacts}).success(function(b,d){a.trigger("contactsSubmittedOnServer"),c.resolve(b)}).error(function(a,b){c.reject(a)}),j.trackEvent(j.IMPORT_CONTACTS,{Medium:b.src}),c.promise}function t(a,b){if(!M&&(!N||a)){H=e.defer();var c=!1;if(!b){var d=w();d&&d.data.account_contacts_revision_number==G&&(I.on_domain=n(d.data.account_user_contacts),H.resolve(I.on_domain),c=!0)}if(!c){var f=g.post("usercontacts",{method:"getAccountUserContacts",include_off_domain:!1});M=!0,f.success(function(a,b){var c=p(a.data.account_user_contacts);l.writeData(v(),{account_user_contacts:c,account_contacts_revision_number:a.data.account_contacts_revision_number},P)||l.writeData(v(),"",P);var d=n(c);I.on_domain=d,M=!1,N=!0,H.resolve(I.on_domain)}).error(function(a,b){M=!1,N=!1,H.reject(a)})}}return H.promise}function u(){var a=e.defer(),b=g.post("usercontacts",{method:"getAccountUserContacts",include_off_domain:!0});return b.success(function(b,c){var d=p(b.data.account_user_contacts),e=n(d);I.all=e,a.resolve(e)}).error(function(b,c){a.reject(b)}),a.promise}function v(){return O}function w(){var a=l.readData(v());return a&&a.version!==P&&(a=null,l.clearData(v())),a}function x(a){var b=e.defer();return k.isGuestUser()?b.resolve([]):a===J.ON_DOMAIN?t().then(function(){b.resolve(I[a])},function(){b.reject()}):a===J.ALL?u().then(function(){b.resolve(I[a])},function(){b.reject()}):a===J.SCRAP?b.resolve(I[a]):b.resolve([]),b.promise}function y(a,b){z(a);for(var c=0,d=0;c<a.length;++c)if("0"==a[c].rank&&"0"==a[c].join_status){if(d>=b){a.splice(c,1),--c;continue}++d}return I.scrap.splice(0,b),a}function z(a){I.scrap.length=0;for(var b=0,c=a.length;c>b;++b)"0"==a[b].rank&&"0"==a[b].join_status&&(a[b].scrap=!0,I.scrap.push(a[b]))}function A(){return I.scrap.shift()}function B(a){var b=e.defer();return s({src:a.source,contacts:a.contacts}).then(function(){var c=a.include_off_domain?"getAccountUserContacts_includeOffDomain":"getAccountUserContacts";Q[c](!0,!0).then(function(a){b.resolve(a)})},function(a){b.reject(a)}),b.promise}function C(a,b,c){var d=b[c],e=d.replace(a,"$1b1%b1_1$3b2%b2_2");if(b[c+"isemail"]){var f=d.indexOf("@");e.indexOf("b1%b1_1")>f&&(e=d)}return e}function D(a,b,c,e,f,g){if(!a||!b)return[];c||(c=5),c=Math.min(c,b.length);var i=d.getUserGroupSearchRegex(a),j=[],l=0,m=-1,n={};f&&(n=E(a,e));for(var o={label:"People you may know",formattedlabel:"People you may know",type:"SEPARATOR",id:d.generateHash("People you may know")},p=0,q=b.length;q>p&&c>l;++p)if(!b[p].separator){var r=b[p],s=r.type===h.USER?r.desclabel:r.label,t=C(i,r,"label"),u=r.type===h.USER?C(i,r,"desclabel"):r.desclabel;(n.available&&n.label===s||k.getEmail()===n.label)&&(n.duplicate=!0),(t!=r.label||u!=r.desclabel)&&(r.formattedlabel=t,r.formatteddesclabel=u,"CONTACT"===r.type&&-1==m&&(m=j.length),j.push(r),l++)}-1!=m&&j.splice(m,null,o);return n.message?j.push({label:n.message.text,formattedlabel:n.message.text,formatteddesclabel:"",type:"ERROR",classes:"no-border "+n.message.classes,id:d.generateHash(n.message.text)}):(n.available&&!n.duplicate&&j.push({label:n.label,formattedlabel:n.label,formatteddesclabel:"",type:"CONTACT",extended_type:"AUTO_TYPE_SUGGESTION",classes:"no-border cnv-smiley "+d.getRandomSmiley()+" as-bg",email:n.label,id:d.generateHash(n.label)}),g||j.push({label:"Select from your email contacts",formattedlabel:"Select from your email contacts",formatteddesclabel:"",type:K.GOOGLE_CONTACT_IMPORT,classes:"import-gmail",id:d.generateHash("Select from your email contacts")})),j}function E(a,c){var e=a.toLowerCase().trim(),f=e.lastIndexOf("@"),g={},h="";if(-1!=f&&(h=e.substr(f+1),h||(e=e.slice(0,-1))),h){var i=q(h);if(-1!=i){var j=e.substr(0,f)+"@"+b.getAccountDomains()[i].user_email_domain;b.shouldInviteGuestsAsFullMembers()?(g.label=j,g.available=!0):d.isValidEmail(j)?(g.label=j,g.available=!0):g.available=!1}else c?(g.available=!1,g.message={text:"External email addresses can only be added in groups",classes:"error-state-red"}):d.isValidEmail(e)?(g.label=e,g.available=!0):g.available=!1}else{var j=e+"@"+b.getPrimaryAccountDomain().user_email_domain;b.shouldInviteGuestsAsFullMembers()?g.label=e:d.isValidEmail(j)?(g.label=j,g.available=!0):(g.label="",g.available=!1)}return g.available&&k.getEmail()===g.label&&(g.duplicate=!0),g}function F(a){var b=e.defer(),c="invites/templates/cnvBasicInviteModal.tpl.html",d="basicInviteModalCtrl",g={contacts:a},h={data:function(){return g}};return f.customModal(c,d,h).result.then(function(a){var c="common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",d="findContactsSplashCtrl",e={data:function(){return{response:a,requestedView:"COMPLETE"}}};f.customModal(c,d,e).result.then(function(a){console.log("invite complete."),b.resolve()},function(){console.log("invite complete."),b.resolve()})},function(){b.resolve()}),b.promise}var G,H,I={on_domain:[],all:[],scrap:[]},J={ON_DOMAIN:"on_domain",ALL:"all",SCRAP:"scrap"},K={GOOGLE_CONTACT_IMPORT:"googlecontactimport"},L="no-border cnv-smiley ",M=!1,N=!1,O="CONTACTS",P=1,Q={initialized:!0,initialize:m,query:D,addUserContactsAndGetAccountUserContacts:B,initContactsInviteModal:F,setAccountContactsRevisionNo:r,getSuggestedContactBasedOnQuery:E,limitScrapContacts:y,getScrapContact:A,getAccountUserContacts:t,getAccountUserContacts_includeOffDomain:u,addUserContacts:s,getContacts:x,CONTACT_LIST_TYPES:J,CONTACT_TYPES:K,CLASSES:L};return _.extend(a,Q),Q}]),b.module("convoApp").factory("convoCommandsListProvider",["utils","config","networkSettingService",function(a,b,c){function d(b,c,d){if(0==g.length)return[];var e=b.indexOf(" ");b=b.split(" "),b=b[0],c||(c=f);var h,k,l=[],m=a.getUserGroupSearchRegex(b);for(i=0;i<g.length;i++)if(k=_.find(g[i].sources,function(a){return d===a?!0:void 0}))for(j=0;j<g[i].keywords.length;j++){if(h=e>=0?g[i].keywords[j]:g[i].keywords[j].substr(0,b.length),h==b){g[i].formattedlabel=g[i].label.replace(m,"$1b1%b1_1$3b2%b2_2"),l.push(g[i]);break}if(l.length==c-1)break}return l}function e(){if(c.getGiphyStatus()){var a={type:"cmd",label:"Giphy",sources:["inlineInsert","chat","comment"],formattedlabel:"Giphy",desclabel:"Find the right gif for any situation",formatteddesclabel:"Find the right gif for any situation",classes:"",imgClasses:"",keywords:["giphy","gif"],imgurl:b.APP_BASE_URL+"assets/img/common/GiphyUserImage.png"};g.push(a)}var d={type:"cmd",label:"Appear.in",sources:["chat"],formattedlabel:"Appear.in",desclabel:"Start an Appear.in video call",formatteddesclabel:"Start an Appear.in video call",classes:"",imgClasses:"appearin-commands-item",keywords:["appear.in","Appear.in"],imgurl:"assets/img/chat/appearin.png"};g.push(d)}var f=5,g=[];return e(),{queryAvailableCommands:d}}]),b.module("convoApp").factory("crossBrowserCompatibility",["utils",function(a){var b={},c=$(document.body);return c.addClass((a.whichOS()||"").toLowerCase()),c.addClass((a.whichBrowser()||"").toLowerCase()),a.isSafari9()&&c.addClass("safari-9"),document.contains||(document.contains=function(a){return document.body.contains(a)}),HTMLElement.prototype.remove||(HTMLElement.prototype.remove=function(){var a=this;a.parentNode&&a.parentNode.removeChild(a)}),b}]),b.module("convoApp").factory("datetimeService",["dateFilter",function(a){function b(a){o=a,p=Date.now(),r=!0}function c(){return r?o+(Date.now()-p):Date.now()}function d(a){if("string"==typeof a){var b=parseInt(a);a=b==a?b:new Date(a.replace(" ","T")+"Z").getTime()}return a}function e(a){return f(a,c())}function f(b,e,f,g,h,i,j,k,l,m){b=d(b);var n="";e||(e=c());var o=e-b;if(o>=q&&6*q>=o){var p=new Date(b);p.getDay();if(k){var r=new Date,s=p.getDay(),u=r.getDay()-s;0>u&&(u=7+u),1>u&&(u=1),n=u+"d"}else n=t[p.getDay()]}else if(o>=6*q){var v=new Date(b),w=new Date(e);if(l)n=Math.floor(o/(7*q))+"w","0w"===n&&(n="6d");else if(j)n=a(b,j);else{var x=v.getYear()==w.getYear()||363*q>o,y=f?"":"h:mm a, ";y+=x?"MMM d":"MMM d, yyyy",n=a(b,y)}h&&(n=i?n:" on "+n)}else{0>o&&(o=0);var z=new Date(o),A=z.getUTCHours(),B=z.getUTCMinutes();g?(1==A?n="1h":A>1?n=A+"h":B>=2?n=B+"m":1==B?n="1m":(n="now",(h||m)&&(n="1m")),h&&(n+=" ago")):n=1==A?"1 hour":A>1?A+" hours":B>=2?B+" mins":1==B?"1 min":"now"}return n}function g(a,b){if("string"==typeof a){var c=parseInt(a);a=c==a?c:new Date(a.replace(" ","T")+"Z")}else a=new Date(a);var d=a.getHours(),e=a.getMinutes(),f=d;d>12&&(f=d-12),10>f&&(f="0"+f),10>e&&(e="0"+e);var g="";return g=b?f+":"+e+" "+(12>d?"am":"pm"):s[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()+" at "+f+":"+e+(12>d?" am":" pm")}function h(b){return a(b,"h:mm a")}function i(b,d){var e="";if(k(b))e="Today";else if(l(b))e="Yesterday";else{var f=c(),g=f-b,h=new Date(b),i=new Date(f),j=h.getYear()==i.getYear()||363*q>g;e=j?a(b,"MMM d"):a(b,"M/d/yy"),e=e.toUpperCase()}if(d){var m=new Date(b),n=m.getHours(),o=m.getMinutes(),p=n;n>12&&(p=n-12),10>o&&(o="0"+o),e.length&&(e+=", "),e+=p+":"+o+(12>n?" AM":" PM")}return e}function j(b){var c=(new Date).getTime(),d="";return d=k(b)?"Today":l(b)?"Yesterday":a(b,"yyyy")!=a(c,"yyyy")?a(b,"MMM d,yyyy"):a(b,"MMM d")}function k(b){var c=a(b,"MMM d,yyyy"),d=a(Date.now(),"MMM d,yyyy");return c==d?!0:!1}function l(b){var c=a(b,"MMM d,yyyy"),d=(new Date).getTime();d-=q;var e=a(d,"MMM d,yyyy");return c==e?!0:!1}function m(b,c){var d=a(b,"MMM d,yyyy"),e=a(c,"MMM d,yyyy");return d!=e?!0:!1}function n(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return 10>b&&(b="0"+b),10>c&&(c="0"+c),c+"/"+b+"/"+d}var o,p,q=864e5,r=!1,s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=new Array(7);return t[0]="Sun",t[1]="Mon",t[2]="Tue",t[3]="Wed",t[4]="Thu",t[5]="Fri",t[6]="Sat",{init:b,getServerTimestamp:c,formatDateAgo:e,makeRelativeDateString:f,localize:g,getTimeFormatHmma:h,dateSeparatorFromCurrentTime:i,dateSeparatorFromCurrentTimeByDayMonthOrYear:j,isDayDiff:m,getCurrentTime:n,normalizeAndGetUnixTimestamp:d}}]),b.module("convoApp").factory("delimitedTextParser",["utils",function(a){function b(){l=0,m=!1,o=!1,n=!1}function c(a){return b(),j=a,k=",",d()}function d(){var a=[],b=0;if(l<j.length)for(var c;;)if(c=e(),n||(a.push(c),c.length>b&&(b=c.length)),o)break;for(var d=0;d<a.length;d++){var f=a[d];f.length<b&&(a[d]=f.concat(new Array(b-f.length).map(function(a,b,c){return""})))}return a}function e(){var a=[];if(l<j.length)for(var b;;)if(b=f(),n||a.push(b),m)break;return a}function f(){var a="";if(l<j.length){var b,c,d=!1;for(m=!1,h();l<j.length;){if(b=j.charAt(l),'"'==b){if(!d){d=!0,++l;continue}if(c=g(1),'"'!=c){d=!1,++l;continue}++l}else if(b==k){if(!d){++l;break}}else if("\n"==b){if(!d){++l,m=!0;break}}else if("\r"==b&&!d){c=g(1),"\n"==c?l+=2:++l,m=!0;break}a+=b,++l}l>=j.length&&(m=!0,o=!0)}return a}function g(a){var b;return b=l+a<j.length?j.charAt(l+a):p}function h(){for(var a;l<j.length&&(a=j.charAt(l),a!=k&&(" "==a||"	"==a||"\f"==a));)++l;l>=j.length&&(o=!0)}var i={};_.extend(i,Backbone.Events);var j,k,l,m,n,o,p="EOF";return i.parseDelimitedText=c,i}]),b.module("convoApp").factory("directsService",["ServerComm","$q",function(a,b){function c(){var c={method:"resetDirectsCount"},d=a.post("directs",c),e=b.defer();return d.success(function(a,b){e.resolve(a)}),e.promise}var d={};return d.resetDirectsCount=c,d}]),b.module("convoApp").factory("draftService",["localStore","appsInfo",function(a,b){var c={};return _.extend(c,Backbone.Events),c.saveDraftToLocalStorage=function(b,c){var d=b+","+c;a.writeData("last_saved_draft",d)},c.removeDraftFromLocalStorage=function(){a.clearData("last_saved_draft")},c.dataAvailableInLocalStorage=function(){var c=a.readData("last_saved_draft");return null==c?!1:(data=c.data.split(","),appData=b.getAppInfoByAppInstanceId(data[0]),"Notes"==appData.title?!0:!1)},c.getLocalStorageData=function(){var c=a.readData("last_saved_draft");return null==c?!1:(data=c.data.split(","),appData=b.getAppInfoByAppInstanceId(data[0]),"Notes"==appData.title?data:!1)},c}]),b.module("convoApp").factory("dropboxService",["ServerComm","$q","onboardingService",function(a,b,c){var d={createDropboxIntegration:function(d,e,f,g,h,i,j,k,l){var m=b.defer(),n={account_id:d,creator_id:e,display_name:f,action_type:g,access_level:h,recipients:i,profile_image_info:j,directory:k,token_id:l};return a.post("integrations/dropbox",n).success(function(a,b){m.resolve(a),c.markIntegrationsAsDone("Dropbox")}),m.promise},getUserInfo:function(c){var d=b.defer(),e={op:"token_id",user_id:c,version:"1.1"};return a.get("integrations/dropbox?op=token_id&user_id="+c+"&version=1.1",e).success(function(a,b){d.resolve(a)}),d.promise},deleteAuthorization:function(c){var d=(b.defer(),{token_id:c,target:"authorization"});return a.deletex("integrations/dropbox",d)},deleteIntegration:function(c){var d=(b.defer(),{webhook_id:c,target:"webhook"});return a.deletex("integrations/dropbox",d)},getIntegrationDetails:function(c){var d=b.defer(),e={op:"integrations_details",webhook_id:c};return a.get("integrations/dropbox?webhook_id="+c+"&op=integrations_details",e).success(function(a,b){d.resolve(a)}),d.promise},getDirectoryList:function(c,d){var e=b.defer(),f={op:"directory_list",token_id:c,directory:encodeURIComponent(d)};return a.get("integrations/dropbox?token_id="+c+"&directory="+encodeURIComponent(d)+"&op=directory_list",f).success(function(a,b){e.resolve(a)}),e.promise},updateIntegration:function(c,d,e,f,g,h,i){var j=b.defer(),k={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g,directory:h,token_id:i};return a.put("integrations/dropbox",k).success(function(a,b){j.resolve(a)}),j.promise}};return d}]),b.module("convoApp").factory("facebookService",["ServerComm","$q","onboardingService",function(a,b,c){var d={createFacebookIntegration:function(d,e,f,g,h,i,j,k,l){var m=b.defer(),n={account_id:d,creator_id:e,display_name:f,action_type:g,access_level:h,recipients:i,profile_image_info:j,page_id:k,token_id:l};return a.post("integrations/facebook",n).success(function(a,b){m.resolve(a),c.markIntegrationsAsDone("Facebook")}).error(function(a,b){m.resolve(b)}),m.promise},getPageList:function(c){var d=b.defer(),e={op:"pages_list",token_id:c};return a.get("integrations/facebook?op=pages_list&token_id="+c,e).success(function(a,b){d.resolve(a)}),d.promise},getUserInfo:function(c){var d=b.defer(),e={op:"user_info",user_id:c,token_id:"1111",version:"1.1"};return a.get("integrations/facebook?op=user_info&user_id="+c+"&token_id=1111&version=1.1",e).success(function(a,b){d.resolve(a)}),d.promise},deleteAuthorization:function(c){var d=(b.defer(),{token_id:c,target:"authorization"});return a.deletex("integrations/facebook",d)},deleteIntegration:function(c){var d=(b.defer(),{webhook_id:c,target:"webhook"});return a.deletex("integrations/facebook",d)},getIntegrationDetails:function(c){var d=b.defer(),e={webhook_id:c,op:"integration_details",token_id:"1111"};return a.get("integrations/facebook?webhook_id="+c+"&token_id=1111&op=integration_details",e).success(function(a,b){d.resolve(a)}),d.promise},updateIntegration:function(c,d,e,f,g,h,i){var j=b.defer(),k={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g,page_id:h,token_id:i};return a.put("integrations/facebook",k).success(function(a,b){j.resolve(a)}).error(function(a,b){j.resolve(b)}),j.promise}};return d}]),b.module("convoApp").factory("feedLikeThisService",["$rootScope","ServerComm",function(a,b){var c={};return _.extend(c,Backbone.Events),c.getFeeds=function(c,d,e,f){var g={authToken:a.login_data.xmpp_session_token,userID:a.login_data.user.user_id,accountID:a.login_data.account_id,filter:null,searchKeyword:c,feedId:d,count:10,fromIndex:e,refineSearch:f},h=b.postx("feed/fetchMoreLikeThis",g);return h},c}]),b.module("convoApp").factory("gcalService",["ServerComm","$q","onboardingService",function(a,b,c){var d={createGcalIntegration:function(d,e,f,g,h,i,j,k,l,m,n){var o=b.defer(),p={account_id:d,creator_id:e,display_name:f,action_type:g,access_level:h,recipients:i,profile_image_info:j,calendar_id:k,notification_time:l,token_id:m,trigger_data:n};return a.post("integrations/gcal",p).success(function(a,b){o.resolve(a),c.markIntegrationsAsDone("Google Calendar")}).error(function(a,b){o.resolve(b)}),o.promise},getCalendarList:function(c){var d=b.defer(),e={op:"calendar_list",token_id:c};return a.get("integrations/gcal?op=calendar_list&token_id="+c,e).success(function(a,b){d.resolve(a)}),d.promise},getUserInfo:function(c){var d=b.defer(),e={op:"user_info",user_id:c,token_id:"1111",version:"1.1"};return a.get("integrations/gcal?op=user_info&user_id="+c+"&token_id=1111&version=1.1",e).success(function(a,b){d.resolve(a)}),d.promise},deleteAuthorization:function(c){var d=(b.defer(),{token_id:c,target:"authorization"});return a.deletex("integrations/gcal",d)},deleteIntegration:function(c){var d=(b.defer(),{webhook_id:c,target:"webhook"});return a.deletex("integrations/gcal",d)},getIntegrationDetails:function(c){var d=b.defer(),e={webhook_id:c,op:"integration_details",token_id:"1111"};return a.get("integrations/gcal?webhook_id="+c+"&token_id=1111&op=integration_details",e).success(function(a,b){d.resolve(a)}),d.promise},updateIntegration:function(c,d,e,f,g,h,i,j,k){var l=b.defer(),m={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g,calendar_id:h,notification_time:i,token_id:j,trigger_data:k};return a.put("integrations/gcal",m).success(function(a,b){l.resolve(a)}).error(function(a,b){l.resolve(b)}),l.promise},eventEndReminder:function(c,d,e){var f=b.defer(),g={webhook_id:c,end_reminder:d,token_id:e,op:"save_event_end_reminder"};return a.put("integrations/gcal",g).success(function(a,b){f.resolve(a)}).error(function(a,b){f.resolve(b)}),f.promise}};return d}]),b.module("convoApp").factory("gdriveService",["ServerComm","$q","onboardingService",function(a,b,c){var d={createGdriveIntegration:function(d,e,f,g,h,i,j,k,l){var m=b.defer(),n={account_id:d,creator_id:e,display_name:f,action_type:g,access_level:h,recipients:i,profile_image_info:j,folder_id:k,token_id:l};return a.post("integrations/gdrive",n).success(function(a,b){m.resolve(a),c.markIntegrationsAsDone("Google Drive")}),m.promise},getUserInfo:function(c){var d=b.defer(),e={op:"token_id",user_id:c,version:"1.1"};return a.get("integrations/gdrive?op=user_info&user_id="+c+"&token_id=1111&version=1.1",e).success(function(a,b){d.resolve(a)}),d.promise},deleteAuthorization:function(c){var d=(b.defer(),{token_id:c,target:"authorization"});return a.deletex("integrations/gdrive",d)},deleteIntegration:function(c){var d=(b.defer(),{webhook_id:c,target:"webhook"});return a.deletex("integrations/gdrive",d)},getIntegrationDetails:function(c){var d=b.defer(),e={op:"integrations_details",webhook_id:c};return a.get("integrations/gdrive?webhook_id="+c+"&op=integration_details&token_id=1111",e).success(function(a,b){d.resolve(a)}),d.promise},updateIntegration:function(c,d,e,f,g,h,i){var j=b.defer(),k={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g,folder_id:h,token_id:i};return a.put("integrations/gdrive",k).success(function(a,b){j.resolve(a)}),j.promise},getFolderList:function(c,d){var e=b.defer(),f={op:"folders_list",token_id:c,folder_id:d};return a.get("integrations/gdrive?token_id="+c+"&op=folders_list&folder_id="+d,f).success(function(a,b){e.resolve(a)}),e.promise},getFolderName:function(c,d){var e=b.defer(),f={op:"folder_name",token_id:c,folder_id:d};return a.get("integrations/gdrive?token_id="+c+"&op=folder_name&folder_id="+d,f).success(function(a,b){e.resolve(a)}),e.promise}};return d}]),b.module("convoApp").factory("geotaggingService",["ServerComm","$q",function(a,b){function c(a,b,c){var d,e,f=new google.maps.Geocoder,g={lat:a,lng:b};f.geocode({location:g},function(a,b){return"OK"!==b?(e="Reverse Geocoder failed.",c(e,null)):a[0]?(d=a[0].formatted_address,c(null,d)):(e="No results found",void c(e,null))})}function d(a){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){return a(null,b)},function(b){return a(b,null)})}var e={};return e.getGeolocation=function(a){var b,e={};return navigator.geolocation?void d(function(b,d){return b?a(b,null):(e.lat=d.coords.latitude,e.lng=d.coords.longitude,c(e.lat,e.lng,function(b,c){return c?e.title=c:e.title="",a(null,e)}),void 0)}):(b="Geolocation not supported.",a(b,null))},e}]),b.module("convoApp").factory("gmailService",["ServerComm","$q","onboardingService",function(a,b,c){var d={createGmailIntegration:function(d,e,f,g,h,i,j,k,l){var m=b.defer(),n={account_id:d,creator_id:e,display_name:f,action_type:g,access_level:h,recipients:i,profile_image_info:j,label_id:k,token_id:l};return a.post("integrations/gmail",n).success(function(a,b){m.resolve(a),c.markIntegrationsAsDone("Gmail")}),m.promise},getLabelList:function(c){var d=b.defer(),e={op:"label_list",token_id:c};return a.get("integrations/gmail?op=label_list&token_id="+c,e).success(function(a,b){d.resolve(a)}),d.promise},getUserInfo:function(c){var d=b.defer(),e={op:"token_id",user_id:c,version:"1.1"};return a.get("integrations/gmail?op=token_id&user_id="+c+"&version=1.1",e).success(function(a,b){d.resolve(a)}),d.promise},deleteAuthorization:function(c){var d=(b.defer(),{token_id:c,target:"authorization"});return a.deletex("integrations/gmail",d)},deleteIntegration:function(c){var d=(b.defer(),{webhook_id:c,target:"webhook"});return a.deletex("integrations/gmail",d)},disableIntegration:function(c,d,e){var f=b.defer(),g={webhook_id:c,action:d,modified_by:e};return a.put("webhooks",g).success(function(a,b){f.resolve(a)}),f.promise},getIntegrationDetails:function(c){var d=b.defer(),e={op:"integrations_details",webhook_id:c};return a.get("integrations/gmail?webhook_id="+c+"&op=integrations_details",e).success(function(a,b){d.resolve(a)}),d.promise},updateIntegration:function(c,d,e,f,g,h,i){var j=b.defer(),k={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g,label_id:h,token_id:i};return a.put("integrations/gmail",k).success(function(a,b){j.resolve(a)}),j.promise}};return d}]),b.module("convoApp").factory("groupSettingService",["$window","serverPingService",function(a,b){function d(a){g.push(a)}function e(){var a=!0;return f.member_can_create_groups!=c&&(a=f.member_can_create_groups),a}var f={},g=[];return a.com_convo.sessionData.signInResponseData&&(f=a.com_convo.sessionData.signInResponseData),
b.on("createGroupPermission",function(a){a!==c&&(f.member_can_create_groups=a,g.length&&g.forEach(function(a){a(e())}))}),{canCreateGroup:e,registerCallback:d}}]),b.module("convoApp").factory("hashtagsProvider",["$q","$rootScope","ServerComm","utils",function(a,b,c,d){function e(a){var b="",c=0==a.name.indexOf("#")?a.name:"#"+a.name;return 1===a.stag&&(b="#"+a.linked_tags.replace(/\s+/gi," #")+" "+c),{label:c,formattedlabel:c,users:a.users,tf:a.tf,stag:a.stag,linked_tags:b}}function f(a,d){var e={authToken:b.login_data.xmpp_session_token,userID:b.login_data.user.user_id,accountID:b.login_data.account_id,startingWith:a,tagsLimit:d},f=c.post("tags/get",e);return f}function g(d,e,f){var g=a.defer(),h={authToken:b.login_data.xmpp_session_token,userID:b.login_data.user.user_id,accountID:b.login_data.account_id,startingWith:d||"#",tagsLimit:e||10,timeRange:f||"week"},i=c.post("hashtags/get",h);return i.then(function(a){g.resolve(a)},function(a){g.reject(a)}),g.promise}function h(b,c){if((j||k)&&b===l)return i.promise;l=b;var g=a.defer();i=g;var h=f(b,c||5);return j=!0,k=!1,h.then(function(a){var c=a.data;if(b!=l)return g.reject("Rejecting all previous calls responses. Just entertaining last one.");j=!1,k=!0;var f=[],h=new RegExp("(([\\s,()<>:@#.])|^)("+b+")","gi");for(var i in c)f.push(e(c[i])),f[i].formattedlabel=f[i].label.replace(h,"$1b1%b1_1$3b2%b2_2"),f[i].id=d.generateHash(f[i].label);g.resolve(f)},function(a){j=!1,k=!1,g.reject(a)}),g.promise}function g(d,e,f){var g=a.defer(),h={authToken:b.login_data.xmpp_session_token,userID:b.login_data.user.user_id,accountID:b.login_data.account_id,startingWith:d||"#",tagsLimit:e||10,timeRange:f||"week"},i=c.post("hashtags/get",h);return i.then(function(a){g.resolve(a)},function(a){g.reject(a)}),g.promise}var i,j,k,l;return{getHashtagsDropdownItems:h,getTrendingHashtags:g}}]),b.module("convoApp").factory("importCSVContacts",["Users","accountInfo","utils","delimitedTextParser",function(a,b,c,d){function e(c){for(var d=a.getUsersLowerCaseEmailsMap(),e=b.getAccountDomains(),f=[],g=0,h=c.length;h>g;++g)if(!d[c[g].email])for(var i=0,j=e.length;j>i;i++)c[g].email.match(new RegExp(e[i].user_email_domain+"$"))&&(c[g].isChecked=!0,f.push(c[g]));return f}function f(a){var b=d.parseDelimitedText(a);return b=g(b),h(b)}function g(a){var b,d=[],e={name:0,"given name":0,"additional name":0,"family name":0,"first name":0,"middle name":0,"last name":0},f={email:0,"e-mail":0,"e-mail 1 - value":0,"e-mail 2 - value":0,"e-mail address":0,"e-mail 2 address":0,"e-mail 3 address":0},g=["email","e-mail","e-mail 1 - value","e-mail 2 - value","e-mail address","e-mail 2 address","e-mail 3 address"],h=!1,i=!1,j=!1,k=a[0],l=0;for(l=0;l<k.length;l++)b=String(k[l]).toLowerCase(),b in e?(e[b]={idx:l},i=!0):b in f&&(f[b]={idx:l},j=!0);if(h=i&&j)for(l=1;l<a.length;l++){for(var m=null,n=null,o=null,p=a[l],q=0;l<g.length;q++)if(f[g[q]]){var r=p[f[g[q]].idx].trim();if(c.isValidEmail(r)){m=r;break}}if(null!=m){var s="";if(e.name?(s=p[e.name.idx].trim(),0==s.length&&(e["given name"]&&(s+=p[e["given name"].idx].trim()+" "),e["additional name"]&&(s+=p[e["additional name"].idx].trim()+" "),e["family name"]&&(s+=p[e["family name"].idx].trim()),s=s.trim())):(e["first name"]&&(s+=p[e["first name"].idx].trim()+" "),e["middle name"]&&(s+=p[e["middle name"].idx].trim()+" "),e["last name"]&&(s+=p[e["last name"].idx].trim()),s=s.trim()),s.replace(/ {2,}/g," "),s.length>0){var t=s.indexOf(" ");-1==t?n=s:(n=s.substring(0,t),o=s.substr(t+1))}d.push({email:m,fname:n,lname:o})}}else{var u=-1;for(l=0;l<a.length;l++){var v=null,w=!0;if(-1!=u&&c.isValidEmail(a[l][u])&&(v=a[l][u],w=!1),w){var x;x=1==a[l].length?a[l].length:a[l].length-1;for(var q=0;x>q;q++)if(a[l][q]&&c.isValidEmail(a[l][q].trim())){v=a[l][q].trim(),u=q;break}}null!=v&&d.push({email:v,fname:null,lname:null})}}return d}function h(a){a.sort(i);for(var b=[],c=0;c<a.length;c++)a[c+1]?a[c+1].email!=a[c].email&&b.push(a[c]):b.push(a[c]);return b}function i(a,b){var c=a.email.toLocaleLowerCase(),d=b.email.toLocaleLowerCase();return d>c?-1:c>d?1:0}var j={};return j.filter=e,j.csvFileLoadingCompleteHandler=f,j}]),b.module("convoApp").factory("importGoogleContacts",["accountInfo","Users",function(b,c){function d(){return a.open("/app/contacts/ImportGmailContacts.php","_blank","left=400, top=100,width=500, height=500")}var e={};return _.extend(e,Backbone.Events),e.find=d,a.sendContactsToFlexApp=function(a){e.trigger("contactsReceivedFromGmail",JSON.parse(JSON.stringify(a)))},e}]),b.module("convoApp").factory("importMacContacts",["ServerComm","$q","config","nativeCommBridge","accountInfo","utils","alertsService","Contacts",function(a,b,c,d,e,f,g,h){function i(){var a=b.defer();if(c.IS_NATIVE){var g=d.importMacContacts(function(b,c){var d={};try{var e=JSON.parse(c);"result"===e.type?(d.status="success",d.contacts=e.contacts):d.status="error"}catch(f){d={status:"exception"}}finally{a.resolve({data:d})}});-1===g&&a.resolve({data:{status:"exception"}})}else{var h=e.getPrimaryAccountDomain().user_email_domain;setTimeout(function(){var b={};b.status="success",b.contacts=[],b.contacts.push({label:"Test Name 1",email:"testname1"+h,imgUrl:"xyz",id:f.generateHash("testname1@iscrybe.com")}),a.resolve({data:b})},1)}return a.promise}function j(a){if(m=a,k("display_import_users_nag")){var b=function(){setTimeout(function(){l("Prompt")},5e3)};c.IS_MAC?b():c.on("clientTypeUpdated",function(){c.IS_MAC&&b()})}}function k(a){return m[a]}function l(a){var b="common/cnvInviteTeammates/templates/cnvFindTeammatesBasicSplash.tpl.html",c="findContactsSplashCtrl",d={data:function(){return{include_off_domain:!1,origin:a}}},e=g.customModal(b,c,d);e.result.then(function(a){h.initContactsInviteModal({master_list:a.contacts,include_off_domain:!1,invite_via:"Invite_Dialog"})},function(a){if(a.hasOwnProperty("promise"))a.promise.then(function(a){h.initContactsInviteModal({master_list:a.contacts,include_off_domain:!1,invite_via:"Invite_Dialog"})},function(){alert("There seems to be an error reaching server. Please try again!")});else if(a.hasOwnProperty("error"))if("permission_denied"===a.error){var b="common/cnvInviteTeammates/templates/cnvFindContactsPermissionDenied.tpl.html",c="findContactsPermissionDenied",d="find-contacts-permission-denied",e={data:function(){return{}}};g.customModal(b,c,e,d).result.then(function(){},function(){})}else"no_contacts_found"===a.error?h.initContactsInviteModal({master_list:[],include_off_domain:!1,invite_via:"Invite_Dialog"}):"exception"===a.error?console.error("Exception occurs while reading contacts from native."):alert("There seems to be an error reaching server. Please try again!")})}_.extend(self,Backbone.Events);var m={};return self.initContactsInviteModal=l,self.setProperties=j,self.getProperties=k,self["import"]=i,self}]),b.module("convoApp").factory("itemService",["ServerComm","$q","ItemsConstants","mixpanelService","rtcNotificationManager","$rootScope",function(a,b,c,d,e,f){function h(){e.addListener(g.rtc.PubsubEvents.NOTIFICATION_RECEIVE,function(a){var b=a.notification;b.type==c.ITEM_PERMISSION_CHANGED&&y.trigger("itemPermissionChangedByRemoteUser")})}function i(c,d){var e={method:"star",app_instance_id:c,resource_id:d},f=a.post("items",e),g=b.defer();return f.success(function(a,b){g.resolve(a),y.trigger("itemStarred")}),g.promise}function j(c,d){var e={method:"unstar",app_instance_id:c,resource_id:d},f=a.post("items",e),g=b.defer();return f.success(function(a,b){g.resolve(a),y.trigger("itemUnstarred")}),g.promise}function k(e,f){var g={method:"moveToTrash",app_instance_id:e,resource_id:f},h=a.post("items",g),i=b.defer();return h.success(function(a,b){i.resolve(a),y.trigger("itemMovedToTrash");var g={type:c.ITEM_MOVED_TO_TRASH,itemId:f,data:null};r(e,f,g),d.trackEvent(d.DELETED_POST)}),i.promise}function l(d,e){var f={method:"restore",app_instance_id:d,resource_id:e},g=a.post("items",f),h=b.defer();return g.success(function(a,b){h.resolve(a),y.trigger("itemRestored");var f={type:c.ITEM_RESTORED,itemId:e,data:null};r(d,e,f)}),h.promise}function m(d,e){var f={method:"deletePermanently",app_instance_id:d,resource_id:e},g=a.post("items",f),h=b.defer();return g.success(function(a,b){h.resolve(a),y.trigger("itemDeletedPermanently");var f={type:c.ITEM_DELETED_PERMANENTLY,itemId:e,data:null};r(d,e,f)}),h.promise}function n(d,e,f,g){var h={method:"updateSharingInfo",sharing_info:e};d?h.feed_id=d:(h.app_instance_id=f,h.resource_id=g);var i=a.post("items",h),j=b.defer();return i.success(function(a,b){j.resolve(a),y.trigger("itemSharingInfoUpdated");var d={type:c.ITEM_SHARING_INFO_UPDATED,itemId:g,data:e};r(f,g,d)}),j.promise}function o(d,e,f,g){var h={method:"updateTags",tags:e};d?h.feed_id=d:(h.app_instance_id=f,h.resource_id=g);var i=a.post("items",h),j=b.defer();return i.success(function(a,b){j.resolve(a),y.trigger("itemTagsUpdated");var d={type:c.ITEM_TAGS_UPDATED,itemId:g,data:e};r(f,g,d)}),j.promise}function p(c,d){var e={method:"mute",app_instance_id:c,resource_id:d},f=a.post("items",e),g=b.defer();return f.success(function(a,b){g.resolve(a)}),g.promise}function q(c,d){var e={method:"unmute",app_instance_id:c,resource_id:d},f=a.post("items",e),g=b.defer();return f.success(function(a,b){g.resolve(a)}),g.promise}function r(a,b,c){var d=g.rtc.RTCFactory.getRTCManager(a+"_"+b),e=function(){d.removeListener(g.chatsdk.ChatEvents.CONNECTED,e),d.sendChange(c),g.rtc.RTCFactory.releaseRTCManager(a+"_"+b),console.log(">>> sendItemChangeRTCNotification.onConnected: "+JSON.stringify(c))};d.isConnected()?e():(d.addListener(g.chatsdk.ChatEvents.CONNECTED,e),d.connect())}function s(d,e,f){var g={method:"changePermissions",app_instance_id:e,resource_id:f,permissions:d},h=a.post("items",g),i=b.defer();return h.success(function(a,b){y.trigger("itemPermissionChanged"),i.resolve(a);var d={resource_id:a.data.item_id,changed_by:a.data.item.permissions_changed_by,change_date:a.data.item.permissions_change_date,permissions:a.data.item.permissions},g={type:c.ITEM_PERMISSION_CHANGED,itemId:f,data:d};r(e,f,g)}),i.promise}function t(b,c){var d="?item_id="+b;return c&&(d+="&timestamp="+c),a.getx("notes"+d)}function u(c,d,e,g,h,i,j,k,l,m,n,o,p){var q=b.defer(),r=i&&i.length>0,s={body:g,title:d,user_set_title:d?"1":"0",is_text_only:r?"0":"1",item_id:c,cleanText:!0,draft:j+"",tags:l||"",mappings:h,auto_save:m,permissions:n};return o&&(s.location=o),p||(s.convert_files=!1),k&&(s.revision_no=+k),r&&(s.files=JSON.stringify(i)),a.putx("notes",s).then(function(a){q.resolve(a.data),f.$broadcast("Note:newNoteCreated")},function(a){q.reject(a)}),q.promise}function v(a,b){var c=new URI(b),d=new URI(a);return d=d.resolve(c),d.toString()}function w(b){var c={method:"resolveLink",url:b};return a.post("link2",c)}function x(c,d,e,g,h,i,j,k,l){var m=null,n=b.defer();d.images_urls.length&&(m=v(d.images_urls[e],c));var o={method:"shareLink",url:c,mappings:JSON.stringify(h),image_url:m,auto_image:0,title:d.title,preview_text:d.preview_text,comment:g,draft:i,tags:j,permissions:l};return k&&(o.revision_no=k),a.postx("link2",o).then(function(a){200==a.status&&a.data?(n.resolve(a),f.$broadcast("Link:newLinkCreated")):n.reject(a)},function(a){n.reject(a)}),n.promise}var y={};return _.extend(y,Backbone.Events),h(),y.canEdit=7,y.canComment=3,y.canView=1,y.starPost=i,y.unStarPost=j,y.moveToTrash=k,y.restorePost=l,y.updateSharingInfo=n,y.updateTags=o,y.mutePost=p,y.unmutePost=q,y.deletePermanently=m,y.changePermissions=s,y.getNote=t,y.createNote=u,y.getLink=w,y.createLink=x,y}]),b.module("convoApp").factory("linksAppDataProvider",["$q","Link","userInfo","usersGroupsListProvider","hashtagsProvider","utils","FilterTypes","UserProfileImage","userImgUrlFilter","itemService","User","Group","Users",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(c){var d=a.defer();return b.getLinkDetails(c).success(function(a){d.resolve(o(a.data))}),d.promise}function o(a){y.length=0,r(a.users),q(a.groups),a.sharing_info=a.mappings["mappings_"+a.item_id],a.sharedWithListItems=[];for(var b in a.sharing_info){var c=v(a.sharing_info[b].published_to);c?a.sharedWithListItems.push(c):console.error("Sharing Info doesn't exist in linksAppDataProvider")}return a.item.created_by_object=v(a.item.created_by),a.item.draft=+a.item.draft,a.item.muted=+a.item.muted,a.item.starred=+a.item.starred,a.item.logged_in_user_permissions.checkBitAt(3)||(a.itemSharingInfoWithDropdownItems=p(a.item.created_by,a.sharing_info)),a}function p(a,b){var c=[],e=t(a);c.push(d.createUserListItem(_.extend({user_id:a,name:e.label,email:""},e)));for(var f=0,h=b.length;h>f;f++){var i=b[f];if(i.type===g.USER&&i.published_to!==a){var e=t(i.published_to);c.push(d.createUserListItem(_.extend({user_id:i.published_to,name:e.label,email:""},e)))}else if(i.type===g.GROUP){var j=s(i.published_to);c.push(d.createGroupListItem(new l(_.extend({id:i.published_to,title:j.label},j))))}}return c}function q(a){x.length=0;for(var b in a){var c=a[b].title;x.push({id:a[b].group_id,type:g.GROUP,label:c,accessible:a[b].accessible,access:a[b].access,formattedlabel:c,desclabel:"Group",formatteddesclabel:"Group",grouptype:a[b].type,createdby:a[b].created_by,classes:"group "+a[b].access.toLowerCase(),readonly:!0,imgurl:""})}y.push(x)}function r(a){w.length=0;for(var b in a)w.push({id:b,type:g.USER,label:a[b].name,accessible:a[b].accessible,formattedlabel:a[b].name,desclabel:a[b].name,formatteddesclabel:a[b].name,profile_image_type:a[b].profile_image_type,profile_image_version:a[b].profile_image_version,classes:"user",readonly:!0,imgurl:m.getUserImage(a[b],h.PROFILE_IMAGE_SIZE_64x64)});y.push(w)}function s(a){for(var b in x)if(x[b].id==a)return x[b];return null}function t(a){for(var b in w)if(w[b].id==a)return w[b];return null}function u(a){for(var b=0,c=y.length;c>b;b++)for(var d=0,e=y[b].length;e>d;d++)if(y[b][d].id==a)return y[b][d].label;return"Unknown"}function v(a){for(var b=0,c=y.length;c>b;b++)for(var d=0,e=y[b].length;e>d;d++)if(y[b][d].id==a)return y[b][d];return null}var w=[],x=[],y=[];c.getUserId();return{getLinkData:n,renderLinkDataResponse:o,getNameById:u,getItem:v,getGroup:s,getUser:t}}]),b.module("convoApp").factory("linksClickHistory",function(){function a(a,b){a||(a=""),b||(b=""),d[0]={href:a,classList:b}}function b(){var a=null;return d.length>0&&(a=d[0],d=[]),a}var c={},d=[];return c.push=a,c.pop=b,c}),b.module("convoApp").factory("localStore",["accountInfo","userInfo","logger",function(a,b,c){function d(c,d){var e;return d||(d=m),d==k?(e=o+"."+a.getAccountId()+"."+b.getUserId(),e+="."+c):d==j?(e=o,e+="."+c):d==l&&(e=c),e}function e(a){return d(a,j)}function f(a,b){var e,f;try{e=localStorage.getItem(d(a,b))}catch(g){c.logLocally_errorOnServer("localStore.readData: localStorage.getItem error: "+g.message),e=null}if(e)try{f=JSON.parse(e)}catch(g){c.logLocally_errorOnServer("localStore.readData: JSON.parse error: "+g.message),f=null}return f}function g(a,b,e,f){var g=d(a,f);e||(e=n);var h={version:e,data:b};try{return localStorage.setItem(g,JSON.stringify(h)),!0}catch(i){return c.logLocally_errorOnServer("localStore.writeData: localStorage.setItem error: "+i.message),!1}}function h(a,b){var e=d(a,b);try{localStorage.removeItem(e)}catch(f){c.logLocally_errorOnServer("localStore.clearData: localStorage.removeItem error: "+f.message)}}function i(){try{localStorage.clear()}catch(a){c.logLocally_errorOnServer("localStore.clear: localStorage.clear error: "+a.message)}}var j=1,k=2,l=3,m=k,n=1,o="com.convo";return{KEY_TYPE_APP:j,KEY_TYPE_USER:k,readData:f,writeData:g,clearData:h,readDataGlobal:function(a){return f(a,l)},writeDataGlobal:function(a,b,c){return g(a,b,c,l)},clearDataGlobal:function(a){return h(a,l)},clear:i,getAppPrefixedKey:e}}]),b.module("convoApp").factory("logger",["ServerComm","$window","$exceptionDispatcher",function(a,d,e){function f(a,b){d.console[v[b]](a)}function g(a,b,d){if(f(a,b),b>=w||d||x){var e=" "+a;m!==c&&(e=" - TabId: "+m+": "+e),y.log(e,b,u[b])}}function h(a){f(a,o);var b=" "+a;m!==c&&(b=" - TabId: "+m+": "+b),y.log(b,s,u[s])}function i(a,b){var d=" "+a;m!==c&&(d=" - TabId: "+m+": "+d),y.log(d,b,u[b])}function j(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function k(a,b,c,d,e){var f;return f=e instanceof Error?j(e):a+"\n"+b+":"+c+":"+d}function l(a,b){var c=j(a);b&&(c+="\nCause: "+b),g(c,s)}var m,n={},o=0,p=1,q=2,r=3,s=4,t={LOG:o,DEBUG:p,INFO:q,WARN:r,ERROR:s},u={0:"LOG",1:"DEBUG",2:"INFO",3:"WARN",4:"ERROR"},v={0:"log",1:"debug",2:"info",3:"warn",4:"error"},w=4,x=!1,y={_buffer:[],_bufferSize:200,_flushInterval:6e3,_flushRetryInterval:3e3,_flushTimeoutID:-1,_logsPostPending:!1,_pendingLogsPostCount:0,_initialized:!1,log:function(a,b,c){if(!d.__2FA_APP_LOADED){var e=y;e._initialized||(e._flushTimeoutID=setTimeout(e._flush,e._flushInterval),e._initialized=!0),e._buffer.push({message:a,level:c,client_log_time:Date.now()})}},flush:function(){var a=y;a._initialized&&!a._logsPostPending&&0!==a._buffer.length&&(clearTimeout(a._flushTimeoutID),a._flush())},_flush:function(){var b=y;if(0!==b._buffer.length){b._buffer.length>b._bufferSize&&b._buffer.splice(0,b._buffer.length-b._bufferSize),b._pendingLogsPostCount=b._buffer.length,b._logsPostPending=!0;var d={appType:"WEB_APP",logs:b._buffer};a.postr("log",d,b._onLogsPostSuccess,b._onLogsPostError,c,!0)}},_onLogsPostSuccess:function(){var a=y;a._logsPostPending=!1,a._buffer.splice(0,a._pendingLogsPostCount),a._buffer.length>0?a._flushTimeoutID=setTimeout(a._flush,a._flushInterval):a._initialized=!1},_onLogsPostError:function(){var a=y;a._logsPostPending=!1,a._flushTimeoutID=setTimeout(a._flush,a._flushRetryInterval)}},z=d.onerror;return d.onerror=function(a,b,c,d,e){z&&z.apply(this,arguments),g(k(a,b,c,d,e),s)},e.on("exception",l),n.log=function(a,b){g(a,o,b)},n.debug=function(a){g(a,p)},n.info=function(a){g(a,q)},n.warn=function(a){g(a,r)},n.error=function(a){g(a,s)},n.logToServer=function(a,b){b===c&&(b=o),i(a,b)},n.logLocally_errorOnServer=h,n.flush=y.flush,n.sendAllLogsToServer=function(){x=!0},n.setClientInstanceId=function(a){m=a},b.extend(n,t),n}]).factory("$exceptionHandler",["$exceptionDispatcher",function(a){return function(b,c){a.trigger("exception",b,c)}}]).factory("$exceptionDispatcher",[function(){var a={};return _.extend(a,Backbone.Events),a}]),b.module("convoApp").factory("mentionsHistory",["localStore",function(a){function b(){if(!j){var b=a.readData(g);f=b&&b.version==h?b.data:[],j=!0}}function c(){a.writeData(g,f,h)}function d(a,d){b();for(var e=!1,g=0;g<f.length;g++)if(f[g].type==a&&f[g].id==d){e=!0;break}if(e){if(g>0){var h=f[g];f.splice(g,1),f.unshift(h),c()}}else{var j=f.unshift({type:a,id:d});j>i&&(f=f.slice(0,i)),c()}}function e(){return b(),f}var f,g="mentionsHistory",h=1,i=5,j=!1;return{addItemToHistory:d,getHistory:e}}]),b.module("convoApp").factory("mixpanelService",["ServerComm","$rootScope",function(a,b){function c(a){j.push(a)}function d(a){j.splice(0,a)}function e(a,d,e,g,i){if(d=d||{},b.attachMixpanelSuperProperties&&b.attachMixpanelSuperProperties(d),e)h(a,d,g,i);else{var j={action:"track",params:{event_name:a,event_properties:d}};c(j),f()}}function f(){k||l||!j.length||(k=setTimeout(function(){clearTimeout(k),k=null,g()},i))}function g(){var b=j.slice(),c=b.length,e={action:"batch",tasks:b};l=!0,a.postr("mixpanel",e,function(){l=!1,d(c),f()},function(){l=!1,f()})}function h(b,c,d,e){var f={action:"track",event_name:b,event_properties:c};a.postr("mixpanel",f,d,e)}var i=5e3,j=[],k=null,l=!1,m={};return m.CLICK_ON_INVITE_FROM_NEWSFEED="Click On Invite From Newsfeed",m.OPEN_EXTERNAL_LINK_IN_CHAT="Open External Link In Chat",m.OPEN_AUTO_GEN_WELCOME_FILE="Open Auto Gen Welcome File",m.USER_FILTERED_BY_POST_TYPE="User Filtered By Post Type",m.CLICK_DONE_IN_POST_VIEWER="Click Done In Post Viewer",m.CLICK_NAVIGATION_CENTER="Click Navigation Center",m.OPEN_CONVO_LINK_IN_CHAT="Open Convo Link In Chat",m.SCROLLED_IMAGE_GALLERY="Scrolled Image Gallery",m.CLICK_MARK_ALL_AS_READ="Click 'Mark All As Read'",m.NAVIGATED_ATTACHMENTS="Navigated Attachments",m.USER_FILTERED_SEARCH="User Filtered Search",m.SEARCH_FOR_TEAMMATES="Search For Teammates",m.ANNOTATION_PLAYBACK="Annotation Playback",m.RETRY_A_FAILED_CHAT="Retry A Failed Chat",m.CLICK_MINIMIZE_POST="Click Minimize Post",m.ADDED_TITLE_TO_POST="Added Title To Post",m.CLICK_IN_LEFT_MENU="Click In Left Menu",m.DELETED_ATTACHMENT="Deleted Attachment",m.ADDED_TAGS_TO_POST="Added Tags To Post",m.CHATS_SEND_MESSAGE="Chats Send Message",m.UPLOAD_GROUP_CHAT_PHOTO="Upload Group Chat Photo",m.UPDATE_GROUP_CHAT_NAME="Update Group Chat Name",m.CLICK_GROUP_CHAT_BUTTON="Click Group Chat Button",m.CLICK_BACK_TO_POST="Click Back To Post",m.CLICK_DOWNLOAD_ALL="Click Download All",m.CLICK_EXPAND_POST="Click Expand Post",m.SEARCH_FOR_CHATS="Search For Chats",m.CLICK_HIDE_PANEL="Click Hide Panel",m.OPEN_CHATS_LIST="Open Chats List",m.CLICK_EDIT_POST="Click Edit Post",m.TAP_ON_TEAMMATE="Tap On Teammate",m.EXPAND_COMMENTS="Expand Comments",m.HIDE_COMMENTS="Hide Comments",m.STARRED_POST="Starred Post",m.DELETED_POST="Deleted Post",m.VIEW_THREAD="View Thread",m.TAP_ON_CHAT="Tap On Chat",m.OPENED_POST="Opened Post",m.ANNOTATED="Annotated",m.CLICK_IMPORT_CONTACTS="Click Import Contacts",m.IMPORT_CONTACTS="Import Contacts",m.INVITE_SENT="Invite Sent",m.DISMISS_IMPORT_PROMPT="Dismiss Import Prompt",m.COPY_INVITE_LINK="Copy invite link",m.INVITE_LINK_CLICKS="Invite link clicks",m.TRY_ANOTHER_CLICKED='Click "Try another" On Welcome Gif Post',m.Edit_Welcome_Gif_Post="Edit Welcome Gif Post",m.Share_Welcome_Gif_Post="Share Welcome Gif Post",m.Click_Add_Profile_Photo_Tooltip="Click Add Profile Photo Tooltip",m.Clicked_Download_Dekstop_App="Clicked Download Dekstop App",m.Clicked_Download_iOS_App="Clicked Download iOS App",m.Clicked_Download_Android_App="Clicked Download Android App",m.Edited_Recipients_On_First_Compose_Click="Edited Recipients On First Compose Click",m.Upload_Profile_Pic="Upload Profile Pic",m.CLICK_GIF_BUTTON="Click GIF Button",m.SEND_GIF="Send GIF",m.SEARCH_FOR_GIF="Search For GIF",m.CLICK_EMOJI_BUTTON="Click Emoji Button",m.SEND_EMOJI="Send Emoji",m.SEARCH_EMOJI="Search Emoji",m.Enter_Emoji_Shortcut="Enter Emoji Shortcut",m.GETTING_STARTED_STEP_LAUNCH="Getting Started Step Launch",m.X_OUT_GETTING_STARTED="X Out Getting Started",m.ADD_INTEGRATION="Add Integration",m.SENT_VIDEO_CALL="Sent Video Call",m.CLICKED_VIDEO_CALL="Clicked Video Call",m.SIGN_OUT_CLICK="Sign Out Click",m.SWITCHED_TO_COMPACT_VIEW="Switched To Compact View",m.SWITCHED_TO_DEFAULT_VIEW="Switched To Default View",m.EXITS_AD_IN_BROWSER="Exits Ad In Browser",m.CLICK_DOWNLOAD_APP="Click Download App",m.CLICKED_PLAY="Clicked Play",m.CLICKED_PAUSE="Clicked Pause",m.WATCHED_TO_END="Watched To End",m.DOWNLOAD_VIDEOS="Downloaded Videos",m.WATCHED_1080="Watched 1080p (Full HD Video)",m.WATCHED_720="Watched 720p (HD Video)",m.WATCHED_480="Watched 480p (SD Video)",m.CLICK_ADD_INTEGRATION="Click Add Integration",m.ADDED_INTEGRATION="Added Integration",m.USER_REMOVED_INTEGRATION="User Removed Integration",m.BROWSE_INTEGRATIONS="Clicked Browse Integration",m.SEARCH_INTEGRATIONS="Searched Integrations",m.CLICK_SEND="Click Send",m.VIEW_REVISIONS_HISTORY="View Revision History",m.SHOW_REVISION_CHANGES="Show Revision Changes",m.ADMIN_MODE_CLICK_IN_LEFT_PANEL="AdminMode: Click in Left Panel",m.CLICK_ON_NETWORK_SETTINGS="Click On Network Settings",m.CLICK_ON_GET_APPS_MENU_ITEM="Click On Get Apps Menu Item",m.CLICK_ON_GET_SHAREABLE_LINK_MENU_ITEM="Click On Get Shareable Invite Link Menu Item",m.CLICK_ON_CONTACT_SUPPORT_MENU_ITEM="Click On Contact Support Menu Item",m.FILTER_ON_INVITED="Filter on invited",m.FILTER_ON_IMPORTED="Filter on imported",m.PERF__LOGIN_CLICK_TO_APP_LOAD_COMPLETE="Perf Login To App Load",m.PERF__LOGIN_CLICK_TO_FEED_RENDER_START="Perf Login To Feed Render Start",m.PERF__LOGIN_CLICK_TO_APP_LOAD_COMPLETE__FIRST_LOAD="Perf Login To App Load (First Load)",m.PERF__LOGIN_CLICK_TO_FEED_RENDER_START__FIRST_LOAD="Perf Login To Feed Render Start (First Load)",m.CLICK_WHATS_NEW_MENU_ITEM="Click Whats New Menu Item",m.CLICK_WHATS_NEW_TOOL_TIP="Click Whats New Tool Tip",m.CLICK_WHATS_NEW_LEFT_COLUMN="Click Whats New Left Column",m.CLICK_APP_UPDATE_BANNER_RELOAD="Click App Update Banner Reload",m.DISMISS_APP_UPDATE_BANNER="Dismiss App Update Banner",m.trackEvent=e,m}]),b.module("convoApp").factory("nativeCommBridge",["$window","AppLinks","config","$rootScope","chatManager","InAppNotifications","ServerComm","appTabs","mixpanelService","appStateInfo","nativeCommBridgeCDPreventer","logger",function(b,c,d,e,f,h,i,j,k,l,m,n){function o(a,b){n.log("NATIVE_COMM_BRIDGE:: calling func: "+a);var c=null;if("object"==typeof convo)c=convo;else{if("object"!=typeof brackets)return-1;c=brackets.app}try{return c[a](b,q)}catch(d){return-1}}function p(a){var b=null;if("object"==typeof convo)b=convo;else{if("object"!=typeof brackets)return-1;b=brackets.app}try{return b[a]()}catch(c){return-1}}function q(a){console.log(a)}function r(a,b,c){b=b||"",c=c||512;for(var d=atob(a),e=[],f=0;f<d.length;f+=c){for(var g=d.slice(f,f+c),h=new Array(g.length),i=0;i<g.length;i++)h[i]=g.charCodeAt(i);var j=new Uint8Array(h);e.push(j)}var k=new Blob(e,{type:b});return k}function s(){var a=h.getSharedNotificationsContext().unreadNotificationsCount||0,b=f.getUnreadChatsCount()||0;d.IS_NATIVE&&t.updateNotificationsCount(parseInt(a)+parseInt(b))}var t={};_.extend(t,Backbone.Events),t.initialized=!1,t.initializeApp=function(){return"object"!=typeof convo&&"object"!=typeof brackets||d.IS_MENULET||(d.IS_NATIVE=!0,d.setClientType()),d.IS_NATIVE&&(l.on("appSwitchedToCompactView",t.switchedToCompactView),l.on("appSwitchedToNormalView",t.switchedToFullView)),o("initializeApp")},t.deliverNotification=function(a){return o("deliverNotification",a)},t.getImageFromClipboard=function(a){return o("getImageFromClipboard",a)},t.isNativeAppActive=function(){return o("isAppActive")},t.signIn=function(a){return o("signIn",a)},t.updateHeight=function(a){return o("updateHeight",a)},t.setGeneralSettings=function(a){return o("setGeneralSettings",a)},t.loadApp=function(a){return o("loadApp")},t.logoutApp=function(){return o("logout")},t.locationChanged=function(a){return o("locationChanged",a)},t.postShared=function(){return o("postShared")},t.updateNotificationsCount=function(a){return o("updateNotificationsCount",a)},t.saveDataInClipboard=function(a){return o("saveDataInClipboard",a)},t.refreshMenulet=function(a){return o("refreshMenulet",a)},t.overlayStatus=function(a){return o("overlayStatus",a)},t.terminateApp=function(a){return o("terminateApp",a)},t.noteAppActivated=function(a){return o("noteAppActivated",a)},t.importMacContacts=function(a){return o("importMacContacts",a)},t.whiteListUrls=function(a){return o("whiteListUrls",a)},t.copyToClipboard=function(a){return o("copyToClipboard",a)},t.newClick=function(a){if(0==a)d={is_home:!0},o("newClick",JSON.stringify(d));else{var b=c.parseUrl(a),d={url:a};if("object"!=typeof b||b.type!==c.ACTION_LINK&&b.type!==c.FILTER_LINK){if(b&&b.type===c.RESOURCE_LINK){d.is_home=!1,d.title=b.title;var e=b.resourcePath.appInstance.uid,f=b.type,g=b.resourcePath.hierarchy[0].uid;d.id=e+"_"+f+"_"+g,o("newClick",JSON.stringify(d))}}else d.is_home=!0,d.title=b.title,o("newClick",JSON.stringify(d))}},t.switchedToCompactView=function(){o("switchedToCompactView")},t.switchedToFullView=function(){o("switchedToFullView")},t.isNativeSystemActive=function(){return o("isSystemActive")},t.openInDefaultBrowser=function(a){o("openInDefaultBrowser",a)},m.setNativeCommBridgeJSToNativeCallbackWithoutArgs(p),m.setNativeCommBridgeJSToNativeCallback(o),m.setNativeSystemActiveCallback("isSystemActive"),t.initialize=function(a){switch(a){case 1:d.IS_MENULET=1,d.setClientType();break;case 2:d.IS_MAC=!0,d.IS_NATIVE=1,d.setClientType();break;case 3:d.IS_WINDOWS=!0,d.IS_NATIVE=!0,d.setClientType();break;case 4:d.IS_MENULET=2,d.setClientType();break;case 5:d.IS_MAC=!0,d.IS_NATIVE=2,d.setClientType()}this.initialized=!0,nativeCommBridge.signIn(JSON.stringify(e.login_data)),nativeCommBridge.whiteListUrls(d.WHITELIST_URLS_REGEX)},t.distruct=function(a){d.IS_NATIVE=!1,d.IS_MENULET=!1},t.logout=function(a){t.trigger("logout",a)},t.nativeAppClosing=function(b){var c=new Event("unload");a.dispatchEvent(c),setTimeout(function(){t.terminateApp()},500)},t.onDesktopNotificationClick=function(a){t.trigger("onDesktopNotificationClick",a)},t.onDesktopNotificationRemove=function(a){t.trigger("onDesktopNotificationClose",a)},t.onDummyTextAreaClick=function(a){t.trigger("onDummyTextAreaClick",a)},t.forcePoll=function(a){e.$broadcast("pollFeedRequest",!1,"FORCE: NATIVE"),t.trigger("newPostShared")},t.newPostClick=function(a){t.trigger("newPostClick",a)},t.shareClick=function(a){t.trigger("shareClick",a)},t.pasteFromClipboard=function(a){t.trigger("pasteFromClipboard",a)},t.logoutMenulet=function(a){t.trigger("logoutMenulet",a)},t.updateGeneralSettings=function(a){t.trigger("updateGeneralSettings",a)},t.focusMenulet=function(a){t.trigger("focusMenulet",a)},t.getState=function(a){},t.downloadCurrentFile=function(a){t.trigger("downloadCurrentFile",a)},t.isAppActive=function(b){1==b?(ifvisible.focus(),a.focus()):0==b&&(ifvisible.blur(),a.blur())},t.systemActive=function(){t.trigger("nativeSystemActivated"),m.trigger("nativeSystemActivated")},t.systemIdle=function(){t.trigger("nativeSystemIdled"),m.trigger("nativeSystemIdled")},t.getCompactAppWidthWithState=function(){var b=l.getScaledCompactWidth(),c=l.isAppInCompactView(),d=JSON.stringify({compactWidth:b,isCompactState:c}),e={windowOuterWidth:a.outerWidth,windowInnerWidth:a.innerWidth,compactWidth:b,isCompactView:c,responseJson:d};return o("compactAppWidthWithStateCallback",d),e},t.switchedToCompactSize=function(){k.trackEvent(k.SWITCHED_TO_COMPACT_VIEW),t.trigger("nativeCommBridge::switchedToCompactSize")},t.switchedToDefaultSize=function(){k.trackEvent(k.SWITCHED_TO_DEFAULT_VIEW),t.trigger("nativeCommBridge::switchedToDefaultSize")},t.getImageFromClipboardCallback=function(a,b){var c=r(b,"image/png");$(a).trigger("macPaste",c)},t.magnifyEvent=function(a,b,c){t.trigger("nativeCommBridge::magnifyEvent",{magnification:a,locationInWindow:{x:b,y:c}})},t.logToServer=function(a,b){n.logToServer(a,b)},h.on("unreadNotificationsCountChanged",s),f.addListener(g.chatsdk.ChatEvents.CHATS_UNREAD_COUNT_CHANGED,s);var u=!1,v=!1;return i.on("firstFeedFetchCallResolved",function(){v=!0,1==u&&j.dispatchTabsEvent2("mainAppFeedFetched")}),j.addTabsEventListener2("isAppFeedFetched",function(){u=!0,1==v&&j.dispatchTabsEvent2("mainAppFeedFetched")}),b.nativeCommBridge=t,t}]),b.module("convoApp").factory("nativeCommBridgeCDPreventer",[function(){function a(a){f.nativeCommBridgeJSToNativeCallbackHandler=a}function b(a){f.nativeCommBridgeJSToNativeCallbackHandlerWithoutArgs=a}function c(a){f.isNativeSystemActiveCallback=a}function d(){return"function"==typeof f.nativeCommBridgeJSToNativeCallbackHandlerWithoutArgs&&"string"==typeof f.isNativeSystemActiveCallback?f.nativeCommBridgeJSToNativeCallbackHandlerWithoutArgs(f.isNativeSystemActiveCallback):void 0}var e={};_.extend(e,Backbone.Events);var f={};return e.setNativeCommBridgeJSToNativeCallback=a,e.setNativeCommBridgeJSToNativeCallbackWithoutArgs=b,e.setNativeSystemActiveCallback=c,e.isNativeSystemActive=d,e}]),b.module("convoApp").factory("nativeHeightUpdate",["nativeCommBridge",function(a){function b(){return $("#mainApp").height()}function c(){var c=b();c!=e&&(e=c,a.updateHeight(c),console.log("MutationObserver Height Updated To: "+c))}var d={},e=0;return _.extend(d,Backbone.Events),d.updateHeight=function(c,d,e){var f=0,g=setInterval(function(){f>=2&&clearTimeout(g),"number"==typeof e?newHeight=e:newHeight=b(),"number"==typeof d&&(newHeight+=d),console.log(c+" : "+d+" : "+e+" : "+newHeight),a.updateHeight(newHeight),f++},50)},d.initilizeObserver=function(){var a=new MutationObserver(c);a.observe(document.body,{childList:!0,characterData:!0,attributes:!0,
subtree:!0})},d}]),b.module("convoApp").factory("networkImageService",["ServerComm","$q","accountInfo",function(a,b,c){function d(){var c={method:"generateRequestUUID"},d=a.post("accounts/logo",c),e=b.defer();return d.success(function(a,b){e.resolve(a)}),e.promise}function e(c,d,e,f,g){var h={method:"submitThumbnailGenerationRequestForNetworkLogoImage",request_id:c,file_name_with_extension:d,file_size:e,crop_scale:f,crop_selection_rect:g},i=a.post("accounts/logo",h),j=b.defer();return i.success(function(a,b){j.resolve(a)}),j.promise}function f(c){var d={method:"getThumbnailGenerationRequestStatus",request_id:c},e=a.post("accounts/logo",d),f=b.defer();return e.success(function(a,b){f.resolve(a)}),f.promise}function g(d,e,f){var g={method:"updateNetworkLogoImageIfUploaded",request_id:d,user_id:e,account_id:f},h=a.post("accounts/logo",g),i=b.defer();return h.success(function(a,b){c.updateNetworkImageType(a.data.account_image_type),c.updateNetworkImageVersion(a.data.account_image_version),i.resolve(a)}),i.promise}var h={};return h.generateRequestUUID=d,h.generateLogoThumbnails=e,h.getThumbnailGenerationRequestStatus=f,h.updateNetworkLogoImageIfUploaded=g,h}]),b.module("convoApp").factory("networkSettingService",["$window",function(a){function b(){var a=!0;return h.is_chat_enabled!=c&&(a=h.is_chat_enabled),a}function d(){var a=!0;return h.is_gify_enabled!=c&&(a=h.is_gify_enabled),a}function e(){var b=0;return a.com_convo.sessionData.signInResponseData.is_account_blocked!=c&&(b=a.com_convo.sessionData.signInResponseData.is_account_blocked),b}function f(){var b="";return a.com_convo.sessionData.signInResponseData.account_key&&(b=a.com_convo.sessionData.signInResponseData.account_key.toLowerCase()),b}function g(){var a=!1;return h.is_analytics_enabled!=c&&(a=!!h.is_analytics_enabled),a}function g(){var a=!1;return h.is_analytics_enabled!=c&&(a=!!h.is_analytics_enabled),a}var h={};return a.com_convo.sessionData.signInResponseData&&(h=a.com_convo.sessionData.signInResponseData.network_settings),{getChatStatus:b,getGiphyStatus:d,getAccountKey:f,isAccountBlocked:e,isAnalyticsEnabled:g}}]),b.module("convoApp").factory("notesAppDataProvider",["$q","config","accountInfo","userInfo","usersGroupsListProvider","hashtagsProvider","utils","FilterTypes","UserProfileImage","userImgUrlFilter","$filter","itemService","User","Group","Users",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(b){var c=a.defer();return m.getNote(b).then(function(a){c.resolve(t(a.data.data))}),c.promise}function r(a,b,c){b&&(E.length=0);for(var d in a){var e=a[d].title,f="profile"==a[d].type.toLowerCase()?"Followers":h.getLabelShortVersion(e),g="group ";"public"==a[d].access.toLowerCase()?g+="Icon1_PublicChannel-01-lightgray":"private"==a[d].access.toLowerCase()||"profile"==a[d].access.toLowerCase()?g+="privateGroup_icon-lightgray":"secret"==a[d].access.toLowerCase()&&(g+="privateGroup_icon-lightgray"),E.push({id:a[d].group_id,type:i.GROUP,label:e,shortHandLabel:f,accessible:a[d].accessible,access:a[d].access,formattedlabel:e,desclabel:"Group",formatteddesclabel:"Group",grouptype:a[d].type,createdby:a[d].created_by,classes:g,readonly:c,imgurl:""})}F.push(E)}function s(a,b,c){b&&(D.length=0);for(var d in a)D.push({id:d,type:i.USER,label:a[d].name,shortHandLabel:h.getLabelShortVersion(a[d].name),accessible:a[d].accessible,formattedlabel:a[d].name,desclabel:a[d].name,formatteddesclabel:a[d].name,profile_image_type:a[d].profile_image_type,profile_image_version:a[d].profile_image_version,classes:"user",readonly:c,imgurl:p.getUserImage(a[d],j.PROFILE_IMAGE_SIZE_64x64)});F.push(D)}function t(a){F.length=0;var b=0===parseInt(a.item.draft);s(a.users,!0,b),r(a.groups,!0,b),a.sharing_info=a.mappings["mappings_"+a.item_id],a.sharedWithListItems=[];for(var d in a.sharing_info){var e=A(a.sharing_info[d].published_to);e?a.sharedWithListItems.push(e):console.error("Sharing Info doesn't exist in notesAppDataProvider")}return a.item.tagList=v(a.item.tags),a.item.deleted=+a.item.deleted,a.item.muted=+a.item.muted,a.item.starred=+a.item.starred,a.item.is_system_message=+a.item.is_system_message,a.note_files=a.files["files_"+a.item.item_id]||[],a.item.logged_in_user_permissions.checkBitAt(3)||(a.itemSharingInfoWithDropdownItems=u(a.item.created_by,a.sharing_info)),a.item.hasTitle=!1,(a.item.show_title===c&&-1!==a.item.note_type.indexOf("IMAGES")||1==a.item.show_title)&&(a.item.hasTitle=!0),a.origionalTitle=a.item.title,a.item.draft=+a.item.draft,a.item.created_by_object=A(a.item.created_by),a.item.created_by_object.filterUrl=l("idToFilterUrlForNotesApp")(a.item.created_by_object.id),a.item.last_edit_by_object=A(a.item.last_edit_by),a.item.last_edit_by_object.filterUrl=l("idToFilterUrlForNotesApp")(a.item.last_edit_by_object.id),a}function u(a,b){var c=[],d=x(a);c.push(f.createUserListItem(_.extend({user_id:a,name:d.label,email:""},d)));for(var e=0,g=b.length;g>e;e++){var h=b[e];if(h.type===i.USER&&h.published_to!==a){var d=x(h.published_to);c.push(f.createUserListItem(_.extend({user_id:h.published_to,name:d.label,email:""},d)))}else if(h.type===i.GROUP){var j=w(h.published_to);c.push(f.createGroupListItem(new o(_.extend({id:h.published_to,title:j.label},j))))}}return c}function v(a){for(var b=a?a.split(","):[],c=[],d=0;d<b.length;d++){var e=b[d];""!=e&&("#"!=e[0]&&(e="#"+e),c.push({id:h.generateHash(e),label:e,locked:!1}))}return c}function w(a){for(var b in E)if(E[b].id==a)return E[b];return null}function x(a){for(var b in D)if(D[b].id==a)return D[b];return null}function y(a){for(var b=0,c=F.length;c>b;b++)for(var d=0,e=F[b].length;e>d;d++)if(F[b][d].id==a)return F[b][d].label;return"Unknown"}function z(a){for(var b=0,c=F.length;c>b;b++)for(var d=0,e=F[b].length;e>d;d++)if(F[b][d].id==a)return F[b][d].shortHandLabel;return"Unknown"}function A(a){for(var b=0,c=F.length;c>b;b++)for(var d=0,e=F[b].length;e>d;d++)if(F[b][d].id==a)return F[b][d];return null}function B(a,b,c){var d=C(a,D);d&&s(d,!1,c);var e=C(b,E);e&&r(e,!1,c)}function C(a,b){var c={};_.each(b,function(a){c[a.id]=!0});var d={},e=!1;for(var f in a)c.hasOwnProperty(f)||(d[f]=a[f],e=!0);return e?d:null}var D=[],E=[],F=[];e.getUserId();return{getNoteData:q,renderNoteDataResponse:t,getNameById:y,getShortNameById:z,getItem:A,getGroup:w,getUser:x,renderTagsData:v,addUsersAndGroupsWhichDontExist:B}}]),b.module("convoApp").factory("o365Service",["ServerComm","$q","onboardingService",function(a,b,c){var d={createO365Integration:function(d,e,f,g,h,i,j,k,l,m){var n=b.defer(),o={account_id:d,creator_id:e,display_name:f,action_type:g,access_level:h,recipients:i,profile_image_info:j,integration_data:k,token_id:l,integration_type:m};return a.post("integrations/o365",o).success(function(a,b){n.resolve(a),c.markIntegrationsAsDone("O365")}).error(function(a,b){n.resolve(b)}),n.promise},getMailFolderList:function(c){var d=b.defer(),e={op:"folder_list",token_id:c,folder_id:"root"};return a.get("integrations/o365?op=folder_list&token_id="+c+"&folder_id=root",e).success(function(a,b){d.resolve(a)}),d.promise},getUserInfo:function(c){var d=b.defer(),e={op:"user_info",user_id:c,token_id:"1111",version:"1.1"};return a.get("integrations/o365?op=user_info&user_id="+c+"&token_id=1111&version=1.1",e).success(function(a,b){d.resolve(a)}),d.promise},deleteAuthorization:function(c){var d=(b.defer(),{token_id:c,target:"authorization"});return a.deletex("integrations/o365",d)},deleteIntegration:function(c,d){var e=(b.defer(),{webhook_id:c,target:"webhook",token_id:"1111",integration_type:d});return a.deletex("integrations/o365",e)},getIntegrationDetails:function(c,d){var e=b.defer(),f={webhook_id:c,op:"integration_details",integration_type:d,token_id:"1111"};return a.get("integrations/o365?webhook_id="+c+"&token_id=1111&op=integration_details&integration_type="+d,f).success(function(a,b){e.resolve(a)}),e.promise},updateIntegration:function(c,d,e,f,g,h,i,j){var k=b.defer(),l={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g,integration_data:h,token_id:i,integration_type:j};return a.put("integrations/o365",l).success(function(a,b){k.resolve(a)}).error(function(a,b){k.resolve(b)}),k.promise},getCalendarsList:function(c){var d=b.defer(),e={op:"calendars_list",token_id:c};return a.get("integrations/o365?op=calendars_list&token_id="+c,e).success(function(a,b){d.resolve(a)}),d.promise},getDriveFoldersList:function(c,d){var e=b.defer(),f={op:"drive_folders",token_id:c,folder:d};return a.get("integrations/o365?op=drive_folders&token_id="+c+"&folder="+d,f).success(function(a,b){e.resolve(a)}),e.promise},eventEndReminder:function(c,d,e){var f=b.defer(),g={webhook_id:c,end_reminder:d,token_id:e,op:"save_event_end_reminder",integration_type:"calendar"};return a.put("integrations/o365",g).success(function(a,b){f.resolve(a)}).error(function(a,b){f.resolve(b)}),f.promise}};return d}]),b.module("convoApp").factory("passwordPolicyService",["ServerComm","$q","bannerService","AppLinks",function(a,b,c,d){function e(a){null!=a&&(o=a)}function f(){return o}function g(a){if(null!=o){var b=[];b.push({constraint:"be at least "+o.password_min_length+" characters long",fulfilled:a.length>=o.password_min_length});var c=n;for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];(e.bitmap&o.password_complexity)==e.bitmap&&b.push({constraint:e.error_message,fulfilled:e.regex.test(a)})}return b}}function h(a){var b=!0;return g(a).forEach(function(a){return a.fulfilled===!1?(b=!1,!1):void 0}),b}function i(){return n}function j(){var a=d.newResourceLink("12",[{type:"9",uid:0},{type:"myAccountSettings",uid:0}],null,"My account settings");return d.linkToUrl(a,!0)}function k(a,b){var d="Your password will expire in ";d="1"==a.remaining_days?d+"1 day. <a href='"+j()+"'>Click here</a> to change it now.":d+a.remaining_days+" days. <a href='"+j()+"'>Click here</a> to change it now.",c.showBanner(d,!0,!0,null,5e3,b)}function l(b){var c=function(){var a=c.serverComm.postx("onboarding",{method:"recordAction",action:"pwd_exp_tooltip1_shown"});a.then(function(a){console.log(a)},function(a){console.log("error:"+a)})};c.serverComm=a,k(b,c)}function m(b){var c=function(){var a=c.serverComm.postx("onboarding",{method:"recordAction",action:"pwd_exp_tooltip2_shown"});a.then(function(a){console.log(a)},function(a){console.log("error:"+a)})};c.serverComm=a,k(b,c)}var n={upper:{bitmap:1,regex:/[A-Z]/,error_message:"have at least one uppercase letter (A - Z)"},digit:{bitmap:4,regex:/[0-9]/,error_message:"have at least one digit (i.e 0 - 9)"},punct:{bitmap:8,regex:/[^A-Za-z0-9 ]/,error_message:"have at least one special character (e.g & # %)"}},o=null;return{setAdminDefinedPasswordPolicy:e,getAdminDefinedPasswordPolicy:f,classifyFulfilledAndUnfulfilledConstraintsByPassword:g,checkIfAllConstraintsAreMet:h,getPasswordComplexityConstraintsBitMap:i,showPasswordExpiryToolTip1:l,showPasswordExpiryToolTip2:m}}]),b.module("convoApp").factory("perf",["$window","logger","mixpanelService",function(a,b,d){function e(a,c){var e=C.timing;t=a.boomerangBeaconObject,u=0,z=c,w.loadEventStart=e.loadEventStart-e.navigationStart,w.cnvCssFilesLoaded=parseInt(a.cnvCssFilesLoaded),w.cnvJsFilesLoaded=parseInt(a.cnvJsFilesLoaded),w.loadEventEnd=e.loadEventEnd-e.navigationStart,b.log("perf: measure: loginClick --> onLoad: "+w.loadEventEnd+" ms (perf.timing), "+t.t_done+" ms (boomerang) (loadEventStart: "+w.loadEventStart+" ms, cnvCssFilesLoaded: "+w.cnvCssFilesLoaded+" ms, cnvJsFilesLoaded: "+w.cnvJsFilesLoaded+" ms) [bandwidth: "+u+", isFirstLoad: "+z+"]"),d.trackEvent(z?d.PERF__LOGIN_CLICK_TO_APP_LOAD_COMPLETE__FIRST_LOAD:d.PERF__LOGIN_CLICK_TO_APP_LOAD_COMPLETE,{value:w.loadEventEnd,loadEventStart:w.loadEventStart,cnvCssFilesLoaded:w.cnvCssFilesLoaded,cnvJsFilesLoaded:w.cnvJsFilesLoaded,bandwidth:u,isFirstLoad:z}),o(),y=!0}function f(a){v=a}function g(a){v===s.INITIAL_NAV_TO_FEED&&a===s.EVENT__FEED_RENDER_START&&(v=null,w.feedRenderStart=parseInt(C.now()),n(s.EVENT__FEED_RENDER_START))}function h(a){var c=parseInt(C.now());b.log("perf: measure: "+a+": "+c)}function i(a){x[a]++}function j(){var a=C.timing;b.log("perf: measure: domComplete: "+(a.domComplete-a.navigationStart))}function k(){var a=B;return B="",a}function l(a){B="&gt; "+a+"<br><br>"+B}function m(){return C.memory}function n(a){A.push(a),y&&o()}function o(){for(var a=0;A>a;a++){var c=A[a];c===s.EVENT__FEED_RENDER_START&&(b.log("perf: measure: loginClick --> feedRenderStart: "+w.feedRenderStart+" ms [bandwidth: "+u+", isFirstLoad: "+z+"]"),d.trackEvent(z?d.PERF__LOGIN_CLICK_TO_FEED_RENDER_START__FIRST_LOAD:d.PERF__LOGIN_CLICK_TO_FEED_RENDER_START,{value:w.feedRenderStart,bandwidth:u,isFirstLoad:z}))}A=[]}function p(a){var b=C;a&&b?(s.mark=function(a){b.mark(a)},s.measure=function(a,c,d){b.measure(a,c,d)},s.clearMarks=function(){b.clearMarks()},s.clearMeasures=function(){b.clearMeasures()},s.getEntriesByType=function(a){return b.getEntriesByType(a)},s.clearAll=q,s.analyzePerfMeasures=r):(s.mark=_.noop,s.measure=_.noop,s.clearMarks=_.noop,s.clearMeasures=_.noop,s.getEntriesByType=_.noop,s.clearAll=_.noop,s.analyzePerfMeasures=_.noop)}function q(){s.clearMarks(),s.clearMeasures()}function r(){for(var a=s.getEntriesByType("measure"),d={},e=0;e<a.length;e++){var f=a[e];d[f.name]===c&&(d[f.name]={count:0,sum:0}),d[f.name].count++,d[f.name].sum+=f.duration}var g=_.map(d,function(a,b){return{name:b,count:a.count,sum:a.sum,avg:a.sum/a.count}});g=_.sortBy(g,"sum");for(var e=g.length-1;e>=0;e--){var h=g[e];b.log(h.name+"\n"+h.sum+"		"+h.avg+"		"+h.count)}}var s={};s.INITIAL_NAV_TO_FEED=0,s.EVENT__FEED_RENDER_START=1;var t,u,v,w={navigationStart:0,domLoadingStart:0,domContentLoaded:0,domComplete:0,loadEventStart:0,cnvCssFilesLoaded:0,cnvJsFilesLoaded:0,loadEventEnd:0,feedRenderStart:0,feedRenderComplete:0,noteDetailLoadComplete:0},x={numDigests:0,numIntercomLSWrites:0,numIntercomLSEvents:0,numFailedServerRequests:0},y=!1,z=!1,A=[],B="",C=a.performance;return p(!1),s.enable=function(){p(!0)},s.disable=function(){p(!1)},s.init=e,s.setInitialNavTo=f,s.recordEvent=g,s.recordMeasure=h,s.recordCounter=i,s.recordDomComplete=j,s.getCounters=function(){return x},s.getLog=k,s.recordLog=l,s.getMemoryUsageNumbers=m,a.perf=s,s}]),b.module("convoApp").factory("preloadService",["config",function(a){function b(){var a=document.createElement("div");a.style.position="absolute",a.style.top="-99999",a.style.fontFamily="symbola",a.innerHTML="test",document.body.appendChild(a),setTimeout(function(){document.body.removeChild(a)},0)}function c(){var a=f+"assets/img/";g=[{src:"cursors/2xarrowwhite.png"},{src:"cursors/2xsquarewhite.png"},{src:"cursors/2xmarkerwhite.png"},{src:"cursors/2xmarkerwhite.cur"},{src:"cursors/2xarrowwhite.cur"},{src:"cursors/2xsquarewhite.cur"},{src:"common/preloader.gif"},{src:"download-modal/@2x_iPhone-mock.png"},{src:"download-modal/@2x_laptop.png"},{src:"download-modal/@2x_mobile-icon.png"},{src:"download-modal/@2x_mac-dock-icon.png"},{src:"download-modal/@2x_google-play.png"},{src:"download-modal/@2x_app-store.png"},{src:"giphy/2xMouseoverClick.png"},{src:"Emoji-icons/Unselected/2x/emoji_icons-02_36x36_Filled.png"},{src:"common/Checkmark(2x).png"}];for(var b=0,c=g.length;c>b;b++)g[b].el=new Image,g[b].el.src=a+g[b].src}function d(a){if(a){var b=new Image;b.src=a}}var e={},f=a.APP_BASE_URL,g=null;return e.loadFonts=b,e.loadImages=c,e.cacheImage=d,e}]),b.module("convoApp").factory("premiumUpgradeBannerService",["bannerService","accountInfo","AppLinks",function(a,b,c){function d(){var a=c.newResourceLink("12",[{type:"9",uid:0},{type:"networkInformation",uid:0}],null,"Network Information");return c.linkToUrl(a,!0)}function e(){"PREMIUM"==b.getAccountLevel()&&a.showBanner("Success! You are on the Pro Plan.<br/>View your <a href='"+d()+"'>Network Settings</a>.",!0,!0,null,5e3)}var f={};return f.showUpgradeSuccessTooltip=e,f}]),b.module("convoApp").factory("profilePicService",["ServerComm","$q",function(a,b){function c(){var c={method:"generateRequestUUID"},d=a.post("profilepic",c),e=b.defer();return d.success(function(a,b){e.resolve(a)}),e.promise}function d(c,d,e,f,g){var h={method:"submitThumbnailGenerationRequestForUserProfileImage",request_id:c,file_name_with_extension:d,file_size:e,crop_scale:f,crop_selection_rect:g},i=a.post("profilepic",h),j=b.defer();return i.success(function(a,b){j.resolve(a)}),j.promise}function e(c){var d={method:"getThumbnailGenerationRequestStatus",request_id:c},e=a.post("profilepic",d),f=b.defer();return e.success(function(a,b){f.resolve(a)}),f.promise}function f(c,d,e){var f={method:"updateUserProfileImageIfUploaded",request_id:c,user_id:d,account_id:e},g=a.post("profilepic",f),h=b.defer();return g.success(function(a,b){h.resolve(a)}),h.promise}var g={};return g.generateRequestUUID=c,g.generateProfileThumbnails=d,g.getThumbnailGenerationRequestStatus=e,g.updateUserProfileImageIfUploaded=f,g}]),b.module("convoApp").factory("searchService",["FilterTypes","AppLinks","FiltersQueryTransformer",function(a,c,d){function e(a,b,c){for(var d=[],e=a.length,f=".",g="",h=!1,i=0;e>i;i++)f=a.charAt(i),h||f!=b?h&&f==c?(g+=f,d.push(g),g="",h=!1):f==c?(g+=f,h=!0):g+=f:g.length>0&&(d.push(g),g="");return g.length>0&&d.push(g),d}function f(a){var b=a.replace(/(\s*?\+\s*)/gi,"+");return b=a.replace(/(\s*?\,\s*)/gi,",")}function g(a,b,c,d){for(var e=a.length,f="",g=!1,h="",i=0;e>i;i++)h=a.charAt(i),h==d?g=!g:h!=b||g||(h=c),f+=h;return f}function h(b,c,d){for(var e=0;e<b.length;e++)if(b[e].type===a.TEXT){b[e].description=d,b[e].value=[d];break}return b}function i(i,j){j||(j="+");for(var k=null,l=null,m=[],n=null,o=null,p=b.copy(i),q=[],r=0;r<p.length;r++)if(p[r].type===a.TEXT){k=p[r].value;break}return k?(l=k.join(j),l=g(f(l)," ",j,'"'),l.indexOf("+")>0?(m=e(l,"+",'"'),l.indexOf('"')<0&&(n='"'+m.join(" ")+'"',o=n,suggested=n,p=h(p,n,o),q.push({title:n,value:o,url:c.getFilterUrlForFilterStr(d.filtersToQuery(p).replace(/%3A/g,":"))})),o=m.join(","),n=m.join(" OR "),p=h(p,n,o),q.push({title:n,value:o,url:c.getFilterUrlForFilterStr(d.filtersToQuery(p).replace(/%3A/g,":"))})):l.indexOf(",")>0?(m=e(l,",",'"'),o=m.join("+"),n=m.join(" AND "),p=h(p,n,o),q.push({title:n,value:o,url:c.getFilterUrlForFilterStr(d.filtersToQuery(p).replace(/%3A/g,":"))})):'"'==l.charAt(0)&&'"'==l.charAt(l.length-1)&&(l=l.substring(1,l.length-1),m=l.split(" "),m&&m.length>0&&(o=m.join("+"),n=m.join(" AND "),p=h(p,n,o),q.push({title:n,value:o,url:c.getFilterUrlForFilterStr(d.filtersToQuery(p).replace(/%3A/g,":"))}))),q):void 0}function j(){k.trigger("searchService:clearSearch")}var k={};return _.extend(k,Backbone.Events),k.getSearchSuggestions=i,k.clearSearch=j,k}]),b.module("convoApp").factory("serverPingService",["$interval","ServerComm","chatUsersManager","alertsService","adminService","$rootScope","$location","$window","InAppNotifications",function(a,b,c,d,e,f,g,h,i){function j(){k()}function k(){if(!m){m=!0;var a=i.getMinTimestamp(),f=i.getMaxUpdateTimestamp(),j="?user_status="+c.getThisUser().presenceStatus;j+=a&&f?"&cmin="+a+"&cmax="+f:"&cmin=0&cmax=0",b.getx("updates"+j).then(function(a){m=!1;var b=a.data.data;o=b.directs_count,p=b.groups_update_count,q=b.ipn_info,r=b.like_notifications,s=b.notif_follow_grp_share,l.trigger("directsUnreadCountUpdate",o),l.trigger("whatsNewDataUpdate",{isClientVersionLatest:b.is_client_version_latest,showWhatsNewTooltip:b.show_whats_new_tooltip,showUnreadAnouncementsIndicator:b.show_unread_announcements_indicator,notifyAboutNewFeatures:b.notify_about_new_features,anouncementsLastTimeStamp:b.announcements_last_publish_timestamp}),l.trigger("groupsUnreadCountsUpdate",p),l.trigger("ipnUnreadCountUpdate",q),l.trigger("likeNotificationsUpdate",r),l.trigger("userStartedFollowAndGroupSharedAndGroupJoinReqNotificationsUpdate",s),l.trigger("limitsBannerDataUpdate",b.limits_banner_data),n&&n.member_can_create_groups==b.member_can_create_groups||l.trigger("createGroupPermission",b.member_can_create_groups),n=b},function(a){try{403===a.status&&a.jqXHR.responseJSON.data&&a.jqXHR.responseJSON.data.hasOwnProperty("admin_privileges_revoked")&&1==a.jqXHR.responseJSON.data.admin_privileges_revoked?t||(t=!0,d.alertModal("Admin privileges revoked","You have been removed as an admin of this network.","Ok",function(){t=!1;var a=e.exitAdminMode();a.then(function(){g.url("/feed"),h.location.reload()})},!0,!0)):403===a.status&&a.jqXHR.responseJSON.data&&a.jqXHR.responseJSON.data.hasOwnProperty("force_password_reset")&&1==a.jqXHR.responseJSON.data.force_password_reset?t||(t=!0,d.alertModal("Password reset","Your network admin has reset your password. You must change your password to log in.","Ok",function(){console.error("password has been reset by admin."),t=!1,l.trigger("networkNoLongerAccessibleToUser")},!0,!0)):403===a.status&&a.jqXHR.responseJSON.data&&a.jqXHR.responseJSON.data.hasOwnProperty("password_expired")&&1==a.jqXHR.responseJSON.data.password_expired?t||(t=!0,d.alertModal("Password expired","Your password has expired. You must change your password to log in.","Ok",function(){console.error("password has been expired."),t=!1,l.trigger("networkNoLongerAccessibleToUser")},!0,!0)):403===a.status&&a.jqXHR.responseJSON.data&&a.jqXHR.responseJSON.data.hasOwnProperty("password_changed_by_admin")&&1==a.jqXHR.responseJSON.data.password_changed_by_admin?t||(t=!0,d.alertModal("Password change","Your network admin has reset your password. You must change your password to log in.","Ok",function(){console.error("password has been expired."),t=!1,l.trigger("networkNoLongerAccessibleToUser")},!0,!0)):403===a.status&&(console.error("network no longer accessible to user"),l.trigger("networkNoLongerAccessibleToUser"))}catch(b){403===a.status&&(console.error("network no longer accessible to user"),l.trigger("networkNoLongerAccessibleToUser"))}m=!1})}}var l={};_.extend(l,Backbone.Events);var m,n,o=0,p=[],q={},r=[],s=[],t=!1;return l.init=j,l.getUpdatesFromServer=k,l.getDirectsUnreadCount=function(){return o},l.getGroupsUnreadCounts=function(){return p},l.getIpnUnreadCount=function(){return q},l.getLikeNotifications=function(){return r},l.getUserStartedFollowAndGroupSharedAndGroupJoinReqNotifications=function(){return s},l}]),b.module("convoApp").factory("tagsService",["ServerComm","accountInfo","userInfo","$q","loginResponseData","FilterTypes","Filters","localStore",function(a,d,e,f,g,h,i,j){function k(){return r}function l(c){for(var j=b.copy(c),k=0;k<j.length;k++)j[k].type==h.TEXT&&(j[k].type="tag");var l={authToken:g.getXmppSessionToken(),userID:e.getUserId(),accountID:d.getAccountId(),filter:i.newANDFiltersChain(j,"")},m=a.postx("tags/related/get",l),n=f.defer();return m.then(function(a,b){n.resolve(a)},function(a,b){n.reject(a)}),n.promise}function m(b){var c=f.defer(),d=!1;if(!b){var e=j.readData(k());e&&(d=!0,c.resolve(e.data.data.standardize_tags),o(e.data.data.standardize_tags))}if(!d||b){var g=a.getx("stdhashtags?method=getStandardizeHashtags");g.then(function(a,b){var d=a.data;j.writeData(k(),d),1==d.type&&200==d.errorCode?c.resolve(d.data.standardize_tags):c.reject("Error getting standardized tags data."),o(d.data.standardize_tags)},function(a,b){c.reject("Error getting standardized tags data.")})}return c.promise}function n(){var a=j.readData(k());return a.data&&a.data.data&&a.data.data.standardize_tags?a.data.data.standardize_tags:null}function o(a){s||(s={}),a&&a.forEach(function(a){s[a.tag]=a,a.children&&a.children.length&&o(a.children)})}function p(a){s||(s={},o(n()));var b=s[a];return b!=c&&null!=b}function q(a){return s||(s={},o(n())),s[a]}var r="ACC_STAGS",s=null;return{getRelatedTags:l,getStandardizedTags:m,isSTag:p,getSTagData:q}}]),b.module("convoApp").factory("twitterService",["ServerComm","$q","onboardingService",function(a,b,c){var d={createTwitterIntegration:function(d,e,f,g,h,i,j,k,l,m){var n=b.defer(),o={account_id:d,creator_id:e,display_name:f,action_type:g,access_level:h,recipients:i,profile_image_info:j,search_term:k,trigger_data:l,token_id:m};return a.post("integrations/twitter",o).success(function(a,b){n.resolve(a),c.markIntegrationsAsDone("Twitter")}),n.promise},getUserInfo:function(c){var d=b.defer(),e={op:"user_info",user_id:c,token_id:"1111",version:"1.1"};return a.get("integrations/twitter?op=user_info&user_id="+c+"&token_id=1111&version=1.1",e).success(function(a,b){d.resolve(a)}),d.promise},deleteAuthorization:function(c){var d=(b.defer(),{token_id:c,target:"authorization"});return a.deletex("integrations/twitter",d)},deleteIntegration:function(c){var d=(b.defer(),{webhook_id:c,target:"webhook"});return a.deletex("integrations/twitter",d)},getIntegrationDetails:function(c){var d=b.defer(),e={webhook_id:c,op:"integration_details",token_id:"1111"};return a.get("integrations/twitter?webhook_id="+c+"&token_id=1111&op=integration_details",e).success(function(a,b){d.resolve(a)}),d.promise},updateIntegration:function(c,d,e,f,g,h,i,j){var k=b.defer(),l={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g,search_term:h,trigger_data:i,token_id:j};return a.put("integrations/twitter",l).success(function(a,b){k.resolve(a)}).error(function(a,b){k.resolve(b)}),k.promise},getTwitterLists:function(c,d){var e=b.defer(),f={op:"twitter_lists",screen_name:d,token_id:c};return a.get("integrations/twitter?op=twitter_lists&screen_name="+d+"&token_id="+c,f).success(function(a,b){e.resolve(a)}),e.promise},verifyTwitterHandles:function(c,d){var e=b.defer(),f={op:"verify_handles",handles:d,token_id:c};return a.get("integrations/twitter?op=verify_handles&handles="+d+"&token_id="+c,f).success(function(a,b){e.resolve(a)}),e.promise},saveHandlesConfig:function(c,d,e){var f=b.defer(),g={webhook_id:c,trigger_data:d,token_id:e,op:"save_handles_config"};return a.put("integrations/twitter",g).success(function(a,b){f.resolve(a)}).error(function(a,b){f.resolve(b)}),f.promise}};return d}]),b.module("convoApp").factory("usagePolicyService",["ServerComm","$q",function(a,b){function c(c){var d={method:"updateUsagePolicySettings",data:{display_policy_banner:c.displayPolicyBanner,usage_policy_title:c.usagePolicyTitle,usage_policy_text:c.usagePolicyText}},e=a.postx("admin/security/usage-policy",d),f=b.defer();return e.then(function(a){f.resolve(a.data)},function(a){f.reject(a.data)}),f.promise}function d(){var c=a.getx("admin/security/usage-policy"),d=b.defer();return c.then(function(a){d.resolve(a.data)},function(a){d.reject(a.data)}),d.promise}function e(a){g=a}function f(){return g}var g=!1;return{saveUsagePolicy:c,getUsagePolicy:d,setDisplayUsagePolicyInRightPanel:e,getDisplayUsagePolicyInRightPanel:f}}]),b.module("convoApp").factory("userProfileService",["ServerComm","$q",function(a,b){function c(a,c){var d=b.defer();return a.then(function(a){d.resolve(a.data),c&&c(a.data)},function(a){d.reject(a.data)}),d.promise}var d={},e="accounts/profile-templates",f="user/profiles",g={profileData:[],templateData:[]};return d.registerCallback=function(a,b){g[a].push(b)},d.createTemplate=function(b){var d={method:"createUserProfileTemplate",template:b},f=a.post(e,d);return c(f)},d.updateTemplate=function(b){var d={method:"updateUserProfileTemplate",template:b},f=a.put(e,d);return c(f)},d.getTemplate=function(){var b={method:"readUserProfileTemplates"},d=a.get(e,{params:b});return c(d)},d.get=function(b){var d={method:"readUserProfile"};b&&(d.user_id=b);var e=a.get(f,{params:d});return c(e,function(a){g.profileData.forEach(function(b){b(a)})})},d.update=function(b){var d={method:"updateUserProfile",user_profile:b},e=a.put(f,d);return c(e,function(a){g.profileData.forEach(function(b){b(a)})})},d}]),b.module("convoApp").factory("usersGroupsListProvider",["Groups","Users","accountInfo","FilterTypes","UserProfileImage","userImgUrlFilter","mentionsHistory","utils","ContactsWrapper","User","userInfo",function(a,b,c,d,e,f,g,h,i,j,k){function l(){setTimeout(function(){m(),setTimeout(function(){n(),setTimeout(function(){o()},500)},500)},0)}function m(){q()}function n(){r()}function o(){p()}function p(){S.length=0,i.getContacts(i.CONTACT_LIST_TYPES.ON_DOMAIN).then(function(a){for(var b=0,c=a.length;c>b;b++)a[b].classes="user contact-as-user "+h.getRandomSmiley()+" as-content ",S.push(a[b])})}function q(){b.getPublishableUsers().then(function(a){b.fillRelevanciesInUsers().then(function(){U.length=0,W={},X.length=0,Y.length=0,ca.PUBLISHABLE_INVITED_USERS_MAP={};for(var b=a.sort(function(a,b){var c=a.rank||0,d=b.rank||0;return c>d?-1:d>c?1:0}),c=0;c<b.length;c++){var d=u(b[c]);U.push(d),W[d.id]=c,d.isGuestUser&&X.push(d),"INVITED"===d.status&&(Y.push(d),ca.PUBLISHABLE_INVITED_USERS_MAP[d.id]=d)}})})}function r(){a.getPublishableGroups().then(function(a){T.length=0,V={},a.forEach(function(a,b){(1===a.get("members_can_post")||1===a.get("memberCanPost")||1===a.get("member_can_post_in_this_group")||1===a.get("memberCanPostInThisGroup"))&&(T.push(v(a)),V[a.get("id")]=T.length-1)})})}function s(a){var b=a;return{id:b,label:b,formattedlabel:b,labelisemail:!0}}function t(a,c,f){var g=a.fullName;g||(g=a.first_name+" "+a.last_name);var h=!1;g.trim().length||(g=a.email,h=!0);var i=g,j=c||a.user_email_id;return{type:d.USER,id:a.user_id,label:i,formattedlabel:i,labelisemail:h,email:a.user_email_id,desclabel:j,formatteddesclabel:j,desclabelisemail:!0,dontquerydesc:f,classes:"user",imgurl:b.getUserImage(a,e.PROFILE_IMAGE_SIZE_64x64)}}function u(a){var c=a.fullName,f=!1;c||(c=a.name),c||(c=a.first_name+" "+a.last_name),c.trim()||(c=a.email,f=!0);var g=c;return{type:d.USER,id:a.user_id,label:g,formattedlabel:g,labelisemail:f,status:a.status,invited:"INVITED"===a.status,email:a.email,desclabel:a.email,formatteddesclabel:a.email,desclabelisemail:!0,classes:"user",imgurl:b.getUserImage(a,e.PROFILE_IMAGE_SIZE_64x64),dontsort:"INVITED"===a.status}}function v(a){var b="group ",c=a.get("access").toLowerCase();return"public"==c?b+="Icon1_PublicChannel-01-lightgray":"private"==c||"profile"==c?b+="privateGroup_icon-lightgray":"secret"==c&&(b+="privateGroup_icon-lightgray"),{type:d.GROUP,id:a.get("id"),label:a.get("title"),formattedlabel:a.get("title"),desclabel:"Group",formatteddesclabel:"Group",classes:b,imgurl:"",grouptype:a.get("type")}}function w(a,b,c){var d,e=b[c],f=e.replace(a,"$1b1%b1_1$3b2%b2_2");if(f!==e){var g=f.indexOf("b1%b1_1");b[c+"isemail"]&&g>e.indexOf("@")?f=e:d=f.slice(g+7,f.indexOf("b2%b2_2"))}return{formatted:f,matchedString:d,matchedStringIn:e}}function x(a,b,e,f,g){var j=!0;if(U.length+T.length===0&&(j=!1),e&&0!==e.length&&(j=!0),a||(j=!1),!j)return[];b=b||5;var l=f&&f.length||0;b=e&&e.length?Math.min(b,e.length+l):Math.min(b,U.length+T.length+l);var m,n=h.getUserGroupSearchRegex(a),o=[],p=0,q={},r=null;if(m=e?[e]:[U,T],f)for(var s=f.split(","),t=0;t<s.length;t++)m.push(aa[s[t]]),aa[s[t]]===aa[ba.NETWORK_ON_DOMAIN_CONTACTS_LIST]&&(r={label:"People you may know",formattedlabel:"People you may know",type:"SEPARATOR",id:h.generateHash("People you may know")});if(g&&-1!==a.indexOf("@")&&!k.isGuestUser()){var u=!c.shouldInviteGuestsAsFullMembers();q=i.getSuggestedContactBasedOnQuery(a,u)}for(var v=0;v<m.length&&b>p;v++)for(var x=m[v],t=0;t<x.length&&b>p;t++){var z=w(n,x[t],"label").formatted,A=null;A=x[t].type==d.USER?w(n,x[t],"desclabel").formatted:x[t].desclabel,x[t].type!=d.USER&&"CONTACT"!=x[t].type||!q.available||q.label!=x[t].email||(q.duplicate=!0),(z!=x[t].label||A!=x[t].desclabel)&&("CONTACT"===x[t].type&&null!=r&&-1===h.findIndexInObjectArray(o,"id",r.id)&&o.push(r),x[t].formattedlabel=z,x[t].formatteddesclabel=A,o.push(x[t]),p++)}q.message&&o.length&&(q.message=null);var B=y(q);return B&&B.length&&o.prepend(B),o}function y(a){var b=[];if(a.message){var c=h.generateHash(a.message.text);b.push({label:a.message.text,formattedlabel:a.message.text,formatteddesclabel:"",type:"ERROR",classes:a.message.classes,id:c})}else if(a.available&&!a.duplicate){var c=h.generateHash(a.label);b.push({label:a.label,formattedlabel:a.label,formatteddesclabel:"",type:"CONTACT",extended_type:"AUTO_TYPE_SUGGESTION",classes:" user contact-as-user "+h.getRandomSmiley()+" as-content ",email:a.label,id:c})}return b}function z(a,b){if(!a||0==U.length)return[];b||(b=5),b=Math.min(b,U.length);
for(var c=h.getUserGroupSearchRegex(a),e=[],f=0,g=[U],i=0;i<g.length&&b>f;i++)for(var j=g[i],k=0;k<j.length&&b>f;k++){var l=w(c,j[k],"label").formatted,m=null;j[k].type==d.USER&&(m=w(c,j[k],"desclabel").formatted),(l!=j[k].label||m!=j[k].desclabel)&&(j[k].formattedlabel=l,j[k].formatteddesclabel=m,e.push(j[k]),f++)}return e}function A(a){for(var b=g.getHistory(),c=[],d={},e=0,f=0,h=b.length;h>f;f++){var i=b[f];if("USER"===i.type&&W.hasOwnProperty(i.id)?(c.push(U[W[i.id]]),d[i.id]=!0,e++):V.hasOwnProperty(i.id)&&(c.push(T[V[i.id]]),d[i.id]=!0,e++),e===a)break}if(a>e)for(var f=0,h=U.length;h>f;f++){var i=U[f];if(d.hasOwnProperty(i.id)||(c.push(i),d[i.id]=!0,e++),e===a)break}for(var f=0,h=c.length;h>f;f++)c[f]&&(c[f].formattedlabel=c[f].label,c[f].formatteddesclabel=c[f].desclabel);return c}function B(a){for(var b=g.getHistory(),c=[],d={},e=0,f=0,h=b.length;h>f;f++){var i=b[f];if("USER"===i.type&&W.hasOwnProperty(i.id)&&(c.push(U[W[i.id]]),d[i.id]=!0,e++),e===a)break}if(a>e)for(var f=0,h=U.length;h>f;f++){var i=U[f];if(d.hasOwnProperty(i.id)||(c.push(i),d[i.id]=!0,e++),e===a)break}for(var f=0,h=c.length;h>f;f++)c[f].formattedlabel=c[f].label,c[f].formatteddesclabel=c[f].desclabel;return c}function C(a,b,c,d,e){return b||(b=Z),a||c?x(a,b,c,d,e):A(b)}function D(a,b){return b||(b=Z),a?z(a,b):B(b)}function E(a,b,c,d,e,f){var g=[];if(g.push(a),e)for(var h=e.split(","),i=0;i<h.length;i++)g.push(aa[h[i]]);return G(g,b,c,d,f)}function F(a,b,c,d,e){var f=aa[a];return H(f,b,c,d,e)}function G(a,b,e,f,g){if(f&&!b)return[];for(var j=0,k=0;k<a.length;k++)j+=a[k].length;if(0==j)return[];e||(e=-1),e=Math.min(e,j);var l=[],m=!1,n={};if(!b&&0>e){for(var k=0;k<a.length;k++)l=l.concat(a[k]);m=!0}else if(b){var o=h.getUserGroupSearchRegex(b),p=0;if(g&&g.allowed){var q=g.domain_restricted&&!c.shouldInviteGuestsAsFullMembers();n=i.getSuggestedContactBasedOnQuery(b,q)}for(var r=0;r<a.length&&e>p;r++)for(var s=a[r],k=0;k<s.length&&e>p;k++){var t=w(o,s[k],"label").formatted,u=s[k].desclabel;s[k].dontquerydesc||(u=w(o,s[k],"desclabel").formatted),s[k].type!=d.USER&&"CONTACT"!=s[k].type||!n.available||n.label!=s[k].email||(n.duplicate=!0),(t!=s[k].label||u!=s[k].desclabel)&&(s[k].formattedlabel=t,s[k].formatteddesclabel=u,l.push(s[k]),p++)}}else{for(var k=0;k<a.length;k++)if(l=l.concat(a[k]),l.length>e){l=l.slice(0,e);break}m=!0}n.message&&l.length&&(n.message=null);var v=y(n);if(v&&v.length&&l.prepend(v),m)for(var k=0;k<l.length;k++)l[k].formattedlabel=l[k].label;return l}function H(a,b,c,d,e){if(d&&!b)return[];for(var f=0,g=0;g<a.length;g++)f+=a[g].length;if(0==f)return[];c||(c=-1),c=Math.min(c,f);var i=[],j=!1;if(!b&&0>c){for(var g=0;g<a.length;g++)if(e)for(var k=0;k<a[g].length;k++){var l=a[g];e[l[k].id]||i.push(l[k])}else i=i.concat(a[g]);j=!0}else if(b){for(var m=h.getUserGroupSearchRegex(b),n=0,k=0;k<a.length&&c>n;k++)for(var o=a[k],g=0;g<o.length&&c>n;g++)if(!e||!e[o[g].id]){var p=w(m,o[g],"label").formatted;p!=o[g].label&&(o[g].formattedlabel=p,i.push(o[g]),n++)}}else{for(var g=0;g<a.length;g++){if(e)for(var k=0;k<a[g].length;k++){var l=a[g];e[l[k].id]||i.push(l[k])}else i=i.concat(a[g]);if(i.length>c){i=i.slice(0,c);break}}j=!0}if(j)for(var g=0;g<i.length;g++)i[g].formattedlabel=i[g].label;return i}function I(a){var b=null;if(a)for(var c=0,d=S.length;d>c;c++){var e=S[c];if(e.email===a){b=e;break}}return b}function J(a){var c=b.getUser(a);return null!=c?u(c):null}function K(a){var c=b.findUser(a);if(null!=c){var d=new j(_.extend({},c));return u(d)}return null}function L(b){var c=a.getGroup(b);return null!=c?v(c):null}function M(a){return T[V[a]]||null}function N(a){return U[W[a]]||null}function O(a){var b,c=[];return a&&a.forEach(function(a){b=N(a),null==b&&(b=J(a)),b&&c.push(b)}),c}function P(a){return aa[a]}function Q(a,b){if(!a||0==T.length)return[];b||(b=5),b=Math.min(b,T.length);for(var c=h.getUserGroupSearchRegex(a),e=[],f=0,g=[T],i=0;i<g.length&&b>f;i++)for(var j=g[i],k=0;k<j.length&&b>f;k++){var l=j[k].label.replace(c,"$1b1%b1_1$3b2%b2_2"),m=null;m=j[k].type==d.USER?j[k].desclabel.replace(c,"$1b1%b1_1$3b2%b2_2"):j[k].desclabel,(l!=j[k].label||m!=j[k].desclabel)&&(j[k].formattedlabel=l,j[k].formatteddesclabel=m,e.push(j[k]),f++)}return e}function R(a,b){return b||(b=Z),a?Q(a,b):[]}var S=[],T=[],U=[],V={},W={},X=[],Y=[],Z=5,$={MENTION:"text-editor-at-mention",MARKER:"cnv-src-marker"},aa={},ba={USERS:"users",GROUPS:"groups",GUEST_USERS_ONLY:"guestUsers",USERS_AND_GROUPS:"usersAndGroups",INVITED_USERS_ONLY:"publishableInvitedUsers",NETWORK_ON_DOMAIN_CONTACTS_LIST:"networkOnDomainContactsList"},ca={PUBLISHABLE_INVITED_USERS_MAP:{}};return aa[ba.USERS]=[U],aa[ba.GROUPS]=[T],aa[ba.GUEST_USERS_ONLY]=[X],aa[ba.INVITED_USERS_ONLY]=[Y],aa[ba.USERS_AND_GROUPS]=[U,T],aa[ba.NETWORK_ON_DOMAIN_CONTACTS_LIST]=S,i.on("network_contacts_updated",o),b.on("usersUpdated",m),a.on("groupsUpdated",n),{init:l,createUserListItem:u,createGroupListItem:v,getPublishableGroupsAndUsersOrPreviousHistory:C,getPublishableGroupsOrPreviousHistory:R,queryPublishableUsersAndGroups:x,queryPublishableGroups:Q,getUserListItem:J,findUserListItem:K,getGroupListItem:L,getContactListItem:I,getPublishableGroupListItem:M,getPublishableUserListItem:N,getPublishableUsersOrPreviousHistory:D,createUserListItemForSpecificGroup:t,LIST_MAPS:ca,LIST_NAMES:ba,AT_MENTION_DOM_CLASSES:$,query:F,queryCustomList:E,createUserEmailListItem:s,getList:P,lists:aa,getPublishableUsersListItemsFromUserIds:O}}]),b.module("convoApp").factory("videoPlayerSettings",[function(){function a(a){n=a}function c(){return n}function d(a){m=a}function e(){return m}function f(a,b,c,d){o[a+""]={currentTime:b,duration:c},l.trigger("videoPlayerSettings.seekPosUpdated",{fileId:a,currentTime:b,duration:c,playerRef:d})}function g(a,b){if(a+="",b)return o[a];var c=0;return o[a]&&(c=o[a].currentTime),c}function h(a,b){q[a+""]=b}function i(a){return a+="",q[a]?q[a]:0}function j(a,b){p[a+""]=b}function k(a){return a+="",p[a]?p[a]:!1}var l={};_.extend(l,Backbone.Events);var m,n=1,o=[],p=[],q={};return l=b.extend(l,{setCurrentVolume:a,getCurrentVolume:c,setMuteState:d,getMuteState:e,updateSeekPosition:f,getSeekPosition:g,setDuration:h,getDuration:i,setQuality:j,getQuality:k})}]),b.module("convoApp").factory("webhooksService",["ServerComm","$q","onboardingService",function(a,b,c){var d={createWebhook:function(d,e,f,g,h,i,j){var k=b.defer(),l={account_id:d,creator_id:e,display_name:f,action_type:g,access_level:h,recipients:i,profile_image_info:j};return a.post("webhooks",l).success(function(a,b){k.resolve(a),c.markIntegrationsAsDone("Webhooks")}),k.promise},updateWebhook:function(c,d,e,f,g){var h=b.defer(),i={webhook_id:c,display_name:d,action_type:e,recipients:f,profile_image_info:g};return a.put("webhooks",i).success(function(a,b){h.resolve(a)}),h.promise},getIntegrations:function(c,d,e,f){var g=b.defer(),h={op:"list",creator_id:c,account_id:d,limit:f,offset:e};return a.get("webhooks?op=list&creator_id="+c+"&account_id="+d+"&limit="+f+"&offset="+e,h).success(function(a,b){g.resolve(a)}),g.promise},getIntegrationsByRecipients:function(c,d,e,f,g){var h=b.defer(),i={op:"list",creator_id:c,recipients:d,account_id:e,offset:f,limit:g};return a.get("webhooks?op=list&creator_id="+c+"&recipients="+d+"&account_id="+e+"&offset="+f+"&limit="+g,i).success(function(a,b){h.resolve(a)}),h.promise},getIntegrationDetails:function(c){var d=b.defer(),e={webhook_id:c};return a.get("webhooks?webhook_id="+c,e).success(function(a,b){d.resolve(a)}),d.promise},getIntegrationCompletionStatus:function(c,d){var e=b.defer(),f={op:"is_complete",webhook_id:c,integration_type:d};return a.get("integrations/"+d+"?op=is_complete&webhook_id="+c+"&integration_type="+d+"&token_id=1111",f).success(function(a,b){e.resolve(a)}),e.promise},getUserInfo:function(c,d){var e=b.defer(),f={op:"token_id",user_id:c};return a.get("integrations/"+d+"?op=token_id&user_id="+c+"&token_id=1111",f).success(function(a,b){e.resolve(a)}),e.promise},deleteIntegration:function(c){var d=(b.defer(),{webhook_id:c,hardDelete:!0});return a.deletex("webhooks",d)},disableIntegration:function(c,d,e){var f=b.defer(),g={webhook_id:c,action:d,modified_by:e};return a.put("webhooks",g).success(function(a,b){f.resolve(a)}),f.promise},getConnectedAccounts:function(c,d){var e=b.defer(),f={op:"auth_accounts",creator_id:c,account_id:d,version:"1.1"};return a.get("webhooks?op=auth_accounts&user_id="+c+"&account_id="+d+"&version=1.1",f).success(function(a,b){e.resolve(a)}),e.promise},deleteConnectedAccount:function(c,d,e){var f=(b.defer(),{client_id:c,user_id:d,type:e,op:"revoke_auth_accounts"});return a.deletex("webhooks",f)},canAddIntegration:function(c,d){var e=b.defer(),f={op:"can_add_integration",user_id:c,account_id:d};return a.get("webhooks?op=can_add_integration&user_id="+c+"&account_id="+d,f).success(function(a,b){e.resolve(a)}),e.promise},getOAuth2IntegrationCompletionStatus:function(c,d,e){var f=b.defer(),g={op:"is_complete",user_id:c,account_id:d,integration_type:e};return a.get("webhooks?op=is_complete&user_id="+c+"&integration_type="+e+"&account_id="+d+"&token_id=1111",g).success(function(a,b){f.resolve(a)}),f.promise},discardSecondaryQueueItems:function(c,d){var e=(b.defer(),{webhook_id:c,user_id:d,op:"discard_queue_items"});return a.deletex("webhooks",e)}};return d}]),b.module("convoApp").factory("User",[function(){var a=Backbone.Model.extend({idAttribute:"user_id",fetchingDetailsFromServer:!1,fetchedDetailsFromServer:!1,detailsDeferred:null,initialize:function(){},defaults:{},getFullName:function(){return(this.get("first_name")||"")+" "+(this.get("last_name")||"")},getDetails:function(){var a=this;return a.fetchingDetailsFromServer||a.fetchedDetailsFromServer?a.detailsDeferred.promise:(a.fetchingDetailsFromServer=!0,a.detailsDeferred=$q.defer(),serverComm.post("groups",{group_id:a.get("id"),method:"getGroupDetails"}).success(function(b,c){a.set({description:b.data.description,groupEmail:b.data.email,thisUserCanLeave:b.data.this_user_can_leave,groupMembers:b.data.users,pinnedContents:b.data.pinned_contents}),a.fetchingDetailsFromServer=!1,a.fetchedDetailsFromServer=!0,a.detailsDeferred.resolve()}),a.detailsDeferred.promise)}});return a}]),b.module("convoApp").constant("UserProfileImage",{PROFILE_IMAGE_SIZE_22x22:"22x22",PROFILE_IMAGE_SIZE_28x28:"28x28",PROFILE_IMAGE_SIZE_32x32:"32x32",PROFILE_IMAGE_SIZE_48x48:"48x48",PROFILE_IMAGE_SIZE_64x64:"64x64",PROFILE_IMAGE_SIZE_96x96:"96x96",PROFILE_IMAGE_SIZE_144x144:"144x144",PROFILE_IMAGE_SIZE_184x184:"184x184",PROFILE_IMAGE_VERSION_DEFAULT:0,PROFILE_IMAGE_TYPE_DEFAULT:0,PROFILE_IMAGE_TYPE_CUSTOM:1,PROFILE_IMAGE_TYPE_SYSTEM:2}),b.module("convoApp").factory("userInfo",["config","ServerComm","userImgUrlFilter",function(a,b,d){function e(a,b){a.userRole=b,a._isGuestUser=b===a.USER_ROLE_GUEST,a._isOwner=b===a.USER_ROLE_OWNER,a._isAdmin=b===a.USER_ROLE_OWNER||b===a.USER_ROLE_ADMINISTRATOR}function f(a){if(a){var b=new Image;b.src=a}}var g={USER_ROLE_OWNER:"OWNER",USER_ROLE_ADMINISTRATOR:"ADMINISTRATOR",USER_ROLE_USER:"USER",USER_ROLE_GUEST:"GUEST",user_id:null,first_name:null,last_name:null,email:null,profile_image_type:-1,profile_image_version:-1,userImageUrl:"",account_user_profile_group_id:null,userRole:null,signUpCompletionDate:null,_isGuestUser:!1,_isOwner:!1,_isAdmin:!1,isAdminModeOn:!1,userDataRevisionNo:c,initUserInfo:function(a,b,c,d){this.user_id=a.user_id,this.first_name=a.first_name,this.last_name=a.last_name,this.email=a.email,this.profile_image_type=a.profile_image_type,this.profile_image_version=a.profile_image_version,this.signUpCompletionDate=a.sign_up_completion_date,d?(this.trigger("userInfo.updated"),this.userRole!==b.user_role&&(e(this,b.user_role),this.trigger("userInfo.userRoleUpdated")),this.setAdminMode(c)):(e(this,b.user_role),this.isAdminModeOn=c),f(this.getUserImageUrl_64x64())},isAdmin:function(){return this._isAdmin},updateUserName:function(a,b){this.first_name=a,this.last_name=b},isAdminMode:function(){return this.isAdminModeOn},setAdminMode:function(a){this.isAdminModeOn!=a&&(this.isAdminModeOn=a,this.trigger("userInfo.adminModeChanged",this.isAdminModeOn))},isOwner:function(){return this._isOwner},setUserDataRevisionNo:function(a){return g.userDataRevisionNo===c?void(g.userDataRevisionNo=a):void(g.userDataRevisionNo!=a&&(console.log("JK: triggering userDataRevisionNoChanged event: old/new rev numbers: "+g.userDataRevisionNo+"/"+a),g.userDataRevisionNo=a,g.trigger("userDataRevisionNoChanged")))},updateUserDataRevisionNo:function(a){g.userDataRevisionNo=a},getUserDataRevisionNo:function(){return g.userDataRevisionNo},getUserInfo:function(){return{user_id:this.user_id,name:this.first_name+" "+this.last_name,profile_image_type:this.profile_image_type,profile_image_version:this.profile_image_version,user_role:this.userRole}},updateUserProfileImageTypeAndVersion:function(a,b){this.profile_image_type=a,this.profile_image_version=b,this.trigger("userInfo.updated")},getUserId:function(){return this.user_id},getEmail:function(){return this.email},getUserImageUrl_64x64:function(){return g.userImageUrl=0!=g.profile_image_type&&0!=g.profile_image_version?d(g.user_id,g.profile_image_type,g.profile_image_version,"64x64"):"",g.userImageUrl},isGuestUser:function(){return this._isGuestUser},setAccountUserProfileGroupId:function(a){this.account_user_profile_group_id=a},getAccountUserProfileGroupId:function(){return this.account_user_profile_group_id},resetPassword:function(a,c){return b.postx("passwordreset",{method:"changePassword",current_password:a,new_password:c})},changeEmail:function(a){var c=b.postx("user",{method:"changeEmail",new_email:a});return c.then(function(b){1==b.data.type&&(g.email=a,g.trigger("userAccountEmailUpdated"))}),c}};return _.extend(g,Backbone.Events),g}]),b.module("convoApp").factory("userProvider",[function(){function a(a,d){f[d]===c&&(f[d]={}),b.extend(f[d],a)}function d(a,b){return f[b][a]}var e={};e.DATA_FORMAT_APP="APP",e.DATA_FORMAT_SERVICE="SERVICE";var f={};return e.updateUsers=a,e.getUser=d,e}]),b.module("convoApp").factory("Users",["ServerComm","accountInfo","userInfo","$q","User","$rootScope","Group","relevanciesService","accountDataService","AccountDataChangeNotificationType","localStore","userImgUrlFilter",function(a,b,d,e,f,g,h,i,j,k,l,m){function n(){return ca}function o(a){V=a.accessible_users,W={},Y=[],Z=[],$=[];var b=[];a.user&&V.push(a.user);for(var c=V?V.length:0,d=null,e=0;c>e;e++)if(d=V[e])if(d.id=d.user_id,W[d.user_id]){var f=W[d.user_id];for(var g in d)f[g]=d[g];V.splice(e,1),d=f,--e}else W[d.user_id]=d,d.serialNo=e,d.searchable&&Y.push(d),d.publishable&&("INVITED"===d.status?b.push(d):Z.push(d)),d.show_in_buddy_list&&$.push(d);Z=Z.concat(b)}function p(){var a=l.readData(n());return a&&a.version!==ba&&(a=null,l.clearData(n())),a}function q(c,f){if(!S&&(!T||c||f)){R=e.defer();var g=!1;if(f||(localData=p(),localData&&localData.data.account_data_revision_no==b.getAccountDataRevisionNo()&&(o(localData.data.users_data),T=!0,R.resolve(V),g=!0)),!g){var h=a.getx("users");S=!0,h.then(function(a){a=a.data;var b=V.length?!0:!1;if(o(a),S=!1,T=!0,!d.isAdminMode()){var c={};c.users_data=a,c.account_data_revision_no=a.account_data_revision_number,l.writeData(n(),c,ba)||l.writeData(n(),"",ba)}R.resolve(V),b&&Q.trigger("usersUpdated")},function(a){S=!1,T=!1,R.reject(a)})}}return R.promise}function r(){return q().then(function(a){return Y})}function s(){return q().then(function(a){return Z})}function t(){return q().then(function(a){return $})}function u(){return a.postx("users",{method:"getAllUsersDetailsAccessibleToUserInAccount"})}function v(b,c,d){return a.postx("users",{method:"updateUserNotificationSettings",user_id:b,notification_settings:{mobile:d,email:c}})}function w(b,c,d,e,f){var g={method:"inviteUsers",emails:b,message:c};return d&&(g.type="reminder"),f&&(g.view=f),e&&(g.send_invitation_email=0,g.chat_id="P2P"),a.postx("invite",g)}function x(b){return a.postx("groups",{method:"getGroupsToWhichSpecifiedUserCanBeAdded",specified_user_id:b})}function y(b){return a.postx("groups",{method:"getGroupsFromWhichSpecifiedUserCanBeRemoved",specified_user_id:b})}function z(b){var c=a.postx("accounts",{method:"removeUser",user_id:b});return c.then(function(a){L(a,{userId:b})}),c}function A(a){return W[a]||X[a]}function B(a){return A(a)}function C(a){return a?(a.fullName||(a.fullName=(a.first_name||"")+" "+(a.last_name||"").trim(),a.fullName.length<2&&(a.fullName=a.email,a.nameIsEmail=!0)),a.fullName):"Unknown"}function D(a,b){return a.profileImages||(a.profileImages={}),a.profileImages[b]||(a.profileImages[b]=m(a.user_id,a.profile_image_type,a.profile_image_version,b)),a.profileImages[b]}function E(a){var b=A(a);return b?b.serialNo:c}function F(a){return G(a)}function G(a){if(!a)return null;var b=a.toLowerCase(),c=A(a);if(!c)for(var d=null,e=0;e<V.length;e++)if(d=V[e],d.first_name.toLowerCase()==b||d.last_name.toLowerCase()==b||d.email.toLowerCase()==b){c=d;break}if(!c){var d=null;for(var f in X)if(d=X[f],d.first_name.toLowerCase()==b||d.last_name.toLowerCase()==b||d.email.toLowerCase()==b){c=d;break}}return c}function H(b){return q().then(function(c){var d=B(b);return d?d:a.getx("users?user_id="+encodeURIComponent(b)).then(function(a){return d=a.data?new f(a.data):null})})}function I(){for(var a={},b=0;b<V.length;b++)a[V[b].email.toLowerCase()]=!0;return a}function J(){return q().then(function(a){return aa?V:i.getRelevanciesPromise().then(function(a){var b=a.users;if(!b)return V;for(var c=0;c<b.length;c++){var d=A(b[c].term);d&&(d.rank=b[c].rank)}return aa=!0,V})})}function K(){q(!0,!0).then(function(){Q.trigger("usersUpdated")})}function L(a,b){M(b,!1),j.sendAccountDataChangeNotification(k.USER_REMOVED_FROM_ACCOUNT,b)}function M(a,b){b?Q.trigger("userRemovedFromNetworkByRemoteUser",a.userId):Q.trigger("userRemovedFromNetwork",a.userId)}function N(){if(!U){var a=new Date,b=a.getDate().toString(),c=(a.getMonth()+1).toString(),d=a.getFullYear().toString(),e=(a.getHours()-6).toString(),f=a.getMinutes().toString(),g=a.getSeconds().toString();U=d+"-"+c+"-"+b+" "+e+":"+f+":"+g}return U}function O(){var a=new Date,b=a.getDate().toString(),c=(a.getMonth()+1).toString(),d=a.getFullYear().toString(),e=(a.getHours()-6).toString(),f=a.getMinutes().toString(),g=a.getSeconds().toString();U=d+"-"+c+"-"+b+" "+e+":"+f+":"+g}function P(){var b={params:{last_fetch_time:N()}},c=a.get("presence_info",b),d=e.defer();return c.then(function(a){200==a.status&&(O(),d.resolve(a.data))}),d.promise}var Q={};_.extend(Q,Backbone.Events);var R,S,T,U,V=[],W={},X={},Y=[],Z=[],$=[],aa=!1,ba=5,ca="USRS";return b.on("accountDataRevisionNoChanged",function(){q(!0).then(function(){Q.trigger("usersUpdated")})}),j.on("userRemovedFromNetworkByRemoteUser",function(a){M(a,!0)}),Q.getAllUsersWithDetails=function(){return u().then(function(a){return a.data})},Q.updateUserNotificationSettings=function(a,b,c){return b=b?1:0,c=c?1:0,v(a,b,c).then(function(a){return a})},Q.inviteUsersToNetwork=function(a,b,c,d,e){return w(a,b,c,d,e).then(function(a){return Q.trigger("userInvitedToNetwork"),a})},Q.getGroupsToWhichUserCanBeAdded=function(a){return x(a).then(function(a){return a.data})},Q.getGroupsToWhichUserCanBeRemoved=function(a){return y(a).then(function(a){return a.data})},Q.removeUserFromNetwork=function(a){return z(a).then(function(a){return a})},Q.getUserDetails=function(b){var c=e.defer(),d=a.get("user",{params:{user_id:b,details:"analytics"}});return d.success(function(a,b){c.resolve(a)}),c.promise},Q.updateUserProfile=function(b){if(b){b.method="updateUserProfile";var c=a.post("user",b),d=e.defer();return c.success(function(a,b){d.resolve(a)}),d.promise}},Q.followUser=function(b){var c={method:"followUser",user_id:b},d=a.post("user",c),f=e.defer();return d.success(function(a,b){f.resolve(a)}),f.promise},Q.unfollowUser=function(b){var c={method:"unfollowUser",user_id:b},d=a.post("user",c),f=e.defer();return d.success(function(a,b){f.resolve(a)}),f.promise},Q.getTopGroups=function(b){var c={authToken:g.login_data.xmpp_session_token,userID:g.login_data.user.user_id,accountID:g.login_data.account_id,other_user_id:b},d=a.post("analytics/usertopgroups",c),f=e.defer();return d.then(function(a){f.resolve(a.data)}),f.promise},Q.getUsers=q,Q.getSearchableUsers=r,Q.getPublishableUsers=s,Q.getBuddyUsers=t,Q.getUser=B,Q.getUserById=A,Q.getUserSerialNo=E,Q.findUser_onUserIdFirst=F,Q.findUser=G,Q.getUserFullName=C,Q.getUserImage=D,Q.getUserFromServerIfNotAvailableLocally=H,Q.getUsersLowerCaseEmailsMap=I,Q.fillRelevanciesInUsers=J,Q.getUsersFromServer=K,Q.updateUsersLastActiveTime=P,Q}]),b.module("convoApp").controller("MenuletAppCtrl",["$scope","$rootScope","config","$location","Groups","ServerComm","Users","accountInfo","userInfo","AppLinks","datetimeService","awsService","InAppNotifications","appStateInfo","nativeCommBridge","$window","nativeHeightUpdate","settingsService","accountDataService","usersGroupsListProvider","connectivity","appTabs","utils","emojiDataService","filterInfo","loginResponseData","Contacts",function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){function C(a){A.set(a),c.login_data=a,d.IS_NATIVE&&p.signIn(JSON.stringify(a));for(var b,g=a.user_accounts,k=a.account_id,n=0;n<g.length;n++)if(g[n].account_id===k){b=g[n];break}i.initAccountInfo(b,g),j.initUserInfo(a.user,b),m.setAwsData(a.aws_data),setTimeout(function(){B.initialize(b)},0);var o={};o[a.user.user_id]={accessible:!0,name:a.user.first_name+" "+a.user.last_name,profile_image_type:a.user.profile_image_type,profile_image_version:a.user.profile_image_version};var q=parseInt(a.time.timestamp),r=L?(Date.now()-L)/2:0;l.init(q+r),K?e.path(K.path).search(K.search).hash(K.hash):e.path("/feed").search({}).hash("title=My Feed"),h.getUsers().then(function(a){}),s.getGeneralSettings(),f.getListableGroups().then(function(){f.fillRelevanciesInListableGroups()}),setTimeout(function(){u.init(!1)},0),w.addTabsEventListener2("mainAppFeedFetched",D),w.dispatchTabsEvent2("isAppFeedFetched")}function D(){var a={authToken:c.login_data.xmpp_session_token,userID:c.login_data.user.user_id,accountID:c.login_data.account_id,fromIndex:0,itemsCount:1,summaryParams:null,sortBy:1,feedIDsWithTimestamp:null,filter:null,isSearch:!1,includeChats:!1,includeDrafts:!1,applyHighlight:!0};g.postx("feed/fetch",a)}function E(){b.signed_in=!1,a.com_convo.sessionData.isSignedIn=!1,b.$$phase||b.$apply()}d.IS_MENULET=!0;var F=d.APP_BASE_URL.split("/");F.pop(),F.pop(),d.APP_BASE_URL=F.join("/")+"/",p.initializeApp();for(var G=q.com_convo.appsPendingRegistration,H=0;H<G.length;H++)G[H]();q.com_convo.appsPendingRegistration=[],b.appLoaded=null;var I=x.generateUniqueId();w.initializeThisTab(I),g.setClientInstanceId(I),b.tab={},b.tab.appContCtrl={},b.tab.appContCtrl.appCtrl={};var J=function(){"function"==typeof b.tab.appContCtrl.appCtrl.closing&&b.tab.appContCtrl.appCtrl.closing()};q.addEventListener("unload",J),v.initialize();var K=!1;b.signed_in=a.com_convo.sessionData.isSignedIn;var L=null;c.filterInfo=z,b.signed_in&&C(a.com_convo.sessionData.signInResponseData),b.loadApp=function(){p.loadApp()},$(a).on("disconnected",function(){b.$apply(function(){b.signed_in=!1,a.com_convo.sessionData.isSignedIn=!1})}),p.on("logoutMenulet",E),g.on("sessionExpired",E),g.on("appUpdateAvailable",E),r.initilizeObserver(),setTimeout(function(){b.appLoaded=!0},0),b.signed_in&&setTimeout(function(){y.loadAssets()},5e3)}]),b.module("convoApp").controller("TwoFactorAuthAppCtrl",["$scope","$rootScope","$location","config","ServerComm","appTabs","utils",function(b,c,d,e,f,g,h){function i(a){var b=d.search();b.redirect_url&&(a=b.redirect_url),location.href=a}function j(){f.post("mfa",{method:"getUserMfaSettings"}).success(function(a){if(1==a.type){if(c.user_mfa_settings=a.data,!c.user_mfa_settings.user_is_fully_authenticated&&c.user_mfa_settings.mfa_enabled&&i(e.LOGIN_URL),c.user_mfa_settings.mfa_enabled&&c.user_mfa_settings.mfa_methods)for(var b=0;b<c.user_mfa_settings.mfa_methods.length;b++)c.user_mfa_settings[c.user_mfa_settings.mfa_methods[b].method]=c.user_mfa_settings.mfa_methods[b];c.auth_path_complete_statue.SMS=c.user_mfa_settings.SMS?!0:!1,c.auth_path_complete_statue.AUTH_APP=c.user_mfa_settings.AUTH_APP?!0:!1}}).error(function(a){})}a.__2FA_APP_LOADED=!0,$(".wireframe-spinner").remove();var k=e.APP_BASE_URL.split("/");k.pop(),k.pop(),e.APP_BASE_URL=k.join("/")+"/",c.user_mfa_settings=null,c.auth_path_complete_statue={SMS:!1,AUTH_APP:!1},c.url_search_part={},g.initializeThisTab(h.generateUniqueId()),b.$on("$locationChangeStart",function(a){c.url_search_part=d.search()}),b.$on("$locationChangeSuccess",function(a){var b=c.url_search_part;b.view||(b.view="options"),c.$emit("set_view",{view:b.view})}),f.on("sessionExpired",function(){console.error("session expired"),i(e.LOGIN_URL)}),j()}]),b.module("convoApp").factory("settingsService",["ServerComm","$q","nativeCommBridge","RTCNotification","$injector","userInfo",function(a,c,d,e,f,h){function i(a){W=a,V=f.get("rtcNotificationManager"),V.addListener(g.rtc.PubsubEvents.NOTIFICATION_RECEIVE,j)}function j(a){if(a.notification.type===e.USER_SETTINGS_UPDATED&&a.notification.data.userId===W){console.log("RECEIVED: RTCNotification.USER_SETTINGS_UPDATED");var b=a.notification.data;b.type===X?k(!0):b.type===Y&&(Z[P.GENERAL_SETTING___SORT_CHAT_LIST_BY]=b.data,P.trigger("sortChatListBySettingUpdatedByRemoteUser",b.data))}}function k(b){if(T)return R.promise;if(S&&!b)return R.promise;R=c.defer();var d=P.getMode()===P.MODE_ADMIN?P.SETTING_URL.ADMIN+"?method=readNetworkSettingsTemplate":P.SETTING_URL.NORMAL,e=a.getx(d);return T=!0,S=!1,e.then(function(a){P.getMode()===P.MODE_ADMIN?("generated_template"in a.data.data&&(P.SETTING_FIRST_TIME=!0),Z=a.data.data.network_notifications_settings):Z=a.data.data,T=!1,S=!0,R.resolve(Z)},function(a){T=!1,S=!1,R.reject(a)}),R.promise}function l(c,d){var e=P.getMode()===P.MODE_ADMIN?P.SETTING_URL.ADMIN:P.SETTING_URL.NORMAL;return a.post(e,c).success(function(a,e){if(a.type){if(d){for(var f in c.sso_settings)Z.sso_settings[f]=c.sso_settings[f];a.data&&(Z.sso_settings.revision=a.data.revision)}else b.extend(Z,c);return Z}})}function m(c){var d=P.getMode()===P.MODE_ADMIN?P.SETTING_URL.ADMIN:P.SETTING_URL.NORMAL;return a.put(d,c).success(function(a,d){return a.type?(b.extend(Z,c),Z):void 0})}function n(a){console.log("updateGeneralSettings");var b=JSON.parse(a);delete b.users,delete b.groups,delete b.user_sharing_options,delete b.sharing_options,delete b.sharing_options_list,l(b)}function o(a){return k(a).then(function(){var a={};return a[P.GENERAL_SETTING___NOTIFY_ONLY_WHEN_AWAY]=Z[P.GENERAL_SETTING___NOTIFY_ONLY_WHEN_AWAY],a[P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND]=Z[P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND],a[P.GENERAL_SETTING___NOTIFY_UPDATES_IN_NEWS_FEED]=Z[P.GENERAL_SETTING___NOTIFY_UPDATES_IN_NEWS_FEED],a[P.GENERAL_SETTING___ENABLE_DESKTOP_NOTIFICATIONS]=Z[P.GENERAL_SETTING___ENABLE_DESKTOP_NOTIFICATIONS],a[P.GENERAL_SETTING___ENABLE_EMAIL_NOTIFICATIONS]=Z[P.GENERAL_SETTING___ENABLE_EMAIL_NOTIFICATIONS],a[P.GENERAL_SETTING___ENABLE_DEVICE_NOTIFICATIONS]=Z[P.GENERAL_SETTING___ENABLE_DEVICE_NOTIFICATIONS],a[P.GENERAL_SETTING___ENABLE_IN_APP_NOTICATIONS]=Z[P.GENERAL_SETTING___ENABLE_IN_APP_NOTICATIONS],a[P.GENERAL_SETTING___NOTIFY_DIRECTS_AND_MENTIONS]=Z[P.GENERAL_SETTING___NOTIFY_DIRECTS_AND_MENTIONS],a[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_MY_POSTS]=Z[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_MY_POSTS],a[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_POSTS_I_COMMENT_ON]=Z[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_POSTS_I_COMMENT_ON],a[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_DIRECTS]=Z[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_DIRECTS],a[P.GENERAL_SETTING___NOTIFY_NEW_GROUP_SHARE]=Z[P.GENERAL_SETTING___NOTIFY_NEW_GROUP_SHARE],a[P.GENERAL_SETTING___NOTIFY_INVITES_ACCEPTANCES]=Z[P.GENERAL_SETTING___NOTIFY_INVITES_ACCEPTANCES],a[P.GENERAL_SETTING___NOTIFY_NEW_FOLLOWER]=Z[P.GENERAL_SETTING___NOTIFY_NEW_FOLLOWER],a[P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS]=Z[P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS],a[P.GENERAL_SETTING___NOTIFY_USER_STATUS_UPDATES]=Z[P.GENERAL_SETTING___NOTIFY_USER_STATUS_UPDATES],a[P.GENERAL_SETTING___NOTIFY_GROUP_JOIN_REQUESTS]=Z[P.GENERAL_SETTING___NOTIFY_GROUP_JOIN_REQUESTS],a[P.GENERAL_SETTING___SEND_CONFIRMATION_FOR_EMAIL_POSTS]=Z[P.GENERAL_SETTING___SEND_CONFIRMATION_FOR_EMAIL_POSTS],a[P.GENERAL_SETTING___DIGEST_SEND_FREQUENCY]=Z[P.GENERAL_SETTING___DIGEST_SEND_FREQUENCY],a[P.GENERAL_SETTING___PROFILE_GROUPS_SETTINGS]=Z[P.GENERAL_SETTING___PROFILE_GROUPS_SETTINGS],a[P.GENERAL_SETTING___REGULAR_GROUPS_SETTINGS]=Z[P.GENERAL_SETTING___REGULAR_GROUPS_SETTINGS],a[P.GENERAL_SETTING___MULTI_FACTOR_AUTH_SETTINGS]=Z[P.GENERAL_SETTING___MULTI_FACTOR_AUTH_SETTINGS],a[P.GENERAL_SETTING___NOTIFY_SMS_MESSAGES]=Z[P.GENERAL_SETTING___NOTIFY_SMS_MESSAGES],a})}function p(){return parseInt(Z[P.GENERAL_SETTING___ENABLE_DESKTOP_NOTIFICATIONS])}function q(){return parseInt(Z[P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS])}function r(){return parseInt(Z[P.GENERAL_SETTING___NOTIFY_USER_STATUS_UPDATES])}function s(){return parseInt(Z[P.GENERAL_SETTING___NOTIFY_NEW_FOLLOWER])}function t(){return parseInt(Z[P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND])}function u(){return parseInt(Z[P.GENERAL_SETTING___NOTIFY_NEW_GROUP_SHARE])}function v(){return parseInt(Z[P.GENERAL_SETTING___NOTIFY_GROUP_JOIN_REQUESTS])}function w(){return Z[P.GENERAL_SETTING___MULTI_FACTOR_AUTH_SETTINGS]}function x(){var b={method:"getAllBackupCodesOfUser"};return a.post("mfa",b)}function y(a){return k(a).then(function(){var a={};return a[P.GENERAL_SETTING___SHARING_OPTIONS]=Z[P.GENERAL_SETTING___SHARING_OPTIONS],a[P.GENERAL_SETTING___SHARING_OPTIONS_LIST]=Z[P.GENERAL_SETTING___SHARING_OPTIONS_LIST],a[P.GENERAL_SETTING___PROFILE_GROUPS_SETTINGS]=Z[P.GENERAL_SETTING___PROFILE_GROUPS_SETTINGS],a[P.GENERAL_SETTING___REGULAR_GROUPS_SETTINGS]=Z[P.GENERAL_SETTING___REGULAR_GROUPS_SETTINGS],a})}function z(a){return k(a).then(function(){var a={};return a[P.GENERAL_SETTING___SORT_CHAT_LIST_BY]=Z[P.GENERAL_SETTING___SORT_CHAT_LIST_BY],a[P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND]=Z[P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND],a[P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS]=Z[P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS],a})}function A(a,b,c){var d={};return d[P.GENERAL_SETTING___SORT_CHAT_LIST_BY]=a,d[P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS]=c,d[P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND]=b,l(d)}function B(a,b){var c={};c[a]=b;var d;return P.SETTING_FIRST_TIME?(c={},c.method=P.getMode()===P.MODE_ADMIN?"createNetworkSettingsTemplate":"updateNetworkSettingsTemplate",c.network_notifications_settings=O(),c.network_notifications_settings[a]=b,d=l(c)):P.SETTING_FIRST_TIME||P.getMode()!==P.MODE_ADMIN?d=l(c):(c={},c.method="updateNetworkSettingsTemplate",c.network_notifications_settings={},c.network_notifications_settings[a]=b,d=m(c)),d.then(function(c){a===P.GENERAL_SETTING___SHARING_OPTIONS_LIST||a===P.GENERAL_SETTING___RESET_TO_DEFAULT_SHARING_OPTIONS?(k(!0),C(X,null)):a===P.GENERAL_SETTING___SORT_CHAT_LIST_BY&&C(Y,b)}),d}function C(a,b){var c=new e;c.type=e.USER_SETTINGS_UPDATED,c.data={userId:W,type:a,data:b,settingsRevisionNo:U},V.send(c),console.log("SENT: RTCNotification.USER_SETTINGS_UPDATED")}function D(a,b){return a|b}function E(a,b){return a&~b}function F(a,b){return(a&b)>0}function G(b){var d={method:"sendSSOEmailToAccountUsers",sso_enabled:b?1:0},e=a.post("email",d),f=c.defer();return e.then(function(a,b){f.resolve(a.data)},function(a,b){f.reject(a.data)}),f.promise}function H(){var b={method:"activateRequiredMfa"};return a.post("mfa",b)}function I(){var b={method:"deactivateMfaForUser"};return a.post("mfa",b)}function J(){var b={method:"deactivateRequiredMfa"};return a.post("mfa",b)}function K(){var b={method:"expireAllOtherUserSessions"};return a.post("mfa",b)}function L(){Q=P.MODE_ADMIN}function M(){Q=P.MODE_NORMAL}function N(){return Q}function O(){var a={};return a[P.GENERAL_SETTING___NOTIFY_ONLY_WHEN_AWAY]=Z[P.GENERAL_SETTING___NOTIFY_ONLY_WHEN_AWAY],
a[P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND]=Z[P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND],a[P.GENERAL_SETTING___NOTIFY_UPDATES_IN_NEWS_FEED]=Z[P.GENERAL_SETTING___NOTIFY_UPDATES_IN_NEWS_FEED],a[P.GENERAL_SETTING___ENABLE_DESKTOP_NOTIFICATIONS]=Z[P.GENERAL_SETTING___ENABLE_DESKTOP_NOTIFICATIONS],a[P.GENERAL_SETTING___ENABLE_EMAIL_NOTIFICATIONS]=Z[P.GENERAL_SETTING___ENABLE_EMAIL_NOTIFICATIONS],a[P.GENERAL_SETTING___ENABLE_DEVICE_NOTIFICATIONS]=Z[P.GENERAL_SETTING___ENABLE_DEVICE_NOTIFICATIONS],a[P.GENERAL_SETTING___ENABLE_IN_APP_NOTICATIONS]=Z[P.GENERAL_SETTING___ENABLE_IN_APP_NOTICATIONS],a[P.GENERAL_SETTING___NOTIFY_DIRECTS_AND_MENTIONS]=Z[P.GENERAL_SETTING___NOTIFY_DIRECTS_AND_MENTIONS],a[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_MY_POSTS]=Z[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_MY_POSTS],a[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_POSTS_I_COMMENT_ON]=Z[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_POSTS_I_COMMENT_ON],a[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_DIRECTS]=Z[P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_DIRECTS],a[P.GENERAL_SETTING___NOTIFY_NEW_GROUP_SHARE]=Z[P.GENERAL_SETTING___NOTIFY_NEW_GROUP_SHARE],a[P.GENERAL_SETTING___NOTIFY_INVITES_ACCEPTANCES]=Z[P.GENERAL_SETTING___NOTIFY_INVITES_ACCEPTANCES],a[P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS]=Z[P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS],a[P.GENERAL_SETTING___NOTIFY_USER_STATUS_UPDATES]=Z[P.GENERAL_SETTING___NOTIFY_USER_STATUS_UPDATES],a[P.GENERAL_SETTING___NOTIFY_GROUP_JOIN_REQUESTS]=Z[P.GENERAL_SETTING___NOTIFY_GROUP_JOIN_REQUESTS],a[P.GENERAL_SETTING___SEND_CONFIRMATION_FOR_EMAIL_POSTS]=Z[P.GENERAL_SETTING___SEND_CONFIRMATION_FOR_EMAIL_POSTS],a[P.GENERAL_SETTING___NOTIFY_SMS_MESSAGES]=Z[P.GENERAL_SETTING___NOTIFY_SMS_MESSAGES],a[P.GENERAL_SETTING___DIGEST_SEND_FREQUENCY]=Z[P.GENERAL_SETTING___DIGEST_SEND_FREQUENCY],a}var P={};_.extend(P,Backbone.Events),P.EMAIL=1,P.MOBILE=2,P.DESKTOP=4,P.NOTIFICATION_CENTER=8,P.MODE_ADMIN="ADMIN",P.MODE_NORMAL="NORMAL";var Q=P.MODE_NORMAL;P.SETTING_URL={},P.SETTING_URL.NORMAL="settings",P.SETTING_URL.ADMIN="admin/networknotificationsetting",P.SETTING_FIRST_TIME=!1,P.GENERAL_SETTING___SORT_CHAT_LIST_BY="sort_chat_list_by",P.GENERAL_SETTING___PLAY_CHAT_NOTIFICATION_SOUND="play_sound_on_notification",P.GENERAL_SETTING___NOTIFY_ONLY_WHEN_AWAY="notify_only_when_away",P.GENERAL_SETTING___NOTIFY_UPDATES_IN_NEWS_FEED="notify_updates_in_news_feed",P.GENERAL_SETTING___ENABLE_DESKTOP_NOTIFICATIONS="enable_desktop_notifications",P.GENERAL_SETTING___ENABLE_EMAIL_NOTIFICATIONS="enable_email_notifications",P.GENERAL_SETTING___ENABLE_DEVICE_NOTIFICATIONS="enable_device_notifications",P.GENERAL_SETTING___ENABLE_IN_APP_NOTICATIONS="enable_in_app_notifications",P.GENERAL_SETTING___NOTIFY_DIRECTS_AND_MENTIONS="notify_directs_and_mentions",P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_MY_POSTS="notify_comments_on_my_posts",P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_POSTS_I_COMMENT_ON="notify_comments_on_posts_i_comment_on",P.GENERAL_SETTING___NOTIFY_COMMENTS_ON_DIRECTS="notify_comments_on_directs",P.GENERAL_SETTING___NOTIFY_NEW_GROUP_SHARE="notify_new_group_share",P.GENERAL_SETTING___NOTIFY_INVITES_ACCEPTANCES="notify_invites_acceptances",P.GENERAL_SETTING___NOTIFY_NEW_FOLLOWER="notify_new_follower",P.GENERAL_SETTING___NOTIFY_INCOMING_CHATS="notify_incoming_chats",P.GENERAL_SETTING___NOTIFY_USER_STATUS_UPDATES="notify_user_status_updates",P.GENERAL_SETTING___NOTIFY_GROUP_JOIN_REQUESTS="notify_group_join_requests",P.GENERAL_SETTING___SEND_CONFIRMATION_FOR_EMAIL_POSTS="send_confirmation_for_email_posts",P.GENERAL_SETTING___DIGEST_SEND_FREQUENCY="digest_send_frequency",P.GENERAL_SETTING___SHARING_OPTIONS_LIST="sharing_options_list",P.GENERAL_SETTING___SHARING_OPTIONS="sharing_options",P.GENERAL_SETTING___GROUP_SUBSCRIPTIONS="group_subscriptions",P.GENERAL_SETTING___RESET_TO_DEFAULT_SHARING_OPTIONS="reset_to_default_sharing_options",P.GENERAL_SETTING___PROFILE_GROUPS_SETTINGS="profile_groups_settings",P.GENERAL_SETTING___REGULAR_GROUPS_SETTINGS="regular_groups_settings",P.GENERAL_SETTING___MULTI_FACTOR_AUTH_SETTINGS="mfa",P.GENERAL_SETTING___NOTIFY_SMS_MESSAGES="notify_sms_messages";var R,S,T,U,V,W,X=1,Y=2,Z={};return d.on("updateGeneralSettings",n),P.initialize=i,P.getGeneralSettings=k,P.saveGeneralSettings=l,P.getChatSettings=z,P.saveChatSettings=A,P.getSettingsForNotificationPage=o,P.getSettingsForCustomizeFeed=y,P.saveSettingByName=B,P.bitON=D,P.bitOFF=E,P.isBitONOFF=F,P.getIncomingChatSetting=q,P.getUserStatusSetting=r,P.isDesktopNotificationEnabled=p,P.getStartFollowingSetting=s,P.getGroupSharedSetting=u,P.getGroupJoinReqSetting=v,P.getMultiFactorAuthSetting=w,P.getBackupCodes=x,P.isSoundEnabled=t,P.sendSSOEmail=G,P.activateRequiredMfaForLoggedInUser=H,P.deactivateRequiredMfaForLoggedInUser=I,P.deactivateRequiredMfa=J,P.expireAllOtherUserSessions=K,P.setAdminMode=L,P.setNormalMode=M,P.getMode=N,P}]),setTimeout(function(){a.allAppFilesLoaded=!0,a.isLoggedIn&&b.bootstrap(document.getElementById("ng-app"),["convoApp"])},1),b.module("convoApp").run([function(){b.module("convoApp").initialized=!0}]),b.module("convoApp").initialized?e(b.element(document.body).injector().get("$templateCache")):b.module("convoApp").run(["$templateCache",function(a){e(a)}]),b.module("convoApp").run([function(){b.module("convoApp").initialized=!0}]),b.module("convoApp").initialized?f(b.element(document.body).injector().get("$templateCache")):b.module("convoApp").run(["$templateCache",function(a){f(a)}])}(window,window.angular);
//# sourceMappingURL=convo-web-app-core-2018.05.24.01.js.map